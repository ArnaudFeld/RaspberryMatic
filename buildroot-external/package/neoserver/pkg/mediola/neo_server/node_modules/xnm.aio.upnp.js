var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.upnp=xnm.aio.upnp||{};
xnm.aio.upnp.Player=function(){var f=function(a){"undefined"!=typeof require&&require?(this._logger=require("x.logger.js").getLogger("xnm.aio.bose.SoundTouch"),require("x.logger.js").setLevel("trace","xnm.aio.bose.SoundTouch")):this._logger={log:{}};this._renderer=null;a&&a.ip&&a.port&&a.uuid&&a.avTransport&&a.renderingControl&&(this._renderer=this._getRenderer(a.ip,a.port,a.uuid,a.avTransport,a.renderingControl))};f.prototype.getIP=function(){return this._renderer?this._renderer.ip:null};f.prototype.setIP=
function(a){this._renderer&&(this._renderer.ip=a)};f.prototype.getPort=function(){return this._renderer?this._renderer.port:null};f.prototype.setPort=function(a){this._renderer&&(this._renderer.port=a)};f.prototype.getUUID=function(){return this._renderer?this._renderer.uuid:null};f.prototype.getPlayInfo=function(a){this._renderer?this._renderer.getPlayInfo(function(c,b){a&&a(c,b)}):a&&a(Error("no renderer"))};f.prototype.play=function(a,c,b){if(a&&c&&c["class"]&&c.id)if(this._renderer){var d=this;
a.browseMetaData(c.id,function(e,g){e?b&&b(e):0!=c["class"].indexOf("object.container")||c.res&&c.res.url?c.res&&c.res.url?d._renderer.playResource({url:c.res.url},g.result,b):b&&b(Error("resource url invalid")):a.uuid?d._renderer.playContainer({containerID:c.id,server_uuid:a.uuid},g.result,b):b&&b(Error("media server uuid invalid"))})}else b&&b(Error("renderer not inited"));else b&&b(Error("play obj invalid"))};f.prototype.browser=function(a,c,b,d,e){a?(c||(c=0),b||(b=0),d||(d=0),a.browseChildren(c,
b,d,null,function(b,a,c){e&&e(b,a,c)})):e&&e(Error("play obj invalid"))};f.prototype.executeCommandCreator=function(a,c,b){c&&c.value?this._executeCommand(c.value,c.ext,function(a){b&&b(a)}):b&&b(Error("command value is empty"))};f.prototype.getStatesCreator=function(a,c,b){this._getStates(function(a,e){if(a)b&&b(a);else{for(var g=[],f=0;f<c.length;f++){var h=c[f];if(h&&h.id&&h.status){var k="?";switch(h.status.value){case "power":case "muted":case "volume":case "repeatMode":case "shuffleMode":case "playState":case "durationS":case "positionS":case "bass":k=
e[h.status.value];break;case "artist":case "title":case "album":case "radio":(k=e[h.status.value])||(k="")}if("undefined"==typeof k||null==k)k="?";g.push({id:h.id,status:k})}}b&&b(null,g)}})};f.prototype._executeCommand=function(a,c,b){if(this._renderer){var d=this,e;switch(a){case "play":this._clickKey("PLAY",b);break;case "pause":this._clickKey("PAUSE",b);break;case "tooglePlay":this._clickKey("PLAY_PAUSE",b);break;case "stop":this._clickKey("STOP",b);break;case "previous":this._clickKey("PREV_TRACK",
b);break;case "next":this._clickKey("NEXT_TRACK",b);break;case "togglePower":this._clickKey("POWER",b);break;case "toggleMute":this._clickKey("MUTE",b);break;case "volumeUp":this._clickKey("VOLUME_UP",b);break;case "volumeDown":this._clickKey("VOLUME_DOWN",b);break;case "setVolume":if("undefined"==typeof c||null==c){b&&b(Error("volume value invalid"));break}c=parseInt(c);100<c&&(c=100);0>c&&(c=0);this._setVolume(c,b);break;case "thumbUp":this._clickKey("THUMBS_UP",b);break;case "thumbDown":this._clickKey("THUMBS_DOWN",
b);break;case "bookmark":this._clickKey("BOOKMARK",b);break;case "preset":if(!c){b&&b(Error("preset value invalid"));break}this._clickKey("PRESET_"+c,b);break;case "shuffleOn":this._clickKey("SHUFFLE_ON",b);break;case "shuffleOff":this._clickKey("SHUFFLE_OFF",b);break;case "toggleShuffle":this._getNowPlaying(function(a,c){if(a)b&&b(a);else if(c&&c.shuffleSetting){var e="SHUFFLE_ON";"SHUFFLE_ON"==c.shuffleSetting&&(e="SHUFFLE_OFF");d._clickKey(e,b)}else b&&b(Error("no shuffle setting"))});break;case "setRepeatMode":if(!c){b&&
b(Error("play mode value invalid"));break}this._clickKey(c,b);break;case "addFav":this._clickKey("ADD_FAVORITE",b);break;case "removeFav":this._clickKey("REMOVE_FAVORITE",b);break;case "bassUp":case "bassDown":if("undefined"==typeof c||null==c){b&&b(Error("seek value invalid"));break}this._getBass(function(c,g){if(c)b&&b(c);else if(g&&"undefined"!=typeof g.actualbass&&null!=g.actualbass){var f=g.actualbass;"bassUp"==a?f+=1:--f;if(this.bass&&(e=this.bass.indexOf("-",1),-1!=e)){var l=this.bass.substring(0,
e),m=this.bass.substr(e+1),l=parseInt(l),m=parseInt(m);f<l&&(f=l);f>m&&(f=m)}d._setBass(f,b)}else b&&b(Error("no bass info"))});break;case "setBass":if("undefined"==typeof c||null==c){b&&b(Error("volume value invalid"));break}c=parseInt(c);if(this.bass&&(e=this.bass.indexOf("-",1),-1!=e)){var g=this.bass.substring(0,e),f=this.bass.substr(e+1),g=parseInt(g),f=parseInt(f);c<g&&(c=g);c>f&&(c=f)}this._setBass(c,b);break;default:a&&"select:"==a.substr(0,7)?(g=a.substr(7),e=g.indexOf("@"),c=g.substring(0,
e),g=g.substr(e+1),d._setSource(c,g,b)):b&&b(Error("unknown command"))}}else b&&b(Error("renderer not initialized"))};f.prototype._getStates=function(a){var c=function(){d--;0==d&&a&&a(null,b)},b={},d=3;this._getBass(function(a,d){!a&&d&&(b.bass=d.actualbass);c()});this._getVolume(function(a,d){!a&&d&&(b.volume=d.actualvolume,b.muted=d.muteenabled);c()});this._getNowPlaying(function(a,d){!a&&d&&(b.power="STANDBY"==d.source?"off":"on",d.repeatSetting&&(b.repeatMode=d.repeatSetting),d.shuffleSetting&&
(b.shuffleMode=d.shuffleSetting),d.playStatus&&(b.playState=d.playStatus),d.duration&&(b.durationS=d.duration),d.position&&(b.positionS=d.position),d.position&&(b.positionS=d.position),d.track&&(b.title=d.track),d.stationName&&(b.radio=d.stationName),d.artist&&(b.artist=d.artist),d.album&&(b.album=d.album));c()})};f.prototype._getRenderer=function(a,c,b,d,e){var f=require("xnm.aio.upnp.js");if(f.discovery&&f.discovery._player&&(f=f.discovery._player[b])&&f._renderer)return f._renderer;f=new (require("x.upnp.js").MediaRenderer);
f.init(a,c,b,{avTransport:d,renderingControl:e});return f};f.prototype._clickKey=function(a,c){var b=this;this._pressKey(a,function(d){d?c&&c(d):b._releaseKey(a,function(a){c&&c(a)})})};f.prototype._getInfo=function(a){var c=this;this._sendRequest("GET","/info",null,function(b,d){if(b)a&&a(b);else{var e=d.find("info");e&&e[0]?(e=$(e[0]),c.mac=e.attr("deviceID"),(e=e.find("name"))&&e[0]&&(c.name=$(e[0]).text()),a&&a(null,{name:c.name,mac:c.mac})):a&&a(Error("get info xml invalid"))}})};f.prototype._pressKey=
function(a,c){this._sendRequest("POST","/key",'<key state="press" sender="Gabbo">'+a+"</key>",c)};f.prototype._releaseKey=function(a,c){this._sendRequest("POST","/key",'<key state="release" sender="Gabbo">'+a+"</key>",c)};f.prototype._getSources=function(a){var c=this;this._sendRequest("GET","/sources",null,function(b,d){if(b)a&&a(b);else{var e=[];d.find("sourceItem").each(function(){var a=$(this);e.push({source:a.attr("source"),sourceAccount:a.attr("sourceAccount")?a.attr("sourceAccount"):null,isLocal:a.attr("isLocal"),
name:a.text()?a.text():null})});c.sources=e;a&&a(null,e)}})};f.prototype._setSource=function(a,c,b){a='<ContentItem source="'+a+'"';c&&(a+=' sourceAccount="'+c+'"');this._sendRequest("POST","/select",a+"></ContentItem>",b)};f.prototype._setBass=function(a,c){this._sendRequest("POST","/bass","<bass>"+a+"</bass>",c)};f.prototype._getBass=function(a){this._sendRequest("GET","/bass",null,function(c,b){if(c)a&&a(c);else{var d={},e=b.find("targetbass");e&&e[0]&&(d.targetbass=parseInt($(e[0]).text()));(e=
b.find("actualbass"))&&e[0]&&(d.actualbass=parseInt($(e[0]).text()));a&&a(c,d)}})};f.prototype._getBassCap=function(a){var c=this;this._sendRequest("GET","/bassCapabilities",null,function(b,d){if(b)a&&a(b);else{var e=d.find("bassAvailable");if(e&&e[0])if((e=$(e[0]).text())&&"false"!=e.toLowerCase()){var e=0,f=d.find("bassMin");f&&f[0]&&(e=$(f[0]).text());var f=100,l=d.find("bassMax");l&&l[0]&&(f=$(l[0]).text());c.bass=e+"-"+f;a&&a(null,{bass:c.bass})}else a&&a(null,null);else a&&a(Error("get bass cap xml invalid"))}})};
f.prototype._getZone=function(a){this._sendRequest("GET","/getZone",null,function(c,b){if(c)a&&a(c);else{var d={},e=b.find("zone");if(e&&e[0]){var f=$(e[0]).attr("master");if(!f){a&&a(null,d);return}d.master=f}$(e[0]).find("member").each(function(){var a=$(this),b=a.attr("ipaddress"),a=a.text();b&&a&&(d.members||(d.members={}),d.members[a]=b)});a&&a(null,d)}})};f.prototype._setZone=function(a,c,b){a='<zone master="'+a+'" senderIPAddress="0.0.0.0">';for(var d in c)c.hasOwnProperty(d)&&c[d]&&(a+='<member ipaddress="'+
c[d]+'">'+d+"</member>");this._sendRequest("POST","/setZone",a+"</zone>",b)};f.prototype._getVolume=function(a){this._sendRequest("GET","/volume",null,function(c,b){if(c)a&&a(c);else{var d={},e=b.find("targetvolume");e&&e[0]&&(d.targetvolume=parseInt($(e[0]).text()));(e=b.find("actualvolume"))&&e[0]&&(d.actualvolume=parseInt($(e[0]).text()));(e=b.find("muteenabled"))&&e[0]&&(d.muteenabled=$(e[0]).text());a&&a(c,d)}})};f.prototype._setVolume=function(a,c){this._sendRequest("POST","/volume","<volume>"+
a+"</volume>",c)};f.prototype._getNowPlaying=function(a){this._sendRequest("GET","/now_playing",null,function(c,b){if(c)a&&a(c);else{var d={},e=b.find("nowPlaying");if(e&&e[0])var f=$(e[0]).getAttributes(),d=JSON.parse(JSON.stringify(f));(e=b.find("ContentItem"))&&e[0]&&(f=$(e[0]).getAttributes(),d.content=JSON.parse(JSON.stringify(f)),(e=$(e[0]).find("itemName"))&&e[0]&&(d.content.itemName=$(e[0]).text()));(e=b.find("track"))&&e[0]&&(d.track=$(e[0]).text());(e=b.find("artist"))&&e[0]&&(d.artist=
$(e[0]).text());(e=b.find("album"))&&e[0]&&(d.album=$(e[0]).text());(e=b.find("stationName"))&&e[0]&&(d.stationName=$(e[0]).text());(e=b.find("art"))&&e[0]&&(d.artImageStatus=$(e[0]).attr("artImageStatus"),d.art=$(e[0]).text());(e=b.find("playStatus"))&&e[0]&&(d.playStatus=$(e[0]).text());(e=b.find("description"))&&e[0]&&(d.description=$(e[0]).text());(e=b.find("stationLocation"))&&e[0]&&(d.description=$(e[0]).text());(e=b.find("time"))&&e[0]&&(d.duration=$(e[0]).attr("total"),d.position=$(e[0]).text());
(e=b.find("shuffleSetting"))&&e[0]&&(d.shuffleSetting=$(e[0]).text());(e=b.find("repeatSetting"))&&e[0]&&(d.repeatSetting=$(e[0]).text());a&&a(null,d)}})};f.prototype._sendRequest=function(a,c,b,d){this._doRequest(this.getIP(),8090,a,c,b,function(a,b){if(a)d&&d(a);else try{var c=$($.parseXML(b)),f=c.find("error");if(f&&f[0]){var k=$(f[0]),n=k.text(),p=k.attr("name");d&&d(Error(n+":"+p))}else d&&d(null,c)}catch(m){d&&d(m)}})};f.prototype._doRequest=function(a,c,b,d,e,f){var l=this;a="http://"+a+":"+
c+d;this._logger.log("trace","send "+b+" to url:"+a);e&&this._logger.log("trace","with data "+e);var h=f;f={url:a,type:b,timeout:2E3,contentType:"text/xml",dataType:"text",cache:!0,success:function(a){l._logger.log("trace","http request success:"+a);h&&(h(null,a),h=null)},error:function(a,b){var c="http request error:"+(a?a.status:"0")+"-"+b;l._logger.log("trace",c);h&&(h(Error(c)),h=null)}};"post"==b.toLowerCase()&&e&&(f.data=e);$.ajax(f)};f.prototype.toJSON=function(){return{sys:"upnp",ip:this.getIP(),
port:this.getPort(),uuid:this.getUUID(),name:this._renderer?this._renderer.name:null,model:this._renderer?this._renderer.modelName:null,modelDescription:this._renderer?this._renderer.modelDescription:null,manufacturer:this._renderer?this._renderer.manufacturer:null,avTransport:this._renderer?this._renderer.avTransport:null,renderingControl:this._renderer?this._renderer.renderingControl:null,connectionManager:this._renderer?this._renderer.connectionManager:null}};f.prototype.equalsTo=function(a){return a&&
a instanceof SoundTouch?this.getIP()==a.getIP()&&this.getPort()==a.getPort():!1};return f}();xnm.aio.upnp.InMemoryPlayList=function(){return function(){}}();
xnm.aio.upnp.Discovery=function(){var f=function(){"undefined"!=typeof require&&require?(this._logger=require("x.logger.js").getLogger("xnm.aio.bose.Discovery"),require("x.logger.js").setLevel("info","xnm.aio.bose.Discovery")):this._logger={log:{}};this._upnpCB=null;this._mediaServer={};this._player={};this._searchCB=[];this._autoSearchTimeout=null;this.search(null)};f.prototype.getBufferedPlayer=function(a){return this._player[a]};f.prototype.getBufferedPlayers=function(){var a=[],c;for(c in this._player)this._player.hasOwnProperty(c)&&
a.push(this._player[c]);return a};f.prototype.getBufferedMediaServers=function(){var a=[],c;for(c in this._mediaServer)this._mediaServer.hasOwnProperty(c)&&a.push(this._mediaServer[c]);return a};f.prototype.search=function(a){var c=this._searchCB.length;a&&-1==this._searchCB.indexOf(a)&&this._searchCB.push(a);if(0==c){this._autoSearchTimeout&&(clearTimeout(this._autoSearchTimeout),this._autoSearchTimeout=null);this._search();var b=this;setTimeout(function(){b._autoSearchTimeout=setTimeout(function(){b._logger.log("trace",
"auto search timeout, search again");b.search(null)},6E4);var a=b._searchCB;b._searchCB=[];a.forEach(function(a){a&&a()})},5E3)}};f.prototype._search=function(){if(!this._upnpCB){var a=this;this._upnpCB=function(b){a._findUpnpDevice(b)}}this._mediaServer={};this._player={};var c=require("x.upnp.js").getDiscoveryService();c.addCallback("upnp:rootdevice",this._upnpCB);c.discoverTarget("upnp:rootdevice")};f.prototype._findUpnpDevice=function(a){if(a){var c=a.uuid;switch(a.deviceType){case "urn:schemas-upnp-org:device:MediaServer:1":this._logger.log("trace",
"find media server:"+a.name+" @"+a.ip);this._mediaServer[c]=a;break;case "urn:schemas-upnp-org:device:MediaRenderer:1":this._logger.log("trace","find media renderer:"+a.name+" @"+a.ip);var b=new xnm.aio.upnp.Player;b._renderer=a;this._player[c]=b}}};return f}();
xnm.aio.upnp.DM=function(){var f={command:[{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"paly/pause",ref:{value:"tooglePlay"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"toggle power",ref:{value:"togglePower"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},
{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"set volume",ref:{value:"setVolume",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"thumb up",ref:{value:"thumbUp"}},{type:"enum",name:"thumb down",ref:{value:"thumbDown"}},{type:"enum",name:"bookmark",ref:{value:"bookmark"}},{type:"enum",name:"preset",ref:{value:"preset",ext:"%e",extMeta:"123456".split("")}},{type:"enum",name:"shuffle on",ref:{value:"shuffleOn"}},{type:"enum",name:"shuffle off",ref:{value:"shuffleOff"}},{type:"enum",
name:"toggle shuffle",ref:{value:"toggleShuffle"}},{type:"enum",name:"set repeat mode",ref:{value:"setRepeatMode",ext:"%e",extMeta:["REPEAT_OFF","REPEAT_ONE","REPEAT_ALL"]}},{type:"enum",name:"add to favorite",ref:{value:"addFav"}},{type:"enum",name:"remove from favorite",ref:{value:"removeFav"}}],status:[{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"muted",ref:{value:"muted",options:["true","false"]}},{type:"int",name:"volume",ref:{value:"volume",extMeta:"0-100"}},
{type:"enum",name:"repeat mode",ref:{value:"repeatMode",options:["REPEAT_OFF","REPEAT_ONE","REPEAT_ALL"]}},{type:"enum",name:"shuffle mode",ref:{value:"shuffleMode",options:["SHUFFLE_ON","SHUFFLE_OFF"]}},{type:"string",name:"play state",ref:{value:"playState",options:["PLAY_STATE","PAUSE_STATE","STOP_STATE","BUFFERING_STATE","INVALID_PLAY_STATUS"]}},{type:"int",name:"track duration (seconds)",ref:{value:"durationS"}},{type:"int",name:"track position (seconds)",ref:{value:"positionS"}},{type:"string",
name:"radio station",ref:{value:"radio"}},{type:"string",name:"artist",ref:{value:"artist"}},{type:"string",name:"title",ref:{value:"title"}},{type:"string",name:"album",ref:{value:"album"}}]},a=function(a,b){this.code=a;this.message=b;this.stack=Error().stack};a.prototype=Error();a.prototype.name="UpnpDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"upnp",getIPDeviceType:function(){return[{sys:this.SYS,name:"UPnP/DLNA Player"}]},
createDevice:function(c,b,d){b=a.ERROR_CODE;c?c.type?c.ip?c.port?c.uuid?d(null,c):d(new a(b.INVALID,"uuid is invalid")):d(new a(b.INVALID,"port is invalid")):d(new a(b.INVALID,"ip is invalid")):d(new a(b.INVALID,"type is invalid")):d(new a(b.INVALID,"info is invalid"))},updateDevice:function(c,b,d){b=a.ERROR_CODE;c?c.type?c.ip?c.port?c.uuid?d(null,c):d(new a(b.INVALID,"uuid is invalid")):d(new a(b.INVALID,"port is invalid")):d(new a(b.INVALID,"ip is invalid")):d(new a(b.INVALID,"type is invalid")):
d(new a(b.INVALID,"info is invalid"))},deleteDevice:function(a,b,d){d()},applyUIFilter:function(a,b,d){var e=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},f=function(a,b,c){var d=[];switch(c.catagory){case "command":a.command&&a.command.forEach(function(a){e(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))});break;case "status":a.status&&a.status.forEach(function(a){e(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))})}return d},
l=function(a,b){var c=[],e=null;if(e=xnm.aio.bose.DM.getCommandStatusMap(a,d))e=f(e,a,b),c=c.concat(e);return c};if(!a.sys)return null;var h=JSON.parse(JSON.stringify(a)),k=null;switch(b.catagory){case "command":k=l(a,b);h.command=k;break;case "status":k=l(a,b);h.status=k;break;default:return null}return k&&0!=k.length?h:null},getCommandStatusMap:function(a,b){var d=JSON.parse(JSON.stringify(f));a&&a.bass&&(d.command.push({type:"enum",name:"bass up",ref:{value:"bassUp"}}),d.command.push({type:"enum",
name:"bass down",ref:{value:"bassDown"}}),d.command.push({type:"int",name:"set bass",ref:{value:"setBass",ext:"%d",extMeta:a.bass}}),d.status.push({type:"int",name:"bass",ref:{value:"bass",extMeta:a.bass}}));a&&a.sources&&a.sources.forEach(function(a){if(a&&"true"==a.isLocal){var b=a.source;a.name&&(b=a.name);var c=a.sourceAccount?a.sourceAccount:"";a.source&&d.command.push({type:"enum",name:"select "+b,ref:{value:"select:"+a.source+"@"+c}})}});return d}}}();
xnm.aio.upnp.Handler=function(){var f=function(){this.discovery=new xnm.aio.upnp.Discovery};f.prototype.devicemanager=xnm.aio.upnp.DM;f.prototype.Player=xnm.aio.upnp.Player;f.prototype.registModule=function(a){a.register(xnm.aio.upnp.DM.SYS,"upnp")};f.prototype.resolveDevice=function(a){if(!a)return null;var c=null;a.uuid&&(c=this.discovery.getBufferedPlayer(a));return c?c:a.ip&&a.port&&a.uuid&&a.avTransport&&a.renderingControl?new xnm.aio.upnp.Player(a):null};f.prototype.getDeviceCommands=function(a,
c){var b=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}),b=b?b.command:[];c&&c(null,b)};f.prototype.getDeviceStatus=function(a,c){var b=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}),b=b?b.status:[];c&&c(null,b)};f.prototype.doCommand=function(a,c,b){var d=this.resolveDevice(a);d?d.executeCommandCreator(a,c,function(a){b&&b(a)}):b&&b(Error("device json format invalid"))};f.prototype.doStatus=function(a,c,b,d){var e=this.resolveDevice(c);e?e.getStatesCreator(null,
[{id:a,device:c,status:b}],function(a,b){a?d&&d(a):d&&d(null,b[0])}):d&&d(Error("device json format invalid"))};f.prototype.discover=function(a){var c=this;this.discovery.search(function(){a&&a(null,c.discovery.getBufferedPlayers())})};f.prototype.getPlayer=function(a,c){if(a&&a.uuid){var b=this.discovery.getBufferedPlayer(a.uuid);if(b)c&&c(null,b);else{var d=this;this.discovery.search(function(){b=d.discovery.getBufferedPlayer(a.uuid);c&&c(null,b)})}}else c&&c(Error("device json invalid"))};f.prototype.getMediaServer=
function(a){var c=this.discovery.getBufferedMediaServers();if(0==c.length){var b=this;this.discovery.search(function(){a&&a(null,b.discovery.getBufferedMediaServers())})}else a&&a(null,c)};return f}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.upnp.Handler);
