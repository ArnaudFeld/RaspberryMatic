var Logger=require("x.logger.js"),x=x||{};x.EventEmitter=function(){this._events=this._events||{};this._maxListeners=this._maxListeners||x.EventEmitter.defaultMaxListeners};x.EventEmitter._logger=Logger.getLogger("x.EventEmitter");x.EventEmitter.defaultMaxListeners=10;x.EventEmitter.prototype.setMaxListeners=function(a){if("number"!==typeof a||0>a||isNaN(a))throw new TypeError("n must be a positive number");this._maxListeners=a};
x.EventEmitter.prototype.emit=function(a){var b,c,e,d;this._events||(this._events={});if("error"===a&&(!this._events.error||"object"===typeof this._events.error&&!this._events.error.length)){b=arguments[1];if(b instanceof Error)throw b;throw new TypeError('Uncaught, unspecified "error" event.');}c=this._events[a];if("undefined"===typeof c)return!1;if("function"===typeof c)switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);
break;default:b=arguments.length;e=Array(b-1);for(d=1;d<b;d++)e[d-1]=arguments[d];c.apply(this,e)}else if("object"===typeof c){b=arguments.length;e=Array(b-1);for(d=1;d<b;d++)e[d-1]=arguments[d];c=c.slice();b=c.length;for(d=0;d<b;d++)c[d].apply(this,e)}return!0};
x.EventEmitter.prototype.addListener=function(a,b){var c;if("function"!==typeof b)throw new TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",a,"function"===typeof b.listener?b.listener:b);this._events[a]?"object"===typeof this._events[a]?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b;"object"!==typeof this._events[a]||this._events[a].warned||(c=this._maxListeners)&&0<c&&this._events[a].length>
c&&(this._events[a].warned=!0,x.EventEmitter._logger.log("warn",Error("(node) warning: possible EventEmitter memory leak detected. "+this._events[a].length+" listeners added. Use emitter.setMaxListeners() to increase limit.").stack));return this};x.EventEmitter.prototype.on=x.EventEmitter.prototype.addListener;
x.EventEmitter.prototype.once=function(a,b){function c(){this.removeListener(a,c);e||(e=!0,b.apply(this,arguments))}if("function"!==typeof b)throw new TypeError("listener must be a function");var e=!1;c.listener=b;this.on(a,c);return this};
x.EventEmitter.prototype.removeListener=function(a,b){var c,e,d;if("function"!==typeof b)throw new TypeError("listener must be a function");if(!this._events||!this._events[a])return this;c=this._events[a];d=c.length;e=-1;if(c===b||"function"===typeof c.listener&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if("object"===typeof c){for(;0<d--;)if(c[d]===b||c[d].listener&&c[d].listener===b){e=d;break}if(0>e)return this;1===c.length?(c.length=
0,delete this._events[a]):c.splice(e,1);this._events.removeListener&&this.emit("removeListener",a,b)}return this};
x.EventEmitter.prototype.removeAllListeners=function(a){var b;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);this.removeAllListeners("removeListener");this._events={};return this}b=this._events[a];if("function"===typeof b)this.removeListener(a,b);else if(Array.isArray(b))for(;b.length;)this.removeListener(a,
b[b.length-1]);delete this._events[a];return this};x.EventEmitter.prototype.listeners=function(a){return this._events&&this._events[a]?"function"===typeof this._events[a]?[this._events[a]]:this._events[a].slice():[]};x.EventEmitter.listenerCount=function(a,b){return a._events&&a._events[b]?"function"===typeof a._events[b]?1:a._events[b].length:0};exports&&(exports.EventEmitter=x.EventEmitter);
