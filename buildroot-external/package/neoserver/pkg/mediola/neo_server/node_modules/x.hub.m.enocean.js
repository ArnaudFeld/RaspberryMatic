var util=require("util"),EventEmitter=require("events"),crypto=require("crypto"),fs_extra=require("fs-extra"),fileman=require("x.hub.fileman.js");require("x.logger.js").setLevel("trace","x.hub.m.enocean");var x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.enocean=x.hub.m.enocean||{};x.hub.m.enocean.SENDER_ID=null;x.hub.m.enocean.MANUFACTURE_ID=2047;
x.hub.m.enocean._CRC8Table=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,
149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];
x.hub.m.enocean.CRC8=function(g){for(var a=0,d=0;d<g.length;d++)a=x.hub.m.enocean._CRC8Table[a^g[d]];return a};
x.hub.m.enocean.Serial=function(){var g=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Serial");this._port=a;this._serialPort=null};g.prototype.getPort=function(){return this._port};g.prototype.setListener=function(a){this._listener=a};g.prototype.open=function(a){if(this._serialPort)this._logger.log("warn","port:"+this._port+" already opened"),a&&a();else{var d=a;try{this._logger.log("trace","try to listen to port:"+this._port);var f=require("serialport");if(f){var b=
new f.SerialPort(this._port,{baudrate:57600}),h=this;b.on("open",function(){h._logger.log("trace","port:"+h._port+" opened");h._serialPort=b;b.flush();d&&d();d=null});b.on("error",function(b){h._logger.log("warn","enocean error:"+b.message);h._serialPort=null;if(d)d&&d(b),d=null;else if(h._listener&&h._listener.onSerialError)h._listener.onSerialError(b)});b.on("data",function(b){h._logger.log("trace","receive data "+b.toString("hex"));if(h._listener&&h._listener.onSerialData)h._listener.onSerialData(b)})}else this._logger.log("warn",
"no seiralport module"),a&&a(Error("no seiralport modul"))}catch(k){this._logger.log("warn","init enocean via "+this._port+" error:"+k.message),d&&d(k),d=null}}};g.prototype.close=function(){this._listener=null;try{this._serialPort&&this._serialPort.close()}catch(a){this._logger.log("warn","close enocean via "+this._port+" error:"+a.message)}this._serialPort=null};g.prototype.sendPacket=function(a,d){this._serialPort?this._serialPort.write(a,d):d&&d(Error("port not opened"))};return g}();
x.hub.m.enocean.ReComm=function(){var g=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ReComm");this._esp3=a};g.prototype.sendRawSysEx=function(a,d,f,b){var h=this;a=new x.hub.m.enocean.ESP3.Telegram.ADT(197,a,d,f);this._esp3.sendTelegram(a,!0,function(d,a){setTimeout(function(){d?(h._logger.log("warn","ReComm command failed with err:"+d.message),b&&b(d)):a&&0!=a.retCode?(h._logger.log("warn","ReComm command failed with retCode:"+a.retCode),d=Error("ReComm command failed:"+
a.retCode),d.code=a.retCode,b&&b(d,a)):b&&b(null,a)},50)})};return g}();
x.hub.m.enocean.SecurityHandler=function(){var g=new Buffer("3410de8f1aba3eff9f5a117172eacabd","hex"),a=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SecurityHandler");this._secInfo={};this._unsync={}};a.prototype.SECURITY_FILE="enocean_sec.json";a.prototype.init=function(d){this._logger.log("trace","init");var a=this;this._loadSec(function(b,h){b&&a._logger.log("warn","init error:"+b.message);h&&(a._secInfo=h);d&&d()})};a.prototype.getUnsyncDevice=function(){return this._unsync};
a.prototype.secureTeachIn=function(d,a,b){this._logger.log("trace","secure teach-in:"+d);d&&(a.key&&delete a.key,this._secInfo[d]=a);this._saveSec(this._secInfo,b)};a.prototype.resolve=function(d){if(!d)return null;switch(d.rorg){case 53:return this._resolveSecureTeachIn(d);case 49:return this._resolveSecureMessage(d);default:return null}};a.prototype._resolveSecureTeachIn=function(d){var a={};d=d.userData;var b=d.readUInt8(0);a.teachInInfo={};a.teachInInfo.idx=b>>6&3;a.teachInInfo.cnt=b>>4&3;a.teachInInfo.psk=
b>>3&1;a.teachInInfo.type=b>>2&1;a.teachInInfo.info=b&3;0==a.teachInInfo.idx?(b=d.readUInt8(1),a.slf={},a.slf.rlc_algo=b>>6&3,a.slf.rlc_tx=b>>5&1,a.slf.mac_alro=b>>3&3,a.slf.data_enc=b&7,b=0,1==a.slf.rlc_algo?b=2:2==a.slf.rlc_algo&&(b=3),b&&(a.rlc=d.slice(2,2+b)),a.key=d.slice(2+b),a.completeKey=null):a.key=d.slice(1);return a};a.prototype._resolveSecureMessage=function(a){var f=a.senderID,b=this._secInfo[f];if(!b||!b.completeKey)return null;var h=0,k=0;1==b.slf.mac_alro?h=3:2==b.slf.mac_alro&&(h=
4);1==b.slf.rlc_tx&&(1==b.slf.rlc_algo?k=2:2==b.slf.rlc_algo&&(k=3));var l=a.userData.length-h-k,m=a.userData.slice(0,l),n=null;k&&a.userData.slice(l,l+k);h&&(n=a.userData.slice(l+k));h=b.rlc;k=!1;k=!0;n&&(n=this.checkCmac(a.rorg,m,h,b.completeKey,n),n.rlc&&h.toString("hex")!=n.rlc.toString("hex")&&(h=n.rlc,b.rlc=n.rlc),n&&n.ok?(this._logger.log("trace","receive from "+f+" with cmac rlc:"+h.toString("hex")),delete this._unsync[f]):(k=!1,this._logger.log("warn","receive from "+f+" with cmac out of snyc, last rlc:"+
h.toString("hex")),this._unsync[f]=h.toString("hex")));f=null;k&&3==b.slf.data_enc&&(m=this.decryptVAES(h,g,b.completeKey,m),f=a.convertToPacket(m).toRadioTelegram());b.rlc=this._incRLC(h);k=!0;this._logger.log("trace","senderID next rlc:"+b.rlc.toString("hex"));k&&this._saveSec(this._secInfo);return f};a.prototype.decryptVAES=function(a,f,b,h){for(var k=h.length,l=Math.ceil(k/16),g=[],n=null,q=0;q<l;q++){var t=16*q,A=t+16;A>k&&(A=k);t=h.slice(t,A);n=this._doVAESblock(a,f,b,n,t);g.push(n.data);n=
n.enc}return Buffer.concat(g)};a.prototype._doVAESblock=function(a,f,b,h,k){a=this._xor(a,f);h&&(a=this._xor(a,h));b=this._doAES128(b,null,a);h=this._xor(b,k);h=h.slice(0,k.length);return{data:h,enc:b}};a.prototype.checkCmac=function(a,f,b,h,k){var g;if(b){for(var m=this._bufToInt(b),n=0;128>n;n++)if(0!=n&&(m+=1,g=65535,3==b.length&&(g=16777215),m>g&&(m=0)),g=this._intToBuf(m,b.length),g=this.calcCmac(a,f,g,h,k.length),g.toString("hex")==k.toString("hex"))return{ok:!0,rlc:this._intToBuf(m,b.length)};
return{ok:!1,rlc:this._intToBuf(m,b.length)}}g=this.calcCmac(a,f,null,h,k.length);return g.toString("hex")==k.toString("hex")?{ok:!0}:{ok:!1}};a.prototype.calcCmac=function(a,f,b,h,k){var g=this._getCmacSubkey(h),m=new Buffer(1);m.writeUInt8(a);m=Buffer.concat([m,f]);b&&(m=Buffer.concat([m,b]));a=m.length;f=Math.ceil(a/16);var n;b=null;for(var q=0;q<f;q++){n=16*q;var t=n+16;t>a&&(t=a);n=m.slice(n,t);b=n=this._doCmacBlock(h,g.k1,g.k2,n,b)}return n.slice(0,k)};a.prototype._doCmacBlock=function(a,f,
b,h,k){for(var g=new Buffer(16),m=0;16>m;m++)m<h.length?g.writeUInt8(h.readUInt8(m),m):m==h.length?g.writeUInt8(128,m):g.writeUInt8(0,m);k&&(g=this._xor(g,k));g=16>h.length?this._xor(g,b):this._xor(g,f);return this._doAES128(a,null,g)};a.prototype._getCmacSubkey=function(a){var f;f=new Buffer("00000000000000000000000000000000","hex");var b=new Buffer("00000000000000000000000000000087","hex");f=this._doAES128(a,null,f);a=new Buffer(f.toString("hex"),"hex");this._bufShiftLeft(a,1);f.readUInt8(0)&128&&
(a=this._xor(a,b));f=new Buffer(a.toString("hex"),"hex");this._bufShiftLeft(f,1);a.readUInt8(0)&128&&(f=this._xor(f,b));return{k1:a,k2:f}};a.prototype._doAES128=function(a,f,b){f||(f=new Buffer("00000000000000000000000000000000","hex"));a=crypto.createCipheriv("aes128",a,f);a.setAutoPadding(!1);b=a.update(b);a=a.final();return Buffer.concat([b,a])};a.prototype._xor=function(a,f){for(var b=Math.max(a.length,f.length),h=new Buffer(b),k=0;k<b;k++){var g=0,m=0;k<a.length&&(g=a.readUInt8(k));k<f.length&&
(m=f.readUInt8(k));h.writeUInt8(g^m,k)}return h};a.prototype._bufShiftLeft=function(a,f){if(f!==(f|0))throw Error("shiftBits must be a 32 bit int");for(var b=2*((f>>4)+(0!==(f&15))),h=8*b-f,k=0,g=0;g-b<a.length;g+=2)if(k<<=16,g<a.length-1?k|=a.readUInt16BE(g):g<a.length&&(k|=a[g]<<8),0<=g-b)if(g-b<a.length-1)a.writeUInt16BE(k>>>h&65535,g-b);else{if(g-b!==a.length-1)throw Error();a[g-b]=k>>>h+8}else-1===g-b&&(a[0]=k>>>h)};a.prototype._bufToInt=function(a){for(var f=0,b=0;b<a.length;b++)var h=a.readUInt8(b),
f=(f<<8*b)+h;return f};a.prototype._intToBuf=function(a,f){for(var b=a.toString(16);b.length<2*f;)b="0"+b;return new Buffer(b,"hex")};a.prototype._incRLC=function(a){var f=this._bufToInt(a),f=f+1,b=65535;3==a.length&&(b=16777215);f>b&&(f=0);return this._intToBuf(f,a.length)};a.prototype._getFile=function(){var a=require("x.hub.fileman.js").fileManager,f=require("path");require("fs");a=a.getUserRootDataPath();return f.resolve(a,this.SECURITY_FILE)};a.prototype._loadSec=function(a){var f=this._getFile();
fs_extra.ensureFile(f,function(b){b?a&&a(b):fs_extra.readFile(f,"utf8",function(b,f){if(b)a&&a(b);else{var g;try{g=JSON.parse(f);for(var m in g)if(g.hasOwnProperty(m)){var n=g[m];n.rlc&&(n.rlc=new Buffer(n.rlc,"hex"));n.completeKey&&(n.completeKey=new Buffer(n.completeKey,"hex"))}}catch(q){}a&&a(null,g)}})})};a.prototype._saveSec=function(a,f){var b=this._getFile(),h={},k;for(k in a)h[k]={},h[k].teachInInfo=a[k].teachInInfo,h[k].slf=a[k].slf,h[k].rlc=a[k].rlc.toString("hex"),h[k].completeKey=a[k].completeKey.toString("hex");
fs_extra.writeFile(b,JSON.stringify(h,null,2),function(a){f&&f(a)})};return a}();
x.hub.m.enocean.LearnHandler=function(){var g=function(a){this._controller=a;this._learning=!1;this._saParams=this._learnVendor=this._learnSenderID=this._learnAddress=this._learnProfile=this._learnCallback=null;this._secTeachInFrames={};this._teaching=!1;this._teachingTO=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;var d=this;this._teachinTelegramCB={_onEOTelegram:function(a){d.onTeachInResponseTelegram(a)}}};g.prototype.learn=function(a,d,f,b,h,
k,g){if(this._learning)k&&k(Error("learning process running"));else if(this._teaching)k&&k(Error("teach-in process running"));else{if(!h||0>=h)h=3E4;this._learning=!0;this._learnCallback=k;this._learnProfile=a?a.toLowerCase():null;this._learnAddress=d?d.toLowerCase():null;this._learnVendor=b?b:"general";this._learnSenderID=f?f.toLowerCase():null;this._secTeachInFrames={};this._saParams=null;!a||"bb-aa-cc"!=a.toLowerCase()&&"d2-06-10"!=a.toLowerCase()||(this._saParams={extended:1},g&&"undefined"!=
typeof g.saLearnMode&&null!=g.saLearnMode&&(a=parseInt(g.saLearnMode),isNaN(a)&&(a=1),0>a&&(a=1),2<a&&(a=1),this._saParams.extended=a));var m=this;this._controller._esp3.startLearn(this,h,this._saParams,function(a){if(a){var b=m._learnCallback;m._learning=!1;m._learnProfile=null;m._learnCallback=null;m._secTeachInFrames={};b&&b(a)}})}};g.prototype.onLearnTimeout=function(){this._learnFinish(Error("learn timeout"))};g.prototype.onTelegram=function(a){if(a){if(this._learnProfile){var d=x.hub.m.enocean.profiles[this._learnProfile];
if(d&&(d=new d,d.handleLearnTelegram)){d.handleLearnTelegram(this,a);return}}switch(a.rorg){case 212:if(0==a.cmd){this._learnUTE(a);break}break;case 213:0==a.getLearnBit()&&this._learn1BS(a);break;case 165:0==a.getLearnBit()&&this._learn4BS(a);break;case 246:this._learnRPS(a);break;case 53:var f=this._controller._secHandler.resolve(a);a=a.senderID;d=this._secTeachInFrames[a];f&&(f.teachInInfo&&0==f.teachInInfo.idx?(d||(this._secTeachInFrames[a]=[],d=this._secTeachInFrames[a]),d.push(f)):f.teachInInfo&&
0!=f.teachInInfo.idx&&d&&d.push(f));if(d&&d[0]&&(f=d[0])&&f.teachInInfo){var b=f.teachInInfo.cnt;if(b&&d.length==b){if(1<b){for(var b=[],h=0;h<d.length;h++)b.push(d[h].key);f.completeKey=Buffer.concat(b)}else f.completeKey=f.key;this._controller._secHandler.secureTeachIn(a,f)}}}}};g.prototype.onEvent=function(a){if(a&&a instanceof x.hub.m.enocean.ESP3.Event.SA_CONFIRM_LEARN){var d=a.getEEP();if(!this._learnProfile||this._isLearningProfileEquals(d)){var f=this._learnProfile?this._learnProfile:d,b=
this,h,g=x.hub.m.enocean.profiles[f];g||(h=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,17),this._controller._esp3.sendResponse(h,function(a){b._learnFinish(Error("eep not supported"))}));var g=new g,l=a.getPMCandidateId();l||(l=g.UNIQUE_GATEWAY_SENDERID?this._controller._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID);d={address:a.getSAClientId(),data:f,vendor:this._learnVendor,senderID:l,hopCount:a.getHopCount(),saLearnMode:this._saParams?this._saParams.extended:
null,originalEEP:d};this._controller._deviceHandler.onLearnAddDeleteDevice(d,function(d,f,g){if(d)h=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,19),b._controller._esp3.sendResponse(h,function(a){b._learnFinish(a)});else{d=0;1==f&&(d=32);var k=128*(a.getHopCount()+1);h=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(k,d);b._controller._esp3.sendResponse(h,function(a){b._learnFinish(a,f,g)})}})}}};g.prototype.onTeachInResponseTelegram=function(a){if(a&&this._teaching){var d=
this;switch(a.rorg){case 165:if(0==a.getLearnBit()){var f=a.getFunc(),b=a.getType();this._toProfileStr(165,f,b);if(1==a.getLearnResult())this._controller._deviceHandler.onLearnDevice({address:this._teachID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},{address:a.senderID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},function(a,b){d._teachFinish(a,b)});else 0==a.getLearnResult()&&(a=this._controller._deviceHandler.getDevice(this._teachID),
d._teachFinish(null,a,1))}}}};g.prototype._learnRPS=function(a){var d=this._getRealProfile(this._learnProfile),f=this;d&&"f6"!=d.substr(0,2)||((d=this._learnProfile)||(d="f6-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:d,vendor:this._learnVendor},function(a,d){f._learnFinish(a,0,d)}))};g.prototype._learn1BS=function(a){var d=this,
f=this._getRealProfile(this._learnProfile);f&&"d5"!=f.substr(0,2)||((f=this._learnProfile)||(f="d5-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:f,vendor:this._learnVendor},function(a,f){d._learnFinish(a,0,f)}))};g.prototype._learn4BS=function(a){if(0==a.getLearnType())this._learn4BSV1(a);else{var d=a.getFunc(),f=a.getType(),d=this._toProfileStr(165,
d,f);(d=x.hub.m.enocean.profiles[d])&&(3==(new d).TEACH_IN_VARIATION?this._learn4BSV3(a):this._learn4BSV2(a))}};g.prototype._learn4BSV1=function(a){var d=this._getRealProfile(this._learnProfile);if(d){if("a5"!=d.substr(0,2))return;d=x.hub.m.enocean.profiles[this._learnProfile];if(!d||1!=(new d).TEACH_IN_VARIATION)return}var f=this;(d=this._learnProfile)||(d="a5-??-??");this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},
{address:a.senderID,senderID:this._learnSenderID,data:d,vendor:this._learnVendor},function(a,d){f._learnFinish(a,0,d)})};g.prototype._learn4BSV2=function(a){var d=a.getFunc(),f=a.getType(),d=this._toProfileStr(165,d,f);if(!this._learnProfile||this._isLearningProfileEquals(d))if(d=this._learnProfile?this._learnProfile:d,f=x.hub.m.enocean.profiles[d])if(3==(new f).TEACH_IN_VARIATION)this._learn4BSV3(a);else{var b=this;this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,
data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:d,vendor:this._learnVendor},function(a,d){b._learnFinish(a,0,d)})}};g.prototype._learn4BSV3=function(a){var d=a.getFunc(),f=a.getType(),d=this._toProfileStr(165,d,f);if(!this._learnProfile||this._isLearningProfileEquals(d)){var d=this._learnProfile?this._learnProfile:d,f=x.hub.m.enocean.profiles[d],b=this;if(f){var f=new f,h=b._learnSenderID;!h&&f.UNIQUE_GATEWAY_SENDERID&&(h=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId());
this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:h,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:h,data:d,vendor:this._learnVendor},function(d,f){d?b._send4BSResponse(null,1,0,a,function(){b._learnFinish(d,0,f)}):b._send4BSResponse(h,1,1,a,function(){b._learnFinish(null,0,f)})})}else this._send4BSResponse(null,0,0,a,function(){b._learnFinish(Error("eep not supported"))})}};g.prototype._send4BSResponse=function(a,d,f,b,h){a||(a=x.hub.m.enocean.SENDER_ID);
var g=b.getFunc(),l=b.getType();b.getManufacturerId();a=new x.hub.m.enocean.ESP3.Telegram.BS4(new Buffer([(g&63)<<2|l>>5&3,(l&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128|d<<6|f<<5|16]),a,0);a.setDstId(b.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){h&&h(a)})};g.prototype._learnUTE=function(a){var d=this._toProfileStr(a.eepRorg,a.eepFunc,a.eepType),f,b=this;if(!this._learnProfile||this._isLearningProfileEquals(d)){var d=this._learnProfile?this._learnProfile:
d,h=x.hub.m.enocean.profiles[d];if(h)switch(h=new h,(f=this._learnSenderID)||(f=h.UNIQUE_GATEWAY_SENDERID?require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID),d={address:a.senderID,data:d,vendor:this._learnVendor,senderID:f},a.subtype){case 0:this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},d,function(d,h){if(0==a.rspExpected){var g=0;d&&404==d.errorCode?
g=3:d||(g=1);b._sendUTEResponse(f,g,a,function(){b._learnFinish(d,0,h)})}else b._learnFinish(d,0,h)});break;case 1:this._controller._deviceHandler.deleteDevice(d,function(d,h){if(0==a.rspExpected){var g=0;d&&404==d.errorCode?g=3:d||(g=2);b._sendUTEResponse(f,g,a,function(){b._learnFinish(d,1,h)})}else b._learnFinish(d,1,h)});break;case 2:this._controller._deviceHandler.onLearnAddDeleteDevice(d,function(d,h,g){if(0==a.rspExpected){var n=0;d&&404==d.errorCode?n=3:d||(0==h?n=1:1==h&&(n=2));b._sendUTEResponse(f,
n,a,function(){b._learnFinish(d,h,g)})}else b._learnFinish(d,h,g)})}}};g.prototype._sendUTEResponse=function(a,d,f,b){a||(a=x.hub.m.enocean.SENDER_ID);a=new x.hub.m.enocean.ESP3.Telegram.UTE(1,f.ute,0,d,f.numChannel,f.manufactureID,f.eepType,f.eepFunc,f.eepRorg,a,0);a.setDstId(f.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){b&&b(a)})};g.prototype._learnFinish=function(a,d,f){var b=this._learnCallback;this._learning=!1;this._learnVendor=this._learnSenderID=this._learnAddress=this._learnProfile=
this._learnCallback=null;this._secTeachInFrames={};var h=this._saParams;this._saParams=null;this._controller._esp3.stopLearn(this,h,function(){});b&&b(a,d,f);!a&&0==d&&f&&f.init&&setTimeout(function(){f.init()},1E3)};g.prototype._toProfileStr=function(a,d,f){for(a=a.toString(16);2>a.length;)a="0"+a;for(d=d.toString(16);2>d.length;)d="0"+d;for(f=f.toString(16);2>f.length;)f="0"+f;return(a+"-"+d+"-"+f).toLowerCase()};g.prototype._fromProfileStr=function(a){a=a.split("-");return{rorg:parseInt(a[0],16),
func:parseInt(a[1],16),type:parseInt(a[2],16)}};g.prototype._getRealProfile=function(a){if(!a)return null;var d=x.hub.m.enocean.profiles[a];if(!d)return a;d=new d;return d._eepAlias?d._eepAlias:a};g.prototype._isLearningProfileEquals=function(a){if(!this._learnProfile)return!1;if(this._learnProfile==a||"bb-aa-cc"==this._learnProfile&&"d2-06-10"==a||"d2-06-10"==this._learnProfile&&"bb-aa-cc"==a)return!0;var d=x.hub.m.enocean.profiles[this._learnProfile];return d?(new d)._eepAlias==a:!1};g.prototype.teachin=
function(a,d,f,b,h){if(this._teaching)h&&h(Error("teach-in process running"));else if(this._learning)h&&h(Error("learning process running"));else if(a){a=a.toLowerCase();d||(d=this._controller._deviceHandler.getNextFreeAddress());var g=this;this._teachCallback=h;this._teachProfile=a;this._teachID=d;this._teachSenderID=f;this._teachVendor=b?b:"general";this._teaching=!0;this._teachingTO=setTimeout(function(){g._teachFinish(Error("teach-in timeout"))},3E4);var l;b=a;if(h=x.hub.m.enocean.profiles[b])h=
new h,h.getTeachinType&&(l=h.getTeachinType()),h.isTeachinBidirectional&&h.isTeachinBidirectional();!l&&(b=this._getRealProfile(b),h=x.hub.m.enocean.profiles[b])&&(h=new h,h.getTeachinType&&(l=h.getTeachinType()),h.isTeachinBidirectional&&h.isTeachinBidirectional());if(!l)switch(b.substr(0,2)){case "f6":l="RPS";break;case "d5":l="1BS";break;case "a5":l="4BS"}switch(l){case "RPS":this._teachinRPS(a,d,f);break;case "1BS":this._teachin1BS(a,d,f);break;case "4BS":this._teachin4BS(a,d,f);break;default:this._teachFinish(Error("profile not supported"))}}else h&&
h(Error("profile is null"))};g.prototype._teachinRPS=function(a,d,f){this._teachFinish(Error("RPS teach-in should be done by execute command directly"))};g.prototype._teachin1BS=function(a,d,f){};g.prototype._teachin4BS=function(a,d,f){var b=2,h=x.hub.m.enocean.profiles[a];if(h)b=(new h).TEACH_IN_VARIATION;else if(this._getRealProfile(a),h=x.hub.m.enocean.profiles[a])b=(new h).TEACH_IN_VARIATION;switch(b){case 1:this._teachin4BSV1(a,d,f);break;case 2:this._teachin4BSV2(a,d,f);break;case 3:this._teachin4BSV3(a,
d,f);break;default:this._teachFinish(Error("no supported"))}};g.prototype._teachin4BSV1=function(a,d,f){};g.prototype._teachin4BSV2=function(a,d,f){var b=f;if(!f&&(b=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId(),!b)){this._teachFinish(Error("no more sender ID available"));return}f=a;var h=x.hub.m.enocean.profiles[f];h||(f=this._getRealProfile(f),h=x.hub.m.enocean.profiles[a]);h&&(h=new h,h._eepAlias&&(a=h._eepAlias));h&&h.getTeachinTelegram?a=h.getTeachinTelegram(d,b,x.hub.m.enocean.MANUFACTURE_ID):
(a=this._fromProfileStr(a),a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),a=new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0));var g=this;this._controller._esp3.sendTelegram(a,!0,function(a){a?g._teachFinish(a):(d||(d=b),g._controller._deviceHandler.addDevice({address:d,data:g._teachProfile,senderID:b,vendor:g._teachVendor},function(a,b){g._teachFinish(a,b)}))})};g.prototype._teachin4BSV3=function(a,d,f){var b=f;if(!f){b=
require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!b){this._teachFinish(Error("no more sender ID available"));return}this._teachSenderID=b}f=a;var h=x.hub.m.enocean.profiles[f];h||(f=this._getRealProfile(f),h=x.hub.m.enocean.profiles[a]);h&&(h=new h,h._eepAlias&&(a=h._eepAlias));h&&h.getTeachinTelegram?b=h.getTeachinTelegram(d,b,x.hub.m.enocean.MANUFACTURE_ID):(a=this._fromProfileStr(a),a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,
x.hub.m.enocean.MANUFACTURE_ID&255,128]),b=new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0));var g=this;this._controller._esp3.addListener(this._teachinTelegramCB);this._controller._esp3.sendTelegram(b,!0,function(a){a&&g._teachFinish(a)})};g.prototype.teachinUTE=function(a,d,f){x.hub.m.enocean.ESP3.Telegram.UTE()};g.prototype._teachFinish=function(a,d,f){this._controller._esp3.removeListener(this._teachinTelegramCB);var b=this._teachCallback;this._teachingTO&&clearTimeout(this._teachingTO);this._teachingTO=
null;this._teaching=!1;this._saParams=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;b&&b(a,d,f)};return g}();
x.hub.m.enocean.DeviceHandler=function(){var g=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.DeviceHandler");this._controller=a;this._devices={}};util.inherits(g,EventEmitter);g.prototype.SENSOR_FILE="enocean.json";g.prototype.UNKNOWN_PROFILE_ERR=404;g.prototype.ALREADY_EXISTS_ERR=400;g.prototype.init=function(a){this._logger.log("trace","init");var d=this;this._loadDevices(function(f,b){f&&d._logger.log("warn","init error:"+f.message);b&&(d._devices=b);d._initDevices();
a&&a()})};g.prototype._initDevices=function(){var a=Object.keys(this._devices),d=0,f=this,b=function(){d++;d<a.length&&(f._devices[a[d]]&&f._devices[a[d]].init?f._devices[a[d]].init(b):b())};this._devices[a[d]]&&this._devices[a[d]].init?this._devices[a[d]].init(b):b()};g.prototype.getDevice=function(a){return a?this._devices[a]:null};g.prototype.getAllDevices=function(){return this._devices};g.prototype.findDevice=function(a){return a&&a.address?this._devices[a.address]:null};g.prototype.findDeviceWithData=
function(a){if(!a)return null;var d=[],f;for(f in this._devices){var b=this._devices[f];b&&b.getData()==a&&d.push(b)}return d};g.prototype.addDevice=function(a,d){var f;if(a&&a.data){a.address||(a.address=this.getNextFreeAddress());a.address=a.address.toLowerCase();a.senderID&&(a.senderID=a.senderID.toLowerCase());var b=x.hub.m.enocean.profiles.parseJson(a);if(b){f=b._address;var h=this._devices[f];h&&h._data==b._data&&(b._states=h._states);this._devices[f]=b;this._saveDevices(this._devices,function(a){d&&
d(a,b)})}else f=Error("unknow profile"),f.errorCode=this.UNKNOWN_PROFILE_ERR,d&&d(f)}else f=Error("device json invalid"),d&&d(f)};g.prototype.updateDevice=function(a,d,f){if(a)if(d&&d.data){var b=this._devices[a];d.address||(d.address=a);d.address=d.address.toLowerCase();d.senderID&&(d.senderID=d.senderID.toLowerCase());var h=x.hub.m.enocean.profiles.parseJson(d);h?(b&&b._data==h._data&&(h._params=b._params,h._states=b._states),this._devices[d.address]=h,d.address!=a&&delete this._devices[a],this._saveDevices(this._devices,
function(a){f&&f(a,h)})):(a=Error("unknow profile"),a.errorCode=this.UNKNOWN_PROFILE_ERR,f&&f(a))}else a=Error("device json invalid"),f&&f(a);else a=Error("address invalid"),f&&f(a)};g.prototype.deleteDevice=function(a,d){if(a&&a.address&&this._devices[a.address]){var f=this._devices[a.address];f&&f.finalize&&f.finalize();var b=this._devices[a.address];delete this._devices[a.address];this.emit("deleteDevice",b);this._saveDevices(this._devices,function(a){d&&d(a,f)})}else d&&d()};g.prototype.onLearnAddDeleteDevice=
function(a,d){if(a&&a.address)if(this._devices[a.address])this.deleteDevice(a,function(a,b){d&&d(a,1,b)});else this.onLearnDevice(null,a,function(a,b){d&&d(a,0,b)});else d&&d()};g.prototype.onLearnDevice=function(a,d,f){if(d&&d.address&&d.data){var b=x.hub.m.enocean.profiles.parseJson(d);if(b){var h=d.address;if(this._devices[h]){var g=this._devices[h],h=g.toJSON();if(h.data!=d.data||h.vendor!=d.vendor)d=Error("address "+d.address+" already exists, please delete it first"),d.errorCode=this.ALREADY_EXISTS_ERR,
f&&f(d);else if(h.senderID!=d.senderID){g._senderID=d.senderID;if("bb-aa-cc"==g._data||"d2-06-10"==g._data)g.executeCommand(null,{value:"alertOn"}),g.executeCommand(null,{value:"preAlarmOn"});this._saveDevices(this._devices,function(a){f&&f(a,g)})}else f&&f(null,g)}else{a&&(d=a.address)&&d!=h&&this._devices[d]&&delete this._devices[d];this._devices[h]=b;if("bb-aa-cc"==b._data||"d2-06-10"==b._data)b.executeCommand(null,{value:"alertOn"}),b.executeCommand(null,{value:"preAlarmOn"});this._saveDevices(this._devices,
function(a){f&&f(a,b)})}}else d=Error("unknow profile"),d.errorCode=this.UNKNOWN_PROFILE_ERR,f&&f(d)}else d=Error("device json invalid"),f&&f(d)};g.prototype.deviceParamsUpdated=function(a,d){this._saveDevices(this._devices,function(a){d&&d(a)})};g.prototype.isVirtual=function(a){var d=x.hub.m.enocean.SENDER_ID;if(!d)return!1;var f=parseInt(d,16)+1,d=parseInt(d,16)+128;a=parseInt(a,16);return a>=f&&a<=d};g.prototype.getVirtualSenderID=function(){var a=x.hub.m.enocean.SENDER_ID;if(!a)return[];var d=
parseInt(a,16)+1,a=parseInt(a,16)+128,f=[],b=this._devices,h;for(h in b){var g=b[h];g&&g._senderID&&(g=parseInt(g._senderID,16),g>=d&&g<=a&&f.push(g))}return f};g.prototype.getVirtualAddress=function(){var a=[],d=this._devices,f;for(f in d)"x"==f.charAt(0)&&(d=parseInt(f.substr(1),16),0<=d&&268435455>=d&&a.push(f));return a};g.prototype.getFreeSenderIdCount=function(){return 128-this.getVirtualSenderID().length};g.prototype.getNextFreeSenderId=function(){var a=x.hub.m.enocean.SENDER_ID;if(!a)return null;
for(var d=parseInt(a,16)+1,a=parseInt(a,16)+128,f=this.getVirtualSenderID(),b=null;d<=a;d++)if(-1==f.indexOf(d)){b=d;break}if(b)for(b=b.toString(16).toLowerCase();8>b.length;)b="0"+b;return b};g.prototype.getNextFreeAddress=function(){for(var a=this.getVirtualAddress(),d=null,f=0;268435455>=f;f++){for(var b=f.toString(16);7>b.length;)b="0"+b;b="x"+b;if(-1==a.indexOf(b)){d=b;break}}return d};g.prototype.generateVirtual=function(a,d){if(a&&a.data){var f=a.senderID;if(!f&&(f=this.getNextFreeSenderId(),
!f)){d&&d(Error("no sender id available"));return}a.senderID=f;a.address=f;a.virtual=!0;if(f=this.findDevice(a)){var b=f.toJSON();a.data!=b.data?d&&d(Error("device of another type with the same address exists")):a.vendor&&a.vendor!=b.vendor?d&&d(Error("device of another vendor with the same address exists")):d&&d(null,f)}else(f=x.hub.m.enocean.profiles.parseJson(a))?this.addDevice(f.toJSON(),function(a,b){d&&d(a,b)}):d&&d(Error("unknow profile"))}else d&&d(Error("query is null"))};g.prototype._getFile=
function(){var a=fileman.fileManager,d=require("path"),a=a.getUserRootDataPath();return d.resolve(a,this.SENSOR_FILE)};g.prototype._loadDevices=function(a){var d=require("fs-extra"),f=this._getFile();d.ensureFile(f,function(b){b?a&&a(b):d.readFile(f,"utf8",function(b,d){if(b)a&&a(b);else try{var f={},g=JSON.parse(d),n;for(n in g){var q=x.hub.m.enocean.profiles.parseDBJson(g[n]);q&&(f[n]=q)}a&&a(null,f)}catch(t){a&&a(t)}})})};g.prototype._saveDevices=function(a,d){var f=this._getFile(),b={},h;for(h in a)b[h]=
a[h].toDBJSON();fs_extra.writeFile(f,JSON.stringify(b,null,2),function(a){d&&d(a)})};return g}();
x.hub.m.enocean.ESP3=function(){var g=function(a,b,d){this.type=a;this.data=b;this.optData=d};g.TYPE={1:"RADIO_ERP1",2:"RESPONSE",3:"RADIO_SUB_TEL",4:"EVENT",5:"COMMAND_COMMAND",6:"SMART_ACK_COMMAND",7:"REMOTE_MAN_COMMAND",9:"RADIO_MESSAGE",10:"RADIO_ERP2",16:"RADIO_802_15_4",17:"COMMAND_2_4"};g.prototype.toBuffer=function(){var a=new Buffer(6);a.writeUInt8(85,0);a.writeUInt16BE(this.data.length,1);a.writeUInt8(this.optData?this.optData.length:0,3);a.writeUInt8(this.type,4);a.writeUInt8(0,5);var b=
x.hub.m.enocean.CRC8(a.slice(1,5));a.writeUInt8(b,5);var d=this.optData?Buffer.concat([this.data,this.optData],this.data.length+this.optData.length):this.data,b=x.hub.m.enocean.CRC8(d),a=Buffer.concat([a,d],6+d.length+1);a.writeUInt8(b,a.length-1);return a};g.prototype.toJSON=function(){return{dataLen:this.data.length,optLen:this.optData?this.optData.length:0,type:this.type,typeName:g.TYPE[this.type],data:this.data.toString("hex"),optData:this.optData?this.optData.toString("hex"):null}};g.prototype.toPacket=
function(){return a.resolve(this)};var a=function(){};a.resolve=function(a){switch(a.type){case 1:return f.resolve(a);case 2:return d.resolve(a);case 4:return k.resolve(a);case 5:return h.resolve(a);case 6:return b.resolve(a);default:return null}};var d=function(a,b,d){this.retCode=a;this.resData=b;this.optData=d};d.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};d.prototype.toJSON=function(){return{retCodeName:d.CODE[this.retCode],
retCode:this.retCode.toString(16),resData:this.resData?this.resData.toString("hex"):null,optData:this.optData?this.optData.toString("hex"):null}};d.prototype.toFrame=function(){var a=new Buffer(1);a.writeUInt8(this.retCode,0);this.resData&&(a=Buffer.concat([a,this.resData]));return new g(2,a,this.optData)};d.prototype.toResponse=function(){return J.resolve(this)};d.resolve=function(a){var b,f;b=a.data.readUInt8(0);1<a.data.length&&(f=a.data.slice(1));return new d(b,f,a.optData)};var f=function(a,
b,d,f,h,g){this.data=a;if(this.hasOpt=b)this.subTelNum=d,this.dstId=f,this.dBm=h,this.securityLvl=g};f.prototype.toJSON=function(){var a={data:this.data.toString("hex")};this.hasOpt&&(a.subTelNum=this.subTelNum.toString(16),a.dstId=this.dstId,a.dBm=this.dBm.toString(16),a.securityLvl=this.securityLvl);return a};f.prototype.toFrame=function(){var a=this.data,b=null;this.hasOpt&&(b=new Buffer([this.subTelNum]),b=Buffer.concat([b,new Buffer(this.dstId,"hex")]),b=Buffer.concat([b,new Buffer([this.dBm,
this.securityLvl])]));return new g(1,a,b)};f.prototype.toRadioTelegram=function(){return l.resolve(this)};f.resolve=function(a){var b=!1,d,h,g,k;a.optData&&(b=!0,d=a.optData.readUInt8(0),h=a.optData.slice(1,5).toString("hex"),g=a.optData.readUInt8(5),k=a.optData.readUInt8(6));return new f(a.data,b,d,h,g,k)};var b=function(a){this.data=a};b.prototype.toJSON=function(){return{data:this.data.toString("hex")}};b.prototype.toFrame=function(){return new g(6,this.data,null)};b.prototype.toSACommand=function(){return p.resolve(this)};
b.resolve=function(a){return new b(a.data)};var h=function(a){this.data=a};h.prototype.toJSON=function(){return{data:this.data.toString("hex")}};h.prototype.toFrame=function(){return new g(5,this.data,null)};h.prototype.toCommandCommand=function(){return r.resolve(this)};h.resolve=function(a){return new h(a.data)};var k=function(a){this.data=a};k.prototype.toJSON=function(){return{data:this.data.toString("hex")}};k.prototype.toFrame=function(){return new g(4,this.data,null)};k.prototype.toEvent=function(){return W.resolve(this)};
k.resolve=function(a){return new k(a.data)};var l=function(a,b){this.rorg=a;this.optData=b;this.optData||(this.optData={subTelNum:1,dstId:"FFFFFFFF",dBm:255,securityLvl:0})};l.prototype.setDstId=function(a){this.optData.dstId=a?a:"FFFFFFFF"};l.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 208:return m.resolve(a);case 246:return n.resolve(a);case 213:return q.resolve(a);case 165:return t.resolve(a);case 210:return A.resolve(a);case 212:return F.resolve(a);case 53:return G.resolve(a);
case 49:return w.resolve(a);default:return null}};var m=function(a,b,d,f){l.call(this,208,f);this.messageIndex=a;this.userData=b;this.senderID=d};m.prototype=new l;m.prototype.constructor=m;m.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),messageIndex:this.messageIndex,userData:this.userData?this.userData.toString("hex"):null,senderID:this.senderID}};m.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.messageIndex,1);this.userData&&(a=Buffer.concat([a,
this.userData]));var a=Buffer.concat([a,new Buffer(this.senderID,"hex")]),b=1,d="FFFFFFFF",h=255,g=0;this.optData&&(b=this.optData.subTelNum,d=this.optData.dstId,h=this.optData.dBm,g=this.optData.securityLvl);return new f(a,!0,b,d,h,g)};m.resolve=function(a){var b=a.data,d=b.readUInt8(1),f=null,h=null;switch(d){case 1:f=0;h=b.slice(2,6).toString("hex");break;case 4:case 6:f=b.slice(2,3),h=b.slice(3,7).toString("hex")}var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});
return new m(d,f,h,g)};var n=function(a,b,d,f,h,g){l.call(this,246,g);this.userData=a?a:0;this.senderID=b;this.t21=d?d:0;this.nu=f?f:0;this.rc=h?h:0};n.prototype=new l;n.prototype.constructor=n;n.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),senderID:this.senderID,t21:this.t21,nu:this.nu,rc:this.rc}};n.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.userData,1);var a=Buffer.concat([a,new Buffer(this.senderID,
"hex")]),a=Buffer.concat([a,new Buffer([this.t21<<5|this.nu<<4||this.rc])]),b=1,d="FFFFFFFF",h=255,g=0;this.optData&&(b=this.optData.subTelNum,d=this.optData.dstId,h=this.optData.dBm,g=this.optData.securityLvl);return new f(a,!0,b,d,h,g)};n.resolve=function(a){var b=a.data,d=b.readUInt8(1),f=b.slice(2,6).toString("hex"),h=b.readUInt8(6)>>5&1,g=b.readUInt8(6)>>4&1,k;a.hasOpt&&(k={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new n(d,f,h,g,b&15,k)};var q=function(a,
b,d,f){l.call(this,213,f);this.userData=a;this.senderID=b;this.rc=d?d:0};q.prototype=new l;q.prototype.constructor=q;q.prototype.getLearnBit=function(){return this.userData>>3&1};q.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),learn:this.getLearnBit(),senderID:this.senderID,rc:this.rc}};q.resolve=function(a){var b=a.data,d=b.readUInt8(1),f=b.slice(2,6).toString("hex"),b=b.readUInt8(6)&15,h;a.hasOpt&&(h={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,
securityLvl:a.securityLvl});return new q(d,f,b,h)};var t=function(a,b,d,f){l.call(this,165,f);this.userData=a;this.senderID=b;this.rc=d?d:0};t.prototype=new l;t.prototype.constructor=t;t.prototype.getLearnType=function(){return this.userData.readUInt8(3)>>7&1};t.prototype.getLearnBit=function(){return this.userData.readUInt8(3)>>3&1};t.prototype.getLearnStatus=function(){return this.userData.readUInt8(3)>>4&1};t.prototype.getLearnResult=function(){return this.userData.readUInt8(3)>>5&1};t.prototype.getEEPResult=
function(){return this.userData.readUInt8(3)>>6&1};t.prototype.getFunc=function(){return this.userData.readUInt8(0)>>2&63};t.prototype.getType=function(){var a=this.userData.readUInt8(0)&3,b=this.userData.readUInt8(1)>>3&31;return a<<5|b};t.prototype.getManufacturerId=function(){var a=this.userData.readUInt8(1)&7,b=this.userData.readUInt8(2);return a<<8|b};t.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),learnType:this.getLearnType(),learn:this.getLearnBit(),
learnStatus:this.getLearnStatus(),learnResult:this.getLearnResult(),eepResult:this.getEEPResult(),func:this.getFunc(),type:this.getType(),manufacturerId:this.getManufacturerId(),senderID:this.senderID,rc:this.rc}};t.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.rc&15])]);return this.optData?new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,
this.optData.securityLvl):new f(a,!1)};t.resolve=function(a){var b=a.data,d=b.slice(1,5),f=b.slice(5,9).toString("hex"),b=b.readUInt8(9)&15,h;a.hasOpt&&(h={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new t(d,f,b,h)};var A=function(a,b,d,f){l.call(this,210,f);this.userData=a;this.senderID=b;this.status=d};A.prototype=new l;A.prototype.constructor=A;A.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,
status:this.status,optData:this.optData}};A.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return this.optData?new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};A.resolve=function(a){var b=a.data,d=b.slice(1,b.length-5),f=b.slice(b.length-5,b.length-1).toString("hex"),b=b.readUInt8(b.length-
1),h;a.hasOpt&&(h={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new A(d,f,b,h)};var H=function(a,b,d,f,h){l.call(this,166);this.rorg_en=a;this.data=b;this.dstID=d;this.senderID=f;this.status=h};H.prototype=new l;H.prototype.constructor=H;H.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.rorg_en,1);a=Buffer.concat([a,this.data]);a=Buffer.concat([a,new Buffer(this.dstID,"hex")]);a=Buffer.concat([a,new Buffer(this.senderID,
"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return new f(a,!1)};var F=function(a,b,d,f,h,g,k,m,n,p,q){l.call(this,212);this.cmd=a;this.ute=b;this.rspExpected=d;this.subtype=f;this.numChannel=h;this.manufactureID=g;this.eepType=k;this.eepFunc=m;this.eepRorg=n;this.senderID=p;this.status=q};F.prototype=new l;F.prototype.constructor=F;F.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),ute:this.ute,rspExpected:this.rspExpected,subtype:this.subtype,cmd:this.cmd,numChannel:this.numChannel,
manufactureID:this.manufactureID,eepType:this.eepType.toString(16),eepFunc:this.eepFunc.toString(16),eepRorg:this.eepRorg.toString(16),senderID:this.senderID,status:this.status}};F.prototype.toPacket=function(){var a=new Buffer(8);a.writeUInt8(this.rorg,0);a.writeUInt8(this.ute<<7|this.rspExpected<<6|this.subtype<<4|this.cmd,1);a.writeUInt8(this.numChannel,2);a.writeUInt16BE(parseInt(this.manufactureID,16),3);a.writeUInt8(this.eepType,5);a.writeUInt8(this.eepFunc,6);a.writeUInt8(this.eepRorg,7);a=
Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return this.optData?new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};F.resolve=function(a){var b=a.data.slice(1,8),d=a.data.slice(8,12).toString("hex"),f=a.data.readUInt8(12),h=b.readUInt8(0)>>7&1,g=b.readUInt8(0)&15,k=b.readUInt8(1),l=b.slice(2,4).toString("hex"),m=b.readUInt8(4),n=b.readUInt8(5),p=b.readUInt8(6),q=b.readUInt8(0)>>6&1,b=b.readUInt8(0)>>
4&3,d=new F(g,h,q,b,k,l,m,n,p,d,f);a.hasOpt&&(d.optData={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return d};var G=function(a,b,d,f){l.call(this,53,f);this.userData=a;this.senderID=b;this.status=d};G.prototype=new l;G.prototype.constructor=G;G.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};G.resolve=function(a){var b=a.data,d=b.slice(1,b.length-5),
f=b.slice(b.length-5,b.length-1).toString("hex"),b=b.readUInt8(b.length-1),h;a.hasOpt&&(h={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new G(d,f,b,h)};var w=function(a,b,d,f){l.call(this,49,f);this.userData=a;this.senderID=b;this.status=d};w.prototype=new l;w.prototype.constructor=w;w.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};w.prototype.convertToPacket=
function(a){a=Buffer.concat([a,new Buffer(this.senderID,"hex"),new Buffer([this.status])]);return this.optData?new f(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new f(a,!1)};w.resolve=function(a){var b=a.data,d=b.slice(1,b.length-5),f=b.slice(b.length-5,b.length-1).toString("hex"),b=b.readUInt8(b.length-1),h;a.hasOpt&&(h={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new w(d,f,b,h)};l.SIG=m;l.RPS=n;l.BS1=q;l.BS4=t;l.VLD=
A;l.ADT=H;l.UTE=F;l.TS=G;l.SM=w;var J=function(a,b){this._code=a;this._rspData=b};J.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};J.prototype.toJSON=function(){return{code:this._code,rspData:this._rspData?this._rspData.toString("hex"):null}};J.prototype.toPacket=function(){return new d(this._code,this._rspData)};J.resolve=function(a){return new J(a.retCode,a.resData)};H=function(a,
b){J.call(this,0);this._responseTime=a;this._confirmCode=b};H.prototype.toPacket=function(){var a=new Buffer(3);a.writeUInt16BE(this._responseTime,0);a.writeUInt8(this._confirmCode,2);return new d(this._code,a)};H.prototype.toJSON=function(){return{code:this._code,responseTime:this._responseTime,confirmCode:this._confirmCode}};J.Response_OK_SA_CONFIRM_LEARN=H;var W=function(a){this._code=a};W.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 1:return P.resolve(a);case 2:return E.resolve(a);
default:return null}};var P=function(){this._code=1};P.prototype=new W;P.prototype.constructor=P;P.prototype.toJSON=function(){return{code:this._code}};P.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);return new k(a)};P.resolve=function(a){return new P};var E=function(a,b,d,f,h,g,k){this._code=2;this._priority=a;this._manufacturerId=b;this._eep=d;this._rssi=f;this._pm_candidateId=h;this._sa_clientId=g;this._hop_count=k};E.prototype=new W;E.prototype.constructor=E;E.prototype.getEEP=
function(){return this._eep?this._eep.substr(0,2)+"-"+this._eep.substr(2,2)+"-"+this._eep.substr(4,2):null};E.prototype.getPMCandidateId=function(){return this._pm_candidateId};E.prototype.getSAClientId=function(){return this._sa_clientId};E.prototype.getHopCount=function(){return this._hop_count};E.prototype.toJSON=function(){return{code:this._code,priority:this._priority,manufacturerId:this._manufacturerId,eep:this.getEEP(),rssi:this._rssi,pm_candidateId:this._pm_candidateId,sa_clientId:this._sa_clientId,
hop_count:this._hop_count}};E.prototype.toPacket=function(){var a=new Buffer(4);a.writeUInt8(this._code,0);a.writeUInt8(this._priority,1);a.writeUInt16BE(this._manufacturerId&1023,2);a=Buffer.concat([a,new Buffer(this._eep,"hex")]);a=Buffer.concat([a,new Buffer([this._rssi])]);a=Buffer.concat([a,new Buffer(this._pm_candidateId,"hex")]);a=Buffer.concat([a,new Buffer(this._sa_clientId,"hex")]);a=Buffer.concat([a,new Buffer([this._hop_count])]);return new k(a)};E.resolve=function(a){var b=a.data;a=b.readUInt8(1);
var d=b.readUInt16BE(2)&1023,f=b.slice(4,7).toString("hex"),h=b.readUInt8(7),g=b.slice(8,12).toString("hex"),k=b.slice(12,16).toString("hex"),b=b.readUInt8(16);return new E(a,d,f,h,g,k,b)};W.SA_RECLAIM_NOT_SUCCESSFUL=P;W.SA_CONFIRM_LEARN=E;var r=function(a){this._code=a};r.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 9:return CO_WR_REPEATER.resolve(a);default:return null}};CO_WR_REPEATER=function(a,b){this._code=9;this._enable=a;this._level=b};CO_WR_REPEATER.prototype=
new r;CO_WR_REPEATER.prototype.constructor=CO_WR_REPEATER;CO_WR_REPEATER.prototype.toJSON=function(){return{code:this._code,enable:this._enable,level:this._level}};CO_WR_REPEATER.prototype.toPacket=function(){var a=new Buffer(3);a.writeUInt8(this._code,0);a.writeUInt8(this._enable,1);a.writeUInt8(this._level,2);return new h(a)};CO_WR_REPEATER.resolve=function(a){a=a.data.readUInt8(1);var b=CO_WR_REPEATER.readUInt8(2);return new CO_WR_REPEATER(a,b)};r.CO_WR_REPEATER=CO_WR_REPEATER;var p=function(a){this._code=
a};p.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 1:return M.resolve(a);case 6:return S.resolve(a);case 8:return T.resolve(a);default:return null}};var M=function(a,b,d){this._code=1;this._enable=a;this._extended=b;this._timeout=d};M.prototype=new p;M.prototype.constructor=M;M.prototype.toJSON=function(){return{code:this._code,enable:this._enable,extended:this._extended,timeout:this._timeout}};M.prototype.toPacket=function(){var a=new Buffer(7);a.writeUInt8(this._code,
0);a.writeUInt8(this._enable,1);a.writeUInt8(this._extended,2);a.writeUInt32BE(this._timeout,3);return new b(a)};M.resolve=function(a){var b=a.data;a=b.readUInt8(1);var d=b.readUInt8(2),b=b.readUInt32BE(3);return new M(a,d,b)};var X=function(a){this._code=5;this._saClientId=a};X.prototype=new p;X.prototype.constructor=X;X.prototype.toJSON=function(){return{code:this._code,clientId:this._saClientId}};X.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);a=Buffer.concat([a,
new Buffer(this._saClientId,"hex")]);return new b(a)};X.resolve=function(a){a=a.data.slice(1,5).toString("hex");return new X(a)};var S=function(){this._code=6};S.prototype=new p;S.prototype.constructor=S;S.prototype.toJSON=function(){return{code:this._code}};S.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);return new b(a)};S.resolve=function(a){return new S};var T=function(a){this._code=8;this._mailBoxCount=a};T.prototype=new p;T.prototype.constructor=T;T.prototype.toJSON=
function(){return{code:this._code,mailBoxCount:this._mailBoxCount}};T.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this._code,0);a.writeUInt8(this._mailBoxCount,1);return new b(a)};T.resolve=function(a){a=a.data.readUInt8(1);return new T(a)};p.SA_WR_LEARNMODE=M;p.SA_WR_RESET=X;p.SA_RD_LEARNEDCLIENTS=S;p.SA_WR_POSTMASTER=T;var u=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP3");this._controller=a;this._listeners=[];a&&this._listeners.push(a);this._recomm=
new x.hub.m.enocean.ReComm(this);this._baseID=this._serial=null;this._rdata=new Buffer([]);this._frameBuffer=[];this._learnHandler=null;this._learning=!1;this._learnTO=null};u.RESPONSE_TO=1500;u.prototype.attachSerial=function(a,b){var d=this;this._serial=new x.hub.m.enocean.Serial(a);this._serial.setListener(this);this._serial.open(function(a){a?(d._serial.setListener(null),d._serial=null,b&&b(a)):d.readBaseID(function(a,f){a?(d._serial.setListener(null),d._serial.close(),d._serial=null,b&&b(a)):
(x.hub.m.enocean.SENDER_ID||(x.hub.m.enocean.SENDER_ID=f,localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID",f)),d._baseID=f,b&&b())})})};u.prototype.removeSerial=function(a,b){this._serial.setListener(null);this._serial.close();this._baseID=this._serial=null;b&&b()};u.prototype.getSerial=function(){return this._serial};u.prototype.addListener=function(a){a&&-1==this._listeners.indexOf(a)&&this._listeners.push(a)};u.prototype.removeListener=function(a){a&&(a=this._listeners.indexOf(a),
-1!=a&&this._listeners.splice(a,1))};u.prototype.readBaseID=function(a){var b=this,d=new g(5,new Buffer("08","hex"));this.sendFrame(d,!0,function(d,f){if(d)b._logger.log("warn","read base id error:"+d.stack),a&&a(d);else if(f&&f.retCode)d=Error("read BaseID error"),d.code=f.retCode,b._logger.log("warn","read base id error return code:"+f.retCode),a&&a(d);else{var h=f.resData.toString("hex");a&&a(null,h.toLowerCase())}},8E3)};u.prototype.startLearn=function(a,b,d,f){if(this._serial){if(!b||0>=b)b=
3E4;if(this._learning)f&&f(Error("learning another type right now"));else{this._learnHandler=a;this._learning=!0;var h=this;this._learnTO=setTimeout(function(){h._learning=!1;h._learnTO=null;var a=h._learnHandler;h._learnHandler=null;if(a&&a.onLearnTimeout)a.onLearnTimeout()},b);d?(a=new M(1,d.extended?d.extended:0,0),this.sendSACommand(a,!0,function(a){f&&f(a)})):f&&f()}}else f&&f(Error("port not opened"))};u.prototype.stopLearn=function(a,b,d){this._learnTO&&clearTimeout(this._learnTO);this._learning=
!1;this._learnTO=this._learnHandler=null;if(b){d&&d();var f=this;setTimeout(function(){var a=new M(0,b.extended?b.extended:0,0);f.sendSACommand(a,!0,function(a){d&&d(a)})},2E3)}else d&&d()};u.prototype.sendTelegram=function(a,b,d){this.sendPacket(a.toPacket(),b,d)};u.prototype.sendResponse=function(a,b){this._logger.log("trace","send RESPONSE:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),!1,b)};u.prototype.sendSACommand=function(a,b,d){this._logger.log("trace","send SA_COMMAND:"+JSON.stringify(a.toJSON()));
this.sendPacket(a.toPacket(),b,d)};u.prototype.sendCommandCommand=function(a,b,d){this._logger.log("trace","send COMMAND_COMMAND:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),b,d)};u.prototype.sendPacket=function(a,b,d){this.sendFrame(a.toFrame(),b,d)};u.prototype.sendFrame=function(a,b,d,f){var h=this._frameBuffer.length;this._frameBuffer.push({frame:a,callback:d,timeout:null,response:b,to:f});0==h&&this._sendNextFrame()};u.prototype._sendNextFrame=function(){if(0!=this._frameBuffer.length){var a=
this._frameBuffer[0],b=a.frame,d=a.callback,f=a.response;if(this._serial){var h=this,b=b.toBuffer();this._logger.log("trace","send raw frame:"+b.toString("hex"));this._serial.sendPacket(b,function(b){if(b||!f){try{d&&d(b)}catch(g){}h._frameBuffer.splice(0,1);h._sendNextFrame()}else b=a.to,b||(b=u.RESPONSE_TO),a.timeout=setTimeout(function(){var a=h._frameBuffer[0];if(a){var a=a.callback,b=Error("enocean response timeout");b.code=100;try{a&&a(b)}catch(d){}}h._frameBuffer.splice(0,1);h._sendNextFrame()},
b)})}else d&&d(Error("port not opened")),this._frameBuffer.splice(0,1),this._sendNextFrame()}};u.prototype.onSerialData=function(a){a=this._rdata=Buffer.concat([this._rdata,a]);for(var b=0;b<a.length;b++)if(85==a[b]&&b+6<a.length){var d=(a[b+1]<<8)+a[b+2],f=a[b+3],h=a[b+5];if(a.length>=b+d+f+7){var k=!1;x.hub.m.enocean.CRC8(a.slice(b+1,b+5));if(x.hub.m.enocean.CRC8(a.slice(b+1,b+5))==h&&(h=a[b+d+f+6],x.hub.m.enocean.CRC8(a.slice(b+6,b+6+d+f))==h)){var k=!0,h={type:a[b+4],dataLen:d,optLen:f,radioType:a[b+
6],data:a.slice(b+6,b+6+d),optData:a.slice(b+6+d,b+6+d+f),rawByte:a.slice(0,b+6+d+f+1).toString("hex")},l=new g(h.type,h.data,h.optData);if(166==h.radioType||210==h.radioType||165==h.radioType||246==h.radioType||213==h.radioType)h.senderId=h.data.slice(d-5,d-1).toString("hex");this._onEOFrame(l,h);a=a.slice(b+6+d+f+1)}k||(a=a.slice(b+1))}}this._rdata=a};u.prototype.onSerialError=function(a){this._serial.setListener(null);this._serial=null};u.prototype._onEOFrame=function(a,b){this._logger.log("trace",
"receive raw frame:"+b.rawByte);this._logger.log("debug","receive enocean frame:"+JSON.stringify(a.toJSON()));this._listeners.forEach(function(d){d._onEOFrame&&d._onEOFrame(a,b.rawByte)});var d=a.toPacket();d&&this._onEOPacket(d)};u.prototype._onEOPacket=function(a){this._logger.log("debug","receive enocean packet:"+JSON.stringify(a.toJSON()));this._listeners.forEach(function(b){b._onEOPacket&&b._onEOPacket(a)});a instanceof f?this._onEORadio_ERP1(a):a instanceof d?this._onEOResponse_Packet(a):a instanceof
k&&this._onEOEvent_Packet(a)};u.prototype._onEORadio_ERP1=function(a){(a=a.toRadioTelegram())&&this._onEO_ERP1_Telegram(a)};u.prototype._onEOResponse_Packet=function(a){try{var b=a.toResponse();this._onEO_Response(b)}catch(d){}if(0!=this._frameBuffer.length){var f=this._frameBuffer[0],b=f.callback;(f=f.timeout)&&clearTimeout(f);try{b&&b(null,a)}catch(h){}this._frameBuffer.splice(0,1);this._sendNextFrame()}};u.prototype._onEOEvent_Packet=function(a){(a=a.toEvent())&&this._onEO_Event(a)};u.prototype._onEO_ERP1_Telegram=
function(a){this._logger.log("debug","receive enocean telegram:"+JSON.stringify(a.toJSON()));this._listeners.forEach(function(b){b._onEOTelegram&&b._onEOTelegram(a)});49==a.rorg&&(a=this._controller._secHandler.resolve(a))&&this._listeners.forEach(function(b){b._onEOTelegram&&b._onEOTelegram(a)});if(this._learning&&this._learnHandler&&this._learnHandler.onTelegram)this._learnHandler.onTelegram(a)};u.prototype._onEO_Response=function(a){this._logger.log("debug","receive enocean response:"+JSON.stringify(a.toJSON()))};
u.prototype._onEO_Event=function(a){this._logger.log("debug","receive enocean event:"+JSON.stringify(a.toJSON()));if(this._learning&&this._learnHandler&&this._learnHandler.onEvent)this._learnHandler.onEvent(a)};u.ESP3_Frame=g;u.Telegram=l;u.RADIO_ERP1_Packet=f;u.Event=W;u.Response=J;u.COMMAND_COMMAND=r;u.SA_COMMAND=p;return u}();
x.hub.m.enocean.profiles=function(){var g=function(c){this._address=c?c.address:null;this._senderID=c?c.senderID:null;this._data=c?c.data:null;this._params=c?c.params:null;this._vendor="general";this._virtual=!1;this._eepAlias=null;this.setDefaultParams();this._states={};this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles."+(this._data?this._data:"Profile"))};g.prototype.getAddress=function(){return this._address};g.prototype.getData=function(){return this._data};g.prototype.finalize=
function(c){c&&c()};g.prototype.evalData=function(c,e,a){(c=this.evalTelegram(e))?(c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};g.prototype.evalTelegram=function(c){return null};g.prototype.getStatesBuffer=function(){return this._states};g.prototype.getBufferedState=function(c){var e=this.getStatesBuffer();return e&&e[c]?e[c].value:null};g.prototype.getCurrentStates=function(){var c={},e=this.getStatesBuffer(),a;for(a in e)e.hasOwnProperty(a)&&e[a]&&(c[a]=e[a].value);
return c};g.prototype.getStatesLegacy=function(){var c=this.getCurrentStates();return{type:"ENOCEAN",adr:this._address,data:this._data,vendor:this._vendor,state:c}};g.prototype.checkStateChange=function(c){var e=this._states,a=[],b=(new Date).getTime(),d;for(d in c){var f={};f.key=d;f.value=c[d];f.changed=!1;var h=e[d]?e[d].value:null;h!=c[d]&&(f.oldvalue=h,f.changed=!0);this._states[d]={value:c[d],time:b};a.push(f)}return a};g.prototype.setDefaultParams=function(){};g.prototype.activeStateChange=
function(c){c=this.checkStateChange(c);0<c.length&&require("x.hub.m.enocean.js")._onEOEvents(this,c)};g.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params}};g.prototype.fromJSON=function(c){if(!c||!c.address||!c.data||c.data!=this._data)return null;this._address=c.address;this._senderID=c.senderID;this._vendor=c.vendor?c.vendor:this._vendor;this._virtual=c.virtual?!0:!1;this._params=
c.params;this.setDefaultParams();return this};g.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual}};g.prototype.fromDBJSON=function(c){if(!c||!c.id||!c.eep||c.eep!=this._data)return null;this._address=c.id;this._senderID=c.senderID;this._vendor=c.vendor?c.vendor:this._vendor;this._virtual=c.virtual?!0:!1;this._params=c.params;this.setDefaultParams();return this};var a=function(c){g.call(this,c);
this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SiegeniaWindow");this._data="d2-06-50";this._vendor="siegenia";this._desc="Window";this._states={counter00:{value:"?",time:-1},counter01:{value:"?",time:-1},counter02:{value:"?",time:-1},counter03:{value:"?",time:-1},counter04:{value:"?",time:-1},counter05:{value:"?",time:-1},counter06:{value:"?",time:-1},counter07:{value:"?",time:-1},counter08:{value:"?",time:-1},counter09:{value:"?",time:-1},counter0A:{value:"?",time:-1},aliveTimeout:{value:!1,
time:-1}};var e=this;this._params=c?c.params:null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});this._aliveTO=setTimeout(function(){e._aliveTimeout()},2E3*this._params.alive)};a.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"SIEGENIA-AUBI KG",vendor:"siegenia",params:{alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}};a.prototype=new g;a.prototype.constructor=a;a.prototype.evalTelegram=function(c){var e={};if(210==c.rorg)if(c=c.userData,1==c[0]&&8==c.length){var a=
c[1]&239,b=(c[2]<<24)+(c[3]<<16)+(c[4]<<8)+c[5],d=c[6]>>7,e={type:1,TBT:!1,batteryOK:!0,battery:c[6]&127,motionSensor:c[7]>>6,accelerationSensor:(c[7]&48)>>4,magneticSensor:(c[7]&12)>>2,error:c[7]&3,count:b};d&&(e.batteryOK=!1);100<e.battery&&(e.battery=100);e.code=a;switch(a){case 0:e.state="?";e.handle="?";e.counter00=b;break;case 1:e.state="closed";e.handle="closed";e.counter01=b;break;case 2:e.state="closed";e.handle="open";e.counter02=b;break;case 3:e.state="closed";e.handle="tilted";e.counter03=
b;break;case 4:e.state="open";e.handle="closed";e.counter04=b;break;case 5:e.state="open";e.handle="open";e.TBT=!0;e.counter05=b;break;case 6:e.state="open";e.handle="tilted";e.TBT=!0;e.counter06=b;break;case 7:e.state="tilted";e.handle="closed";e.TBT=!0;e.counter07=b;break;case 8:e.state="tilted";e.handle="open";e.TBT=!0;e.counter08=b;break;case 9:e.state="tilted";e.handle="tilted";e.counter09=b;break;case 10:e.state="?",e.handle="?",e.counter0A=b}}else if(2==c[0]&&2==c.length)switch(e.type=2,c[1]&
15){case 1:e.burglary=!0;break;default:e.burglary=!1}else if(c[0]=2==c.length){e.type=17;switch((c[1]&192)>>6){case 0:e.calibrationState="ok";break;case 1:e.calibrationState="error";break;case 2:e.calibrationState="invalid";break;case 3:e.calibrationState="not_supported"}c=c[1]&63;e.calibrationStep=c;switch(c){case 0:e.calibrationCasement="none";e.calibrationHandle="none";break;case 1:e.calibrationCasement="closed";e.calibrationHandle="closed";break;case 2:e.calibrationCasement="closed";e.calibrationHandle=
"open";break;case 3:e.calibrationCasement="closed";e.calibrationHandle="tilted";break;case 4:e.calibrationCasement="open";e.calibrationHandle="closed";break;case 5:e.calibrationCasement="open";e.calibrationHandle="open";break;case 6:e.calibrationCasement="open";e.calibrationHandle="tilted";break;case 7:e.calibrationCasement="tilted";e.calibrationHandle="closed";break;case 8:e.calibrationCasement="tilted";e.calibrationHandle="open";break;case 9:e.calibrationCasement="tilted",e.calibrationHandle="tilted"}}return e};
a.prototype.evalData=function(c,e,a){var b=this;b._states.aliveTimeout.value=!1;clearTimeout(this._aliveTO);this._aliveTO=setTimeout(function(){b._aliveTimeout()},2E3*this._params.alive);(c=this.evalTelegram(e))?(e=[],c.aliveMsg||(e=this.checkStateChange(c)),a&&a(null,e)):a&&a(Error("data format invalid"))};a.prototype.checkStateChange=function(c){var e=this._states,a=[],b;for(b in c)if("aliveMsg"!=b){var d={};d.key=b;d.value=c[b];d.changed=!1;var f=e[b]?e[b].value:null;f!=c[b]&&(d.oldvalue=f,d.changed=
!0);"burglary"!=b&&"calibrationState"!=b&&"calibrationCasement"!=b&&"calibrationHandle"!=b&&(this._states[b]={value:c[b],time:(new Date).getTime()});a.push(d)}return a};a.prototype._resolveStates=function(c,e){var a={};if(210==c[0]){var b=c.slice(1,c.length-5);if(1==b[0]&&8==b.length){var d=b[1]&239,f=(b[2]<<24)+(b[3]<<16)+(b[4]<<8)+b[5],h=b[6]>>7,a={aliveMsg:1==(b[1]&128)>>7,TBT:!1,batteryOK:!0,battery:b[6]&127,motionSensor:b[7]>>6,accelerationSensor:(b[7]&48)>>4,magneticSensor:(b[7]&12)>>2,error:b[7]&
3,count:f};h&&(a.batteryOK=!1);100<a.battery&&(a.battery=100);switch(d){case 0:a.state="closed";a.handle="closed";a.counter00=f;break;case 1:a.state="closed";a.handle="open";a.counter01=f;break;case 2:a.state="open";a.handle="open";a.counter02=f;break;case 3:a.state="closed";a.handle="tilted";a.counter03=f;break;case 4:a.state="tilted";a.handle="tilted";a.counter04=f;break;case 5:a.state="closed";a.handle="tilted";a.TBT=!0;a.counter05=f;break;case 6:a.state="tilted";a.handle="tilted";a.TBT=!0;a.counter06=
f;break;case 7:a.state="closed";a.handle="open";a.TBT=!0;a.counter07=f;break;case 8:a.state="open";a.handle="open";a.TBT=!0;a.counter08=f;break;case 9:a.state="open";a.handle="closed";a.counter09=f;break;case 10:a.state="open",a.handle="tilted",a.counter0A=f}}else if(2==b[0]&&2==b.length)switch(b[1]&15){case 1:a.burglary=!0;break;default:a.burglary=!1}else if(b[0]=2==b.length){switch((b[1]&192)>>6){case 0:a.calibrationState="ok";break;case 1:a.calibrationState="error";break;case 2:a.calibrationState=
"invalid";break;case 3:a.calibrationState="not_supported"}switch(b[1]&63){case 0:a.calibrationCasement="none";a.calibrationHandle="none";break;case 1:a.calibrationCasement="closed";a.calibrationHandle="closed";break;case 2:a.calibrationCasement="closed";a.calibrationHandle="open";break;case 3:a.calibrationCasement="closed";a.calibrationHandle="tilted";break;case 4:a.calibrationCasement="open";a.calibrationHandle="closed";break;case 5:a.calibrationCasement="open";a.calibrationHandle="open";break;case 6:a.calibrationCasement=
"open";a.calibrationHandle="tilted";break;case 7:a.calibrationCasement="tilted";a.calibrationHandle="closed";break;case 8:a.calibrationCasement="tilted";a.calibrationHandle="open";break;case 9:a.calibrationCasement="tilted",a.calibrationHandle="tilted"}}}return a};a.prototype._aliveTimeout=function(){this.activeStateChange({aliveTimeout:!0})};a.prototype.fromJSON=function(c){if(!g.prototype.fromJSON.call(this,c))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});
return this};a.prototype.fromDBJSON=function(c){if(!g.prototype.fromDBJSON.call(this,c))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});return this};var d=function(c){g.call(this,c);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.MacoWindow");this._data="d5-xx-xx";this._desc="Window";this._vendor="maco"};d.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"Mayer & Co Beschl\u00e4ge GmbH"};d.prototype=new g;d.prototype.constructor=
d;d.prototype.evalData=function(c,e,a){(c=this._resolveStates(c,e))?(c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};d.prototype._resolveStates=function(c,e){var a={};if(213==c[0]){var b=c.slice(1,c.length-5),d=(b[0]&8)>>3,f=(b[0]&6)>>1,h=b[0]&1;switch((b[0]&48)>>4){case 0:a.state="unused";break;case 1:a.state="tilted";break;case 2:a.state="open";break;case 3:a.state="closed"}a.learn=d;a.battery=f;a.alarm=h}return a};d.prototype.toDBJSON=function(){return{id:this._address,
eep:this._data,desc:this._desc,manufacturer:"Mayer & Co Beschl\u00e4ge GmbH",vendor:this._vendor}};var f=function(c){g.call(this,c);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SodaHandle");this._data="f6-so-da"};f.TEMPALTE={id:null,eep:null};f.prototype=new g;f.prototype.constructor=f;f.prototype.evalTelegram=function(c){var e={};if(246==c.rorg)switch(c.userData){case 240:e.state="tilted";break;case 192:e.state="open";break;case 208:e.state="closed"}return e};f.prototype.evalData=
function(c,e,a){(c=this.evalTelegram(e))?(c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};f.prototype.toJSON=function(c,e){return{address:this._address,data:this._data,vendor:"soda"}};f.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:"Window_Handle",manufacturer:"SODA",vendor:"soda"}};var b=function(c){g.call(this,c);this._data="f6-??-??"};b.prototype=new g;b.prototype.constructor=b;var h=function(c){b.call(this,c);this._data="f6-01-01";this._longPressThreshold=
1E3};h.STATES=["button"];h.COMMANDS=["shortPress","longPress","press","release"];h.prototype=new b;h.prototype.constructor=k;h.prototype.evalTelegram=function(c){var e={};246==c.rorg&&(e.button=c.userData>>4&1?"pressed":"released");return e};h.prototype.buildData=function(c){return c<<4};h.prototype.checkStateChange=function(c){var e=this._states,a=[],b=(new Date).getTime(),d;for(d in c){var f={};f.key=d;f.value=c[d];f.changed=!1;var h=e[d]?e[d].value:null,g=e[d]?e[d].time:null,k=c[d];h!=k&&(f.oldvalue=
h,f.changed=!0);this._states[d]={value:c[d],time:b};f.changed&&a.push(f);"pressed"==h&&"released"==k&&(!g||b-g<this._longPressThreshold?(f={},f.key=d,f.value="shortPress"):(f={},f.key=d,f.value="longPress"),f.changed=!0,a.push(f))}return a};h.prototype.executeCommand=function(c,e,a){if(this._senderID){var b,d;if(e&&e.value){var f=this,h=100;switch(e.value){case "longPress":h=this._longPressThreshold;case "shortPress":b=this.buildData(1);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,
0,null);c.sendTelegram(d,!0,function(e){e?a&&a(e):(f.activeStateChange({button:"pressed"}),setTimeout(function(){b=f.buildData(0);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,f._senderID,1,1,0,null);c.sendTelegram(d,!0,function(c){f.activeStateChange({button:"released"});a&&a(c)})},h))});break;case "press":b=this.buildData(1);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,0,null);c.sendTelegram(d,!0,function(c){f.activeStateChange({button:"pressed"});a&&a(c)});break;case "release":b=this.buildData(0),
d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,0,null),c.sendTelegram(d,!0,function(c){f.activeStateChange({button:"released"});a&&a(c)})}}else a&&a(Error("command invalid"))}else a&&a(Error("sender id is null"))};var k=function(c){b.call(this,c);this._data="f6-02-01";this._longPressThreshold=1E3};k.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];k.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");
k.prototype=new b;k.prototype.constructor=k;k.prototype.evalTelegram=function(c){var e={};if(246==c.rorg){var a=c.userData>>5&7,b=c.userData>>1&7,d=c.userData&1,f=c.t21,h=c.nu;c=c.userData>>4&1?"pressed":"released";var g,k,l,m;if(1==f&&1==h){switch(a){case 0:g=c;break;case 1:k=c;break;case 2:l=c;break;case 3:m=c}if(d)switch(b){case 0:g=c;break;case 1:k=c;break;case 2:l=c;break;case 3:m=c}}else if(1==f&&0==h)switch(a){case 0:m=l=k=g=c}g&&(e.buttonAI=g);k&&(e.buttonAO=k);l&&(e.buttonBI=l);m&&(e.buttonBO=
m)}return e};k.prototype.buildData=function(c,e,a,b){return c<<5|e<<4|a<<1|b};k.prototype.checkStateChange=function(c){var e=this._states,a=[],b=(new Date).getTime(),d;for(d in c){var f={};f.key=d;f.value=c[d];f.changed=!1;var h=e[d]?e[d].value:null,g=e[d]?e[d].time:null,k=c[d];h!=k&&(f.oldvalue=h,f.changed=!0);this._states[d]={value:c[d],time:b};f.changed&&a.push(f);"pressed"==h&&"released"==k&&(!g||b-g<this._longPressThreshold?(f={},f.key=d,f.value="shortPress"):(f={},f.key=d,f.value="longPress"),
f.changed=!0,a.push(f))}return a};k.prototype.executeCommand=function(c,e,a){if(this._senderID){var b,d;if(e&&e.value){var f=this,h=100,g=e.value.substr(e.value.length-2),k={},l=0;switch(g){case "AI":l=0;break;case "AO":l=1;break;case "BI":l=2;break;case "BO":l=3}switch(e.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":h=this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":b=this.buildData(l,1,0,0);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,
this._senderID,1,1,0,null);c.sendTelegram(d,!0,function(e){e?a&&a(e):(k["button"+g]="pressed",f.activeStateChange(k),setTimeout(function(){b=f.buildData(0,0,0,0);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,f._senderID,1,1,0,null);c.sendTelegram(d,!0,function(c){k["button"+g]="released";f.activeStateChange(k);a&&a(c)})},h))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":b=this.buildData(l,1,0,0);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,0,null);c.sendTelegram(d,
!0,function(c){k["button"+g]="pressed";f.activeStateChange(k);a&&a(c)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":b=f.buildData(0,0,0,0);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,0,null);c.sendTelegram(d,!0,function(c){k["button"+g]="released";f.activeStateChange(k);a&&a(c)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"))}else a&&a(Error("sender id is null"))};var l=function(c){k.call(this,c);this._data="f6-02-02"};
k.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];l.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");l.prototype=new k;l.prototype.constructor=l;var m=function(c){b.call(this,c);this._data="f6-02-03"};m.STATES=["state"];m.COMMANDS=["auto","manu","dimUp","dimDown"];m.prototype=new b;m.prototype.constructor=m;m.prototype.evalTelegram=function(c){var e=
{};if(246==c.rorg)switch(c.userData){case 48:e.state="auto";break;case 16:e.state="manu";break;case 112:e.state="dimUp";break;case 80:e.state="dimDown"}return e};m.prototype.executeCommand=function(c,e,a){if(this._senderID){var b;if(e&&e.value){switch(e.value){case "auto":b=48;break;case "manu":b=16;break;case "dimUp":b=112;break;case "dimDown":b=80;break;default:a&&a(Error("unknow command"))}this.activeStateChange({state:e.value});e=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,0,null);
c.sendTelegram(e,!0,function(c){a&&a(c)})}else a&&a(Error("command invalid"))}else a&&a(Error("sender id is null"))};var n=function(c){k.call(this,c);this._data="f6-02-04";this._longPressThreshold=1E3};n.STATES=["buttonAI","buttonAO","buttonBI","buttonBO","energyBow"];n.prototype=new k;n.prototype.constructor=n;n.prototype.evalTelegram=function(c){var e={};if(246==c.rorg){var a=c.userData>>3&1,b=c.userData>>2&1,d=c.userData>>1&1,f=c.userData&1;e.energyBow=c.userData>>7&1?"pressed":"released";e.buttonBI=
a?"pressed":"released";e.buttonBO=b?"pressed":"released";e.buttonAI=d?"pressed":"released";e.buttonAO=f?"pressed":"released"}return e};var q=function(c){k.call(this,c);this._data="f6-03-01";this._longPressThreshold=1E3};q.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");q.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");
q.prototype=new k;q.prototype.constructor=q;q.prototype.evalTelegram=function(c){var e={};if(246==c.rorg){var a=c.userData>>5&7,b=c.userData>>1&7,d=c.userData&1,f=c.t21,h=c.nu;c=c.userData>>4&1?"pressed":"released";var g,k,l,m,n,p,q,r;if(0==f&&1==h){switch(a){case 0:g=c;break;case 1:k=c;break;case 2:l=c;break;case 3:m=c;break;case 4:n=c;break;case 5:p=c;break;case 6:q=c;break;case 7:r=c}if(d)switch(b){case 0:g=c;break;case 1:k=c;break;case 2:l=c;break;case 3:m=c;break;case 4:n=c;break;case 5:p=c;
break;case 6:q=c;break;case 7:r=c}}else if(0==f&&0==h)switch(a){case 0:case 7:r=q=p=n=m=l=k=g=c}g&&(e.buttonAI=g);k&&(e.buttonAO=k);l&&(e.buttonBI=l);m&&(e.buttonBO=m);n&&(e.buttonCI=n);p&&(e.buttonCO=p);q&&(e.buttonDI=q);r&&(e.buttonDO=r)}return e};q.prototype.executeCommand=function(c,e,a){if(this._senderID){var b,d;if(e&&e.value){var f=this,h=100,g=e.value.substr(e.value.length-2),k={},l=0;switch(g){case "AI":l=0;break;case "AO":l=1;break;case "BI":l=2;break;case "BO":l=3;break;case "CI":l=4;break;
case "CO":l=5;break;case "DI":l=6;break;case "DO":l=7}switch(e.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":case "longPressCI":case "longPressCO":case "longPressDI":case "longPressDO":h=this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":case "shortPressCI":case "shortPressCO":case "shortPressDI":case "shortPressDO":b=this.buildData(l,1,0,0);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,0,null);
c.sendTelegram(d,!0,function(e){e?a&&a(e):(k["button"+g]="pressed",f.activeStateChange(k),setTimeout(function(){b=f.buildData(0,0,0,0);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,f._senderID,1,1,0,null);c.sendTelegram(d,!0,function(c){k["button"+g]="released";f.activeStateChange(k);a&&a(c)})},h))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":case "pressCI":case "pressCO":case "pressDI":case "pressDO":b=this.buildData(l,1,0,0);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,
1,1,0,null);c.sendTelegram(d,!0,function(c){k["button"+g]="pressed";f.activeStateChange(k);a&&a(c)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":case "releaseCI":case "releaseCO":case "releaseDI":case "releaseDO":b=f.buildData(0,0,0,0);d=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,0,null);c.sendTelegram(d,!0,function(c){k["button"+g]="released";f.activeStateChange(k);a&&a(c)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"))}else a&&
a(Error("sender id is null"))};var t=function(c){q.call(this,c);this._data="f6-03-02"};t.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");t.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");
t.prototype=new q;t.prototype.constructor=t;var A=function(c){b.call(this,c);this._data="f6-04-01"};A.STATES=["keycard"];A.prototype=new b;A.prototype.constructor=A;A.prototype.evalTelegram=function(c){var e={};if(246==c.rorg){var a=c.t21,b=c.nu;c=c.userData;1==a&&1==b&&112==c?e.keycard="inserted":1==a&&0==b&&0==c&&(e.keycard="takeout")}return e};var H=function(c){b.call(this,c);this._data="f6-04-02"};H.STATES=["keycard"];H.prototype=new b;H.prototype.constructor=H;H.prototype.evalTelegram=function(c){var e=
{};if(246==c.rorg){var a=c.userData>>7&1;c=c.userData>>2&1;1==a&&1==c?e.keycard="inserted":0==a&&0==c&&(e.keycard="takeout")}return e};var F=function(c){b.call(this,c);this._data="f6-05-00"};F.STATES=["wind","lowbat"];F.prototype=new b;F.prototype.constructor=F;F.prototype.evalTelegram=function(c){var e={};if(246==c.rorg)switch(c.userData){case 0:e.wind="ok";this._states.lowbat||(e.lowbat=!1);break;case 16:e.wind="alarm";this._states.lowbat||(e.lowbat=!1);break;case 48:e.lowbat=!0}return e};var G=
function(c){b.call(this,c);this._data="f6-05-01"};q.COMMANDS=["reset"];G.STATES=["water"];G.prototype=new b;G.prototype.constructor=G;G.prototype.evalTelegram=function(c){var e={};if(246==c.rorg){var a=c.nu,b=c.userData;1==c.t21&&1==a&&17==b&&(e.water="alarm")}return e};G.prototype.executeCommand=function(c,e,a){if(e&&e.value)switch(e.value){case "reset":this.activeStateChange({water:"ok"});a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};var w=function(c){b.call(this,
c);this._data="f6-05-02"};w.STATES=["smoke","lowbat"];w.prototype=new b;w.prototype.constructor=w;w.prototype.evalTelegram=function(c){var e={};if(246==c.rorg)switch(c.userData){case 0:e.smoke="ok";this._states.lowbat||(e.lowbat=!1);break;case 16:e.smoke="alarm";this._states.lowbat||(e.lowbat=!1);break;case 48:e.lowbat=!0}return e};var J=function(c){b.call(this,c);this._data="f6-10-00"};J.STATES=["window","handle_pos","handle_raw"];J.prototype=new b;J.prototype.constructor=J;J.prototype.evalTelegram=
function(c){var e={};246==c.rorg&&(c=c.userData,0==(c&208^192)?(e.window="open",e.handle_pos="middle"):0==(c&240^240)?(e.window="closed",e.handle_pos="down"):0==(c&240^208)&&(e.window="tilted",e.handle_pos="up"),e.handle_raw=c);return e};var W=function(c){b.call(this,c);this._data="f6-10-01"};W.STATES=["window","handle_pos","handle_raw"];W.prototype=new b;W.prototype.constructor=W;W.prototype.evalTelegram=function(c){var e={};246==c.rorg&&(c=c.userData&15,0==(c&13^12)?(e.window="open",e.handle_pos=
"middle"):0==(c&15^15)?(e.window="closed",e.handle_pos="down"):0==(c&15^13)&&(e.window="tilted",e.handle_pos="up"),e.handle_raw=c);return e};var P=function(c){g.call(this,c);this._data="d5-??-??"};P.prototype=new g;P.prototype.constructor=P;var E=function(c){P.call(this,c);this._data="d5-00-01"};E.STATES=["contact","contact_raw"];E.prototype=new P;E.prototype.constructor=E;E.prototype.evalTelegram=function(c){var e={};213==c.rorg&&(c=c.userData,1==(c>>3&1)&&(c&=1,e.contact=c?"closed":"open",e.contact_raw=
c));return e};var r=function(c){g.call(this,c);this._data="a5-??-??";this.TEACH_IN_VARIATION=2;this.UNIQUE_GATEWAY_SENDERID=!0};r.prototype=new g;r.prototype.constructor=r;r.prototype.getTeachinType=function(){return"4BS"};r.prototype.isTeachinBidirectional=function(){return!1};var p=function(c){r.call(this,c);this._data="a5-02-??";this._tmpMin=-40;this._tmpMax=0};p.STATES=["temperature","temperature_raw"];p.prototype=new r;p.prototype.constructor=p;p.prototype.evalTelegram=function(c){var e={};if(165==
c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);1==(a>>3&1)&&(e.temperature=parseFloat(((255-c)/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),e.temperature_raw=c)}return e};var M=function(c){p.call(this,c);this._data="a5-02-01";this._tmpMin=-40;this._tmpMax=0};M.STATES=["temperature","temperature_raw"];M.prototype=new p;M.prototype.constructor=M;var X=function(c){p.call(this,c);this._data="a5-02-02";this._tmpMin=-30;this._tmpMax=10};X.STATES=["temperature","temperature_raw"];
X.prototype=new p;X.prototype.constructor=X;var S=function(c){p.call(this,c);this._data="a5-02-03";this._tmpMin=-20;this._tmpMax=20};S.STATES=["temperature","temperature_raw"];S.prototype=new p;S.prototype.constructor=S;var T=function(c){p.call(this,c);this._data="a5-02-04";this._tmpMin=-10;this._tmpMax=30};T.STATES=["temperature","temperature_raw"];T.prototype=new p;T.prototype.constructor=T;var u=function(c){p.call(this,c);this._data="a5-02-05";this._tmpMin=0;this._tmpMax=40};u.STATES=["temperature",
"temperature_raw"];u.prototype=new p;u.prototype.constructor=u;var Ob=function(c){p.call(this,c);this._data="a5-02-06";this._tmpMin=10;this._tmpMax=50};Ob.STATES=["temperature","temperature_raw"];Ob.prototype=new p;Ob.prototype.constructor=Ob;var Pb=function(c){p.call(this,c);this._data="a5-02-07";this._tmpMin=20;this._tmpMax=60};Pb.STATES=["temperature","temperature_raw"];Pb.prototype=new p;Pb.prototype.constructor=Pb;var Qb=function(c){p.call(this,c);this._data="a5-02-08";this._tmpMin=30;this._tmpMax=
70};Qb.STATES=["temperature","temperature_raw"];Qb.prototype=new p;Qb.prototype.constructor=Qb;var Rb=function(c){p.call(this,c);this._data="a5-02-09";this._tmpMin=40;this._tmpMax=80};Rb.STATES=["temperature","temperature_raw"];Rb.prototype=new p;Rb.prototype.constructor=Rb;var Sb=function(c){p.call(this,c);this._data="a5-02-0a";this._tmpMin=50;this._tmpMax=90};Sb.STATES=["temperature","temperature_raw"];Sb.prototype=new p;Sb.prototype.constructor=Sb;var Tb=function(c){p.call(this,c);this._data="a5-02-0b";
this._tmpMin=60;this._tmpMax=100};Tb.STATES=["temperature","temperature_raw"];Tb.prototype=new p;Tb.prototype.constructor=Tb;var Ub=function(c){p.call(this,c);this._data="a5-02-10";this._tmpMin=-60;this._tmpMax=20};Ub.STATES=["temperature","temperature_raw"];Ub.prototype=new p;Ub.prototype.constructor=Ub;var Vb=function(c){p.call(this,c);this._data="a5-02-11";this._tmpMin=-50;this._tmpMax=30};Vb.STATES=["temperature","temperature_raw"];Vb.prototype=new p;Vb.prototype.constructor=Vb;var Wb=function(c){p.call(this,
c);this._data="a5-02-12";this._tmpMin=-40;this._tmpMax=40};Wb.STATES=["temperature","temperature_raw"];Wb.prototype=new p;Wb.prototype.constructor=Wb;var Xb=function(c){p.call(this,c);this._data="a5-02-13";this._tmpMin=-30;this._tmpMax=50};Xb.STATES=["temperature","temperature_raw"];Xb.prototype=new p;Xb.prototype.constructor=Xb;var Yb=function(c){p.call(this,c);this._data="a5-02-14";this._tmpMin=-20;this._tmpMax=60};Yb.STATES=["temperature","temperature_raw"];Yb.prototype=new p;Yb.prototype.constructor=
Yb;var Zb=function(c){p.call(this,c);this._data="a5-02-15";this._tmpMin=-10;this._tmpMax=70};Zb.STATES=["temperature","temperature_raw"];Zb.prototype=new p;Zb.prototype.constructor=Zb;var $b=function(c){p.call(this,c);this._data="a5-02-16";this._tmpMin=0;this._tmpMax=80};$b.STATES=["temperature","temperature_raw"];$b.prototype=new p;$b.prototype.constructor=$b;var ac=function(c){p.call(this,c);this._data="a5-02-17";this._tmpMin=10;this._tmpMax=90};ac.STATES=["temperature","temperature_raw"];ac.prototype=
new p;ac.prototype.constructor=ac;var bc=function(c){p.call(this,c);this._data="a5-02-18";this._tmpMin=20;this._tmpMax=100};bc.STATES=["temperature","temperature_raw"];bc.prototype=new p;bc.prototype.constructor=bc;var cc=function(c){p.call(this,c);this._data="a5-02-19";this._tmpMin=30;this._tmpMax=110};cc.STATES=["temperature","temperature_raw"];cc.prototype=new p;cc.prototype.constructor=cc;var dc=function(c){p.call(this,c);this._data="a5-02-1a";this._tmpMin=40;this._tmpMax=120};dc.STATES=["temperature",
"temperature_raw"];dc.prototype=new p;dc.prototype.constructor=dc;var ec=function(c){p.call(this,c);this._data="a5-02-1b";this._tmpMin=50;this._tmpMax=130};ec.STATES=["temperature","temperature_raw"];ec.prototype=new p;ec.prototype.constructor=ec;var ua=function(c){r.call(this,c);this._data="a5-02-20";this._tmpMin=-10;this._tmpMax=41.2};ua.STATES=["temperature","temperature_raw"];ua.prototype=new r;ua.prototype.constructor=ua;ua.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);
c=c.userData.readUInt16BE(1);1==(a>>3&1)&&(a=c&1023,e.temperature=parseFloat(((1023-a)/1023*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),e.temperature_raw=a)}return e};var fc=function(c){ua.call(this,c);this._data="a5-02-30";this._tmpMin=-40;this._tmpMax=62.3};fc.STATES=["temperature","temperature_raw"];fc.prototype=new ua;fc.prototype.constructor=fc;var aa=function(c){r.call(this,c);this._data="a5-04-??";this._humMin=0;this._humMax=100;this._tempMin=0;this._tempMax=40};aa.STATES=["humidity",
"humidity_raw","temperature","temperature_raw","available"];aa.prototype=new r;aa.prototype.constructor=aa;aa.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt8(1);1==(a>>3&1)&&(e.humidity=parseFloat((c/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),e.humidity_raw=c,e.temperature=parseFloat((b/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),e.temperature_raw=b,e.available=a>>1&1?!0:!1)}return e};
var gc=function(c){aa.call(this,c);this._data="a5-04-01"};gc.STATES=aa.STATES;gc.prototype=new aa;gc.prototype.constructor=gc;var Ca=function(c){aa.call(this,c);this._data="a5-04-02";this._tempMin=-20;this._tempMax=60};Ca.STATES=aa.STATES;Ca.prototype=new aa;Ca.prototype.constructor=Ca;var Qa=function(c){aa.call(this,c);this._data="a5-04-03";this._tempMin=-20;this._tempMax=60};Qa.STATES=["humidity","humidity_raw","temperature","temperature_raw","type"];Qa.prototype=new aa;Qa.prototype.constructor=
Qa;Qa.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(e.humidity=parseFloat((c/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),e.humidity_raw=c,b&=1023,e.temperature=parseFloat((b/1023*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),e.temperature_raw=b,e.type=a&1?"event":"heartbeat")}return e};var K=function(c){r.call(this,c);this._data="a5-06-??";this._svcMin=0;this._svcMax=
5.1;this._ill2Min=300;this._ill2Max=3E4;this._ill1Min=600;this._ill1Max=6E4};K.STATES="voltage voltage_raw illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw range range_raw".split(" ");K.prototype=new r;K.prototype.constructor=K;K.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.voltage=parseFloat((c/255*(this._svcMax-
this._svcMin)+this._svcMin).toFixed(1));e.voltage_raw=c;e.illumination2=parseFloat((d/255*(this._ill2Max-this._ill2Min)+this._ill2Min).toFixed(1));e.illumination2_raw=d;e.illumination1=parseFloat((b/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1));e.illumination1_raw=b;a&=1;switch(a){case 0:e.range="db1";e.illumination=e.illumination1;e.illumination_raw=b;break;case 1:e.range="db2",e.illumination=e.illumination2,e.illumination_raw=b}e.range_raw=a}}return e};var Da=function(c){K.call(this,
c);this._data="a5-06-01"};Da.STATES=K.STATES;Da.prototype=new K;Da.prototype.constructor=Da;var va=function(c){K.call(this,c);this._data="a5-06-02";this._ill2Min=0;this._ill2Max=510;this._ill1Min=0;this._ill1Max=1020};va.STATES=K.STATES;va.prototype=new K;va.prototype.constructor=va;var Ra=function(c){K.call(this,c);this._data="a5-06-03";this._svcMin=0;this._svcMax=5.1};Ra.STATES=["voltage","voltage_raw","illumination","illumination_raw"];Ra.prototype=new K;Ra.prototype.constructor=Ra;Ra.prototype.evalTelegram=
function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(e.voltage=parseFloat((c/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),e.voltage_raw=c,a=b>>6&1023,e.illumination=a,e.illumination_raw=a)}return e};var Sa=function(c){K.call(this,c);this._data="a5-06-04";this._tmpMin=-20;this._tmpMax=60};Sa.STATES="temperature temperature_raw illumination illumination_raw energy energy_raw temperature_avail energy_avail".split(" ");
Sa.prototype=new K;Sa.prototype.constructor=Sa;Sa.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(e.temperature=parseFloat((c/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),e.temperature_raw=c,e.illumination=b,e.illumination_raw=b,b=a>>4&15,e.energy=parseFloat((b/15*100).toFixed(1)),e.energy_raw=b,e.temperature_avail=a>>1&1?!0:!1,e.temperature_avail||delete e.temperature,e.energy_avail=
a&1?!0:!1,e.energy_avail||delete e.energy)}return e};var hc=function(c){K.call(this,c);this._data="a5-06-05";this._ill2Min=0;this._ill2Max=5100;this._ill1Min=0;this._ill1Max=10200};hc.STATES=K.STATES;hc.prototype=new K;hc.prototype.constructor=hc;var Q=function(c){r.call(this,c);this._data="a5-07-??";this._params||(this._params={reset_timeout:30});this._resetTO=null};Q.COMMANDS=["reset"];Q.prototype=new r;Q.prototype.constructor=Q;Q.prototype._startPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),
this._resetTO=null);if(this._params.reset_timeout&&!(0>this._params.reset_timeout)){var c=this;this._resetTO=setTimeout(function(){c._resetTO=null;c._reset()},1E3*this._params.reset_timeout)}};Q.prototype._stopPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null)};Q.prototype._reset=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null);var c={key:"state",value:"off",changed:!1},e=this._states.state?this._states.state.value:null;e!=v&&(c.oldvalue=
e,c.changed=!0);this._states.state={value:"off",time:(new Date).getTime()};require("x.hub.m.enocean.js")._onEOEvents(this,[c])};Q.prototype.executeCommand=function(c,e,a){if(e&&e.value)switch(e.value){case "reset":this._reset();a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};Q.prototype.fromJSON=function(c){if(!g.prototype.fromJSON.call(this,c))return null;this._params||(this._params={reset_timeout:30});return this};Q.prototype.fromDBJSON=function(c){if(!g.prototype.fromDBJSON.call(this,
c))return null;this._params||(this._params={reset_timeout:30});return this};var Ea=function(c){Q.call(this,c);this._data="a5-07-01"};Ea.COMMANDS=["reset"];Ea.STATES=["voltage","voltage_raw","state","state_raw","voltage_avail"];Ea.prototype=new Q;Ea.prototype.constructor=Ea;Ea.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt8(0);1==(a>>3&1)&&(e.voltage=parseFloat((c/250*5).toFixed(1)),e.voltage_raw=c,e.state=128<=
b?"on":"off",e.state_raw=b,e.voltage_avail=a&1?!0:!1,e.voltage_avail||delete e.voltage)}"on"==e.state?this._startPIROffTO():"off"==e.state&&this._stopPIROffTO();return e};var Fa=function(c){Q.call(this,c);this._data="a5-07-02"};Fa.COMMANDS=["reset"];Fa.STATES=["voltage","voltage_raw","state","state_raw"];Fa.prototype=new Q;Fa.prototype.constructor=Fa;Fa.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);1==(a>>3&1)&&(e.voltage=parseFloat((c/
250*5).toFixed(1)),e.voltage_raw=c,a=a>>7&1,e.state=a?"on":"off",e.state_raw=a)}"on"==e.state?this._startPIROffTO():"off"==e.state&&this._stopPIROffTO();return e};var Ga=function(c){Q.call(this,c);this._data="a5-07-03"};Ga.COMMANDS=["reset"];Ga.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");Ga.prototype=new Q;Ga.prototype.constructor=Ga;Ga.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=
c.userData.readUInt8(0);1==(a>>3&1)&&(e.voltage=parseFloat((c/250*5).toFixed(1)),e.voltage_raw=c,b=b>>6&1023,e.illumination=b,e.illumination_raw=b,a=a>>7&1,e.state=a?"on":"off",e.state_raw=a)}"on"==e.state?this._startPIROffTO():"off"==e.state&&this._stopPIROffTO();return e};var ma=function(c){r.call(this,c);this._data="a5-08-??";this._svcMin=0;this._svcMax=5.1;this._illMin=0;this._illMax=510;this._tmpMin=0;this._tmpMax=51};ma.prototype=new r;ma.prototype.constructor=ma;ma.prototype.evalTelegram=function(c){var e=
{};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.voltage=parseFloat((c/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));e.voltage_raw=c;e.illumination=parseFloat((d/255*(this._illMax-this._illMin)+this._illMin).toFixed(1));e.illumination_raw=d;e.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1));e.temperature_raw=b;b=a>>1&1;switch(b){case 0:e.state="on";break;case 1:e.state=
"off"}e.state_raw=b;a&=1;switch(a){case 0:e.button="pressed";break;case 1:e.button="released"}e.button_raw=a}}return e};var Ha=function(c){ma.call(this,c);this._data="a5-08-01"};Ha.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");Ha.prototype=new ma;Ha.prototype.constructor=Ha;var ic=function(c){ma.call(this,c);this._data="a5-08-02";this._illMax=1020};ic.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");
ic.prototype=new ma;ic.prototype.constructor=ic;var jc=function(c){ma.call(this,c);this._data="a5-08-03";this._illMax=1530;this._tmpMin=-30;this._tmpMax=50};jc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");jc.prototype=new ma;jc.prototype.constructor=jc;var B=function(c){r.call(this,c);this._data="a5-09-??"};B.prototype=new r;B.prototype.constructor=B;var Ta=function(c){B.call(this,c);this._data="a5-09-02";this._svcMin=
0;this._svcMax=5.1;this._gasMin=0;this._gasMax=1020;this._tmpMin=0;this._tmpMax=51};Ta.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available".split(" ");Ta.prototype=new B;Ta.prototype.constructor=Ta;Ta.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(e.voltage=parseFloat((c/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),
e.voltage_raw=c,e.gas=parseFloat((d/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),e.gas_raw=d,e.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),e.temperature_raw=b,a=a>>1&1,e.temperature_available=a?!0:!1,a||delete e.temperature)}return e};var Ua=function(c){B.call(this,c);this._data="a5-09-04";this._humMin=0;this._humMax=100;this._gasMin=0;this._gasMax=2550;this._tmpMin=0;this._tmpMax=51};Ua.STATES="humidity humidity_raw gas gas_raw temperature temperature_raw temperature_available humidity_available".split(" ");
Ua.prototype=new B;Ua.prototype.constructor=Ua;Ua.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(e.humidity=parseFloat((c/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),e.humidity_raw=c,e.gas=parseFloat((d/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),e.gas_raw=d,e.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),
e.temperature_raw=b,b=a>>2&1,e.humidity_available=b?!0:!1,b||delete e.humidity,a=a>>1&1,e.temperature_available=a?!0:!1,a||delete e.temperature)}return e};var Va=function(c){B.call(this,c);this._data="a5-09-05"};Va.STATES=["voc","voc_raw","voc_id","voc_id_raw","scale"];Va.prototype=new B;Va.prototype.constructor=Va;Va.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt16BE(0);if(1==(a>>3&1)){var a=a&3,d=1;switch(a){case 0:d=
.01;break;case 1:d=.1;break;case 2:d=1;break;case 3:d=10}e.scale=d;e.voc=c*d;e.voc_raw=c;switch(a){case 0:e.voc_id="VOCT";break;case 1:e.voc_id="Formaldehyde";break;case 2:e.voc_id="Benzene";break;case 3:e.voc_id="Styrene";break;case 4:e.voc_id="Toluene";break;case 5:e.voc_id="Tetrachloroethylene";break;case 6:e.voc_id="Xylene";break;case 7:e.voc_id="n-Hexane";break;case 8:e.voc_id="n-Octane";break;case 9:e.voc_id="Cyclopentane";break;case 10:e.voc_id="Methanol";break;case 11:e.voc_id="Ethanol";break;
case 12:e.voc_id="1-Pentanol";break;case 13:e.voc_id="Acetone";break;case 14:e.voc_id="ethylene Oxide";break;case 15:e.voc_id="Acetaldehyde ue";break;case 16:e.voc_id="Acetic Acid";break;case 17:e.voc_id="Propionice Acid";break;case 18:e.voc_id="Valeric Acid";break;case 19:e.voc_id="Butyric Acid";break;case 20:e.voc_id="Ammoniac";break;case 22:e.voc_id="Hydrogen Sulfide";break;case 23:e.voc_id="Dimethylsulfide";break;case 24:e.voc_id="2-Butanol";break;case 25:e.voc_id="2-Methylpropanol";break;case 26:e.voc_id=
"Diethyl ether";break;case 255:e.voc_id="ozone"}e.voc_id_raw=b}}return e};var Wa=function(c){B.call(this,c);this._data="a5-09-06"};Wa.STATES=["radon"];Wa.prototype=new B;Wa.prototype.constructor=Wa;Wa.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt16BE(0);1==(a>>3&1)&&(e.radon=c>>6&1023)}return e};var Xa=function(c){B.call(this,c);this._data="a5-09-07"};Xa.STATES="pm10 pm25 pm1 pm10_active pm25_active pm25_active".split(" ");Xa.prototype=
new B;Xa.prototype.constructor=Xa;Xa.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(2),d=c.userData.readUInt16BE(1);c=c.userData.readUInt16BE(0);1==(a>>3&1)&&(e.pm10=c>>7&511,e.pm25=d>>6&511,e.pm1=b>>5&511,b=a>>2&1,e.pm10_active=b?!0:!1,b||delete e.pm10,b=a>>1&1,e.pm25_active=b?!0:!1,b||delete e.pm25,a&=1,e.pm1_active=a?!0:!1,a||delete e.pm1)}return e};var Ya=function(c){B.call(this,c);this._data="a5-09-08"};Ya.STATES=["co2","co2_raw"];
Ya.prototype=new B;Ya.prototype.constructor=Ya;Ya.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);1==(a>>3&1)&&(e.co2=parseFloat((c/255*2E3).toFixed(1)),e.co2_raw=c)}return e};var Za=function(c){B.call(this,c);this._data="a5-09-09"};Za.STATES=["co2","co2_raw","power_failure_detected"];Za.prototype=new B;Za.prototype.constructor=Za;Za.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);
1==(a>>3&1)&&(e.co2=parseFloat((c/255*2E3).toFixed(1)),e.co2_raw=c,e.power_failure_detected=a>>2&1?!0:!1)}return e};var $a=function(c){B.call(this,c);this._data="a5-09-0a";this._svcMin=2;this._svcMax=5;this._tmpMin=-20;this._tmpMax=60};$a.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available voltage_available".split(" ");$a.prototype=new B;$a.prototype.constructor=$a;$a.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=
c.userData.readUInt8(2);c=c.userData.readUInt16BE(0);1==(a>>3&1)&&(e.gas=c,e.gas_raw=c,e.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),e.temperature_raw=b,b=a>>4&15,e.voltage=parseFloat((b/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),e.voltage_raw=b,b=a>>1&1,e.temperature_available=b?!0:!1,b||delete e.temperature,a&=1,e.voltage_available=a?!0:!1,a||delete e.voltage)}return e};var ab=function(c){B.call(this,c);this._data="a5-09-0b";this._svcMin=2;this._svcMax=
5};ab.STATES="voltage voltage_raw radio radio_raw scale unit unit_raw voltage_available".split(" ");ab.prototype=new B;ab.prototype.constructor=ab;ab.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(2);c=c.userData.readUInt8(0);if(1==(a>>3&1)){c=c>>4&15;e.voltage=parseFloat((c/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));e.voltage_raw=c;c=1;switch(a>>4&15){case 0:c=.001;break;case 1:c=.01;break;case 2:c=.1;break;case 3:c=
1;break;case 4:c=10;break;case 5:c=100;break;case 6:c=1E3;break;case 7:c=1E4;break;case 8:c=1E5}e.scale=c;e.radio=b/10*c;e.radio_raw=b;b=a>>1&3;switch(b){case 0:e.unit="\u03bcSv/h";break;case 1:e.unit="cpm";break;case 2:e.unit="Bq/L";break;case 3:e.unit="Bq/kg"}e.unit_raw=b;a&=1;e.voltage_available=a?!0:!1;a||delete e.voltage}}return e};var bb=function(c){B.call(this,c);this._data="a5-09-0c"};bb.STATES="voc voc_raw voc_id voc_id_raw unit unit_raw scale".split(" ");bb.prototype=new B;bb.prototype.constructor=
bb;bb.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt16BE(0);if(1==(a>>3&1)){var d=a&3,f=1;switch(d){case 0:f=.01;break;case 1:f=.1;break;case 2:f=1;break;case 3:f=10}e.scale=f;a=a>>1&1;switch(a){case 0:e.unit="ppb";break;case 1:e.unit="\u03bcSv/m3"}e.unit_raw=a;e.voc=c*f;e.voc_raw=c;switch(d){case 0:e.voc_id="VOCT";break;case 1:e.voc_id="Formaldehyde";break;case 2:e.voc_id="Benzene";break;case 3:e.voc_id="Styrene";
break;case 4:e.voc_id="Toluene";break;case 5:e.voc_id="Tetrachloroethylene";break;case 6:e.voc_id="Xylene";break;case 7:e.voc_id="n-Hexane";break;case 8:e.voc_id="n-Octane";break;case 9:e.voc_id="Cyclopentane";break;case 10:e.voc_id="Methanol";break;case 11:e.voc_id="Ethanol";break;case 12:e.voc_id="1-Pentanol";break;case 13:e.voc_id="Acetone";break;case 14:e.voc_id="ethylene Oxide";break;case 15:e.voc_id="Acetaldehyde ue";break;case 16:e.voc_id="Acetic Acid";break;case 17:e.voc_id="Propionice Acid";
break;case 18:e.voc_id="Valeric Acid";break;case 19:e.voc_id="Butyric Acid";break;case 20:e.voc_id="Ammoniac";break;case 22:e.voc_id="Hydrogen Sulfide";break;case 23:e.voc_id="Dimethylsulfide";break;case 24:e.voc_id="2-Butanol";break;case 25:e.voc_id="2-Methylpropanol";break;case 26:e.voc_id="Diethyl ether";break;case 27:e.voc_id="Naphthalene";break;case 28:e.voc_id="4-Phenylcyclohexene";break;case 29:e.voc_id="Limonene";break;case 30:e.voc_id="Trichloroethylene";break;case 31:e.voc_id="Isovaleric acid";
break;case 32:e.voc_id="Indole";break;case 33:e.voc_id="Cadaverine";break;case 34:e.voc_id="Putrescine";break;case 35:e.voc_id="Caproic acid";break;case 255:e.voc_id="ozone"}e.voc_id_raw=b}}return e};var Ia=function(c){r.call(this,c);this._data="a5-10-??"};Ia.prototype=new r;Ia.prototype.constructor=Ia;var z=function(c){Ia.call(this,c);this._data="a5-10-01";this._params||(this._params={minSP:18,maxSP:26})};z.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");
z.prototype=new Ia;z.prototype.constructor=z;z.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.fan_speed=144>=c?"3":164>=c?"2":189>=c?"1":209>=c?"0":"auto";e.fan_speed_raw=c;e.setpoint=parseFloat((d/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));e.setpoint_raw=d;e.temperature=parseFloat(((255-b)/255*40).toFixed(1));e.temperature_raw=
b;a&=1;switch(a){case 0:e.button="pressed";break;case 1:e.button="released"}e.button_raw=a}}return e};z.prototype.fromJSON=function(c){if(!g.prototype.fromJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};z.prototype.fromDBJSON=function(c){if(!g.prototype.fromDBJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var ca=function(c){z.call(this,c);this._data="a5-10-02"};ca.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
ca.prototype=new z;ca.prototype.constructor=ca;ca.prototype.evalTelegram=function(c){var e=z.prototype.evalTelegram.call(this,c);if(0==Object.keys(e).length)return e;delete e.button;delete e.button_raw;c=c.userData.readUInt8(3)&1;e.slider=c?"day":"night";e.slider_raw=c;return e};var wa=function(c){z.call(this,c);this._data="a5-10-03";this.TEACH_IN_VARIATION=1};wa.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];wa.prototype=new z;wa.prototype.constructor=wa;wa.prototype.evalTelegram=
function(c){c=z.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;delete c.button;delete c.button_raw;return c};var cb=function(c){z.call(this,c);this._data="a5-10-04"};cb.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw".split(" ");cb.prototype=new z;cb.prototype.constructor=cb;cb.prototype.evalTelegram=function(c){c=z.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.button;
delete c.button_raw;return c};var db=function(c){z.call(this,c);this._data="a5-10-05"};db.STATES="setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");db.prototype=new z;db.prototype.constructor=db;db.prototype.evalTelegram=function(c){c=z.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var xa=function(c){ca.call(this,c);this._data="a5-10-06"};xa.STATES="setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
xa.prototype=new ca;xa.prototype.constructor=xa;xa.prototype.evalTelegram=function(c){c=ca.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var eb=function(c){z.call(this,c);this._data="a5-10-07"};eb.STATES=["fan_speed","fan_speed_raw","temperature","temperature_raw"];eb.prototype=new z;eb.prototype.constructor=eb;eb.prototype.evalTelegram=function(c){c=z.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;
delete c.setpoint;delete c.setpoint_raw;delete c.button;delete c.button_raw;return c};var fa=function(c){z.call(this,c);this._data="a5-10-08";this._params=null};fa.STATES="fan_speed fan_speed_raw temperature temperature_raw button button_raw".split(" ");fa.prototype=new z;fa.prototype.constructor=fa;fa.prototype.evalTelegram=function(c){c=z.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};fa.prototype.fromJSON=function(c){return g.prototype.fromJSON.call(this,
c)};fa.prototype.fromDBJSON=function(c){return g.prototype.fromDBJSON.call(this,c)};var ga=function(c){ca.call(this,c);this._data="a5-10-09";this._params=null};ga.STATES="fan_speed fan_speed_raw temperature temperature_raw slider slider_raw".split(" ");ga.prototype=new ca;ga.prototype.constructor=ga;ga.prototype.evalTelegram=function(c){c=ca.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};ga.prototype.fromJSON=function(c){return g.prototype.fromJSON.call(this,
c)};ga.prototype.fromDBJSON=function(c){return g.prototype.fromDBJSON.call(this,c)};var ra=function(c){z.call(this,c);this._data="a5-10-0a"};ra.STATES="setpoint setpoint_raw temperature temperature_raw contact contact_raw".split(" ");ra.prototype=new z;ra.prototype.constructor=ra;ra.prototype.evalTelegram=function(c){var e=z.prototype.evalTelegram.call(this,c);if(0==Object.keys(e).length)return e;delete e.fan_speed;delete e.fan_speed_raw;delete e.button;delete e.button_raw;c=c.userData.readUInt8(3)&
1;e.contact=c?"open":"closed";e.contact_raw=c;return e};var ya=function(c){ra.call(this,c);this._data="a5-10-0b";this._params=null};ya.STATES=["temperature","temperature_raw","contact","contact_raw"];ya.prototype=new ra;ya.prototype.constructor=ya;ya.prototype.evalTelegram=function(c){c=ra.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};ya.prototype.fromJSON=function(c){return g.prototype.fromJSON.call(this,c)};ya.prototype.fromDBJSON=
function(c){return g.prototype.fromDBJSON.call(this,c)};var fb=function(c){fa.call(this,c);this._data="a5-10-0c"};fb.STATES=["temperature","temperature_raw","button","button_raw"];fb.prototype=new fa;fb.prototype.constructor=fb;fb.prototype.evalTelegram=function(c){c=fa.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var gb=function(c){ga.call(this,c);this._data="a5-10-0d"};gb.STATES=["temperature","temperature_raw","slider",
"slider_raw"];gb.prototype=new ga;gb.prototype.constructor=gb;gb.prototype.evalTelegram=function(c){c=ga.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var N=function(c){Ia.call(this,c);this._data="a5-10-10";this._params||(this._params={minSP:18,maxSP:26})};N.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw button button_raw".split(" ");N.prototype=new Ia;N.prototype.constructor=N;N.prototype.evalTelegram=
function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.setpoint=parseFloat((c/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));e.setpoint_raw=c;e.humidity=parseFloat((d/250*100).toFixed(1));e.humidity_raw=d;e.temperature=parseFloat((b/250*40).toFixed(1));e.temperature_raw=b;a&=1;switch(a){case 0:e.button="pressed";break;case 1:e.button="released"}e.button_raw=a}}return e};
N.prototype.fromJSON=function(c){if(!g.prototype.fromJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};N.prototype.fromDBJSON=function(c){if(!g.prototype.fromDBJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var sa=function(c){N.call(this,c);this._data="a5-10-11"};sa.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");sa.prototype=new N;sa.prototype.constructor=
sa;sa.prototype.evalTelegram=function(c){var e=N.prototype.evalTelegram.call(this,c);if(0==Object.keys(e).length)return e;delete e.button;delete e.button_raw;c=c.userData.readUInt8(3)&1;e.slider=c?"day":"night";e.slider_raw=c;return e};var hb=function(c){N.call(this,c);this._data="a5-10-12"};hb.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw".split(" ");hb.prototype=new N;hb.prototype.constructor=hb;hb.prototype.evalTelegram=function(c){c=N.prototype.evalTelegram.call(this,
c);if(0==Object.keys(c).length)return c;delete c.button;delete c.button_raw;return c};var ib=function(c){N.call(this,c);this._data="a5-10-13"};ib.STATES="humidity humidity_raw temperature temperature_raw button button_raw".split(" ");ib.prototype=new N;ib.prototype.constructor=ib;ib.prototype.evalTelegram=function(c){c=N.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};var jb=function(c){sa.call(this,c);this._data="a5-10-14"};
jb.STATES="humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");jb.prototype=new sa;jb.prototype.constructor=jb;jb.prototype.evalTelegram=function(c){c=sa.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};var Ja=function(c){r.call(this,c);this._data="a5-11-??"};Ja.prototype=new r;Ja.prototype.constructor=Ja;var kb=function(c){Ja.call(this,c);this._data="a5-11-03"};kb.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw".split(" ");
kb.prototype=new Ja;kb.prototype.constructor=kb;kb.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.position=c;c=d&127;e.angle=2*(d>>7&1?0-c:c);d=b>>7&1;e.position_flag=d?!0:!1;e.position_flag_raw=d;d=b>>6&1;e.angle_flag=d?!0:!1;e.angle_flag_raw=d;d=b>>4&3;e.error_raw=d;switch(d){case 0:e.error="no_error";break;case 1:e.error="no_end_position";break;case 2:e.error=
"intern_failure"}d=b>>2&3;e.end_position_raw=d;switch(d){case 0:e.end_position="no_end_position";break;case 1:e.end_position="end_position_not_reach";break;case 2:e.end_position="fully_open";break;case 3:e.end_position="fully_closed"}b&=3;e.state_raw=b;switch(b){case 0:e.state="no_status";break;case 1:e.state="stopped";break;case 2:e.state="opens";break;case 3:e.state="closes"}e.service_mode=a>>7&1;e.position_mode=a>>6&1}}return e};var Ka=function(c){Ja.call(this,c);this._data="a5-11-04"};Ka.STATES=
"state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");Ka.prototype=new Ja;Ka.prototype.constructor=Ka;Ka.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.service_mode=a>>7&1;var f=a>>6&1;e.op_hour_flag=
f?!0:!1;e.op_hour_flag_raw=f;f=a>>4&3;e.error_raw=f;switch(f){case 0:e.error="no_error";break;case 1:e.error="lamp_failure";break;case 2:e.error="intern_failure";break;case 3:e.error="extern_failure"}f=a&1;e.state=f?"on":"off";e.state_raw=f;a=a>>1&3;e.mode_raw=a;switch(a){case 0:e.level=c;e.op_hour=d<<8|b;break;case 1:a=c.toString(16);2>a.length&&(a="0"+a);d=d.toString(16);2>d.length&&(d="0"+d);b=b.toString(16);2>b.length&&(b="0"+b);e.rgb=a.toUpperCase()+d.toUpperCase()+b.toUpperCase();break;case 2:e.power_raw=
c<<8|d,e.power_unit_raw=b,d="mW W kW MW Wh kWh MWh GWh mA 1/10A mV 1/10V".split(" "),3>=b?(e.power=e.power_raw,e.power_unit=d[b]):7>=b?(e.energy=e.power_raw,e.energy_unit=d[b]):9>=b?(e.current=e.power_raw,e.current_unit=d[b]):11>=b&&(e.voltage=e.power_raw,e.voltage_unit=d[b])}}}return e};var Y=function(c){r.call(this,c);this._data="a5-12-??"};Y.STATES="meter_raw channel_raw type_raw scale_raw scale meter current cumulative".split(" ");Y.prototype=new r;Y.prototype.constructor=Y;Y.prototype.evalTelegram=
function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt32BE(0);if(1==(a>>3&1)){c=c>>8&16777215;e.meter_raw=c;e.channel_raw=a>>4&15;var b=a>>2&1;e.type_raw=b;a&=3;e.scale_raw=a;switch(a){case 0:e.scale=1;e.meter=c;break;case 1:e.scale=.1;e.meter=.1*c;break;case 2:e.scale=.01;e.meter=.01*c;break;case 3:e.scale=.001,e.meter=.001*c}b?e.current=e.meter:e.cumulative=e.meter}}return e};var lb=function(c){Y.call(this,c);this._data="a5-12-00"};lb.STATES=["current","counter",
"channel"];lb.prototype=new Y;lb.prototype.constructor=lb;lb.prototype.evalTelegram=function(c){c=Y.prototype.evalTelegram.call(this,c);c.counter=c.cumulative;c.channel=c.channel_raw;return c};var da=function(c){Y.call(this,c);this._data="a5-12-01"};da.STATES=["power","energy","tariff"];da.prototype=new Y;da.prototype.constructor=da;da.prototype.evalTelegram=function(c){c=Y.prototype.evalTelegram.call(this,c);c.energy=c.cumulative;c.power=c.current;c.tariff=c.channel_raw;return c};var za=function(c){Y.call(this,
c);this._data="a5-12-02"};za.STATES=["volume","flow","tariff"];za.prototype=new Y;za.prototype.constructor=za;za.prototype.evalTelegram=function(c){c=Y.prototype.evalTelegram.call(this,c);c.volume=c.cumulative;c.flow=c.current;c.tariff=c.channel_raw;return c};var kc=function(c){za.call(this,c);this._data="a5-12-03"};kc.STATES=["volume","flow","tariff"];kc.prototype=new za;kc.prototype.constructor=kc;var O=function(c){r.call(this,c);this._data="a5-13-??"};O.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
O.prototype=new r;O.prototype.constructor=O;O.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1),f=c.userData.readUInt8(0);if(1==(a>>3&1))switch(a>>4&15){case 1:e.lux=parseFloat((f/255*1E3).toFixed(1));e.lux_raw=f;var h=d;e.temperature=parseFloat((h/255*120-40).toFixed(1));e.temperature_raw=h;e.wind=parseFloat((b/255*70).toFixed(1));e.wind_raw=b;e.day_night=a>>2&1?"night":"day";e.rain=a>>1&1?"true":"false";
break;case 2:e.sun_west=parseFloat((f/255*150).toFixed(1));e.sun_west_raw=f;e.sun_south=parseFloat((d/255*150).toFixed(1));e.sun_south_raw=h;e.sun_east=parseFloat((b/255*150).toFixed(1));e.sun_east_raw=b;e.hemisphere=a>>2&1?"south":"north";break;case 3:e.day=f&15;e.month=d&7;e.year=(b&127)+2E3;e.date_src=a&1?"gps":"rtc";break;case 4:e.weekday=f>>5&7;e.hour=f&31;e.min=d&63;e.sec=b&63;e.time_format=a>>2&1?"12":"24";e.am_pm=a>>1&1?"pm":"am";e.time_src=a&1?"gps":"rtc";break;case 5:e.elv=f-90;e.elv_raw=
f;b=c.userData.readUInt16BE(1)&511;e.azm=b;e.azm_raw=b;break;case 6:c=(f>>4&15)<<8|d,b|=(f&15)<<8,e.latitude=parseFloat((c/4095*180-90).toFixed(1)),e.latitude_raw=c,e.longitude=parseFloat((b/4095*360-180).toFixed(1)),e.longitude_raw=b}}return e};var lc=function(c){O.call(this,c);this._data="a5-13-01"};lc.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
lc.prototype=new O;lc.prototype.constructor=lc;var mc=function(c){O.call(this,c);this._data="a5-13-02"};mc.STATES="sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere".split(" ");mc.prototype=new O;mc.prototype.constructor=mc;var nc=function(c){O.call(this,c);this._data="a5-13-03"};nc.STATES=["day","month","year","date_src"];nc.prototype=new O;nc.prototype.constructor=nc;var oc=function(c){O.call(this,c);this._data="a5-13-04"};oc.STATES="weekday hour min sec time_format am_pm time_src".split(" ");
oc.prototype=new O;oc.prototype.constructor=oc;var pc=function(c){O.call(this,c);this._data="a5-13-05"};pc.STATES=["elv","azm"];pc.prototype=new O;pc.prototype.constructor=pc;var qc=function(c){O.call(this,c);this._data="a5-13-06"};qc.STATES=["latitude","longitude"];qc.prototype=new O;qc.prototype.constructor=qc;var mb=function(c){g.call(this,c);this._data="a5-14-01"};mb.STATES=["voltage","voltage_raw","state"];mb.prototype=new g;mb.prototype.constructor=mb;mb.prototype.evalTelegram=function(c){var e=
{};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.voltage=c/250*5;e.voltage_raw=c;a&=1;switch(a){case 0:e.state="closed";break;case 1:e.state="open"}e.state_raw=a}}return e};var nb=function(c){g.call(this,c);this._data="a5-14-02"};nb.STATES=["voltage","voltage_raw","illumination","illumination_raw","state"];nb.prototype=new g;nb.prototype.constructor=nb;nb.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(1);
c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(e.voltage=c/250*5,e.voltage_raw=c,e.illumination=b/250*1E3,e.illumination_raw=b,a&=1,e.state_raw=a,a){case 0:e.state="closed";break;case 1:e.state="open"}}return e};var ob=function(c){g.call(this,c);this._data="a5-14-03"};ob.STATES=["voltage","voltage_raw","state","viberation"];ob.prototype=new g;ob.prototype.constructor=ob;ob.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>
3&1)){e.voltage=c/250*5;e.voltage_raw=c;switch(a&1){case 0:e.state="closed";break;case 1:e.state="open"}switch(a>>1&1){case 0:e.viberation=!1;break;case 1:e.viberation=!0}}}return e};var pb=function(c){g.call(this,c);this._data="a5-14-04"};pb.STATES="voltage voltage_raw illumination illumination_raw state viberation".split(" ");pb.prototype=new g;pb.prototype.constructor=pb;pb.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(1);c=c.userData.readUInt8(0);
if(1==(a>>3&1)){e.voltage=c/250*5;e.voltage_raw=c;e.illumination=b/250*1E3;e.illumination_raw=b;switch(a&1){case 0:e.state="closed";break;case 1:e.state="open"}switch(a>>1&1){case 0:e.viberation=!1;break;case 1:e.viberation=!0}}}return e};var qb=function(c){g.call(this,c);this._data="a5-14-05"};qb.STATES=["voltage","voltage_raw","viberation"];qb.prototype=new g;qb.prototype.constructor=qb;qb.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);
if(1==(a>>3&1))switch(e.voltage=c/250*5,e.voltage_raw=c,a>>1&1){case 0:e.viberation=!1;break;case 1:e.viberation=!0}}return e};var rb=function(c){g.call(this,c);this._data="a5-14-06"};rb.STATES=["voltage","voltage_raw","illumination","illumination_raw","viberation"];rb.prototype=new g;rb.prototype.constructor=rb;rb.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(e.voltage=c/250*5,e.voltage_raw=
c,e.illumination=b/250*1E3,e.illumination_raw=b,a>>1&1){case 0:e.viberation=!1;break;case 1:e.viberation=!0}}return e};var sb=function(c){g.call(this,c);this._data="a5-14-07"};sb.STATES=["voltage","voltage_raw","state","lock"];sb.prototype=new g;sb.prototype.constructor=sb;sb.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.voltage=c/250*5;e.voltage_raw=c;switch(a>>2&1){case 0:e.state="closed";break;case 1:e.state=
"open"}switch(a>>1&1){case 0:e.lock="locked";break;case 1:e.lock="unlocked"}}}return e};var tb=function(c){g.call(this,c);this._data="a5-14-08"};tb.STATES=["voltage","voltage_raw","state","lock","viberation"];tb.prototype=new g;tb.prototype.constructor=tb;tb.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.voltage=c/250*5;e.voltage_raw=c;switch(a>>2&1){case 0:e.state="closed";break;case 1:e.state="open"}switch(a>>
1&1){case 0:e.lock="locked";break;case 1:e.lock="unlocked"}switch(a&1){case 0:e.viberation=!1;break;case 1:e.viberation=!0}}}return e};var ub=function(c){g.call(this,c);this._data="a5-14-09"};ub.STATES=["voltage","voltage_raw","state"];ub.prototype=new g;ub.prototype.constructor=ub;ub.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(e.voltage=c/250*5,e.voltage_raw=c,a>>1&3){case 0:e.state="closed";break;case 1:e.state=
"tilted";break;case 2:e.state="reserved";break;case 3:e.state="open"}}return e};var vb=function(c){g.call(this,c);this._data="a5-14-0a"};vb.STATES=["voltage","voltage_raw","state","viberation"];vb.prototype=new g;vb.prototype.constructor=vb;vb.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.voltage=c/250*5;e.voltage_raw=c;switch(a>>1&3){case 0:e.state="closed";break;case 1:e.state="tilted";break;case 2:e.state="reserved";
break;case 3:e.state="open"}switch(a&1){case 0:e.viberation=!1;break;case 1:e.viberation=!0}}}return e};var ba=function(c){r.call(this,c);this._data="a5-20-04";this.TEACH_IN_VARIATION=3;this._defaultSetpoint=15;this._defaultWakeupCycle=3;this._defaultDisplay=0;this._states={pending:{value:!1,time:(new Date).getTime()}};this._service_command_new=this._button_lock_new=this._display_new=this._wakeup_cycle_new=this._measurement_new=this._setpoint_new=this._valve_new=null};ba.COMMANDS="setValve setTo up down measureOn measureOff setWakeup setDisplay buttonLock buttonUnlock openValve closeValve init".split(" ");
ba.STATES="valve measurement button_lock temperature_selection feed_temperature setpoint error temperature wakeup_cycle display pending".split(" ");ba.prototype=new r;ba.prototype.constructor=ba;ba.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.wakeup_cycle||null==this._params.wakeup_cycle)this._params.wakeup_cycle=this._defaultWakeupCycle;if("undefined"==typeof this._params.display||null==this._params.display)this._params.display=this._defaultDisplay};
ba.prototype.getStatesBuffer=function(){var c=JSON.parse(JSON.stringify(this._states));c.wakeup_cycle={value:this._params.wakeup_cycle,time:-1};c.display={value:this._params.display,time:-1};"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(c.wakeup_cycle={value:this._wakeup_cycle_new,time:-1});"undefined"!=typeof this._display_new&&null!=this._display_new&&(c.display={value:this._display_new,time:-1});"undefined"!=typeof this._valve_new&&null!=this._valve_new&&(c.valve={value:this._valve_new,
time:-1});"undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new&&(c.setpoint={value:this._setpoint_new,time:-1});"undefined"!=typeof this._measurement_new&&null!=this._measurement_new&&(c.measurement={value:this._measurement_new,time:-1});"undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new&&(c.button_lock={value:this._button_lock_new,time:-1});return c};ba.prototype.getCurrentStates=function(){var c={},e=this.getStatesBuffer(),a;for(a in e)e.hasOwnProperty(a)&&e[a]&&
(c[a]=e[a].value);return c};ba.prototype.executeCommand=function(c,e,a){var b=(new Date).getTime();if(e&&e.value){"setValve"==e.value.substr(0,8)&&8<e.value.length?(c=e.value.substr(8),e={value:"setValve",ext:c}):"setTo"==e.value.substr(0,5)&&5<e.value.length?(c=e.value.substr(5),e={value:"setTo",ext:c}):"up"==e.value.substr(0,2)&&2<e.value.length?(c=e.value.substr(2),e={value:"up",ext:c}):"down"==e.value.substr(0,4)&&4<e.value.length?(c=e.value.substr(4),e={value:"down",ext:c}):"setWakeup"==e.value.substr(0,
9)&&9<e.value.length?(c=e.value.substr(9),e={value:"setWakeup",ext:c}):"setDisplay"==e.value.substr(0,10)&&10<e.value.length&&(c=e.value.substr(10),e={value:"setDisplay",ext:c});var d=[];switch(e.value){case "setValve":if("undefined"==typeof e.ext||null==e.ext){a&&a(Error("set valve value invalid"));return}c=parseInt(e.ext);0>c&&(c=0);100<c&&(c=100);this._valve_new=c;this._states.pending={value:!0,time:b};e={key:"valve",value:c,changed:!1};b=this._states.valve?this._states.valve.value:null;b!=c&&
(e.oldvalue=b,e.changed=!0);d.push(e);break;case "setTo":if("undefined"==typeof e.ext||null==e.ext){a&&a(Error("set valve value invalid"));return}c=parseFloat(e.ext);10>c&&(c=10);30<c&&(c=30);this._setpoint_new=c;this._states.pending={value:!0,time:b};e={key:"setpoint",value:this._setpoint_new,changed:!1};b=this._states.setpoint?this._states.setpoint.value:null;b!=this._setpoint_new&&(e.oldvalue=b,e.changed=!0);d.push(e);break;case "up":(c=e.ext)||(c=.5);c=parseFloat(c);if("undefined"!=typeof this._setpoint_new&&
null!=this._setpoint_new)this._setpoint_new+=c;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value+c;else{a&&a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_new=10);30<this._setpoint_new&&(this._setpoint_new=30);this._states.pending={value:!0,time:b};e={key:"setpoint",value:this._setpoint_new,changed:!1};b=this._states.setpoint?this._states.setpoint.value:
null;b!=this._setpoint_new&&(e.oldvalue=b,e.changed=!0);d.push(e);break;case "down":(c=e.ext)||(c=.5);c=parseFloat(c);if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new-=c;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value-c;else{a&&a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_ne=10);30<this._setpoint_new&&
(this._setpoint_new=30);this._states.pending={value:!0,time:b};e={key:"setpoint",value:this._setpoint_new,changed:!1};b=this._states.setpoint?this._states.setpoint.value:null;b!=this._setpoint_new&&(e.oldvalue=b,e.changed=!0);d.push(e);break;case "measureOn":this._measurement_new="active";this._states.pending={value:!0,time:b};e={key:"measurement",value:this._measurement_new,changed:!1};b=this._states.measurement?this._states.measurement.value:null;b!=this._measurement_new&&(e.oldvalue=b,e.changed=
!0);d.push(e);break;case "measureOff":this._measurement_new="inactive";this._states.pending={value:!0,time:b};e={key:"measurement",value:this._measurement_new,changed:!1};b=this._states.measurement?this._states.measurement.value:null;b!=this._measurement_new&&(e.oldvalue=b,e.changed=!0);d.push(e);break;case "setWakeup":if("undefined"==typeof e.ext||null==e.ext){a&&a(Error("set wakup cycle value invalid"));return}this._wakeup_cycle_new=c=parseInt(e.ext);this._states.pending={value:!0,time:b};e={key:"wakeup_cycle",
value:this._wakeup_cycle_new,changed:!1};b=this._params.wakeup_cycle;b!=this._wakeup_cycle_new&&(e.oldvalue=b,e.changed=!0);d.push(e);break;case "setDisplay":if("undefined"==typeof e.ext||null==e.ext){a&&a(Error("set display orientation value invalid"));return}this._display_new=c=parseInt(e.ext);this._states.pending={value:!0,time:b};e={key:"display",value:this._display_new,changed:!1};b=this._params.display;b!=this._display_new&&(e.oldvalue=b,e.changed=!0);d.push(e);break;case "buttonLock":this._button_lock_new=
"locked";this._states.pending={value:!0,time:b};e={key:"button_lock",value:this._button_lock_new,changed:!1};b=this._states.button_lock?this._states.button_lock.value:null;b!=this._button_lock_new&&(e.oldvalue=b,e.changed=!0);d.push(e);break;case "buttonUnlock":this._button_lock_new="unlocked";this._states.pending={value:!0,time:b};e={key:"button_lock",value:this._button_lock_new,changed:!1};b=this._states.button_lock?this._states.button_lock.value:null;b!=this._button_lock_new&&(e.oldvalue=b,e.changed=
!0);d.push(e);break;case "openValve":this._service_command_new=1;this._states.pending={value:!0,time:b};break;case "closeValve":this._service_command_new=3;this._states.pending={value:!0,time:b};break;case "init":this._service_command_new=2,this._states.pending={value:!0,time:b}}0<d.length&&require("x.hub.m.enocean.js")._onEOEvents(this,d);a&&a()}else a&&a(Error("command invalid"))};ba.prototype.evalData=function(c,e,a){if(e=this.evalTelegram(e)){var b=this;this._sendResponse(c,e,function(c,e){var d=
b.checkStateChange(e);a&&a(null,d)})}else a&&a(Error("data format invalid"))};ba.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){e.valve=c;e.measurement=a>>7&1?"inactive":"active";e.button_lock=a>>2&1?"locked":"unlocked";c=a>>1&1;a&=1;e.temperature_selection=c?"setpoint":"feed_temperature";switch(c){case 0:e.feed_temperature=parseFloat((d/255*60+20).toFixed(1));break;
case 1:e.setpoint=parseFloat((d/255*20+10).toFixed(1))}if(0==a)e.error="no_error",e.temperature=parseFloat((b/255*20+10).toFixed(1));else switch(b){case 17:e.error="measurement_error";break;case 18:e.error="battery_empty";break;case 20:e.error="frost_protection";break;case 33:e.error="blocked_valve";break;case 36:e.error="end_point_detection_error";break;case 40:e.error="no_valve";break;case 49:e.error="not_taught_in";break;case 53:e.error="no_response_from_controller";break;case 54:e.error="teach_in_error";
break;default:e.error="unknow_error"}}}return e};ba.prototype._sendResponse=function(c,e,a){var b=(new Date).getTime(),d=JSON.parse(JSON.stringify(e));this._states.pending={value:!1,time:b};var f=!1,h;"undefined"!=typeof this._valve_new&&null!=this._valve_new?(h=this._valve_new,this._states.valve={value:this._valve_new,time:b},this._valve_new=null,delete d.valve):h="undefined"!=typeof e.valve&&null!=e.valve?e.valve:this._states.valve?this._states.valve.value:null;if("undefined"==typeof h||null==h)h=
0,d.valve=0;var g;"undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new?(g=Math.round((this._setpoint_new-10)/20*255),this._states.setpoint={value:this._setpoint_new,time:b},this._setpoint_new=null,delete d.setpoint):"undefined"!=typeof e.setpoint&&null!=e.setpoint?g=Math.round((e.setpoint-10)/20*255):this._states.setpoint&&"undefined"!=this._states.setpoint.value&&null!=this._states.setpoint.value&&(g=Math.round((this._states.setpoint.value-10)/20*255));if("undefined"==typeof g||null==
g)g=this._defaultSetpoint,g=Math.round((g-10)/20*255),d.setpoint=this._defaultSetpoint;var k;"undefined"!=typeof this._measurement_new&&null!=this._measurement_new?(k="active"==this._measurement_new?0:1,this._states.measurement={value:this._measurement_new,time:b},this._measurement_new=null,delete d.measurement):"undefined"!=typeof e.measurement&&null!=e.measurement?k="active"==e.measurement?0:1:this._states.measurement&&"undefined"!=this._states.measurement.value&&null!=this._states.measurement.value&&
(k="active"==this._states.measurement.value?0:1);if("undefined"==typeof k||null==k)k=0,d.measurement="active";var l=this._params.wakeup_cycle;"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(l=this._wakeup_cycle_new,this._params.wakeup_cycle=this._wakeup_cycle_new,f=!0,this._wakeup_cycle_new=null);if("undefined"==typeof l||null==l)l=this._defaultWakeupCycle,this._params.wakeup_cycle=l;var m=this._params.display;"undefined"!=typeof this._display_new&&null!=this._display_new&&
(m=this._display_new,this._params.display=this._display_new,f=!0,this._display_new=null);if("undefined"==typeof m||null==m)m=this._defaultDisplay,this._params.display=m;var n;"undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new?(n="locked"==this._button_lock_new?1:0,this._states.button_lock={value:this._button_lock_new,time:b},this._button_lock_new=null,delete d.button_lock):"undefined"!=typeof e.button_lock&&null!=e.button_lock?n="locked"==e.button_lock?1:0:this._states.button_lock&&
this._states.button_lock.value&&(n="locked"==this._states.button_lock.value?1:0);if("undefined"==typeof n||null==n)n=0,d.button_lock="unlocked";e=0;"undefined"!=typeof this._service_command_new&&null!=this._service_command_new&&(e=this._service_command_new,this._service_command_new=null);h=new Buffer([h,g,(k&1)<<6|l&63,(m&3)<<4|8|(n&1)<<2|e&3]);f&&require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated();f=this._senderID;f||(f=x.hub.m.enocean.SENDER_ID);f=new x.hub.m.enocean.ESP3.Telegram.ADT(165,
h,this._address,f,0);c.sendTelegram(f,!0,function(c){a&&a(c,d)})};var La=function(c){r.call(this,c);this._data="a5-30-??"};La.prototype=new r;La.prototype.constructor=La;var Aa=function(c){g.call(this,c);this._data="a5-30-01"};Aa.STATES=["battery_low","battery_raw","state","state_raw"];Aa.prototype=new La;Aa.prototype.constructor=Aa;Aa.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt8(1);1==(a>>3&1)&&(e.battery_low=
120>=c?!0:!1,e.battery_raw=c,e.state=195>=b?"closed":"open",e.state_raw=b)}return e};var wb=function(c){g.call(this,c);this._data="a5-30-01\u00b4"};wb.STATES=["state"];wb.prototype=new La;wb.prototype.constructor=wb;wb.prototype.evalTelegram=function(c){var e={};165==c.rorg&&(c=c.userData.readUInt8(3),1==(c>>3&1)&&(e.state=c&1?"open":"closed"));return e};var na=function(c){g.call(this,c);this._data="a5-30-03"};na.STATES="temperature temperature_raw wake input3 input2 input1 input0".split(" ");na.prototype=
new La;na.prototype.constructor=na;na.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt8(1);1==(a>>3&1)&&(e.temperature=(255-c)/255*40,e.temperature_raw=c,e.wake=b>>4&1,e.input3=b>>3&1,e.input2=b>>2&1,e.input1=b>>1&1,e.input0=b&1)}return e};var xb=function(c){g.call(this,c);this._data="a5-30-04"};xb.STATES=["analog_input","input2","input1","input0"];xb.prototype=new La;xb.prototype.constructor=xb;xb.prototype.evalTelegram=
function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);1==(a>>3&1)&&(e.analog_input=c,e.input2=a>>2&1,e.input1=a>>1&1,e.input0=a&1)}return e};var rc=function(c){r.call(this,c);this._data="a5-38-??"};rc.prototype=new r;rc.prototype.constructor=rc;var R=function(c){rc.call(this,c);this._data="a5-38-08"};R.prototype=new rc;R.prototype.constructor=R;R.prototype.evalTelegram=function(c){var e={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),
d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(c){case 2:e.level=Math.round(d/255*100),e.ramp=b,e.dim_range=a>>2&1?"relative":"absolute",e.store_final_value=a>>1&1,e.state=a&1?"on":"off"}}return e};R.prototype.switching=function(c,e,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);e=new Buffer([1,e.TIM>>8&255,e.TIM&255,8|(e.LCK&1)<<2|(e.DEL&1)<<1|e.SW&1]);b=new x.hub.m.enocean.ESP3.Telegram.BS4(e,b,0);b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&
a(c)})};R.prototype.dimming=function(c,e,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);e=new Buffer([2,e.EDIM,e.RMP,8|(e.EDIMR&1)<<2|(e.STR&1)<<1|e.SW&1]);b=new x.hub.m.enocean.ESP3.Telegram.BS4(e,b,0);b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&a(c)})};R.prototype.blind=function(c,e,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);e=new Buffer([7,e.P1,e.P2,(e.FUNC&15)<<4|8|(e.SSF&1)<<2|(e.PAF&1)<<1|e.SMF&1]);b=new x.hub.m.enocean.ESP3.Telegram.BS4(e,
b,0);b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&a(c)})};var sc=function(c){r.call(this,c);this._data="a5-3F-7F"};sc.prototype=new r;sc.prototype.constructor=sc;var Z=function(c){g.call(this,c);this._data="d2-??-??";this.UNIQUE_GATEWAY_SENDERID=!0};Z.prototype=new g;Z.prototype.constructor=Z;var C=function(c){Z.call(this,c);this._data="d2-01-??";this._lastQuery={};this._initCount=0};C.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");
C.prototype=new Z;C.prototype.constructor=C;C.prototype.init=function(c){var e=this.getIOs();if(0<e.length){var a=require("x.hub.m.enocean.js")._esp3,b=0,d=this,f=function(){b++;b<e.length?d.statusQuery(a,{IO:e[b]},f):c&&c()};this.statusQuery(a,{IO:e[b]},f)}else c&&c()};C.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length?(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):
this._initCount=0;return this._states};C.prototype.getIOs=function(){return[]};C.prototype.setOutput=function(c,e,a){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);e=new Buffer([1,(e.DV&7)<<5|e.IO&31,e.OV&127]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(e,b,0);this._senderID!=this._address&&b.setDstId(this._address);c.sendTelegram(b,!0,function(c){a&&a(c)})};C.prototype.setLocal=function(c,e,a){e=new Buffer([(e.DE&1)<<7|2,(e.OC&1)<<7|(e.RO&1)<<6|(e.LC&1)<<5|e.IO&31,(e.DT2&15)<<4|
e.DT3&15,(e.DN&1)<<7|(e.PF&1)<<6|(e.DS&3)<<4|e.DT1&15]);e=new x.hub.m.enocean.ESP3.Telegram.VLD(e,x.hub.m.enocean.SENDER_ID,0);e.setDstId(this._address);c.sendTelegram(e,!0,function(c){a&&a(c)})};C.prototype.statusQuery=function(c,e,a){this._senderID?(this._lastQuery[e.IO]=(new Date).getTime(),e=new Buffer([3,e.IO&31]),e=new x.hub.m.enocean.ESP3.Telegram.VLD(e,this._senderID,0),e.setDstId(this._address),c.sendTelegram(e,!0,function(c){a&&a(c)})):a&&a(Error("no senderID"))};C.prototype.measurementQuery=
function(c,e,a){e=new Buffer([6,(e.QU&1)<<5|e.IO&31]);e=new x.hub.m.enocean.ESP3.Telegram.VLD(e,this._senderID,0);e.setDstId(this._address);c.sendTelegram(e,!0,function(c){a&&a(c)})};C.prototype.evalTelegram=function(c){var e={};if(210==c.rorg){var a=c.userData.readUInt8(0);switch(a&15){case 4:if(3==c.userData.length){var b=a>>7&1,d=a>>6&1,a=c.userData.readUInt8(1),f=a>>7&1,h=a>>5&3,g=a&31,a=c.userData.readUInt8(2);c=a&127;e.power_failure_detection=b?!0:!1;e.power_failure=d?!0:!1;e.over_current_switch_off=
f;e.error_level=h;e.io_channel=g;e.local_control=a>>7&1?!0:!1;e.output_value=c;e.output_state=c?"on":"off"}break;case 7:if(6==c.userData.length){a=c.userData.readUInt8(1);b=a>>5&7;g=a&31;a=c.userData.readUInt32BE(2);switch(b){case 0:e.unit="Ws";break;case 1:e.unit="Wh";break;case 2:e.unit="KWh";break;case 3:e.unit="W";break;case 4:e.unit="KW"}e.io_channel=g;e.value=a}}}return e};var ea=function(c){C.call(this,c);this._data="d2-01-00"};ea.COMMANDS=["on","off","toggle"];ea.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");
ea.prototype=new C;ea.prototype.constructor=ea;ea.prototype.getIOs=function(){return[0]};ea.prototype.executeCommand=function(c,e,a){if(e&&e.value){var b=this;switch(e.value){case "on":this.activeStateChange({output_value:100,output_state:"on"});this.setOutput(c,{DV:0,IO:0,OV:100},a);break;case "off":this.activeStateChange({output_value:0,output_state:"off"});this.setOutput(c,{DV:0,IO:0,OV:0},a);break;case "toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){b._states.output_state?
b.executeCommand(c,e,a):a&&a(Error("unkown current status"))},200)});break}this.executeCommand(c,{value:"on"==this._states.output_state.value?"off":"on"},a)}}else a&&a(Error("command invalid"))};var yb=function(c){ea.call(this,c);this._data="d2-01-01"};yb.COMMANDS=["on","off","toggle"];yb.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");yb.prototype=new ea;yb.prototype.constructor=yb;var zb=function(c){ea.call(this,
c);this._data="d2-01-03";this._lastOnLevel=-1};zb.prototype=new ea;zb.prototype.constructor=zb;zb.prototype.evalData=function(c,e,a){(c=this.evalTelegram(e))?((0==c.output_value||"off"==c.output_state)&&this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value),c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};zb.prototype.executeCommand=function(c,e,a){if(e&&e.value){var b;"dimTo"==e.value.substr(0,5)&&5<e.value.length?
(b=e.value.substr(5),e={value:"dimTo",ext:b}):"toggleTo"==e.value.substr(0,8)&&8<e.value.length&&(b=e.value.substr(8),e={value:"toggleTo",ext:b});(new Date).getTime();var d=this;switch(e.value){case "on":b=this._lastOnLevel;if(-1==b||0==b)b=100;this.setOutput(c,{DV:0,IO:0,OV:b},function(c){c||d.activeStateChange({output_value:b,output_state:"on"});a&&a(c)});break;case "off":this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value);this.setOutput(c,
{DV:0,IO:0,OV:0},function(c){c||d.activeStateChange({output_value:0,output_state:"off"});a&&a(c)});break;case "toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(c,e,a):a&&a(Error("unkown current status"))},200)});break}this.executeCommand(c,{value:"on"==this._states.output_state.value?"off":"on"},a);break;case "toggleTo":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(c,
e,a):a&&a(Error("unkown current status"))},200)});break}"on"==this._states.output_state.value?this.executeCommand(c,{value:"off"},a):this.executeCommand(c,{value:"dimTo",ext:e.ext},a);break;case "dimTo":if("undefined"==typeof e.ext||null==e.ext){a&&a(Error("dim to value invalid"));break}b=parseFloat(e.ext);0>b&&(b=0);100<b&&(b=100);this.setOutput(c,{DV:0,IO:0,OV:b},function(c){c||d.activeStateChange({output_value:b,output_state:0==b?"off":"on"});a&&a(c)});break;case "dimUp":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?
d.executeCommand(c,e,a):a&&a(Error("unkown current status"))},200)});break}b=parseInt(this._states.output_value.value);b+=5;100<b&&(b=100);this.executeCommand(c,{value:"dimTo",ext:b},a);break;case "dimDown":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(c,e,a):a&&a(Error("unkown current status"))},200)});break}b=parseInt(this._states.output_value.value);b-=5;0>b&&(b=0);this.executeCommand(c,{value:"dimTo",ext:b},a);break;default:a&&
a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var ta=function(c){C.call(this,c);this._data="d2-01-11"};ta.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle".split(" ");ta.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state".split(" ");ta.prototype=new C;ta.prototype.constructor=ta;ta.prototype.getIOs=function(){return[0,1]};ta.prototype.evalTelegram=
function(c){if(c=C.prototype.evalTelegram.call(this,c))switch(c.io_channel){case 0:c.ch1_output_value=c.output_value;c.ch1_output_state=c.output_state;break;case 1:c.ch2_output_value=c.output_value,c.ch2_output_state=c.output_state}return c};ta.prototype.executeCommand=function(c,e,a){if(e&&e.value){var b=this,d;switch(e.value){case "ch1On":this.activeStateChange({ch1_output_value:100,ch1_output_state:"on"});this.setOutput(c,{DV:0,IO:0,OV:100},a);break;case "ch1Off":this.activeStateChange({ch1_output_value:0,
ch1_output_state:"off"});this.setOutput(c,{DV:0,IO:0,OV:0},a);break;case "ch1Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){b._states.output_state?b.executeCommand(c,e,a):a&&a(Error("unkown current status"))},200)});break}d="on"==this._states.ch1_output_state.value?"off":"on";this.activeStateChange({ch1_output_value:"on"==d?100:0,ch1_output_state:d});this.executeCommand(c,{value:"on"==d?"ch1On":"ch1Off"},a);break;case "ch2On":this.activeStateChange({ch2_output_value:100,
ch2_output_state:"on"});this.setOutput(c,{DV:0,IO:1,OV:100},a);break;case "ch2Off":this.activeStateChange({ch2_output_value:0,ch2_output_state:"off"});this.setOutput(c,{DV:0,IO:1,OV:0},a);break;case "ch2Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){b._states.output_state?b.executeCommand(c,e,a):a&&a(Error("unkown current status"))},200)});break}d="on"==this._states.ch2_output_state.value?"off":"on";this.activeStateChange({ch2_output_value:"on"==d?100:0,ch2_output_state:d});
this.executeCommand(c,{value:"on"==d?"ch2On":"ch2Off"},a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var ha=function(c){C.call(this,c);this._data="d2-01-13";this._queryInterval=3E4};ha.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle".split(" ");ha.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state".split(" ");
ha.prototype=new C;ha.prototype.constructor=ha;ha.prototype.getStatesBuffer=function(){var c=[];this._states.ch1_output_state||(!this._lastQuery[0]||now-this._lastQuery[0]>this._queryInterval)&&c.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||now-this._lastQuery[1]>this._queryInterval)&&c.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||now-this._lastQuery[2]>this._queryInterval)&&c.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||now-this._lastQuery[3]>this._queryInterval)&&
c.push(3);0<c.length&&this._queryStates(c);return this._states};ha.prototype._queryStates=function(c,e){var a=require("x.hub.m.enocean.js")._esp3,b=0,d=this,f=function(){b++;b<c.length?d.statusQuery(a,{IO:c[b]},f):e&&e()};this.statusQuery(a,{IO:c[b]},f)};ha.prototype.getIOs=function(){return[0,1,2,3]};ha.prototype.evalTelegram=function(c){if(c=C.prototype.evalTelegram.call(this,c))switch(c.io_channel){case 0:c.ch1_output_value=c.output_value;c.ch1_output_state=c.output_state;break;case 1:c.ch2_output_value=
c.output_value;c.ch2_output_state=c.output_state;break;case 2:c.ch3_output_value=c.output_value;c.ch3_output_state=c.output_state;break;case 3:c.ch4_output_value=c.output_value,c.ch4_output_state=c.output_state}return c};ha.prototype.executeCommand=function(c,e,a){if(e&&e.value){var b=this,d,f,h,g,k;switch(e.value?e.value.substr(0,3):null){case "ch1":f=0;h="ch1_output_value";g="ch1_output_state";break;case "ch2":f=1;h="ch2_output_value";g="ch2_output_state";break;case "ch3":f=2;h="ch3_output_value";
g="ch3_output_state";break;case "ch4":f=3,h="ch4_output_value",g="ch4_output_state"}switch(e.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":k={};k[h]=100;k[g]="on";d={DV:0,IO:f,OV:100};this.activeStateChange(k);this.setOutput(c,d,a);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":k={};k[h]=0;k[g]="off";d={DV:0,IO:f,OV:0};this.activeStateChange(k);this.setOutput(c,d,a);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){b._states.output_state?
b.executeCommand(c,e,a):a&&a(Error("unkown current status"))},200)});break}if(!this._states[g]){a&&a(Error("state unknown"));break}d="on"==this._states[g].value?"off":"on";k={};k[h]="on"==d?100:0;k[g]=d;d={DV:0,IO:f,OV:"on"==d?100:0};this.activeStateChange(k);this.setOutput(c,d,a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var ia=function(c){C.call(this,c);this._data="d2-01-14";this._queryInterval=3E4};ia.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle ch5On ch5Off ch5Toggle ch6On ch6Off ch6Toggle ch7On ch7Off ch7Toggle ch8On ch8Off ch8Toggle".split(" ");
ia.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state ch5_output_value ch5_output_state ch6_output_value ch6_output_state ch7_output_value ch7_output_state ch8_output_value ch8_output_state".split(" ");ia.prototype=new C;ia.prototype.constructor=ia;ia.prototype._queryStates=function(c,
e){var a=require("x.hub.m.enocean.js")._esp3,b=0,d=this,f=function(){b++;b<c.length?d.statusQuery(a,{IO:c[b]},f):e&&e()};this.statusQuery(a,{IO:c[b]},f)};ia.prototype.getStatesBuffer=function(){var c=(new Date).getTime(),e=[];this._states.ch1_output_state||(!this._lastQuery[0]||c-this._lastQuery[0]>this._queryInterval)&&e.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||c-this._lastQuery[1]>this._queryInterval)&&e.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||c-this._lastQuery[2]>
this._queryInterval)&&e.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||c-this._lastQuery[3]>this._queryInterval)&&e.push(3);this._states.ch5_output_state||(!this._lastQuery[4]||c-this._lastQuery[4]>this._queryInterval)&&e.push(4);this._states.ch6_output_state||(!this._lastQuery[5]||c-this._lastQuery[5]>this._queryInterval)&&e.push(5);this._states.ch7_output_state||(!this._lastQuery[6]||c-this._lastQuery[6]>this._queryInterval)&&e.push(6);this._states.ch8_output_state||(!this._lastQuery[7]||
c-this._lastQuery[7]>this._queryInterval)&&e.push(7);0<e.length&&this._queryStates(e);return this._states};ia.prototype.getIOs=function(){return[0,1,2,3,4,5,6,7]};ia.prototype.evalTelegram=function(c){if(c=C.prototype.evalTelegram.call(this,c))switch(c.io_channel){case 0:c.ch1_output_value=c.output_value;c.ch1_output_state=c.output_state;break;case 1:c.ch2_output_value=c.output_value;c.ch2_output_state=c.output_state;break;case 2:c.ch3_output_value=c.output_value;c.ch3_output_state=c.output_state;
break;case 3:c.ch4_output_value=c.output_value;c.ch4_output_state=c.output_state;break;case 4:c.ch5_output_value=c.output_value;c.ch5_output_state=c.output_state;break;case 5:c.ch6_output_value=c.output_value;c.ch6_output_state=c.output_state;break;case 6:c.ch7_output_value=c.output_value;c.ch7_output_state=c.output_state;break;case 7:c.ch8_output_value=c.output_value,c.ch8_output_state=c.output_state}return c};ia.prototype.executeCommand=function(c,e,a){if(e&&e.value){var b=this,d,f,h,g,k;switch(e.value?
e.value.substr(0,3):null){case "ch1":f=0;h="ch1_output_value";g="ch1_output_state";break;case "ch2":f=1;h="ch2_output_value";g="ch2_output_state";break;case "ch3":f=2;h="ch3_output_value";g="ch3_output_state";break;case "ch4":f=3;h="ch4_output_value";g="ch4_output_state";break;case "ch5":f=4;h="ch5_output_value";g="ch5_output_state";break;case "ch6":f=5;h="ch6_output_value";g="ch6_output_state";break;case "ch7":f=6;h="ch7_output_value";g="ch7_output_state";break;case "ch8":f=7,h="ch8_output_value",
g="ch8_output_state"}switch(e.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":case "ch5On":case "ch6On":case "ch7On":case "ch8On":k={};k[h]=100;k[g]="on";d={DV:0,IO:f,OV:100};this.activeStateChange(k);this.setOutput(c,d,a);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":case "ch5Off":case "ch6Off":case "ch7Off":case "ch8Off":k={};k[h]=0;k[g]="off";d={DV:0,IO:f,OV:0};this.activeStateChange(k);this.setOutput(c,d,a);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":case "ch5Toggle":case "ch6Toggle":case "ch7Toggle":case "ch8Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){b._states.output_state?
b.executeCommand(c,e,a):a&&a(Error("unkown current status"))},200)});break}if(!this._states[g]){a&&a(Error("state unknown"));break}d="on"==this._states[g].value?"off":"on";k={};k[h]="on"==d?100:0;k[g]=d;d={DV:0,IO:f,OV:"on"==d?100:0};this.activeStateChange(k);this.setOutput(c,d,a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var tc=function(c){Z.call(this,c);this._data="d2-05-??"};tc.prototype=new Z;tc.prototype.constructor=tc;var L=function(c){tc.call(this,c);
this._data="d2-05-00"};L.COMMANDS="moveUp moveDown moveTo stepUp stepDown lamellaUp lamellaDown lamellaTo stop setRunTime setRotationTime setParams[15.2s]:[10,20,30ms]:[0-3]".split(" ");L.STATES=["state","angle","lock","channel"];L.prototype=new tc;L.prototype.constructor=L;L.prototype.init=function(c){var a=require("x.hub.m.enocean.js")._esp3;this.query(a,{CHN:0},c)};L.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length&&this.init();return this._states};L.prototype.goToPositionAngle=
function(c,a,b){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);a=new Buffer([a.POS&127,a.ANG&127,(a.REPO&7)<<4|a.LOCK&7,(a.CHN&15)<<4|1]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(a,d,0);d.setDstId(this._address);c.sendTelegram(d,!0,function(c){b&&b(c)})};L.prototype.stop=function(c,a,b){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);a=new Buffer([(a.CHN&15)<<4|2]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(a,d,0);d.setDstId(this._address);c.sendTelegram(d,!0,function(c){b&&
b(c)})};L.prototype.query=function(c,a,b){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);a=new Buffer([(a.CHN&15)<<4|3]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(a,d,0);d.setDstId(this._address);c.sendTelegram(d,!0,function(c){b&&b(c)})};L.prototype.setParameters=function(c,a,b){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);a=new Buffer([a.VERT>>8&127,a.VERT&255,a.ROT&255,a.AA&7,(a.CHN&15)<<4|5]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(a,d,0);d.setDstId(this._address);
c.sendTelegram(d,!0,function(c){b&&b(c)})};L.prototype.evalTelegram=function(c){var a={};if(210==c.rorg){var b;switch(c.userData.readUInt8(c.userData.length-1)&15){case 4:if(4==c.userData.length){b=c.userData.readUInt8(0);a.state=b&127;b=c.userData.readUInt8(1);a.angle=b&127;b=c.userData.readUInt8(2);switch(b&7){case 0:a.lock="normal";break;case 1:a.lock="blockage_mode";break;case 2:a.lock="alarm_mode"}b=c.userData.readUInt8(3);a.channel=b>>4&15}}}return a};L.prototype.executeCommand=function(c,a,
b){if(a&&a.value){var d;"moveTo"==a.value.substr(0,6)&&6<a.value.length?(d=a.value.substr(6),a={value:"moveTo",ext:d}):"lamellaTo"==a.value.substr(0,9)&&9<a.value.length?(d=a.value.substr(9),a={value:"lamellaTo",ext:d}):"setRunTime"==a.value.substr(0,10)&&10<a.value.length?(d=a.value.substr(10),a={value:"setRunTime",ext:d}):"setRotationTime"==a.value.substr(0,15)&&15<a.value.length?(d=a.value.substr(15),a={value:"setRotationTime",ext:d}):"setParams"==a.value.substr(0,9)&&9<a.value.length&&(d=a.value.substr(9),
a={value:"setParams",ext:d});var f=(new Date).getTime(),h=this;switch(a.value){case "moveUp":this.goToPositionAngle(c,{POS:0,ANG:0,REPO:0,LOCK:0,CHN:0},b);break;case "moveDown":this.goToPositionAngle(c,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:0},b);break;case "moveTo":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("move to value invalid"));break}d=parseFloat(a.ext);0>d&&(d=0);100<d&&(d=100);this._states.state={value:d,time:f};this.goToPositionAngle(c,{POS:d,ANG:255,REPO:0,LOCK:0,CHN:0},b);break;
case "stepUp":if(!this._states.state){this.init(function(){setTimeout(function(){h._states.state?h.executeCommand(c,a,b):b&&b(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){b&&b(Error("device status unknonw"));break}0!=this._states.angle.value?(d=this._states.angle.value-10,0>d&&(d=0),this._states.angle={value:d,time:f},this.goToPositionAngle(c,{POS:255,ANG:d,REPO:0,LOCK:0,CHN:0},b)):(d=this._states.state.value-5,0>d&&(d=0),this._states.state=
{value:d,time:f},this.goToPositionAngle(c,{POS:d,ANG:0,REPO:0,LOCK:0,CHN:0},b));break;case "stepDown":if(!this._states.state){this.init(function(){setTimeout(function(){h._states.state?h.executeCommand(c,a,b):b&&b(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){b&&b(Error("device status unknonw"));break}100!=this._states.angle.value?(d=this._states.angle.value+10,100<d&&(d=100),this._states.angle={value:d,time:f},this.goToPositionAngle(c,
{POS:255,ANG:d,REPO:0,LOCK:0,CHN:0},b)):(d=this._states.state.value+5,100<d&&(d=100),this._states.state={value:d,time:f},this.goToPositionAngle(c,{POS:d,ANG:100,REPO:0,LOCK:0,CHN:0},b));break;case "lamellaUp":this.goToPositionAngle(c,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:0},b);break;case "lamellaDown":this.goToPositionAngle(c,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:0},b);break;case "lamellaTo":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("lamella to value invalid"));break}d=parseFloat(a.ext);0>d&&
(d=0);100<d&&(d=100);this._states.angle={value:d,time:f};this.goToPositionAngle(c,{POS:255,ANG:d,REPO:0,LOCK:0,CHN:0},b);break;case "stop":this.stop(c,{CHN:0},b);break;case "setRunTime":if(!a.ext){b&&b(Error("parameters is null"));break}d=100*parseFloat(a.ext);499>=d&&(d=500);this.setParameters(c,{VERT:d,ROT:255,AA:7,CHN:0},b);break;case "setRotationTime":if(!a.ext){b&&b(Error("parameters is null"));break}d=32767;f=parseInt(a.ext)/10;this.setParameters(c,{VERT:d,ROT:f,AA:7,CHN:0},b);break;case "setParams":if(!a.ext){b&&
b(Error("parameters is null"));break}var g=a.ext.split(":");if(3!=g.length){b&&b(Error("parameters format invalid"));break}d=g[0]?100*parseFloat(g[0]):32767;499>=d&&(d=32767);f=g[1]?parseInt(g[1])/10:255;g=g[2]?parseInt(g[2]):7;this.setParameters(c,{VERT:d,ROT:f,AA:g,CHN:0},b);break;default:b&&b(Error("unknow command"))}}else b&&b(Error("command invalid"))};var oa=function(c){L.call(this,c);this._data="d2-05-01";this._ch1QueryCount=0;this._ch1QueryTO=null;this._ch1QueryTimestamp=0};oa.COMMANDS="ch1moveUp ch1moveDown ch1moveTo ch1stepUp ch1stepDown ch1lamellaUp ch1lamellaDown ch1lamellaTo ch1stop ch2moveUp ch2moveDown ch2moveTo ch2stepUp ch2stepDown ch2lamellaUp ch2lamellaDown ch2lamellaTo ch2stop ch3moveUp ch3moveDown ch3moveTo ch3stepUp ch3stepDown ch3lamellaUp ch3lamellaDown ch3lamellaTo ch3stop ch4moveUp ch4moveDown ch4moveTo ch4stepUp ch4stepDown ch4lamellaUp ch4lamellaDown ch4lamellaTo ch4stop ch1setRunTime ch2setRunTime ch3setRunTime ch4setRunTime ch1setRotationTime ch2setRotationTime ch3setRotationTime ch4setRotationTime ch1setParams[15.2s]:[10,20,30ms]:[0-3] ch2setParams ch3setParams ch4setParams".split(" ");
oa.STATES="ch1state ch1angle ch1lock ch2state ch2angle ch2lock ch3state ch3angle ch3lock ch4state ch4angle ch4lock channel".split(" ");oa.prototype=new L;oa.prototype.constructor=oa;oa.prototype.init=function(c){this._queryStates([0,1,2,3],c)};L.prototype.getStatesBuffer=function(){var c=[];this._states.ch1state||c.push(0);this._states.ch2state||c.push(1);this._states.ch3state||c.push(2);this._states.ch4state||c.push(3);0<c.length&&this._queryStates(c);return this._states};oa.prototype._queryStates=
function(c,a){var b=require("x.hub.m.enocean.js")._esp3,d=0,f=this,h=function(){d++;d<c.length?f.query(b,{CHN:c[d]},h):a&&a()};this.query(b,{CHN:c[d]},h)};oa.prototype.evalTelegram=function(c){if(c=L.prototype.evalTelegram.call(this,c))switch(c.channel){case 0:c.ch1state=c.state;c.ch1angle=c.angle;c.ch1lock=c.lock;break;case 1:c.ch2state=c.state;c.ch2angle=c.angle;c.ch2lock=c.lock;break;case 2:c.ch3state=c.state;c.ch3angle=c.angle;c.ch3lock=c.lock;break;case 3:c.ch4state=c.state,c.ch4angle=c.angle,
c.ch4lock=c.lock}return c};oa.prototype.executeCommand=function(c,a,b){if(a&&a.value){a=JSON.parse(JSON.stringify(a));var d=null,f,h,g;switch(a.value.substr(0,3)){case "ch1":d=0;f="ch1state";h="ch1angle";break;case "ch2":d=1;f="ch2state";h="ch2angle";break;case "ch3":d=2;f="ch3state";h="ch3angle";break;case "ch4":d=3;f="ch4state";h="ch4angle";break;default:b&&b(Error("unknown command"))}a.value=a.value.substr(3);var k;"moveTo"==a.value.substr(0,6)&&6<a.value.length?(k=a.value.substr(6),a={value:"moveTo",
ext:k}):"lamellaTo"==a.value.substr(0,9)&&9<a.value.length?(k=a.value.substr(9),a={value:"lamellaTo",ext:k}):"setRunTime"==a.value.substr(0,10)&&10<a.value.length?(k=a.value.substr(10),a={value:"setRunTime",ext:k}):"setRotationTime"==a.value.substr(0,15)&&15<a.value.length?(k=a.value.substr(15),a={value:"setRotationTime",ext:k}):"setParams"==a.value.substr(0,9)&&9<a.value.length&&(k=a.value.substr(9),a={value:"setParams",ext:k});(new Date).getTime();var l=this;switch(a.value){case "moveUp":this.goToPositionAngle(c,
{POS:0,ANG:0,REPO:0,LOCK:0,CHN:d},b);break;case "moveDown":this.goToPositionAngle(c,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:d},b);break;case "moveTo":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("move to value invalid"));break}k=parseFloat(a.ext);0>k&&(k=0);100<k&&(k=100);g={};g[f]=k;this.activeStateChange(g);this.goToPositionAngle(c,{POS:k,ANG:255,REPO:0,LOCK:0,CHN:d},b);break;case "stepUp":if(!this._states[f]){this.init(function(){setTimeout(function(){l._states[f]?l.executeCommand(c,a,b):b&&
b(Error("get device status failed"))},200)});break}if(255==this._states[f].value||255==this._states[h].value){b&&b(Error("device status unknonw"));break}0!=this._states[h].value?(k=this._states[h].value-10,0>k&&(k=0),g={},g[h]=k,this.activeStateChange(g),this.goToPositionAngle(c,{POS:255,ANG:k,REPO:0,LOCK:0,CHN:d},b)):(k=this._states[f].value-5,0>k&&(k=0),g={},g[f]=k,this.activeStateChange(g),this.goToPositionAngle(c,{POS:k,ANG:0,REPO:0,LOCK:0,CHN:d},b));break;case "stepDown":if(!this._states[f]){this.init(function(){setTimeout(function(){l._states[f]?
l.executeCommand(c,a,b):b&&b(Error("get device status failed"))},200)});break}if(255==this._states[f].value||255==this._states[h].value){b&&b(Error("device status unknonw"));break}100!=this._states[h].value?(k=this._states[h].value+10,100<k&&(k=100),g={},g[h]=k,this.activeStateChange(g),this.goToPositionAngle(c,{POS:255,ANG:k,REPO:0,LOCK:0,CHN:d},b)):(k=this._states[f].value+5,100<k&&(k=100),g={},g[f]=k,this.activeStateChange(g),this.goToPositionAngle(c,{POS:k,ANG:100,REPO:0,LOCK:0,CHN:d},b));break;
case "lamellaUp":this.goToPositionAngle(c,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:d},b);break;case "lamellaDown":this.goToPositionAngle(c,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:d},b);break;case "lamellaTo":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("lamella to value invalid"));break}k=parseFloat(a.ext);0>k&&(k=0);100<k&&(k=100);g={};g[h]=k;this.goToPositionAngle(c,{POS:255,ANG:k,REPO:0,LOCK:0,CHN:d},b);break;case "stop":this.stop(c,{CHN:d},b);break;case "setRunTime":if(!a.ext){b&&b(Error("parameters is null"));
break}h=100*parseFloat(a.ext);499>=h&&(h=500);this.setParameters(c,{VERT:h,ROT:255,AA:7,CHN:d},b);break;case "setRotationTime":if(!a.ext){b&&b(Error("parameters is null"));break}h=32767;g=parseInt(a.ext)/10;this.setParameters(c,{VERT:h,ROT:g,AA:7,CHN:d},b);break;case "setParams":if(!a.ext){b&&b(Error("parameters is null"));break}k=a.ext.split(":");if(3!=k.length){b&&b(Error("parameters format invalid"));break}h=k[0]?100*parseFloat(k[0]):32767;499>=h&&(h=32767);g=k[1]?parseInt(k[1])/10:255;k=k[2]?
parseInt(k[2]):7;this.setParameters(c,{VERT:h,ROT:g,AA:k,CHN:d},b);break;default:b&&b(Error("unknow command"))}}else b&&b(Error("command invalid"))};var uc=function(c){Z.call(this,c);this._data="d2-06-??"};uc.prototype=new Z;uc.prototype.constructor=uc;var pa=function(c){Z.call(this,c);this._data="d2-06-01";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbir_new=this._suir_new=this._blcr_new=this._hccr_new=this._vacation_new=null};pa.COMMANDS="vacationOn vacationOff handleClosedClickOn handleClosedClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
pa.STATES="bal ppal state handle window br bl motion vacation temperature humidity illumination battery hccr blcr suir vbir".split(" ");pa.prototype=new uc;pa.prototype.constructor=pa;pa.prototype.executeCommand=function(c,a,b){c=(new Date).getTime();if(a&&a.value){"setSensorUpdateInterval"==a.value.substr(0,23)&&23<a.value.length?(a=a.value.substr(23),a={value:"setSensorUpdateInterval",ext:a}):"setVacationBlinkInterval"==a.value.substr(0,24)&&24<a.value.length&&(a=a.value.substr(24),a={value:"setVacationBlinkInterval",
ext:a});switch(a.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({vacation:"off"});break;case "handleClosedClickOn":this._hccr_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({hccr:"on"});break;case "handleClosedClickOff":this._hccr_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcr_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcr_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("set sensor update interval value invalid"));return}a=parseInt(a.ext);5>a&&(a=5);65535<a&&(a=65535);this._suir_new=a;this._states.pending={value:!0,time:c};
this.activeStateChange({suir:a});break;case "setVacationBlinkInterval":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("set vacation blink interval value invalid"));return}a=parseInt(a.ext);3>a&&(a=3);255<a&&(a=255);this._vbir_new=a;this._states.pending={value:!0,time:c};this.activeStateChange({vbir:a})}b&&b()}else b&&b(Error("command invalid"))};pa.prototype.evalData=function(c,a,b){var d=this.evalTelegram(a);this._vacation_new&&delete d.vacation;this._hccr_new&&delete d.hccr;this._blcr_new&&
delete d.blcr;this._suir_new&&delete d.suir;this._vbir_new&&delete d.vbir;210==a.rorg&&0==a.userData.readUInt8(0)&&this._sendResponse(c);d?(c=this.checkStateChange(d),b&&b(null,c)):b&&b(Error("data format invalid"))};pa.prototype.evalTelegram=function(c){var a={};if(210==c.rorg){var b,d,f,h,g,k,l;switch(c.userData.readUInt8(0)){case 0:b=c.userData.readUInt8(1);d=c.userData.readUInt8(2);f=c.userData.readUInt8(3);h=c.userData.readUInt8(4);g=c.userData.readUInt8(5);k=c.userData.readUInt8(6);l=c.userData.readUInt16BE(7);
c=c.userData.readUInt8(9);c=c>>3&31;switch(b>>4&15){case 0:a.bal="ok";break;case 1:a.bal="alarm";break;case 14:a.bal="invalid";break;case 15:a.bal="unsupported"}switch(b&15){case 0:a.ppal="ok";break;case 1:a.ppal="alarm";break;case 14:a.ppal="invalid";break;case 15:a.ppal="unsupported"}switch(d>>4&15){case 0:a.handle="undefined";break;case 1:a.handle="up";break;case 2:a.handle="down";break;case 3:a.handle="left";break;case 4:a.handle="right";break;case 14:a.handle="invalid";break;case 15:a.handle=
"unsupported"}switch(d&15){case 0:a.window="undefined";break;case 1:a.window="not_tilted";break;case 2:a.window="tilted";break;case 14:a.window="invalid";break;case 15:a.window="unsupported"}switch(f>>4&15){case 0:a.br="unchanged";break;case 1:a.br="pressed";break;case 2:a.br="releaseed";break;case 14:a.br="invalid";break;case 15:a.br="unsupported"}switch(f&15){case 0:a.bl="unchanged";break;case 1:a.bl="pressed";break;case 2:a.bl="releaseed";break;case 14:a.bl="invalid";break;case 15:a.bl="unsupported"}switch(h>>
4&15){case 0:a.motion="ok";break;case 1:a.motion="alarm";break;case 14:a.motion="invalid";break;case 15:a.motion="unsupported"}switch(h&15){case 0:a.vacation="unchanged";break;case 1:a.vacation="on";break;case 2:a.vacation="off";break;case 14:a.vacation="invalid";break;case 15:a.vacation="unsupported"}254==g?a.temperature="invalid":255==g?a.temperature="unsupported":250>=g&&(a.temperature=parseFloat((g/250*80-20).toFixed(2)));254==k?a.humidity="invalid":255==k?a.humidity="unsupported":200>=k&&(a.humidity=
parseFloat((k/2).toFixed(1)));65534==l?a.illumination="invalid":65535==l?a.illumination="unsupported":60001==l?a.illumination="over_range":6E4>=l&&(a.illumination=l);20>=c&&(a.battery=5*c);if("undefined"==a.window||"invalid"==a.window||"unsupported"==a.window||"not_tilted"==a.window)switch(a.handle){case "undefined":a.state="undefined";break;case "up":a.state="tilted";break;case "down":a.state="closed";break;case "left":a.state="open";break;case "right":a.state="open";break;case "invalid":a.state=
"invalid";break;case "unsupported":a.state="undefined"}else"tilted"==a.window&&(a.state="tilted");break;case 16:k=c.userData.readUInt8(1),l=c.userData.readUInt16BE(2),c=c.userData.readUInt8(4),b=l,d=c,a.vacation=k>>7&1?"on":"off",a.hccr=k>>6&1?"on":"off",a.blcr=k>>5&1?"on":"off",5<=b&&(a.suir=b),3<=d&&(a.vbir=d)}}return a};pa.prototype._sendResponse=function(c,a){var b=0;this._vacation_new&&"on"==this._vacation_new&&(b=1);var d=0;this._hccr_new&&"off"==this._hccr_new?d=1:this._hccr_new&&"on"==this._hccr_new&&
(d=2);var f=0;this._blcr_new&&"off"==this._blcr_new?f=1:this._blcr_new&&"on"==this._blcr_new&&(f=2);var h=0;this._suir_new&&(h=this._suir_new);var g=0;this._vbir_new&&(g=this._vbir_new);var k=new Buffer([128,128|(b&1)<<5|(d&3)<<3|(f&3)<<1,h>>8&255,h&255,g]),l=this._senderID;l||(l=x.hub.m.enocean.SENDER_ID);var k=new x.hub.m.enocean.ESP3.Telegram.VLD(k,l,0),m=this;c.sendTelegram(k,!0,function(c){m._vacation_new=null;m._hccr_new=null;m._blcr_new=null;m._suir_new=null;m._vbir_new=null;var k={pending:!1};
k.vacation=b?"on":"off";d&&(k.hccr=1==d?"off":"on");f&&(k.blcr=1==f?"off":"on");h&&(k.suir=h);g&&(k.vbir=g);m.activeStateChange(k);a&&a(c)})};var qa=function(c){Z.call(this,c);this._data="d2-06-02";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbis_new=this._suis_new=this._blcs_new=this._lacs_new=this._vacation_new=null};qa.COMMANDS="vacationOn vacationOff lockActiveClickOn lockActiveClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
qa.STATES="operation_mode handle window state temperature humidity battery vacation hccr blcr suir vbir".split(" ");qa.prototype=new uc;qa.prototype.constructor=qa;qa.prototype.executeCommand=function(c,a,b){c=(new Date).getTime();if(a&&a.value){"setSensorUpdateInterval"==a.value.substr(0,23)&&23<a.value.length?(a=a.value.substr(23),a={value:"setSensorUpdateInterval",ext:a}):"setVacationBlinkInterval"==a.value.substr(0,24)&&24<a.value.length&&(a=a.value.substr(24),a={value:"setVacationBlinkInterval",
ext:a});switch(a.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({vacation:"off"});break;case "lockActiveClickOn":this._lacs_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({hccr:"on"});break;case "lockActiveClickOff":this._lacs_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcs_new="on";this._states.pending={value:!0,time:c};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcs_new="off";this._states.pending={value:!0,time:c};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("set sensor update interval value invalid"));return}a=parseInt(a.ext);5>a&&(a=5);65535<a&&(a=65535);this._suis_new=a;this._states.pending={value:!0,time:c};
this.activeStateChange({suir:a});break;case "setVacationBlinkInterval":if("undefined"==typeof a.ext||null==a.ext){b&&b(Error("set vacation blink interval value invalid"));return}a=parseInt(a.ext);3>a&&(a=3);255<a&&(a=255);this._vbis_new=a;this._states.pending={value:!0,time:c};this.activeStateChange({vbir:a})}b&&b()}else b&&b(Error("command invalid"))};qa.prototype.evalData=function(a,e,b){var d=this.evalTelegram(e);this._vacation_new&&delete d.vacation;this._lacs_new&&delete d.hccr;this._blcs_new&&
delete d.blcr;this._suis_new&&delete d.suir;this._vbis_new&&delete d.vbir;210==e.rorg&&0==e.userData.readUInt8(0)&&this._sendResponse(a);d?(a=this.checkStateChange(d),b&&b(null,a)):b&&b(Error("data format invalid"))};qa.prototype.evalTelegram=function(a){var e={};if(210==a.rorg){var b,d,f;switch(a.userData.readUInt8(0)){case 0:b=a.userData.readUInt8(1);d=a.userData.readUInt8(2);f=a.userData.readUInt8(3);a=a.userData.readUInt8(4);a=a>>3&31;switch(b>>6&3){case 0:e.operation_mode="standard";break;case 1:e.operation_mode=
"hst"}switch(b>>4&3){case 0:e.lock="unlocked";break;case 1:e.lock="locked"}switch(b>>2&3){case 0:e.window="not_tilted";break;case 1:e.window="tilted"}switch(b&3){case 0:e.alarm="ok";break;case 1:e.alarm="burglary_alarm";break;case 2:e.alarm="unlock_alarm"}254==d?e.temperature="invalid":255==d?e.temperature="unsupported":250>=d&&(e.temperature=parseFloat((d/250*80-20).toFixed(2)));254==f?e.humidity="invalid":255==f?e.humidity="unsupported":200>=f&&(e.humidity=parseFloat((f/2).toFixed(1)));20>=a&&(e.battery=
5*a);if("tilted"==e.window)e.state="tilted";else switch(e.lock){case "unlocked":e.state="open";break;case "locked":e.state="closed"}break;case 16:b=a.userData.readUInt8(1),d=a.userData.readUInt16BE(2),f=a=a.userData.readUInt8(4),e.vacation=b>>7&1?"on":"off",e.hccr=b>>6&1?"on":"off",e.blcr=b>>5&1?"on":"off",5<=d&&(e.suir=d),3<=f&&(e.vbir=f)}}return e};qa.prototype._sendResponse=function(a,e){var b=0;this._vacation_new&&"on"==this._vacation_new?b=1:this._vacation_new&&"off"==this._vacation_new&&(b=
2);var d=0;this._lacs_new&&"off"==this._lacs_new?d=1:this._lacs_new&&"on"==this._lacs_new&&(d=2);var f=0;this._blcs_new&&"off"==this._blcs_new?f=1:this._blcs_new&&"on"==this._blcs_new&&(f=2);var h=0;this._suis_new&&(h=this._suis_new);var g=0;this._vbis_new&&(g=this._vbis_new);var k=new Buffer([128,128|(b&3)<<4|(d&3)<<2|f&3,h>>8&255,h&255,g]),l=this._senderID;l||(l=x.hub.m.enocean.SENDER_ID);var k=new x.hub.m.enocean.ESP3.Telegram.VLD(k,l,0),m=this;a.sendTelegram(k,!0,function(a){m._vacation_new=null;
m._lacs_new=null;m._blcs_new=null;m._suis_new=null;m._vbis_new=null;var c={pending:!1};c.vacation=b?"on":"off";d&&(c.hccr=1==d?"off":"on");f&&(c.blcr=1==f?"off":"on");h&&(c.suir=h);g&&(c.vbir=g);m.activeStateChange(c);e&&e(a)})};var vc=function(a){Z.call(this,a);this._data="d2-20-??"};vc.prototype=new Z;vc.prototype.constructor=vc;var U=function(a){vc.call(this,a);this._data="d2-20-00";this._poller=null;this._pollInterval=6E4};U.COMMANDS="setFanLevel fanLevelUp fanLevelDown requestStatus setHumLevel setCo2Level".split(" ");
U.STATES="filter_remaining_time operating_time temperature message_code anti_freeze current_fan_level set_fan_level".split(" ");U.prototype=new vc;U.prototype.constructor=U;U.prototype.init=function(a){var e=this,b=Math.floor(6E3*Math.random())+1E3;setTimeout(function(){var b=require("x.hub.m.enocean.js")._esp3;e.executeCommand(b,{value:"requestStatus"},a);e._restartPoller(b)},b)};U.prototype.finalize=function(a){this._poller&&clearInterval(this._poller);a&&a()};U.prototype._restartPoller=function(a){this._poller&&
clearInterval(this._poller);var e=this;this._poller=setInterval(function(){e.executeCommand(a,{value:"requestStatus"})},this._pollInterval)};U.prototype.executeCommand=function(a,e,b){(new Date).getTime();var d;if(e&&e.value){if("setFanLevel"==e.value.substr(0,11)&&11<e.value.length)e=e.value.substr(11),e={value:"setFanLevel",ext:e};else if("fanLevelUp"==e.value){d=this.getBufferedState("set_fan_level");if("undefined"==typeof d||null==d){b&&b(Error("fanLevelUp unknown current fan level"));return}if(6==
d){b&&b();return}e={value:"setFanLevel",ext:d+1}}else if("fanLevelDown"==e.value){d=this.getBufferedState("set_fan_level");if("undefined"==typeof d||null==d){b&&b(Error("fanLevelUp unknown current fan level"));return}if(0==d){b&&b();return}e={value:"setFanLevel",ext:d-1}}else if("setHumLevel"==e.value.substr(0,11)&&11<e.value.length){d=this.getBufferedState("set_fan_level");if(5!=d){b&&b(Error("humidity regulation not active"));return}e=e.value.substr(11);e={value:"setHumLevel",ext:e}}else if("setCo2Level"==
e.value.substr(0,11)&&11<e.value.length){d=this.getBufferedState("set_fan_level");if(6!=d){b&&b(Error("co2 regulation not active"));return}e=e.value.substr(11);e={value:"setCo2Level",ext:e}}var f=this,h;switch(e.value){case "setFanLevel":if("undefined"==typeof e.ext||null==e.ext){b&&b(Error("setFanLevel value invalid"));break}h=parseInt(e.ext);if(0>h||6<h){b&&b(Error("setFanLevel value invalid"));break}if(5==h||6==h){this.activeStateChange({set_fan_level:h});this._activateSensorRegulation();b&&b();
break}this._deactivateSensorRegulation();this._sendResponse(a,{LS:h,RS:1},function(e){e||f.activeStateChange({set_fan_level:h,current_fan_level:h});f._restartPoller(a);b&&b(e)});break;case "setHumLevel":if("undefined"==typeof e.ext||null==e.ext){b&&b(Error("setHumLevel value invalid"));break}h=parseInt(e.ext);if(0>h||4<h){b&&b(Error("setHumLevel value invalid"));break}this._sendResponse(a,{LS:h,RS:1},function(e){e||f.activeStateChange({current_fan_level:h});f._restartPoller(a);b&&b(e)});break;case "setCo2Level":if("undefined"==
typeof e.ext||null==e.ext){b&&b(Error("setCo2Level value invalid"));break}h=parseInt(e.ext);if(0>h||4<h){b&&b(Error("setCo2Level value invalid"));break}this._sendResponse(a,{LS:h,RS:1},function(e){e||f.activeStateChange({current_fan_level:h});f._restartPoller(a);b&&b(e)});break;case "requestStatus":this._sendResponse(a,{LS:5,RS:1},function(a){b&&b(a)});break;default:b&&b(Error("unknown command"))}}else b&&b(Error("command invalid"))};U.prototype.evalData=function(a,e,b){a=this.evalTelegram(e);this._states&&
this._states.set_fan_level||(a.set_fan_level=a.current_fan_level);this._states&&this._states.set_fan_level&&5!=this._states.set_fan_level.value&&6!=this._states.set_fan_level.value&&(a.set_fan_level=a.current_fan_level);a=this.checkStateChange(a);b&&b(null,a)};U.prototype.evalTelegram=function(a){var e={};if(210==a.rorg){if(1==a.userData.length)a=a.userData.readUInt8(0)&7;else{var b=a.userData.readUInt8(0),d=a.userData.readUInt8(1),f=a.userData.readUInt16BE(2),h=a.userData.readUInt8(4),g=a.userData.readUInt8(5),
k=a.userData.readUInt8(6),l=a.userData.readUInt16BE(7),m=a.userData.readUInt8(9),n=a.userData.readUInt8(10),p=a.userData.readInt16BE(11),q=a.userData.readUInt8(13);a=q&7;e.filter_remaining_time=h+":"+f+":"+d+":"+b;e.operating_time=m+":"+l+":"+k+":"+g;e.temperature=p/10;e.message_code=n;e.anti_freeze=q>>4&1?"on":"off"}e.current_fan_level=a}return e};U.prototype._sendResponse=function(a,e,b){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);e=new Buffer([e.LS,e.RS]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(e,
d,0);this._senderID!=this._address&&d.setDstId(this._address);a.sendTelegram(d,!0,function(a){b&&b(a)})};U.prototype._activateSensorRegulation=function(){var a=require("x.hub.m.enocean.js").getRehauHandler();a&&a.activateSensorRegulation(this.getAddress())};U.prototype._deactivateSensorRegulation=function(){var a=require("x.hub.m.enocean.js").getRehauHandler();a&&a.deactivateSensorRegulation(this.getAddress())};var Ab=function(a){J.call(this,a);this._data="eltako_contact";this._vendor="eltako";this._eepAlias=
"f6-10-00"};Ab.STATES=["contact","contact_raw"];Ab.prototype=new J;Ab.prototype.constructor=Ab;Ab.prototype.evalTelegram=function(a){var e={};246==a.rorg&&(a=a.userData,240==a?e.contact="closed":224==a&&(e.contact="closed"),e.contact_raw=a);return e};var Bb=function(a){Ha.call(this,a);this._data="eltako_motion";this._vendor="eltako";this._eepAlias="a5-08-01"};Bb.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");Bb.prototype=new Ha;Bb.prototype.constructor=Bb;Bb.prototype.evalTelegram=
function(a){var e={};if(165==a.rorg){var b=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(b>>3&1)){e.voltage=parseFloat((a/255*5.1).toFixed(1));e.voltage_raw=a;e.illumination=parseFloat((d/255*2048).toFixed(1));e.illumination_raw=d;b=b>>1&1;switch(b){case 0:e.state="on";break;case 1:e.state="off"}e.state_raw=b}}return e};var ja=function(a){R.call(this,a);this._data="eltako_switch";this._vendor="eltako";this._eepAlias="f6-02-01"};ja.COMMANDS=
["on","off","toggle"];ja.STATES=["state"];ja.prototype=new R;ja.prototype.constructor=ja;ja.prototype.getTeachinType=function(){return"4BS"};ja.prototype.handleLearnTelegram=function(a,e){if(e&&246==e.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:e.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(e,b){a._learnFinish(e,0,b)})};ja.prototype.getTeachinTelegram=
function(a,e,b){a=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,e,0)};ja.prototype.evalTelegram=function(a){var e={};if(246==a.rorg)switch(a.userData){case 112:e.state="on";break;case 80:e.state="off"}return e};ja.prototype.executeCommand=function(a,e,b){if(e&&e.value){(new Date).getTime();var d=this;switch(e.value){case "on":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:1},function(a){a||d.activeStateChange({state:"on"});b&&b(a)});break;case "off":this.switching(a,{TIM:0,LCK:0,
DEL:0,SW:0},function(a){a||d.activeStateChange({state:"off"});b&&b(a)});break;case "toggle":if(!this._states.state){b&&b(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},b):this.executeCommand(a,{value:"on"},b);break;default:b&&b(Error("unknow command"))}}else b&&b(Error("command invalid"))};var I=function(a){R.call(this,a);this._data="eltako_dimmer";this._vendor="eltako";this._eepAlias="a5-38-08";this._lastOnLevel=-1};I.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");
I.STATES=["state","level","ramp_time"];I.prototype=new R;I.prototype.constructor=I;I.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.ramp_time||null==this._params.ramp_time)this._params.ramp_time=0};I.prototype.handleLearnTelegram=function(a,e){if(e&&165==e.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:e.senderID,senderID:a._learnSenderID,
data:this._data,vendor:this._vendor},function(e,b){a._learnFinish(e,0,b)})};I.prototype.getTeachinTelegram=function(a,e,b){a=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,e,0)};I.prototype.getStatesBuffer=function(){var a=JSON.parse(JSON.stringify(this._states));a.ramp_time={value:this._params.ramp_time,time:-1};return a};I.prototype.evalData=function(a,e,b){(a=this.evalTelegram(e))?((0==a.level||"off"==a.state)&&this._states.level&&this._states.level.value&&(this._lastOnLevel=
this._states.level.value),a=this.checkStateChange(a),b&&b(null,a)):b&&b(Error("data format invalid"))};I.prototype.evalTelegram=function(a){var e={};if(165==a.rorg){var b=a.userData.readUInt8(3),d=a.userData.readUInt8(2),f=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(b>>3&1))switch(a){case 2:e.level=f,e.ramp=d,e.dim_range=b>>2&1?"relative":"absolute",e.store_final_value=b>>1&1,e.state=b&1?"on":"off"}}return e};I.prototype.executeCommand=function(a,e,b){if(e&&e.value){var d;"dimTo"==e.value.substr(0,
5)&&5<e.value.length?(d=e.value.substr(5),e={value:"dimTo",ext:d}):"toggleTo"==e.value.substr(0,8)&&8<e.value.length?(d=e.value.substr(8),e={value:"toggleTo",ext:d}):"setRampTime"==e.value.substr(0,11)&&11<e.value.length&&(d=e.value.substr(11),e={value:"setRampTime",ext:d});(new Date).getTime();var f=this;switch(e.value){case "on":d=this._lastOnLevel;if(-1==d||0==d)d=100;this.dimming(a,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(a){a||f.activeStateChange({level:d,state:"on"});
b&&b(a)});break;case "off":this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value);this.dimming(a,{EDIM:0,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:0},function(a){a||f.activeStateChange({level:0,state:"off"});b&&b(a)});break;case "toggle":if(!this._states.state){b&&b(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},b):this.executeCommand(a,{value:"on"},b);break;case "toggleTo":if(!this._states.state){b&&
b(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},b):this.executeCommand(a,{value:"dimTo",ext:e.ext},b);break;case "dimTo":if("undefined"==typeof e.ext||null==e.ext){b&&b(Error("dim to value invalid"));break}d=parseFloat(e.ext);0>d&&(d=0);100<d&&(d=100);this.dimming(a,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(a){a||f.activeStateChange({level:d,state:"on"});b&&b(a)});break;case "dimUp":if(!this._states.level){b&&
b(Error("unknow previous dimmer level"));break}d=parseInt(this._states.level.value);d+=5;100<d&&(d=100);this.dimming(a,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(a){a||f.activeStateChange({level:d,state:"on"});b&&b(a)});break;case "dimDown":if(!this._states.level){b&&b(Error("unknow previous dimmer level"));break}d=parseInt(this._states.level.value);d-=5;0>d&&(d=0);if(0==d){this.executeCommand(a,{value:"off"},b);break}this.dimming(a,{EDIM:d,RMP:this._params.ramp_time,EDIMR:0,
STR:0,SW:1},function(a){a||f.activeStateChange({level:d,state:"on"});b&&b(a)});break;case "setRampTime":if(!e.ext){b&&b(Error("parameters is null"));break}d=parseInt(d);255<d&&(d=255);0>d&&(d=0);this._params.ramp_time=d;require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated(this,function(a){b&&b(a)});break;default:b&&b(Error("unknow command"))}}else b&&b(Error("command invalid"))};var Ma=function(a){I.call(this,a);this._data="eltako_dimmer2";this._vendor="eltako";this._eepAlias="f6-02-01"};
Ma.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");Ma.STATES=["state","ramp_time"];Ma.prototype=new I;Ma.prototype.constructor=I;Ma.prototype.handleLearnTelegram=function(a,b){if(b&&246==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(b,e){a._learnFinish(b,0,e)})};Ma.prototype.evalTelegram=
function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.state="on";break;case 80:b.state="off"}return b};var Cb=function(a){I.call(this,a);this._data="eltako_fsud"};Cb.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");Cb.STATES=["state","ramp_time"];Cb.prototype=new I;Cb.prototype.constructor=I;Cb.prototype.getTeachinTelegram=function(a,b,d){a=new Buffer([2,0,0,0]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};var V=function(a){sc.call(this,a);this._data=
"eltako_blind";this._vendor="eltako";this._eepAlias="f6-02-01";this._syncRunning=!1;this._syncCB=this._syncTO=null};V.COMMANDS="up down stop stepUp stepDown setRV setRunTime moveTo sync".split(" ");V.STATES=["pos","sync"];V.prototype=new sc;V.prototype.constructor=V;V.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.rv||null==this._params.rv)this._params.rv=200;if("undefined"==typeof this._params.rt||null==this._params.rt)this._params.rt=200};
V.prototype.handleLearnTelegram=function(a,b){if(b&&246==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(b,e){a._learnFinish(b,0,e)})};V.prototype.getTeachinTelegram=function(a,b,d){a=new Buffer([255,248,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};V.prototype.getStatesBuffer=function(){var a=
JSON.parse(JSON.stringify(this._states));a.sync||(a.sync={value:!1,time:-1});a.rv={value:this._params.rv,time:-1};a.rt={value:this._params.rt,time:-1};return a};V.prototype.evalData=function(a,b,d){(a=this.evalTelegram(b))?(b=this.checkStateChange(a),a.sync&&this._syncRunning&&(this._syncRunning=!1,this._syncTO&&(clearTimeout(this._syncTO),this._syncTO=null),this._syncCB&&(this._syncCB(),this._syncCB=null)),d&&d(null,b)):d&&d(Error("data format invalid"))};V.prototype.evalTelegram=function(a){var b=
{};if(246==a.rorg)switch(a.userData){case 112:case 1:b.sync=!0;b.pos=0;break;case 80:case 2:b.sync=!0,b.pos=100}else if(165==a.rorg){var d=a.userData.readUInt16BE(0);a=a.userData.readUInt8(2);var f=this._params.rt;f||(f=200);var h=this._states.pos?this._states.pos.value:null;if("undefined"!=typeof h&&null!=h)switch(d=10*d/f,a){case 1:b.pos=Math.max(0,Math.round(h-d));break;case 2:b.pos=Math.min(100,Math.round(h+d))}}return b};V.prototype.executeCommand=function(a,b,d){if(b&&b.value){var f;"stepUp"==
b.value.substr(0,6)&&6<b.value.length?(f=b.value.substr(6),b={value:"stepUp",ext:f}):"stepDown"==b.value.substr(0,8)&&8<b.value.length?(f=b.value.substr(8),b={value:"stepDown",ext:f}):"setRV"==b.value.substr(0,5)&&5<b.value.length?(f=b.value.substr(5),b={value:"setRV",ext:f}):"setRunTime"==b.value.substr(0,10)&&10<b.value.length?(f=b.value.substr(10),b={value:"setRunTime",ext:f}):"moveTo"==b.value.substr(0,6)&&6<b.value.length&&(f=b.value.substr(6),b={value:"moveTo",ext:f});(new Date).getTime();var h=
this,g=this._params.rv;g||(g=200);var k=this._params.rt;k||(k=200);switch(b.value){case "up":this.doReq(a,{TIME:g,CMD:1,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "down":this.doReq(a,{TIME:g,CMD:2,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "stop":this.doReq(a,{TIME:0,CMD:0,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "stepUp":k="undefined"==typeof b.ext||null==b.ext?k/100:parseFloat(b.ext)/100*k;1>k&&(k=1);this.doReq(a,{TIME:k,CMD:1,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "stepDown":k=
"undefined"==typeof b.ext||null==b.ext?k/100:parseFloat(b.ext)/100*k;1>k&&(k=1);this.doReq(a,{TIME:k,CMD:2,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "moveTo":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("value invalid"));break}f=parseInt(b.ext);if(this._states.sync&&this._states.sync.value&&this._states.pos&&"undefined"!=typeof this._states.pos.value&&null!=this._states.pos.value){var k=(f-this._states.pos.value)/100*k,l;if(0<k)l=2;else if(0>k)k=0-k,l=1;else if(0==k){d&&d();break}this.doReq(a,
{TIME:k,CMD:l,LCK:0,TYPE:1},function(a){d&&d(a)})}else this.snyc(a,function(f){f?d&&d(f):h.executeCommand(a,b,d)});break;case "sync":this.snyc(a,function(a){d&&d(a)});break;case "setRV":if(!b.ext){d&&d(Error("parameters is null"));break}f=parseInt(f);200<f&&(f=200);0>f&&(f=0);this._params.rv=f;l=require("x.hub.m.enocean.js")._deviceHandler;l.deviceParamsUpdated(this,function(a){d&&d(a)});break;case "setRunTime":if(!b.ext){d&&d(Error("parameters is null"));break}f=parseInt(f);200<f&&(f=200);0>f&&(f=
0);this._params.rt=f;l=require("x.hub.m.enocean.js")._deviceHandler;l.deviceParamsUpdated(this,function(a){d&&d(a)});break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};V.prototype.snyc=function(a,b){if(this._syncRunning)b&&b(Error("sync running"));else{var d=this,f=this._params.rv;f||(f=200);this._syncRunning=!0;this._syncTO=setTimeout(function(){d._syncRunning=!1;d._syncTO=null;d._syncCB&&d._syncCB(Error("sync timeout"));d._syncCB=null},1E3*(f+2));this._syncCB=b;this.doReq(a,
{TIME:f,CMD:1,LCK:0,TYPE:0})}};V.prototype.doReq=function(a,b,d){var f=this._senderID;this._senderID||(f=x.hub.m.enocean.SENDER_ID);var h,g;b.TYPE?(h=Math.round(10*b.TIME)>>8&255,g=Math.round(10*b.TIME)&255):(h=0,g=Math.round(b.TIME)&255);b=new Buffer([h,g,b.CMD,8|(b.LCK&1)<<2|(b.TYPE&1)<<1]);f=new x.hub.m.enocean.ESP3.Telegram.BS4(b,f,0);f.setDstId(this._address);a.sendTelegram(f,!0,function(a){d&&d(a)})};var Db=function(a){Ca.call(this,a);this._data="eltako_weather";this._vendor="eltako";this._eepAlias=
"a5-04-02";this._engMax=7.2;this._engMin=0};Db.STATES="energy energy_raw humidity humidity_raw temperature temperature_raw available".split(" ");Db.prototype=new Ca;Db.prototype.constructor=Db;Db.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var d=a.userData.readUInt8(3),f=a.userData.readUInt8(2),h=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(d>>3&1)&&(b.energy=parseFloat((a/250*(this._engMax-this._engMin)+this._engMin).toFixed(1)),b.energy_raw=a,b.humidity=parseFloat((h/250*
(this._humMax-this._humMin)+this._humMin).toFixed(1)),b.humidity_raw=h,b.temperature=parseFloat((f/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),b.temperature_raw=f,b.available=d>>1&1?!0:!1)}return b};var Eb=function(a){Da.call(this,a);this._data="eltako_lux";this._vendor="eltako";this._eepAlias="a5-06-01";this._ill1Max=3E4;this._ill1Min=300};Eb.STATES="illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw".split(" ");Eb.prototype=new Da;Eb.prototype.constructor=
Eb;Eb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var d=a.userData.readUInt8(3);a.userData.readUInt8(2);var f=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(d>>3&1)&&(b.illumination2=a,b.illumination2_raw=a,b.illumination1=parseFloat((f/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1)),b.illumination1_raw=f,b.illumination=f?b.illumination1:b.illumination2,b.illumination_raw=f?b.illumination1_raw:b.illumination2_raw)}return b};var wc=function(a){va.call(this,a);this._data=
"eltako_lux2";this._vendor="eltako";this._eepAlias="a5-06-02";this._ill2Min=0;this._ill2Max=1024};wc.STATES=va.STATES;wc.prototype=new va;wc.prototype.constructor=wc;var D=function(a){b.call(this,a);this._data="eltako_buttons";this._vendor="eltako";this._eepAlias="f6-02-01";this._longPressThreshold=1E3;this.BUTTONS=["button1","button2","button3","button4"]};D.STATES=["button1","button2","button3","button4"];D.EVENTS=["shortPress","longPress","press","release"];D.prototype=new b;D.prototype.constructor=
D;D.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:this.BUTTONS[0]&&(b[this.BUTTONS[0]]="pressed");break;case 80:this.BUTTONS[1]&&(b[this.BUTTONS[1]]="pressed");break;case 48:this.BUTTONS[2]&&(b[this.BUTTONS[2]]="pressed");break;case 16:this.BUTTONS[3]&&(b[this.BUTTONS[3]]="pressed");break;case 0:for(a=0;a<this.BUTTONS.length;a++)this.BUTTONS[a]&&(b[this.BUTTONS[a]]="released")}return b};D.prototype.checkStateChange=function(a){var b=this._states,d=[],f=(new Date).getTime(),
h;for(h in a){var g={};g.key=h;g.value=a[h];g.changed=!1;var k=b[h]?b[h].value:null,l=b[h]?b[h].time:null,m=a[h];k!=m&&(g.oldvalue=k,g.changed=!0);this._states[h]={value:a[h],time:f};g.changed&&d.push(g);"pressed"==k&&"released"==m&&(!l||f-l<this._longPressThreshold?(g={},g.key=h,g.value="shortPress"):(g={},g.key=h,g.value="longPress"),g.changed=!0,d.push(g))}return d};var xc=function(a){D.call(this,a);this._data="eltako_button2";this.BUTTONS=[null,null,null,"button"]};xc.STATES=["button"];xc.prototype=
new D;xc.prototype.constructor=xc;var yc=function(a){D.call(this,a);this._data="eltako_sender2";this.BUTTONS=["A1","A3"]};yc.STATES=["A1","A3"];yc.prototype=new D;yc.prototype.constructor=yc;var zc=function(a){D.call(this,a);this._data="eltako_sender4";this.BUTTONS=["E1","E2","E3","E4"]};zc.STATES=["E1","E2","E3","E4"];zc.prototype=new D;zc.prototype.constructor=zc;var Ac=function(a){D.call(this,a);this._data="eltako_button2";this.BUTTONS=["buttonO","buttonI"]};Ac.STATES=["buttonO","buttonI"];Ac.prototype=
new D;Ac.prototype.constructor=Ac;var Bc=function(a){D.call(this,a);this._data="eltako_button4";this.BUTTONS=["BO","BI","AO","AI"]};Bc.STATES=["BO","BI","AO","AI"];Bc.prototype=new D;Bc.prototype.constructor=Bc;var Fb=function(a){D.call(this,a);this._data="eltako_fsm60b"};Fb.STATES=["button"];Fb.prototype=new D;Fb.prototype.constructor=Fb;Fb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:case 80:case 16:b.button="pressed";break;case 0:b.button="released"}return b};
var Gb=function(a){b.call(this,a);this._data="eltako_fkf";this._vendor="eltako";this._eepAlias="f6-04-01"};Gb.STATES=["keycard"];Gb.prototype=new b;Gb.prototype.constructor=Gb;Gb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var Hb=function(a){b.call(this,a);this._data="eltako_fkc";this._vendor="eltako";this._eepAlias="f6-04-01"};Hb.STATES=["keycard"];Hb.prototype=new b;Hb.prototype.constructor=Hb;Hb.prototype.evalTelegram=
function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.keycard="guest_card";case 32:b.keycard="service_card";case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var Ba=function(a){xa.call(this,a);this._data="eltako_thermo";this._vendor="eltako";this._eepAlias="a5-10-06"};Ba.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");Ba.prototype=new xa;Ba.prototype.constructor=Ba;Ba.prototype.evalTelegram=function(a){var b={};if(165==
a.rorg){var d=a.userData.readUInt8(3),f=a.userData.readUInt8(2),h=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(d>>3&1)&&(b.night_reduce=6>=a?0:12>=a?1:19>=a?2:25>=a?3:31>=a?4:5,b.night_reduce_raw=a,b.setpoint=parseFloat((h/255*40).toFixed(1)),b.setpoint_raw=h,b.temperature=parseFloat(((255-f)/255*40).toFixed(1)),b.temperature_raw=f)}return b};var Cc=function(a){Ba.call(this,a);this._data="eltako_futh65d";this._vendor="eltako";this._eepAlias="a5-10-12"};Cc.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");
Cc.prototype=new Ba;Cc.prototype.constructor=Cc;var Ib=function(a){wa.call(this,a);this._data="eltako_ftr78s";this._vendor="eltako";this._eepAlias="a5-10-03"};Ib.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Ib.prototype=new wa;Ib.prototype.constructor=Ib;Ib.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var d=a.userData.readUInt8(3),f=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(d>>3&1)&&(b.setpoint=parseFloat((a/255*22+8).toFixed(1)),b.setpoint_raw=a,b.temperature=
parseFloat(((255-f)/255*40).toFixed(1)),b.temperature_raw=f)}return b};var Na=function(a){da.call(this,a);this._data="eltako_powermeter";this._vendor="eltako";this._eepAlias="a5-12-01"};Na.STATES=["power","energy","tariff"];Na.prototype=new da;Na.prototype.constructor=Na;Na.prototype.evalTelegram=function(a){var b=da.prototype.evalTelegram.call(this,a);165==a.rorg&&143==a.userData.readUInt8(3)&&(b={});return b};var Dc=function(a){da.call(this,a);this._data="eltako_powermeter2";this._vendor="eltako";
this._eepAlias="a5-12-01"};Dc.STATES=["power","tariff"];Dc.prototype=new da;Dc.prototype.constructor=Na;Dc.prototype.evalTelegram=function(a){a=da.prototype.evalTelegram.call(this,a);delete a.energy;delete a.tariff;return a};var Oa=function(a){D.call(this,a);this._data="eltako_fzs"};Oa.STATES=["button"];Oa.prototype=new D;Oa.prototype.constructor=Oa;Oa.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.button="pressed";break;case 0:b.button="released"}return b};
Oa.prototype.checkStateChange=function(a){var b=this._states,d=[],f=(new Date).getTime(),h;for(h in a){var g={};g.key=h;g.value=a[h];g.changed=!1;var k=b[h]?b[h].value:null,l=b[h]?b[h].time:null,m=a[h];k!=m&&(g.oldvalue=k,g.changed=!0);this._states[h]={value:a[h],time:f};g.changed&&d.push(g);"pressed"==k&&"released"==m&&(!l||f-l<this._longPressThreshold?(g={},g.key=h,g.value="shortPress"):(g={},g.key=h,g.value="longPress"),g.changed=!0,d.push(g))}return d};var Jb=function(a){k.call(this,a);this._data=
"eltako_relay2";this._vendor="eltako";this._eepAlias="f6-02-01"};Jb.STATES=["ch1","ch2"];Jb.prototype=new k;Jb.prototype.constructor=Jb;Jb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.ch1="on";break;case 80:b.ch1="off";break;case 48:b.ch2="on";break;case 16:b.ch2="off"}return b};var Kb=function(a){k.call(this,a);this._data="eltako_relay";this._vendor="eltako";this._eepAlias="f6-02-01"};Kb.STATES=["state"];Kb.prototype=new k;Kb.prototype.constructor=Kb;Kb.prototype.evalTelegram=
function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.state="on";break;case 80:b.state="off"}return b};var Lb=function(a){na.call(this,a);this._data="eltako_heat";this._vendor="eltako";this._eepAlias="a5-30-03"};Lb.STATES=["temperature","temperature_raw","alarm","alarm_raw"];Lb.prototype=new na;Lb.prototype.constructor=Lb;Lb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var d=a.userData.readUInt8(3),f=a.userData.readUInt8(2),h=a.userData.readUInt8(1);a.userData.readUInt8(0);
1==(d>>3&1)&&(b.temperature=parseFloat(((255-h)/255*40).toFixed(1)),b.temperature_raw=h,b.alarm=15==f,b.alarm_raw=f)}return b};var Mb=function(a){na.call(this,a);this._data="eltako_water_m3";this._vendor="eltako";this._eepAlias="a5-30-03"};Mb.STATES=["water","water_raw"];Mb.prototype=new na;Mb.prototype.constructor=Mb;Mb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var d=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(d>>3&1)&&(b.water=15==a,b.water_raw=a)}return b};var Nb=function(a){Aa.call(this,
a);this._data="eltako_water_m4";this._vendor="eltako";this._eepAlias="a5-30-01"};Nb.STATES=["water","water_raw"];Nb.prototype=new Aa;Nb.prototype.constructor=Nb;Nb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var d=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(d>>3&1)&&(b.water=0==a,b.water_raw=a)}return b};var ka=function(a){R.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_powerswitch";this._vendor="peha";this._eepAlias="a5-38-08"};ka.COMMANDS=["on","off","toggle"];
ka.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");ka.prototype=new R;ka.prototype.constructor=ka;ka.prototype.getTeachinType=function(){return"4BS"};ka.prototype.evalTelegram=function(a){return Ka.prototype.evalTelegram.call(this,a)};ka.prototype.executeCommand=function(a,b,d){if(b&&b.value){(new Date).getTime();var f=this;
switch(b.value){case "on":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:1},function(a){a||f.activeStateChange({state:"on"});d&&d(a)});break;case "off":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:0},function(a){a||f.activeStateChange({state:"off"});d&&d(a)});break;case "toggle":if(!this._states.state){d&&d(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},d):this.executeCommand(a,{value:"on"},d);break;default:d&&d(Error("unknow command"))}}else d&&
d(Error("command invalid"))};var Pa=function(a){ka.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_switch";this._vendor="peha";this._eepAlias="a5-38-08"};Pa.COMMANDS=["on","off","toggle"];Pa.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");Pa.prototype=new ka;Pa.prototype.constructor=Pa;Pa.prototype.evalTelegram=function(a){a=
Ka.prototype.evalTelegram.call(this,a);delete a.power;delete a.energy;delete a.current;delete a.voltage;delete a.power_unit;delete a.energy_unit;delete a.current_unit;delete a.voltage_unit;return a};var la=function(a){R.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_blind";this._vendor="peha";this._eepAlias="a5-38-08";this._initCount=0};la.COMMANDS="up down stop stepUp stepDown moveTo lamellaUp lamellaDown lamellaStepUp lamellaStepDown lamellaTo setRunTime setLamellaRuntime".split(" ");la.STATES=
"position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode".split(" ");la.prototype=new R;la.prototype.constructor=la;la.prototype.init=function(a){var b=require("x.hub.m.enocean.js")._esp3;this.blind(b,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0},function(b){a&&a()})};la.prototype.getTeachinType=function(){return"4BS"};la.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length?(100>=this._initCount&&
0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):this._initCount=0;return this._states};la.prototype.evalTelegram=function(a){return kb.prototype.evalTelegram.call(this,a)};la.prototype.executeCommand=function(a,b,d){if(b&&b.value){var f,h;(new Date).getTime();var g=this;"stepUp"==b.value.substr(0,6)&&6<b.value.length?(f=b.value.substr(6),b={value:"stepUp",ext:f}):"stepDown"==b.value.substr(0,8)&&8<
b.value.length?(f=b.value.substr(8),b={value:"stepDown",ext:f}):"setRunTime"==b.value.substr(0,10)&&10<b.value.length?(f=b.value.substr(10),b={value:"setRunTime",ext:f}):"moveTo"==b.value.substr(0,6)&&6<b.value.length&&(f=b.value.substr(6),b={value:"moveTo",ext:f});switch(b.value){case "up":this.blind(a,{P1:0,P2:0,FUNC:2,SSF:0,PAF:0,SMF:0},function(a){d&&d(a)});break;case "down":this.blind(a,{P1:0,P2:0,FUNC:3,SSF:0,PAF:0,SMF:0},function(a){d&&d(a)});break;case "stop":this.blind(a,{P1:0,P2:0,FUNC:1,
SSF:0,PAF:0,SMF:0},function(a){d&&d(a)});break;case "stepUp":f="undefined"==typeof b.ext||null==b.ext?5:parseInt(b.ext);h=this._states.position?this._states.position.value:null;if("undefined"==typeof h||null==h){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});d&&d(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(f=h+f,100<f&&(f=100)):(f=h-f,0>f&&(f=0));this.blind(a,{P1:f,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||g.activeStateChange({position:f});
d&&d(a)});break;case "stepDown":f="undefined"==typeof b.ext||null==b.ext?5:parseInt(b.ext);h=this._states.position?this._states.position.value:null;if("undefined"==typeof h||null==h){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});d&&d(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(f=h-f,0>f&&(f=0)):(f=h+f,100<f&&(f=100));this.blind(a,{P1:f,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||g.activeStateChange({position:f});d&&d(a)});break;case "moveTo":if("undefined"==
typeof b.ext||null==b.ext){d&&d(Error("value invalid"));break}h=parseInt(b.ext);this.blind(a,{P1:h,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||g.activeStateChange({position:h});d&&d(a)});break;case "setRunTime":if(!b.ext||-1==b.ext.indexOf(":")){d&&d(Error("value invalid"));break}var k=b.ext.split(":");b=k[0];k=k[1];if(!b&&k)b=k;else if(b&&!k)k=b;else if(!b&&!k){d&&d(Error("value invalid"));break}b=parseInt(b);k=parseInt(k);this.blind(a,{P1:b,P2:k,FUNC:7,SSF:0,PAF:0,SMF:0},function(a){a||g.activeStateChange({position:f});
d&&d(a)});break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};var y=function(a){g.call(this,a);this._data="bb-aa-cc";this._vendor="rehau";this._eepAlias="d2-06-10";this._hopCount=0;this._saLearnMode=1;this._originalEEP="bb-aa-cc";this._reset_pre_alarm_new=this._reset_alarm_new=null;this._deviceTO=this._startTimeoutTimer();this._prealarmTO=this._alarmTO=null};y.COMMANDS="alertOn alertOff alertToggle resetAlarm resetPreAlarm preAlarmOn preAlarmOff preAlarmToggle".split(" ");
y.STATES="battery pre_alarm alarm window pre_alarm_enabled error pending alarm_enabled pre_alarm_enabled_device timeout".split(" ");y.prototype=new g;y.prototype.constructor=y;y.prototype.setDefaultParams=function(){var a=require("x.hub.m.enocean.js")._rehauHandler;if(a){var b=a.getSmartguardSetting(this._address),d=!0,f=!0;b&&(d=b.isAlarmActive(),f=b.isPreAlarmActive());this.activeStateChange({pending:!1,alarm_enabled:d,pre_alarm_enabled:f,timeout:!1,alarm_task_active:a.getAlarm(),pre_alarm_task_active:a.getAlarm()})}};
y.prototype.getStatesBuffer=function(){return this._states};y.prototype.evalData=function(a,b,d){var f=this.evalTelegram(b);if(f){f.timeout=!1;this._deviceTO&&(clearTimeout(this._deviceTO),this._deviceTO=this._startTimeoutTimer());if(208==b.rorg)b=this.checkStateChange(f);else{var h=!1;210==b.rorg&&2==b.userData.length&&(h=!0);b=this.getBufferedState("alarm_task_active");var g=this.getBufferedState("pre_alarm_task_active"),k=this.getBufferedState("alarm_enabled"),l=this.getBufferedState("pre_alarm_enabled");
f.pre_alarm?g?l?this._startPreAlarmTimer():f.pre_alarm=!1:f.pre_alarm=!1:this._clearPreAlarmTimer();f.alarm?b?k?this._startAlarmTimer():f.alarm=!1:f.alarm=!1:this._clearAlarmTimer();b=this.checkStateChange(f);var m=this;this._executePendingCommand(a,function(){m._reportStates(f)},h)}d&&d(null,b)}else d&&d(Error("data format invalid"))};y.prototype.evalTelegram=function(a){var b={},d=!1;if(210==a.rorg){var f;1==a.userData.length?d=a.userData.readUInt8(0):(f=a.userData.readUInt8(0),d=a.userData.readUInt8(1));
2==a.userData.length&&(b.battery=f);b.pre_alarm=d>>7&1?!0:!1;b.alarm=d>>6&1?!0:!1;b.window=d>>5&1?"closed":"open";b.pre_alarm_enabled_device=d>>4&1?!0:!1;b.error=d&15;d=!0}else 208==a.rorg&&(d=a.userData.readUInt8(0),b.battery=Math.round(d/100*255),b.battery_raw=d,d=!0);return d?b:null};y.prototype.executeCommand=function(a,b,d){if(b&&b.value){switch(b.value){case "alertOn":this._setAlarm(!0);break;case "alertOff":this._setAlarm(!1);break;case "alertToggle":this._states&&this._states.alarm_enabled?
this._setAlarm(!this._states.alarm_enabled.value):this._setAlarm(!0);break;case "resetAlarm":this._reset_alarm_new="on";this.activeStateChange({pending:!0});break;case "resetPreAlarm":this._reset_pre_alarm_new="on";this.activeStateChange({pending:!0});break;case "preAlarmOn":this._setPreAlarm(!0);break;case "preAlarmOff":this._setPreAlarm(!1);break;case "preAlarmToggle":this._states&&this._states.pre_alarm_enabled?this._setPreAlarm(!this._states.pre_alarm_enabled.value):this.pre_alarm_enabled(!0);
break;case "alarmTaskOn":this._setAlarmTask(!0);break;case "alarmTaskOff":this._setAlarmTask(!1);break;case "preAlarmTaskOn":this._setPreAlarmTask(!0);break;case "preAlarmTaskOff":this._setPreAlarmTask(!1);break;default:d&&d(Error("unknow command"));return}d&&d()}else d&&d(Error("command invalid"))};y.prototype._executePendingCommand=function(a,b,d){var f={AL:1,RSA:0,RSP:0,PAE:1},h=this._isAlarmActive();f.AL=h?1:0;h=this._isPreAlarmActive();f.PAE=h?1:0;this._reset_alarm_new&&(f.RSA="on"==this._reset_alarm_new?
1:0);this._reset_pre_alarm_new&&(f.RSP="on"==this._reset_pre_alarm_new?1:0);var g={pending:!1};1==f.RSP&&(g.pre_alarm=!1);1==f.RSA&&(g.alarm=!1);this._reset_pre_alarm_new=this._reset_alarm_new=null;var k=this;this._sendVLD(a,f,function(a){k.activeStateChange(g);b&&b(a)},d)};y.prototype._sendVLD=function(a,b,d,f){var h=this._senderID;this._senderID||(h=x.hub.m.enocean.SENDER_ID);b=(b.AL&1)<<7|(b.RSA&1)<<6|(b.RSP&1)<<5|(b.PAE&1)<<4;f=f?new Buffer([0,b]):new Buffer([b]);h=new x.hub.m.enocean.ESP3.Telegram.VLD(f,
h,0);h.setDstId(this._address);a.sendTelegram(h,!0,function(a){d&&d(a)})};y.prototype._reportStates=function(a){if(a&&0<Object.keys(a).length){var b=require("x.hub.m.enocean.js").getRehauHandler();b&&(a.alarm_enabled=this.getBufferedState("alarm_enabled"),a.pre_alarm_enabled=this.getBufferedState("pre_alarm_enabled"),b.onReceiveWindowSensorStates(this,a))}};y.prototype._setAlarm=function(a){this.activeStateChange({alarm_enabled:a});require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardAlarm(this._address,
a)};y.prototype._setPreAlarm=function(a){this.activeStateChange({pre_alarm_enabled:a});require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardPreAlarm(this._address,a)};y.prototype._setAlarmTask=function(a){this.activeStateChange({alarm_task_active:a})};y.prototype._setPreAlarmTask=function(a){this.activeStateChange({pre_alarm_task_active:a})};y.prototype._isAlarmActive=function(){var a=!0,b=!0;this._states&&this._states.alarm_enabled&&(b=this._states.alarm_enabled.value,"undefined"==typeof b||
null==b)&&(b=!0);if(!b)return!1;b=!1;if(this._states&&this._states.alarm_task_active){b=this._states.alarm_task_active.value;if("undefined"==typeof b||null==b)b=!1;a=b}return a};y.prototype._isPreAlarmActive=function(){var a=!0,b=!0;this._states&&this._states.pre_alarm_enabled&&(b=this._states.pre_alarm_enabled.value,"undefined"==typeof b||null==b)&&(b=!0);if(!b)return!1;b=!1;if(this._states&&this._states.pre_alarm_task_active){b=this._states.pre_alarm_task_active.value;if("undefined"==typeof b||
null==b)b=!1;a=b}return a};y.prototype._startTimeoutTimer=function(){var a=this;return setTimeout(function(){a.activeStateChange({timeout:!0})},36E5)};y.prototype._startPreAlarmTimer=function(){this._prealarmTO&&clearTimeout(this._prealarmTO);var a=this;this._prealarmTO=setTimeout(function(){a.activeStateChange({pre_alarm:!1});var b=a.getCurrentStates();a._reportStates(b)},1E4)};y.prototype._clearPreAlarmTimer=function(){this._prealarmTO&&(clearTimeout(this._prealarmTO),this._prealarmTO=null)};y.prototype._startAlarmTimer=
function(){this._alarmTO&&clearTimeout(this._alarmTO);var a=this;this._alarmTO=setTimeout(function(){a.activeStateChange({alarm:!1});var b=a.getCurrentStates();a._reportStates(b)},12E4)};y.prototype._clearAlarmTimer=function(){this._alarmTO&&(clearTimeout(this._alarmTO),this._alarmTO=null)};y.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params,hopCount:this._hopCount,saLearnMode:this._saLearnMode,
originalEEP:this._originalEEP}};y.prototype.fromJSON=function(a){if(!a||!a.address||!a.data||a.data!=this._data)return null;this._address=a.address;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();return this};y.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,
vendor:this._vendor,params:this._params,virtual:this._virtual,hopCount:this._hopCount,saLearnMode:this._saLearnMode,originalEEP:this._originalEEP}};y.prototype.fromDBJSON=function(a){if(!a||!a.id||!a.eep||a.eep!=this._data)return null;this._address=a.id;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();
return this};var Ec=function(a){y.call(this,a);this._data="d2-06-10"};Ec.prototype=new y;Ec.prototype.constructor=Ec;return{"f6-??-??":b,"f6-01-01":h,"f6-02-01":k,"f6-02-02":l,"f6-02-03":m,"f6-02-04":n,"f6-03-01":q,"f6-03-02":t,"f6-04-01":A,"f6-04-02":H,"f6-05-00":F,"f6-05-01":G,"f6-05-02":w,"f6-10-00":J,"f6-10-01":W,"d5-xx-xx":d,"d5-??-??":P,"d5-00-01":E,"f6-so-da":f,"a5-??-??":r,"a5-02-01":M,"a5-02-02":X,"a5-02-03":S,"a5-02-04":T,"a5-02-05":u,"a5-02-06":Ob,"a5-02-07":Pb,"a5-02-08":Qb,"a5-02-09":Rb,
"a5-02-0a":Sb,"a5-02-0b":Tb,"a5-02-10":Ub,"a5-02-11":Vb,"a5-02-12":Wb,"a5-02-13":Xb,"a5-02-14":Yb,"a5-02-15":Zb,"a5-02-16":$b,"a5-02-17":ac,"a5-02-18":bc,"a5-02-19":cc,"a5-02-1a":dc,"a5-02-1b":ec,"a5-02-20":ua,"a5-02-30":fc,"a5-04-01":gc,"a5-04-02":Ca,"a5-04-03":Qa,"a5-06-01":Da,"a5-06-02":va,"a5-06-03":Ra,"a5-06-04":Sa,"a5-06-05":hc,a5_07_01:Ea,a5_07_02:Fa,a5_07_03:Ga,"a5-08-01":Ha,"a5-08-02":ic,"a5-08-03":jc,"a5-09-02":Ta,"a5-09-04":Ua,"a5-09-05":Va,"a5-09-06":Wa,"a5-09-07":Xa,"a5-09-08":Ya,"a5-09-09":Za,
"a5-09-0a":$a,"a5-09-0b":ab,"a5-09-0c":bb,"a5-10-01":z,"a5-10-02":ca,"a5-10-03":wa,"a5-10-04":cb,"a5-10-05":db,"a5-10-06":xa,"a5-10-07":eb,"a5-10-08":fa,"a5-10-09":ga,"a5-10-0a":ra,"a5-10-0b":ya,"a5-10-0c":fb,"a5-10-0d":gb,"a5-10-10":N,"a5-10-11":sa,"a5-10-12":hb,"a5-10-13":ib,"a5-10-14":jb,"a5-12-00":lb,"a5-12-01":da,"a5-12-02":za,"a5-12-03":kc,"a5-13-01":lc,"a5-13-02":mc,"a5-13-03":nc,"a5-13-04":oc,"a5-13-05":pc,"a5-13-06":qc,"a5-14-01":mb,"a5-14-02":nb,"a5-14-03":ob,"a5-14-04":pb,"a5-14-05":qb,
"a5-14-06":rb,"a5-14-07":sb,"a5-14-08":tb,"a5-14-09":ub,"a5-14-0a":vb,"a5-20-04":ba,"a5-30-01":Aa,"a5-30-02":wb,"a5-30-03":na,"a5-30-04":xb,"a5-38-08":R,"d2-??-??":Z,"d2-01-00":ea,"d2-01-01":yb,"d2-01-03":zb,"d2-01-11":ta,"d2-01-13":ha,"d2-01-14":ia,"d2-05-00":L,"d2-05-01":oa,"d2-06-01":pa,"d2-06-02":qa,"d2-06-10":Ec,"d2-06-50":a,"d2-20-00":U,eltako_dimmer:I,eltako_dimmer2:Ma,eltako_fsud:Cb,eltako_motion:Bb,eltako_contact:Ab,eltako_weather:Db,eltako_lux:Eb,eltako_lux2:wc,eltako_sender2:yc,eltako_sender4:zc,
eltako_button1:xc,eltako_button2:Ac,eltako_button4:Bc,eltako_blind:V,eltako_fsm60b:Fb,eltako_fkf:Gb,eltako_fkc:Hb,eltako_thermo:Ba,eltako_futh65d:Cc,eltako_ftr78s:Ib,eltako_powermeter:Na,eltako_powermeter2:Dc,eltako_fzs:Oa,eltako_switch:ja,eltako_relay:Kb,eltako_relay2:Jb,eltako_heat:Lb,eltako_water_m3:Mb,eltako_water_m4:Nb,peha_switch:Pa,peha_powerswitch:ka,peha_blind:la,"bb-aa-cc":y,parseDBJson:function(a){if(!a||!a.eep)return null;var b=this[a.eep];if(!b)return null;b=new b;return b=b.fromDBJSON(a)},
parseJson:function(a){if(!a||!a.data)return null;var b=this[a.data];if(!b)return null;b=new b;return b=b.fromJSON(a)}}}();
x.hub.m.enocean.SiegeniaHandler=function(){var g=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SiegeniaHandler");this._esp3=a;this._calibateListener=this._window=this._windowID=this._esp3Listener=null};g.prototype.startCalibateWindow=function(a,d){if(this._calibateListener)d&&d(Error("configuraion of window running"));else{this._calibateListener=d;this._windowID=a;this._window=new x.hub.m.enocean.profiles["d2-06-50"];var f=this;this._esp3Listener={_onEOTelegram:function(a){var d=
!1;f._windowID&&f._windowID==a.senderID?d=!0:f._windowID||210!=a.rorg||(d=!0);d&&f._calibateListener&&(d=f._window.evalTelegram(a))&&17==d.type&&f._calibateListener(null,a.senderID,d)}};this._esp3.addListener(this._esp3Listener)}};g.prototype.stopCalibateWindow=function(){this._esp3Listener&&this._esp3.removeListener(this._esp3Listener);this._window=this._windowID=this._calibateListener=this._esp3Listener=null};g.prototype.configWindow=function(a,d,f,b){d="FFFFFFFF";b||(b=x.hub.m.enocean.SENDER_ID);
this._logger.log("info","config siegenia window:"+JSON.stringify(a));this._logger.log("info","window id:"+d+" sender id:"+b);var h=parseInt(a.alive),g=parseInt(a.sync),l=parseInt(a.eep),m=parseInt(a.type),n=parseInt(a.alarm);a=parseInt(a.alarm_sens);var q=[128,2,127,240,1,140,57,45,245],t=[192,13,127,242,49,0,0,2,h>>8&255],A=[193,h&255,0,1,2,g>>8&255,g&255,0,2],H=[194,1,l,0,3,1,m,0,4],F=[195,1,n,0,5,1,a,0,0],G=[128,2,127,240,2,140,57,45,245],w=this;this._logger.log("info","send config siegenia window (data1):"+
(new Buffer(q)).toString("hex"));this._esp3._recomm.sendRawSysEx(new Buffer(q),d,b,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data1):"+a.message+" ["+a.code+"]"),100!=a.code)){f&&f(a);return}w._logger.log("info","send config siegenia window (data2):"+(new Buffer(t)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(t),d,b,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data2):"+a.message+" ["+a.code+"]"),100!=a.code)){f&&f(a);return}w._logger.log("info",
"send config siegenia window (data3):"+(new Buffer(A)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(A),d,b,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data3):"+a.message+" ["+a.code+"]"),100!=a.code)){f&&f(a);return}w._logger.log("info","send config siegenia window (data4):"+(new Buffer(H)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(H),d,b,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data4):"+a.message+" ["+a.code+"]"),
100!=a.code)){f&&f(a);return}w._logger.log("info","send config siegenia window (data5):"+(new Buffer(F)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(F),d,b,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data5):"+a.message+" ["+a.code+"]"),100!=a.code)){f&&f(a);return}w._logger.log("info","send config siegenia window (data6):"+(new Buffer(G)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(G),d,b,function(a){a&&w._logger.log("warn","config siegenia window error (data5):"+
a.message+" ["+a.code+"]");a&&100!=a.code?f&&f(a):f&&f()})})})})})})};return g}();
x.hub.m.enocean.RehauHandler=function(){var g=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.InoventAccessory");this._inoventID=a;this._co2SensorID=this._humiditySensorID=null;this._sensorRegulationActive=!1;this._humidityState=null;this._humidityLevel=0;this._co2State=null;this._co2Level=0};g.prototype.getHumiditySensorID=function(){return this._humiditySensorID};g.prototype.setHumiditySensorID=function(a){this._humiditySensorID=a};g.prototype.getCo2SensorID=
function(){return this._co2SensorID};g.prototype.setCo2SensorID=function(a){this._co2SensorID=a};g.prototype.activateSensorRegulation=function(){this._sensorRegulationActive=!0;this._co2Level=this._humidityLevel=0;null!=this._humidityState&&this.executeHumidityRegulation(this._humidityState);null!=this._co2State&&this.executeCo2Regulation(this._co2State)};g.prototype.deactivateSensorRegulation=function(){this._sensorRegulationActive=!1;this._co2Level=this._humidityLevel=0};g.prototype.executeHumidityRegulation=
function(a){this._humidityState=a;this._logger.log("trace","["+this._inoventID+"] receive hum:"+a);if(this._sensorRegulationActive){var d=this._calculateHumidityLevel(a);this._logger.log("trace","["+this._inoventID+"] target level:"+d);(!this._humidityLevel||d!=this._humidityLevel&&this._exceedHumidityHysteresis(this._humidityLevel,a))&&this._changeHumLevel(d)}};g.prototype._calculateHumidityLevel=function(a){return 50>=a?1:60>=a?2:70>=a?3:4};g.prototype._exceedHumidityHysteresis=function(a,d){switch(a){case 1:return 55<=
d;case 2:return 45>=d||65<=d;case 3:return 55>=d||75<=d;case 4:return 65>=d}};g.prototype._changeHumLevel=function(a){var d=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setHumLevel"+a},function(f){f&&f.error||(d._humidityLevel=a)})};g.prototype.executeCo2Regulation=function(a){this._co2State=a;this._logger.log("trace","["+this._inoventID+"] receive co2:"+a);if(this._sensorRegulationActive){var d=this._calculateCo2Level(a);this._logger.log("trace","["+this._inoventID+
"] target level:"+d);(!this._co2Level||d!=this._co2Level&&this._exceedCo2Hysteresis(this._co2Level,a))&&this._changeCo2Level(d)}};g.prototype._calculateCo2Level=function(a){return 600>=a?1:1E3>=a?2:1500>=a?3:4};g.prototype._exceedCo2Hysteresis=function(a,d){switch(a){case 1:return 700<=d;case 2:return 500>=d||1100<=d;case 3:return 900>=d||1600<=d;case 4:return 1400>=d}};g.prototype._changeCo2Level=function(a){var d=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setCo2Level"+
a},function(f){f&&f.error||(d._co2Level=a)})};g.prototype.toJSON=function(){return{humidity:this._humiditySensorID,co2:this._co2SensorID}};g.prototype.fromJSON=function(a){a&&(this._humiditySensorID=a.humidity,this._co2SensorID=a.co2)};var a=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.WindowAlarm");this._handler=a;this._active=!1;this._sensors={}};a.prototype.setAlarm=function(a){this._logger.log("trace","set alarm active:"+a);this._active=a};a.prototype.getAlarm=
function(){return this._active};a.prototype.onReceiveWindowSensorStates=function(a,d){this._logger.log("trace","receive window:"+a.getAddress()+" states:"+JSON.stringify(d));if(this._active){var f=a.getAddress(),g=this._sensors[f];g||(this._sensors[f]={lastEvent:"IDLE"},g=this._sensors[f]);this._logger.log("trace","last event for window:"+a.getAddress()+" is:"+g.lastEvent);d&&(d.pre_alarm&&"PRE_ALARM"!=g.lastEvent?(g.lastEvent="PRE_ALARM",this._logger.log("trace","window:"+a.getAddress()+" pre_alarm triggered"),
this.triggerAlarm(!0)):d.alarm&&"ALARM"!=g.lastEvent?(g.lastEvent="ALARM",this._logger.log("trace","window:"+a.getAddress()+" alarm triggered"),this.triggerAlarm()):d.alarm||d.pre_alarm||(this._logger.log("trace","new event for window:"+a.getAddress()+" is:IDLE and stop timer"),g.lastEvent="IDLE"))}};a.prototype.triggerAlarm=function(a){require("x.hub.taskman.js").getRehauAlarmTaskManager().onWindowSensorAlarmTriggered(a)};var d=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.SmartguardSetting");
this._smartguardID=a;this._prealarmActive=this._alarmActive=!0};d.prototype.isAlarmActive=function(){return this._alarmActive?!0:!1};d.prototype.isPreAlarmActive=function(){return this._prealarmActive?!0:!1};d.prototype.setAlarm=function(a){this._alarmActive=a?!0:!1};d.prototype.setPreAlarm=function(a){this._prealarmActive=a?!0:!1};d.prototype.toJSON=function(){return{alarm:this._alarmActive,pre_alarm:this._prealarmActive}};d.prototype.fromJSON=function(a){a&&(this._alarmActive=a.alarm,this._prealarmActive=
a.pre_alarm)};var f=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler");this._mainHandler=null;this._windowAlarm=new a(this);this._inoventAccessories={};this._smartguardSettings={}};f.prototype.REHAU_FILE="enocean_rehau.json";f.prototype.init=function(a,d){this._logger.log("trace","init");var f=this;if(this._mainHandler=a){var g=a.getDeviceHandler();if(g)g.on("deleteDevice",function(a){f.onDeleteDevice(a)})}this._loadInoventAccessories(function(a,b,g){a&&f._logger.log("warn",
"init error:"+a.message);b&&(f._inoventAccessories=b);g&&(f._smartguardSettings=g);d&&d()})};f.prototype.getInoventAccessory=function(a){return a?this._inoventAccessories[a]:null};f.prototype.deleteInoventAccessory=function(a,d){a&&this._inoventAccessories[a]?(delete this._inoventAccessories[a],this._saveData(d)):d&&d()};f.prototype.getSmartguardSetting=function(a){return a?this._smartguardSettings[a]:null};f.prototype.deleteSmartguardSetting=function(a,d){a&&this._smartguardSettings[a]?(delete this._smartguardSettings[a],
this._saveData(d)):d&&d()};f.prototype.setHumidityAccessory=function(a,d,f){if(a){var l=this.getInoventAccessory(a);l||(l=new g(a),this._inoventAccessories[a]=l);l.setHumiditySensorID(d);this._saveData(f)}else f&&f(Error("inoventID is null"))};f.prototype.setCo2Accessory=function(a,d,f){if(a){var l=this.getInoventAccessory(a);l||(l=new g(a),this._inoventAccessories[a]=l);l.setCo2SensorID(d);this._saveData(f)}else f&&f(Error("inoventID is null"))};f.prototype.activateSensorRegulation=function(a){(a=
this.getInoventAccessory(a))&&a.activateSensorRegulation()};f.prototype.deactivateSensorRegulation=function(a){(a=this.getInoventAccessory(a))&&a.deactivateSensorRegulation()};f.prototype.isWindowOpen=function(){var a=this._mainHandler.getDeviceHandler(),d=a.findDeviceWithData("bb-aa-cc");(a=a.findDeviceWithData("d2-06-10"))&&(d=d.concat(a));for(var a=!1,f=0;f<d.length;f++){var g=d[f];if(g&&"open"==g.getBufferedState("window")){a=!0;break}}return a};f.prototype.setAlarm=function(a,d){this._windowAlarm.setAlarm(a);
var f=this._mainHandler.getDeviceHandler(),g=f.findDeviceWithData("bb-aa-cc");(f=f.findDeviceWithData("d2-06-10"))&&(g=g.concat(f));for(var f=this._mainHandler.getESP3(),m=0;m<g.length;m++){var n=g[m];n&&(n.executeCommand(f,{value:a?"alarmTaskOn":"alarmTaskOff"}),n.executeCommand(f,{value:a?"preAlarmTaskOn":"preAlarmTaskOff"}))}d&&d()};f.prototype.getAlarm=function(){return this._windowAlarm.getAlarm()};f.prototype.setSmartGuardAlarm=function(a,f,g){if(a){var l=this._smartguardSettings[a];l||(l=new d(a),
this._smartguardSettings[a]=l);l.setAlarm(f);this._saveData(g)}else g&&g(Error("smartguardID invalid"))};f.prototype.setSmartGuardPreAlarm=function(a,f,g){if(a){var l=this._smartguardSettings[a];l||(l=new d(a),this._smartguardSettings[a]=l);l.setPreAlarm(f);this._saveData(g)}else g&&g(Error("smartguardID invalid"))};f.prototype.onReceiveWindowSensorStates=function(a,d){this._windowAlarm.onReceiveWindowSensorStates(a,d)};f.prototype.onDeleteDevice=function(a){if(a&&(a=a.getAddress()))if(this.getInoventAccessory(a))this.deleteInoventAccessory(a);
else if(this.getSmartguardSetting(a))this.deleteSmartguardSetting(a);else{var d=!1,f;for(f in this._inoventAccessories){var g=this._inoventAccessories[f];g&&(g.getHumiditySensorID()==a&&(g.setHumiditySensorID(null),d=!0),g.getCo2SensorID()==a&&(g.setCo2SensorID(null),d=!0))}d&&this._saveData()}};f.prototype.onDeviceEvent=function(a,d){var f=function(a){for(var b=null,d=0;d<a.length;d++){var f=a[d];if(f&&"humidity"==f.key){b=f.value;break}}return b},g=function(a){for(var b=null,d=0;d<a.length;d++){var f=
a[d];if(f&&"co2"==f.key){b=f.value;break}}return b};if(a){var m=a.getAddress();if(m){var n=null;switch(a.getData()){case "a5-04-01":case "a5-04-03":case "a5-10-12":n=f(d);break;case "a5-09-08":case "a5-09-09":n=g(d);break;default:return}if(void 0!=n&&null!=n)for(var q in this._inoventAccessories)if(f=this._inoventAccessories[q])f.getHumiditySensorID()==m&&f.executeHumidityRegulation(n),f.getCo2SensorID()==m&&f.executeCo2Regulation(n)}}};f.prototype._loadInoventAccessories=function(a){var d=this;this._loadFile(function(f,
g){if(f)a&&a(f);else{var m=d._jsonToAccessoriesMap(g),n=d._jsonToSmartGuardSettingsMap(g);a&&a(null,m,n)}})};f.prototype._jsonToAccessoriesMap=function(a){if(!a||!a.inovent)return{};var d={},f;for(f in a.inovent){var l=a.inovent[f];if(l){var m=new g(f);m.fromJSON(l);d[f]=m}}return d};f.prototype._jsonToSmartGuardSettingsMap=function(a){if(!a||!a.smartguard)return{};var f={},g;for(g in a.smartguard){var l=a.smartguard[g];if(l){var m=new d(g);m.fromJSON(l);f[g]=m}}return f};f.prototype._loadFile=function(a){var d=
this._getFilePath();fs_extra.ensureFile(d,function(f){f?a&&a(f):fs_extra.readFile(d,"utf8",function(d,f){if(d)a&&a(d);else if(f)try{var g=JSON.parse(f);a&&a(null,g)}catch(h){a&&a(h)}else a&&a(null,{})})})};f.prototype._getFilePath=function(){var a=require("x.hub.fileman.js").fileManager,d=require("path");require("fs");a=a.getUserRootDataPath();return d.resolve(a,this.REHAU_FILE)};f.prototype._saveData=function(a){var d=this._accessoriesMapToJson(this._inoventAccessories),f=this._settingsMapToJson(this._smartguardSettings);
this._saveFile({inovent:d?d:{},smartguard:f?f:{}},function(d){a&&a(d)})};f.prototype._accessoriesMapToJson=function(a){if(!a)return{};var d={},f;for(f in a){var g=a[f];g&&(g=g.toJSON(),d[f]=g)}return d};f.prototype._settingsMapToJson=function(a){if(!a)return{};var d={},f;for(f in a){var g=a[f];g&&(g=g.toJSON(),d[f]=g)}return d};f.prototype._saveFile=function(a,d){var f=this._getFilePath();fs_extra.writeFile(f,JSON.stringify(a,null,2),function(a){d&&d(a)})};return f}();
x.hub.m.enocean.SDK=function(){var g=function(a){this._handler=a};g.prototype.send_SA_RD_LEARNEDCLIENTS=function(a,d){var f=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_RD_LEARNEDCLIENTS;this._handler._esp3.sendSACommand(f,!0,function(a,f){d&&d(a,f)})};g.prototype.send_SA_WR_RESET=function(a,d){if(a&&a.saClientId){var f=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_RESET(a.saClientId);this._handler._esp3.sendSACommand(f,!0,function(a,f){d&&d(a,f)})}else d&&d(Error("params invalid"))};g.prototype.send_SA_WR_POSTMASTER=
function(a,d){if(a){a.mailboxCount||(a.mailboxCount=0);var f=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_POSTMASTER(a.mailboxCount);this._handler._esp3.sendSACommand(f,!0,d)}else d&&d(Error("params invalid"))};g.prototype.send_CO_WR_REPEATER=function(a,d){if(a){a.enable||(a.enable=0);a.level||(a.level=0);var f=new x.hub.m.enocean.ESP3.COMMAND_COMMAND.CO_WR_REPEATER(a.enable,a.level);this._handler._esp3.sendCommandCommand(f,!0,d)}else d&&d(Error("params invalid"))};return g}();
x.hub.m.enocean.USBHandler=function(){var g=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.USBHandler");this._handler=a;this._usbDevices=[];this._connectedDevice=null};g.prototype.attachSerial=function(a){this._logger.log("debug","attach usb port:"+a);var d=this._usbDevices.length;this._usbDevices.push({port:a});0==d&&this._attachNextDevice()};g.prototype.removeSerial=function(a){this._logger.log("debug","remove usb port:"+a);var d=this._handler._esp3.getSerial();d&&d.getPort()==
a&&this._handler._esp3.removeSerial(a);this._connectedDevice&&this._connectedDevice.port==a&&(this._connectedDevice=null)};g.prototype._attachNextDevice=function(){if(0!=this._usbDevices.length){var a=this._usbDevices[0],d=this;this._logger.log("debug","connect usb port:"+a.port);this._handler._esp3.attachSerial(a.port,function(f){f?(d._logger.log("debug",a.port+" is not a enocean usb device, error:"+f.message),d._usbDevices.splice(0,1),d._attachNextDevice()):(d._logger.log("debug","success to connect to enocean usb device on port:"+
a.port),d._connectedDevice=a,d._usbDevices=[])})}};return g}();
x.hub.m.enocean.Handler=function(){var g=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Handler");this._secHandler=new this.SecurityHandler(this);this._deviceHandler=new this.DeviceHandler(this);this._esp3=new x.hub.m.enocean.ESP3(this);this._learnHandler=new this.LearnHandler(this);this._siegeniaHandler=new x.hub.m.enocean.SiegeniaHandler(this._esp3);this._rehauHandler=new x.hub.m.enocean.RehauHandler;this._trackers=[];this._sdk=new x.hub.m.enocean.SDK(this);this._usb=
new x.hub.m.enocean.USBHandler(this)};util.inherits(g,EventEmitter);g.prototype.SENSOR_FILE="enocean.json";g.prototype.SECURITY_FILE="enocean_sec.json";g.prototype.ESP3=x.hub.m.enocean.ESP3;g.prototype.SecurityHandler=x.hub.m.enocean.SecurityHandler;g.prototype.LearnHandler=x.hub.m.enocean.LearnHandler;g.prototype.DeviceHandler=x.hub.m.enocean.DeviceHandler;g.prototype.getDeviceHandler=function(){return this._deviceHandler};g.prototype.getRehauHandler=function(){return this._rehauHandler};g.prototype.getESP3=
function(){return this._esp3};g.prototype.init=function(a){localStorage&&localStorage.getItem("x.hub.m.enocean.SENDER_ID")&&(x.hub.m.enocean.SENDER_ID=localStorage.getItem("x.hub.m.enocean.SENDER_ID"));var d=this,f=require("x.hub.eventbus.js");f.on("x.hub.peripheralman.ADD_ENOCEAN",function(a){console.log("ADD_ENOCEAN",a);d._usb.attachSerial(a.port)});f.on("x.hub.peripheralman.REMOVE_ENOCEAN",function(a){console.log("REMOVE_ENOCEAN",a);d._usb.removeSerial(a.port)});f.on("x.hub.peripheralman.ADD_SEIRAL",
function(a){console.log("ADD_SEIRAL",a);a.type||d._usb.attachSerial(a.port)});f.on("x.hub.peripheralman.REMOVE_SEIRAL",function(a){console.log("REMOVE_SEIRAL",a);a.type||d._usb.removeSerial(a.port)});global.ENOCEAN_PORT&&"A20"!=global.PLATFORM&&"PI2"!=global.PLATFORM&&d._usb.attachSerial(global.ENOCEAN_PORT);this._secHandler.init(function(){d._rehauHandler.init(d,function(){d._deviceHandler.init(function(){a&&a({})})})})};g.prototype.getSystems=function(){return["enocean"]};g.prototype.addStateDevice=
function(a,d){d&&d({})};g.prototype.getAllStates=function(){var a=[],d=this._deviceHandler.getAllDevices(),f;for(f in d)if(d.hasOwnProperty(f)){var b=d[f];b&&a.push({device:b.toJSON(),states:b.getStatesBuffer()})}return a};g.prototype.getStates=function(a){if(!a||!a.address)return null;var d=null;(a=this._deviceHandler.getDevice(a.address.toLowerCase()))&&(d=a.getStatesBuffer());return d};g.prototype.getState=function(a,d,f){var b=this.getStates(a),g=null;b&&"undefined"!=typeof b[d]&&null!=b[d]?(g=
b[d],f&&f({data:g})):f&&this.updateStates(a,function(a){a.error?f&&f(a):(a.data&&(g=b[d]),f({data:g}))});return g};g.prototype.executeCommand=function(a,d,f){this._esp3._baseID?this._esp3._baseID.toLowerCase()!=x.hub.m.enocean.SENDER_ID.toLowerCase()?f&&f({error:Error("enocean stick has a different baseID")}):a&&a.address?((a=a.address)&&(a=a.toLowerCase()),(a=this._deviceHandler.getDevice(a))?a.executeCommand?a.executeCommand(this._esp3,d,function(a){f&&f({error:a})}):f&&f({error:Error("device dese not support command")}):
f&&f({error:Error("no such device")})):f&&f({error:Error("device invalid")}):f&&f({error:Error("enocean stick not found")})};g.prototype.checkDeviceMatch=function(a,d){if(!(d&&d.device&&a&&a.device))return!1;var f=a.device.address;f&&(f=f.toLowerCase());var b=d.device.address;b&&(b=b.toLowerCase());return f==b};g.prototype.updateStates=function(a,d){d&&d({error:Error("not supported yet")})};g.prototype.executeCommandLegacy=function(a,d,f,b){a?b&&b({error:Error("not supported yet")}):this._esp3?d?
this.executeCommand({address:d},{value:f},function(a){b&&b({error:a?a.error:null})}):b&&b({error:Error("address invalid")}):b&&b({error:Error("not inited")})};g.prototype.getAllStatesLegacy=function(a,d){var f=[],b=this.getAllStates(),g=this._secHandler.getUnsyncDevice();b.forEach(function(a){if(a&&a.device&&a.states){var b=a.device.address,m={type:"ENOCEAN",adr:b,data:a.device.data,vendor:a.device.vendor,state:{}},n;for(n in a.states)m.state[n]=a.states[n].value;d&&"1"==d.config&&(m.senderID=a.device.senderID,
m.virtual=a.device.virtual,m.params=a.device.params,b&&g[b]&&(m.rlc_unsync=!0));f.push(m)}});a&&a({data:f})};g.prototype.getEnoceanInfo=function(){return{baseID:x.hub.m.enocean.SENDER_ID,usb_connected:null!=this._esp3._serial,usb_baseID:this._esp3._baseID,num_free_senderID:this._deviceHandler.getFreeSenderIdCount()}};g.prototype.learnDevice=function(a,d){var f=a?a.senderID:null,b=a?a.data:null,g=a?a.vendor:null,k=a?a.address:null;if(k){b=this._deviceHandler.findDevice(a);if(!b){d&&d({error:Error("device not found")});
return}var l=b.toJSON(),b=l.data,g=l.vendor;f||(sednerID=l.senderID)}l={};l.saLearnMode=a?a.saLearnMode:null;this._learnHandler.learn(b,k,f,g,null,function(a,b,f){a?d&&d({error:a}):(a={},1==b?a.op=1:(a=f.toJSON(),a.op=0),d&&d({data:a}))},l)};g.prototype.learnSoda=function(a){if(this._esp3._serial){var d=this,f=setTimeout(function(){d._esp3.removeListener(b);a&&a({error:Error("learn timeout")})},2E4),b={_onEOTelegram:function(g){if(246==g.rorg&&(192==g.userData||208==g.userData||240==g.userData)){clearTimeout(f);
d._esp3.removeListener(b);var k={address:g.senderID,data:"f6-so-da",vendor:"soda"};d.addSensor(g.senderID,"f6-so-da","soda",null,function(b){b.error?a&&a(b):a&&a({data:k})})}}};this._esp3.addListener(b)}else a&&a({error:Error("port not opened")})};g.prototype.teachinDevice=function(a,d){if(a)if(a.data){var f=this._deviceHandler.findDevice(a);!f&&a.address?d&&d({error:Error("device not found")}):(f=f?f.toJSON():a,a.data!=f.data?d&&d({error:Error("device of another type with the same address exists")}):
a.vendor&&a.vendor!=f.vendor?d&&d({error:Error("device of another vendor with the same address exists")}):this._learnHandler.teachin(f.data,f.address,f.senderID,f.vendor,function(a,f,g){a?d&&d({error:a}):(a={},f&&(a=f.toJSON()),g&&(a.op=g),d&&d({data:a}))}))}else d&&d({error:Error("data is null")});else d&&d({error:Error("query is null")})};g.prototype.generateVirtualDevice=function(a,d){this._deviceHandler.generateVirtual(a,function(a,b){d&&d({error:a,data:b?b.toJSON():null})})};g.prototype._onEOFrame=
function(a,d){this._trackers.forEach(function(f){f.onFrame(a,d)})};g.prototype._onEOTelegram=function(a){this._trackers.forEach(function(b){b.onTelegram(a)});var d=this._deviceHandler.getDevice(a.senderID);if(d){var f=this;d.evalData(this._esp3,a,function(a,g){a||f._onEOEvents(d,g)})}};g.prototype._onEOEvents=function(a,d){var f=require("x.hub.eventbus.js");this._trackers.forEach(function(b){b.onResolveEvents(a._address,d)});this._rehauHandler.onDeviceEvent(a,d);var b=a.toJSON();b.sys="aio";b.type=
"ENOCEAN";for(var g=0;g<d.length;g++){var k=d[g];if(k&&("shortPress"==k.value||"longPress"==k.value)){var l={type:"ENOCEAN",adr:b.address,data:b.data,vendor:b.vendor,state:{}};l.state[k.key]=k.value;f.emit("gatewayevent",l,{address:"ENOCEAN"},"BTN")}}if(b=a.getStatesLegacy())f.emit("gatewayevent",b,{address:"ENOCEAN"},"STA"),f.emit("udpevent",b,"STA")};g.prototype._saveEnoceanEvents=function(a,d){var f=require("x.hub.datastore.js").dataStore;f&&f.openDB(function(b,f){if(!b){for(var g=a._address,l=
[],m=(new Date).toISOString(),n=0;n<d.length;n++){var q=d[n];if(q&&q.changed){var q=q.key+":"+q.value,t=null,t=0==l.length?"SELECT '"+g+"' AS 'window', '"+q+"' AS 'state', '"+m+"' AS 'time'":"UNION ALL SELECT '"+g+"', '"+q+"', '"+m+"'";l.push(t)}}0<l.length&&(g=l.join(" "),g="INSERT INTO windowstate(window, state, time) "+g+";",f.run(g,function(a){f.close()}))}})};g.prototype.addSensor=function(a,d){a?a.data?"siegenia"!=a.vendor||a.params?this._deviceHandler.addDevice(a,function(a,b){d&&d({error:a,
data:b?b.toJSON():null})}):d&&d({error:Error("siegenia windows params is null")}):d&&d({error:Error("enocean profile is null")}):d&&d({error:Error("enocean device is null")})};g.prototype.updateSensor=function(a,d,f){a?d?this._deviceHandler.updateDevice(a,d,function(a,d){f&&f({error:a,data:d?d.toJSON():null})}):f&&f({error:Error("device info is null")}):f&&f({error:Error("device address is null")})};g.prototype.delSensor=function(a,d){a?this._deviceHandler.deleteDevice({address:a},function(a){d&&
d({error:a})}):d&&d({error:Error("enocean id is null")})};g.prototype.resetDefaultSenderID=function(a){x.hub.m.enocean.SENDER_ID=null;localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID","");a&&a({})};g.prototype.setRehauAlarm=function(a,d){this._rehauHandler.setAlarm(a,d)};g.prototype.isRehauWindowOpen=function(){return this._rehauHandler.isWindowOpen()};g.prototype.setInoventHumidityAccessory=function(a,d,f){this._rehauHandler.setHumidityAccessory(a,d,function(a){f&&f({error:a})})};g.prototype.setInoventCo2Accessory=
function(a,d,f){this._rehauHandler.setCo2Accessory(a,d,function(a){f&&f({error:a})})};g.prototype.getInoventAccessories=function(a,d){var f=this._rehauHandler.getInoventAccessory(a);d&&d({data:f?f.toJSON():{}})};g.prototype.__addTelegramTracker=function(a){a&&a.onTelegram&&a.onResolveEvents&&-1==this._trackers.indexOf(a)&&this._trackers.push(a)};g.prototype.__removeTelegramTracker=function(a){a&&(a=this._trackers.indexOf(a),-1!=a&&this._trackers.splice(a,1))};g.prototype.__sendEspFrame=function(a,
d,f,b,g){d=d?new Buffer(d,"hex"):null;f=f?new Buffer(f,"hex"):null;b=b?!0:!1;a=new x.hub.m.enocean.ESP3.ESP3_Frame(a,d,f);this._esp3.sendFrame(a,b,function(a,b){g&&g({error:a,data:b?b.toJSON():null})})};g.prototype.__simulateRawEnoceanPacket=function(a,d){this._esp3.onSerialData(new Buffer(a,"hex"));d&&d()};g.prototype._doSDK=function(a,d){if(a&&a.method){var f="send_"+a.method;if(this._sdk[f])this._sdk[f](a.params,function(a){d&&d({error:a})});else d&&d({error:Error("no such method")})}else d&&d({error:Error("data invalid")})};
return g}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.enocean.Handler);
