var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,a,e){f!=Array.prototype&&f!=Object.prototype&&(f[a]=e.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var f=0;return function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+f++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(f){var a=0;return $jscomp.iteratorPrototype(function(){return a<f.length?{done:!1,value:f[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,a){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var e=0,g={next:function(){if(e<f.length){var d=e++;return{value:a(d,f[d]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill=function(f,a,e,g){if(a){e=$jscomp.global;f=f.split(".");for(g=0;g<f.length-1;g++){var d=f[g];d in e||(e[d]={});e=e[d]}f=f[f.length-1];g=e[f];a=a(g);a!=g&&null!=a&&$jscomp.defineProperty(e,f,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var util=require("util"),EventEmitter=require("events"),crypto=require("crypto"),fs_extra=require("fs-extra"),fileman=require("x.hub.fileman.js");require("x.logger.js").setLevel("trace","x.hub.m.enocean");var x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.enocean=x.hub.m.enocean||{};x.hub.m.enocean.SENDER_ID=null;x.hub.m.enocean.MANUFACTURE_ID=2047;
x.hub.m.enocean._CRC8Table=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,
149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];
x.hub.m.enocean.CRC8=function(f){for(var a=0,e=0;e<f.length;e++)a=x.hub.m.enocean._CRC8Table[a^f[e]];return a};
x.hub.m.enocean.Serial=function(){var f=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Serial");this._port=a;this._serialPort=null};f.prototype.setListener=function(a){this._listener=a};f.prototype.open=function(a){if(this._serialPort)this._logger.log("warn","port:"+this._port+" already opened"),a&&a();else try{this._logger.log("trace","try to listen to port:"+this._port);var e=require("serialport");if(e){var g=a,d=new e.SerialPort(this._port,{baudrate:57600}),h=this;d.on("open",
function(){h._logger.log("trace","port:"+h._port+" opened");h._serialPort=d;d.flush();g&&g();g=null});d.on("error",function(d){h._logger.log("warn","enocean error:"+d.message);h._serialPort=null;if(g)g&&g(d),g=null;else if(h._listener&&h._listener.onSerialError)h._listener.onSerialError(d)});d.on("data",function(d){h._logger.log("trace","receive data "+d.toString("hex"));if(h._listener&&h._listener.onSerialData)h._listener.onSerialData(d)})}else this._logger.log("warn","no seiralport module"),a&&
a(Error("no seiralport modul"))}catch(k){this._logger.log("warn","init enocean via "+this._port+" error:"+k.message),g&&g(k),g=null}};f.prototype.close=function(){this._listener=null;this._serialPort&&this._serialPort.close();this._serialPort=null};f.prototype.sendPacket=function(a,e){this._serialPort?this._serialPort.write(a,e):e&&e(Error("port not opened"))};return f}();
x.hub.m.enocean.ReComm=function(){var f=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ReComm");this._esp3=a};f.prototype.sendRawSysEx=function(a,e,g,d){var h=this;a=new x.hub.m.enocean.ESP3.Telegram.ADT(197,a,e,g);this._esp3.sendTelegram(a,!0,function(e,a){setTimeout(function(){e?(h._logger.log("warn","ReComm command failed with err:"+e.message),d&&d(e)):a&&0!=a.retCode?(h._logger.log("warn","ReComm command failed with retCode:"+a.retCode),e=Error("ReComm command failed:"+
a.retCode),e.code=a.retCode,d&&d(e,a)):d&&d(null,a)},50)})};return f}();
x.hub.m.enocean.SecurityHandler=function(){var f=new Buffer("3410de8f1aba3eff9f5a117172eacabd","hex"),a=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SecurityHandler");this._secInfo={};this._unsync={}};a.prototype.SECURITY_FILE="enocean_sec.json";a.prototype.init=function(e){this._logger.log("trace","init");var a=this;this._loadSec(function(d,g){d&&a._logger.log("warn","init error:"+d.message);g&&(a._secInfo=g);e&&e()})};a.prototype.getUnsyncDevice=function(){return this._unsync};
a.prototype.secureTeachIn=function(e,a,d){this._logger.log("trace","secure teach-in:"+e);e&&(a.key&&delete a.key,this._secInfo[e]=a);this._saveSec(this._secInfo,d)};a.prototype.resolve=function(e){if(!e)return null;switch(e.rorg){case 53:return this._resolveSecureTeachIn(e);case 49:return this._resolveSecureMessage(e);default:return null}};a.prototype._resolveSecureTeachIn=function(e){var a={};e=e.userData;var d=e.readUInt8(0);a.teachInInfo={};a.teachInInfo.idx=d>>6&3;a.teachInInfo.cnt=d>>4&3;a.teachInInfo.psk=
d>>3&1;a.teachInInfo.type=d>>2&1;a.teachInInfo.info=d&3;0==a.teachInInfo.idx?(d=e.readUInt8(1),a.slf={},a.slf.rlc_algo=d>>6&3,a.slf.rlc_tx=d>>5&1,a.slf.mac_alro=d>>3&3,a.slf.data_enc=d&7,d=0,1==a.slf.rlc_algo?d=2:2==a.slf.rlc_algo&&(d=3),d&&(a.rlc=e.slice(2,2+d)),a.key=e.slice(2+d),a.completeKey=null):a.key=e.slice(1);return a};a.prototype._resolveSecureMessage=function(a){var e=a.senderID,d=this._secInfo[e];if(!d||!d.completeKey)return null;var h=0,k=0;1==d.slf.mac_alro?h=3:2==d.slf.mac_alro&&(h=
4);1==d.slf.rlc_tx&&(1==d.slf.rlc_algo?k=2:2==d.slf.rlc_algo&&(k=3));var m=a.userData.length-h-k,p=a.userData.slice(0,m),l=null;k&&a.userData.slice(m,m+k);h&&(l=a.userData.slice(m+k));h=d.rlc;k=!0;l&&(l=this.checkCmac(a.rorg,p,h,d.completeKey,l),l.rlc&&h.toString("hex")!=l.rlc.toString("hex")&&(h=l.rlc,d.rlc=l.rlc),l&&l.ok?(this._logger.log("trace","receive from "+e+" with cmac rlc:"+h.toString("hex")),delete this._unsync[e]):(k=!1,this._logger.log("warn","receive from "+e+" with cmac out of snyc, last rlc:"+
h.toString("hex")),this._unsync[e]=h.toString("hex")));e=null;k&&3==d.slf.data_enc&&(p=this.decryptVAES(h,f,d.completeKey,p),e=a.convertToPacket(p).toRadioTelegram());d.rlc=this._incRLC(h);this._logger.log("trace","senderID next rlc:"+d.rlc.toString("hex"));this._saveSec(this._secInfo);return e};a.prototype.decryptVAES=function(a,g,d,h){for(var e=h.length,f=Math.ceil(e/16),p=[],l=null,t=0;t<f;t++){var z=16*t,B=z+16;B>e&&(B=e);z=h.slice(z,B);l=this._doVAESblock(a,g,d,l,z);p.push(l.data);l=l.enc}return Buffer.concat(p)};
a.prototype._doVAESblock=function(a,g,d,h,k){a=this._xor(a,g);h&&(a=this._xor(a,h));d=this._doAES128(d,null,a);h=this._xor(d,k);h=h.slice(0,k.length);return{data:h,enc:d}};a.prototype.checkCmac=function(a,g,d,h,k){if(d){for(var e=this._bufToInt(d),f=0;128>f;f++){if(0!=f){e+=1;var l=65535;3==d.length&&(l=16777215);e>l&&(e=0)}l=this._intToBuf(e,d.length);l=this.calcCmac(a,g,l,h,k.length);if(l.toString("hex")==k.toString("hex"))return{ok:!0,rlc:this._intToBuf(e,d.length)}}return{ok:!1,rlc:this._intToBuf(e,
d.length)}}l=this.calcCmac(a,g,null,h,k.length);return l.toString("hex")==k.toString("hex")?{ok:!0}:{ok:!1}};a.prototype.calcCmac=function(a,g,d,h,k){var e=this._getCmacSubkey(h),f=new Buffer(1);f.writeUInt8(a);f=Buffer.concat([f,g]);d&&(f=Buffer.concat([f,d]));a=f.length;g=Math.ceil(a/16);d=null;for(var l=0;l<g;l++){var t=16*l;var z=t+16;z>a&&(z=a);t=f.slice(t,z);d=t=this._doCmacBlock(h,e.k1,e.k2,t,d)}return t.slice(0,k)};a.prototype._doCmacBlock=function(a,g,d,h,k){for(var e=new Buffer(16),f=0;16>
f;f++)f<h.length?e.writeUInt8(h.readUInt8(f),f):f==h.length?e.writeUInt8(128,f):e.writeUInt8(0,f);k&&(e=this._xor(e,k));e=16>h.length?this._xor(e,d):this._xor(e,g);return this._doAES128(a,null,e)};a.prototype._getCmacSubkey=function(a){var e=new Buffer("00000000000000000000000000000000","hex");var d=new Buffer("00000000000000000000000000000087","hex");e=this._doAES128(a,null,e);a=new Buffer(e.toString("hex"),"hex");this._bufShiftLeft(a,1);e.readUInt8(0)&128&&(a=this._xor(a,d));e=new Buffer(a.toString("hex"),
"hex");this._bufShiftLeft(e,1);a.readUInt8(0)&128&&(e=this._xor(e,d));return{k1:a,k2:e}};a.prototype._doAES128=function(a,g,d){g||(g=new Buffer("00000000000000000000000000000000","hex"));a=crypto.createCipheriv("aes128",a,g);a.setAutoPadding(!1);d=a.update(d);a=a.final();return Buffer.concat([d,a])};a.prototype._xor=function(a,g){for(var d=Math.max(a.length,g.length),e=new Buffer(d),k=0;k<d;k++){var f=0,p=0;k<a.length&&(f=a.readUInt8(k));k<g.length&&(p=g.readUInt8(k));e.writeUInt8(f^p,k)}return e};
a.prototype._bufShiftLeft=function(a,g){if(g!==(g|0))throw Error("shiftBits must be a 32 bit int");var d=2*((g>>4)+(0!==(g&15)));g=8*d-g;for(var e=0,f=0;f-d<a.length;f+=2)if(e<<=16,f<a.length-1?e|=a.readUInt16BE(f):f<a.length&&(e|=a[f]<<8),0<=f-d)if(f-d<a.length-1)a.writeUInt16BE(e>>>g&65535,f-d);else{if(f-d!==a.length-1)throw Error();a[f-d]=e>>>g+8}else-1===f-d&&(a[0]=e>>>g)};a.prototype._bufToInt=function(a){for(var e=0,d=0;d<a.length;d++){var h=a.readUInt8(d);e=(e<<8*d)+h}return e};a.prototype._intToBuf=
function(a,g){for(a=a.toString(16);a.length<2*g;)a="0"+a;return new Buffer(a,"hex")};a.prototype._incRLC=function(a){var e=this._bufToInt(a);e+=1;var d=65535;3==a.length&&(d=16777215);e>d&&(e=0);return this._intToBuf(e,a.length)};a.prototype._getFile=function(){var a=require("x.hub.fileman.js").fileManager,g=require("path");require("fs");a=a.getUserRootDataPath();return g.resolve(a,this.SECURITY_FILE)};a.prototype._loadSec=function(a){var e=this._getFile();fs_extra.ensureFile(e,function(d){d?a&&a(d):
fs_extra.readFile(e,"utf8",function(d,e){if(d)a&&a(d);else{try{var g=JSON.parse(e);for(var h in g)if(g.hasOwnProperty(h)){var f=g[h];f.rlc&&(f.rlc=new Buffer(f.rlc,"hex"));f.completeKey&&(f.completeKey=new Buffer(f.completeKey,"hex"))}}catch(t){}a&&a(null,g)}})})};a.prototype._saveSec=function(a,g){var d=this._getFile(),e={},f;for(f in a)e[f]={},e[f].teachInInfo=a[f].teachInInfo,e[f].slf=a[f].slf,e[f].rlc=a[f].rlc.toString("hex"),e[f].completeKey=a[f].completeKey.toString("hex");fs_extra.writeFile(d,
JSON.stringify(e,null,2),function(a){g&&g(a)})};return a}();
x.hub.m.enocean.LearnHandler=function(){var f=function(a){this._controller=a;this._learning=!1;this._saParams=this._learnVendor=this._learnSenderID=this._learnAddress=this._learnProfile=this._learnCallback=null;this._secTeachInFrames={};this._teaching=!1;this._teachingTO=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;var e=this;this._teachinTelegramCB={_onEOTelegram:function(a){e.onTeachInResponseTelegram(a)}}};f.prototype.learn=function(a,e,g,d,h,
f){if(this._learning)f&&f(Error("learning process running"));else if(this._teaching)f&&f(Error("teach-in process running"));else{if(!h||0>=h)h=3E4;this._learning=!0;this._learnCallback=f;this._learnProfile=a?a.toLowerCase():null;this._learnAddress=e?e.toLowerCase():null;this._learnVendor=d?d:"general";this._learnSenderID=g?g.toLowerCase():null;this._secTeachInFrames={};this._saParams=null;a&&"bb-aa-cc"==a.toLowerCase()&&(this._saParams={extended:0});var k=this;this._controller._esp3.startLearn(this,
h,this._saParams,function(a){if(a){var d=k._learnCallback;k._learning=!1;k._learnProfile=null;k._learnCallback=null;k._secTeachInFrames={};d&&d(a)}})}};f.prototype.onLearnTimeout=function(){this._learnFinish(Error("learn timeout"))};f.prototype.onTelegram=function(a){if(a){if(this._learnProfile){var e=x.hub.m.enocean.profiles[this._learnProfile];if(e&&(e=new e,e.handleLearnTelegram)){e.handleLearnTelegram(this,a);return}}switch(a.rorg){case 212:0==a.cmd&&this._learnUTE(a);break;case 213:0==a.getLearnBit()&&
this._learn1BS(a);break;case 165:0==a.getLearnBit()&&this._learn4BS(a);break;case 246:this._learnRPS(a);break;case 53:var g=this._controller._secHandler.resolve(a);a=a.senderID;e=this._secTeachInFrames[a];g&&(g.teachInInfo&&0==g.teachInInfo.idx?(e||(this._secTeachInFrames[a]=[],e=this._secTeachInFrames[a]),e.push(g)):g.teachInInfo&&0!=g.teachInInfo.idx&&e&&e.push(g));if(e&&e[0]&&(g=e[0])&&g.teachInInfo){var d=g.teachInInfo.cnt;if(d&&e.length==d){if(1<d){d=[];for(var h=0;h<e.length;h++)d.push(e[h].key);
g.completeKey=Buffer.concat(d)}else g.completeKey=g.key;this._controller._secHandler.secureTeachIn(a,g)}}}}};f.prototype.onEvent=function(a){if(a&&a instanceof x.hub.m.enocean.ESP3.Event.SA_CONFIRM_LEARN){var e=a.getEEP();if(!this._learnProfile||this._learnProfile==e){var g=this,d=x.hub.m.enocean.profiles[e];if(!d){var h=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,17);this._controller._esp3.sendResponse(h,function(a){g._learnFinish(Error("eep not supported"))})}if(!this._learnProfile||
this._isLearningProfileEquals(e)){e=this._learnProfile?this._learnProfile:e;d=new d;var f=a.getPMCandidateId();f||(f=d.UNIQUE_GATEWAY_SENDERID?this._controller._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID);a={address:a.getSAClientId(),data:e,vendor:this._learnVendor,senderID:f};this._controller._deviceHandler.onLearnAddDeleteDevice(a,function(a,d,e){a?(h=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,19),g._controller._esp3.sendResponse(h,function(a){g._learnFinish(a)})):
(a=0,1==d&&(a=32),h=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(128,a),g._controller._esp3.sendResponse(h,function(a){g._learnFinish(a,d,e)}))})}}}};f.prototype.onTeachInResponseTelegram=function(a){if(a&&this._teaching){var e=this;switch(a.rorg){case 165:if(0==a.getLearnBit()){var g=a.getFunc(),d=a.getType();this._toProfileStr(165,g,d);if(1==a.getLearnResult())this._controller._deviceHandler.onLearnDevice({address:this._teachID,senderID:this._teachSenderID,data:this._teachProfile,
vendor:this._teachVendor},{address:a.senderID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},function(a,d){e._teachFinish(a,d)});else 0==a.getLearnResult()&&(a=this._controller._deviceHandler.getDevice(this._teachID),e._teachFinish(null,a,1))}}}};f.prototype._learnRPS=function(a){var e=this._getRealProfile(this._learnProfile),g=this;e&&"f6"!=e.substr(0,2)||((e=this._learnProfile)||(e="f6-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,
senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:e,vendor:this._learnVendor},function(a,e){g._learnFinish(a,0,e)}))};f.prototype._learn1BS=function(a){var e=this,g=this._getRealProfile(this._learnProfile);g&&"d5"!=g.substr(0,2)||((g=this._learnProfile)||(g="d5-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},
{address:a.senderID,senderID:this._learnSenderID,data:g,vendor:this._learnVendor},function(a,g){e._learnFinish(a,0,g)}))};f.prototype._learn4BS=function(a){if(0==a.getLearnType())this._learn4BSV1(a);else{var e=a.getFunc(),g=a.getType();e=this._toProfileStr(165,e,g);(e=x.hub.m.enocean.profiles[e])&&(3==(new e).TEACH_IN_VARIATION?this._learn4BSV3(a):this._learn4BSV2(a))}};f.prototype._learn4BSV1=function(a){var e=this._getRealProfile(this._learnProfile);if(e){if("a5"!=e.substr(0,2))return;e=x.hub.m.enocean.profiles[this._learnProfile];
if(!e||1!=(new e).TEACH_IN_VARIATION)return}var g=this;(e=this._learnProfile)||(e="a5-??-??");this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:e,vendor:this._learnVendor},function(a,e){g._learnFinish(a,0,e)})};f.prototype._learn4BSV2=function(a){var e=a.getFunc(),g=a.getType();e=this._toProfileStr(165,e,g);if(!this._learnProfile||this._isLearningProfileEquals(e))if(e=
this._learnProfile?this._learnProfile:e,g=x.hub.m.enocean.profiles[e])if(3==(new g).TEACH_IN_VARIATION)this._learn4BSV3(a);else{var d=this;this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:e,vendor:this._learnVendor},function(a,e){d._learnFinish(a,0,e)})}};f.prototype._learn4BSV3=function(a){var e=a.getFunc(),g=a.getType();e=this._toProfileStr(165,
e,g);if(!this._learnProfile||this._isLearningProfileEquals(e)){e=this._learnProfile?this._learnProfile:e;g=x.hub.m.enocean.profiles[e];var d=this;if(g){g=new g;var f=d._learnSenderID;!f&&g.UNIQUE_GATEWAY_SENDERID&&(f=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId());this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:f,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:f,data:e,vendor:this._learnVendor},function(e,g){e?d._send4BSResponse(null,
1,0,a,function(){d._learnFinish(e,0,g)}):d._send4BSResponse(f,1,1,a,function(){d._learnFinish(null,0,g)})})}else this._send4BSResponse(null,0,0,a,function(){d._learnFinish(Error("eep not supported"))})}};f.prototype._send4BSResponse=function(a,e,g,d,f){a||(a=x.hub.m.enocean.SENDER_ID);var h=d.getFunc(),m=d.getType();d.getManufacturerId();a=new x.hub.m.enocean.ESP3.Telegram.BS4(new Buffer([(h&63)<<2|m>>5&3,(m&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128|e<<6|g<<
5|16]),a,0);a.setDstId(d.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){f&&f(a)})};f.prototype._learnUTE=function(a){var e=this._toProfileStr(a.eepRorg,a.eepFunc,a.eepType),g,d=this;if(!this._learnProfile||this._isLearningProfileEquals(e)){e=this._learnProfile?this._learnProfile:e;var f=x.hub.m.enocean.profiles[e];if(f)switch(f=new f,(g=this._learnSenderID)||(g=f.UNIQUE_GATEWAY_SENDERID?require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID),e=
{address:a.senderID,data:e,vendor:this._learnVendor,senderID:g},a.subtype){case 0:this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},e,function(e,f){if(0==a.rspExpected){var h=0;e&&404==e.errorCode?h=3:e||(h=1);d._sendUTEResponse(g,h,a,function(){d._learnFinish(e,0,f)})}else d._learnFinish(e,0,f)});break;case 1:this._controller._deviceHandler.deleteDevice(e,function(e,f){if(0==a.rspExpected){var h=
0;e&&404==e.errorCode?h=3:e||(h=2);d._sendUTEResponse(g,h,a,function(){d._learnFinish(e,1,f)})}else d._learnFinish(e,1,f)});break;case 2:this._controller._deviceHandler.onLearnAddDeleteDevice(e,function(e,f,h){if(0==a.rspExpected){var k=0;e&&404==e.errorCode?k=3:e||(0==f?k=1:1==f&&(k=2));d._sendUTEResponse(g,k,a,function(){d._learnFinish(e,f,h)})}else d._learnFinish(e,f,h)})}}};f.prototype._sendUTEResponse=function(a,e,g,d){a||(a=x.hub.m.enocean.SENDER_ID);a=new x.hub.m.enocean.ESP3.Telegram.UTE(1,
g.ute,0,e,g.numChannel,g.manufactureID,g.eepType,g.eepFunc,g.eepRorg,a,0);a.setDstId(g.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){d&&d(a)})};f.prototype._learnFinish=function(a,e,g){var d=this._learnCallback;this._learning=!1;this._learnVendor=this._learnSenderID=this._learnAddress=this._learnProfile=this._learnCallback=null;this._secTeachInFrames={};var f=this._saParams;this._saParams=null;this._controller._esp3.stopLearn(this,f,function(){});d&&d(a,e,g);!a&&0==e&&g&&g.init&&
setTimeout(function(){g.init()},1E3)};f.prototype._toProfileStr=function(a,e,g){for(a=a.toString(16);2>a.length;)a="0"+a;for(e=e.toString(16);2>e.length;)e="0"+e;for(g=g.toString(16);2>g.length;)g="0"+g;return(a+"-"+e+"-"+g).toLowerCase()};f.prototype._fromProfileStr=function(a){a=a.split("-");return{rorg:parseInt(a[0],16),func:parseInt(a[1],16),type:parseInt(a[2],16)}};f.prototype._getRealProfile=function(a){if(!a)return null;var e=x.hub.m.enocean.profiles[a];if(!e)return a;e=new e;return e._eepAlias?
e._eepAlias:a};f.prototype._isLearningProfileEquals=function(a){if(!this._learnProfile)return!1;if(this._learnProfile==a)return!0;var e=x.hub.m.enocean.profiles[this._learnProfile];return e?(new e)._eepAlias==a:!1};f.prototype.teachin=function(a,e,g,d,f){if(this._teaching)f&&f(Error("teach-in process running"));else if(this._learning)f&&f(Error("learning process running"));else if(a){a=a.toLowerCase();e||(e=this._controller._deviceHandler.getNextFreeAddress());var h=this;this._teachCallback=f;this._teachProfile=
a;this._teachID=e;this._teachSenderID=g;this._teachVendor=d?d:"general";this._teaching=!0;this._teachingTO=setTimeout(function(){h._teachFinish(Error("teach-in timeout"))},3E4);var m;d=a;if(f=x.hub.m.enocean.profiles[d])f=new f,f.getTeachinType&&(m=f.getTeachinType()),f.isTeachinBidirectional&&f.isTeachinBidirectional();!m&&(d=this._getRealProfile(d),f=x.hub.m.enocean.profiles[d])&&(f=new f,f.getTeachinType&&(m=f.getTeachinType()),f.isTeachinBidirectional&&f.isTeachinBidirectional());if(!m)switch(d.substr(0,
2)){case "f6":m="RPS";break;case "d5":m="1BS";break;case "a5":m="4BS"}switch(m){case "RPS":this._teachinRPS(a,e,g);break;case "1BS":this._teachin1BS(a,e,g);break;case "4BS":this._teachin4BS(a,e,g);break;default:this._teachFinish(Error("profile not supported"))}}else f&&f(Error("profile is null"))};f.prototype._teachinRPS=function(a,e,g){this._teachFinish(Error("RPS teach-in should be done by execute command directly"))};f.prototype._teachin1BS=function(a,e,g){};f.prototype._teachin4BS=function(a,
e,g){var d=2,f=x.hub.m.enocean.profiles[a];if(f)d=(new f).TEACH_IN_VARIATION;else if(this._getRealProfile(a),f=x.hub.m.enocean.profiles[a])d=(new f).TEACH_IN_VARIATION;switch(d){case 1:this._teachin4BSV1(a,e,g);break;case 2:this._teachin4BSV2(a,e,g);break;case 3:this._teachin4BSV3(a,e,g);break;default:this._teachFinish(Error("no supported"))}};f.prototype._teachin4BSV1=function(a,e,g){};f.prototype._teachin4BSV2=function(a,e,g){var d=g;if(!g&&(d=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId(),
!d)){this._teachFinish(Error("no more sender ID available"));return}g=a;var f=x.hub.m.enocean.profiles[g];f||(g=this._getRealProfile(g),f=x.hub.m.enocean.profiles[a]);f&&(f=new f,f._eepAlias&&(a=f._eepAlias));f&&f.getTeachinTelegram?a=f.getTeachinTelegram(e,d,x.hub.m.enocean.MANUFACTURE_ID):(a=this._fromProfileStr(a),a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),a=new x.hub.m.enocean.ESP3.Telegram.BS4(a,d,0));var k=
this;this._controller._esp3.sendTelegram(a,!0,function(a){a?k._teachFinish(a):(e||(e=d),k._controller._deviceHandler.addDevice({address:e,data:k._teachProfile,senderID:d,vendor:k._teachVendor},function(a,d){k._teachFinish(a,d)}))})};f.prototype._teachin4BSV3=function(a,e,g){var d=g;if(!g){d=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!d){this._teachFinish(Error("no more sender ID available"));return}this._teachSenderID=d}g=a;var f=x.hub.m.enocean.profiles[g];f||(g=this._getRealProfile(g),
f=x.hub.m.enocean.profiles[a]);f&&(f=new f,f._eepAlias&&(a=f._eepAlias));f&&f.getTeachinTelegram?d=f.getTeachinTelegram(e,d,x.hub.m.enocean.MANUFACTURE_ID):(a=this._fromProfileStr(a),a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),d=new x.hub.m.enocean.ESP3.Telegram.BS4(a,d,0));var k=this;this._controller._esp3.addListener(this._teachinTelegramCB);this._controller._esp3.sendTelegram(d,!0,function(a){a&&k._teachFinish(a)})};
f.prototype.teachinUTE=function(a,e,g){x.hub.m.enocean.ESP3.Telegram.UTE()};f.prototype._teachFinish=function(a,e,g){this._controller._esp3.removeListener(this._teachinTelegramCB);var d=this._teachCallback;this._teachingTO&&clearTimeout(this._teachingTO);this._teachingTO=null;this._teaching=!1;this._saParams=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;d&&d(a,e,g)};return f}();
x.hub.m.enocean.DeviceHandler=function(){var f=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.DeviceHandler");this._controller=a;this._devices={}};util.inherits(f,EventEmitter);f.prototype.SENSOR_FILE="enocean.json";f.prototype.UNKNOWN_PROFILE_ERR=404;f.prototype.ALREADY_EXISTS_ERR=400;f.prototype.init=function(a){this._logger.log("trace","init");var e=this;this._loadDevices(function(g,d){g&&e._logger.log("warn","init error:"+g.message);d&&(e._devices=d);e._initDevices();
a&&a()})};f.prototype._initDevices=function(){var a=Object.keys(this._devices),e=0,g=this,d=function(){e++;e<a.length&&(g._devices[a[e]]&&g._devices[a[e]].init?g._devices[a[e]].init(d):d())};this._devices[a[e]]&&this._devices[a[e]].init?this._devices[a[e]].init(d):d()};f.prototype.getDevice=function(a){return a?this._devices[a]:null};f.prototype.getAllDevices=function(){return this._devices};f.prototype.findDevice=function(a){return a&&a.address?this._devices[a.address]:null};f.prototype.findDeviceWithData=
function(a){if(!a)return null;var e=[],g;for(g in this._devices){var d=this._devices[g];d&&d.getData()==a&&e.push(d)}return e};f.prototype.addDevice=function(a,e){if(a&&a.data){a.address||(a.address=this.getNextFreeAddress());a.address=a.address.toLowerCase();a.senderID&&(a.senderID=a.senderID.toLowerCase());var g=x.hub.m.enocean.profiles.parseJson(a);if(g){a=g._address;var d=this._devices[a];d&&d._data==g._data&&(g._states=d._states);this._devices[a]=g;this._saveDevices(this._devices,function(a){e&&
e(a,g)})}else a=Error("unknow profile"),a.errorCode=this.UNKNOWN_PROFILE_ERR,e&&e(a)}else a=Error("device json invalid"),e&&e(a)};f.prototype.updateDevice=function(a,e,g){if(a)if(e&&e.data){var d=this._devices[a];e.address||(e.address=a);e.address=e.address.toLowerCase();e.senderID&&(e.senderID=e.senderID.toLowerCase());var f=x.hub.m.enocean.profiles.parseJson(e);f?(d&&d._data==f._data&&(f._params=d._params,f._states=d._states),this._devices[e.address]=f,e.address!=a&&delete this._devices[a],this._saveDevices(this._devices,
function(a){g&&g(a,f)})):(a=Error("unknow profile"),a.errorCode=this.UNKNOWN_PROFILE_ERR,g&&g(a))}else a=Error("device json invalid"),g&&g(a);else a=Error("address invalid"),g&&g(a)};f.prototype.deleteDevice=function(a,e){if(a&&a.address&&this._devices[a.address]){var g=this._devices[a.address];g&&g.finalize&&g.finalize();var d=this._devices[a.address];delete this._devices[a.address];this.emit("deleteDevice",d);this._saveDevices(this._devices,function(a){e&&e(a,g)})}else e&&e()};f.prototype.onLearnAddDeleteDevice=
function(a,e){if(a&&a.address)if(this._devices[a.address])this.deleteDevice(a,function(a,d){e&&e(a,1,d)});else this.onLearnDevice(null,a,function(a,d){e&&e(a,0,d)});else e&&e()};f.prototype.onLearnDevice=function(a,e,g){if(e&&e.address&&e.data){var d=x.hub.m.enocean.profiles.parseJson(e);if(d){var f=e.address;if(this._devices[f]){var k=this._devices[f];f=k.toJSON();f.data!=e.data||f.vendor!=e.vendor?(e=Error("address "+e.address+" already exists, please delete it first"),e.errorCode=this.ALREADY_EXISTS_ERR,
g&&g(e)):f.senderID!=e.senderID?(k._senderID=e.senderID,"bb-aa-cc"==k._data&&(k.executeCommand(null,{value:"alertOn"}),k.executeCommand(null,{value:"preAlarmOn"})),this._saveDevices(this._devices,function(a){g&&g(a,k)})):g&&g(null,k)}else a&&(e=a.address)&&e!=f&&this._devices[e]&&delete this._devices[e],this._devices[f]=d,"bb-aa-cc"==d._data&&(d.executeCommand(null,{value:"alertOn"}),d.executeCommand(null,{value:"preAlarmOn"})),this._saveDevices(this._devices,function(a){g&&g(a,d)})}else e=Error("unknow profile"),
e.errorCode=this.UNKNOWN_PROFILE_ERR,g&&g(e)}else e=Error("device json invalid"),g&&g(e)};f.prototype.deviceParamsUpdated=function(a,e){this._saveDevices(this._devices,function(a){e&&e(a)})};f.prototype.isVirtual=function(a){var e=x.hub.m.enocean.SENDER_ID;if(!e)return!1;var f=parseInt(e,16)+1;e=parseInt(e,16)+128;a=parseInt(a,16);return a>=f&&a<=e};f.prototype.getVirtualSenderID=function(){var a=x.hub.m.enocean.SENDER_ID;if(!a)return[];var e=parseInt(a,16)+1;a=parseInt(a,16)+128;var f=[],d=this._devices,
h;for(h in d){var k=d[h];k&&k._senderID&&(k=parseInt(k._senderID,16),k>=e&&k<=a&&f.push(k))}return f};f.prototype.getVirtualAddress=function(){var a=[],e=this._devices,f;for(f in e)"x"==f.charAt(0)&&(e=parseInt(f.substr(1),16),0<=e&&268435455>=e&&a.push(f));return a};f.prototype.getFreeSenderIdCount=function(){return 128-this.getVirtualSenderID().length};f.prototype.getNextFreeSenderId=function(){var a=x.hub.m.enocean.SENDER_ID;if(!a)return null;var e=parseInt(a,16)+1;a=parseInt(a,16)+128;for(var f=
this.getVirtualSenderID(),d=null;e<=a;e++)if(-1==f.indexOf(e)){d=e;break}if(d)for(d=d.toString(16).toLowerCase();8>d.length;)d="0"+d;return d};f.prototype.getNextFreeAddress=function(){for(var a=this.getVirtualAddress(),e=null,f=0;268435455>=f;f++){for(var d=f.toString(16);7>d.length;)d="0"+d;d="x"+d;if(-1==a.indexOf(d)){e=d;break}}return e};f.prototype.generateVirtual=function(a,e){if(a&&a.data){var f=a.senderID;if(!f&&(f=this.getNextFreeSenderId(),!f)){e&&e(Error("no sender id available"));return}a.senderID=
f;a.address=f;a.virtual=!0;if(f=this.findDevice(a)){var d=f.toJSON();a.data!=d.data?e&&e(Error("device of another type with the same address exists")):a.vendor&&a.vendor!=d.vendor?e&&e(Error("device of another vendor with the same address exists")):e&&e(null,f)}else(a=x.hub.m.enocean.profiles.parseJson(a))?this.addDevice(a.toJSON(),function(a,d){e&&e(a,d)}):e&&e(Error("unknow profile"))}else e&&e(Error("query is null"))};f.prototype._getFile=function(){var a=fileman.fileManager,e=require("path");
a=a.getUserRootDataPath();return e.resolve(a,this.SENSOR_FILE)};f.prototype._loadDevices=function(a){var e=require("fs-extra"),f=this._getFile();e.ensureFile(f,function(d){d?a&&a(d):e.readFile(f,"utf8",function(d,e){if(d)a&&a(d);else try{d={};var f=JSON.parse(e),g;for(g in f){var h=x.hub.m.enocean.profiles.parseDBJson(f[g]);h&&(d[g]=h)}a&&a(null,d)}catch(t){a&&a(t)}})})};f.prototype._saveDevices=function(a,e){var f=this._getFile(),d={},h;for(h in a)d[h]=a[h].toDBJSON();fs_extra.writeFile(f,JSON.stringify(d,
null,2),function(a){e&&e(a)})};return f}();
x.hub.m.enocean.ESP3=function(){var f=function(a,d,e){this.type=a;this.data=d;this.optData=e};f.TYPE={1:"RADIO_ERP1",2:"RESPONSE",3:"RADIO_SUB_TEL",4:"EVENT",5:"COMMAND_COMMAND",6:"SMART_ACK_COMMAND",7:"REMOTE_MAN_COMMAND",9:"RADIO_MESSAGE",10:"RADIO_ERP2",16:"RADIO_802_15_4",17:"COMMAND_2_4"};f.prototype.toBuffer=function(){var a=new Buffer(6);a.writeUInt8(85,0);a.writeUInt16BE(this.data.length,1);a.writeUInt8(this.optData?this.optData.length:0,3);a.writeUInt8(this.type,4);a.writeUInt8(0,5);var d=
x.hub.m.enocean.CRC8(a.slice(1,5));a.writeUInt8(d,5);var e=this.optData?Buffer.concat([this.data,this.optData],this.data.length+this.optData.length):this.data;d=x.hub.m.enocean.CRC8(e);a=Buffer.concat([a,e],6+e.length+1);a.writeUInt8(d,a.length-1);return a};f.prototype.toJSON=function(){return{dataLen:this.data.length,optLen:this.optData?this.optData.length:0,type:this.type,typeName:f.TYPE[this.type],data:this.data.toString("hex"),optData:this.optData?this.optData.toString("hex"):null}};f.prototype.toPacket=
function(){return a.resolve(this)};var a=function(){};a.resolve=function(a){switch(a.type){case 1:return g.resolve(a);case 2:return e.resolve(a);case 4:return h.resolve(a);case 6:return d.resolve(a);default:return null}};var e=function(a,d,e){this.retCode=a;this.resData=d;this.optData=e};e.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};e.prototype.toJSON=function(){return{retCodeName:e.CODE[this.retCode],
retCode:this.retCode.toString(16),resData:this.resData?this.resData.toString("hex"):null,optData:this.optData?this.optData.toString("hex"):null}};e.prototype.toFrame=function(){var a=new Buffer(1);a.writeUInt8(this.retCode,0);this.resData&&(a=Buffer.concat([a,this.resData]));return new f(2,a,this.optData)};e.prototype.toResponse=function(){return F.resolve(this)};e.resolve=function(a){var d;var f=a.data.readUInt8(0);1<a.data.length&&(d=a.data.slice(1));return new e(f,d,a.optData)};var g=function(a,
d,e,f,g,h){this.data=a;if(this.hasOpt=d)this.subTelNum=e,this.dstId=f,this.dBm=g,this.securityLvl=h};g.prototype.toJSON=function(){var a={data:this.data.toString("hex")};this.hasOpt&&(a.subTelNum=this.subTelNum.toString(16),a.dstId=this.dstId,a.dBm=this.dBm.toString(16),a.securityLvl=this.securityLvl);return a};g.prototype.toFrame=function(){var a=this.data,d=null;this.hasOpt&&(d=new Buffer([this.subTelNum]),d=Buffer.concat([d,new Buffer(this.dstId,"hex")]),d=Buffer.concat([d,new Buffer([this.dBm,
this.securityLvl])]));return new f(1,a,d)};g.prototype.toRadioTelegram=function(){return k.resolve(this)};g.resolve=function(a){var d=!1;if(a.optData){d=!0;var e=a.optData.readUInt8(0);var f=a.optData.slice(1,5).toString("hex");var da=a.optData.readUInt8(5);var h=a.optData.readUInt8(6)}return new g(a.data,d,e,f,da,h)};var d=function(a){this.data=a};d.prototype.toJSON=function(){return{data:this.data.toString("hex")}};d.prototype.toFrame=function(){return new f(6,this.data,null)};d.prototype.toSACommand=
function(){return J.resolve(this)};d.resolve=function(a){return new d(a.data)};var h=function(a){this.data=a};h.prototype.toJSON=function(){return{data:this.data.toString("hex")}};h.prototype.toFrame=function(){return new f(4,this.data,null)};h.prototype.toEvent=function(){return w.resolve(this)};h.resolve=function(a){return new h(a.data)};var k=function(a,d){this.rorg=a;this.optData=d;this.optData||(this.optData={subTelNum:1,dstId:"FFFFFFFF",dBm:255,securityLvl:0})};k.prototype.setDstId=function(a){this.optData.dstId=
a?a:"FFFFFFFF"};k.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 246:return m.resolve(a);case 213:return p.resolve(a);case 165:return l.resolve(a);case 210:return t.resolve(a);case 212:return B.resolve(a);case 53:return K.resolve(a);case 49:return G.resolve(a);default:return null}};var m=function(a,d,e,f,g,h){k.call(this,246,h);this.userData=a?a:0;this.senderID=d;this.t21=e?e:0;this.nu=f?f:0;this.rc=g?g:0};m.prototype=new k;m.prototype.constructor=m;m.prototype.toJSON=
function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),senderID:this.senderID,t21:this.t21,nu:this.nu,rc:this.rc}};m.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.userData,1);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.t21<<5|this.nu<<4||this.rc])]);var d=1,e="FFFFFFFF",f=255,h=0;this.optData&&(d=this.optData.subTelNum,e=this.optData.dstId,f=this.optData.dBm,h=this.optData.securityLvl);
return new g(a,!0,d,e,f,h)};m.resolve=function(a){var d=a.data,e=d.readUInt8(1),f=d.slice(2,6).toString("hex"),g=d.readUInt8(6)>>5&1,da=d.readUInt8(6)>>4&1,h;a.hasOpt&&(h={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new m(e,f,g,da,d&15,h)};var p=function(a,d,e,f){k.call(this,213,f);this.userData=a;this.senderID=d;this.rc=e?e:0};p.prototype=new k;p.prototype.constructor=p;p.prototype.getLearnBit=function(){return this.userData>>3&1};p.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),
userData:this.userData.toString(16),learn:this.getLearnBit(),senderID:this.senderID,rc:this.rc}};p.resolve=function(a){var d=a.data,e=d.readUInt8(1),f=d.slice(2,6).toString("hex");d=d.readUInt8(6)&15;var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new p(e,f,d,g)};var l=function(a,d,e,f){k.call(this,165,f);this.userData=a;this.senderID=d;this.rc=e?e:0};l.prototype=new k;l.prototype.constructor=l;l.prototype.getLearnType=function(){return this.userData.readUInt8(3)>>
7&1};l.prototype.getLearnBit=function(){return this.userData.readUInt8(3)>>3&1};l.prototype.getLearnStatus=function(){return this.userData.readUInt8(3)>>4&1};l.prototype.getLearnResult=function(){return this.userData.readUInt8(3)>>5&1};l.prototype.getEEPResult=function(){return this.userData.readUInt8(3)>>6&1};l.prototype.getFunc=function(){return this.userData.readUInt8(0)>>2&63};l.prototype.getType=function(){var a=this.userData.readUInt8(0)&3,d=this.userData.readUInt8(1)>>3&31;return a<<5|d};l.prototype.getManufacturerId=
function(){var a=this.userData.readUInt8(1)&7,d=this.userData.readUInt8(2);return a<<8|d};l.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),learnType:this.getLearnType(),learn:this.getLearnBit(),learnStatus:this.getLearnStatus(),learnResult:this.getLearnResult(),eepResult:this.getEEPResult(),func:this.getFunc(),type:this.getType(),manufacturerId:this.getManufacturerId(),senderID:this.senderID,rc:this.rc}};l.prototype.toPacket=function(){var a=
new Buffer(1);a.writeUInt8(this.rorg,0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.rc&15])]);return this.optData?new g(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(a,!1)};l.resolve=function(a){var d=a.data,e=d.slice(1,5),f=d.slice(5,9).toString("hex");d=d.readUInt8(9)&15;var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new l(e,
f,d,g)};var t=function(a,d,e,f){k.call(this,210,f);this.userData=a;this.senderID=d;this.status=e};t.prototype=new k;t.prototype.constructor=t;t.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};t.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);
return this.optData?new g(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(a,!1)};t.resolve=function(a){var d=a.data,e=d.slice(1,d.length-5),f=d.slice(d.length-5,d.length-1).toString("hex");d=d.readUInt8(d.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new t(e,f,d,g)};var z=function(a,d,e,f,g){k.call(this,166);this.rorg_en=a;this.data=d;this.dstID=e;this.senderID=f;this.status=g};z.prototype=
new k;z.prototype.constructor=z;z.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.rorg_en,1);a=Buffer.concat([a,this.data]);a=Buffer.concat([a,new Buffer(this.dstID,"hex")]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return new g(a,!1)};var B=function(a,d,e,f,g,h,m,l,n,p,q){k.call(this,212);this.cmd=a;this.ute=d;this.rspExpected=e;this.subtype=f;this.numChannel=g;this.manufactureID=h;this.eepType=
m;this.eepFunc=l;this.eepRorg=n;this.senderID=p;this.status=q};B.prototype=new k;B.prototype.constructor=B;B.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),ute:this.ute,rspExpected:this.rspExpected,subtype:this.subtype,cmd:this.cmd,numChannel:this.numChannel,manufactureID:this.manufactureID,eepType:this.eepType.toString(16),eepFunc:this.eepFunc.toString(16),eepRorg:this.eepRorg.toString(16),senderID:this.senderID,status:this.status}};B.prototype.toPacket=function(){var a=new Buffer(8);
a.writeUInt8(this.rorg,0);a.writeUInt8(this.ute<<7|this.rspExpected<<6|this.subtype<<4|this.cmd,1);a.writeUInt8(this.numChannel,2);a.writeUInt16BE(parseInt(this.manufactureID,16),3);a.writeUInt8(this.eepType,5);a.writeUInt8(this.eepFunc,6);a.writeUInt8(this.eepRorg,7);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return this.optData?new g(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(a,!1)};B.resolve=
function(a){var d=a.data.slice(1,8),e=a.data.slice(8,12).toString("hex"),f=a.data.readUInt8(12),g=d.readUInt8(0)>>7&1,h=d.readUInt8(0)&15,k=d.readUInt8(1),da=d.slice(2,4).toString("hex"),m=d.readUInt8(4),l=d.readUInt8(5),n=d.readUInt8(6),p=d.readUInt8(0)>>6&1;d=d.readUInt8(0)>>4&3;e=new B(h,g,p,d,k,da,m,l,n,e,f);a.hasOpt&&(e.optData={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return e};var K=function(a,d,e,f){k.call(this,53,f);this.userData=a;this.senderID=d;this.status=
e};K.prototype=new k;K.prototype.constructor=K;K.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};K.resolve=function(a){var d=a.data,e=d.slice(1,d.length-5),f=d.slice(d.length-5,d.length-1).toString("hex");d=d.readUInt8(d.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new K(e,f,d,g)};var G=function(a,d,e,f){k.call(this,
49,f);this.userData=a;this.senderID=d;this.status=e};G.prototype=new k;G.prototype.constructor=G;G.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};G.prototype.convertToPacket=function(a){a=Buffer.concat([a,new Buffer(this.senderID,"hex"),new Buffer([this.status])]);return this.optData?new g(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):
new g(a,!1)};G.resolve=function(a){var d=a.data,e=d.slice(1,d.length-5),f=d.slice(d.length-5,d.length-1).toString("hex");d=d.readUInt8(d.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new G(e,f,d,g)};k.RPS=m;k.BS1=p;k.BS4=l;k.VLD=t;k.ADT=z;k.UTE=B;k.TS=K;k.SM=G;var F=function(a,d){this._code=a;this._rspData=d};F.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",
7:"RET_NO_FREE_BUFFER"};F.prototype.toJSON=function(){return{code:this._code,rspData:this._rspData?this._rspData.toString("hex"):null}};F.prototype.toPacket=function(){return new e(this._code,this._rspData)};F.resolve=function(a){return new F(a.retCode,a.resData)};z=function(a,d){F.call(this,0);this._responseTime=a;this._confirmCode=d};z.prototype.toPacket=function(){var a=new Buffer(3);a.writeUInt16BE(this._responseTime,0);a.writeUInt8(this._confirmCode,2);return new e(this._code,a)};z.prototype.toJSON=
function(){return{code:this._code,responseTime:this._responseTime,confirmCode:this._confirmCode}};F.Response_OK_SA_CONFIRM_LEARN=z;var w=function(a){this._code=a};w.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 1:return L.resolve(a);case 2:return H.resolve(a);default:return null}};var L=function(){this._code=1};L.prototype=new w;L.prototype.constructor=L;L.prototype.toJSON=function(){return{code:this._code}};L.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,
0);return new h(a)};L.resolve=function(a){return new L};var H=function(a,d,e,f,g,h,k){this._code=2;this._priority=a;this._manufacturerId=d;this._eep=e;this._rssi=f;this._pm_candidateId=g;this._sa_clientId=h;this._hop_count=k};H.prototype=new w;H.prototype.constructor=H;H.prototype.getEEP=function(){return this._eep?this._eep.substr(0,2)+"-"+this._eep.substr(2,2)+"-"+this._eep.substr(4,2):null};H.prototype.getPMCandidateId=function(){return this._pm_candidateId};H.prototype.getSAClientId=function(){return this._sa_clientId};
H.prototype.toJSON=function(){return{code:this._code,priority:this._priority,manufacturerId:this._manufacturerId,eep:this.getEEP(),rssi:this._rssi,pm_candidateId:this._pm_candidateId,sa_clientId:this._sa_clientId,hop_count:this._hop_count}};H.prototype.toPacket=function(){var a=new Buffer(4);a.writeUInt8(this._code,0);a.writeUInt8(this._priority,1);a.writeUInt16BE(this._manufacturerId&1023,2);a=Buffer.concat([a,new Buffer(this._eep,"hex")]);a=Buffer.concat([a,new Buffer([this._rssi])]);a=Buffer.concat([a,
new Buffer(this._pm_candidateId,"hex")]);a=Buffer.concat([a,new Buffer(this._sa_clientId,"hex")]);a=Buffer.concat([a,new Buffer([this._hop_count])]);return new h(a)};H.resolve=function(a){var d=a.data;a=d.readUInt8(1);var e=d.readUInt16BE(2)&1023,f=d.slice(4,7).toString("hex"),g=d.readUInt8(7),h=d.slice(8,12).toString("hex"),k=d.slice(12,16).toString("hex");d=d.readUInt8(16);return new H(a,e,f,g,h,k,d)};w.SA_RECLAIM_NOT_SUCCESSFUL=L;w.SA_CONFIRM_LEARN=H;var J=function(a){this._code=a};J.resolve=function(a){if(!a.data)return null;
switch(a.data.readUInt8(0)){case 1:return M.resolve(a);case 6:return n.resolve(a);case 8:return T.resolve(a);default:return null}};var M=function(a,d,e){this._code=1;this._enable=a;this._extended=d;this._timeout=e};M.prototype=new J;M.prototype.constructor=M;M.prototype.toJSON=function(){return{code:this._code,enable:this._enable,extended:this._extended,timeout:this._timeout}};M.prototype.toPacket=function(){var a=new Buffer(7);a.writeUInt8(this._code,0);a.writeUInt8(this._enable,1);a.writeUInt8(this._extended,
2);a.writeUInt32BE(this._timeout,3);return new d(a)};M.resolve=function(a){var d=a.data;a=d.readUInt8(1);var e=d.readUInt8(2);d=d.readUInt32BE(3);return new M(a,e,d)};var q=function(a){this._code=5;this._saClientId=a};q.prototype=new J;q.prototype.constructor=q;q.prototype.toJSON=function(){return{code:this._code,clientId:this._saClientId}};q.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);a=Buffer.concat([a,new Buffer(this._saClientId,"hex")]);return new d(a)};q.resolve=
function(a){a=a.data.slice(1,5).toString("hex");return new q(a)};var n=function(){this._code=6};n.prototype=new J;n.prototype.constructor=n;n.prototype.toJSON=function(){return{code:this._code}};n.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);return new d(a)};n.resolve=function(a){return new n};var T=function(a){this._code=8;this._mailBoxCount=a};T.prototype=new J;T.prototype.constructor=T;T.prototype.toJSON=function(){return{code:this._code,mailBoxCount:this._mailBoxCount}};
T.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this._code,0);a.writeUInt8(this._mailBoxCount,1);return new d(a)};T.resolve=function(a){a=a.data.readUInt8(1);return new T(a)};J.SA_WR_LEARNMODE=M;J.SA_WR_RESET=q;J.SA_RD_LEARNEDCLIENTS=n;J.SA_WR_POSTMASTER=T;var u=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP3");this._controller=a;this._listeners=[];a&&this._listeners.push(a);this._recomm=new x.hub.m.enocean.ReComm(this);this._baseID=this._serial=null;
this._rdata=new Buffer([]);this._frameBuffer=[];this._learnHandler=null;this._learning=!1;this._learnTO=null};u.RESPONSE_TO=1500;u.prototype.attachSerial=function(a){var d=this;this._serial=new x.hub.m.enocean.Serial(a);this._serial.setListener(this);this._serial.open(function(a){a?(d._serial.setListener(null),d._serial=null):d.readBaseID(function(a,e){a||(x.hub.m.enocean.SENDER_ID||(x.hub.m.enocean.SENDER_ID=e,localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID",e)),d._baseID=e)})})};u.prototype.removeSerial=
function(a){this._serial.setListener(null);this._serial.close();this._serial=null};u.prototype.addListener=function(a){a&&-1==this._listeners.indexOf(a)&&this._listeners.push(a)};u.prototype.removeListener=function(a){a&&(a=this._listeners.indexOf(a),-1!=a&&this._listeners.splice(a,1))};u.prototype.readBaseID=function(a){var d=this,e=new f(5,new Buffer("08","hex"));this.sendFrame(e,!0,function(e,f){e?(d._logger.log("warn","read base id error:"+e.stack),a&&a(e)):f&&f.retCode?(e=Error("read BaseID error"),
e.code=f.retCode,d._logger.log("warn","read base id error return code:"+f.retCode),a&&a(e)):(e=f.resData.toString("hex"),a&&a(null,e.toLowerCase()))},8E3)};u.prototype.startLearn=function(a,d,e,f){if(this._serial){if(!d||0>=d)d=3E4;if(this._learning)f&&f(Error("learning another type right now"));else{this._learnHandler=a;this._learning=!0;var g=this;this._learnTO=setTimeout(function(){g._learning=!1;g._learnTO=null;var a=g._learnHandler;g._learnHandler=null;if(a&&a.onLearnTimeout)a.onLearnTimeout()},
d);e?(a=new M(1,e.extended?e.extended:0,0),this.sendSACommand(a,!0,function(a){f&&f(a)})):f&&f()}}else f&&f(Error("port not opened"))};u.prototype.stopLearn=function(a,d,e){this._learnTO&&clearTimeout(this._learnTO);this._learning=!1;this._learnTO=this._learnHandler=null;if(d){e&&e();var f=this;setTimeout(function(){var a=new M(0,d.extended?d.extended:0,0);f.sendSACommand(a,!0,function(a){e&&e(a)})},2E3)}else e&&e()};u.prototype.sendTelegram=function(a,d,e){this.sendPacket(a.toPacket(),d,e)};u.prototype.sendResponse=
function(a,d){this._logger.log("trace","send RESPONSE:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),!1,d)};u.prototype.sendSACommand=function(a,d,e){this._logger.log("trace","send SA_COMMAND:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),d,e)};u.prototype.sendPacket=function(a,d,e){this.sendFrame(a.toFrame(),d,e)};u.prototype.sendFrame=function(a,d,e,f){var g=this._frameBuffer.length;this._frameBuffer.push({frame:a,callback:e,timeout:null,response:d,to:f});0==g&&this._sendNextFrame()};
u.prototype._sendNextFrame=function(){if(0!=this._frameBuffer.length){var a=this._frameBuffer[0],d=a.frame,e=a.callback,f=a.response;if(this._serial){var g=this;d=d.toBuffer();this._logger.log("trace","send raw frame:"+d.toString("hex"));this._serial.sendPacket(d,function(d){if(d||!f){try{e&&e(d)}catch(Oa){}g._frameBuffer.splice(0,1);g._sendNextFrame()}else d=a.to,d||(d=u.RESPONSE_TO),a.timeout=setTimeout(function(){var a=g._frameBuffer[0];if(a){a=a.callback;var d=Error("enocean response timeout");
d.code=100;try{a&&a(d)}catch(Pa){}}g._frameBuffer.splice(0,1);g._sendNextFrame()},d)})}else e&&e(Error("port not opened")),this._frameBuffer.splice(0,1),this._sendNextFrame()}};u.prototype.onSerialData=function(a){a=this._rdata=Buffer.concat([this._rdata,a]);for(var d=0;d<a.length;d++)if(85==a[d]&&d+6<a.length){var e=(a[d+1]<<8)+a[d+2],g=a[d+3],h=a[d+5];if(a.length>=d+e+g+7){var k=!1;x.hub.m.enocean.CRC8(a.slice(d+1,d+5));if(x.hub.m.enocean.CRC8(a.slice(d+1,d+5))==h&&(h=a[d+e+g+6],x.hub.m.enocean.CRC8(a.slice(d+
6,d+6+e+g))==h)){k=!0;h={type:a[d+4],dataLen:e,optLen:g,radioType:a[d+6],data:a.slice(d+6,d+6+e),optData:a.slice(d+6+e,d+6+e+g),rawByte:a.slice(0,d+6+e+g+1).toString("hex")};var m=new f(h.type,h.data,h.optData);if(166==h.radioType||210==h.radioType||165==h.radioType||246==h.radioType||213==h.radioType)h.senderId=h.data.slice(e-5,e-1).toString("hex");this._onEOFrame(m,h);a=a.slice(d+6+e+g+1)}k||(a=a.slice(d+1))}}this._rdata=a};u.prototype.onSerialError=function(a){this._serial.setListener(null);this._serial=
null};u.prototype._onEOFrame=function(a,d){this._logger.log("trace","receive raw frame:"+d.rawByte);this._logger.log("debug","receive enocean frame:"+JSON.stringify(a.toJSON()));this._listeners.forEach(function(e){e._onEOFrame&&e._onEOFrame(a,d.rawByte)});var e=a.toPacket();e&&this._onEOPacket(e)};u.prototype._onEOPacket=function(a){this._logger.log("debug","receive enocean packet:"+JSON.stringify(a.toJSON()));this._listeners.forEach(function(d){d._onEOPacket&&d._onEOPacket(a)});a instanceof g?this._onEORadio_ERP1(a):
a instanceof e?this._onEOResponse_Packet(a):a instanceof h&&this._onEOEvent_Packet(a)};u.prototype._onEORadio_ERP1=function(a){(a=a.toRadioTelegram())&&this._onEO_ERP1_Telegram(a)};u.prototype._onEOResponse_Packet=function(a){try{var d=a.toResponse();this._onEO_Response(d)}catch(Aa){}if(0!=this._frameBuffer.length){var e=this._frameBuffer[0];d=e.callback;(e=e.timeout)&&clearTimeout(e);try{d&&d(null,a)}catch(Aa){}this._frameBuffer.splice(0,1);this._sendNextFrame()}};u.prototype._onEOEvent_Packet=function(a){(a=
a.toEvent())&&this._onEO_Event(a)};u.prototype._onEO_ERP1_Telegram=function(a){this._logger.log("debug","receive enocean telegram:"+JSON.stringify(a.toJSON()));this._listeners.forEach(function(d){d._onEOTelegram&&d._onEOTelegram(a)});49==a.rorg&&(a=this._controller._secHandler.resolve(a))&&this._listeners.forEach(function(d){d._onEOTelegram&&d._onEOTelegram(a)});if(this._learning&&this._learnHandler&&this._learnHandler.onTelegram)this._learnHandler.onTelegram(a)};u.prototype._onEO_Response=function(a){this._logger.log("debug",
"receive enocean response:"+JSON.stringify(a.toJSON()))};u.prototype._onEO_Event=function(a){this._logger.log("debug","receive enocean event:"+JSON.stringify(a.toJSON()));if(this._learning&&this._learnHandler&&this._learnHandler.onEvent)this._learnHandler.onEvent(a)};u.ESP3_Frame=f;u.Telegram=k;u.RADIO_ERP1_Packet=g;u.Event=w;u.Response=F;u.SA_COMMAND=J;return u}();
x.hub.m.enocean.profiles=function(){var f=function(b){this._address=b?b.address:null;this._senderID=b?b.senderID:null;this._data=b?b.data:null;this._params=b?b.params:null;this._vendor="general";this._virtual=!1;this._eepAlias=null;this.setDefaultParams();this._states={};this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles."+(this._data?this._data:"Profile"))};f.prototype.getAddress=function(){return this._address};f.prototype.getData=function(){return this._data};f.prototype.finalize=
function(b){b&&b()};f.prototype.evalData=function(b,c,a){(b=this.evalTelegram(c))?(b=this.checkStateChange(b),a&&a(null,b)):a&&a(Error("data format invalid"))};f.prototype.evalTelegram=function(b){return null};f.prototype.getStatesBuffer=function(){return this._states};f.prototype.getBufferedState=function(b){var c=this.getStatesBuffer();return c&&c[b]?c[b].value:null};f.prototype.getCurrentStates=function(){var b={},c=this.getStatesBuffer(),a;for(a in c)c.hasOwnProperty(a)&&c[a]&&(b[a]=c[a].value);
return b};f.prototype.getStatesLegacy=function(){var b=this.getCurrentStates();return{type:"ENOCEAN",adr:this._address,data:this._data,vendor:this._vendor,state:b}};f.prototype.checkStateChange=function(b){var c=this._states,a=[],d=(new Date).getTime(),e;for(e in b){var f={};f.key=e;f.value=b[e];f.changed=!1;var g=c[e]?c[e].value:null;g!=b[e]&&(f.oldvalue=g,f.changed=!0);this._states[e]={value:b[e],time:d};a.push(f)}return a};f.prototype.setDefaultParams=function(){};f.prototype.activeStateChange=
function(b){b=this.checkStateChange(b);0<b.length&&require("x.hub.m.enocean.js")._onEOEvents(this,b)};f.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params}};f.prototype.fromJSON=function(b){if(!b||!b.address||!b.data||b.data!=this._data)return null;this._address=b.address;this._senderID=b.senderID;this._vendor=b.vendor?b.vendor:this._vendor;this._virtual=b.virtual?!0:!1;this._params=
b.params;this.setDefaultParams();return this};f.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual}};f.prototype.fromDBJSON=function(b){if(!b||!b.id||!b.eep||b.eep!=this._data)return null;this._address=b.id;this._senderID=b.senderID;this._vendor=b.vendor?b.vendor:this._vendor;this._virtual=b.virtual?!0:!1;this._params=b.params;this.setDefaultParams();return this};var a=function(b){f.call(this,b);
this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SiegeniaWindow");this._data="d2-06-50";this._vendor="siegenia";this._desc="Window";this._states={counter00:{value:"?",time:-1},counter01:{value:"?",time:-1},counter02:{value:"?",time:-1},counter03:{value:"?",time:-1},counter04:{value:"?",time:-1},counter05:{value:"?",time:-1},counter06:{value:"?",time:-1},counter07:{value:"?",time:-1},counter08:{value:"?",time:-1},counter09:{value:"?",time:-1},counter0A:{value:"?",time:-1},aliveTimeout:{value:!1,
time:-1}};var c=this;this._params=b?b.params:null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});this._aliveTO=setTimeout(function(){c._aliveTimeout()},2E3*this._params.alive)};a.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"SIEGENIA-AUBI KG",vendor:"siegenia",params:{alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}};a.prototype=new f;a.prototype.constructor=a;a.prototype.evalTelegram=function(b){var c={};if(210==b.rorg)if(b=b.userData,1==b[0]&&8==b.length){var a=
b[1]&239,d=(b[2]<<24)+(b[3]<<16)+(b[4]<<8)+b[5],e=b[6]>>7;c={type:1,TBT:!1,batteryOK:!0,battery:b[6]&127,motionSensor:b[7]>>6,accelerationSensor:(b[7]&48)>>4,magneticSensor:(b[7]&12)>>2,error:b[7]&3,count:d};e&&(c.batteryOK=!1);100<c.battery&&(c.battery=100);c.code=a;switch(a){case 0:c.state="?";c.handle="?";c.counter00=d;break;case 1:c.state="closed";c.handle="closed";c.counter01=d;break;case 2:c.state="closed";c.handle="open";c.counter02=d;break;case 3:c.state="closed";c.handle="tilted";c.counter03=
d;break;case 4:c.state="open";c.handle="closed";c.counter04=d;break;case 5:c.state="open";c.handle="open";c.TBT=!0;c.counter05=d;break;case 6:c.state="open";c.handle="tilted";c.TBT=!0;c.counter06=d;break;case 7:c.state="tilted";c.handle="closed";c.TBT=!0;c.counter07=d;break;case 8:c.state="tilted";c.handle="open";c.TBT=!0;c.counter08=d;break;case 9:c.state="tilted";c.handle="tilted";c.counter09=d;break;case 10:c.state="?",c.handle="?",c.counter0A=d}}else if(2==b[0]&&2==b.length)switch(c.type=2,b[1]&
15){case 1:c.burglary=!0;break;default:c.burglary=!1}else if(b[0]=2==b.length){c.type=17;switch((b[1]&192)>>6){case 0:c.calibrationState="ok";break;case 1:c.calibrationState="error";break;case 2:c.calibrationState="invalid";break;case 3:c.calibrationState="not_supported"}b=b[1]&63;c.calibrationStep=b;switch(b){case 0:c.calibrationCasement="none";c.calibrationHandle="none";break;case 1:c.calibrationCasement="closed";c.calibrationHandle="closed";break;case 2:c.calibrationCasement="closed";c.calibrationHandle=
"open";break;case 3:c.calibrationCasement="closed";c.calibrationHandle="tilted";break;case 4:c.calibrationCasement="open";c.calibrationHandle="closed";break;case 5:c.calibrationCasement="open";c.calibrationHandle="open";break;case 6:c.calibrationCasement="open";c.calibrationHandle="tilted";break;case 7:c.calibrationCasement="tilted";c.calibrationHandle="closed";break;case 8:c.calibrationCasement="tilted";c.calibrationHandle="open";break;case 9:c.calibrationCasement="tilted",c.calibrationHandle="tilted"}}return c};
a.prototype.evalData=function(b,c,a){var r=this;r._states.aliveTimeout.value=!1;clearTimeout(this._aliveTO);this._aliveTO=setTimeout(function(){r._aliveTimeout()},2E3*this._params.alive);(b=this.evalTelegram(c))?(c=[],b.aliveMsg||(c=this.checkStateChange(b)),a&&a(null,c)):a&&a(Error("data format invalid"))};a.prototype.checkStateChange=function(b){var c=this._states,a=[],d;for(d in b)if("aliveMsg"!=d){var e={};e.key=d;e.value=b[d];e.changed=!1;var f=c[d]?c[d].value:null;f!=b[d]&&(e.oldvalue=f,e.changed=
!0);"burglary"!=d&&"calibrationState"!=d&&"calibrationCasement"!=d&&"calibrationHandle"!=d&&(this._states[d]={value:b[d],time:(new Date).getTime()});a.push(e)}return a};a.prototype._resolveStates=function(b,c){c={};if(210==b[0])if(b=b.slice(1,b.length-5),1==b[0]&&8==b.length){var a=b[1]&239,d=(b[2]<<24)+(b[3]<<16)+(b[4]<<8)+b[5],e=b[6]>>7;c={aliveMsg:1==(b[1]&128)>>7,TBT:!1,batteryOK:!0,battery:b[6]&127,motionSensor:b[7]>>6,accelerationSensor:(b[7]&48)>>4,magneticSensor:(b[7]&12)>>2,error:b[7]&3,
count:d};e&&(c.batteryOK=!1);100<c.battery&&(c.battery=100);switch(a){case 0:c.state="closed";c.handle="closed";c.counter00=d;break;case 1:c.state="closed";c.handle="open";c.counter01=d;break;case 2:c.state="open";c.handle="open";c.counter02=d;break;case 3:c.state="closed";c.handle="tilted";c.counter03=d;break;case 4:c.state="tilted";c.handle="tilted";c.counter04=d;break;case 5:c.state="closed";c.handle="tilted";c.TBT=!0;c.counter05=d;break;case 6:c.state="tilted";c.handle="tilted";c.TBT=!0;c.counter06=
d;break;case 7:c.state="closed";c.handle="open";c.TBT=!0;c.counter07=d;break;case 8:c.state="open";c.handle="open";c.TBT=!0;c.counter08=d;break;case 9:c.state="open";c.handle="closed";c.counter09=d;break;case 10:c.state="open",c.handle="tilted",c.counter0A=d}}else if(2==b[0]&&2==b.length)switch(b[1]&15){case 1:c.burglary=!0;break;default:c.burglary=!1}else if(b[0]=2==b.length){switch((b[1]&192)>>6){case 0:c.calibrationState="ok";break;case 1:c.calibrationState="error";break;case 2:c.calibrationState=
"invalid";break;case 3:c.calibrationState="not_supported"}switch(b[1]&63){case 0:c.calibrationCasement="none";c.calibrationHandle="none";break;case 1:c.calibrationCasement="closed";c.calibrationHandle="closed";break;case 2:c.calibrationCasement="closed";c.calibrationHandle="open";break;case 3:c.calibrationCasement="closed";c.calibrationHandle="tilted";break;case 4:c.calibrationCasement="open";c.calibrationHandle="closed";break;case 5:c.calibrationCasement="open";c.calibrationHandle="open";break;case 6:c.calibrationCasement=
"open";c.calibrationHandle="tilted";break;case 7:c.calibrationCasement="tilted";c.calibrationHandle="closed";break;case 8:c.calibrationCasement="tilted";c.calibrationHandle="open";break;case 9:c.calibrationCasement="tilted",c.calibrationHandle="tilted"}}return c};a.prototype._aliveTimeout=function(){this.activeStateChange({aliveTimeout:!0})};a.prototype.fromJSON=function(b){if(!f.prototype.fromJSON.call(this,b))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});
return this};a.prototype.fromDBJSON=function(b){if(!f.prototype.fromDBJSON.call(this,b))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});return this};var e=function(b){f.call(this,b);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.MacoWindow");this._data="d5-xx-xx";this._desc="Window";this._vendor="maco"};e.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"Mayer & Co Beschl\u00e4ge GmbH"};e.prototype=new f;e.prototype.constructor=
e;e.prototype.evalData=function(b,c,a){(b=this._resolveStates(b,c))?(b=this.checkStateChange(b),a&&a(null,b)):a&&a(Error("data format invalid"))};e.prototype._resolveStates=function(b,c){c={};if(213==b[0]){b=b.slice(1,b.length-5);var a=(b[0]&8)>>3,d=(b[0]&6)>>1,e=b[0]&1;switch((b[0]&48)>>4){case 0:c.state="unused";break;case 1:c.state="tilted";break;case 2:c.state="open";break;case 3:c.state="closed"}c.learn=a;c.battery=d;c.alarm=e}return c};e.prototype.toDBJSON=function(){return{id:this._address,
eep:this._data,desc:this._desc,manufacturer:"Mayer & Co Beschl\u00e4ge GmbH",vendor:this._vendor}};var g=function(b){f.call(this,b);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SodaHandle");this._data="f6-so-da"};g.TEMPALTE={id:null,eep:null};g.prototype=new f;g.prototype.constructor=g;g.prototype.evalTelegram=function(b){var c={};if(246==b.rorg)switch(b.userData){case 240:c.state="tilted";break;case 192:c.state="open";break;case 208:c.state="closed"}return c};g.prototype.evalData=
function(b,c,a){(b=this.evalTelegram(c))?(b=this.checkStateChange(b),a&&a(null,b)):a&&a(Error("data format invalid"))};g.prototype.toJSON=function(b,c){return{address:this._address,data:this._data,vendor:"soda"}};g.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:"Window_Handle",manufacturer:"SODA",vendor:"soda"}};var d=function(b){f.call(this,b);this._data="f6-??-??"};d.prototype=new f;d.prototype.constructor=d;var h=function(b){d.call(this,b);this._data="f6-01-01";this._longPressThreshold=
1E3};h.STATES=["button"];h.COMMANDS=["shortPress","longPress","press","release"];h.prototype=new d;h.prototype.constructor=k;h.prototype.evalTelegram=function(b){var c={};246==b.rorg&&(c.button=b.userData>>4&1?"pressed":"released");return c};h.prototype.buildData=function(b){return b<<4};h.prototype.checkStateChange=function(b){var c=this._states,a=[],d=(new Date).getTime(),e;for(e in b){var f={};f.key=e;f.value=b[e];f.changed=!1;var g=c[e]?c[e].value:null,h=c[e]?c[e].time:null,k=b[e];g!=k&&(f.oldvalue=
g,f.changed=!0);this._states[e]={value:b[e],time:d};f.changed&&a.push(f);"pressed"==g&&"released"==k&&(!h||d-h<this._longPressThreshold?(f={},f.key=e,f.value="shortPress"):(f={},f.key=e,f.value="longPress"),f.changed=!0,a.push(f))}return a};h.prototype.executeCommand=function(b,c,a){if(this._senderID)if(c&&c.value){var r=this,d=100;switch(c.value){case "longPress":d=this._longPressThreshold;case "shortPress":var e=this.buildData(1);var f=new x.hub.m.enocean.ESP3.Telegram.RPS(e,this._senderID,1,1,
0,null);b.sendTelegram(f,!0,function(c){c?a&&a(c):(r.activeStateChange({button:"pressed"}),setTimeout(function(){e=r.buildData(0);f=new x.hub.m.enocean.ESP3.Telegram.RPS(e,r._senderID,1,1,0,null);b.sendTelegram(f,!0,function(b){r.activeStateChange({button:"released"});a&&a(b)})},d))});break;case "press":e=this.buildData(1);f=new x.hub.m.enocean.ESP3.Telegram.RPS(e,this._senderID,1,1,0,null);b.sendTelegram(f,!0,function(b){r.activeStateChange({button:"pressed"});a&&a(b)});break;case "release":e=this.buildData(0),
f=new x.hub.m.enocean.ESP3.Telegram.RPS(e,this._senderID,1,1,0,null),b.sendTelegram(f,!0,function(b){r.activeStateChange({button:"released"});a&&a(b)})}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var k=function(b){d.call(this,b);this._data="f6-02-01";this._longPressThreshold=1E3};k.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];k.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");
k.prototype=new d;k.prototype.constructor=k;k.prototype.evalTelegram=function(b){var c={};if(246==b.rorg){var a=b.userData>>5&7,d=b.userData>>1&7,e=b.userData&1,f=b.t21,g=b.nu;b=b.userData>>4&1?"pressed":"released";if(1==f&&1==g){switch(a){case 0:var h=b;break;case 1:var k=b;break;case 2:var m=b;break;case 3:var l=b}if(e)switch(d){case 0:h=b;break;case 1:k=b;break;case 2:m=b;break;case 3:l=b}}else if(1==f&&0==g)switch(a){case 0:l=m=k=h=b}h&&(c.buttonAI=h);k&&(c.buttonAO=k);m&&(c.buttonBI=m);l&&(c.buttonBO=
l)}return c};k.prototype.buildData=function(b,c,a,d){return b<<5|c<<4|a<<1|d};k.prototype.checkStateChange=function(b){var c=this._states,a=[],d=(new Date).getTime(),e;for(e in b){var f={};f.key=e;f.value=b[e];f.changed=!1;var g=c[e]?c[e].value:null,h=c[e]?c[e].time:null,k=b[e];g!=k&&(f.oldvalue=g,f.changed=!0);this._states[e]={value:b[e],time:d};f.changed&&a.push(f);"pressed"==g&&"released"==k&&(!h||d-h<this._longPressThreshold?(f={},f.key=e,f.value="shortPress"):(f={},f.key=e,f.value="longPress"),
f.changed=!0,a.push(f))}return a};k.prototype.executeCommand=function(b,c,a){if(this._senderID)if(c&&c.value){var d=this,r=100,e=c.value.substr(c.value.length-2),f={},g=0;switch(e){case "AI":g=0;break;case "AO":g=1;break;case "BI":g=2;break;case "BO":g=3}switch(c.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":r=this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":var h=this.buildData(g,1,0,0);var k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,
this._senderID,1,1,0,null);b.sendTelegram(k,!0,function(c){c?a&&a(c):(f["button"+e]="pressed",d.activeStateChange(f),setTimeout(function(){h=d.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,d._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+e]="released";d.activeStateChange(f);a&&a(b)})},r))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":h=this.buildData(g,1,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);b.sendTelegram(k,
!0,function(b){f["button"+e]="pressed";d.activeStateChange(f);a&&a(b)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":h=d.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+e]="released";d.activeStateChange(f);a&&a(b)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var m=function(b){k.call(this,b);this._data="f6-02-02"};
k.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];m.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");m.prototype=new k;m.prototype.constructor=m;var p=function(b){d.call(this,b);this._data="f6-02-03"};p.STATES=["state"];p.COMMANDS=["auto","manu","dimUp","dimDown"];p.prototype=new d;p.prototype.constructor=p;p.prototype.evalTelegram=function(b){var c=
{};if(246==b.rorg)switch(b.userData){case 48:c.state="auto";break;case 16:c.state="manu";break;case 112:c.state="dimUp";break;case 80:c.state="dimDown"}return c};p.prototype.executeCommand=function(b,c,a){if(this._senderID)if(c&&c.value){switch(c.value){case "auto":var d=48;break;case "manu":d=16;break;case "dimUp":d=112;break;case "dimDown":d=80;break;default:a&&a(Error("unknow command"))}this.activeStateChange({state:c.value});c=new x.hub.m.enocean.ESP3.Telegram.RPS(d,this._senderID,1,1,0,null);
b.sendTelegram(c,!0,function(b){a&&a(b)})}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var l=function(b){k.call(this,b);this._data="f6-02-04";this._longPressThreshold=1E3};l.STATES=["buttonAI","buttonAO","buttonBI","buttonBO","energyBow"];l.prototype=new k;l.prototype.constructor=l;l.prototype.evalTelegram=function(b){var c={};if(246==b.rorg){var a=b.userData>>3&1,d=b.userData>>2&1,e=b.userData>>1&1,f=b.userData&1;c.energyBow=b.userData>>7&1?"pressed":"released";c.buttonBI=
a?"pressed":"released";c.buttonBO=d?"pressed":"released";c.buttonAI=e?"pressed":"released";c.buttonAO=f?"pressed":"released"}return c};var t=function(b){k.call(this,b);this._data="f6-03-01";this._longPressThreshold=1E3};t.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");t.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");
t.prototype=new k;t.prototype.constructor=t;t.prototype.evalTelegram=function(b){var c={};if(246==b.rorg){var a=b.userData>>5&7,d=b.userData>>1&7,e=b.userData&1,f=b.t21,g=b.nu;b=b.userData>>4&1?"pressed":"released";if(0==f&&1==g){switch(a){case 0:var h=b;break;case 1:var k=b;break;case 2:var m=b;break;case 3:var l=b;break;case 4:var n=b;break;case 5:var p=b;break;case 6:var q=b;break;case 7:var t=b}if(e)switch(d){case 0:h=b;break;case 1:k=b;break;case 2:m=b;break;case 3:l=b;break;case 4:n=b;break;
case 5:p=b;break;case 6:q=b;break;case 7:t=b}}else if(0==f&&0==g)switch(a){case 0:case 7:t=q=p=n=l=m=k=h=b}h&&(c.buttonAI=h);k&&(c.buttonAO=k);m&&(c.buttonBI=m);l&&(c.buttonBO=l);n&&(c.buttonCI=n);p&&(c.buttonCO=p);q&&(c.buttonDI=q);t&&(c.buttonDO=t)}return c};t.prototype.executeCommand=function(b,c,a){if(this._senderID)if(c&&c.value){var d=this,r=100,e=c.value.substr(c.value.length-2),f={},g=0;switch(e){case "AI":g=0;break;case "AO":g=1;break;case "BI":g=2;break;case "BO":g=3;break;case "CI":g=4;
break;case "CO":g=5;break;case "DI":g=6;break;case "DO":g=7}switch(c.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":case "longPressCI":case "longPressCO":case "longPressDI":case "longPressDO":r=this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":case "shortPressCI":case "shortPressCO":case "shortPressDI":case "shortPressDO":var h=this.buildData(g,1,0,0);var k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,
1,1,0,null);b.sendTelegram(k,!0,function(c){c?a&&a(c):(f["button"+e]="pressed",d.activeStateChange(f),setTimeout(function(){h=d.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,d._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+e]="released";d.activeStateChange(f);a&&a(b)})},r))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":case "pressCI":case "pressCO":case "pressDI":case "pressDO":h=this.buildData(g,1,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,
this._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+e]="pressed";d.activeStateChange(f);a&&a(b)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":case "releaseCI":case "releaseCO":case "releaseDI":case "releaseDO":h=d.buildData(0,0,0,0);k=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);b.sendTelegram(k,!0,function(b){f["button"+e]="released";d.activeStateChange(f);a&&a(b)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"));
else a&&a(Error("sender id is null"))};var z=function(b){t.call(this,b);this._data="f6-03-02"};z.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");z.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");
z.prototype=new t;z.prototype.constructor=z;var B=function(b){d.call(this,b);this._data="f6-04-01"};B.STATES=["keycard"];B.prototype=new d;B.prototype.constructor=B;B.prototype.evalTelegram=function(b){var c={};if(246==b.rorg){var a=b.t21,d=b.nu;b=b.userData;1==a&&1==d&&112==b?c.keycard="inserted":1==a&&0==d&&0==b&&(c.keycard="takeout")}return c};var K=function(b){d.call(this,b);this._data="f6-04-02"};K.STATES=["keycard"];K.prototype=new d;K.prototype.constructor=K;K.prototype.evalTelegram=function(b){var c=
{};if(246==b.rorg){var a=b.userData>>7&1;b=b.userData>>2&1;1==a&&1==b?c.keycard="inserted":0==a&&0==b&&(c.keycard="takeout")}return c};var G=function(b){d.call(this,b);this._data="f6-05-00"};G.STATES=["wind","lowbat"];G.prototype=new d;G.prototype.constructor=G;G.prototype.evalTelegram=function(b){var c={};if(246==b.rorg)switch(b.userData){case 0:c.wind="ok";this._states.lowbat||(c.lowbat=!1);break;case 16:c.wind="alarm";this._states.lowbat||(c.lowbat=!1);break;case 48:c.lowbat=!0}return c};var F=
function(b){d.call(this,b);this._data="f6-05-01"};t.COMMANDS=["reset"];F.STATES=["water"];F.prototype=new d;F.prototype.constructor=F;F.prototype.evalTelegram=function(b){var c={};if(246==b.rorg){var a=b.nu,d=b.userData;1==b.t21&&1==a&&17==d&&(c.water="alarm")}return c};F.prototype.executeCommand=function(b,c,a){if(c&&c.value)switch(c.value){case "reset":this.activeStateChange({water:"ok"});a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};var w=function(b){d.call(this,
b);this._data="f6-05-02"};w.STATES=["smoke","lowbat"];w.prototype=new d;w.prototype.constructor=w;w.prototype.evalTelegram=function(b){var c={};if(246==b.rorg)switch(b.userData){case 0:c.smoke="ok";this._states.lowbat||(c.lowbat=!1);break;case 16:c.smoke="alarm";this._states.lowbat||(c.lowbat=!1);break;case 48:c.lowbat=!0}return c};var L=function(b){d.call(this,b);this._data="f6-10-00"};L.STATES=["window","handle_pos","handle_raw"];L.prototype=new d;L.prototype.constructor=L;L.prototype.evalTelegram=
function(b){var c={};246==b.rorg&&(b=b.userData,0==(b&208^192)?(c.window="open",c.handle_pos="middle"):0==(b&240^240)?(c.window="closed",c.handle_pos="down"):0==(b&240^208)&&(c.window="tilted",c.handle_pos="up"),c.handle_raw=b);return c};var H=function(b){d.call(this,b);this._data="f6-10-01"};H.STATES=["window","handle_pos","handle_raw"];H.prototype=new d;H.prototype.constructor=H;H.prototype.evalTelegram=function(b){var c={};246==b.rorg&&(b=b.userData&15,0==(b&13^12)?(c.window="open",c.handle_pos=
"middle"):0==(b&15^15)?(c.window="closed",c.handle_pos="down"):0==(b&15^13)&&(c.window="tilted",c.handle_pos="up"),c.handle_raw=b);return c};var J=function(b){f.call(this,b);this._data="d5-??-??"};J.prototype=new f;J.prototype.constructor=J;var M=function(b){J.call(this,b);this._data="d5-00-01"};M.STATES=["contact","contact_raw"];M.prototype=new J;M.prototype.constructor=M;M.prototype.evalTelegram=function(b){var c={};213==b.rorg&&(b=b.userData,1==(b>>3&1)&&(b&=1,c.contact=b?"closed":"open",c.contact_raw=
b));return c};var q=function(b){f.call(this,b);this._data="a5-??-??";this.TEACH_IN_VARIATION=2;this.UNIQUE_GATEWAY_SENDERID=!0};q.prototype=new f;q.prototype.constructor=q;q.prototype.getTeachinType=function(){return"4BS"};q.prototype.isTeachinBidirectional=function(){return!1};var n=function(b){q.call(this,b);this._data="a5-02-??";this._tmpMin=-40;this._tmpMax=0};n.STATES=["temperature","temperature_raw"];n.prototype=new q;n.prototype.constructor=n;n.prototype.evalTelegram=function(b){var c={};if(165==
b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(2);1==(a>>3&1)&&(c.temperature=parseFloat(((255-b)/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),c.temperature_raw=b)}return c};var T=function(b){n.call(this,b);this._data="a5-02-01";this._tmpMin=-40;this._tmpMax=0};T.STATES=["temperature","temperature_raw"];T.prototype=new n;T.prototype.constructor=T;var u=function(b){n.call(this,b);this._data="a5-02-02";this._tmpMin=-30;this._tmpMax=10};u.STATES=["temperature","temperature_raw"];
u.prototype=new n;u.prototype.constructor=u;var da=function(b){n.call(this,b);this._data="a5-02-03";this._tmpMin=-20;this._tmpMax=20};da.STATES=["temperature","temperature_raw"];da.prototype=new n;da.prototype.constructor=da;var Ob=function(b){n.call(this,b);this._data="a5-02-04";this._tmpMin=-10;this._tmpMax=30};Ob.STATES=["temperature","temperature_raw"];Ob.prototype=new n;Ob.prototype.constructor=Ob;var Pb=function(b){n.call(this,b);this._data="a5-02-05";this._tmpMin=0;this._tmpMax=40};Pb.STATES=
["temperature","temperature_raw"];Pb.prototype=new n;Pb.prototype.constructor=Pb;var Aa=function(b){n.call(this,b);this._data="a5-02-06";this._tmpMin=10;this._tmpMax=50};Aa.STATES=["temperature","temperature_raw"];Aa.prototype=new n;Aa.prototype.constructor=Aa;var Qb=function(b){n.call(this,b);this._data="a5-02-07";this._tmpMin=20;this._tmpMax=60};Qb.STATES=["temperature","temperature_raw"];Qb.prototype=new n;Qb.prototype.constructor=Qb;var Rb=function(b){n.call(this,b);this._data="a5-02-08";this._tmpMin=
30;this._tmpMax=70};Rb.STATES=["temperature","temperature_raw"];Rb.prototype=new n;Rb.prototype.constructor=Rb;var Oa=function(b){n.call(this,b);this._data="a5-02-09";this._tmpMin=40;this._tmpMax=80};Oa.STATES=["temperature","temperature_raw"];Oa.prototype=new n;Oa.prototype.constructor=Oa;var Sb=function(b){n.call(this,b);this._data="a5-02-0a";this._tmpMin=50;this._tmpMax=90};Sb.STATES=["temperature","temperature_raw"];Sb.prototype=new n;Sb.prototype.constructor=Sb;var Pa=function(b){n.call(this,
b);this._data="a5-02-0b";this._tmpMin=60;this._tmpMax=100};Pa.STATES=["temperature","temperature_raw"];Pa.prototype=new n;Pa.prototype.constructor=Pa;var Tb=function(b){n.call(this,b);this._data="a5-02-10";this._tmpMin=-60;this._tmpMax=20};Tb.STATES=["temperature","temperature_raw"];Tb.prototype=new n;Tb.prototype.constructor=Tb;var Ub=function(b){n.call(this,b);this._data="a5-02-11";this._tmpMin=-50;this._tmpMax=30};Ub.STATES=["temperature","temperature_raw"];Ub.prototype=new n;Ub.prototype.constructor=
Ub;var Vb=function(b){n.call(this,b);this._data="a5-02-12";this._tmpMin=-40;this._tmpMax=40};Vb.STATES=["temperature","temperature_raw"];Vb.prototype=new n;Vb.prototype.constructor=Vb;var Wb=function(b){n.call(this,b);this._data="a5-02-13";this._tmpMin=-30;this._tmpMax=50};Wb.STATES=["temperature","temperature_raw"];Wb.prototype=new n;Wb.prototype.constructor=Wb;var Xb=function(b){n.call(this,b);this._data="a5-02-14";this._tmpMin=-20;this._tmpMax=60};Xb.STATES=["temperature","temperature_raw"];Xb.prototype=
new n;Xb.prototype.constructor=Xb;var Yb=function(b){n.call(this,b);this._data="a5-02-15";this._tmpMin=-10;this._tmpMax=70};Yb.STATES=["temperature","temperature_raw"];Yb.prototype=new n;Yb.prototype.constructor=Yb;var Zb=function(b){n.call(this,b);this._data="a5-02-16";this._tmpMin=0;this._tmpMax=80};Zb.STATES=["temperature","temperature_raw"];Zb.prototype=new n;Zb.prototype.constructor=Zb;var $b=function(b){n.call(this,b);this._data="a5-02-17";this._tmpMin=10;this._tmpMax=90};$b.STATES=["temperature",
"temperature_raw"];$b.prototype=new n;$b.prototype.constructor=$b;var ac=function(b){n.call(this,b);this._data="a5-02-18";this._tmpMin=20;this._tmpMax=100};ac.STATES=["temperature","temperature_raw"];ac.prototype=new n;ac.prototype.constructor=ac;var bc=function(b){n.call(this,b);this._data="a5-02-19";this._tmpMin=30;this._tmpMax=110};bc.STATES=["temperature","temperature_raw"];bc.prototype=new n;bc.prototype.constructor=bc;var cc=function(b){n.call(this,b);this._data="a5-02-1a";this._tmpMin=40;this._tmpMax=
120};cc.STATES=["temperature","temperature_raw"];cc.prototype=new n;cc.prototype.constructor=cc;var dc=function(b){n.call(this,b);this._data="a5-02-1b";this._tmpMin=50;this._tmpMax=130};dc.STATES=["temperature","temperature_raw"];dc.prototype=new n;dc.prototype.constructor=dc;var ta=function(b){q.call(this,b);this._data="a5-02-20";this._tmpMin=-10;this._tmpMax=41.2};ta.STATES=["temperature","temperature_raw"];ta.prototype=new q;ta.prototype.constructor=ta;ta.prototype.evalTelegram=function(b){var c=
{};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt16BE(1);1==(a>>3&1)&&(a=b&1023,c.temperature=parseFloat(((1023-a)/1023*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),c.temperature_raw=a)}return c};var ec=function(b){ta.call(this,b);this._data="a5-02-30";this._tmpMin=-40;this._tmpMax=62.3};ec.STATES=["temperature","temperature_raw"];ec.prototype=new ta;ec.prototype.constructor=ec;var Y=function(b){q.call(this,b);this._data="a5-04-??";this._humMin=0;this._humMax=100;this._tempMin=
0;this._tempMax=40};Y.STATES=["humidity","humidity_raw","temperature","temperature_raw","available"];Y.prototype=new q;Y.prototype.constructor=Y;Y.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2);b=b.userData.readUInt8(1);1==(a>>3&1)&&(c.humidity=parseFloat((b/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),c.humidity_raw=b,c.temperature=parseFloat((d/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),c.temperature_raw=
d,c.available=a>>1&1?!0:!1)}return c};var fc=function(b){Y.call(this,b);this._data="a5-04-01"};fc.STATES=Y.STATES;fc.prototype=new Y;fc.prototype.constructor=fc;var Ba=function(b){Y.call(this,b);this._data="a5-04-02";this._tempMin=-20;this._tempMax=60};Ba.STATES=Y.STATES;Ba.prototype=new Y;Ba.prototype.constructor=Ba;var Qa=function(b){Y.call(this,b);this._data="a5-04-03";this._tempMin=-20;this._tempMax=60};Qa.STATES=["humidity","humidity_raw","temperature","temperature_raw","type"];Qa.prototype=
new Y;Qa.prototype.constructor=Qa;Qa.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt16BE(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(c.humidity=parseFloat((b/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),c.humidity_raw=b,d&=1023,c.temperature=parseFloat((d/1023*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),c.temperature_raw=d,c.type=a&1?"event":"heartbeat")}return c};var N=function(b){q.call(this,b);this._data="a5-06-??";
this._svcMin=0;this._svcMax=5.1;this._ill2Min=300;this._ill2Max=3E4;this._ill1Min=600;this._ill1Max=6E4};N.STATES="voltage voltage_raw illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw range range_raw".split(" ");N.prototype=new q;N.prototype.constructor=N;N.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.voltage=parseFloat((b/
255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));c.voltage_raw=b;c.illumination2=parseFloat((e/255*(this._ill2Max-this._ill2Min)+this._ill2Min).toFixed(1));c.illumination2_raw=e;c.illumination1=parseFloat((d/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1));c.illumination1_raw=d;a&=1;switch(a){case 0:c.range="db1";c.illumination=c.illumination1;c.illumination_raw=d;break;case 1:c.range="db2",c.illumination=c.illumination2,c.illumination_raw=d}c.range_raw=a}}return c};var Ca=function(b){N.call(this,
b);this._data="a5-06-01"};Ca.STATES=N.STATES;Ca.prototype=new N;Ca.prototype.constructor=Ca;var ua=function(b){N.call(this,b);this._data="a5-06-02";this._ill2Min=0;this._ill2Max=510;this._ill1Min=0;this._ill1Max=1020};ua.STATES=N.STATES;ua.prototype=new N;ua.prototype.constructor=ua;var Ra=function(b){N.call(this,b);this._data="a5-06-03";this._svcMin=0;this._svcMax=5.1};Ra.STATES=["voltage","voltage_raw","illumination","illumination_raw"];Ra.prototype=new N;Ra.prototype.constructor=Ra;Ra.prototype.evalTelegram=
function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt16BE(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(c.voltage=parseFloat((b/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),c.voltage_raw=b,a=d>>6&1023,c.illumination=a,c.illumination_raw=a)}return c};var Sa=function(b){N.call(this,b);this._data="a5-06-04";this._tmpMin=-20;this._tmpMax=60};Sa.STATES="temperature temperature_raw illumination illumination_raw energy energy_raw temperature_avail energy_avail".split(" ");
Sa.prototype=new N;Sa.prototype.constructor=Sa;Sa.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt16BE(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(c.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),c.temperature_raw=b,c.illumination=d,c.illumination_raw=d,d=a>>4&15,c.energy=parseFloat((d/15*100).toFixed(1)),c.energy_raw=d,c.temperature_avail=a>>1&1?!0:!1,c.temperature_avail||delete c.temperature,c.energy_avail=
a&1?!0:!1,c.energy_avail||delete c.energy)}return c};var gc=function(b){N.call(this,b);this._data="a5-06-05";this._ill2Min=0;this._ill2Max=5100;this._ill1Min=0;this._ill1Max=10200};gc.STATES=N.STATES;gc.prototype=new N;gc.prototype.constructor=gc;var R=function(b){q.call(this,b);this._data="a5-07-??";this._params||(this._params={reset_timeout:30});this._resetTO=null};R.COMMANDS=["reset"];R.prototype=new q;R.prototype.constructor=R;R.prototype._startPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),
this._resetTO=null);if(this._params.reset_timeout&&!(0>this._params.reset_timeout)){var b=this;this._resetTO=setTimeout(function(){b._resetTO=null;b._reset()},1E3*this._params.reset_timeout)}};R.prototype._stopPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null)};R.prototype._reset=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null);var b={key:"state",value:"off",changed:!1},c=this._states.state?this._states.state.value:null;c!=v&&(b.oldvalue=
c,b.changed=!0);this._states.state={value:"off",time:(new Date).getTime()};require("x.hub.m.enocean.js")._onEOEvents(this,[b])};R.prototype.executeCommand=function(b,c,a){if(c&&c.value)switch(c.value){case "reset":this._reset();a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};R.prototype.fromJSON=function(b){if(!f.prototype.fromJSON.call(this,b))return null;this._params||(this._params={reset_timeout:30});return this};R.prototype.fromDBJSON=function(b){if(!f.prototype.fromDBJSON.call(this,
b))return null;this._params||(this._params={reset_timeout:30});return this};var Da=function(b){R.call(this,b);this._data="a5-07-01"};Da.COMMANDS=["reset"];Da.STATES=["voltage","voltage_raw","state","state_raw","voltage_avail"];Da.prototype=new R;Da.prototype.constructor=Da;Da.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2);b=b.userData.readUInt8(0);1==(a>>3&1)&&(c.voltage=parseFloat((b/250*5).toFixed(1)),c.voltage_raw=b,c.state=128<=
d?"on":"off",c.state_raw=d,c.voltage_avail=a&1?!0:!1,c.voltage_avail||delete c.voltage)}"on"==c.state?this._startPIROffTO():"off"==c.state&&this._stopPIROffTO();return c};var Ea=function(b){R.call(this,b);this._data="a5-07-02"};Ea.COMMANDS=["reset"];Ea.STATES=["voltage","voltage_raw","state","state_raw"];Ea.prototype=new R;Ea.prototype.constructor=Ea;Ea.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);1==(a>>3&1)&&(c.voltage=parseFloat((b/
250*5).toFixed(1)),c.voltage_raw=b,a=a>>7&1,c.state=a?"on":"off",c.state_raw=a)}"on"==c.state?this._startPIROffTO():"off"==c.state&&this._stopPIROffTO();return c};var Fa=function(b){R.call(this,b);this._data="a5-07-03"};Fa.COMMANDS=["reset"];Fa.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");Fa.prototype=new R;Fa.prototype.constructor=Fa;Fa.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt16BE(1);b=
b.userData.readUInt8(0);1==(a>>3&1)&&(c.voltage=parseFloat((b/250*5).toFixed(1)),c.voltage_raw=b,d=d>>6&1023,c.illumination=d,c.illumination_raw=d,a=a>>7&1,c.state=a?"on":"off",c.state_raw=a)}"on"==c.state?this._startPIROffTO():"off"==c.state&&this._stopPIROffTO();return c};var ma=function(b){q.call(this,b);this._data="a5-08-??";this._svcMin=0;this._svcMax=5.1;this._illMin=0;this._illMax=510;this._tmpMin=0;this._tmpMax=51};ma.prototype=new q;ma.prototype.constructor=ma;ma.prototype.evalTelegram=function(b){var c=
{};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.voltage=parseFloat((b/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));c.voltage_raw=b;c.illumination=parseFloat((e/255*(this._illMax-this._illMin)+this._illMin).toFixed(1));c.illumination_raw=e;c.temperature=parseFloat((d/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1));c.temperature_raw=d;d=a>>1&1;switch(d){case 0:c.state="on";break;case 1:c.state=
"off"}c.state_raw=d;a&=1;switch(a){case 0:c.button="pressed";break;case 1:c.button="released"}c.button_raw=a}}return c};var Ga=function(b){ma.call(this,b);this._data="a5-08-01"};Ga.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");Ga.prototype=new ma;Ga.prototype.constructor=Ga;var hc=function(b){ma.call(this,b);this._data="a5-08-02";this._illMax=1020};hc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");
hc.prototype=new ma;hc.prototype.constructor=hc;var ic=function(b){ma.call(this,b);this._data="a5-08-03";this._illMax=1530;this._tmpMin=-30;this._tmpMax=50};ic.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");ic.prototype=new ma;ic.prototype.constructor=ic;var C=function(b){q.call(this,b);this._data="a5-09-??"};C.prototype=new q;C.prototype.constructor=C;var Ta=function(b){C.call(this,b);this._data="a5-09-02";this._svcMin=
0;this._svcMax=5.1;this._gasMin=0;this._gasMax=1020;this._tmpMin=0;this._tmpMax=51};Ta.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available".split(" ");Ta.prototype=new C;Ta.prototype.constructor=Ta;Ta.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(c.voltage=parseFloat((b/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),
c.voltage_raw=b,c.gas=parseFloat((e/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),c.gas_raw=e,c.temperature=parseFloat((d/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),c.temperature_raw=d,a=a>>1&1,c.temperature_available=a?!0:!1,a||delete c.temperature)}return c};var Ua=function(b){C.call(this,b);this._data="a5-09-04";this._humMin=0;this._humMax=100;this._gasMin=0;this._gasMax=2550;this._tmpMin=0;this._tmpMax=51};Ua.STATES="humidity humidity_raw gas gas_raw temperature temperature_raw temperature_available humidity_available".split(" ");
Ua.prototype=new C;Ua.prototype.constructor=Ua;Ua.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);1==(a>>3&1)&&(c.humidity=parseFloat((b/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),c.humidity_raw=b,c.gas=parseFloat((e/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),c.gas_raw=e,c.temperature=parseFloat((d/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),
c.temperature_raw=d,d=a>>2&1,c.humidity_available=d?!0:!1,d||delete c.humidity,a=a>>1&1,c.temperature_available=a?!0:!1,a||delete c.temperature)}return c};var Va=function(b){C.call(this,b);this._data="a5-09-05"};Va.STATES=["voc","voc_raw","voc_id","voc_id_raw","scale"];Va.prototype=new C;Va.prototype.constructor=Va;Va.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2);b=b.userData.readUInt16BE(0);if(1==(a>>3&1)){a&=3;var e=1;switch(a){case 0:e=
.01;break;case 1:e=.1;break;case 2:e=1;break;case 3:e=10}c.scale=e;c.voc=b*e;c.voc_raw=b;switch(a){case 0:c.voc_id="VOCT";break;case 1:c.voc_id="Formaldehyde";break;case 2:c.voc_id="Benzene";break;case 3:c.voc_id="Styrene";break;case 4:c.voc_id="Toluene";break;case 5:c.voc_id="Tetrachloroethylene";break;case 6:c.voc_id="Xylene";break;case 7:c.voc_id="n-Hexane";break;case 8:c.voc_id="n-Octane";break;case 9:c.voc_id="Cyclopentane";break;case 10:c.voc_id="Methanol";break;case 11:c.voc_id="Ethanol";break;
case 12:c.voc_id="1-Pentanol";break;case 13:c.voc_id="Acetone";break;case 14:c.voc_id="ethylene Oxide";break;case 15:c.voc_id="Acetaldehyde ue";break;case 16:c.voc_id="Acetic Acid";break;case 17:c.voc_id="Propionice Acid";break;case 18:c.voc_id="Valeric Acid";break;case 19:c.voc_id="Butyric Acid";break;case 20:c.voc_id="Ammoniac";break;case 22:c.voc_id="Hydrogen Sulfide";break;case 23:c.voc_id="Dimethylsulfide";break;case 24:c.voc_id="2-Butanol";break;case 25:c.voc_id="2-Methylpropanol";break;case 26:c.voc_id=
"Diethyl ether";break;case 255:c.voc_id="ozone"}c.voc_id_raw=d}}return c};var Wa=function(b){C.call(this,b);this._data="a5-09-06"};Wa.STATES=["radon"];Wa.prototype=new C;Wa.prototype.constructor=Wa;Wa.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt16BE(0);1==(a>>3&1)&&(c.radon=b>>6&1023)}return c};var Xa=function(b){C.call(this,b);this._data="a5-09-07"};Xa.STATES="pm10 pm25 pm1 pm10_active pm25_active pm25_active".split(" ");Xa.prototype=
new C;Xa.prototype.constructor=Xa;Xa.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt16BE(2),e=b.userData.readUInt16BE(1);b=b.userData.readUInt16BE(0);1==(a>>3&1)&&(c.pm10=b>>7&511,c.pm25=e>>6&511,c.pm1=d>>5&511,d=a>>2&1,c.pm10_active=d?!0:!1,d||delete c.pm10,d=a>>1&1,c.pm25_active=d?!0:!1,d||delete c.pm25,a&=1,c.pm1_active=a?!0:!1,a||delete c.pm1)}return c};var Ya=function(b){C.call(this,b);this._data="a5-09-08"};Ya.STATES=["co2","co2_raw"];
Ya.prototype=new C;Ya.prototype.constructor=Ya;Ya.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(2);1==(a>>3&1)&&(c.co2=parseFloat((b/255*2E3).toFixed(1)),c.co2_raw=b)}return c};var Za=function(b){C.call(this,b);this._data="a5-09-09"};Za.STATES=["co2","co2_raw","power_failure_detected"];Za.prototype=new C;Za.prototype.constructor=Za;Za.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(2);
1==(a>>3&1)&&(c.co2=parseFloat((b/255*2E3).toFixed(1)),c.co2_raw=b,c.power_failure_detected=a>>2&1?!0:!1)}return c};var $a=function(b){C.call(this,b);this._data="a5-09-0a";this._svcMin=2;this._svcMax=5;this._tmpMin=-20;this._tmpMax=60};$a.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available voltage_available".split(" ");$a.prototype=new C;$a.prototype.constructor=$a;$a.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=
b.userData.readUInt8(2);b=b.userData.readUInt16BE(0);1==(a>>3&1)&&(c.gas=b,c.gas_raw=b,c.temperature=parseFloat((d/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),c.temperature_raw=d,d=a>>4&15,c.voltage=parseFloat((d/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),c.voltage_raw=d,d=a>>1&1,c.temperature_available=d?!0:!1,d||delete c.temperature,a&=1,c.voltage_available=a?!0:!1,a||delete c.voltage)}return c};var ab=function(b){C.call(this,b);this._data="a5-09-0b";this._svcMin=2;this._svcMax=
5};ab.STATES="voltage voltage_raw radio radio_raw scale unit unit_raw voltage_available".split(" ");ab.prototype=new C;ab.prototype.constructor=ab;ab.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt16BE(2);b=b.userData.readUInt8(0);if(1==(a>>3&1)){b=b>>4&15;c.voltage=parseFloat((b/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));c.voltage_raw=b;b=1;switch(a>>4&15){case 0:b=.001;break;case 1:b=.01;break;case 2:b=.1;break;case 3:b=
1;break;case 4:b=10;break;case 5:b=100;break;case 6:b=1E3;break;case 7:b=1E4;break;case 8:b=1E5}c.scale=b;c.radio=d/10*b;c.radio_raw=d;d=a>>1&3;switch(d){case 0:c.unit="\u03bcSv/h";break;case 1:c.unit="cpm";break;case 2:c.unit="Bq/L";break;case 3:c.unit="Bq/kg"}c.unit_raw=d;a&=1;c.voltage_available=a?!0:!1;a||delete c.voltage}}return c};var bb=function(b){C.call(this,b);this._data="a5-09-0c"};bb.STATES="voc voc_raw voc_id voc_id_raw unit unit_raw scale".split(" ");bb.prototype=new C;bb.prototype.constructor=
bb;bb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2);b=b.userData.readUInt16BE(0);if(1==(a>>3&1)){var e=a&3,f=1;switch(e){case 0:f=.01;break;case 1:f=.1;break;case 2:f=1;break;case 3:f=10}c.scale=f;a=a>>1&1;switch(a){case 0:c.unit="ppb";break;case 1:c.unit="\u03bcSv/m3"}c.unit_raw=a;c.voc=b*f;c.voc_raw=b;switch(e){case 0:c.voc_id="VOCT";break;case 1:c.voc_id="Formaldehyde";break;case 2:c.voc_id="Benzene";break;case 3:c.voc_id="Styrene";
break;case 4:c.voc_id="Toluene";break;case 5:c.voc_id="Tetrachloroethylene";break;case 6:c.voc_id="Xylene";break;case 7:c.voc_id="n-Hexane";break;case 8:c.voc_id="n-Octane";break;case 9:c.voc_id="Cyclopentane";break;case 10:c.voc_id="Methanol";break;case 11:c.voc_id="Ethanol";break;case 12:c.voc_id="1-Pentanol";break;case 13:c.voc_id="Acetone";break;case 14:c.voc_id="ethylene Oxide";break;case 15:c.voc_id="Acetaldehyde ue";break;case 16:c.voc_id="Acetic Acid";break;case 17:c.voc_id="Propionice Acid";
break;case 18:c.voc_id="Valeric Acid";break;case 19:c.voc_id="Butyric Acid";break;case 20:c.voc_id="Ammoniac";break;case 22:c.voc_id="Hydrogen Sulfide";break;case 23:c.voc_id="Dimethylsulfide";break;case 24:c.voc_id="2-Butanol";break;case 25:c.voc_id="2-Methylpropanol";break;case 26:c.voc_id="Diethyl ether";break;case 27:c.voc_id="Naphthalene";break;case 28:c.voc_id="4-Phenylcyclohexene";break;case 29:c.voc_id="Limonene";break;case 30:c.voc_id="Trichloroethylene";break;case 31:c.voc_id="Isovaleric acid";
break;case 32:c.voc_id="Indole";break;case 33:c.voc_id="Cadaverine";break;case 34:c.voc_id="Putrescine";break;case 35:c.voc_id="Caproic acid";break;case 255:c.voc_id="ozone"}c.voc_id_raw=d}}return c};var Ha=function(b){q.call(this,b);this._data="a5-10-??"};Ha.prototype=new q;Ha.prototype.constructor=Ha;var y=function(b){Ha.call(this,b);this._data="a5-10-01";this._params||(this._params={minSP:18,maxSP:26})};y.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");
y.prototype=new Ha;y.prototype.constructor=y;y.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.fan_speed=144>=b?"3":164>=b?"2":189>=b?"1":209>=b?"0":"auto";c.fan_speed_raw=b;c.setpoint=parseFloat((e/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));c.setpoint_raw=e;c.temperature=parseFloat(((255-d)/255*40).toFixed(1));c.temperature_raw=
d;a&=1;switch(a){case 0:c.button="pressed";break;case 1:c.button="released"}c.button_raw=a}}return c};y.prototype.fromJSON=function(b){if(!f.prototype.fromJSON.call(this,b))return null;this._params||(this._params={minSP:18,maxSP:26});return this};y.prototype.fromDBJSON=function(b){if(!f.prototype.fromDBJSON.call(this,b))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var aa=function(b){y.call(this,b);this._data="a5-10-02"};aa.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
aa.prototype=new y;aa.prototype.constructor=aa;aa.prototype.evalTelegram=function(b){var c=y.prototype.evalTelegram.call(this,b);if(0==Object.keys(c).length)return c;delete c.button;delete c.button_raw;b=b.userData.readUInt8(3)&1;c.slider=b?"day":"night";c.slider_raw=b;return c};var va=function(b){y.call(this,b);this._data="a5-10-03";this.TEACH_IN_VARIATION=1};va.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];va.prototype=new y;va.prototype.constructor=va;va.prototype.evalTelegram=
function(b){b=y.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;delete b.button;delete b.button_raw;return b};var cb=function(b){y.call(this,b);this._data="a5-10-04"};cb.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw".split(" ");cb.prototype=new y;cb.prototype.constructor=cb;cb.prototype.evalTelegram=function(b){b=y.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.button;
delete b.button_raw;return b};var db=function(b){y.call(this,b);this._data="a5-10-05"};db.STATES="setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");db.prototype=new y;db.prototype.constructor=db;db.prototype.evalTelegram=function(b){b=y.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;return b};var wa=function(b){aa.call(this,b);this._data="a5-10-06"};wa.STATES="setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
wa.prototype=new aa;wa.prototype.constructor=wa;wa.prototype.evalTelegram=function(b){b=aa.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;return b};var eb=function(b){y.call(this,b);this._data="a5-10-07"};eb.STATES=["fan_speed","fan_speed_raw","temperature","temperature_raw"];eb.prototype=new y;eb.prototype.constructor=eb;eb.prototype.evalTelegram=function(b){b=y.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;
delete b.setpoint;delete b.setpoint_raw;delete b.button;delete b.button_raw;return b};var ea=function(b){y.call(this,b);this._data="a5-10-08";this._params=null};ea.STATES="fan_speed fan_speed_raw temperature temperature_raw button button_raw".split(" ");ea.prototype=new y;ea.prototype.constructor=ea;ea.prototype.evalTelegram=function(b){b=y.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};ea.prototype.fromJSON=function(b){return f.prototype.fromJSON.call(this,
b)};ea.prototype.fromDBJSON=function(b){return f.prototype.fromDBJSON.call(this,b)};var fa=function(b){aa.call(this,b);this._data="a5-10-09";this._params=null};fa.STATES="fan_speed fan_speed_raw temperature temperature_raw slider slider_raw".split(" ");fa.prototype=new aa;fa.prototype.constructor=fa;fa.prototype.evalTelegram=function(b){b=aa.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};fa.prototype.fromJSON=function(b){return f.prototype.fromJSON.call(this,
b)};fa.prototype.fromDBJSON=function(b){return f.prototype.fromDBJSON.call(this,b)};var qa=function(b){y.call(this,b);this._data="a5-10-0a"};qa.STATES="setpoint setpoint_raw temperature temperature_raw contact contact_raw".split(" ");qa.prototype=new y;qa.prototype.constructor=qa;qa.prototype.evalTelegram=function(b){var c=y.prototype.evalTelegram.call(this,b);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;delete c.button;delete c.button_raw;b=b.userData.readUInt8(3)&
1;c.contact=b?"open":"closed";c.contact_raw=b;return c};var xa=function(b){qa.call(this,b);this._data="a5-10-0b";this._params=null};xa.STATES=["temperature","temperature_raw","contact","contact_raw"];xa.prototype=new qa;xa.prototype.constructor=xa;xa.prototype.evalTelegram=function(b){b=qa.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};xa.prototype.fromJSON=function(b){return f.prototype.fromJSON.call(this,b)};xa.prototype.fromDBJSON=
function(b){return f.prototype.fromDBJSON.call(this,b)};var fb=function(b){ea.call(this,b);this._data="a5-10-0c"};fb.STATES=["temperature","temperature_raw","button","button_raw"];fb.prototype=new ea;fb.prototype.constructor=fb;fb.prototype.evalTelegram=function(b){b=ea.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;return b};var gb=function(b){fa.call(this,b);this._data="a5-10-0d"};gb.STATES=["temperature","temperature_raw","slider",
"slider_raw"];gb.prototype=new fa;gb.prototype.constructor=gb;gb.prototype.evalTelegram=function(b){b=fa.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.fan_speed;delete b.fan_speed_raw;return b};var P=function(b){Ha.call(this,b);this._data="a5-10-10";this._params||(this._params={minSP:18,maxSP:26})};P.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw button button_raw".split(" ");P.prototype=new Ha;P.prototype.constructor=P;P.prototype.evalTelegram=
function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.setpoint=parseFloat((b/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));c.setpoint_raw=b;c.humidity=parseFloat((e/250*100).toFixed(1));c.humidity_raw=e;c.temperature=parseFloat((d/250*40).toFixed(1));c.temperature_raw=d;a&=1;switch(a){case 0:c.button="pressed";break;case 1:c.button="released"}c.button_raw=a}}return c};
P.prototype.fromJSON=function(b){if(!f.prototype.fromJSON.call(this,b))return null;this._params||(this._params={minSP:18,maxSP:26});return this};P.prototype.fromDBJSON=function(b){if(!f.prototype.fromDBJSON.call(this,b))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var ra=function(b){P.call(this,b);this._data="a5-10-11"};ra.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");ra.prototype=new P;ra.prototype.constructor=
ra;ra.prototype.evalTelegram=function(b){var c=P.prototype.evalTelegram.call(this,b);if(0==Object.keys(c).length)return c;delete c.button;delete c.button_raw;b=b.userData.readUInt8(3)&1;c.slider=b?"day":"night";c.slider_raw=b;return c};var hb=function(b){P.call(this,b);this._data="a5-10-12"};hb.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw".split(" ");hb.prototype=new P;hb.prototype.constructor=hb;hb.prototype.evalTelegram=function(b){b=P.prototype.evalTelegram.call(this,
b);if(0==Object.keys(b).length)return b;delete b.button;delete b.button_raw;return b};var ib=function(b){P.call(this,b);this._data="a5-10-13"};ib.STATES="humidity humidity_raw temperature temperature_raw button button_raw".split(" ");ib.prototype=new P;ib.prototype.constructor=ib;ib.prototype.evalTelegram=function(b){b=P.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};var jb=function(b){ra.call(this,b);this._data="a5-10-14"};
jb.STATES="humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");jb.prototype=new ra;jb.prototype.constructor=jb;jb.prototype.evalTelegram=function(b){b=ra.prototype.evalTelegram.call(this,b);if(0==Object.keys(b).length)return b;delete b.setpoint;delete b.setpoint_raw;return b};var Ia=function(b){q.call(this,b);this._data="a5-11-??"};Ia.prototype=new q;Ia.prototype.constructor=Ia;var kb=function(b){Ia.call(this,b);this._data="a5-11-03"};kb.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw".split(" ");
kb.prototype=new Ia;kb.prototype.constructor=kb;kb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.position=b;b=e&127;c.angle=2*(e>>7&1?0-b:b);e=d>>7&1;c.position_flag=e?!0:!1;c.position_flag_raw=e;e=d>>6&1;c.angle_flag=e?!0:!1;c.angle_flag_raw=e;e=d>>4&3;c.error_raw=e;switch(e){case 0:c.error="no_error";break;case 1:c.error="no_end_position";break;case 2:c.error=
"intern_failure"}e=d>>2&3;c.end_position_raw=e;switch(e){case 0:c.end_position="no_end_position";break;case 1:c.end_position="end_position_not_reach";break;case 2:c.end_position="fully_open";break;case 3:c.end_position="fully_closed"}d&=3;c.state_raw=d;switch(d){case 0:c.state="no_status";break;case 1:c.state="stopped";break;case 2:c.state="opens";break;case 3:c.state="closes"}c.service_mode=a>>7&1;c.position_mode=a>>6&1}}return c};var Ja=function(b){Ia.call(this,b);this._data="a5-11-04"};Ja.STATES=
"state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");Ja.prototype=new Ia;Ja.prototype.constructor=Ja;Ja.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.service_mode=a>>7&1;var f=a>>6&1;c.op_hour_flag=
f?!0:!1;c.op_hour_flag_raw=f;f=a>>4&3;c.error_raw=f;switch(f){case 0:c.error="no_error";break;case 1:c.error="lamp_failure";break;case 2:c.error="intern_failure";break;case 3:c.error="extern_failure"}f=a&1;c.state=f?"on":"off";c.state_raw=f;a=a>>1&3;c.mode_raw=a;switch(a){case 0:c.level=b;c.op_hour=e<<8|d;break;case 1:a=b.toString(16);2>a.length&&(a="0"+a);e=e.toString(16);2>e.length&&(e="0"+e);d=d.toString(16);2>d.length&&(d="0"+d);c.rgb=a.toUpperCase()+e.toUpperCase()+d.toUpperCase();break;case 2:c.power_raw=
b<<8|e,c.power_unit_raw=d,e="mW W kW MW Wh kWh MWh GWh mA 1/10A mV 1/10V".split(" "),3>=d?(c.power=c.power_raw,c.power_unit=e[d]):7>=d?(c.energy=c.power_raw,c.energy_unit=e[d]):9>=d?(c.current=c.power_raw,c.current_unit=e[d]):11>=d&&(c.voltage=c.power_raw,c.voltage_unit=e[d])}}}return c};var W=function(b){q.call(this,b);this._data="a5-12-??"};W.STATES="meter_raw channel_raw type_raw scale_raw scale meter current cumulative".split(" ");W.prototype=new q;W.prototype.constructor=W;W.prototype.evalTelegram=
function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt32BE(0);if(1==(a>>3&1)){b=b>>8&16777215;c.meter_raw=b;c.channel_raw=a>>4&15;var d=a>>2&1;c.type_raw=d;a&=3;c.scale_raw=a;switch(a){case 0:c.scale=1;c.meter=b;break;case 1:c.scale=.1;c.meter=.1*b;break;case 2:c.scale=.01;c.meter=.01*b;break;case 3:c.scale=.001,c.meter=.001*b}d?c.current=c.meter:c.cumulative=c.meter}}return c};var lb=function(b){W.call(this,b);this._data="a5-12-00"};lb.STATES=["current","counter",
"channel"];lb.prototype=new W;lb.prototype.constructor=lb;lb.prototype.evalTelegram=function(b){b=W.prototype.evalTelegram.call(this,b);b.counter=b.cumulative;b.channel=b.channel_raw;return b};var ba=function(b){W.call(this,b);this._data="a5-12-01"};ba.STATES=["power","energy","tariff"];ba.prototype=new W;ba.prototype.constructor=ba;ba.prototype.evalTelegram=function(b){b=W.prototype.evalTelegram.call(this,b);b.energy=b.cumulative;b.power=b.current;b.tariff=b.channel_raw;return b};var ya=function(b){W.call(this,
b);this._data="a5-12-02"};ya.STATES=["volume","flow","tariff"];ya.prototype=new W;ya.prototype.constructor=ya;ya.prototype.evalTelegram=function(b){b=W.prototype.evalTelegram.call(this,b);b.volume=b.cumulative;b.flow=b.current;b.tariff=b.channel_raw;return b};var jc=function(b){ya.call(this,b);this._data="a5-12-03"};jc.STATES=["volume","flow","tariff"];jc.prototype=new ya;jc.prototype.constructor=jc;var Q=function(b){q.call(this,b);this._data="a5-13-??"};Q.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
Q.prototype=new q;Q.prototype.constructor=Q;Q.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1),f=b.userData.readUInt8(0);if(1==(a>>3&1))switch(a>>4&15){case 1:c.lux=parseFloat((f/255*1E3).toFixed(1));c.lux_raw=f;var g=e;c.temperature=parseFloat((g/255*120-40).toFixed(1));c.temperature_raw=g;c.wind=parseFloat((d/255*70).toFixed(1));c.wind_raw=d;c.day_night=a>>2&1?"night":"day";c.rain=a>>1&1?"true":"false";
break;case 2:c.sun_west=parseFloat((f/255*150).toFixed(1));c.sun_west_raw=f;c.sun_south=parseFloat((e/255*150).toFixed(1));c.sun_south_raw=g;c.sun_east=parseFloat((d/255*150).toFixed(1));c.sun_east_raw=d;c.hemisphere=a>>2&1?"south":"north";break;case 3:c.day=f&15;c.month=e&7;c.year=(d&127)+2E3;c.date_src=a&1?"gps":"rtc";break;case 4:c.weekday=f>>5&7;c.hour=f&31;c.min=e&63;c.sec=d&63;c.time_format=a>>2&1?"12":"24";c.am_pm=a>>1&1?"pm":"am";c.time_src=a&1?"gps":"rtc";break;case 5:c.elv=f-90;c.elv_raw=
f;d=b.userData.readUInt16BE(1)&511;c.azm=d;c.azm_raw=d;break;case 6:b=(f>>4&15)<<8|e,d|=(f&15)<<8,c.latitude=parseFloat((b/4095*180-90).toFixed(1)),c.latitude_raw=b,c.longitude=parseFloat((d/4095*360-180).toFixed(1)),c.longitude_raw=d}}return c};var kc=function(b){Q.call(this,b);this._data="a5-13-01"};kc.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
kc.prototype=new Q;kc.prototype.constructor=kc;var lc=function(b){Q.call(this,b);this._data="a5-13-02"};lc.STATES="sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere".split(" ");lc.prototype=new Q;lc.prototype.constructor=lc;var mc=function(b){Q.call(this,b);this._data="a5-13-03"};mc.STATES=["day","month","year","date_src"];mc.prototype=new Q;mc.prototype.constructor=mc;var nc=function(b){Q.call(this,b);this._data="a5-13-04"};nc.STATES="weekday hour min sec time_format am_pm time_src".split(" ");
nc.prototype=new Q;nc.prototype.constructor=nc;var oc=function(b){Q.call(this,b);this._data="a5-13-05"};oc.STATES=["elv","azm"];oc.prototype=new Q;oc.prototype.constructor=oc;var pc=function(b){Q.call(this,b);this._data="a5-13-06"};pc.STATES=["latitude","longitude"];pc.prototype=new Q;pc.prototype.constructor=pc;var mb=function(b){f.call(this,b);this._data="a5-14-01"};mb.STATES=["voltage","voltage_raw","state"];mb.prototype=new f;mb.prototype.constructor=mb;mb.prototype.evalTelegram=function(b){var c=
{};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.voltage=b/250*5;c.voltage_raw=b;a&=1;switch(a){case 0:c.state="closed";break;case 1:c.state="open"}c.state_raw=a}}return c};var nb=function(b){f.call(this,b);this._data="a5-14-02"};nb.STATES=["voltage","voltage_raw","illumination","illumination_raw","state"];nb.prototype=new f;nb.prototype.constructor=nb;nb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(1);
b=b.userData.readUInt8(0);if(1==(a>>3&1))switch(c.voltage=b/250*5,c.voltage_raw=b,c.illumination=d/250*1E3,c.illumination_raw=d,a&=1,c.state_raw=a,a){case 0:c.state="closed";break;case 1:c.state="open"}}return c};var ob=function(b){f.call(this,b);this._data="a5-14-03"};ob.STATES=["voltage","voltage_raw","state","viberation"];ob.prototype=new f;ob.prototype.constructor=ob;ob.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>
3&1)){c.voltage=b/250*5;c.voltage_raw=b;switch(a&1){case 0:c.state="closed";break;case 1:c.state="open"}switch(a>>1&1){case 0:c.viberation=!1;break;case 1:c.viberation=!0}}}return c};var pb=function(b){f.call(this,b);this._data="a5-14-04"};pb.STATES="voltage voltage_raw illumination illumination_raw state viberation".split(" ");pb.prototype=new f;pb.prototype.constructor=pb;pb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(1);b=b.userData.readUInt8(0);
if(1==(a>>3&1)){c.voltage=b/250*5;c.voltage_raw=b;c.illumination=d/250*1E3;c.illumination_raw=d;switch(a&1){case 0:c.state="closed";break;case 1:c.state="open"}switch(a>>1&1){case 0:c.viberation=!1;break;case 1:c.viberation=!0}}}return c};var qb=function(b){f.call(this,b);this._data="a5-14-05"};qb.STATES=["voltage","voltage_raw","viberation"];qb.prototype=new f;qb.prototype.constructor=qb;qb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);
if(1==(a>>3&1))switch(c.voltage=b/250*5,c.voltage_raw=b,a>>1&1){case 0:c.viberation=!1;break;case 1:c.viberation=!0}}return c};var rb=function(b){f.call(this,b);this._data="a5-14-06"};rb.STATES=["voltage","voltage_raw","illumination","illumination_raw","viberation"];rb.prototype=new f;rb.prototype.constructor=rb;rb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1))switch(c.voltage=b/250*5,c.voltage_raw=
b,c.illumination=d/250*1E3,c.illumination_raw=d,a>>1&1){case 0:c.viberation=!1;break;case 1:c.viberation=!0}}return c};var sb=function(b){f.call(this,b);this._data="a5-14-07"};sb.STATES=["voltage","voltage_raw","state","lock"];sb.prototype=new f;sb.prototype.constructor=sb;sb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.voltage=b/250*5;c.voltage_raw=b;switch(a>>2&1){case 0:c.state="closed";break;case 1:c.state=
"open"}switch(a>>1&1){case 0:c.lock="locked";break;case 1:c.lock="unlocked"}}}return c};var tb=function(b){f.call(this,b);this._data="a5-14-08"};tb.STATES=["voltage","voltage_raw","state","lock","viberation"];tb.prototype=new f;tb.prototype.constructor=tb;tb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.voltage=b/250*5;c.voltage_raw=b;switch(a>>2&1){case 0:c.state="closed";break;case 1:c.state="open"}switch(a>>
1&1){case 0:c.lock="locked";break;case 1:c.lock="unlocked"}switch(a&1){case 0:c.viberation=!1;break;case 1:c.viberation=!0}}}return c};var ub=function(b){f.call(this,b);this._data="a5-14-09"};ub.STATES=["voltage","voltage_raw","state"];ub.prototype=new f;ub.prototype.constructor=ub;ub.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1))switch(c.voltage=b/250*5,c.voltage_raw=b,a>>1&3){case 0:c.state="closed";break;case 1:c.state=
"tilted";break;case 2:c.state="reserved";break;case 3:c.state="open"}}return c};var vb=function(b){f.call(this,b);this._data="a5-14-0a"};vb.STATES=["voltage","voltage_raw","state","viberation"];vb.prototype=new f;vb.prototype.constructor=vb;vb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.voltage=b/250*5;c.voltage_raw=b;switch(a>>1&3){case 0:c.state="closed";break;case 1:c.state="tilted";break;case 2:c.state="reserved";
break;case 3:c.state="open"}switch(a&1){case 0:c.viberation=!1;break;case 1:c.viberation=!0}}}return c};var Z=function(b){q.call(this,b);this._data="a5-20-04";this.TEACH_IN_VARIATION=3;this._defaultSetpoint=15;this._defaultWakeupCycle=3;this._defaultDisplay=0;this._states={pending:{value:!1,time:(new Date).getTime()}};this._service_command_new=this._button_lock_new=this._display_new=this._wakeup_cycle_new=this._measurement_new=this._setpoint_new=this._valve_new=null};Z.COMMANDS="setValve setTo up down measureOn measureOff setWakeup setDisplay buttonLock buttonUnlock openValve closeValve init".split(" ");
Z.STATES="valve measurement button_lock temperature_selection feed_temperature setpoint error temperature wakeup_cycle display pending".split(" ");Z.prototype=new q;Z.prototype.constructor=Z;Z.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.wakeup_cycle||null==this._params.wakeup_cycle)this._params.wakeup_cycle=this._defaultWakeupCycle;if("undefined"==typeof this._params.display||null==this._params.display)this._params.display=this._defaultDisplay};
Z.prototype.getStatesBuffer=function(){var b=JSON.parse(JSON.stringify(this._states));b.wakeup_cycle={value:this._params.wakeup_cycle,time:-1};b.display={value:this._params.display,time:-1};"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(b.wakeup_cycle={value:this._wakeup_cycle_new,time:-1});"undefined"!=typeof this._display_new&&null!=this._display_new&&(b.display={value:this._display_new,time:-1});"undefined"!=typeof this._valve_new&&null!=this._valve_new&&(b.valve={value:this._valve_new,
time:-1});"undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new&&(b.setpoint={value:this._setpoint_new,time:-1});"undefined"!=typeof this._measurement_new&&null!=this._measurement_new&&(b.measurement={value:this._measurement_new,time:-1});"undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new&&(b.button_lock={value:this._button_lock_new,time:-1});return b};Z.prototype.getCurrentStates=function(){var b={},c=this.getStatesBuffer(),a;for(a in c)c.hasOwnProperty(a)&&c[a]&&(b[a]=
c[a].value);return b};Z.prototype.executeCommand=function(b,c,a){var d=(new Date).getTime();if(c&&c.value){"setValve"==c.value.substr(0,8)&&8<c.value.length?(b=c.value.substr(8),c={value:"setValve",ext:b}):"setTo"==c.value.substr(0,5)&&5<c.value.length?(b=c.value.substr(5),c={value:"setTo",ext:b}):"up"==c.value.substr(0,2)&&2<c.value.length?(b=c.value.substr(2),c={value:"up",ext:b}):"down"==c.value.substr(0,4)&&4<c.value.length?(b=c.value.substr(4),c={value:"down",ext:b}):"setWakeup"==c.value.substr(0,
9)&&9<c.value.length?(b=c.value.substr(9),c={value:"setWakeup",ext:b}):"setDisplay"==c.value.substr(0,10)&&10<c.value.length&&(b=c.value.substr(10),c={value:"setDisplay",ext:b});var e=[];switch(c.value){case "setValve":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("set valve value invalid"));return}b=parseInt(c.ext);0>b&&(b=0);100<b&&(b=100);this._valve_new=b;this._states.pending={value:!0,time:d};c={key:"valve",value:b,changed:!1};d=this._states.valve?this._states.valve.value:null;d!=b&&
(c.oldvalue=d,c.changed=!0);e.push(c);break;case "setTo":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("set valve value invalid"));return}b=parseFloat(c.ext);10>b&&(b=10);30<b&&(b=30);this._setpoint_new=b;this._states.pending={value:!0,time:d};c={key:"setpoint",value:this._setpoint_new,changed:!1};d=this._states.setpoint?this._states.setpoint.value:null;d!=this._setpoint_new&&(c.oldvalue=d,c.changed=!0);e.push(c);break;case "up":(b=c.ext)||(b=.5);b=parseFloat(b);if("undefined"!=typeof this._setpoint_new&&
null!=this._setpoint_new)this._setpoint_new+=b;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value+b;else{a&&a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_new=10);30<this._setpoint_new&&(this._setpoint_new=30);this._states.pending={value:!0,time:d};c={key:"setpoint",value:this._setpoint_new,changed:!1};d=this._states.setpoint?this._states.setpoint.value:
null;d!=this._setpoint_new&&(c.oldvalue=d,c.changed=!0);e.push(c);break;case "down":(b=c.ext)||(b=.5);b=parseFloat(b);if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new-=b;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value-b;else{a&&a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_ne=10);30<this._setpoint_new&&
(this._setpoint_new=30);this._states.pending={value:!0,time:d};c={key:"setpoint",value:this._setpoint_new,changed:!1};d=this._states.setpoint?this._states.setpoint.value:null;d!=this._setpoint_new&&(c.oldvalue=d,c.changed=!0);e.push(c);break;case "measureOn":this._measurement_new="active";this._states.pending={value:!0,time:d};c={key:"measurement",value:this._measurement_new,changed:!1};d=this._states.measurement?this._states.measurement.value:null;d!=this._measurement_new&&(c.oldvalue=d,c.changed=
!0);e.push(c);break;case "measureOff":this._measurement_new="inactive";this._states.pending={value:!0,time:d};c={key:"measurement",value:this._measurement_new,changed:!1};d=this._states.measurement?this._states.measurement.value:null;d!=this._measurement_new&&(c.oldvalue=d,c.changed=!0);e.push(c);break;case "setWakeup":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("set wakup cycle value invalid"));return}this._wakeup_cycle_new=b=parseInt(c.ext);this._states.pending={value:!0,time:d};c={key:"wakeup_cycle",
value:this._wakeup_cycle_new,changed:!1};d=this._params.wakeup_cycle;d!=this._wakeup_cycle_new&&(c.oldvalue=d,c.changed=!0);e.push(c);break;case "setDisplay":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("set display orientation value invalid"));return}this._display_new=b=parseInt(c.ext);this._states.pending={value:!0,time:d};c={key:"display",value:this._display_new,changed:!1};d=this._params.display;d!=this._display_new&&(c.oldvalue=d,c.changed=!0);e.push(c);break;case "buttonLock":this._button_lock_new=
"locked";this._states.pending={value:!0,time:d};c={key:"button_lock",value:this._button_lock_new,changed:!1};d=this._states.button_lock?this._states.button_lock.value:null;d!=this._button_lock_new&&(c.oldvalue=d,c.changed=!0);e.push(c);break;case "buttonUnlock":this._button_lock_new="unlocked";this._states.pending={value:!0,time:d};c={key:"button_lock",value:this._button_lock_new,changed:!1};d=this._states.button_lock?this._states.button_lock.value:null;d!=this._button_lock_new&&(c.oldvalue=d,c.changed=
!0);e.push(c);break;case "openValve":this._service_command_new=1;this._states.pending={value:!0,time:d};break;case "closeValve":this._service_command_new=3;this._states.pending={value:!0,time:d};break;case "init":this._service_command_new=2,this._states.pending={value:!0,time:d}}0<e.length&&require("x.hub.m.enocean.js")._onEOEvents(this,e);a&&a()}else a&&a(Error("command invalid"))};Z.prototype.evalData=function(b,c,a){if(c=this.evalTelegram(c)){var d=this;this._sendResponse(b,c,function(b,c){b=d.checkStateChange(c);
a&&a(null,b)})}else a&&a(Error("data format invalid"))};Z.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1)){c.valve=b;c.measurement=a>>7&1?"inactive":"active";c.button_lock=a>>2&1?"locked":"unlocked";b=a>>1&1;a&=1;c.temperature_selection=b?"setpoint":"feed_temperature";switch(b){case 0:c.feed_temperature=parseFloat((e/255*60+20).toFixed(1));break;case 1:c.setpoint=
parseFloat((e/255*20+10).toFixed(1))}if(0==a)c.error="no_error",c.temperature=parseFloat((d/255*20+10).toFixed(1));else switch(d){case 17:c.error="measurement_error";break;case 18:c.error="battery_empty";break;case 20:c.error="frost_protection";break;case 33:c.error="blocked_valve";break;case 36:c.error="end_point_detection_error";break;case 40:c.error="no_valve";break;case 49:c.error="not_taught_in";break;case 53:c.error="no_response_from_controller";break;case 54:c.error="teach_in_error";break;
default:c.error="unknow_error"}}}return c};Z.prototype._sendResponse=function(b,c,a){var d=(new Date).getTime(),e=JSON.parse(JSON.stringify(c));this._states.pending={value:!1,time:d};var f=!1;if("undefined"!=typeof this._valve_new&&null!=this._valve_new){var r=this._valve_new;this._states.valve={value:this._valve_new,time:d};this._valve_new=null;delete e.valve}else r="undefined"!=typeof c.valve&&null!=c.valve?c.valve:this._states.valve?this._states.valve.value:null;if("undefined"==typeof r||null==
r)r=0,e.valve=0;if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new){var g=Math.round((this._setpoint_new-10)/20*255);this._states.setpoint={value:this._setpoint_new,time:d};this._setpoint_new=null;delete e.setpoint}else"undefined"!=typeof c.setpoint&&null!=c.setpoint?g=Math.round((c.setpoint-10)/20*255):this._states.setpoint&&"undefined"!=this._states.setpoint.value&&null!=this._states.setpoint.value&&(g=Math.round((this._states.setpoint.value-10)/20*255));if("undefined"==typeof g||
null==g)g=this._defaultSetpoint,g=Math.round((g-10)/20*255),e.setpoint=this._defaultSetpoint;if("undefined"!=typeof this._measurement_new&&null!=this._measurement_new){var h="active"==this._measurement_new?0:1;this._states.measurement={value:this._measurement_new,time:d};this._measurement_new=null;delete e.measurement}else"undefined"!=typeof c.measurement&&null!=c.measurement?h="active"==c.measurement?0:1:this._states.measurement&&"undefined"!=this._states.measurement.value&&null!=this._states.measurement.value&&
(h="active"==this._states.measurement.value?0:1);if("undefined"==typeof h||null==h)h=0,e.measurement="active";var k=this._params.wakeup_cycle;"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(k=this._wakeup_cycle_new,this._params.wakeup_cycle=this._wakeup_cycle_new,f=!0,this._wakeup_cycle_new=null);if("undefined"==typeof k||null==k)k=this._defaultWakeupCycle,this._params.wakeup_cycle=k;var m=this._params.display;"undefined"!=typeof this._display_new&&null!=this._display_new&&
(m=this._display_new,this._params.display=this._display_new,f=!0,this._display_new=null);if("undefined"==typeof m||null==m)m=this._defaultDisplay,this._params.display=m;if("undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new){var l="locked"==this._button_lock_new?1:0;this._states.button_lock={value:this._button_lock_new,time:d};this._button_lock_new=null;delete e.button_lock}else"undefined"!=typeof c.button_lock&&null!=c.button_lock?l="locked"==c.button_lock?1:0:this._states.button_lock&&
this._states.button_lock.value&&(l="locked"==this._states.button_lock.value?1:0);if("undefined"==typeof l||null==l)l=0,e.button_lock="unlocked";c=0;"undefined"!=typeof this._service_command_new&&null!=this._service_command_new&&(c=this._service_command_new,this._service_command_new=null);r=new Buffer([r,g,(h&1)<<6|k&63,(m&3)<<4|8|(l&1)<<2|c&3]);f&&require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated();f=this._senderID;f||(f=x.hub.m.enocean.SENDER_ID);f=new x.hub.m.enocean.ESP3.Telegram.ADT(165,
r,this._address,f,0);b.sendTelegram(f,!0,function(b){a&&a(b,e)})};var Ka=function(b){q.call(this,b);this._data="a5-30-??"};Ka.prototype=new q;Ka.prototype.constructor=Ka;var wb=function(b){f.call(this,b);this._data="a5-30-01"};wb.STATES=["battery_low","battery_raw","state","state_raw"];wb.prototype=new Ka;wb.prototype.constructor=wb;wb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2);b=b.userData.readUInt8(1);1==(a>>3&1)&&(c.battery_low=
120>=b?!0:!1,c.battery_raw=b,c.state=195>=d?"closed":"open",c.state_raw=d)}return c};var xb=function(b){f.call(this,b);this._data="a5-30-01\u00b4"};xb.STATES=["state"];xb.prototype=new Ka;xb.prototype.constructor=xb;xb.prototype.evalTelegram=function(b){var c={};165==b.rorg&&(b=b.userData.readUInt8(3),1==(b>>3&1)&&(c.state=b&1?"open":"closed"));return c};var yb=function(b){f.call(this,b);this._data="a5-30-03"};yb.STATES="temperature temperature_raw wake input3 input2 input1 input0".split(" ");yb.prototype=
new Ka;yb.prototype.constructor=yb;yb.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2);b=b.userData.readUInt8(1);1==(a>>3&1)&&(c.temperature=(255-b)/255*40,c.temperature_raw=b,c.wake=d>>4&1,c.input3=d>>3&1,c.input2=d>>2&1,c.input1=d>>1&1,c.input0=d&1)}return c};var zb=function(b){f.call(this,b);this._data="a5-30-04"};zb.STATES=["analog_input","input2","input1","input0"];zb.prototype=new Ka;zb.prototype.constructor=zb;zb.prototype.evalTelegram=
function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3);b=b.userData.readUInt8(2);1==(a>>3&1)&&(c.analog_input=b,c.input2=a>>2&1,c.input1=a>>1&1,c.input0=a&1)}return c};var qc=function(b){q.call(this,b);this._data="a5-38-??"};qc.prototype=new q;qc.prototype.constructor=qc;var S=function(b){qc.call(this,b);this._data="a5-38-08"};S.prototype=new qc;S.prototype.constructor=S;S.prototype.evalTelegram=function(b){var c={};if(165==b.rorg){var a=b.userData.readUInt8(3),d=b.userData.readUInt8(2),
e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(a>>3&1))switch(b){case 2:c.level=Math.round(e/255*100),c.ramp=d,c.dim_range=a>>2&1?"relative":"absolute",c.store_final_value=a>>1&1,c.state=a&1?"on":"off"}}return c};S.prototype.switching=function(b,c,a){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);c=new Buffer([1,c.TIM>>8&255,c.TIM&255,8|(c.LCK&1)<<2|(c.DEL&1)<<1|c.SW&1]);d=new x.hub.m.enocean.ESP3.Telegram.BS4(c,d,0);d.setDstId(this._address);b.sendTelegram(d,!0,function(b){a&&
a(b)})};S.prototype.dimming=function(b,c,a){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);c=new Buffer([2,c.EDIM,c.RMP,8|(c.EDIMR&1)<<2|(c.STR&1)<<1|c.SW&1]);d=new x.hub.m.enocean.ESP3.Telegram.BS4(c,d,0);d.setDstId(this._address);b.sendTelegram(d,!0,function(b){a&&a(b)})};S.prototype.blind=function(b,c,a){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);c=new Buffer([7,c.P1,c.P2,(c.FUNC&15)<<4|8|(c.SSF&1)<<2|(c.PAF&1)<<1|c.SMF&1]);d=new x.hub.m.enocean.ESP3.Telegram.BS4(c,
d,0);d.setDstId(this._address);b.sendTelegram(d,!0,function(b){a&&a(b)})};var rc=function(b){q.call(this,b);this._data="a5-3F-7F"};rc.prototype=new q;rc.prototype.constructor=rc;var X=function(b){f.call(this,b);this._data="d2-??-??";this.UNIQUE_GATEWAY_SENDERID=!0};X.prototype=new f;X.prototype.constructor=X;var D=function(b){X.call(this,b);this._data="d2-01-??";this._lastQuery={};this._initCount=0};D.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");
D.prototype=new X;D.prototype.constructor=D;D.prototype.init=function(b){var c=this.getIOs();if(0<c.length){var a=require("x.hub.m.enocean.js")._esp3,d=0,e=this,f=function(){d++;d<c.length?e.statusQuery(a,{IO:c[d]},f):b&&b()};this.statusQuery(a,{IO:c[d]},f)}else b&&b()};D.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length?(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):
this._initCount=0;return this._states};D.prototype.getIOs=function(){return[]};D.prototype.setOutput=function(b,c,a){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);c=new Buffer([1,(c.DV&7)<<5|c.IO&31,c.OV&127]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(c,d,0);this._senderID!=this._address&&d.setDstId(this._address);b.sendTelegram(d,!0,function(b){a&&a(b)})};D.prototype.setLocal=function(b,c,a){c=new Buffer([(c.DE&1)<<7|2,(c.OC&1)<<7|(c.RO&1)<<6|(c.LC&1)<<5|c.IO&31,(c.DT2&15)<<4|
c.DT3&15,(c.DN&1)<<7|(c.PF&1)<<6|(c.DS&3)<<4|c.DT1&15]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(c,x.hub.m.enocean.SENDER_ID,0);c.setDstId(this._address);b.sendTelegram(c,!0,function(b){a&&a(b)})};D.prototype.statusQuery=function(b,c,a){this._senderID?(this._lastQuery[c.IO]=(new Date).getTime(),c=new Buffer([3,c.IO&31]),c=new x.hub.m.enocean.ESP3.Telegram.VLD(c,this._senderID,0),c.setDstId(this._address),b.sendTelegram(c,!0,function(b){a&&a(b)})):a&&a(Error("no senderID"))};D.prototype.measurementQuery=
function(b,c,a){c=new Buffer([6,(c.QU&1)<<5|c.IO&31]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(c,this._senderID,0);c.setDstId(this._address);b.sendTelegram(c,!0,function(b){a&&a(b)})};D.prototype.evalTelegram=function(b){var c={};if(210==b.rorg){var a=b.userData.readUInt8(0);switch(a&15){case 4:if(3==b.userData.length){var d=a>>7&1,e=a>>6&1;a=b.userData.readUInt8(1);var f=a>>7&1,g=a>>5&3,h=a&31;a=b.userData.readUInt8(2);b=a&127;c.power_failure_detection=d?!0:!1;c.power_failure=e?!0:!1;c.over_current_switch_off=
f;c.error_level=g;c.io_channel=h;c.local_control=a>>7&1?!0:!1;c.output_value=b;c.output_state=b?"on":"off"}break;case 7:if(6==b.userData.length){a=b.userData.readUInt8(1);d=a>>5&7;h=a&31;a=b.userData.readUInt32BE(2);switch(d){case 0:c.unit="Ws";break;case 1:c.unit="Wh";break;case 2:c.unit="KWh";break;case 3:c.unit="W";break;case 4:c.unit="KW"}c.io_channel=h;c.value=a}}}return c};var ca=function(b){D.call(this,b);this._data="d2-01-00"};ca.COMMANDS=["on","off","toggle"];ca.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");
ca.prototype=new D;ca.prototype.constructor=ca;ca.prototype.getIOs=function(){return[0]};ca.prototype.executeCommand=function(b,c,a){if(c&&c.value){var d=this;switch(c.value){case "on":this.activeStateChange({output_value:100,output_state:"on"});this.setOutput(b,{DV:0,IO:0,OV:100},a);break;case "off":this.activeStateChange({output_value:0,output_state:"off"});this.setOutput(b,{DV:0,IO:0,OV:0},a);break;case "toggle":this._states.output_state?this.executeCommand(b,{value:"on"==this._states.output_state.value?
"off":"on"},a):this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(b,c,a):a&&a(Error("unkown current status"))},200)})}}else a&&a(Error("command invalid"))};var Ab=function(b){ca.call(this,b);this._data="d2-01-01"};Ab.COMMANDS=["on","off","toggle"];Ab.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");Ab.prototype=new ca;Ab.prototype.constructor=Ab;var Bb=function(b){ca.call(this,
b);this._data="d2-01-03";this._lastOnLevel=-1};Bb.prototype=new ca;Bb.prototype.constructor=Bb;Bb.prototype.evalData=function(b,c,a){(b=this.evalTelegram(c))?((0==b.output_value||"off"==b.output_state)&&this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value),b=this.checkStateChange(b),a&&a(null,b)):a&&a(Error("data format invalid"))};Bb.prototype.executeCommand=function(b,c,a){if(c&&c.value){if("dimTo"==c.value.substr(0,5)&&5<c.value.length){var d=
c.value.substr(5);c={value:"dimTo",ext:d}}else"toggleTo"==c.value.substr(0,8)&&8<c.value.length&&(d=c.value.substr(8),c={value:"toggleTo",ext:d});(new Date).getTime();var e=this;switch(c.value){case "on":d=this._lastOnLevel;if(-1==d||0==d)d=100;this.setOutput(b,{DV:0,IO:0,OV:d},function(b){b||e.activeStateChange({output_value:d,output_state:"on"});a&&a(b)});break;case "off":this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value);this.setOutput(b,
{DV:0,IO:0,OV:0},function(b){b||e.activeStateChange({output_value:0,output_state:"off"});a&&a(b)});break;case "toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(b,c,a):a&&a(Error("unkown current status"))},200)});break}this.executeCommand(b,{value:"on"==this._states.output_state.value?"off":"on"},a);break;case "toggleTo":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(b,
c,a):a&&a(Error("unkown current status"))},200)});break}"on"==this._states.output_state.value?this.executeCommand(b,{value:"off"},a):this.executeCommand(b,{value:"dimTo",ext:c.ext},a);break;case "dimTo":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("dim to value invalid"));break}d=parseFloat(c.ext);0>d&&(d=0);100<d&&(d=100);this.setOutput(b,{DV:0,IO:0,OV:d},function(b){b||e.activeStateChange({output_value:d,output_state:0==d?"off":"on"});a&&a(b)});break;case "dimUp":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?
e.executeCommand(b,c,a):a&&a(Error("unkown current status"))},200)});break}d=parseInt(this._states.output_value.value);d+=5;100<d&&(d=100);this.executeCommand(b,{value:"dimTo",ext:d},a);break;case "dimDown":if(!this._states.output_state){this.init(function(){setTimeout(function(){e._states.output_state?e.executeCommand(b,c,a):a&&a(Error("unkown current status"))},200)});break}d=parseInt(this._states.output_value.value);d-=5;0>d&&(d=0);this.executeCommand(b,{value:"dimTo",ext:d},a);break;default:a&&
a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var sa=function(b){D.call(this,b);this._data="d2-01-11"};sa.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle".split(" ");sa.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state".split(" ");sa.prototype=new D;sa.prototype.constructor=sa;sa.prototype.getIOs=function(){return[0,1]};sa.prototype.evalTelegram=
function(b){if(b=D.prototype.evalTelegram.call(this,b))switch(b.io_channel){case 0:b.ch1_output_value=b.output_value;b.ch1_output_state=b.output_state;break;case 1:b.ch2_output_value=b.output_value,b.ch2_output_state=b.output_state}return b};sa.prototype.executeCommand=function(b,c,a){if(c&&c.value){var d=this;switch(c.value){case "ch1On":this.activeStateChange({ch1_output_value:100,ch1_output_state:"on"});this.setOutput(b,{DV:0,IO:0,OV:100},a);break;case "ch1Off":this.activeStateChange({ch1_output_value:0,
ch1_output_state:"off"});this.setOutput(b,{DV:0,IO:0,OV:0},a);break;case "ch1Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(b,c,a):a&&a(Error("unkown current status"))},200)});break}var e="on"==this._states.ch1_output_state.value?"off":"on";this.activeStateChange({ch1_output_value:"on"==e?100:0,ch1_output_state:e});this.executeCommand(b,{value:"on"==e?"ch1On":"ch1Off"},a);break;case "ch2On":this.activeStateChange({ch2_output_value:100,
ch2_output_state:"on"});this.setOutput(b,{DV:0,IO:1,OV:100},a);break;case "ch2Off":this.activeStateChange({ch2_output_value:0,ch2_output_state:"off"});this.setOutput(b,{DV:0,IO:1,OV:0},a);break;case "ch2Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(b,c,a):a&&a(Error("unkown current status"))},200)});break}e="on"==this._states.ch2_output_state.value?"off":"on";this.activeStateChange({ch2_output_value:"on"==e?100:0,ch2_output_state:e});
this.executeCommand(b,{value:"on"==e?"ch2On":"ch2Off"},a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var ha=function(b){D.call(this,b);this._data="d2-01-13";this._queryInterval=3E4};ha.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle".split(" ");ha.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state".split(" ");
ha.prototype=new D;ha.prototype.constructor=ha;ha.prototype.getStatesBuffer=function(){var b=[];this._states.ch1_output_state||(!this._lastQuery[0]||now-this._lastQuery[0]>this._queryInterval)&&b.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||now-this._lastQuery[1]>this._queryInterval)&&b.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||now-this._lastQuery[2]>this._queryInterval)&&b.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||now-this._lastQuery[3]>this._queryInterval)&&
b.push(3);0<b.length&&this._queryStates(b);return this._states};ha.prototype._queryStates=function(b,c){var a=require("x.hub.m.enocean.js")._esp3,d=0,e=this,f=function(){d++;d<b.length?e.statusQuery(a,{IO:b[d]},f):c&&c()};this.statusQuery(a,{IO:b[d]},f)};ha.prototype.getIOs=function(){return[0,1,2,3]};ha.prototype.evalTelegram=function(b){if(b=D.prototype.evalTelegram.call(this,b))switch(b.io_channel){case 0:b.ch1_output_value=b.output_value;b.ch1_output_state=b.output_state;break;case 1:b.ch2_output_value=
b.output_value;b.ch2_output_state=b.output_state;break;case 2:b.ch3_output_value=b.output_value;b.ch3_output_state=b.output_state;break;case 3:b.ch4_output_value=b.output_value,b.ch4_output_state=b.output_state}return b};ha.prototype.executeCommand=function(b,c,a){if(c&&c.value){var d=this;switch(c.value?c.value.substr(0,3):null){case "ch1":var e=0;var f="ch1_output_value";var g="ch1_output_state";break;case "ch2":e=1;f="ch2_output_value";g="ch2_output_state";break;case "ch3":e=2;f="ch3_output_value";
g="ch3_output_state";break;case "ch4":e=3,f="ch4_output_value",g="ch4_output_state"}switch(c.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":var r={};r[f]=100;r[g]="on";var h={DV:0,IO:e,OV:100};this.activeStateChange(r);this.setOutput(b,h,a);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":r={};r[f]=0;r[g]="off";h={DV:0,IO:e,OV:0};this.activeStateChange(r);this.setOutput(b,h,a);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?
d.executeCommand(b,c,a):a&&a(Error("unkown current status"))},200)});break}if(!this._states[g]){a&&a(Error("state unknown"));break}h="on"==this._states[g].value?"off":"on";r={};r[f]="on"==h?100:0;r[g]=h;h={DV:0,IO:e,OV:"on"==h?100:0};this.activeStateChange(r);this.setOutput(b,h,a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var ia=function(b){D.call(this,b);this._data="d2-01-14";this._queryInterval=3E4};ia.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle ch5On ch5Off ch5Toggle ch6On ch6Off ch6Toggle ch7On ch7Off ch7Toggle ch8On ch8Off ch8Toggle".split(" ");
ia.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state ch5_output_value ch5_output_state ch6_output_value ch6_output_state ch7_output_value ch7_output_state ch8_output_value ch8_output_state".split(" ");ia.prototype=new D;ia.prototype.constructor=ia;ia.prototype._queryStates=function(b,
c){var a=require("x.hub.m.enocean.js")._esp3,d=0,e=this,f=function(){d++;d<b.length?e.statusQuery(a,{IO:b[d]},f):c&&c()};this.statusQuery(a,{IO:b[d]},f)};ia.prototype.getStatesBuffer=function(){var b=(new Date).getTime(),c=[];this._states.ch1_output_state||(!this._lastQuery[0]||b-this._lastQuery[0]>this._queryInterval)&&c.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||b-this._lastQuery[1]>this._queryInterval)&&c.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||b-this._lastQuery[2]>
this._queryInterval)&&c.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||b-this._lastQuery[3]>this._queryInterval)&&c.push(3);this._states.ch5_output_state||(!this._lastQuery[4]||b-this._lastQuery[4]>this._queryInterval)&&c.push(4);this._states.ch6_output_state||(!this._lastQuery[5]||b-this._lastQuery[5]>this._queryInterval)&&c.push(5);this._states.ch7_output_state||(!this._lastQuery[6]||b-this._lastQuery[6]>this._queryInterval)&&c.push(6);this._states.ch8_output_state||(!this._lastQuery[7]||
b-this._lastQuery[7]>this._queryInterval)&&c.push(7);0<c.length&&this._queryStates(c);return this._states};ia.prototype.getIOs=function(){return[0,1,2,3,4,5,6,7]};ia.prototype.evalTelegram=function(b){if(b=D.prototype.evalTelegram.call(this,b))switch(b.io_channel){case 0:b.ch1_output_value=b.output_value;b.ch1_output_state=b.output_state;break;case 1:b.ch2_output_value=b.output_value;b.ch2_output_state=b.output_state;break;case 2:b.ch3_output_value=b.output_value;b.ch3_output_state=b.output_state;
break;case 3:b.ch4_output_value=b.output_value;b.ch4_output_state=b.output_state;break;case 4:b.ch5_output_value=b.output_value;b.ch5_output_state=b.output_state;break;case 5:b.ch6_output_value=b.output_value;b.ch6_output_state=b.output_state;break;case 6:b.ch7_output_value=b.output_value;b.ch7_output_state=b.output_state;break;case 7:b.ch8_output_value=b.output_value,b.ch8_output_state=b.output_state}return b};ia.prototype.executeCommand=function(b,c,a){if(c&&c.value){var d=this;switch(c.value?c.value.substr(0,
3):null){case "ch1":var e=0;var f="ch1_output_value";var g="ch1_output_state";break;case "ch2":e=1;f="ch2_output_value";g="ch2_output_state";break;case "ch3":e=2;f="ch3_output_value";g="ch3_output_state";break;case "ch4":e=3;f="ch4_output_value";g="ch4_output_state";break;case "ch5":e=4;f="ch5_output_value";g="ch5_output_state";break;case "ch6":e=5;f="ch6_output_value";g="ch6_output_state";break;case "ch7":e=6;f="ch7_output_value";g="ch7_output_state";break;case "ch8":e=7,f="ch8_output_value",g="ch8_output_state"}switch(c.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":case "ch5On":case "ch6On":case "ch7On":case "ch8On":var r=
{};r[f]=100;r[g]="on";var h={DV:0,IO:e,OV:100};this.activeStateChange(r);this.setOutput(b,h,a);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":case "ch5Off":case "ch6Off":case "ch7Off":case "ch8Off":r={};r[f]=0;r[g]="off";h={DV:0,IO:e,OV:0};this.activeStateChange(r);this.setOutput(b,h,a);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":case "ch5Toggle":case "ch6Toggle":case "ch7Toggle":case "ch8Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?
d.executeCommand(b,c,a):a&&a(Error("unkown current status"))},200)});break}if(!this._states[g]){a&&a(Error("state unknown"));break}h="on"==this._states[g].value?"off":"on";r={};r[f]="on"==h?100:0;r[g]=h;h={DV:0,IO:e,OV:"on"==h?100:0};this.activeStateChange(r);this.setOutput(b,h,a);break;default:a&&a(Error("unknown command"))}}else a&&a(Error("command invalid"))};var sc=function(b){X.call(this,b);this._data="d2-05-??"};sc.prototype=new X;sc.prototype.constructor=sc;var O=function(b){sc.call(this,b);
this._data="d2-05-00"};O.COMMANDS="moveUp moveDown moveTo stepUp stepDown lamellaUp lamellaDown lamellaTo stop setRunTime setRotationTime setParams[15.2s]:[10,20,30ms]:[0-3]".split(" ");O.STATES=["state","angle","lock","channel"];O.prototype=new sc;O.prototype.constructor=O;O.prototype.init=function(b){var c=require("x.hub.m.enocean.js")._esp3;this.query(c,{CHN:0},b)};O.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length&&this.init();return this._states};O.prototype.goToPositionAngle=
function(b,c,a){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);c=new Buffer([c.POS&127,c.ANG&127,(c.REPO&7)<<4|c.LOCK&7,(c.CHN&15)<<4|1]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(c,d,0);d.setDstId(this._address);b.sendTelegram(d,!0,function(b){a&&a(b)})};O.prototype.stop=function(b,c,a){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);c=new Buffer([(c.CHN&15)<<4|2]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(c,d,0);d.setDstId(this._address);b.sendTelegram(d,!0,function(b){a&&
a(b)})};O.prototype.query=function(b,c,a){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);c=new Buffer([(c.CHN&15)<<4|3]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(c,d,0);d.setDstId(this._address);b.sendTelegram(d,!0,function(b){a&&a(b)})};O.prototype.setParameters=function(b,c,a){var d=this._senderID;this._senderID||(d=x.hub.m.enocean.SENDER_ID);c=new Buffer([c.VERT>>8&127,c.VERT&255,c.ROT&255,c.AA&7,(c.CHN&15)<<4|5]);d=new x.hub.m.enocean.ESP3.Telegram.VLD(c,d,0);d.setDstId(this._address);
b.sendTelegram(d,!0,function(b){a&&a(b)})};O.prototype.evalTelegram=function(b){var c={};if(210==b.rorg)switch(b.userData.readUInt8(b.userData.length-1)&15){case 4:if(4==b.userData.length){var a=b.userData.readUInt8(0);c.state=a&127;a=b.userData.readUInt8(1);c.angle=a&127;a=b.userData.readUInt8(2);switch(a&7){case 0:c.lock="normal";break;case 1:c.lock="blockage_mode";break;case 2:c.lock="alarm_mode"}a=b.userData.readUInt8(3);c.channel=a>>4&15}}return c};O.prototype.executeCommand=function(b,c,a){if(c&&
c.value){if("moveTo"==c.value.substr(0,6)&&6<c.value.length){var d=c.value.substr(6);c={value:"moveTo",ext:d}}else"lamellaTo"==c.value.substr(0,9)&&9<c.value.length?(d=c.value.substr(9),c={value:"lamellaTo",ext:d}):"setRunTime"==c.value.substr(0,10)&&10<c.value.length?(d=c.value.substr(10),c={value:"setRunTime",ext:d}):"setRotationTime"==c.value.substr(0,15)&&15<c.value.length?(d=c.value.substr(15),c={value:"setRotationTime",ext:d}):"setParams"==c.value.substr(0,9)&&9<c.value.length&&(d=c.value.substr(9),
c={value:"setParams",ext:d});var e=(new Date).getTime(),f=this;switch(c.value){case "moveUp":this.goToPositionAngle(b,{POS:0,ANG:0,REPO:0,LOCK:0,CHN:0},a);break;case "moveDown":this.goToPositionAngle(b,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:0},a);break;case "moveTo":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("move to value invalid"));break}d=parseFloat(c.ext);0>d&&(d=0);100<d&&(d=100);this._states.state={value:d,time:e};this.goToPositionAngle(b,{POS:d,ANG:255,REPO:0,LOCK:0,CHN:0},a);break;
case "stepUp":if(!this._states.state){this.init(function(){setTimeout(function(){f._states.state?f.executeCommand(b,c,a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){a&&a(Error("device status unknonw"));break}0!=this._states.angle.value?(d=this._states.angle.value-10,0>d&&(d=0),this._states.angle={value:d,time:e},this.goToPositionAngle(b,{POS:255,ANG:d,REPO:0,LOCK:0,CHN:0},a)):(d=this._states.state.value-5,0>d&&(d=0),this._states.state=
{value:d,time:e},this.goToPositionAngle(b,{POS:d,ANG:0,REPO:0,LOCK:0,CHN:0},a));break;case "stepDown":if(!this._states.state){this.init(function(){setTimeout(function(){f._states.state?f.executeCommand(b,c,a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){a&&a(Error("device status unknonw"));break}100!=this._states.angle.value?(d=this._states.angle.value+10,100<d&&(d=100),this._states.angle={value:d,time:e},this.goToPositionAngle(b,
{POS:255,ANG:d,REPO:0,LOCK:0,CHN:0},a)):(d=this._states.state.value+5,100<d&&(d=100),this._states.state={value:d,time:e},this.goToPositionAngle(b,{POS:d,ANG:100,REPO:0,LOCK:0,CHN:0},a));break;case "lamellaUp":this.goToPositionAngle(b,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:0},a);break;case "lamellaDown":this.goToPositionAngle(b,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:0},a);break;case "lamellaTo":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("lamella to value invalid"));break}d=parseFloat(c.ext);0>d&&
(d=0);100<d&&(d=100);this._states.angle={value:d,time:e};this.goToPositionAngle(b,{POS:255,ANG:d,REPO:0,LOCK:0,CHN:0},a);break;case "stop":this.stop(b,{CHN:0},a);break;case "setRunTime":if(!c.ext){a&&a(Error("parameters is null"));break}d=100*parseFloat(c.ext);499>=d&&(d=500);this.setParameters(b,{VERT:d,ROT:255,AA:7,CHN:0},a);break;case "setRotationTime":if(!c.ext){a&&a(Error("parameters is null"));break}d=32767;e=parseInt(c.ext)/10;this.setParameters(b,{VERT:d,ROT:e,AA:7,CHN:0},a);break;case "setParams":if(!c.ext){a&&
a(Error("parameters is null"));break}var g=c.ext.split(":");if(3!=g.length){a&&a(Error("parameters format invalid"));break}d=g[0]?100*parseFloat(g[0]):32767;499>=d&&(d=32767);e=g[1]?parseInt(g[1])/10:255;g=g[2]?parseInt(g[2]):7;this.setParameters(b,{VERT:d,ROT:e,AA:g,CHN:0},a);break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var na=function(b){O.call(this,b);this._data="d2-05-01";this._ch1QueryCount=0;this._ch1QueryTO=null;this._ch1QueryTimestamp=0};na.COMMANDS="ch1moveUp ch1moveDown ch1moveTo ch1stepUp ch1stepDown ch1lamellaUp ch1lamellaDown ch1lamellaTo ch1stop ch2moveUp ch2moveDown ch2moveTo ch2stepUp ch2stepDown ch2lamellaUp ch2lamellaDown ch2lamellaTo ch2stop ch3moveUp ch3moveDown ch3moveTo ch3stepUp ch3stepDown ch3lamellaUp ch3lamellaDown ch3lamellaTo ch3stop ch4moveUp ch4moveDown ch4moveTo ch4stepUp ch4stepDown ch4lamellaUp ch4lamellaDown ch4lamellaTo ch4stop ch1setRunTime ch2setRunTime ch3setRunTime ch4setRunTime ch1setRotationTime ch2setRotationTime ch3setRotationTime ch4setRotationTime ch1setParams[15.2s]:[10,20,30ms]:[0-3] ch2setParams ch3setParams ch4setParams".split(" ");
na.STATES="ch1state ch1angle ch1lock ch2state ch2angle ch2lock ch3state ch3angle ch3lock ch4state ch4angle ch4lock channel".split(" ");na.prototype=new O;na.prototype.constructor=na;na.prototype.init=function(b){this._queryStates([0,1,2,3],b)};O.prototype.getStatesBuffer=function(){var b=[];this._states.ch1state||b.push(0);this._states.ch2state||b.push(1);this._states.ch3state||b.push(2);this._states.ch4state||b.push(3);0<b.length&&this._queryStates(b);return this._states};na.prototype._queryStates=
function(b,c){var a=require("x.hub.m.enocean.js")._esp3,d=0,e=this,f=function(){d++;d<b.length?e.query(a,{CHN:b[d]},f):c&&c()};this.query(a,{CHN:b[d]},f)};na.prototype.evalTelegram=function(b){if(b=O.prototype.evalTelegram.call(this,b))switch(b.channel){case 0:b.ch1state=b.state;b.ch1angle=b.angle;b.ch1lock=b.lock;break;case 1:b.ch2state=b.state;b.ch2angle=b.angle;b.ch2lock=b.lock;break;case 2:b.ch3state=b.state;b.ch3angle=b.angle;b.ch3lock=b.lock;break;case 3:b.ch4state=b.state,b.ch4angle=b.angle,
b.ch4lock=b.lock}return b};na.prototype.executeCommand=function(b,c,a){if(c&&c.value){c=JSON.parse(JSON.stringify(c));var d=null;switch(c.value.substr(0,3)){case "ch1":d=0;var e="ch1state";var f="ch1angle";break;case "ch2":d=1;e="ch2state";f="ch2angle";break;case "ch3":d=2;e="ch3state";f="ch3angle";break;case "ch4":d=3;e="ch4state";f="ch4angle";break;default:a&&a(Error("unknown command"))}c.value=c.value.substr(3);if("moveTo"==c.value.substr(0,6)&&6<c.value.length){var g=c.value.substr(6);c={value:"moveTo",
ext:g}}else"lamellaTo"==c.value.substr(0,9)&&9<c.value.length?(g=c.value.substr(9),c={value:"lamellaTo",ext:g}):"setRunTime"==c.value.substr(0,10)&&10<c.value.length?(g=c.value.substr(10),c={value:"setRunTime",ext:g}):"setRotationTime"==c.value.substr(0,15)&&15<c.value.length?(g=c.value.substr(15),c={value:"setRotationTime",ext:g}):"setParams"==c.value.substr(0,9)&&9<c.value.length&&(g=c.value.substr(9),c={value:"setParams",ext:g});(new Date).getTime();var r=this;switch(c.value){case "moveUp":this.goToPositionAngle(b,
{POS:0,ANG:0,REPO:0,LOCK:0,CHN:d},a);break;case "moveDown":this.goToPositionAngle(b,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:d},a);break;case "moveTo":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("move to value invalid"));break}g=parseFloat(c.ext);0>g&&(g=0);100<g&&(g=100);var h={};h[e]=g;this.activeStateChange(h);this.goToPositionAngle(b,{POS:g,ANG:255,REPO:0,LOCK:0,CHN:d},a);break;case "stepUp":if(!this._states[e]){this.init(function(){setTimeout(function(){r._states[e]?r.executeCommand(b,c,
a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states[e].value||255==this._states[f].value){a&&a(Error("device status unknonw"));break}0!=this._states[f].value?(g=this._states[f].value-10,0>g&&(g=0),h={},h[f]=g,this.activeStateChange(h),this.goToPositionAngle(b,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:d},a)):(g=this._states[e].value-5,0>g&&(g=0),h={},h[e]=g,this.activeStateChange(h),this.goToPositionAngle(b,{POS:g,ANG:0,REPO:0,LOCK:0,CHN:d},a));break;case "stepDown":if(!this._states[e]){this.init(function(){setTimeout(function(){r._states[e]?
r.executeCommand(b,c,a):a&&a(Error("get device status failed"))},200)});break}if(255==this._states[e].value||255==this._states[f].value){a&&a(Error("device status unknonw"));break}100!=this._states[f].value?(g=this._states[f].value+10,100<g&&(g=100),h={},h[f]=g,this.activeStateChange(h),this.goToPositionAngle(b,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:d},a)):(g=this._states[e].value+5,100<g&&(g=100),h={},h[e]=g,this.activeStateChange(h),this.goToPositionAngle(b,{POS:g,ANG:100,REPO:0,LOCK:0,CHN:d},a));break;
case "lamellaUp":this.goToPositionAngle(b,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:d},a);break;case "lamellaDown":this.goToPositionAngle(b,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:d},a);break;case "lamellaTo":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("lamella to value invalid"));break}g=parseFloat(c.ext);0>g&&(g=0);100<g&&(g=100);h={};h[f]=g;this.goToPositionAngle(b,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:d},a);break;case "stop":this.stop(b,{CHN:d},a);break;case "setRunTime":if(!c.ext){a&&a(Error("parameters is null"));
break}f=100*parseFloat(c.ext);499>=f&&(f=500);this.setParameters(b,{VERT:f,ROT:255,AA:7,CHN:d},a);break;case "setRotationTime":if(!c.ext){a&&a(Error("parameters is null"));break}f=32767;h=parseInt(c.ext)/10;this.setParameters(b,{VERT:f,ROT:h,AA:7,CHN:d},a);break;case "setParams":if(!c.ext){a&&a(Error("parameters is null"));break}g=c.ext.split(":");if(3!=g.length){a&&a(Error("parameters format invalid"));break}f=g[0]?100*parseFloat(g[0]):32767;499>=f&&(f=32767);h=g[1]?parseInt(g[1])/10:255;g=g[2]?
parseInt(g[2]):7;this.setParameters(b,{VERT:f,ROT:h,AA:g,CHN:d},a);break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"))};var tc=function(b){X.call(this,b);this._data="d2-06-??"};tc.prototype=new X;tc.prototype.constructor=tc;var oa=function(b){X.call(this,b);this._data="d2-06-01";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbir_new=this._suir_new=this._blcr_new=this._hccr_new=this._vacation_new=null};oa.COMMANDS="vacationOn vacationOff handleClosedClickOn handleClosedClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
oa.STATES="bal ppal state handle window br bl motion vacation temperature humidity illumination battery hccr blcr suir vbir".split(" ");oa.prototype=new tc;oa.prototype.constructor=oa;oa.prototype.executeCommand=function(b,c,a){b=(new Date).getTime();if(c&&c.value){"setSensorUpdateInterval"==c.value.substr(0,23)&&23<c.value.length?(c=c.value.substr(23),c={value:"setSensorUpdateInterval",ext:c}):"setVacationBlinkInterval"==c.value.substr(0,24)&&24<c.value.length&&(c=c.value.substr(24),c={value:"setVacationBlinkInterval",
ext:c});switch(c.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({vacation:"off"});break;case "handleClosedClickOn":this._hccr_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({hccr:"on"});break;case "handleClosedClickOff":this._hccr_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcr_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcr_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("set sensor update interval value invalid"));return}c=parseInt(c.ext);5>c&&(c=5);65535<c&&(c=65535);this._suir_new=c;this._states.pending={value:!0,time:b};
this.activeStateChange({suir:c});break;case "setVacationBlinkInterval":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("set vacation blink interval value invalid"));return}c=parseInt(c.ext);3>c&&(c=3);255<c&&(c=255);this._vbir_new=c;this._states.pending={value:!0,time:b};this.activeStateChange({vbir:c})}a&&a()}else a&&a(Error("command invalid"))};oa.prototype.evalData=function(b,c,a){var d=this.evalTelegram(c);this._vacation_new&&delete d.vacation;this._hccr_new&&delete d.hccr;this._blcr_new&&
delete d.blcr;this._suir_new&&delete d.suir;this._vbir_new&&delete d.vbir;210==c.rorg&&0==c.userData.readUInt8(0)&&this._sendResponse(b);d?(b=this.checkStateChange(d),a&&a(null,b)):a&&a(Error("data format invalid"))};oa.prototype.evalTelegram=function(b){var c={};if(210==b.rorg)switch(b.userData.readUInt8(0)){case 0:var a=b.userData.readUInt8(1);var d=b.userData.readUInt8(2);var e=b.userData.readUInt8(3);var f=b.userData.readUInt8(4);var g=b.userData.readUInt8(5);var h=b.userData.readUInt8(6);var k=
b.userData.readUInt16BE(7);b=b.userData.readUInt8(9);b=b>>3&31;switch(a>>4&15){case 0:c.bal="ok";break;case 1:c.bal="alarm";break;case 14:c.bal="invalid";break;case 15:c.bal="unsupported"}switch(a&15){case 0:c.ppal="ok";break;case 1:c.ppal="alarm";break;case 14:c.ppal="invalid";break;case 15:c.ppal="unsupported"}switch(d>>4&15){case 0:c.handle="undefined";break;case 1:c.handle="up";break;case 2:c.handle="down";break;case 3:c.handle="left";break;case 4:c.handle="right";break;case 14:c.handle="invalid";
break;case 15:c.handle="unsupported"}switch(d&15){case 0:c.window="undefined";break;case 1:c.window="not_tilted";break;case 2:c.window="tilted";break;case 14:c.window="invalid";break;case 15:c.window="unsupported"}switch(e>>4&15){case 0:c.br="unchanged";break;case 1:c.br="pressed";break;case 2:c.br="releaseed";break;case 14:c.br="invalid";break;case 15:c.br="unsupported"}switch(e&15){case 0:c.bl="unchanged";break;case 1:c.bl="pressed";break;case 2:c.bl="releaseed";break;case 14:c.bl="invalid";break;
case 15:c.bl="unsupported"}switch(f>>4&15){case 0:c.motion="ok";break;case 1:c.motion="alarm";break;case 14:c.motion="invalid";break;case 15:c.motion="unsupported"}switch(f&15){case 0:c.vacation="unchanged";break;case 1:c.vacation="on";break;case 2:c.vacation="off";break;case 14:c.vacation="invalid";break;case 15:c.vacation="unsupported"}254==g?c.temperature="invalid":255==g?c.temperature="unsupported":250>=g&&(c.temperature=parseFloat((g/250*80-20).toFixed(2)));254==h?c.humidity="invalid":255==h?
c.humidity="unsupported":200>=h&&(c.humidity=parseFloat((h/2).toFixed(1)));65534==k?c.illumination="invalid":65535==k?c.illumination="unsupported":60001==k?c.illumination="over_range":6E4>=k&&(c.illumination=k);20>=b&&(c.battery=5*b);if("undefined"==c.window||"invalid"==c.window||"unsupported"==c.window||"not_tilted"==c.window)switch(c.handle){case "undefined":c.state="undefined";break;case "up":c.state="tilted";break;case "down":c.state="closed";break;case "left":c.state="open";break;case "right":c.state=
"open";break;case "invalid":c.state="invalid";break;case "unsupported":c.state="undefined"}else"tilted"==c.window&&(c.state="tilted");break;case 16:h=b.userData.readUInt8(1),k=b.userData.readUInt16BE(2),b=b.userData.readUInt8(4),a=k,d=b,c.vacation=h>>7&1?"on":"off",c.hccr=h>>6&1?"on":"off",c.blcr=h>>5&1?"on":"off",5<=a&&(c.suir=a),3<=d&&(c.vbir=d)}return c};oa.prototype._sendResponse=function(b,c){var a=0;this._vacation_new&&"on"==this._vacation_new&&(a=1);var d=0;this._hccr_new&&"off"==this._hccr_new?
d=1:this._hccr_new&&"on"==this._hccr_new&&(d=2);var e=0;this._blcr_new&&"off"==this._blcr_new?e=1:this._blcr_new&&"on"==this._blcr_new&&(e=2);var f=0;this._suir_new&&(f=this._suir_new);var g=0;this._vbir_new&&(g=this._vbir_new);var h=new Buffer([128,128|(a&1)<<5|(d&3)<<3|(e&3)<<1,f>>8&255,f&255,g]),k=this._senderID;k||(k=x.hub.m.enocean.SENDER_ID);h=new x.hub.m.enocean.ESP3.Telegram.VLD(h,k,0);var m=this;b.sendTelegram(h,!0,function(b){m._vacation_new=null;m._hccr_new=null;m._blcr_new=null;m._suir_new=
null;m._vbir_new=null;var h={pending:!1};h.vacation=a?"on":"off";d&&(h.hccr=1==d?"off":"on");e&&(h.blcr=1==e?"off":"on");f&&(h.suir=f);g&&(h.vbir=g);m.activeStateChange(h);c&&c(b)})};var pa=function(b){X.call(this,b);this._data="d2-06-02";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbis_new=this._suis_new=this._blcs_new=this._lacs_new=this._vacation_new=null};pa.COMMANDS="vacationOn vacationOff lockActiveClickOn lockActiveClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
pa.STATES="operation_mode handle window state temperature humidity battery vacation hccr blcr suir vbir".split(" ");pa.prototype=new tc;pa.prototype.constructor=pa;pa.prototype.executeCommand=function(b,c,a){b=(new Date).getTime();if(c&&c.value){"setSensorUpdateInterval"==c.value.substr(0,23)&&23<c.value.length?(c=c.value.substr(23),c={value:"setSensorUpdateInterval",ext:c}):"setVacationBlinkInterval"==c.value.substr(0,24)&&24<c.value.length&&(c=c.value.substr(24),c={value:"setVacationBlinkInterval",
ext:c});switch(c.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({vacation:"off"});break;case "lockActiveClickOn":this._lacs_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({hccr:"on"});break;case "lockActiveClickOff":this._lacs_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcs_new="on";this._states.pending={value:!0,time:b};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcs_new="off";this._states.pending={value:!0,time:b};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("set sensor update interval value invalid"));return}c=parseInt(c.ext);5>c&&(c=5);65535<c&&(c=65535);this._suis_new=c;this._states.pending={value:!0,time:b};
this.activeStateChange({suir:c});break;case "setVacationBlinkInterval":if("undefined"==typeof c.ext||null==c.ext){a&&a(Error("set vacation blink interval value invalid"));return}c=parseInt(c.ext);3>c&&(c=3);255<c&&(c=255);this._vbis_new=c;this._states.pending={value:!0,time:b};this.activeStateChange({vbir:c})}a&&a()}else a&&a(Error("command invalid"))};pa.prototype.evalData=function(b,c,a){var d=this.evalTelegram(c);this._vacation_new&&delete d.vacation;this._lacs_new&&delete d.hccr;this._blcs_new&&
delete d.blcr;this._suis_new&&delete d.suir;this._vbis_new&&delete d.vbir;210==c.rorg&&0==c.userData.readUInt8(0)&&this._sendResponse(b);d?(b=this.checkStateChange(d),a&&a(null,b)):a&&a(Error("data format invalid"))};pa.prototype.evalTelegram=function(b){var c={};if(210==b.rorg)switch(b.userData.readUInt8(0)){case 0:var a=b.userData.readUInt8(1);var d=b.userData.readUInt8(2);var e=b.userData.readUInt8(3);b=b.userData.readUInt8(4);b=b>>3&31;switch(a>>6&3){case 0:c.operation_mode="standard";break;case 1:c.operation_mode=
"hst"}switch(a>>4&3){case 0:c.lock="unlocked";break;case 1:c.lock="locked"}switch(a>>2&3){case 0:c.window="not_tilted";break;case 1:c.window="tilted"}switch(a&3){case 0:c.alarm="ok";break;case 1:c.alarm="burglary_alarm";break;case 2:c.alarm="unlock_alarm"}254==d?c.temperature="invalid":255==d?c.temperature="unsupported":250>=d&&(c.temperature=parseFloat((d/250*80-20).toFixed(2)));254==e?c.humidity="invalid":255==e?c.humidity="unsupported":200>=e&&(c.humidity=parseFloat((e/2).toFixed(1)));20>=b&&(c.battery=
5*b);if("tilted"==c.window)c.state="tilted";else switch(c.lock){case "unlocked":c.state="open";break;case "locked":c.state="closed"}break;case 16:a=b.userData.readUInt8(1),d=b.userData.readUInt16BE(2),e=b=b.userData.readUInt8(4),c.vacation=a>>7&1?"on":"off",c.hccr=a>>6&1?"on":"off",c.blcr=a>>5&1?"on":"off",5<=d&&(c.suir=d),3<=e&&(c.vbir=e)}return c};pa.prototype._sendResponse=function(b,a){var c=0;this._vacation_new&&"on"==this._vacation_new?c=1:this._vacation_new&&"off"==this._vacation_new&&(c=2);
var d=0;this._lacs_new&&"off"==this._lacs_new?d=1:this._lacs_new&&"on"==this._lacs_new&&(d=2);var e=0;this._blcs_new&&"off"==this._blcs_new?e=1:this._blcs_new&&"on"==this._blcs_new&&(e=2);var f=0;this._suis_new&&(f=this._suis_new);var g=0;this._vbis_new&&(g=this._vbis_new);var h=new Buffer([128,128|(c&3)<<4|(d&3)<<2|e&3,f>>8&255,f&255,g]),k=this._senderID;k||(k=x.hub.m.enocean.SENDER_ID);h=new x.hub.m.enocean.ESP3.Telegram.VLD(h,k,0);var m=this;b.sendTelegram(h,!0,function(b){m._vacation_new=null;
m._lacs_new=null;m._blcs_new=null;m._suis_new=null;m._vbis_new=null;var h={pending:!1};h.vacation=c?"on":"off";d&&(h.hccr=1==d?"off":"on");e&&(h.blcr=1==e?"off":"on");f&&(h.suir=f);g&&(h.vbir=g);m.activeStateChange(h);a&&a(b)})};var uc=function(b){X.call(this,b);this._data="d2-20-??"};uc.prototype=new X;uc.prototype.constructor=uc;var U=function(b){uc.call(this,b);this._data="d2-20-00";this._poller=null;this._pollInterval=6E4};U.COMMANDS="setFanLevel fanLevelUp fanLevelDown requestStatus setHumLevel setCo2Level".split(" ");
U.STATES="filter_remaining_time operating_time temperature message_code anti_freeze current_fan_level set_fan_level".split(" ");U.prototype=new uc;U.prototype.constructor=U;U.prototype.init=function(b){var a=this;setTimeout(function(){var c=require("x.hub.m.enocean.js")._esp3;a.executeCommand(c,{value:"requestStatus"},b);a._restartPoller(c)},Math.floor(6E3*Math.random())+1E3)};U.prototype.finalize=function(b){this._poller&&clearInterval(this._poller);b&&b()};U.prototype._restartPoller=function(b){this._poller&&
clearInterval(this._poller);var a=this;this._poller=setInterval(function(){a.executeCommand(b,{value:"requestStatus"})},this._pollInterval)};U.prototype.executeCommand=function(b,a,d){(new Date).getTime();if(a&&a.value){if("setFanLevel"==a.value.substr(0,11)&&11<a.value.length)a=a.value.substr(11),a={value:"setFanLevel",ext:a};else if("fanLevelUp"==a.value){var c=this.getBufferedState("set_fan_level");if("undefined"==typeof c||null==c){d&&d(Error("fanLevelUp unknown current fan level"));return}if(6==
c){d&&d();return}a={value:"setFanLevel",ext:c+1}}else if("fanLevelDown"==a.value){c=this.getBufferedState("set_fan_level");if("undefined"==typeof c||null==c){d&&d(Error("fanLevelUp unknown current fan level"));return}if(0==c){d&&d();return}a={value:"setFanLevel",ext:c-1}}else if("setHumLevel"==a.value.substr(0,11)&&11<a.value.length){c=this.getBufferedState("set_fan_level");if(5!=c){d&&d(Error("humidity regulation not active"));return}a=a.value.substr(11);a={value:"setHumLevel",ext:a}}else if("setCo2Level"==
a.value.substr(0,11)&&11<a.value.length){c=this.getBufferedState("set_fan_level");if(6!=c){d&&d(Error("co2 regulation not active"));return}a=a.value.substr(11);a={value:"setCo2Level",ext:a}}var e=this;switch(a.value){case "setFanLevel":if("undefined"==typeof a.ext||null==a.ext){d&&d(Error("setFanLevel value invalid"));break}var f=parseInt(a.ext);if(0>f||6<f){d&&d(Error("setFanLevel value invalid"));break}if(5==f||6==f){this.activeStateChange({set_fan_level:f});this._activateSensorRegulation();d&&
d();break}this._deactivateSensorRegulation();this._sendResponse(b,{LS:f,RS:1},function(a){a||e.activeStateChange({set_fan_level:f,current_fan_level:f});e._restartPoller(b);d&&d(a)});break;case "setHumLevel":if("undefined"==typeof a.ext||null==a.ext){d&&d(Error("setHumLevel value invalid"));break}f=parseInt(a.ext);if(0>f||4<f){d&&d(Error("setHumLevel value invalid"));break}this._sendResponse(b,{LS:f,RS:1},function(a){a||e.activeStateChange({current_fan_level:f});e._restartPoller(b);d&&d(a)});break;
case "setCo2Level":if("undefined"==typeof a.ext||null==a.ext){d&&d(Error("setCo2Level value invalid"));break}f=parseInt(a.ext);if(0>f||4<f){d&&d(Error("setCo2Level value invalid"));break}this._sendResponse(b,{LS:f,RS:1},function(a){a||e.activeStateChange({current_fan_level:f});e._restartPoller(b);d&&d(a)});break;case "requestStatus":this._sendResponse(b,{LS:5,RS:1},function(b){d&&d(b)});break;default:d&&d(Error("unknown command"))}}else d&&d(Error("command invalid"))};U.prototype.evalData=function(b,
a,d){b=this.evalTelegram(a);this._states&&this._states.set_fan_level||(b.set_fan_level=b.current_fan_level);this._states&&this._states.set_fan_level&&5!=this._states.set_fan_level.value&&6!=this._states.set_fan_level.value&&(b.set_fan_level=b.current_fan_level);b=this.checkStateChange(b);d&&d(null,b)};U.prototype.evalTelegram=function(b){var a={};if(210==b.rorg)if(1==b.userData.length){var d=b.userData.readUInt8(0)&7;a.current_fan_level=d}else{d=b.userData.readUInt8(0);var e=b.userData.readUInt8(1),
f=b.userData.readUInt16BE(2),g=b.userData.readUInt8(4),h=b.userData.readUInt8(5),k=b.userData.readUInt8(6),m=b.userData.readUInt16BE(7),l=b.userData.readUInt8(9),n=b.userData.readUInt8(10),p=b.userData.readInt16BE(11);b=b.userData.readUInt8(13);a.filter_remaining_time=g+":"+f+":"+e+":"+d;a.operating_time=l+":"+m+":"+k+":"+h;a.temperature=p/10;a.message_code=n;a.anti_freeze=b>>4&1?"on":"off";a.current_fan_level=b&7}return a};U.prototype._sendResponse=function(b,a,d){var c=this._senderID;this._senderID||
(c=x.hub.m.enocean.SENDER_ID);a=new Buffer([a.LS,a.RS]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(a,c,0);this._senderID!=this._address&&c.setDstId(this._address);b.sendTelegram(c,!0,function(b){d&&d(b)})};U.prototype._activateSensorRegulation=function(){var b=require("x.hub.m.enocean.js").getRehauHandler();b&&b.activateSensorRegulation(this.getAddress())};U.prototype._deactivateSensorRegulation=function(){var b=require("x.hub.m.enocean.js").getRehauHandler();b&&b.deactivateSensorRegulation(this.getAddress())};
var Cb=function(b){L.call(this,b);this._data="eltako_contact";this._vendor="eltako";this._eepAlias="f6-10-00"};Cb.STATES=["contact","contact_raw"];Cb.prototype=new L;Cb.prototype.constructor=Cb;Cb.prototype.evalTelegram=function(b){var a={};246==b.rorg&&(b=b.userData,240==b?a.contact="closed":224==b&&(a.contact="closed"),a.contact_raw=b);return a};var Db=function(b){Ga.call(this,b);this._data="eltako_motion";this._vendor="eltako";this._eepAlias="a5-08-01"};Db.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");
Db.prototype=new Ga;Db.prototype.constructor=Db;Db.prototype.evalTelegram=function(b){var a={};if(165==b.rorg){var d=b.userData.readUInt8(3);b.userData.readUInt8(2);var e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(d>>3&1)){a.voltage=parseFloat((b/255*5.1).toFixed(1));a.voltage_raw=b;a.illumination=parseFloat((e/255*2048).toFixed(1));a.illumination_raw=e;d=d>>1&1;switch(d){case 0:a.state="on";break;case 1:a.state="off"}a.state_raw=d}}return a};var ja=function(b){S.call(this,b);this._data=
"eltako_switch";this._vendor="eltako";this._eepAlias="f6-02-01"};ja.COMMANDS=["on","off","toggle"];ja.STATES=["state"];ja.prototype=new S;ja.prototype.constructor=ja;ja.prototype.getTeachinType=function(){return"4BS"};ja.prototype.handleLearnTelegram=function(b,a){if(a&&246==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._learnAddress,senderID:b._learnSenderID,data:b._learnProfile,vendor:b._learnVendor},{address:a.senderID,senderID:b._learnSenderID,data:this._data,vendor:this._vendor},
function(a,c){b._learnFinish(a,0,c)})};ja.prototype.getTeachinTelegram=function(b,a,d){b=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(b,a,0)};ja.prototype.evalTelegram=function(b){var a={};if(246==b.rorg)switch(b.userData){case 112:a.state="on";break;case 80:a.state="off"}return a};ja.prototype.executeCommand=function(b,a,d){if(a&&a.value){(new Date).getTime();var c=this;switch(a.value){case "on":this.switching(b,{TIM:0,LCK:0,DEL:0,SW:1},function(b){b||c.activeStateChange({state:"on"});
d&&d(b)});break;case "off":this.switching(b,{TIM:0,LCK:0,DEL:0,SW:0},function(b){b||c.activeStateChange({state:"off"});d&&d(b)});break;case "toggle":if(!this._states.state){d&&d(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(b,{value:"off"},d):this.executeCommand(b,{value:"on"},d);break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};var I=function(b){S.call(this,b);this._data="eltako_dimmer";this._vendor="eltako";this._eepAlias=
"a5-38-08";this._lastOnLevel=-1};I.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");I.STATES=["state","level","ramp_time"];I.prototype=new S;I.prototype.constructor=I;I.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.ramp_time||null==this._params.ramp_time)this._params.ramp_time=0};I.prototype.handleLearnTelegram=function(b,a){if(a&&165==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._learnAddress,
senderID:b._learnSenderID,data:b._learnProfile,vendor:b._learnVendor},{address:a.senderID,senderID:b._learnSenderID,data:this._data,vendor:this._vendor},function(a,c){b._learnFinish(a,0,c)})};I.prototype.getTeachinTelegram=function(b,a,d){b=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(b,a,0)};I.prototype.getStatesBuffer=function(){var b=JSON.parse(JSON.stringify(this._states));b.ramp_time={value:this._params.ramp_time,time:-1};return b};I.prototype.evalData=function(b,
a,d){(b=this.evalTelegram(a))?((0==b.level||"off"==b.state)&&this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value),b=this.checkStateChange(b),d&&d(null,b)):d&&d(Error("data format invalid"))};I.prototype.evalTelegram=function(b){var a={};if(165==b.rorg){var d=b.userData.readUInt8(3),e=b.userData.readUInt8(2),f=b.userData.readUInt8(1);b=b.userData.readUInt8(0);if(1==(d>>3&1))switch(b){case 2:a.level=f,a.ramp=e,a.dim_range=d>>2&1?"relative":"absolute",a.store_final_value=
d>>1&1,a.state=d&1?"on":"off"}}return a};I.prototype.executeCommand=function(b,a,d){if(a&&a.value){if("dimTo"==a.value.substr(0,5)&&5<a.value.length){var c=a.value.substr(5);a={value:"dimTo",ext:c}}else"toggleTo"==a.value.substr(0,8)&&8<a.value.length?(c=a.value.substr(8),a={value:"toggleTo",ext:c}):"setRampTime"==a.value.substr(0,11)&&11<a.value.length&&(c=a.value.substr(11),a={value:"setRampTime",ext:c});(new Date).getTime();var e=this;switch(a.value){case "on":c=this._lastOnLevel;if(-1==c||0==
c)c=100;this.dimming(b,{EDIM:c,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(b){b||e.activeStateChange({level:c,state:"on"});d&&d(b)});break;case "off":this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value);this.dimming(b,{EDIM:0,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:0},function(b){b||e.activeStateChange({level:0,state:"off"});d&&d(b)});break;case "toggle":if(!this._states.state){d&&d(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?
this.executeCommand(b,{value:"off"},d):this.executeCommand(b,{value:"on"},d);break;case "toggleTo":if(!this._states.state){d&&d(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(b,{value:"off"},d):this.executeCommand(b,{value:"dimTo",ext:a.ext},d);break;case "dimTo":if("undefined"==typeof a.ext||null==a.ext){d&&d(Error("dim to value invalid"));break}c=parseFloat(a.ext);0>c&&(c=0);100<c&&(c=100);this.dimming(b,{EDIM:c,RMP:this._params.ramp_time,EDIMR:0,
STR:0,SW:1},function(b){b||e.activeStateChange({level:c,state:"on"});d&&d(b)});break;case "dimUp":if(!this._states.level){d&&d(Error("unknow previous dimmer level"));break}c=parseInt(this._states.level.value);c+=5;100<c&&(c=100);this.dimming(b,{EDIM:c,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(b){b||e.activeStateChange({level:c,state:"on"});d&&d(b)});break;case "dimDown":if(!this._states.level){d&&d(Error("unknow previous dimmer level"));break}c=parseInt(this._states.level.value);c-=
5;0>c&&(c=0);if(0==c){this.executeCommand(b,{value:"off"},d);break}this.dimming(b,{EDIM:c,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(b){b||e.activeStateChange({level:c,state:"on"});d&&d(b)});break;case "setRampTime":if(!a.ext){d&&d(Error("parameters is null"));break}c=parseInt(c);255<c&&(c=255);0>c&&(c=0);this._params.ramp_time=c;require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated(this,function(b){d&&d(b)});break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};
var La=function(b){I.call(this,b);this._data="eltako_dimmer2";this._vendor="eltako";this._eepAlias="f6-02-01"};La.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");La.STATES=["state","ramp_time"];La.prototype=new I;La.prototype.constructor=I;La.prototype.handleLearnTelegram=function(b,a){if(a&&246==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._learnAddress,senderID:b._learnSenderID,data:b._learnProfile,vendor:b._learnVendor},{address:a.senderID,
senderID:b._learnSenderID,data:this._data,vendor:this._vendor},function(a,c){b._learnFinish(a,0,c)})};La.prototype.evalTelegram=function(b){var a={};if(246==b.rorg)switch(b.userData){case 112:a.state="on";break;case 80:a.state="off"}return a};var Eb=function(b){I.call(this,b);this._data="eltako_fsud"};Eb.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");Eb.STATES=["state","ramp_time"];Eb.prototype=new I;Eb.prototype.constructor=I;Eb.prototype.getTeachinTelegram=function(b,
a,d){b=new Buffer([2,0,0,0]);return new x.hub.m.enocean.ESP3.Telegram.BS4(b,a,0)};var V=function(b){rc.call(this,b);this._data="eltako_blind";this._vendor="eltako";this._eepAlias="f6-02-01";this._syncRunning=!1;this._syncCB=this._syncTO=null};V.COMMANDS="up down stop stepUp stepDown setRV setRunTime moveTo sync".split(" ");V.STATES=["pos","sync"];V.prototype=new rc;V.prototype.constructor=V;V.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.rv||
null==this._params.rv)this._params.rv=200;if("undefined"==typeof this._params.rt||null==this._params.rt)this._params.rt=200};V.prototype.handleLearnTelegram=function(b,a){if(a&&246==a.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:b._learnAddress,senderID:b._learnSenderID,data:b._learnProfile,vendor:b._learnVendor},{address:a.senderID,senderID:b._learnSenderID,data:this._data,vendor:this._vendor},function(a,c){b._learnFinish(a,0,c)})};V.prototype.getTeachinTelegram=function(b,
a,d){b=new Buffer([255,248,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(b,a,0)};V.prototype.getStatesBuffer=function(){var b=JSON.parse(JSON.stringify(this._states));b.sync||(b.sync={value:!1,time:-1});b.rv={value:this._params.rv,time:-1};b.rt={value:this._params.rt,time:-1};return b};V.prototype.evalData=function(b,a,d){(b=this.evalTelegram(a))?(a=this.checkStateChange(b),b.sync&&this._syncRunning&&(this._syncRunning=!1,this._syncTO&&(clearTimeout(this._syncTO),this._syncTO=null),this._syncCB&&
(this._syncCB(),this._syncCB=null)),d&&d(null,a)):d&&d(Error("data format invalid"))};V.prototype.evalTelegram=function(b){var a={};if(246==b.rorg)switch(b.userData){case 112:a.sync=!0;a.pos=0;break;case 80:a.sync=!0,a.pos=100}else if(165==b.rorg){var d=b.userData.readUInt16BE(0);b=b.userData.readUInt8(2);var e=this._params.rt;e||(e=200);var f=this._states.pos?this._states.pos.value:null;if("undefined"!=typeof f&&null!=f)switch(d=10*d/e,b){case 1:a.pos=Math.max(0,Math.round(f-d));break;case 2:a.pos=
Math.min(100,Math.round(f+d))}}return a};V.prototype.executeCommand=function(b,a,d){if(a&&a.value){if("stepUp"==a.value.substr(0,6)&&6<a.value.length){var c=a.value.substr(6);a={value:"stepUp",ext:c}}else"stepDown"==a.value.substr(0,8)&&8<a.value.length?(c=a.value.substr(8),a={value:"stepDown",ext:c}):"setRV"==a.value.substr(0,5)&&5<a.value.length?(c=a.value.substr(5),a={value:"setRV",ext:c}):"setRunTime"==a.value.substr(0,10)&&10<a.value.length?(c=a.value.substr(10),a={value:"setRunTime",ext:c}):
"moveTo"==a.value.substr(0,6)&&6<a.value.length&&(c=a.value.substr(6),a={value:"moveTo",ext:c});(new Date).getTime();var e=this,f=this._params.rv;f||(f=200);var g=this._params.rt;g||(g=200);switch(a.value){case "up":this.doReq(b,{TIME:f,CMD:1,LCK:0,TYPE:0},function(b){d&&d(b)});break;case "down":this.doReq(b,{TIME:f,CMD:2,LCK:0,TYPE:0},function(b){d&&d(b)});break;case "stop":this.doReq(b,{TIME:0,CMD:0,LCK:0,TYPE:0},function(b){d&&d(b)});break;case "stepUp":g="undefined"==typeof a.ext||null==a.ext?
g/100:parseFloat(a.ext)/100*g;1>g&&(g=1);this.doReq(b,{TIME:g,CMD:1,LCK:0,TYPE:0},function(b){d&&d(b)});break;case "stepDown":g="undefined"==typeof a.ext||null==a.ext?g/100:parseFloat(a.ext)/100*g;1>g&&(g=1);this.doReq(b,{TIME:g,CMD:2,LCK:0,TYPE:0},function(b){d&&d(b)});break;case "moveTo":if("undefined"==typeof a.ext||null==a.ext){d&&d(Error("value invalid"));break}c=parseInt(a.ext);if(this._states.sync&&this._states.sync.value&&this._states.pos&&"undefined"!=typeof this._states.pos.value&&null!=
this._states.pos.value){g*=(c-this._states.pos.value)/100;if(0<g)var h=2;else if(0>g)g=0-g,h=1;else if(0==g){d&&d();break}this.doReq(b,{TIME:g,CMD:h,LCK:0,TYPE:1},function(b){d&&d(b)})}else this.snyc(b,function(c){c?d&&d(c):e.executeCommand(b,a,d)});break;case "sync":this.snyc(b,function(b){d&&d(b)});break;case "setRV":if(!a.ext){d&&d(Error("parameters is null"));break}c=parseInt(c);200<c&&(c=200);0>c&&(c=0);this._params.rv=c;h=require("x.hub.m.enocean.js")._deviceHandler;h.deviceParamsUpdated(this,
function(b){d&&d(b)});break;case "setRunTime":if(!a.ext){d&&d(Error("parameters is null"));break}c=parseInt(c);200<c&&(c=200);0>c&&(c=0);this._params.rt=c;h=require("x.hub.m.enocean.js")._deviceHandler;h.deviceParamsUpdated(this,function(b){d&&d(b)});break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};V.prototype.snyc=function(b,a){if(this._syncRunning)a&&a(Error("sync running"));else{var c=this,d=this._params.rv;d||(d=200);this._syncRunning=!0;this._syncTO=setTimeout(function(){c._syncRunning=
!1;c._syncTO=null;c._syncCB&&c._syncCB(Error("sync timeout"));c._syncCB=null},1E3*(d+2));this._syncCB=a;this.doReq(b,{TIME:d,CMD:1,LCK:0,TYPE:0})}};V.prototype.doReq=function(b,a,d){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);if(a.TYPE){var e=Math.round(10*a.TIME)>>8&255;var f=Math.round(10*a.TIME)&255}else e=0,f=Math.round(a.TIME)&255;a=new Buffer([e,f,a.CMD,8|(a.LCK&1)<<2|(a.TYPE&1)<<1]);c=new x.hub.m.enocean.ESP3.Telegram.BS4(a,c,0);c.setDstId(this._address);b.sendTelegram(c,
!0,function(b){d&&d(b)})};var Fb=function(b){Ba.call(this,b);this._data="eltako_weather";this._vendor="eltako";this._eepAlias="a5-04-02";this._engMax=7.2;this._engMin=0};Fb.STATES="energy energy_raw humidity humidity_raw temperature temperature_raw available".split(" ");Fb.prototype=new Ba;Fb.prototype.constructor=Fb;Fb.prototype.evalTelegram=function(b){var a={};if(165==b.rorg){var d=b.userData.readUInt8(3),e=b.userData.readUInt8(2),f=b.userData.readUInt8(1);b=b.userData.readUInt8(0);1==(d>>3&1)&&
(a.energy=parseFloat((b/250*(this._engMax-this._engMin)+this._engMin).toFixed(1)),a.energy_raw=b,a.humidity=parseFloat((f/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),a.humidity_raw=f,a.temperature=parseFloat((e/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),a.temperature_raw=e,a.available=d>>1&1?!0:!1)}return a};var Gb=function(b){Ca.call(this,b);this._data="eltako_lux";this._vendor="eltako";this._eepAlias="a5-06-01";this._ill1Max=3E4;this._ill1Min=300};Gb.STATES="illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw".split(" ");
Gb.prototype=new Ca;Gb.prototype.constructor=Gb;Gb.prototype.evalTelegram=function(b){var a={};if(165==b.rorg){var d=b.userData.readUInt8(3);b.userData.readUInt8(2);var e=b.userData.readUInt8(1);b=b.userData.readUInt8(0);1==(d>>3&1)&&(a.illumination2=b,a.illumination2_raw=b,a.illumination1=parseFloat((e/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1)),a.illumination1_raw=e,a.illumination=e?a.illumination1:a.illumination2,a.illumination_raw=e?a.illumination1_raw:a.illumination2_raw)}return a};
var vc=function(a){ua.call(this,a);this._data="eltako_lux2";this._vendor="eltako";this._eepAlias="a5-06-02";this._ill2Min=0;this._ill2Max=1024};vc.STATES=ua.STATES;vc.prototype=new ua;vc.prototype.constructor=vc;var E=function(a){d.call(this,a);this._data="eltako_buttons";this._vendor="eltako";this._eepAlias="f6-02-01";this._longPressThreshold=1E3;this.BUTTONS=["button1","button2","button3","button4"]};E.STATES=["button1","button2","button3","button4"];E.EVENTS=["shortPress","longPress","press","release"];
E.prototype=new d;E.prototype.constructor=E;E.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:this.BUTTONS[0]&&(b[this.BUTTONS[0]]="pressed");break;case 80:this.BUTTONS[1]&&(b[this.BUTTONS[1]]="pressed");break;case 48:this.BUTTONS[2]&&(b[this.BUTTONS[2]]="pressed");break;case 16:this.BUTTONS[3]&&(b[this.BUTTONS[3]]="pressed");break;case 0:for(a=0;a<this.BUTTONS.length;a++)this.BUTTONS[a]&&(b[this.BUTTONS[a]]="released")}return b};E.prototype.checkStateChange=
function(a){var b=this._states,d=[],e=(new Date).getTime(),f;for(f in a){var g={};g.key=f;g.value=a[f];g.changed=!1;var h=b[f]?b[f].value:null,k=b[f]?b[f].time:null,m=a[f];h!=m&&(g.oldvalue=h,g.changed=!0);this._states[f]={value:a[f],time:e};g.changed&&d.push(g);"pressed"==h&&"released"==m&&(!k||e-k<this._longPressThreshold?(g={},g.key=f,g.value="shortPress"):(g={},g.key=f,g.value="longPress"),g.changed=!0,d.push(g))}return d};var wc=function(a){E.call(this,a);this._data="eltako_button2";this.BUTTONS=
[null,null,null,"button"]};wc.STATES=["button"];wc.prototype=new E;wc.prototype.constructor=wc;var xc=function(a){E.call(this,a);this._data="eltako_sender2";this.BUTTONS=["A1","A3"]};xc.STATES=["A1","A3"];xc.prototype=new E;xc.prototype.constructor=xc;var yc=function(a){E.call(this,a);this._data="eltako_sender4";this.BUTTONS=["E1","E2","E3","E4"]};yc.STATES=["E1","E2","E3","E4"];yc.prototype=new E;yc.prototype.constructor=yc;var zc=function(a){E.call(this,a);this._data="eltako_button2";this.BUTTONS=
["buttonO","buttonI"]};zc.STATES=["buttonO","buttonI"];zc.prototype=new E;zc.prototype.constructor=zc;var Ac=function(a){E.call(this,a);this._data="eltako_button4";this.BUTTONS=["BO","BI","AO","AI"]};Ac.STATES=["BO","BI","AO","AI"];Ac.prototype=new E;Ac.prototype.constructor=Ac;var Hb=function(a){E.call(this,a);this._data="eltako_fsm60b"};Hb.STATES=["button"];Hb.prototype=new E;Hb.prototype.constructor=Hb;Hb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:case 80:case 16:b.button=
"pressed";break;case 0:b.button="released"}return b};var Ib=function(a){d.call(this,a);this._data="eltako_fkf";this._vendor="eltako";this._eepAlias="f6-04-01"};Ib.STATES=["keycard"];Ib.prototype=new d;Ib.prototype.constructor=Ib;Ib.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var Jb=function(a){d.call(this,a);this._data="eltako_fkc";this._vendor="eltako";this._eepAlias="f6-04-01"};Jb.STATES=["keycard"];
Jb.prototype=new d;Jb.prototype.constructor=Jb;Jb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.keycard="guest_card";case 32:b.keycard="service_card";case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var za=function(a){wa.call(this,a);this._data="eltako_thermo";this._vendor="eltako";this._eepAlias="a5-10-06"};za.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");za.prototype=new wa;za.prototype.constructor=
za;za.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var d=a.userData.readUInt8(3),e=a.userData.readUInt8(2),f=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(d>>3&1)&&(b.night_reduce=6>=a?0:12>=a?1:19>=a?2:25>=a?3:31>=a?4:5,b.night_reduce_raw=a,b.setpoint=parseFloat((f/255*40).toFixed(1)),b.setpoint_raw=f,b.temperature=parseFloat(((255-e)/255*40).toFixed(1)),b.temperature_raw=e)}return b};var Bc=function(a){za.call(this,a);this._data="eltako_futh65d";this._vendor="eltako";this._eepAlias=
"a5-10-12"};Bc.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");Bc.prototype=new za;Bc.prototype.constructor=Bc;var Kb=function(a){va.call(this,a);this._data="eltako_ftr78s";this._vendor="eltako";this._eepAlias="a5-10-03"};Kb.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Kb.prototype=new va;Kb.prototype.constructor=Kb;Kb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var d=a.userData.readUInt8(3),e=a.userData.readUInt8(2);
a=a.userData.readUInt8(1);1==(d>>3&1)&&(b.setpoint=parseFloat((a/255*22+8).toFixed(1)),b.setpoint_raw=a,b.temperature=parseFloat(((255-e)/255*40).toFixed(1)),b.temperature_raw=e)}return b};var Ma=function(a){ba.call(this,a);this._data="eltako_powermeter";this._vendor="eltako";this._eepAlias="a5-12-01"};Ma.STATES=["power","energy","tariff"];Ma.prototype=new ba;Ma.prototype.constructor=Ma;Ma.prototype.evalTelegram=function(a){var b=ba.prototype.evalTelegram.call(this,a);165==a.rorg&&143==a.userData.readUInt8(3)&&
(b={});return b};var Cc=function(a){ba.call(this,a);this._data="eltako_powermeter2";this._vendor="eltako";this._eepAlias="a5-12-01"};Cc.STATES=["power","tariff"];Cc.prototype=new ba;Cc.prototype.constructor=Ma;Cc.prototype.evalTelegram=function(a){a=ba.prototype.evalTelegram.call(this,a);delete a.energy;delete a.tariff;return a};var Lb=function(a){E.call(this,a);this._data="eltako_fzs"};Lb.STATES=["button"];Lb.prototype=new E;Lb.prototype.constructor=Lb;Lb.prototype.evalTelegram=function(a){var b=
{};if(246==a.rorg)switch(a.userData){case 48:b.button="pressed";break;case 0:b.button="released"}return b};var Mb=function(a){k.call(this,a);this._data="eltako_relay2";this._vendor="eltako";this._eepAlias="f6-02-01"};Mb.STATES=["ch1","ch2"];Mb.prototype=new k;Mb.prototype.constructor=Mb;Mb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.ch1="on";break;case 80:b.ch1="off";break;case 48:b.ch2="on";break;case 16:b.ch2="off"}return b};var Nb=function(a){k.call(this,
a);this._data="eltako_relay";this._vendor="eltako";this._eepAlias="f6-02-01"};Nb.STATES=["state"];Nb.prototype=new k;Nb.prototype.constructor=Nb;Nb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.state="on";break;case 80:b.state="off"}return b};var ka=function(a){S.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_powerswitch";this._vendor="peha";this._eepAlias="a5-38-08"};ka.COMMANDS=["on","off","toggle"];ka.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");
ka.prototype=new S;ka.prototype.constructor=ka;ka.prototype.getTeachinType=function(){return"4BS"};ka.prototype.evalTelegram=function(a){return Ja.prototype.evalTelegram.call(this,a)};ka.prototype.executeCommand=function(a,c,d){if(c&&c.value){(new Date).getTime();var b=this;switch(c.value){case "on":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:1},function(a){a||b.activeStateChange({state:"on"});d&&d(a)});break;case "off":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:0},function(a){a||b.activeStateChange({state:"off"});
d&&d(a)});break;case "toggle":if(!this._states.state){d&&d(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},d):this.executeCommand(a,{value:"on"},d);break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};var Na=function(a){ka.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_switch";this._vendor="peha";this._eepAlias="a5-38-08"};Na.COMMANDS=["on","off","toggle"];Na.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");
Na.prototype=new ka;Na.prototype.constructor=Na;Na.prototype.evalTelegram=function(a){a=Ja.prototype.evalTelegram.call(this,a);delete a.power;delete a.energy;delete a.current;delete a.voltage;delete a.power_unit;delete a.energy_unit;delete a.current_unit;delete a.voltage_unit;return a};var la=function(a){S.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_blind";this._vendor="peha";this._eepAlias="a5-38-08";this._initCount=0};la.COMMANDS="up down stop stepUp stepDown moveTo lamellaUp lamellaDown lamellaStepUp lamellaStepDown lamellaTo setRunTime setLamellaRuntime".split(" ");
la.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode".split(" ");la.prototype=new S;la.prototype.constructor=la;la.prototype.init=function(a){var b=require("x.hub.m.enocean.js")._esp3;this.blind(b,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0},function(b){a&&a()})};la.prototype.getTeachinType=function(){return"4BS"};la.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length?
(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):this._initCount=0;return this._states};la.prototype.evalTelegram=function(a){return kb.prototype.evalTelegram.call(this,a)};la.prototype.executeCommand=function(a,c,d){if(c&&c.value){(new Date).getTime();var b=this;if("stepUp"==c.value.substr(0,6)&&6<c.value.length){var e=c.value.substr(6);c={value:"stepUp",ext:e}}else"stepDown"==
c.value.substr(0,8)&&8<c.value.length?(e=c.value.substr(8),c={value:"stepDown",ext:e}):"setRunTime"==c.value.substr(0,10)&&10<c.value.length?(e=c.value.substr(10),c={value:"setRunTime",ext:e}):"moveTo"==c.value.substr(0,6)&&6<c.value.length&&(e=c.value.substr(6),c={value:"moveTo",ext:e});switch(c.value){case "up":this.blind(a,{P1:0,P2:0,FUNC:2,SSF:0,PAF:0,SMF:0},function(a){d&&d(a)});break;case "down":this.blind(a,{P1:0,P2:0,FUNC:3,SSF:0,PAF:0,SMF:0},function(a){d&&d(a)});break;case "stop":this.blind(a,
{P1:0,P2:0,FUNC:1,SSF:0,PAF:0,SMF:0},function(a){d&&d(a)});break;case "stepUp":e="undefined"==typeof c.ext||null==c.ext?5:parseInt(c.ext);var f=this._states.position?this._states.position.value:null;if("undefined"==typeof f||null==f){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});d&&d(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(e=f+e,100<e&&(e=100)):(e=f-e,0>e&&(e=0));this.blind(a,{P1:e,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||b.activeStateChange({position:e});
d&&d(a)});break;case "stepDown":e="undefined"==typeof c.ext||null==c.ext?5:parseInt(c.ext);f=this._states.position?this._states.position.value:null;if("undefined"==typeof f||null==f){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});d&&d(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(e=f-e,0>e&&(e=0)):(e=f+e,100<e&&(e=100));this.blind(a,{P1:e,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||b.activeStateChange({position:e});d&&d(a)});break;case "moveTo":if("undefined"==
typeof c.ext||null==c.ext){d&&d(Error("value invalid"));break}f=parseInt(c.ext);this.blind(a,{P1:f,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||b.activeStateChange({position:f});d&&d(a)});break;case "setRunTime":if(!c.ext||-1==c.ext.indexOf(":")){d&&d(Error("value invalid"));break}var g=c.ext.split(":");c=g[0];g=g[1];if(!c&&g)c=g;else if(c&&!g)g=c;else if(!c&&!g){d&&d(Error("value invalid"));break}c=parseInt(c);g=parseInt(g);this.blind(a,{P1:c,P2:g,FUNC:7,SSF:0,PAF:0,SMF:0},function(a){a||b.activeStateChange({position:e});
d&&d(a)});break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};var A=function(a){f.call(this,a);this._data="bb-aa-cc";this._vendor="rehau";this._reset_pre_alarm_new=this._reset_alarm_new=null;this._deviceTO=this._startTimeoutTimer();this._prealarmTO=this._alarmTO=null};A.COMMANDS="alertOn alertOff alertToggle resetAlarm resetPreAlarm preAlarmOn preAlarmOff preAlarmToggle".split(" ");A.STATES="battery pre_alarm alarm window pre_alarm_enabled error pending alarm_enabled pre_alarm_enabled_device timeout".split(" ");
A.prototype=new f;A.prototype.constructor=A;A.prototype.setDefaultParams=function(){var a=require("x.hub.m.enocean.js")._rehauHandler,c=a.getSmartguardSetting(this._address),d=!0,e=!0;c&&(d=c.isAlarmActive(),e=c.isPreAlarmActive());this.activeStateChange({pending:!1,alarm_enabled:d,pre_alarm_enabled:e,timeout:!1,alarm_task_active:a.getAlarm(),pre_alarm_task_active:a.getAlarm()})};A.prototype.getStatesBuffer=function(){return this._states};A.prototype.evalData=function(a,c,d){var b=this.evalTelegram(c);
if(b){b.timeout=!1;this._deviceTO&&(clearTimeout(this._deviceTO),this._deviceTO=this._startTimeoutTimer());b.pre_alarm?this._startPreAlarmTimer():this._clearPreAlarmTimer();b.alarm?this._startAlarmTimer():this._clearAlarmTimer();c=this.checkStateChange(b);var e=this;this._executePendingCommand(a,function(){e._reportStates(b)});d&&d(null,c)}else d&&d(Error("data format invalid"))};A.prototype.evalTelegram=function(a){var b={};if(210==a.rorg){var d=a.userData.readUInt8(0);a=a.userData.readUInt8(1);
b.battery=d;b.pre_alarm=a>>7&1?!0:!1;b.alarm=a>>6&1?!0:!1;b.window=a>>5&1?"closed":"open";b.pre_alarm_enabled_device=a>>4&1?!0:!1;b.error=a&15}return b};A.prototype.executeCommand=function(a,c,d){if(c&&c.value){switch(c.value){case "alertOn":this._setAlarm(!0);break;case "alertOff":this._setAlarm(!1);break;case "alertToggle":this._states&&this._states.alarm_enabled?this._setAlarm(!this._states.alarm_enabled.value):this._setAlarm(!0);break;case "resetAlarm":this._reset_alarm_new="on";this.activeStateChange({pending:!0});
break;case "resetPreAlarm":this._reset_pre_alarm_new="on";this.activeStateChange({pending:!0});break;case "preAlarmOn":this._setPreAlarm(!0);break;case "preAlarmOff":this._setPreAlarm(!1);break;case "preAlarmToggle":this._states&&this._states.pre_alarm_enabled?this._setPreAlarm(!this._states.pre_alarm_enabled.value):this.pre_alarm_enabled(!0);break;case "alarmTaskOn":this._setAlarmTask(!0);break;case "alarmTaskOff":this._setAlarmTask(!1);break;case "preAlarmTaskOn":this._setPreAlarmTask(!0);break;
case "preAlarmTaskOff":this._setPreAlarmTask(!1);break;default:d&&d(Error("unknow command"));return}d&&d()}else d&&d(Error("command invalid"))};A.prototype._executePendingCommand=function(a,c){var b={AL:1,RSA:0,RSP:0,PAE:1},d=this._isAlarmActive();b.AL=d?1:0;d=this._isPreAlarmActive();b.PAE=d?1:0;this._reset_alarm_new&&(b.RSA="on"==this._reset_alarm_new?1:0);this._reset_pre_alarm_new&&(b.RSP="on"==this._reset_pre_alarm_new?1:0);var e={pending:!1};1==b.RSP&&(e.pre_alarm=!1);1==b.RSA&&(e.alarm=!1);
this._reset_pre_alarm_new=this._reset_alarm_new=null;var f=this;this._sendVLD(a,b,function(a){f.activeStateChange(e);c&&c(a)})};A.prototype._sendVLD=function(a,c,d){var b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);c=new Buffer([0,(c.AL&1)<<7|(c.RSA&1)<<6|(c.RSP&1)<<5|(c.PAE&1)<<4]);b=new x.hub.m.enocean.ESP3.Telegram.VLD(c,b,0);b.setDstId(this._address);a.sendTelegram(b,!0,function(a){d&&d(a)})};A.prototype._reportStates=function(a){if(a&&0<Object.keys(a).length){var b=require("x.hub.m.enocean.js").getRehauHandler();
b&&(a.alarm_enabled=this.getBufferedState("alarm_enabled"),a.pre_alarm_enabled=this.getBufferedState("pre_alarm_enabled"),b.onReceiveWindowSensorStates(this,a))}};A.prototype._setAlarm=function(a){this.activeStateChange({alarm_enabled:a});require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardAlarm(this._address,a)};A.prototype._setPreAlarm=function(a){this.activeStateChange({pre_alarm_enabled:a});require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardPreAlarm(this._address,a)};A.prototype._setAlarmTask=
function(a){this.activeStateChange({alarm_task_active:a})};A.prototype._setPreAlarmTask=function(a){this.activeStateChange({pre_alarm_task_active:a})};A.prototype._isAlarmActive=function(){var a=!0,c=!0;this._states&&this._states.alarm_enabled&&(c=this._states.alarm_enabled.value,"undefined"==typeof c||null==c)&&(c=!0);if(!c)return!1;this._states&&this._states.alarm_task_active&&(a=this._states.alarm_task_active.value,"undefined"==typeof a||null==a)&&(a=!1);return a};A.prototype._isPreAlarmActive=
function(){var a=!0,c=!0;this._states&&this._states.pre_alarm_enabled&&(c=this._states.pre_alarm_enabled.value,"undefined"==typeof c||null==c)&&(c=!0);if(!c)return!1;this._states&&this._states.pre_alarm_task_active&&(a=this._states.pre_alarm_task_active.value,"undefined"==typeof a||null==a)&&(a=!1);return a};A.prototype._startTimeoutTimer=function(){var a=this;return setTimeout(function(){a.activeStateChange({timeout:!0})},36E5)};A.prototype._startPreAlarmTimer=function(){this._prealarmTO&&clearTimeout(this._prealarmTO);
var a=this;this._prealarmTO=setTimeout(function(){a.activeStateChange({pre_alarm:!1});var b=a.getCurrentStates();a._reportStates(b)},1E4)};A.prototype._clearPreAlarmTimer=function(){this._prealarmTO&&(clearTimeout(this._prealarmTO),this._prealarmTO=null)};A.prototype._startAlarmTimer=function(){this._alarmTO&&clearTimeout(this._alarmTO);var a=this;this._alarmTO=setTimeout(function(){a.activeStateChange({alarm:!1});var b=a.getCurrentStates();a._reportStates(b)},12E4)};A.prototype._clearAlarmTimer=
function(){this._alarmTO&&(clearTimeout(this._alarmTO),this._alarmTO=null)};return{"f6-??-??":d,"f6-01-01":h,"f6-02-01":k,"f6-02-02":m,"f6-02-03":p,"f6-02-04":l,"f6-03-01":t,"f6-03-02":z,"f6-04-01":B,"f6-04-02":K,"f6-05-00":G,"f6-05-01":F,"f6-05-02":w,"f6-10-00":L,"f6-10-01":H,"d5-xx-xx":e,"d5-??-??":J,"d5-00-01":M,"f6-so-da":g,"a5-??-??":q,"a5-02-01":T,"a5-02-02":u,"a5-02-03":da,"a5-02-04":Ob,"a5-02-05":Pb,"a5-02-06":Aa,"a5-02-07":Qb,"a5-02-08":Rb,"a5-02-09":Oa,"a5-02-0a":Sb,"a5-02-0b":Pa,"a5-02-10":Tb,
"a5-02-11":Ub,"a5-02-12":Vb,"a5-02-13":Wb,"a5-02-14":Xb,"a5-02-15":Yb,"a5-02-16":Zb,"a5-02-17":$b,"a5-02-18":ac,"a5-02-19":bc,"a5-02-1a":cc,"a5-02-1b":dc,"a5-02-20":ta,"a5-02-30":ec,"a5-04-01":fc,"a5-04-02":Ba,"a5-04-03":Qa,"a5-06-01":Ca,"a5-06-02":ua,"a5-06-03":Ra,"a5-06-04":Sa,"a5-06-05":gc,a5_07_01:Da,a5_07_02:Ea,a5_07_03:Fa,"a5-08-01":Ga,"a5-08-02":hc,"a5-08-03":ic,"a5-09-02":Ta,"a5-09-04":Ua,"a5-09-05":Va,"a5-09-06":Wa,"a5-09-07":Xa,"a5-09-08":Ya,"a5-09-09":Za,"a5-09-0a":$a,"a5-09-0b":ab,"a5-09-0c":bb,
"a5-10-01":y,"a5-10-02":aa,"a5-10-03":va,"a5-10-04":cb,"a5-10-05":db,"a5-10-06":wa,"a5-10-07":eb,"a5-10-08":ea,"a5-10-09":fa,"a5-10-0a":qa,"a5-10-0b":xa,"a5-10-0c":fb,"a5-10-0d":gb,"a5-10-10":P,"a5-10-11":ra,"a5-10-12":hb,"a5-10-13":ib,"a5-10-14":jb,"a5-12-00":lb,"a5-12-01":ba,"a5-12-02":ya,"a5-12-03":jc,"a5-13-01":kc,"a5-13-02":lc,"a5-13-03":mc,"a5-13-04":nc,"a5-13-05":oc,"a5-13-06":pc,"a5-14-01":mb,"a5-14-02":nb,"a5-14-03":ob,"a5-14-04":pb,"a5-14-05":qb,"a5-14-06":rb,"a5-14-07":sb,"a5-14-08":tb,
"a5-14-09":ub,"a5-14-0a":vb,"a5-20-04":Z,a5_30_01:wb,a5_30_02:xb,a5_30_03:yb,a5_30_04:zb,"a5-38-08":S,"d2-??-??":X,"d2-01-00":ca,"d2-01-01":Ab,"d2-01-03":Bb,"d2-01-11":sa,"d2-01-13":ha,"d2-01-14":ia,"d2-05-00":O,"d2-05-01":na,"d2-06-01":oa,"d2-06-02":pa,"d2-06-50":a,"d2-20-00":U,eltako_dimmer:I,eltako_dimmer2:La,eltako_fsud:Eb,eltako_motion:Db,eltako_contact:Cb,eltako_weather:Fb,eltako_lux:Gb,eltako_lux2:vc,eltako_sender2:xc,eltako_sender4:yc,eltako_button1:wc,eltako_button2:zc,eltako_button4:Ac,
eltako_blind:V,eltako_fsm60b:Hb,eltako_fkf:Ib,eltako_fkc:Jb,eltako_thermo:za,eltako_futh65d:Bc,eltako_ftr78s:Kb,eltako_powermeter:Ma,eltako_powermeter2:Cc,eltako_fzs:Lb,eltako_switch:ja,eltako_relay:Nb,eltako_relay2:Mb,peha_switch:Na,peha_powerswitch:ka,peha_blind:la,"bb-aa-cc":A,parseDBJson:function(a){if(!a||!a.eep)return null;var b=this[a.eep];if(!b)return null;b=new b;return b=b.fromDBJSON(a)},parseJson:function(a){if(!a||!a.data)return null;var b=this[a.data];if(!b)return null;b=new b;return b=
b.fromJSON(a)}}}();
x.hub.m.enocean.SiegeniaHandler=function(){var f=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SiegeniaHandler");this._esp3=a;this._calibateListener=this._window=this._windowID=this._esp3Listener=null};f.prototype.startCalibateWindow=function(a,e){if(this._calibateListener)e&&e(Error("configuraion of window running"));else{this._calibateListener=e;this._windowID=a;this._window=new x.hub.m.enocean.profiles["d2-06-50"];var f=this;this._esp3Listener={_onEOTelegram:function(a){var d=!1;
f._windowID&&f._windowID==a.senderID?d=!0:f._windowID||210!=a.rorg||(d=!0);d&&f._calibateListener&&(d=f._window.evalTelegram(a))&&17==d.type&&f._calibateListener(null,a.senderID,d)}};this._esp3.addListener(this._esp3Listener)}};f.prototype.stopCalibateWindow=function(){this._esp3Listener&&this._esp3.removeListener(this._esp3Listener);this._window=this._windowID=this._calibateListener=this._esp3Listener=null};f.prototype.configWindow=function(a,e,f,d){e="FFFFFFFF";d||(d=x.hub.m.enocean.SENDER_ID);
this._logger.log("info","config siegenia window:"+JSON.stringify(a));this._logger.log("info","window id:"+e+" sender id:"+d);var g=parseInt(a.alive),k=parseInt(a.sync),m=parseInt(a.eep),p=parseInt(a.type),l=parseInt(a.alarm);a=parseInt(a.alarm_sens);var t=[128,2,127,240,1,140,57,45,245],z=[192,13,127,242,49,0,0,2,g>>8&255],B=[193,g&255,0,1,2,k>>8&255,k&255,0,2],K=[194,1,m,0,3,1,p,0,4],G=[195,1,l,0,5,1,a,0,0],F=[128,2,127,240,2,140,57,45,245],w=this;this._logger.log("info","send config siegenia window (data1):"+
(new Buffer(t)).toString("hex"));this._esp3._recomm.sendRawSysEx(new Buffer(t),e,d,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data1):"+a.message+" ["+a.code+"]"),100!=a.code)){f&&f(a);return}w._logger.log("info","send config siegenia window (data2):"+(new Buffer(z)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(z),e,d,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data2):"+a.message+" ["+a.code+"]"),100!=a.code)){f&&f(a);return}w._logger.log("info",
"send config siegenia window (data3):"+(new Buffer(B)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(B),e,d,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data3):"+a.message+" ["+a.code+"]"),100!=a.code)){f&&f(a);return}w._logger.log("info","send config siegenia window (data4):"+(new Buffer(K)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(K),e,d,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data4):"+a.message+" ["+a.code+"]"),
100!=a.code)){f&&f(a);return}w._logger.log("info","send config siegenia window (data5):"+(new Buffer(G)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(G),e,d,function(a){if(a&&(w._logger.log("warn","config siegenia window error (data5):"+a.message+" ["+a.code+"]"),100!=a.code)){f&&f(a);return}w._logger.log("info","send config siegenia window (data6):"+(new Buffer(F)).toString("hex"));w._esp3._recomm.sendRawSysEx(new Buffer(F),e,d,function(a){a&&w._logger.log("warn","config siegenia window error (data5):"+
a.message+" ["+a.code+"]");a&&100!=a.code?f&&f(a):f&&f()})})})})})})};return f}();
x.hub.m.enocean.RehauHandler=function(){var f=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.InoventAccessory");this._inoventID=a;this._co2SensorID=this._humiditySensorID=null;this._sensorRegulationActive=!1;this._humidityState=null;this._humidityLevel=0;this._co2State=null;this._co2Level=0};f.prototype.getHumiditySensorID=function(){return this._humiditySensorID};f.prototype.setHumiditySensorID=function(a){this._humiditySensorID=a};f.prototype.getCo2SensorID=
function(){return this._co2SensorID};f.prototype.setCo2SensorID=function(a){this._co2SensorID=a};f.prototype.activateSensorRegulation=function(){this._sensorRegulationActive=!0;this._co2Level=this._humidityLevel=0;null!=this._humidityState&&this.executeHumidityRegulation(this._humidityState);null!=this._co2State&&this.executeCo2Regulation(this._co2State)};f.prototype.deactivateSensorRegulation=function(){this._sensorRegulationActive=!1;this._co2Level=this._humidityLevel=0};f.prototype.executeHumidityRegulation=
function(a){this._humidityState=a;this._logger.log("trace","["+this._inoventID+"] receive hum:"+a);if(this._sensorRegulationActive){var d=this._calculateHumidityLevel(a);this._logger.log("trace","["+this._inoventID+"] target level:"+d);(!this._humidityLevel||d!=this._humidityLevel&&this._exceedHumidityHysteresis(this._humidityLevel,a))&&this._changeHumLevel(d)}};f.prototype._calculateHumidityLevel=function(a){return 50>=a?1:60>=a?2:70>=a?3:4};f.prototype._exceedHumidityHysteresis=function(a,e){switch(a){case 1:return 55<=
e;case 2:return 45>=e||65<=e;case 3:return 55>=e||75<=e;case 4:return 65>=e}};f.prototype._changeHumLevel=function(a){var d=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setHumLevel"+a},function(e){e&&e.error||(d._humidityLevel=a)})};f.prototype.executeCo2Regulation=function(a){this._co2State=a;this._logger.log("trace","["+this._inoventID+"] receive co2:"+a);if(this._sensorRegulationActive){var d=this._calculateCo2Level(a);this._logger.log("trace","["+this._inoventID+
"] target level:"+d);(!this._co2Level||d!=this._co2Level&&this._exceedCo2Hysteresis(this._co2Level,a))&&this._changeCo2Level(d)}};f.prototype._calculateCo2Level=function(a){return 600>=a?1:1E3>=a?2:1500>=a?3:4};f.prototype._exceedCo2Hysteresis=function(a,e){switch(a){case 1:return 700<=e;case 2:return 500>=e||1100<=e;case 3:return 900>=e||1600<=e;case 4:return 1400>=e}};f.prototype._changeCo2Level=function(a){var d=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setCo2Level"+
a},function(e){e&&e.error||(d._co2Level=a)})};f.prototype.toJSON=function(){return{humidity:this._humiditySensorID,co2:this._co2SensorID}};f.prototype.fromJSON=function(a){a&&(this._humiditySensorID=a.humidity,this._co2SensorID=a.co2)};var a=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.WindowAlarm");this._handler=a;this._active=!1;this._sensors={}};a.prototype.setAlarm=function(a){this._logger.log("trace","set alarm active:"+a);this._active=a};a.prototype.getAlarm=
function(){return this._active};a.prototype.onReceiveWindowSensorStates=function(a,e){this._logger.log("trace","receive window:"+a.getAddress()+" states:"+JSON.stringify(e));if(this._active){var d=a.getAddress(),f=this._sensors[d];f||(this._sensors[d]={lastEvent:"IDLE"},f=this._sensors[d]);this._logger.log("trace","last event for window:"+a.getAddress()+" is:"+f.lastEvent);e&&(e.pre_alarm&&"PRE_ALARM"!=f.lastEvent?(f.lastEvent="PRE_ALARM",this._logger.log("trace","window:"+a.getAddress()+" pre_alarm triggered"),
this.triggerAlarm(!0)):e.alarm&&"ALARM"!=f.lastEvent?(f.lastEvent="ALARM",this._logger.log("trace","window:"+a.getAddress()+" alarm triggered"),this.triggerAlarm()):e.alarm||e.pre_alarm||(this._logger.log("trace","new event for window:"+a.getAddress()+" is:IDLE and stop timer"),f.lastEvent="IDLE"))}};a.prototype.triggerAlarm=function(a){require("x.hub.taskman.js").getRehauAlarmTaskManager().onWindowSensorAlarmTriggered(a)};var e=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.SmartguardSetting");
this._smartguardID=a;this._prealarmActive=this._alarmActive=!0};e.prototype.isAlarmActive=function(){return this._alarmActive?!0:!1};e.prototype.isPreAlarmActive=function(){return this._prealarmActive?!0:!1};e.prototype.setAlarm=function(a){this._alarmActive=a?!0:!1};e.prototype.setPreAlarm=function(a){this._prealarmActive=a?!0:!1};e.prototype.toJSON=function(){return{alarm:this._alarmActive,pre_alarm:this._prealarmActive}};e.prototype.fromJSON=function(a){a&&(this._alarmActive=a.alarm,this._prealarmActive=
a.pre_alarm)};var g=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler");this._mainHandler=null;this._windowAlarm=new a(this);this._inoventAccessories={};this._smartguardSettings={}};g.prototype.REHAU_FILE="enocean_rehau.json";g.prototype.init=function(a,e){this._logger.log("trace","init");var d=this;if(this._mainHandler=a)if(a=a.getDeviceHandler())a.on("deleteDevice",function(a){d.onDeleteDevice(a)});this._loadInoventAccessories(function(a,f,g){a&&d._logger.log("warn",
"init error:"+a.message);f&&(d._inoventAccessories=f);g&&(d._smartguardSettings=g);e&&e()})};g.prototype.getInoventAccessory=function(a){return a?this._inoventAccessories[a]:null};g.prototype.deleteInoventAccessory=function(a,e){a&&this._inoventAccessories[a]?(delete this._inoventAccessories[a],this._saveData(e)):e&&e()};g.prototype.getSmartguardSetting=function(a){return a?this._smartguardSettings[a]:null};g.prototype.deleteSmartguardSetting=function(a,e){a&&this._smartguardSettings[a]?(delete this._smartguardSettings[a],
this._saveData(e)):e&&e()};g.prototype.setHumidityAccessory=function(a,e,g){if(a){var d=this.getInoventAccessory(a);d||(d=new f(a),this._inoventAccessories[a]=d);d.setHumiditySensorID(e);this._saveData(g)}else g&&g(Error("inoventID is null"))};g.prototype.setCo2Accessory=function(a,e,g){if(a){var d=this.getInoventAccessory(a);d||(d=new f(a),this._inoventAccessories[a]=d);d.setCo2SensorID(e);this._saveData(g)}else g&&g(Error("inoventID is null"))};g.prototype.activateSensorRegulation=function(a){(a=
this.getInoventAccessory(a))&&a.activateSensorRegulation()};g.prototype.deactivateSensorRegulation=function(a){(a=this.getInoventAccessory(a))&&a.deactivateSensorRegulation()};g.prototype.isWindowOpen=function(){for(var a=this._mainHandler.getDeviceHandler().findDeviceWithData("bb-aa-cc"),e=!1,f=0;f<a.length;f++){var g=a[f];if(g&&"open"==g.getBufferedState("window")){e=!0;break}}return e};g.prototype.setAlarm=function(a,e){this._windowAlarm.setAlarm(a);for(var d=this._mainHandler.getDeviceHandler().findDeviceWithData("bb-aa-cc"),
f=this._mainHandler.getESP3(),g=0;g<d.length;g++){var h=d[g];h&&(h.executeCommand(f,{value:a?"alarmTaskOn":"alarmTaskOff"}),h.executeCommand(f,{value:a?"preAlarmTaskOn":"preAlarmTaskOff"}))}e&&e()};g.prototype.getAlarm=function(){return this._windowAlarm.getAlarm()};g.prototype.setSmartGuardAlarm=function(a,f,g){if(a){var d=this._smartguardSettings[a];d||(d=new e(a),this._smartguardSettings[a]=d);d.setAlarm(f);this._saveData(g)}else g&&g(Error("smartguardID invalid"))};g.prototype.setSmartGuardPreAlarm=
function(a,f,g){if(a){var d=this._smartguardSettings[a];d||(d=new e(a),this._smartguardSettings[a]=d);d.setPreAlarm(f);this._saveData(g)}else g&&g(Error("smartguardID invalid"))};g.prototype.onReceiveWindowSensorStates=function(a,e){this._windowAlarm.onReceiveWindowSensorStates(a,e)};g.prototype.onDeleteDevice=function(a){if(a&&(a=a.getAddress()))if(this.getInoventAccessory(a))this.deleteInoventAccessory(a);else if(this.getSmartguardSetting(a))this.deleteSmartguardSetting(a);else{var d=!1,e;for(e in this._inoventAccessories){var f=
this._inoventAccessories[e];f&&(f.getHumiditySensorID()==a&&(f.setHumiditySensorID(null),d=!0),f.getCo2SensorID()==a&&(f.setCo2SensorID(null),d=!0))}d&&this._saveData()}};g.prototype.onDeviceEvent=function(a,e){var d=function(a){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f&&"humidity"==f.key){d=f.value;break}}return d},f=function(a){for(var d=null,e=0;e<a.length;e++){var f=a[e];if(f&&"co2"==f.key){d=f.value;break}}return d};if(a){var g=a.getAddress();if(g){var h=null;switch(a.getData()){case "a5-04-01":case "a5-10-12":h=
d(e);break;case "a5-09-08":case "a5-09-09":h=f(e);break;default:return}if(void 0!=h&&null!=h)for(var t in this._inoventAccessories)if(a=this._inoventAccessories[t])a.getHumiditySensorID()==g&&a.executeHumidityRegulation(h),a.getCo2SensorID()==g&&a.executeCo2Regulation(h)}}};g.prototype._loadInoventAccessories=function(a){var d=this;this._loadFile(function(e,f){e?a&&a(e):(e=d._jsonToAccessoriesMap(f),f=d._jsonToSmartGuardSettingsMap(f),a&&a(null,e,f))})};g.prototype._jsonToAccessoriesMap=function(a){if(!a||
!a.inovent)return{};var d={},e;for(e in a.inovent){var g=a.inovent[e];if(g){var p=new f(e);p.fromJSON(g);d[e]=p}}return d};g.prototype._jsonToSmartGuardSettingsMap=function(a){if(!a||!a.smartguard)return{};var d={},f;for(f in a.smartguard){var g=a.smartguard[f];if(g){var p=new e(f);p.fromJSON(g);d[f]=p}}return d};g.prototype._loadFile=function(a){var d=this._getFilePath();fs_extra.ensureFile(d,function(e){e?a&&a(e):fs_extra.readFile(d,"utf8",function(d,e){if(d)a&&a(d);else if(e)try{var f=JSON.parse(e);
a&&a(null,f)}catch(t){a&&a(t)}else a&&a(null,{})})})};g.prototype._getFilePath=function(){var a=require("x.hub.fileman.js").fileManager,e=require("path");require("fs");a=a.getUserRootDataPath();return e.resolve(a,this.REHAU_FILE)};g.prototype._saveData=function(a){var d=this._accessoriesMapToJson(this._inoventAccessories),e=this._settingsMapToJson(this._smartguardSettings);this._saveFile({inovent:d?d:{},smartguard:e?e:{}},function(d){a&&a(d)})};g.prototype._accessoriesMapToJson=function(a){if(!a)return{};
var d={},e;for(e in a){var f=a[e];f&&(f=f.toJSON(),d[e]=f)}return d};g.prototype._settingsMapToJson=function(a){if(!a)return{};var d={},e;for(e in a){var f=a[e];f&&(f=f.toJSON(),d[e]=f)}return d};g.prototype._saveFile=function(a,e){var d=this._getFilePath();fs_extra.writeFile(d,JSON.stringify(a,null,2),function(a){e&&e(a)})};return g}();
x.hub.m.enocean.SDK=function(){var f=function(a){this._handler=a};f.prototype.send_SA_RD_LEARNEDCLIENTS=function(a,e){a=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_RD_LEARNEDCLIENTS;this._handler._esp3.sendSACommand(a,!0,function(a,d){e&&e(a,d)})};f.prototype.send_SA_WR_RESET=function(a,e){a&&a.saClientId?(a=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_RESET(a.saClientId),this._handler._esp3.sendSACommand(a,!0,function(a,d){e&&e(a,d)})):e&&e(Error("params invalid"))};f.prototype.send_SA_WR_POSTMASTER=function(a,
e){a?(a.mailboxCount||(a.mailboxCount=0),a=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_POSTMASTER(a.mailboxCount),this._handler._esp3.sendSACommand(a,!0,e)):e&&e(Error("params invalid"))};return f}();
x.hub.m.enocean.Handler=function(){var f=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Handler");this._secHandler=new this.SecurityHandler(this);this._deviceHandler=new this.DeviceHandler(this);this._esp3=new x.hub.m.enocean.ESP3(this);this._learnHandler=new this.LearnHandler(this);this._siegeniaHandler=new x.hub.m.enocean.SiegeniaHandler(this._esp3);this._rehauHandler=new x.hub.m.enocean.RehauHandler;this._trackers=[];this._sdk=new x.hub.m.enocean.SDK(this)};util.inherits(f,
EventEmitter);f.prototype.SENSOR_FILE="enocean.json";f.prototype.SECURITY_FILE="enocean_sec.json";f.prototype.ESP3=x.hub.m.enocean.ESP3;f.prototype.SecurityHandler=x.hub.m.enocean.SecurityHandler;f.prototype.LearnHandler=x.hub.m.enocean.LearnHandler;f.prototype.DeviceHandler=x.hub.m.enocean.DeviceHandler;f.prototype.getDeviceHandler=function(){return this._deviceHandler};f.prototype.getRehauHandler=function(){return this._rehauHandler};f.prototype.getESP3=function(){return this._esp3};f.prototype.init=
function(a){localStorage&&localStorage.getItem("x.hub.m.enocean.SENDER_ID")&&(x.hub.m.enocean.SENDER_ID=localStorage.getItem("x.hub.m.enocean.SENDER_ID"));var e=this,f=require("x.hub.eventbus.js");f.on("x.hub.peripheralman.ADD_ENOCEAN",function(a){e._esp3.attachSerial(a.port)});f.on("x.hub.peripheralman.REMOVE_ENOCEAN",function(a){e._esp3.removeSerial(a.port)});global.ENOCEAN_PORT&&"A20"!=global.PLATFORM&&"PI2"!=global.PLATFORM&&e._esp3.attachSerial(global.ENOCEAN_PORT);this._secHandler.init(function(){e._rehauHandler.init(e,
function(){e._deviceHandler.init(function(){a&&a({})})})})};f.prototype.getSystems=function(){return["enocean"]};f.prototype.addStateDevice=function(a,e){e&&e({})};f.prototype.getAllStates=function(){var a=[],e=this._deviceHandler.getAllDevices(),f;for(f in e)if(e.hasOwnProperty(f)){var d=e[f];d&&a.push({device:d.toJSON(),states:d.getStatesBuffer()})}return a};f.prototype.getStates=function(a){if(!a||!a.address)return null;var e=null;(a=this._deviceHandler.getDevice(a.address.toLowerCase()))&&(e=
a.getStatesBuffer());return e};f.prototype.getState=function(a,e,f){var d=this.getStates(a),g=null;d&&"undefined"!=typeof d[e]&&null!=d[e]?(g=d[e],f&&f({data:g})):f&&this.updateStates(a,function(a){a.error?f&&f(a):(a.data&&(g=d[e]),f({data:g}))});return g};f.prototype.executeCommand=function(a,e,f){this._esp3._baseID?this._esp3._baseID.toLowerCase()!=x.hub.m.enocean.SENDER_ID.toLowerCase()?f&&f({error:Error("enocean stick has a different baseID")}):a&&a.address?((a=a.address)&&(a=a.toLowerCase()),
(a=this._deviceHandler.getDevice(a))?a.executeCommand?a.executeCommand(this._esp3,e,function(a){f&&f({error:a})}):f&&f({error:Error("device dese not support command")}):f&&f({error:Error("no such device")})):f&&f({error:Error("device invalid")}):f&&f({error:Error("enocean stick not found")})};f.prototype.checkDeviceMatch=function(a,e){if(!(e&&e.device&&a&&a.device))return!1;(a=a.device.address)&&(a=a.toLowerCase());(e=e.device.address)&&(e=e.toLowerCase());return a==e};f.prototype.updateStates=function(a,
e){e&&e({error:Error("not supported yet")})};f.prototype.executeCommandLegacy=function(a,e,f,d){a?d&&d({error:Error("not supported yet")}):this._esp3?e?this.executeCommand({address:e},{value:f},function(a){d&&d({error:a?a.error:null})}):d&&d({error:Error("address invalid")}):d&&d({error:Error("not inited")})};f.prototype.getAllStatesLegacy=function(a,e){var f=[],d=this.getAllStates(),h=this._secHandler.getUnsyncDevice();d.forEach(function(a){if(a&&a.device&&a.states){var d=a.device.address,g={type:"ENOCEAN",
adr:d,data:a.device.data,vendor:a.device.vendor,state:{}},k;for(k in a.states)g.state[k]=a.states[k].value;e&&"1"==e.config&&(g.senderID=a.device.senderID,g.virtual=a.device.virtual,g.params=a.device.params,d&&h[d]&&(g.rlc_unsync=!0));f.push(g)}});a&&a({data:f})};f.prototype.getEnoceanInfo=function(){return{baseID:x.hub.m.enocean.SENDER_ID,usb_connected:null!=this._esp3._serial,usb_baseID:this._esp3._baseID,num_free_senderID:this._deviceHandler.getFreeSenderIdCount()}};f.prototype.learnDevice=function(a,
e){var f=a?a.senderID:null,d=a?a.data:null,h=a?a.vendor:null,k=a?a.address:null;if(k){d=this._deviceHandler.findDevice(a);if(!d){e&&e({error:Error("device not found")});return}a=d.toJSON();d=a.data;h=a.vendor;f||(sednerID=a.senderID)}this._learnHandler.learn(d,k,f,h,null,function(a,d,f){a?e&&e({error:a}):(a={},1==d?a.op=1:(a=f.toJSON(),a.op=0),e&&e({data:a}))})};f.prototype.learnSoda=function(a){if(this._esp3._serial){var e=this,f=setTimeout(function(){e._esp3.removeListener(d);a&&a({error:Error("learn timeout")})},
2E4),d={_onEOTelegram:function(g){if(246==g.rorg&&(192==g.userData||208==g.userData||240==g.userData)){clearTimeout(f);e._esp3.removeListener(d);var h={address:g.senderID,data:"f6-so-da",vendor:"soda"};e.addSensor(g.senderID,"f6-so-da","soda",null,function(d){d.error?a&&a(d):a&&a({data:h})})}}};this._esp3.addListener(d)}else a&&a({error:Error("port not opened")})};f.prototype.teachinDevice=function(a,e){if(a)if(a.data){var f=this._deviceHandler.findDevice(a);!f&&a.address?e&&e({error:Error("device not found")}):
(f=f?f.toJSON():a,a.data!=f.data?e&&e({error:Error("device of another type with the same address exists")}):a.vendor&&a.vendor!=f.vendor?e&&e({error:Error("device of another vendor with the same address exists")}):this._learnHandler.teachin(f.data,f.address,f.senderID,f.vendor,function(a,f,g){a?e&&e({error:a}):(a={},f&&(a=f.toJSON()),g&&(a.op=g),e&&e({data:a}))}))}else e&&e({error:Error("data is null")});else e&&e({error:Error("query is null")})};f.prototype.generateVirtualDevice=function(a,e){this._deviceHandler.generateVirtual(a,
function(a,d){e&&e({error:a,data:d?d.toJSON():null})})};f.prototype._onEOFrame=function(a,e){this._trackers.forEach(function(f){f.onFrame(a,e)})};f.prototype._onEOTelegram=function(a){this._trackers.forEach(function(d){d.onTelegram(a)});var e=this._deviceHandler.getDevice(a.senderID);if(e){var f=this;e.evalData(this._esp3,a,function(a,g){a||f._onEOEvents(e,g)})}};f.prototype._onEOEvents=function(a,e){var f=require("x.hub.eventbus.js");this._trackers.forEach(function(d){d.onResolveEvents(a._address,
e)});this._rehauHandler.onDeviceEvent(a,e);var d=a.toJSON();d.sys="aio";d.type="ENOCEAN";for(var h=0;h<e.length;h++){var k=e[h];if(k&&("shortPress"==k.value||"longPress"==k.value)){var m={type:"ENOCEAN",adr:d.address,data:d.data,vendor:d.vendor,state:{}};m.state[k.key]=k.value;f.emit("gatewayevent",m,{address:"ENOCEAN"},"BTN")}}if(d=a.getStatesLegacy())f.emit("gatewayevent",d,{address:"ENOCEAN"},"STA"),f.emit("udpevent",d,"STA")};f.prototype._saveEnoceanEvents=function(a,e){var f=require("x.hub.datastore.js").dataStore;
f&&f.openDB(function(d,f){if(!d){d=a._address;for(var g=[],h=(new Date).toISOString(),p=0;p<e.length;p++){var l=e[p];if(l&&l.changed){l=l.key+":"+l.value;var t=null;t=0==g.length?"SELECT '"+d+"' AS 'window', '"+l+"' AS 'state', '"+h+"' AS 'time'":"UNION ALL SELECT '"+d+"', '"+l+"', '"+h+"'";g.push(t)}}0<g.length&&(d=g.join(" "),f.run("INSERT INTO windowstate(window, state, time) "+d+";",function(a){f.close()}))}})};f.prototype.addSensor=function(a,e){a?a.data?"siegenia"!=a.vendor||a.params?this._deviceHandler.addDevice(a,
function(a,d){e&&e({error:a,data:d?d.toJSON():null})}):e&&e({error:Error("siegenia windows params is null")}):e&&e({error:Error("enocean profile is null")}):e&&e({error:Error("enocean device is null")})};f.prototype.updateSensor=function(a,e,f){a?e?this._deviceHandler.updateDevice(a,e,function(a,e){f&&f({error:a,data:e?e.toJSON():null})}):f&&f({error:Error("device info is null")}):f&&f({error:Error("device address is null")})};f.prototype.delSensor=function(a,e){a?this._deviceHandler.deleteDevice({address:a},
function(a){e&&e({error:a})}):e&&e({error:Error("enocean id is null")})};f.prototype.resetDefaultSenderID=function(a){x.hub.m.enocean.SENDER_ID=null;localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID","");a&&a({})};f.prototype.setRehauAlarm=function(a,e){this._rehauHandler.setAlarm(a,e)};f.prototype.isRehauWindowOpen=function(){return this._rehauHandler.isWindowOpen()};f.prototype.setInoventHumidityAccessory=function(a,e,f){this._rehauHandler.setHumidityAccessory(a,e,function(a){f&&f({error:a})})};
f.prototype.setInoventCo2Accessory=function(a,e,f){this._rehauHandler.setCo2Accessory(a,e,function(a){f&&f({error:a})})};f.prototype.getInoventAccessories=function(a,e){a=this._rehauHandler.getInoventAccessory(a);e&&e({data:a?a.toJSON():{}})};f.prototype.__addTelegramTracker=function(a){a&&a.onTelegram&&a.onResolveEvents&&-1==this._trackers.indexOf(a)&&this._trackers.push(a)};f.prototype.__removeTelegramTracker=function(a){a&&(a=this._trackers.indexOf(a),-1!=a&&this._trackers.splice(a,1))};f.prototype.__sendEspFrame=
function(a,e,f,d,h){e=e?new Buffer(e,"hex"):null;f=f?new Buffer(f,"hex"):null;d=d?!0:!1;a=new x.hub.m.enocean.ESP3.ESP3_Frame(a,e,f);this._esp3.sendFrame(a,d,function(a,d){h&&h({error:a,data:d?d.toJSON():null})})};f.prototype.__simulateRawEnoceanPacket=function(a,e){this._esp3.onSerialData(new Buffer(a,"hex"));e&&e()};f.prototype._doSDK=function(a,e){if(a&&a.method){var f="send_"+a.method;if(this._sdk[f])this._sdk[f](a.params,function(a){e&&e({error:a})});else e&&e({error:Error("no such method")})}else e&&
e({error:Error("data invalid")})};return f}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.enocean.Handler);
