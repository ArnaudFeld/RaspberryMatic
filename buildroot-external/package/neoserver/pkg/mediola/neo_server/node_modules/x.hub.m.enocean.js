var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(e){var b=0;return function(){return b<e.length?{done:!1,value:e[b++]}:{done:!0}}};$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,b,a){e!=Array.prototype&&e!=Object.prototype&&(e[b]=a.value)};$jscomp.getGlobal=function(e){e=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,e];for(var b=0;b<e.length;++b){var a=e[b];if(a&&a.Math==Math)return a}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(e,b){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function e(a){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(a||"")+"_"+b++,a)}var b=0;return e}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};
$jscomp.iteratorFromArray=function(e,b){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var a=0,g={next:function(){if(a<e.length){var d=a++;return{value:b(d,e[d]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill=function(e,b,a,g){if(b){a=$jscomp.global;e=e.split(".");for(g=0;g<e.length-1;g++){var d=e[g];d in a||(a[d]={});a=a[d]}e=e[e.length-1];g=a[e];b=b(g);b!=g&&null!=b&&$jscomp.defineProperty(a,e,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
var util=require("util"),EventEmitter=require("events"),crypto=require("crypto"),fs_extra=require("fs-extra"),fileman=require("x.hub.fileman.js"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.enocean=x.hub.m.enocean||{};x.hub.m.enocean.SENDER_ID=null;x.hub.m.enocean.MANUFACTURE_ID=2047;
x.hub.m.enocean._CRC8Table=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,
149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243];
x.hub.m.enocean.CRC8=function(e){for(var b=0,a=0;a<e.length;a++)b=x.hub.m.enocean._CRC8Table[b^e[a]];return b};
x.hub.m.enocean.Serial=function(){var e=function(b,a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Serial.("+b+")");this._port=b;this._serialPort=null;this._baudrate=a;this._baudrate||(this._baudrate=57600)};e.prototype.getPort=function(){return this._port};e.prototype.setListener=function(b){this._listener=b};e.prototype.open=function(b){if(this._serialPort)this._logger.log("warn","port:"+this._port+" already opened"),b&&b();else{var a=b;try{this._logger.log("trace","try to listen to port:"+
this._port);var g=require("serialport");if(g){var d=g.SerialPort?new g.SerialPort(this._port,{baudrate:this._baudrate}):new g(this._port,{baudRate:this._baudrate});var l=this;d.on("open",function(){l._logger.log("trace","port:"+l._port+" opened");l._serialPort=d;d.flush(function(){a&&a();a=null})});d.on("error",function(d){l._logger.log("warn","enocean error:"+d.message);l._serialPort=null;if(a)a&&a(d),a=null;else if(l._listener&&l._listener.onSerialError)l._listener.onSerialError(d)});d.on("data",
function(a){l._logger.log("trace","receive data "+a.toString("hex"));if(l._listener&&l._listener.onSerialData)l._listener.onSerialData(a)});d.on("close",function(){l._logger.log("trace","port closed")})}else this._logger.log("warn","no seiralport module"),b&&b(Error("no seiralport modul"))}catch(h){this._logger.log("warn","init enocean via "+this._port+" error:"+h.message),a&&a(h),a=null}}};e.prototype.close=function(){this._listener=null;try{this._serialPort&&this._serialPort.close()}catch(b){this._logger.log("warn",
"close enocean via "+this._port+" error:"+b.message)}this._serialPort=null};e.prototype.sendPacket=function(b,a){this._serialPort?this._serialPort.write(b,a):a&&a(Error("port not opened"))};return e}();
x.hub.m.enocean.ReComm=function(){var e=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ReComm");this._esp3=b};e.prototype.sendRawSysEx=function(b,a,g,d){var l=this;b=new x.hub.m.enocean.ESP3.Telegram.ADT(197,b,a,g);this._esp3.sendTelegram(b,!0,function(a,g){setTimeout(function(){a?(l._logger.log("warn","ReComm command failed with err:"+a.message),d&&d(a)):g&&0!=g.retCode?(l._logger.log("warn","ReComm command failed with retCode:"+g.retCode),a=Error("ReComm command failed:"+
g.retCode),a.code=g.retCode,d&&d(a,g)):d&&d(null,g)},50)})};return e}();
x.hub.m.enocean.SecurityHandler=function(){var e=new Buffer("3410de8f1aba3eff9f5a117172eacabd","hex"),b=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SecurityHandler");this._secInfo={};this._unsync={}};b.prototype.SECURITY_FILE="enocean_sec.json";b.prototype.init=function(a){this._logger.log("trace","init");var g=this;this._loadSec(function(d,b){d&&g._logger.log("warn","init error:"+d.message);b&&(g._secInfo=b);a&&a()})};b.prototype.getUnsyncDevice=function(){return this._unsync};
b.prototype.isSecureDevice=function(a){return this._secInfo[a]};b.prototype.secureTeachIn=function(a,g,d){this._logger.log("trace","secure teach-in:"+a);a&&(g.key&&delete g.key,this._secInfo[a]=g);this._saveSec(this._secInfo,d)};b.prototype.resolve=function(a){if(!a)return null;switch(a.rorg){case 53:return this._resolveSecureTeachIn(a);case 49:return this._resolveSecureMessage(a);default:return null}};b.prototype._resolveSecureTeachIn=function(a){var g={};a=a.userData;var d=a.readUInt8(0);g.teachInInfo=
{};g.teachInInfo.idx=d>>6&3;g.teachInInfo.cnt=d>>4&3;g.teachInInfo.psk=d>>3&1;g.teachInInfo.type=d>>2&1;g.teachInInfo.info=d&3;0==g.teachInInfo.idx?(d=a.readUInt8(1),g.slf={},g.slf.rlc_algo=d>>6&3,g.slf.rlc_tx=d>>5&1,g.slf.mac_alro=d>>3&3,g.slf.data_enc=d&7,d=0,1==g.slf.rlc_algo?d=2:2==g.slf.rlc_algo&&(d=3),d&&(g.rlc=a.slice(2,2+d)),g.key=a.slice(2+d),g.completeKey=null):g.key=a.slice(1);return g};b.prototype._resolveSecureMessage=function(a){var g=a.senderID,d=this._secInfo[g];if(!d||!d.completeKey)return null;
var b=0,h=0;1==d.slf.mac_alro?b=3:2==d.slf.mac_alro&&(b=4);1==d.slf.rlc_tx&&(1==d.slf.rlc_algo?h=2:2==d.slf.rlc_algo&&(h=3));var k=a.userData.length-b-h,n=a.userData.slice(0,k),q=null,p=null;h&&(p=a.userData.slice(k,k+h));b&&(q=a.userData.slice(k+h));b=p?p:d.rlc;h=!0;q&&(q=this.checkCmac(a.rorg,n,b,d.completeKey,q),q.rlc&&b.toString("hex")!=q.rlc.toString("hex")&&(b=q.rlc,d.rlc=q.rlc),q&&q.ok?(this._logger.log("trace","receive from "+g+" with cmac rlc:"+b.toString("hex")),delete this._unsync[g]):
(h=!1,this._logger.log("warn","receive from "+g+" with cmac out of snyc, last rlc:"+b.toString("hex")),this._unsync[g]=b.toString("hex")));g=null;h&&3==d.slf.data_enc&&(n=this.decryptVAES(b,e,d.completeKey,n),g=a.convertToPacket(n).toRadioTelegram());d.rlc=this._incRLC(b);this._logger.log("trace","senderID next rlc:"+d.rlc.toString("hex"));this._saveSec(this._secInfo);return g};b.prototype.decryptVAES=function(a,g,d,b){for(var l=b.length,k=Math.ceil(l/16),e=[],q=null,p=0;p<k;p++){var u=16*p,E=u+16;
E>l&&(E=l);u=b.slice(u,E);q=this._doVAESblock(a,g,d,q,u);e.push(q.data);q=q.enc}return Buffer.concat(e)};b.prototype._doVAESblock=function(a,g,d,b,h){a=this._xor(a,g);b&&(a=this._xor(a,b));d=this._doAES128(d,null,a);b=this._xor(d,h);b=b.slice(0,h.length);return{data:b,enc:d}};b.prototype.checkCmac=function(a,g,d,b,h){if(d){for(var k=this._bufToInt(d),l=0;128>l;l++){if(0!=l){k+=1;var e=65535;3==d.length&&(e=16777215);k>e&&(k=0)}e=this._intToBuf(k,d.length);e=this.calcCmac(a,g,e,b,h.length);if(e.toString("hex")==
h.toString("hex"))return{ok:!0,rlc:this._intToBuf(k,d.length)}}return{ok:!1,rlc:this._intToBuf(k,d.length)}}e=this.calcCmac(a,g,null,b,h.length);return e.toString("hex")==h.toString("hex")?{ok:!0}:{ok:!1}};b.prototype.calcCmac=function(a,g,d,b,h){var k=this._getCmacSubkey(b),l=new Buffer(1);l.writeUInt8(a);l=Buffer.concat([l,g]);d&&(l=Buffer.concat([l,d]));a=l.length;g=Math.ceil(a/16);d=null;for(var e=0;e<g;e++){var p=16*e;var u=p+16;u>a&&(u=a);p=l.slice(p,u);d=p=this._doCmacBlock(b,k.k1,k.k2,p,d)}return p.slice(0,
h)};b.prototype._doCmacBlock=function(a,g,d,b,h){for(var k=new Buffer(16),l=0;16>l;l++)l<b.length?k.writeUInt8(b.readUInt8(l),l):l==b.length?k.writeUInt8(128,l):k.writeUInt8(0,l);h&&(k=this._xor(k,h));k=16>b.length?this._xor(k,d):this._xor(k,g);return this._doAES128(a,null,k)};b.prototype._getCmacSubkey=function(a){var g=new Buffer("00000000000000000000000000000000","hex");var d=new Buffer("00000000000000000000000000000087","hex");g=this._doAES128(a,null,g);a=new Buffer(g.toString("hex"),"hex");this._bufShiftLeft(a,
1);g.readUInt8(0)&128&&(a=this._xor(a,d));g=new Buffer(a.toString("hex"),"hex");this._bufShiftLeft(g,1);a.readUInt8(0)&128&&(g=this._xor(g,d));return{k1:a,k2:g}};b.prototype._doAES128=function(a,g,d){g||(g=new Buffer("00000000000000000000000000000000","hex"));a=crypto.createCipheriv("aes128",a,g);a.setAutoPadding(!1);d=a.update(d);a=a.final();return Buffer.concat([d,a])};b.prototype._xor=function(a,g){for(var d=Math.max(a.length,g.length),b=new Buffer(d),h=0;h<d;h++){var k=0,e=0;h<a.length&&(k=a.readUInt8(h));
h<g.length&&(e=g.readUInt8(h));b.writeUInt8(k^e,h)}return b};b.prototype._bufShiftLeft=function(a,g){if(g!==(g|0))throw Error("shiftBits must be a 32 bit int");var d=2*((g>>4)+(0!==(g&15)));g=8*d-g;for(var b=0,h=0;h-d<a.length;h+=2)if(b<<=16,h<a.length-1?b|=a.readUInt16BE(h):h<a.length&&(b|=a[h]<<8),0<=h-d)if(h-d<a.length-1)a.writeUInt16BE(b>>>g&65535,h-d);else{if(h-d!==a.length-1)throw Error();a[h-d]=b>>>g+8}else-1===h-d&&(a[0]=b>>>g)};b.prototype._bufToInt=function(a){a=a.toString("hex");return parseInt(a,
16)};b.prototype._intToBuf=function(a,b){for(a=a.toString(16);a.length<2*b;)a="0"+a;return new Buffer(a,"hex")};b.prototype._incRLC=function(a){var b=this._bufToInt(a);b+=1;var d=65535;3==a.length&&(d=16777215);b>d&&(b=0);return this._intToBuf(b,a.length)};b.prototype._getFile=function(){var a=require("x.hub.fileman.js").fileManager,b=require("path");require("fs");a=a.getUserRootDataPath();return b.resolve(a,this.SECURITY_FILE)};b.prototype._loadSec=function(a){var b=this._getFile();fs_extra.ensureFile(b,
function(d){d?a&&a(d):fs_extra.readFile(b,"utf8",function(d,b){if(d)a&&a(d);else{try{var g=JSON.parse(b);for(var l in g)if(g.hasOwnProperty(l)){var h=g[l];h.rlc&&(h.rlc=new Buffer(h.rlc,"hex"));h.completeKey&&(h.completeKey=new Buffer(h.completeKey,"hex"))}}catch(p){}a&&a(null,g)}})})};b.prototype._saveSec=function(a,b){var d=this._getFile(),g={},h;for(h in a)g[h]={},g[h].teachInInfo=a[h].teachInInfo,g[h].slf=a[h].slf,g[h].rlc=a[h].rlc.toString("hex"),g[h].completeKey=a[h].completeKey.toString("hex");
fs_extra.writeFile(d,JSON.stringify(g,null,2),function(a){b&&b(a)})};return b}();
x.hub.m.enocean.LearnHandler=function(){var e=function(){var a=function(a){this._handler=a};a.prototype.onTelegram=function(a){var d=this;switch(a.rorg){case 176:if(this._isProfileMatch(a.getManufacturerId(),a.getProductId())){var b={address:a.senderID,data:this._getLearnProfile(),vendor:this._getLearnVendor(),senderID:x.hub.m.enocean.SENDER_ID,gpInfo:a.toJSON()};if(0==a.purpose)this._handler._controller._deviceHandler.onLearnDevice(null,b,function(b,g){b?d._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,
a.senderID,function(){d._handler._learnFinish(b,-1,g)}):d._sendTeachInResponse(1,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){d._handler._learnFinish(b,0,g)})});else if(1==a.purpose)this._handler._controller._deviceHandler.deleteDevice(b,function(b,g){b?d._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){d._handler._learnFinish(b,-1,g)}):d._sendTeachInResponse(2,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){d._handler._learnFinish(b,1,g)})});else if(2==a.purpose)this._handler._controller._deviceHandler.onLearnAddDeleteDevice(b,
function(b,g,l){b?d._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){d._handler._learnFinish(b,g,l)}):d._sendTeachInResponse(0==g?1:2,null,x.hub.m.enocean.SENDER_ID,a.senderID,function(){d._handler._learnFinish(b,g,l)})})}}};a.prototype._sendTeachInResponse=function(a,d,b,h,k){b||(b=x.hub.m.enocean.SENDER_ID);a=new x.hub.m.enocean.ESP3.Telegram.GP_TR(2047,a,d,b,0);a.setDstId(h);this._handler._controller._esp3.sendTelegram(a,!0,function(a){k&&k(a)})};a.prototype._isProfileMatch=
function(a,d){var b=this._handler._learnProfile;if(!b||"gp"==b)return!0;var g=x.hub.m.enocean.profiles[b];if(!g)return!1;g=new g;return g._data!=b?!1:g.isGPMatch?g.isGPMatch(a,d):!0};a.prototype._getLearnProfile=function(){return this._handler._learnProfile?this._handler._learnProfile:"gp"};a.prototype._getLearnVendor=function(){return this._handler._learnVendor};return a}(),b=function(a){this._controller=a;this._learning=!1;this._saParams=this._learnVendor=this._learnSenderID=this._learnAddress=
this._learnProfile=this._learnCallback=null;this._secTeachInFrames={};this._teaching=!1;this._teachingTO=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;var b=this;this._teachinTelegramCB={_onEOTelegram:function(a){b.onTeachInResponseTelegram(a)}};this._gpLearn=new e(this)};b.prototype.learn=function(a,b,d,l,e,k,n){if(this._learning)k&&k(Error("learning process running"));else if(this._teaching)k&&k(Error("teach-in process running"));else{if(!e||0>=
e)e=3E4;this._learning=!0;this._learnCallback=k;this._learnProfile=a?a.toLowerCase():null;this._learnAddress=b?b.toLowerCase():null;this._learnVendor=l?l:"general";this._learnSenderID=d?d.toLowerCase():null;this._secTeachInFrames={};this._saParams=null;!a||"bb-aa-cc"!=a.toLowerCase()&&"d2-06-10"!=a.toLowerCase()&&"d2-06-ff"!=a.toLowerCase()||(this._saParams={extended:1},n&&"undefined"!=typeof n.saLearnMode&&null!=n.saLearnMode&&(a=parseInt(n.saLearnMode),isNaN(a)&&(a=1),0>a&&(a=1),2<a&&(a=1),this._saParams.extended=
a));var g=this;this._controller._esp3.startLearn(this,e,this._saParams,function(a){if(a){var d=g._learnCallback;g._learning=!1;g._learnProfile=null;g._learnCallback=null;g._secTeachInFrames={};d&&d(a)}})}};b.prototype.onLearnTimeout=function(){this._learnFinish(Error("learn timeout"))};b.prototype.onTelegram=function(a){if(a){if(this._learnProfile){var b=x.hub.m.enocean.profiles[this._learnProfile];if(b&&(b=new b,b.handleLearnTelegram)){b.handleLearnTelegram(this,a);return}}switch(a.rorg){case 212:0==
a.cmd&&this._learnUTE(a);break;case 213:0==a.getLearnBit()&&this._learn1BS(a);break;case 165:0==a.getLearnBit()&&this._learn4BS(a);break;case 176:case 177:this._gpLearn.onTelegram(a);break;case 246:this._learnRPS(a);break;case 53:var d=this._controller._secHandler.resolve(a);a=a.senderID;b=this._secTeachInFrames[a];d&&(d.teachInInfo&&0==d.teachInInfo.idx?(b||(this._secTeachInFrames[a]=[],b=this._secTeachInFrames[a]),b.push(d)):d.teachInInfo&&0!=d.teachInInfo.idx&&b&&b.push(d));if(b&&b[0]&&(d=b[0])&&
d.teachInInfo){var l=d.teachInInfo.cnt;if(l&&b.length==l){if(1<l){l=[];for(var e=0;e<b.length;e++)l.push(b[e].key);d.completeKey=Buffer.concat(l)}else d.completeKey=d.key;this._controller._secHandler.secureTeachIn(a,d)}}}}};b.prototype.onEvent=function(a){if(a&&a instanceof x.hub.m.enocean.ESP3.Event.SA_CONFIRM_LEARN){var b=a.getEEP();if(!this._learnProfile||this._isLearningProfileEquals(b)){var d=this._learnProfile?this._learnProfile:b,l=this,e=x.hub.m.enocean.profiles[d];if(!e){var k=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,
17);this._controller._esp3.sendResponse(k,function(a){l._learnFinish(Error("eep not supported"))})}e=new e;var n=a.getPMCandidateId();n||(n=e.UNIQUE_GATEWAY_SENDERID?this._controller._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID);b={address:a.getSAClientId(),data:d,vendor:this._learnVendor,senderID:n,hopCount:a.getHopCount(),saLearnMode:this._saParams?this._saParams.extended:null,originalEEP:b};this._controller._deviceHandler.onLearnAddDeleteDevice(b,function(d,b,g){if(d)k=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,
19),l._controller._esp3.sendResponse(k,function(a){l._learnFinish(a)});else{d=0;1==b&&(d=32);var e=a.getHopCount();k=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(128*(e+1),d);l._controller._esp3.sendResponse(k,function(a){l._learnFinish(a,b,g)})}})}}};b.prototype.onTeachInResponseTelegram=function(a){if(a&&this._teaching){var b=this;if(this._teachProfile){var d=x.hub.m.enocean.profiles[this._teachProfile];if(d&&(d=new d,d.handleTeachinTelegram)){d.handleTeachinTelegram(this,a);return}}switch(a.rorg){case 165:if(0==
a.getLearnBit()&&1==a.getLearnStatus()){d=a.getFunc();var e=a.getType();this._toProfileStr(165,d,e);if(1==a.getLearnResult())this._controller._deviceHandler.onLearnDevice({address:this._teachID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},{address:a.senderID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},function(a,d){b._teachFinish(a,d)});else 0==a.getLearnResult()&&(a=this._controller._deviceHandler.getDevice(this._teachID),b._teachFinish(null,
a,1))}}}};b.prototype._learnRPS=function(a){var b=this._getRealProfile(this._learnProfile),d=this;b&&"f6"!=b.substr(0,2)||((b=this._learnProfile)||(b="f6-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:b,vendor:this._learnVendor},function(a,b){d._learnFinish(a,0,b)}))};b.prototype._learn1BS=function(a){var b=this,d=this._getRealProfile(this._learnProfile);
d&&"d5"!=d.substr(0,2)||((d=this._learnProfile)||(d="d5-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:d,vendor:this._learnVendor},function(a,d){b._learnFinish(a,0,d)}))};b.prototype._learn4BS=function(a){if(0==a.getLearnType())this._learn4BSV1(a);else{var b=a.getFunc(),d=a.getType();b=this._toProfileStr(165,b,d);(b=x.hub.m.enocean.profiles[b])&&
(3==(new b).TEACH_IN_VARIATION?this._learn4BSV3(a):this._learn4BSV2(a))}};b.prototype._learn4BSV1=function(a){var b=this._getRealProfile(this._learnProfile);if(b){if("a5"!=b.substr(0,2))return;b=x.hub.m.enocean.profiles[this._learnProfile];if(!b||1!=(new b).TEACH_IN_VARIATION)return}var d=this;(b=this._learnProfile)||(b="a5-??-??");this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,
senderID:this._learnSenderID,data:b,vendor:this._learnVendor},function(a,b){d._learnFinish(a,0,b)})};b.prototype._learn4BSV2=function(a){var b=a.getFunc(),d=a.getType();b=this._toProfileStr(165,b,d);if(!this._learnProfile||this._isLearningProfileEquals(b))if(b=this._learnProfile?this._learnProfile:b,d=x.hub.m.enocean.profiles[b])if(3==(new d).TEACH_IN_VARIATION)this._learn4BSV3(a);else{var e=this;this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,
data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:this._learnSenderID,data:b,vendor:this._learnVendor},function(a,d){e._learnFinish(a,0,d)})}};b.prototype._learn4BSV3=function(a){var b=a.getFunc(),d=a.getType();b=this._toProfileStr(165,b,d);if(!this._learnProfile||this._isLearningProfileEquals(b)){b=this._learnProfile?this._learnProfile:b;d=x.hub.m.enocean.profiles[b];var e=this;if(d){d=new d;var h=e._learnSenderID;!h&&d.UNIQUE_GATEWAY_SENDERID&&(h=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId());
this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:h,data:this._learnProfile,vendor:this._learnVendor},{address:a.senderID,senderID:h,data:b,vendor:this._learnVendor},function(d,b){d?e._send4BSResponse(null,1,0,a,function(){e._learnFinish(d,0,b)}):e._send4BSResponse(h,1,1,a,function(){e._learnFinish(null,0,b)})})}else this._send4BSResponse(null,0,0,a,function(){e._learnFinish(Error("eep not supported"))})}};b.prototype._send4BSResponse=function(a,b,d,e,h){a||(a=x.hub.m.enocean.SENDER_ID);
var g=e.getFunc(),l=e.getType();e.getManufacturerId();a=new x.hub.m.enocean.ESP3.Telegram.BS4(new Buffer([(g&63)<<2|l>>5&3,(l&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128|b<<6|d<<5|16]),a,0);a.setDstId(e.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){h&&h(a)})};b.prototype._learnUTE=function(a){var b=this._toProfileStr(a.eepRorg,a.eepFunc,a.eepType),d,e=this;if(!this._learnProfile||this._isLearningProfileEquals(b)){b=this._learnProfile?this._learnProfile:
b;var h=x.hub.m.enocean.profiles[b];if(h)switch(h=new h,(d=this._learnSenderID)||(d=h.UNIQUE_GATEWAY_SENDERID?require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID),b={address:a.senderID,data:b,vendor:this._learnVendor,senderID:d},a.subtype){case 0:this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},b,function(b,g){if(0==a.rspExpected){var k=0;b&&404==b.errorCode?
k=3:b||(k=1);e._sendUTEResponse(d,k,a,function(){e._learnFinish(b,0,g)})}else e._learnFinish(b,0,g)});break;case 1:this._controller._deviceHandler.deleteDevice(b,function(b,g){if(0==a.rspExpected){var k=0;b&&404==b.errorCode?k=3:b||(k=2);e._sendUTEResponse(d,k,a,function(){e._learnFinish(b,1,g)})}else e._learnFinish(b,1,g)});break;case 2:this._controller._deviceHandler.onLearnAddDeleteDevice(b,function(b,g,l){if(0==a.rspExpected){var k=0;b&&404==b.errorCode?k=3:b||(0==g?k=1:1==g&&(k=2));e._sendUTEResponse(d,
k,a,function(){e._learnFinish(b,g,l)})}else e._learnFinish(b,g,l)})}}};b.prototype._sendUTEResponse=function(a,b,d,e){a||(a=x.hub.m.enocean.SENDER_ID);a=new x.hub.m.enocean.ESP3.Telegram.UTE(1,d.ute,0,b,d.numChannel,d.manufactureID,d.eepType,d.eepFunc,d.eepRorg,a,0);a.setDstId(d.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){e&&e(a)})};b.prototype._learnFinish=function(a,b,d){var g=this._learnCallback;this._learning=!1;this._learnVendor=this._learnSenderID=this._learnAddress=this._learnProfile=
this._learnCallback=null;this._secTeachInFrames={};var e=this._saParams;this._saParams=null;this._controller._esp3.stopLearn(this,e,function(){});g&&g(a,b,d);!a&&0==b&&d&&d.init&&setTimeout(function(){d.init()},1E3)};b.prototype._toProfileStr=function(a,b,d){for(a=a.toString(16);2>a.length;)a="0"+a;for(b=b.toString(16);2>b.length;)b="0"+b;for(d=d.toString(16);2>d.length;)d="0"+d;return(a+"-"+b+"-"+d).toLowerCase()};b.prototype._fromProfileStr=function(a){a=a.split("-");return{rorg:parseInt(a[0],16),
func:parseInt(a[1],16),type:parseInt(a[2],16)}};b.prototype._getRealProfile=function(a){if(!a)return null;var b=x.hub.m.enocean.profiles[a];if(!b)return a;b=new b;return b._eepAlias?b._eepAlias:a};b.prototype._isLearningProfileEquals=function(a){if(!this._learnProfile)return!1;if(this._learnProfile==a||"bb-aa-cc"==this._learnProfile&&"d2-06-10"==a||"d2-06-10"==this._learnProfile&&"bb-aa-cc"==a)return!0;var b=x.hub.m.enocean.profiles[this._learnProfile];return b?(new b)._eepAlias==a:!1};b.prototype.teachin=
function(a,b,d,e,h){if(this._teaching)h&&h(Error("teach-in process running"));else if(this._learning)h&&h(Error("learning process running"));else if(a){a=a.toLowerCase();b||(b=this._controller._deviceHandler.getNextFreeAddress());var g=this;this._teachCallback=h;this._teachProfile=a;this._teachID=b;this._teachSenderID=d;this._teachVendor=e?e:"general";this._teaching=!0;this._teachingTO=setTimeout(function(){g._teachFinish(Error("teach-in timeout"))},3E4);var l;e=a;if(h=x.hub.m.enocean.profiles[e])h=
new h,h.getTeachinType&&(l=h.getTeachinType()),h.isTeachinBidirectional&&h.isTeachinBidirectional();!l&&(e=this._getRealProfile(e),h=x.hub.m.enocean.profiles[e])&&(h=new h,h.getTeachinType&&(l=h.getTeachinType()),h.isTeachinBidirectional&&h.isTeachinBidirectional());if(!l)switch(e.substr(0,2)){case "f6":l="RPS";break;case "d5":l="1BS";break;case "a5":l="4BS"}switch(l){case "RPS":this._teachinRPS(a,b,d);break;case "1BS":this._teachin1BS(a,b,d);break;case "4BS":this._teachin4BS(a,b,d);break;case "UTE":this._teachinUTE(a,
b,d);break;default:this._teachFinish(Error("profile not supported"))}}else h&&h(Error("profile is null"))};b.prototype._teachinRPS=function(a,b,d){this._teachFinish(Error("RPS teach-in should be done by execute command directly"))};b.prototype._teachin1BS=function(a,b,d){};b.prototype._teachin4BS=function(a,b,d){var g=2,e=x.hub.m.enocean.profiles[a];if(e)g=(new e).TEACH_IN_VARIATION;else if(this._getRealProfile(a),e=x.hub.m.enocean.profiles[a])g=(new e).TEACH_IN_VARIATION;switch(g){case 1:this._teachin4BSV1(a,
b,d);break;case 2:this._teachin4BSV2(a,b,d);break;case 3:this._teachin4BSV3(a,b,d);break;default:this._teachFinish(Error("no supported"))}};b.prototype._teachin4BSV1=function(a,b,d){};b.prototype._teachin4BSV2=function(a,b,d){var g=d;if(!d&&(g=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId(),!g)){this._teachFinish(Error("no more sender ID available"));return}d=a;var e=x.hub.m.enocean.profiles[d];e||(d=this._getRealProfile(d),e=x.hub.m.enocean.profiles[a]);e&&(e=new e,e._eepAlias&&
(a=e._eepAlias));e&&e.getTeachinTelegram?a=e.getTeachinTelegram(b,g,x.hub.m.enocean.MANUFACTURE_ID):(a=this._fromProfileStr(a),a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),a=new x.hub.m.enocean.ESP3.Telegram.BS4(a,g,0));var k=this;this._controller._esp3.sendTelegram(a,!0,function(a){a?k._teachFinish(a):(b||(b=g),k._controller._deviceHandler.addDevice({address:b,data:k._teachProfile,senderID:g,vendor:k._teachVendor},
function(a,b){k._teachFinish(a,b)}))})};b.prototype._teachin4BSV3=function(a,b,d){var g=d;if(!d){g=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!g){this._teachFinish(Error("no more sender ID available"));return}this._teachSenderID=g}d=a;var e=x.hub.m.enocean.profiles[d];e||(d=this._getRealProfile(d),e=x.hub.m.enocean.profiles[a]);e&&(e=new e,e._eepAlias&&(a=e._eepAlias));e&&e.getTeachinTelegram?g=e.getTeachinTelegram(b,g,x.hub.m.enocean.MANUFACTURE_ID):(a=this._fromProfileStr(a),
a=new Buffer([(a.func&63)<<2|a.type>>6&2,(a.type&31)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,x.hub.m.enocean.MANUFACTURE_ID&255,128]),g=new x.hub.m.enocean.ESP3.Telegram.BS4(a,g,0));var k=this;this._controller._esp3.addListener(this._teachinTelegramCB);this._controller._esp3.sendTelegram(g,!0,function(a){a&&k._teachFinish(a)})};b.prototype._teachinUTE=function(a,b,d){b=d;if(!d){b=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId();if(!b){this._teachFinish(Error("no more sender ID available"));
return}this._teachSenderID=b}d=a;var g=x.hub.m.enocean.profiles[d];g||(d=this._getRealProfile(d),g=x.hub.m.enocean.profiles[a]);g&&(g=new g,g._eepAlias&&(a=g._eepAlias));a=a.split("-");a=new x.hub.m.enocean.ESP3.Telegram.UTE(0,1,0,2,255,x.hub.m.enocean.MANUFACTURE_ID,parseInt(a[2],16),parseInt(a[1],16),parseInt(a[0],16),b,0);a.setDstId(reqTelegram.senderID);this._controller._esp3.sendTelegram(a,!0,function(a){a&&self._teachFinish(a)})};b.prototype._teachFinish=function(a,b,d){this._controller._esp3.removeListener(this._teachinTelegramCB);
var g=this._teachCallback;this._teachingTO&&clearTimeout(this._teachingTO);this._teachingTO=null;this._teaching=!1;this._saParams=this._teachVendor=this._teachSenderID=this._teachID=this._teachProfile=this._teachCallback=null;g&&g(a,b,d)};return b}();
x.hub.m.enocean.DeviceHandler=function(){var e=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.DeviceHandler");this._controller=b;this._devices={}};util.inherits(e,EventEmitter);e.prototype.SENSOR_FILE="enocean.json";e.prototype.UNKNOWN_PROFILE_ERR=404;e.prototype.ALREADY_EXISTS_ERR=400;e.prototype.init=function(b){this._logger.log("trace","init");var a=this;this._loadDevices(function(g,d){g&&a._logger.log("warn","init error:"+g.message);d&&(a._devices=d);a._initDevices();
b&&b()})};e.prototype._initDevices=function(){var b=Object.keys(this._devices),a=0,g=this,d=function(){a++;a<b.length&&(g._devices[b[a]]&&g._devices[b[a]].init?g._devices[b[a]].init(d):d())};this._devices[b[a]]&&this._devices[b[a]].init?this._devices[b[a]].init(d):d()};e.prototype.getDevice=function(b){if(!b)return null;var a=this._devices[b];if(a)return a;b=parseInt(b,16);for(b=(b-1).toString(16);8>b.length;)b="0"+b;return(a=this._devices[b])&&a instanceof x.hub.m.enocean.profiles.eltako_f6t?a:null};
e.prototype.getAllDevices=function(){return this._devices};e.prototype.findDevice=function(b){return b&&b.address?this._devices[b.address]:null};e.prototype.findDeviceWithData=function(b){if(!b)return null;var a=[],g;for(g in this._devices){var d=this._devices[g];d&&d.getData()==b&&a.push(d)}return a};e.prototype.addDevice=function(b,a){if(b&&b.data){b.address||(b.address=this.getNextFreeAddress());b.address=b.address.toLowerCase();b.senderID&&(b.senderID=b.senderID.toLowerCase());var g=x.hub.m.enocean.profiles.parseJson(b);
if(g){b=g._address;var d=this._devices[b];d&&d._data==g._data&&(g._states=d._states);this._devices[b]=g;this._saveDevices(this._devices,function(b){a&&a(b,g)})}else b=Error("unknow profile"),b.errorCode=this.UNKNOWN_PROFILE_ERR,a&&a(b)}else b=Error("device json invalid"),a&&a(b)};e.prototype.updateDevice=function(b,a,g){if(b)if(a&&a.data){var d=this._devices[b];a.address||(a.address=b);a.address=a.address.toLowerCase();a.senderID&&(a.senderID=a.senderID.toLowerCase());var e=x.hub.m.enocean.profiles.parseJson(a);
e?(d&&d._data==e._data&&(e._params=d._params,e._states=d._states),this._devices[a.address]=e,a.address!=b&&delete this._devices[b],this._saveDevices(this._devices,function(a){g&&g(a,e)})):(b=Error("unknow profile"),b.errorCode=this.UNKNOWN_PROFILE_ERR,g&&g(b))}else b=Error("device json invalid"),g&&g(b);else b=Error("address invalid"),g&&g(b)};e.prototype.deleteDevice=function(b,a){if(b&&b.address&&this._devices[b.address]){var g=this._devices[b.address];g&&g.finalize&&g.finalize();var d=this._devices[b.address];
delete this._devices[b.address];this.emit("deleteDevice",d);this._saveDevices(this._devices,function(b){a&&a(b,g)})}else a&&a()};e.prototype.onLearnAddDeleteDevice=function(b,a){if(b&&b.address)if(this._devices[b.address])this.deleteDevice(b,function(b,d){a&&a(b,1,d)});else this.onLearnDevice(null,b,function(b,d){a&&a(b,0,d)});else a&&a()};e.prototype.onLearnDevice=function(b,a,g){if(a&&a.address&&a.data){var d=x.hub.m.enocean.profiles.parseJson(a);if(d){var e=a.address;if(this._devices[e]){var h=
this._devices[e];e=h.toJSON();if(e.data!=a.data||e.vendor!=a.vendor)a=Error("address "+a.address+" already exists, please delete it first"),a.errorCode=this.ALREADY_EXISTS_ERR,g&&g(a);else if(e.senderID!=a.senderID){h._senderID=a.senderID;if("bb-aa-cc"==h._data||"d2-06-10"==h._data||"d2-06-ff"==h._data)h.executeCommand(null,{value:"alertOn"}),h.executeCommand(null,{value:"preAlarmOn"});else if("afriso_water_eco"==d._data)d.onLearn();this._saveDevices(this._devices,function(a){g&&g(a,h)})}else g&&
g(null,h)}else{b&&(a=b.address)&&a!=e&&this._devices[a]&&delete this._devices[a];this._devices[e]=d;if("bb-aa-cc"==d._data||"d2-06-10"==d._data||"d2-06-ff"==d._data)d.executeCommand(null,{value:"alertOn"}),d.executeCommand(null,{value:"preAlarmOn"});else if("afriso_water_eco"==d._data)d.onLearn();this._saveDevices(this._devices,function(a){g&&g(a,d)})}}else a=Error("unknow profile"),a.errorCode=this.UNKNOWN_PROFILE_ERR,g&&g(a)}else a=Error("device json invalid"),g&&g(a)};e.prototype.deviceParamsUpdated=
function(b,a){this._saveDevices(this._devices,function(b){a&&a(b)})};e.prototype.isVirtual=function(b){var a=x.hub.m.enocean.SENDER_ID;if(!a)return!1;var g=parseInt(a,16)+1;a=parseInt(a,16)+128;b=parseInt(b,16);return b>=g&&b<=a};e.prototype.getVirtualSenderID=function(){var b=x.hub.m.enocean.SENDER_ID;if(!b)return[];var a=parseInt(b,16)+1;b=parseInt(b,16)+128;var g=[],d=this._devices,e;for(e in d){var h=d[e];h&&h._senderID&&(h=parseInt(h._senderID,16),h>=a&&h<=b&&g.push(h))}return g};e.prototype.getVirtualAddress=
function(){var b=[],a=this._devices,g;for(g in a)"x"==g.charAt(0)&&(a=parseInt(g.substr(1),16),0<=a&&268435455>=a&&b.push(g));return b};e.prototype.getFreeSenderIdCount=function(){return 128-this.getVirtualSenderID().length};e.prototype.getNextFreeSenderId=function(){var b=x.hub.m.enocean.SENDER_ID;if(!b)return null;var a=parseInt(b,16)+1;b=parseInt(b,16)+128;for(var g=this.getVirtualSenderID(),d=null;a<=b;a++)if(-1==g.indexOf(a)){d=a;break}if(d)for(d=d.toString(16).toLowerCase();8>d.length;)d="0"+
d;return d};e.prototype.getNextFreeAddress=function(){for(var b=this.getVirtualAddress(),a=null,g=0;268435455>=g;g++){for(var d=g.toString(16);7>d.length;)d="0"+d;d="x"+d;if(-1==b.indexOf(d)){a=d;break}}return a};e.prototype.generateVirtual=function(b,a){if(b&&b.data){var g=b.senderID;if(!g&&(g=this.getNextFreeSenderId(),!g)){a&&a(Error("no sender id available"));return}b.senderID=g;b.address=g;b.virtual=!0;if(g=this.findDevice(b)){var d=g.toJSON();b.data!=d.data?a&&a(Error("device of another type with the same address exists")):
b.vendor&&b.vendor!=d.vendor?a&&a(Error("device of another vendor with the same address exists")):a&&a(null,g)}else(b=x.hub.m.enocean.profiles.parseJson(b))?this.addDevice(b.toJSON(),function(b,d){a&&a(b,d)}):a&&a(Error("unknow profile"))}else a&&a(Error("query is null"))};e.prototype._getFile=function(){var b=fileman.fileManager,a=require("path");b=b.getUserRootDataPath();return a.resolve(b,this.SENSOR_FILE)};e.prototype._loadDevices=function(b){var a=require("fs-extra"),g=this._getFile();a.ensureFile(g,
function(d){d?b&&b(d):a.readFile(g,"utf8",function(a,d){if(a)b&&b(a);else if(d)try{a={};var g=JSON.parse(d),e;for(e in g){var h=x.hub.m.enocean.profiles.parseDBJson(g[e]);h&&(a[e]=h)}b&&b(null,a)}catch(p){b&&b(p)}else b&&b(null,{})})})};e.prototype._saveDevices=function(b,a){var g=this._getFile(),d={},e;for(e in b)d[e]=b[e].toDBJSON();fs_extra.writeFile(g,JSON.stringify(d,null,2),function(b){a&&a(b)})};return e}();
x.hub.m.enocean.ESP3=function(){var e=function(a,b,d){this.type=a;this.data=b;this.optData=d};e.TYPE={1:"RADIO_ERP1",2:"RESPONSE",3:"RADIO_SUB_TEL",4:"EVENT",5:"COMMAND_COMMAND",6:"SMART_ACK_COMMAND",7:"REMOTE_MAN_COMMAND",9:"RADIO_MESSAGE",10:"RADIO_ERP2",16:"RADIO_802_15_4",17:"COMMAND_2_4"};e.prototype.toBuffer=function(){var a=new Buffer(6);a.writeUInt8(85,0);a.writeUInt16BE(this.data.length,1);a.writeUInt8(this.optData?this.optData.length:0,3);a.writeUInt8(this.type,4);a.writeUInt8(0,5);var b=
x.hub.m.enocean.CRC8(a.slice(1,5));a.writeUInt8(b,5);var d=this.optData?Buffer.concat([this.data,this.optData],this.data.length+this.optData.length):this.data;b=x.hub.m.enocean.CRC8(d);a=Buffer.concat([a,d],6+d.length+1);a.writeUInt8(b,a.length-1);return a};e.prototype.toJSON=function(){return{dataLen:this.data.length,optLen:this.optData?this.optData.length:0,type:this.type,typeName:e.TYPE[this.type],data:this.data.toString("hex"),optData:this.optData?this.optData.toString("hex"):null}};e.prototype.toPacket=
function(){return b.resolve(this)};var b=function(){};b.resolve=function(b){switch(b.type){case 1:return g.resolve(b);case 2:return a.resolve(b);case 4:return h.resolve(b);case 5:return l.resolve(b);case 6:return d.resolve(b);default:return null}};var a=function(a,b,d){this.retCode=a;this.resData=b;this.optData=d};a.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};a.prototype.toJSON=function(){return{retCodeName:a.CODE[this.retCode],
retCode:this.retCode.toString(16),resData:this.resData?this.resData.toString("hex"):null,optData:this.optData?this.optData.toString("hex"):null}};a.prototype.toFrame=function(){var a=new Buffer(1);a.writeUInt8(this.retCode,0);this.resData&&(a=Buffer.concat([a,this.resData]));return new e(2,a,this.optData)};a.prototype.toResponse=function(){return t.resolve(this)};a.resolve=function(b){var d;var g=b.data.readUInt8(0);1<b.data.length&&(d=b.data.slice(1));return new a(g,d,b.optData)};var g=function(a,
b,d,g,e,k){this.data=a;if(this.hasOpt=b)this.subTelNum=d,this.dstId=g,this.dBm=e,this.securityLvl=k};g.prototype.toJSON=function(){var a={data:this.data.toString("hex")};this.hasOpt&&(a.subTelNum=this.subTelNum.toString(16),a.dstId=this.dstId,a.dBm=this.dBm.toString(16),a.securityLvl=this.securityLvl);return a};g.prototype.toFrame=function(){var a=this.data,b=null;this.hasOpt&&(b=new Buffer([this.subTelNum]),b=Buffer.concat([b,new Buffer(this.dstId,"hex")]),b=Buffer.concat([b,new Buffer([this.dBm,
this.securityLvl])]));return new e(1,a,b)};g.prototype.toRadioTelegram=function(){return k.resolve(this)};g.resolve=function(a){var b=!1;if(a.optData){b=!0;var d=a.optData.readUInt8(0);var e=a.optData.slice(1,5).toString("hex");var z=a.optData.readUInt8(5);var k=a.optData.readUInt8(6)}return new g(a.data,b,d,e,z,k)};var d=function(a){this.data=a};d.prototype.toJSON=function(){return{data:this.data.toString("hex")}};d.prototype.toFrame=function(){return new e(6,this.data,null)};d.prototype.toSACommand=
function(){return M.resolve(this)};d.resolve=function(a){return new d(a.data)};var l=function(a){this.data=a};l.prototype.toJSON=function(){return{data:this.data.toString("hex")}};l.prototype.toFrame=function(){return new e(5,this.data,null)};l.prototype.toCommandCommand=function(){return oa.resolve(this)};l.resolve=function(a){return new l(a.data)};var h=function(a){this.data=a};h.prototype.toJSON=function(){return{data:this.data.toString("hex")}};h.prototype.toFrame=function(){return new e(4,this.data,
null)};h.prototype.toEvent=function(){return m.resolve(this)};h.resolve=function(a){return new h(a.data)};var k=function(a,b){this.rorg=a;this.optData=b;this.optData||(this.optData={subTelNum:1,dstId:"FFFFFFFF",dBm:255,securityLvl:0})};k.prototype.setDstId=function(a){this.optData.dstId=a?a:"FFFFFFFF"};k.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 208:return E.resolve(a);case 246:return y.resolve(a);case 213:return C.resolve(a);case 165:return w.resolve(a);case 210:return A.resolve(a);
case 212:return U.resolve(a);case 53:return X.resolve(a);case 49:return N.resolve(a);case 64:return u.resolve(a);case 176:return n.resolve(a);case 178:return p.resolve(a);default:return null}};var n=function(){var a=function(a,b,d){8<=d&&(d=8);0>=d&&(d=1);var g=Math.floor(b/8),e=b%8;b=Math.pow(2,d)-1;if(8<e+d)return d=16-e-d,a.readUInt16BE(g)>>d&b;d=8-e-d;return a.readUInt8(g)>>d&b},b=function(a){this.type=a};b.prototype.getType=function(){return this.type};b.resolve=function(b,g){if(g+2>8*b.length)return null;
var z=a(b,g,2),k=null;switch(z){case 0:k=d.resovle(b,g);break;case 1:k={type:z,sigType:b.readUInt16BE(0)>>6&255,valueType:b.readUInt16BE(0)>>2&3,resolution:b.readUInt16BE(0)&15,engMin:b.readUInt8(2),scalingMin:b.readUInt16BE(3)>>12&15,engMax:b.readUInt16BE(3)>>4&255,scalingMax:b.readUInt16BE(3)&15};break;case 2:k=e.resovle(b,g);break;case 3:k=h.resovle(b,g)}return k};var d=function(a,b,d){this.type=0;this.sigType=a;this.dataLen=b;this.data=d};d.prototype=new b;d.prototype.constructor=d;d.prototype.getBitLength=
function(){return 2==this.sigType?50:18};d.prototype.getProductID=function(){return 2==this.sigType?this.data?this.data.readUInt32BE(0):null:null};d.resovle=function(b,g){if(g+18>8*b.legnth)return null;var e=a(b,g+2,8),z=a(b,g+10,8),k=null;if(2==e){if(g+50>8*b.legnth)return null;k=new Buffer(4);k.writeUInt8(a(b,g+18,8),0);k.writeUInt8(a(b,g+26,8),1);k.writeUInt8(a(b,g+34,8),2);k.writeUInt8(a(b,g+42,8),3)}else 1==e&&(k=null);return new d(e,z,k)};var g=function(a,b,d,g,e,z,k){this.type=1;this.sigType=
a;this.valueType=b;this.resolution=d;this.engMin=g;this.scalMin=e;this.engMax=z;this.scalMax=k};g.prototype=new b;g.prototype.constructor=g;g.prototype.getBitLength=function(){return 40};g.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType,resolution:this.resolution,engMin:this.engMin,scalMin:this.scalMin,engMax:this.engMax,scalMax:this.scalMax}};g.resovle=function(b,d){if(d+40>8*b.length)return null;var e=a(b,d+2,8),z=a(b,d+10,2),k=a(b,d+12,4),h=a(b,d+16,8),l=a(b,d+
24,4),Oa=a(b,d+28,8);b=a(b,d+36,4);return new g(e,z,k,h,l,Oa,b)};var e=function(a,b){this.type=2;this.sigType=a;this.valueType=b};e.prototype=new b;e.prototype.constructor=e;e.prototype.getBitLength=function(){return 12};e.resovle=function(b,d){if(d+12>8*b.length)return null;var g=a(b,d+2,8);b=a(b,d+10,2);return new e(g,b)};e.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType}};var h=function(a,b,d){this.type=3;this.sigType=a;this.valueType=b;this.resolution=d};h.prototype=
new b;h.prototype.constructor=h;h.prototype.getBitLength=function(){return 16};h.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType,resolution:this.resolution}};h.resovle=function(b,d){if(d+16>8*b.length)return null;var g=a(b,d+2,8),e=a(b,d+10,2);b=a(b,d+12,4);return new h(g,e,b)};var l=function(a,b,d){k.call(this,176);this.manufacturerID=a;this.dataDirection=b;this.purpose=d;this.productID=null;this.outboudChannels={};this.inboundChannels={};this.status=this.senderID=
null};l.prototype=new k;l.prototype.constructor=l;l.prototype.getManufacturerId=function(){return this.manufacturerID};l.prototype.getProductId=function(){return this.productID};l.prototype.toJSON=function(){var a={manufacturerID:this.manufacturerID,dataDirection:this.dataDirection,purpose:this.purpose,productID:this.productID,outboudChannels:{},inboundChannels:{}},b;for(b in this.outboudChannels)a.outboudChannels[b]=this.outboudChannels[b].toJSON();for(b in this.inboundChannels)a.inboundChannels[b]=
this.inboundChannels[b].toJSON();return a};l.resolve=function(a){var d=a.data;a=d.readUInt16BE(1)>>5&2047;var g=d.readUInt16BE(1)>>4&1,e=d.readUInt16BE(1)>>2&3;a=new l(a,g,e);g=d.slice(3,d.length-5);e=d.slice(d.length-5,d.length-1);d=d.readUInt8(d.length-1);a.senderID=e.toString("hex");a.status=d;for(var z=e=d=0;;){var k=b.resolve(g,e);if(!k)break;0==d?0==k.getType()?a.productID=k.getProductID():(a.outboudChannels[z]=k,z++,d=1):1==d?0==k.getType()?d=2:(a.outboudChannels[z]=k,z++,d=1):2==d&&(a.inboundChannels[z]=
k,z++);e+=k.getBitLength()}return a};return l}(),q=function(){var a=function(a,b,d,g,e){k.call(this,177);this.manufacturerID=a;this.result=b;this.chnAcknoledgement=d;this.senderID=g;this.status=e};a.prototype=new k;a.prototype.constructor=a;a.prototype.toPacket=function(){var a=new Buffer(3);a.writeUInt8(this.rorg,0);a.writeUInt16BE(this.manufacturerID<<5|this.result<<3,1);if(3==this.result){var b=[];if(this.chnAcknoledgement){for(var d=Math.ceil(this.chnAcknoledgement.length/8),e=0;e<d.length;e++)b.push(0);
for(d=0;d<this.chnAcknoledgement.length;d++)e=Math.floor(d/8),b[e]|=chnAcknoledgement[d]<<8-d%8-1}a=Buffer.concat([a,new Buffer(b)])}a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);b=1;d="FFFFFFFF";e=255;var z=0;this.optData&&(b=this.optData.subTelNum,d=this.optData.dstId,e=this.optData.dBm,z=this.optData.securityLvl);return new g(a,!0,b,d,e,z)};a.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),manufacturerID:this.manufacturerID.toString(16),
result:this.result,chnAcknoledgement:this.chnAcknoledgement,senderID:this.senderID,receiverID:this.receiverID}};return a}(),p=function(){var a=function(a,b,d){k.call(this,178);this.data=a;this.senderID=b;this.status=d};a.prototype=new k;a.prototype.constructor=a;a.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);this.data&&(a=Buffer.concat([a,this.data]));a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);var b=1,d="FFFFFFFF",
e=255,k=0;this.optData&&(b=this.optData.subTelNum,d=this.optData.dstId,e=this.optData.dBm,k=this.optData.securityLvl);return new g(a,!0,b,d,e,k)};a.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),data:this.data?this.data.toString("hex"):null,senderID:this.senderID,status:this.status}};a.resolve=function(b){var d=b.data;b=d.slice(1,d.length-5);var e=d.slice(d.length-5,d.length-1);d=d.readUInt8(d.length-1);return new a(b,e.toString("hex"),d)};return a}(),u=function(a,b,d,e,g,h,l,n){k.call(this,
64,n);this.seq=a;this.idx=b;this.len=d;this.crorg=e;this.data=g;this.senderID=h;this.status=l};u.prototype=new k;u.prototype.constructor=u;u.prototype.getSenderID=function(){return this.senderID};u.prototype.getSeq=function(){return this.seq};u.prototype.getIdx=function(){return this.idx};u.prototype.getLen=function(){return this.len};u.prototype.getCRORG=function(){return this.crorg};u.prototype.getData=function(){return this.data};u.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),
seq:this.seq,idx:this.idx,len:this.len,crorg:this.crorg?this.crorg.toString(16):null,data:this.data.toString("hex"),senderID:this.senderID,status:this.status}};u.resolve=function(a){var b=a.data,d=b.readUInt8(1)>>6&3,e=b.readUInt8(1)&63;if(0==e){var g=b.readUInt16BE(2);var k=b.readUInt8(4);var z=b.slice(5,b.length-5)}else k=g=null,z=b.slice(2,b.length-5);var h=b.slice(b.length-5,b.length-1).toString("hex");b=b.readUInt8(b.length-1);var l;a.hasOpt&&(l={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,
securityLvl:a.securityLvl});return new u(d,e,g,k,z,h,b,l)};var E=function(a,b,d,e){k.call(this,208,e);this.messageIndex=a;this.userData=b;this.senderID=d};E.prototype=new k;E.prototype.constructor=E;E.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),messageIndex:this.messageIndex,userData:this.userData?this.userData.toString("hex"):null,senderID:this.senderID}};E.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.messageIndex,1);this.userData&&
(a=Buffer.concat([a,this.userData]));a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);var b=1,d="FFFFFFFF",e=255,k=0;this.optData&&(b=this.optData.subTelNum,d=this.optData.dstId,e=this.optData.dBm,k=this.optData.securityLvl);return new g(a,!0,b,d,e,k)};E.resolve=function(a){var b=a.data,d=b.readUInt8(1),e=null,g=null;switch(d){case 1:e=0;g=b.slice(2,6).toString("hex");break;case 4:case 6:e=b.slice(2,3),g=b.slice(3,7).toString("hex")}var k;a.hasOpt&&(k={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,
securityLvl:a.securityLvl});return new E(d,e,g,k)};var y=function(a,b,d,e,g,h){k.call(this,246,h);this.userData=a?a:0;this.senderID=b;this.t21=d?d:0;this.nu=e?e:0;this.rc=g?g:0};y.prototype=new k;y.prototype.constructor=y;y.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),senderID:this.senderID,t21:this.t21,nu:this.nu,rc:this.rc}};y.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.userData,1);a=Buffer.concat([a,
new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.t21<<5|this.nu<<4||this.rc])]);var b=1,d="FFFFFFFF",e=255,k=0;this.optData&&(b=this.optData.subTelNum,d=this.optData.dstId,e=this.optData.dBm,k=this.optData.securityLvl);return new g(a,!0,b,d,e,k)};y.resolve=function(a){var b=a.data,d=b.readUInt8(1),e=b.slice(2,6).toString("hex"),g=b.readUInt8(6)>>5&1,k=b.readUInt8(6)>>4&1,z;a.hasOpt&&(z={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new y(d,e,
g,k,b&15,z)};var C=function(a,b,d,e){k.call(this,213,e);this.userData=a;this.senderID=b;this.rc=d?d:0};C.prototype=new k;C.prototype.constructor=C;C.prototype.getLearnBit=function(){return this.userData>>3&1};C.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),learn:this.getLearnBit(),senderID:this.senderID,rc:this.rc}};C.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.userData,1);a=Buffer.concat([a,new Buffer(this.senderID,
"hex")]);a=Buffer.concat([a,new Buffer([this.rc])]);var b=1,d="FFFFFFFF",e=255,k=0;this.optData&&(b=this.optData.subTelNum,d=this.optData.dstId,e=this.optData.dBm,k=this.optData.securityLvl);return new g(a,!0,b,d,e,k)};C.resolve=function(a){var b=a.data,d=b.readUInt8(1),e=b.slice(2,6).toString("hex");b=b.readUInt8(6)&15;var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new C(d,e,b,g)};var w=function(a,b,d,e){k.call(this,165,e);this.userData=a;this.senderID=
b;this.rc=d?d:0};w.prototype=new k;w.prototype.constructor=w;w.prototype.getLearnType=function(){return this.userData.readUInt8(3)>>7&1};w.prototype.getLearnBit=function(){return this.userData.readUInt8(3)>>3&1};w.prototype.getLearnStatus=function(){return this.userData.readUInt8(3)>>4&1};w.prototype.getLearnResult=function(){return this.userData.readUInt8(3)>>5&1};w.prototype.getEEPResult=function(){return this.userData.readUInt8(3)>>6&1};w.prototype.getFunc=function(){return this.userData.readUInt8(0)>>
2&63};w.prototype.getType=function(){var a=this.userData.readUInt8(0)&3,b=this.userData.readUInt8(1)>>3&31;return a<<5|b};w.prototype.getManufacturerId=function(){var a=this.userData.readUInt8(1)&7,b=this.userData.readUInt8(2);return a<<8|b};w.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),learnType:this.getLearnType(),learn:this.getLearnBit(),learnStatus:this.getLearnStatus(),learnResult:this.getLearnResult(),eepResult:this.getEEPResult(),func:this.getFunc(),
type:this.getType(),manufacturerId:this.getManufacturerId(),senderID:this.senderID,rc:this.rc}};w.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.rc&15])]);return this.optData?new g(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(a,!1)};w.resolve=function(a){var b=a.data,d=b.slice(1,5),e=b.slice(5,9).toString("hex");
b=b.readUInt8(9)&15;var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new w(d,e,b,g)};var A=function(a,b,d,e){k.call(this,210,e);this.userData=a;this.senderID=b;this.status=d};A.prototype=new k;A.prototype.constructor=A;A.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};A.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this.rorg,
0);a=Buffer.concat([a,this.userData]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return this.optData?new g(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(a,!1)};A.resolve=function(a){var b=a.data,d=b.slice(1,b.length-5),e=b.slice(b.length-5,b.length-1).toString("hex");b=b.readUInt8(b.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new A(d,
e,b,g)};var O=function(a,b,d,e,g){k.call(this,166);this.rorg_en=a;this.data=b;this.dstID=d;this.senderID=e;this.status=g};O.prototype=new k;O.prototype.constructor=O;O.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this.rorg,0);a.writeUInt8(this.rorg_en,1);a=Buffer.concat([a,this.data]);a=Buffer.concat([a,new Buffer(this.dstID,"hex")]);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return new g(a,!1)};var U=function(a,b,d,e,g,h,
l,n,q,u,p){k.call(this,212);this.cmd=a;this.ute=b;this.rspExpected=d;this.subtype=e;this.numChannel=g;this.manufactureID=h;this.eepType=l;this.eepFunc=n;this.eepRorg=q;this.senderID=u;this.status=p};U.prototype=new k;U.prototype.constructor=U;U.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),ute:this.ute,rspExpected:this.rspExpected,subtype:this.subtype,cmd:this.cmd,numChannel:this.numChannel,manufactureID:this.manufactureID,eepType:this.eepType.toString(16),eepFunc:this.eepFunc.toString(16),
eepRorg:this.eepRorg.toString(16),senderID:this.senderID,status:this.status}};U.prototype.toPacket=function(){var a=new Buffer(8);a.writeUInt8(this.rorg,0);a.writeUInt8(this.ute<<7|this.rspExpected<<6|this.subtype<<4|this.cmd,1);a.writeUInt8(this.numChannel,2);a.writeUInt16BE(parseInt(this.manufactureID,16),3);a.writeUInt8(this.eepType,5);a.writeUInt8(this.eepFunc,6);a.writeUInt8(this.eepRorg,7);a=Buffer.concat([a,new Buffer(this.senderID,"hex")]);a=Buffer.concat([a,new Buffer([this.status])]);return this.optData?
new g(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(a,!1)};U.resolve=function(a){var b=a.data.slice(1,8),d=a.data.slice(8,12).toString("hex"),e=a.data.readUInt8(12),g=b.readUInt8(0)>>7&1,k=b.readUInt8(0)&15,h=b.readUInt8(1),l=b.slice(2,4).toString("hex"),z=b.readUInt8(4),n=b.readUInt8(5),q=b.readUInt8(6),u=b.readUInt8(0)>>6&1;b=b.readUInt8(0)>>4&3;d=new U(k,g,u,b,h,l,z,n,q,d,e);a.hasOpt&&(d.optData={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});
return d};var X=function(a,b,d,e){k.call(this,53,e);this.userData=a;this.senderID=b;this.status=d};X.prototype=new k;X.prototype.constructor=X;X.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};X.resolve=function(a){var b=a.data,d=b.slice(1,b.length-5),e=b.slice(b.length-5,b.length-1).toString("hex");b=b.readUInt8(b.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,
dBm:a.dBm,securityLvl:a.securityLvl});return new X(d,e,b,g)};var N=function(a,b,d,e){k.call(this,49,e);this.userData=a;this.senderID=b;this.status=d};N.prototype=new k;N.prototype.constructor=N;N.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData}};N.prototype.convertToPacket=function(a){a=Buffer.concat([a,new Buffer(this.senderID,"hex"),new Buffer([this.status])]);return this.optData?
new g(a,!0,this.optData.subTelNum,this.optData.dstId,this.optData.dBm,this.optData.securityLvl):new g(a,!1)};N.resolve=function(a){var b=a.data,d=b.slice(1,b.length-5),e=b.slice(b.length-5,b.length-1).toString("hex");b=b.readUInt8(b.length-1);var g;a.hasOpt&&(g={subTelNum:a.subTelNum,dstId:a.dstId,dBm:a.dBm,securityLvl:a.securityLvl});return new N(d,e,b,g)};k.SIG=E;k.RPS=y;k.BS1=C;k.BS4=w;k.VLD=A;k.ADT=O;k.UTE=U;k.TS=X;k.SM=N;k.GP_TI=n;k.GP_TR=q;k.GP_CD=p;var t=function(a,b){this._code=a;this._rspData=
b};t.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"};t.prototype.toJSON=function(){return{code:this._code,rspData:this._rspData?this._rspData.toString("hex"):null}};t.prototype.toPacket=function(){return new a(this._code,this._rspData)};t.resolve=function(a){return new t(a.retCode,a.resData)};q=function(a,b){t.call(this,0);this._responseTime=a;this._confirmCode=b};q.prototype.toPacket=
function(){var b=new Buffer(3);b.writeUInt16BE(this._responseTime,0);b.writeUInt8(this._confirmCode,2);return new a(this._code,b)};q.prototype.toJSON=function(){return{code:this._code,responseTime:this._responseTime,confirmCode:this._confirmCode}};t.Response_OK_SA_CONFIRM_LEARN=q;var m=function(a){this._code=a};m.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 1:return Y.resolve(a);case 2:return K.resolve(a);default:return null}};var Y=function(){this._code=1};Y.prototype=
new m;Y.prototype.constructor=Y;Y.prototype.toJSON=function(){return{code:this._code}};Y.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);return new h(a)};Y.resolve=function(a){return new Y};var K=function(a,b,d,e,g,k,h){this._code=2;this._priority=a;this._manufacturerId=b;this._eep=d;this._rssi=e;this._pm_candidateId=g;this._sa_clientId=k;this._hop_count=h};K.prototype=new m;K.prototype.constructor=K;K.prototype.getEEP=function(){return this._eep?this._eep.substr(0,2)+
"-"+this._eep.substr(2,2)+"-"+this._eep.substr(4,2):null};K.prototype.getPMCandidateId=function(){return this._pm_candidateId};K.prototype.getSAClientId=function(){return this._sa_clientId};K.prototype.getHopCount=function(){return this._hop_count};K.prototype.toJSON=function(){return{code:this._code,priority:this._priority,manufacturerId:this._manufacturerId,eep:this.getEEP(),rssi:this._rssi,pm_candidateId:this._pm_candidateId,sa_clientId:this._sa_clientId,hop_count:this._hop_count}};K.prototype.toPacket=
function(){var a=new Buffer(4);a.writeUInt8(this._code,0);a.writeUInt8(this._priority,1);a.writeUInt16BE(this._manufacturerId&1023,2);a=Buffer.concat([a,new Buffer(this._eep,"hex")]);a=Buffer.concat([a,new Buffer([this._rssi])]);a=Buffer.concat([a,new Buffer(this._pm_candidateId,"hex")]);a=Buffer.concat([a,new Buffer(this._sa_clientId,"hex")]);a=Buffer.concat([a,new Buffer([this._hop_count])]);return new h(a)};K.resolve=function(a){var b=a.data;a=b.readUInt8(1);var d=b.readUInt16BE(2)&1023,e=b.slice(4,
7).toString("hex"),g=b.readUInt8(7),k=b.slice(8,12).toString("hex"),h=b.slice(12,16).toString("hex");b=b.readUInt8(16);return new K(a,d,e,g,k,h,b)};m.SA_RECLAIM_NOT_SUCCESSFUL=Y;m.SA_CONFIRM_LEARN=K;var oa=function(a){this._code=a};oa.resolve=function(a){if(!a.data)return null;switch(a.data.readUInt8(0)){case 9:return CO_WR_REPEATER.resolve(a);default:return null}};CO_WR_REPEATER=function(a,b){this._code=9;this._enable=a;this._level=b};CO_WR_REPEATER.prototype=new oa;CO_WR_REPEATER.prototype.constructor=
CO_WR_REPEATER;CO_WR_REPEATER.prototype.toJSON=function(){return{code:this._code,enable:this._enable,level:this._level}};CO_WR_REPEATER.prototype.toPacket=function(){var a=new Buffer(3);a.writeUInt8(this._code,0);a.writeUInt8(this._enable,1);a.writeUInt8(this._level,2);return new l(a)};CO_WR_REPEATER.resolve=function(a){a=a.data.readUInt8(1);var b=CO_WR_REPEATER.readUInt8(2);return new CO_WR_REPEATER(a,b)};oa.CO_WR_REPEATER=CO_WR_REPEATER;var M=function(a){this._code=a};M.resolve=function(a){if(!a.data)return null;
switch(a.data.readUInt8(0)){case 1:return P.resolve(a);case 6:return Z.resolve(a);case 8:return aa.resolve(a);default:return null}};var P=function(a,b,d){this._code=1;this._enable=a;this._extended=b;this._timeout=d};P.prototype=new M;P.prototype.constructor=P;P.prototype.toJSON=function(){return{code:this._code,enable:this._enable,extended:this._extended,timeout:this._timeout}};P.prototype.toPacket=function(){var a=new Buffer(7);a.writeUInt8(this._code,0);a.writeUInt8(this._enable,1);a.writeUInt8(this._extended,
2);a.writeUInt32BE(this._timeout,3);return new d(a)};P.resolve=function(a){var b=a.data;a=b.readUInt8(1);var d=b.readUInt8(2);b=b.readUInt32BE(3);return new P(a,d,b)};var ca=function(a){this._code=5;this._saClientId=a};ca.prototype=new M;ca.prototype.constructor=ca;ca.prototype.toJSON=function(){return{code:this._code,clientId:this._saClientId}};ca.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);a=Buffer.concat([a,new Buffer(this._saClientId,"hex")]);return new d(a)};
ca.resolve=function(a){a=a.data.slice(1,5).toString("hex");return new ca(a)};var Z=function(){this._code=6};Z.prototype=new M;Z.prototype.constructor=Z;Z.prototype.toJSON=function(){return{code:this._code}};Z.prototype.toPacket=function(){var a=new Buffer(1);a.writeUInt8(this._code,0);return new d(a)};Z.resolve=function(a){return new Z};var aa=function(a){this._code=8;this._mailBoxCount=a};aa.prototype=new M;aa.prototype.constructor=aa;aa.prototype.toJSON=function(){return{code:this._code,mailBoxCount:this._mailBoxCount}};
aa.prototype.toPacket=function(){var a=new Buffer(2);a.writeUInt8(this._code,0);a.writeUInt8(this._mailBoxCount,1);return new d(a)};aa.resolve=function(a){a=a.data.readUInt8(1);return new aa(a)};M.SA_WR_LEARNMODE=P;M.SA_WR_RESET=ca;M.SA_RD_LEARNEDCLIENTS=Z;M.SA_WR_POSTMASTER=aa;var Qa=function(){var a=function(a){this._esp3=a;this._buffer={}};a.prototype.receiveChainedTelegram=function(a){var b=a.getSenderID(),d=a.getSeq(),e=a.getIdx();this._buffer[b]||(this._buffer[b]={});var g=this._buffer[b];g[d]||
(g[d]=[]);g=g[d];for(var k=0;k<=e;k++)k!=e?g.length<e&&(g[k]=null):g[k]=a;this._checkChain(b,d)};a.prototype._checkChain=function(a,b){var d=this._buffer[a][b];if(d[0]){var e=d[0],k=e.getLen(),h=e.getCRORG();e=0;var l=new Buffer(1);l.writeUInt8(h);for(h=0;h<d.length;h++){var n=d[h];if(!n)return;n=n.getData();e+=n.length;l=Buffer.concat([l,n])}e>=k&&(delete this._buffer[a][b],l=Buffer.concat([l,new Buffer(a,"hex")]),l=Buffer.concat([l,new Buffer("00","hex")]),a=new g(l,!1),this._esp3._onEORadio_ERP1(a))}};
return a}(),v=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP3");this._controller=a;this._listeners=[];a&&this._listeners.push(a);this._recomm=new x.hub.m.enocean.ReComm(this);this._baseID=this._serial=null;this._rdata=new Buffer([]);this._frameBuffer=[];this._learnHandler=null;this._learning=!1;this._learnTO=null;this._cdmHandler=new Qa(this)};v.RESPONSE_TO=1500;v.prototype.attachSerial=function(a,b){var d=this;this._serial=new x.hub.m.enocean.Serial(a);this._serial.setListener(this);
this._serial.open(function(a){a?(d._serial.setListener(null),d._serial=null,b&&b(a)):d.readBaseID(function(a,e){a?(d._serial.setListener(null),d._serial.close(),d._serial=null,b&&b(a)):(x.hub.m.enocean.SENDER_ID||(x.hub.m.enocean.SENDER_ID=e,localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID",e)),d._baseID=e,b&&b())})})};v.prototype.removeSerial=function(a,b){this._serial.setListener(null);this._serial.close();this._baseID=this._serial=null;b&&b()};v.prototype.getSerial=function(){return this._serial};
v.prototype.addListener=function(a){a&&-1==this._listeners.indexOf(a)&&this._listeners.push(a)};v.prototype.removeListener=function(a){a&&(a=this._listeners.indexOf(a),-1!=a&&this._listeners.splice(a,1))};v.prototype.readBaseID=function(a){var b=this,d=new e(5,new Buffer("08","hex"));this.sendFrame(d,!0,function(d,e){d?(b._logger.log("warn","read base id error:"+d.stack),a&&a(d)):e&&e.retCode?(d=Error("read BaseID error"),d.code=e.retCode,b._logger.log("warn","read base id error return code:"+e.retCode),
a&&a(d)):(d=e.resData.toString("hex"),a&&a(null,d.toLowerCase()))},8E3)};v.prototype.startLearn=function(a,b,d,e){if(this._serial){if(!b||0>=b)b=3E4;if(this._learning)e&&e(Error("learning another type right now"));else{this._learnHandler=a;this._learning=!0;var g=this;this._learnTO=setTimeout(function(){g._learning=!1;g._learnTO=null;var a=g._learnHandler;g._learnHandler=null;if(a&&a.onLearnTimeout)a.onLearnTimeout()},b);d?(a=new P(1,d.extended?d.extended:0,0),this.sendSACommand(a,!0,function(a){e&&
e(a)})):e&&e()}}else e&&e(Error("port not opened"))};v.prototype.stopLearn=function(a,b,d){this._learnTO&&clearTimeout(this._learnTO);this._learning=!1;this._learnTO=this._learnHandler=null;if(b){d&&d();var e=this;setTimeout(function(){var a=new P(0,b.extended?b.extended:0,0);e.sendSACommand(a,!0,function(a){d&&d(a)})},2E3)}else d&&d()};v.prototype.sendTelegram=function(a,b,d){this.sendPacket(a.toPacket(),b,d)};v.prototype.sendResponse=function(a,b){this._logger.log("trace","send RESPONSE:"+JSON.stringify(a.toJSON()));
this.sendPacket(a.toPacket(),!1,b)};v.prototype.sendSACommand=function(a,b,d){this._logger.log("trace","send SA_COMMAND:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),b,d)};v.prototype.sendCommandCommand=function(a,b,d){this._logger.log("trace","send COMMAND_COMMAND:"+JSON.stringify(a.toJSON()));this.sendPacket(a.toPacket(),b,d)};v.prototype.sendPacket=function(a,b,d){this.sendFrame(a.toFrame(),b,d)};v.prototype.sendFrame=function(a,b,d,e){var g=this._frameBuffer.length;this._frameBuffer.push({frame:a,
callback:d,timeout:null,response:b,to:e});0==g&&this._sendNextFrame()};v.prototype._sendNextFrame=function(){if(0!=this._frameBuffer.length){var a=this._frameBuffer[0],b=a.frame,d=a.callback,e=a.response;if(this._serial){var g=this;b=b.toBuffer();this._logger.log("trace","send raw frame:"+b.toString("hex"));this._serial.sendPacket(b,function(b){if(b||!e){try{d&&d(b)}catch(Ga){}g._frameBuffer.splice(0,1);g._sendNextFrame()}else b=a.to,b||(b=v.RESPONSE_TO),a.timeout=setTimeout(function(){var a=g._frameBuffer[0];
if(a){a=a.callback;var b=Error("enocean response timeout");b.code=100;try{a&&a(b)}catch(db){}}g._frameBuffer.splice(0,1);g._sendNextFrame()},b)})}else d&&d(Error("port not opened")),this._frameBuffer.splice(0,1),this._sendNextFrame()}};v.prototype.onSerialData=function(a){a=this._rdata=Buffer.concat([this._rdata,a]);for(var b=0;b<a.length;)if(85!=a[b])b++;else{if(b+6>=a.length)break;var d=(a[b+1]<<8)+a[b+2],g=a[b+3],k=a[b+5];if(a.length<b+d+g+7)break;if(x.hub.m.enocean.CRC8(a.slice(b+1,b+5))!=k)b++;
else if(k=a[b+d+g+6],x.hub.m.enocean.CRC8(a.slice(b+6,b+6+d+g))!=k)b++;else{k={type:a[b+4],dataLen:d,optLen:g,radioType:a[b+6],data:a.slice(b+6,b+6+d),optData:a.slice(b+6+d,b+6+d+g),rawByte:a.slice(0,b+6+d+g+1).toString("hex")};var h=new e(k.type,k.data,k.optData);if(166==k.radioType||210==k.radioType||165==k.radioType||246==k.radioType||213==k.radioType)k.senderId=k.data.slice(d-5,d-1).toString("hex");try{this._onEOFrame(h,k)}catch(Ga){this._logger.log("warn","process frame exception:"+Ga.stack)}b=
b+6+d+g+1}}0!=b&&0<a.length&&b<=a.length&&(a=a.slice(b));this._rdata=a};v.prototype.onSerialError=function(a){this._serial.setListener(null);this._serial=null};v.prototype._onEOFrame=function(a,b){this._logger.log("trace","receive raw frame:"+b.rawByte);this._logger.log("debug","receive enocean frame:"+JSON.stringify(a.toJSON()));this._listeners.forEach(function(d){d._onEOFrame&&d._onEOFrame(a,b.rawByte)});var d=a.toPacket();d&&this._onEOPacket(d)};v.prototype._onEOPacket=function(b){this._logger.log("debug",
"receive enocean packet:"+JSON.stringify(b.toJSON()));this._listeners.forEach(function(a){a._onEOPacket&&a._onEOPacket(b)});b instanceof g?this._onEORadio_ERP1(b):b instanceof a?this._onEOResponse_Packet(b):b instanceof h&&this._onEOEvent_Packet(b)};v.prototype._onEORadio_ERP1=function(a){(a=a.toRadioTelegram())&&this._onEO_ERP1_Telegram(a)};v.prototype._onEOResponse_Packet=function(a){try{var b=a.toResponse();this._onEO_Response(b)}catch(Pa){}if(0!=this._frameBuffer.length){var d=this._frameBuffer[0];
b=d.callback;(d=d.timeout)&&clearTimeout(d);try{b&&b(null,a)}catch(Pa){}this._frameBuffer.splice(0,1);this._sendNextFrame()}};v.prototype._onEOEvent_Packet=function(a){(a=a.toEvent())&&this._onEO_Event(a)};v.prototype._onEO_ERP1_Telegram=function(a){this._logger.log("debug","receive enocean telegram:"+JSON.stringify(a.toJSON()));if(64==a.rorg)this._cdmHandler.receiveChainedTelegram(a);else if(this._listeners.forEach(function(b){b._onEOTelegram&&b._onEOTelegram(a)}),49==a.rorg&&(a=this._controller._secHandler.resolve(a))&&
this._listeners.forEach(function(b){b._onEOTelegram&&b._onEOTelegram(a)}),this._learning&&this._learnHandler&&this._learnHandler.onTelegram)this._learnHandler.onTelegram(a)};v.prototype._onEO_Response=function(a){this._logger.log("debug","receive enocean response:"+JSON.stringify(a.toJSON()))};v.prototype._onEO_Event=function(a){this._logger.log("debug","receive enocean event:"+JSON.stringify(a.toJSON()));if(this._learning&&this._learnHandler&&this._learnHandler.onEvent)this._learnHandler.onEvent(a)};
v.ESP3_Frame=e;v.Telegram=k;v.RADIO_ERP1_Packet=g;v.Event=m;v.Response=t;v.COMMAND_COMMAND=oa;v.SA_COMMAND=M;return v}();
x.hub.m.enocean.ESP2=function(){var e=function(a,b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP2.Telegram");this._type=a;this._data=b};e.prototype.toBuffer=function(){var a=new Buffer(3+this._data.length+1),b=0;a.writeUInt8(165,0);a.writeUInt8(90,1);var d=this._type<<5|this._data.length+1&31;b+=d;a.writeUInt8(d,2);for(d=0;d<this._data.length;d++){var e=this._data.readUInt8(d);a.writeUInt8(e,d+3);b+=e}a.writeUInt8(b&255,a.length-1);return a};e.resolve=function(e,h){switch(e){case 0:return a.resolve(h);
case 3:return b.resolve(h);case 4:return g.resolve(h);case 5:return d.resolve(h);default:return null}};var b=function(){var a=function(a){e.call(this,3,a)};a.prototype=new e;a.prototype.constructor=a;a.prototype.getData=function(){return this._data.slice(1,5)};a.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};a.prototype.getStatus=function(){return this._data.readUInt8(9)};a.prototype.toJSON=function(){return{type:"TRT",org:"0x"+this._data.slice(0,1).toString("hex"),
data:this.getData().toString("hex"),senderID:this.getSenderID(),status:this.getStatus()}};a.prototype.fromPayload=function(a){this._data=a._data};a.resolve=function(b){return b&&b.length?new a(b):null};return a}(),a=function(){var a=function(a){e.call(this,0,a)};a.prototype=new e;a.prototype.constructor=a;a.prototype.getData=function(){return this._data.slice(1,5)};a.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};a.prototype.getStatus=function(){return this._data.readUInt8(9)};
a.prototype.toJSON=function(){return{type:"RRT",org:"0x"+this._data.slice(0,1).toString("hex"),data:this.getData().toString("hex"),senderID:this.getSenderID(),status:this.getStatus()}};a.prototype.toPayload=function(){return l.resolve(this._data)};a.resolve=function(b){return b&&b.length?new a(b):null};return a}(),g=function(){var a=function(a){e.call(this,4,a)};a.prototype=new e;a.prototype.constructor=a;a.prototype.toJSON=function(){return{type:"RCT",org:"0x"+this._data.readUInt8(0).toString(16)}};
a.resolve=function(a){if(!a||!a.length)return null;var e=a[0];switch(e){case 88:return new b;case 25:return new d;case 34:return new h;case 26:return new l;case 8:case 11:case 9:case 10:return new g(e);case 152:return new y(a.slice(1,5).toString("hex"));case 136:return new C(a[2]);case 140:return new w(a.slice(1));default:return null}};var b=function(){var a=new Buffer([88,0,0,0,0,0,0,0,0]);e.call(this,4,a)};b.prototype=new a;b.prototype.constructor=b;b.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);
b.subtype="OK";return b};var d=function(){var a=new Buffer([25,0,0,0,0,0,0,0,0]);e.call(this,4,a)};d.prototype=new a;d.prototype.constructor=d;d.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.subtype="ERR";return b};var g=function(a){a=new Buffer([a,0,0,0,0,0,0,0,0]);e.call(this,4,a)};g.prototype=new a;g.prototype.constructor=g;g.prototype.getField=function(){return this._data.readUInt8(0)};g.prototype.getFieldName=function(){switch(this._data.readUInt8(0)){case 8:return"H_SEQ";
case 9:return"LENGTH";case 10:return"CHKSUM";case 11:return"ORG";default:return"UNKNOWN"}};g.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.subtype="ERR_SYNTAX";b.field=this.getFieldName();return b};var h=function(){var a=new Buffer([34,0,0,0,0,0,0,0,0]);e.call(this,4,a)};h.prototype=new a;h.prototype.constructor=h;h.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.subtype="ERR_TX_IDRANGE";return b};var l=function(){var a=new Buffer([26,0,0,0,0,0,0,0,0]);e.call(this,
4,a)};l.prototype=new a;l.prototype.constructor=l;l.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.subtype="ERR_IDRANGE";return b};var y=function(a){a=new Buffer("98"+a+"00000000","hex");e.call(this,4,a)};y.prototype=new a;y.prototype.constructor=y;y.prototype.getBaseID=function(){return this._data.slice(1,5).toString("hex")};y.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.subtype="INF_BASEID";b.baseID=this.getBaseID();return b};var C=function(a){a=new Buffer([136,
a&255,0,0,0,0,0,0,0]);e.call(this,4,a)};C.prototype=new a;C.prototype.constructor=C;var w=function(a){a=new Buffer("8C"+a.toString("hex"),"hex");e.call(this,4,a)};w.prototype=new a;w.prototype.constructor=w;a.OK=b;a.ERR=d;a.ERR_SYNTAX=g;a.ERR_TX_IDRANGE=h;a.ERR_IDRANGE=l;a.INF_BASEID=y;a.INF_RX_SENSITIVITY=C;a.INF_SW_VER=w;return a}(),d=function(){var a=function(a){e.call(this,5,a)};a.prototype=new e;a.prototype.constructor=a;a.prototype.toJSON=function(){return{type:"TCT",org:"0x"+this._data.readUInt8(0).toString(16)}};
a.resolve=function(a){if(!a||!a.length)return null;switch(a[0]){case 24:return new b(a.slice(1,4).toString("hex"));case 88:return new d;case 8:return new g(a[2]);case 72:return new h;case 75:return new y;case 10:return new l;default:return null}};var b=function(a){a=new Buffer("18"+a+"0000000000","hex");e.call(this,5,a)};b.prototype=new a;b.prototype.constructor=b;b.prototype.getBaseID=function(){return this._data.slice(1,5).toString("hex")};b.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);
b.subtype="SET_BASEID";b.baseID=this.getBaseID();return b};var d=function(){var a=new Buffer("58000000000000000000","hex");e.call(this,5,a)};d.prototype=new a;d.prototype.constructor=d;d.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.subtype="RD_BASEID";return b};var g=function(a){a=new Buffer([8,a&255,0,0,0,0,0,0,0,0]);e.call(this,5,a)};g.prototype=new a;g.prototype.constructor=g;g.prototype.getSensitivity=function(){return this._data.readUInt8(1)};g.prototype.toJSON=function(){var b=
a.prototype.toJSON.call(this);b.subtype="SET_RX_SENSITIVITY";b.sensitivity=this.getSensitivity();return b};var h=function(){var a=new Buffer("48000000000000000000","hex");e.call(this,5,a)};h.prototype=new a;h.prototype.constructor=h;h.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.subtype="RD_RX_SENSITIVITY";return b};var l=function(){var a=new Buffer("0A000000000000000000","hex");e.call(this,5,a)};l.prototype=new a;l.prototype.constructor=l;l.prototype.toJSON=function(){var b=
a.prototype.toJSON.call(this);b.subtype="RESET";return b};var y=function(){var a=new Buffer("4B000000000000000000","hex");e.call(this,5,a)};y.prototype=new a;y.prototype.constructor=y;y.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.subtype="RD_SW_VER";return b};a.SET_BASEID=b;a.RD_BASEID=d;a.SET_RX_SENSITIVITY=g;a.RD_RX_SENSITIVITY=h;a.RESET=l;a.RD_SW_VER=y;return a}(),l=function(){var a=function(a,b){if(a&&b){var d=Buffer.alloc(1);d.writeUInt8(a);this._data=Buffer.concat([d,b])}};
a.prototype.getData=function(){throw Error("not implemented by this child class");};a.prototype.getSenderID=function(){throw Error("not implemented by this child class");};a.prototype.getStatus=function(){throw Error("not implemented by this child class");};a.prototype.toJSON=function(){return{type:null,org:"0x"+this._data.slice(0,1).toString("hex"),data:this.getData().toString("hex"),senderID:this.getSenderID(),status:this.getStatus()}};a.resolve=function(a){if(!a||!a.length)return null;switch(a[0]){case 5:return b.resolve(a.slice(1));
case 6:return d.resolve(a.slice(1));case 7:return e.resolve(a.slice(1));default:return null}};var b=function(b,d,e){var g=Buffer.alloc(9);g.writeUInt8(b,0);g.writeUInt8(0,1);g.writeUInt8(0,2);g.writeUInt8(0,3);b=0;for(var k=4;8>b;b+=2,k++){var h=d.substr(b,2);g.writeUInt8(parseInt(h,16),k)}g.writeUInt8(e,8);a.call(this,5,g)};b.prototype=new a;b.prototype.constructor=b;b.prototype.getData=function(){return this._data.slice(1,2)};b.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};
b.prototype.getStatus=function(){return this._data.readUInt8(9)};b.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.type="RPS";return b};b.resolve=function(a){var d=a.readUInt8(0),e=a.slice(4,8).toString("hex");a=a.readUInt8(8);return new b(d,e,a)};var d=function(b,d,e){var g=Buffer.alloc(9);g.writeUInt8(b,0);g.writeUInt8(0,1);g.writeUInt8(0,2);g.writeUInt8(0,3);b=0;for(var k=4;8>b;b+=2,k++){var h=d.substr(b,2);g.writeUInt8(parseInt(h,16),k)}g.writeUInt8(e,8);a.call(this,6,g)};d.prototype=
new a;d.prototype.constructor=d;d.prototype.isTeachIn=function(){return 0==(this._data.readUInt8(1)&8)};d.prototype.getData=function(){return this._data.slice(1,2)};d.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};d.prototype.getStatus=function(){return this._data.readUInt8(9)};d.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.type="1BS";b.teachin=this.isTeachIn();return b};d.resolve=function(a){var b=a.readUInt8(0),e=a.slice(4,8).toString("hex");
a=a.readUInt8(8);return new d(b,e,a)};var e=function(b,d,e){for(var g=Buffer.alloc(9),k=0;4>k;k++)g.writeUInt8(b.readUInt8(k),k);b=0;for(k=4;8>b;b+=2,k++){var h=d.substr(b,2);g.writeUInt8(parseInt(h,16),k)}g.writeUInt8(e,8);a.call(this,7,g)};e.prototype=new a;e.prototype.constructor=e;e.prototype.isTeachIn=function(){return 0==(this.getData().readUInt8(3)&8)};e.prototype.getProfile=function(){var a=this.getData(),b=a.readUInt8(0)>>2;a=(a.readUInt8(0)&3)<<5|a.readUInt8(1)>>3&31;return Buffer.from([7,
b,a])};e.prototype.getProfileText=function(){var a=this.getProfile().toString("hex");return a.substr(0,2)+"-"+a.substr(2,2)+"-"+a.substr(4,2)};e.prototype.getManufacturerId=function(){var a=this.getData().slice(1,3);a.writeUInt8(a.readUInt8(0)&7,0);return a.toString("hex")};e.prototype.getLearnType=function(){return this.getData().readUInt8(3)>>7&1};e.prototype.getEEPResult=function(){return this.getData().readUInt8(3)>>6&1};e.prototype.getLearnResult=function(){return this.getData().readUInt8(3)>>
5&1};e.prototype.getLearnStaus=function(){return this.getData().readUInt8(3)>>4&1};e.prototype.getData=function(){return this._data.slice(1,5)};e.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex")};e.prototype.getStatus=function(){return this._data.readUInt8(9)};e.prototype.toJSON=function(){var b=a.prototype.toJSON.call(this);b.type="4BS";b.teachin=this.isTeachIn();b.teachin&&(b.teachin_info={profile:this.getProfileText(),learn_type:this.getLearnType(),eep_result:this.getEEPResult(),
learn_result:this.getLearnResult(),learn_status:this.getLearnStaus()},b.teachin_info.learn_type&&(b.teachin_info.manufactureID=this.getManufacturerId()));return b};e.resolve=function(a){var b=a.slice(0,4),d=a.slice(4,8).toString("hex");a=a.readUInt8(8);return new e(b,d,a)};a.RPS=b;a.BS1=d;a.BS4=e;return a}(),h=function(a,b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP2");this._controller=a;this._listeners=[];a&&this._listeners.push(a);this._baudrate=b;this._baudrate||(this._baudrate=
9600);this._baseID=this._serial=null;this._rdata=new Buffer([]);this._telegramBuffer=[];this._learnHandler=null;this._learning=!1;this._learnTO=null};h.RESPONSE_TO=1500;h.prototype.attachSerial=function(a,b){var d=this;this._serial=new x.hub.m.enocean.Serial(a,this._baudrate);this._serial.setListener(this);this._serial.open(function(a){a?(d._serial.setListener(null),d._serial=null,b&&b(a)):d.readBaseID(function(a,e){a?(d._serial.setListener(null),d._serial.close(),d._serial=null,b&&b(a)):(d._baseID=
e,b&&b())})})};h.prototype.removeSerial=function(a,b){this._serial.setListener(null);this._serial.close();this._baseID=this._serial=null;b&&b()};h.prototype.getSerial=function(){return this._serial};h.prototype.readBaseID=function(a){var b=this,e=new d.RD_BASEID;this.sendTelegram(e,2E3,function(d,e){d?(b._logger.log("warn","read base id error:"+d.stack),a&&a(d)):e instanceof g.INF_BASEID?(d=e.getBaseID(),a&&a(null,d.toLowerCase())):(d=Error("read base id failed"),b._logger.log("warn","read base id failed:"+
e.retCode),a&&a(d))})};h.prototype.sendTelegram=function(a,b,d){this._logger.log("debug","send enocean telegram:"+JSON.stringify(a.toJSON()));var e=this._telegramBuffer.length;this._telegramBuffer.push({telegram:a,callback:d,timeout:null,to:b});0==e&&this._sendNextTelegram()};h.prototype._sendNextTelegram=function(){if(0!=this._telegramBuffer.length){var a=this._telegramBuffer[0],e=a.telegram,g=a.callback,l=!0;if(e instanceof d.RESET||e instanceof b)l=!1;if(this._serial){var u=this;e=e.toBuffer();
this._logger.log("trace","send raw telegram:"+e.toString("hex"));this._serial.sendPacket(e,function(b){if(b||!l){try{g&&g(b)}catch(y){}u._telegramBuffer.splice(0,1);u._sendNextTelegram()}else b=a.to,b||(b=h.RESPONSE_TO),a.timeout=setTimeout(function(){var a=Error("enocean response timeout");a.code=100;try{g&&g(a)}catch(C){}u._telegramBuffer.splice(0,1);u._sendNextTelegram()},b)})}else g&&g(Error("port not opened")),this._telegramBuffer.splice(0,1),this._sendNextTelegram()}};h.prototype.onSerialData=
function(a){for(var b=this._rdata=Buffer.concat([this._rdata,a]),d=0;d<b.length;)if(165!=b[d])d++;else{if(d+d>=b.length)break;if(90!=b[d+1])d+=2;else{if(d+2>=b.length)break;var g=b[d+2]>>5&7,h=b[d+2]&31;if(2>=h)d+=3;else{if(d+3+h>b.length)break;a=b.slice(d+3,d+3+h-1);for(var k=b[d+3+h-1],l=0,C=d+2;C<d+3+h-1;C++)l+=b[C];l&=255;if(l!=k)this._logger.log("trace","acctual crc:"+l.toString(16)+" expected crc:"+k.toString(16));else{this._logger.log("trace","hseq:"+g+" len:"+h+" data:"+a.toString("hex")+
" crc:"+k.toString(16));a=e.resolve(g,a);try{a&&this._onESP2Telegram(a)}catch(w){this._logger.log("warn","process esp2 telegram exception:"+w.stack)}}d=d+3+h}}}0!=d&&0<b.length&&d<=b.length&&(b=b.slice(d));this._rdata=b};h.prototype.onSerialError=function(a){this._serial.setListener(null);this._serial=null};h.prototype._onESP2Telegram=function(e){if(!(e instanceof b||e instanceof d)){this._logger.log("debug","receive enocean telegram:"+JSON.stringify(e.toJSON()));if(e instanceof a){var h=e.toPayload();
this._logger.log("debug","receive enocean payload:"+JSON.stringify(h.toJSON()));this._listeners.forEach(function(a){a._onESP2Telegram&&a._onESP2Telegram(e)})}if(0!=this._telegramBuffer.length&&e instanceof g){var l=this._telegramBuffer[0];h=l.callback;(l=l.timeout)&&clearTimeout(l);try{h&&h(null,e)}catch(p){}this._telegramBuffer.splice(0,1);this._sendNextTelegram()}}};h.TRT=b;h.Payload=l;h.Telegram=e;return h}();
x.hub.m.enocean.profiles=function(){var e=function(c){this._address=c?c.address:null;this._senderID=c?c.senderID:null;this._data=c?c.data:null;this._params=c?c.params:null;this._vendor="general";this._virtual=!1;this._eepAlias=null;this.setDefaultParams();this._states={};this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles."+(this._data?this._data:"Profile"))};e.prototype.getAddress=function(){return this._address};e.prototype.getData=function(){return this._data};e.prototype.finalize=
function(c){c&&c()};e.prototype.evalData=function(c,f,a){(c=this.evalTelegram(f))?(c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};e.prototype.evalTelegram=function(c){return null};e.prototype.getStatesBuffer=function(){return this._states};e.prototype.getBufferedState=function(c){var f=this.getStatesBuffer();return f&&f[c]?f[c].value:null};e.prototype.getCurrentStates=function(){var c={},f=this.getStatesBuffer(),a;for(a in f)f.hasOwnProperty(a)&&f[a]&&(c[a]=f[a].value);
return c};e.prototype.getStatesLegacy=function(){var c=this.getCurrentStates();return{type:"ENOCEAN",adr:this._address,data:this._data,vendor:this._vendor,state:c}};e.prototype.checkStateChange=function(c){var f=this._states,a=[],b=(new Date).getTime(),d;for(d in c){var e={};e.key=d;e.value=c[d];e.changed=!1;var g=f[d]?f[d].value:null;g!=c[d]&&(e.oldvalue=g,e.changed=!0);this._states[d]={value:c[d],time:b};a.push(e)}return a};e.prototype.setDefaultParams=function(){};e.prototype.activeStateChange=
function(c){c=this.checkStateChange(c);0<c.length&&require("x.hub.m.enocean.js")._onEOEvents(this,c)};e.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params}};e.prototype.fromJSON=function(c){if(!c||!c.address||!c.data||c.data!=this._data)return null;this._address=c.address;this._senderID=c.senderID;this._vendor=c.vendor?c.vendor:this._vendor;this._virtual=c.virtual?!0:!1;this._params=
c.params;this.setDefaultParams();return this};e.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual}};e.prototype.fromDBJSON=function(c){if(!c||!c.id||!c.eep||c.eep!=this._data)return null;this._address=c.id;this._senderID=c.senderID;this._vendor=c.vendor?c.vendor:this._vendor;this._virtual=c.virtual?!0:!1;this._params=c.params;this.setDefaultParams();return this};var b=function(c){e.call(this,c);
this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SiegeniaWindow");this._data="d2-06-50";this._vendor="siegenia";this._desc="Window";this._states={counter00:{value:"?",time:-1},counter01:{value:"?",time:-1},counter02:{value:"?",time:-1},counter03:{value:"?",time:-1},counter04:{value:"?",time:-1},counter05:{value:"?",time:-1},counter06:{value:"?",time:-1},counter07:{value:"?",time:-1},counter08:{value:"?",time:-1},counter09:{value:"?",time:-1},counter0A:{value:"?",time:-1},aliveTimeout:{value:!1,
time:-1}};var f=this;this._params=c?c.params:null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});this._aliveTO=setTimeout(function(){f._aliveTimeout()},2E3*this._params.alive);this._lastAlarm=null};b.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"SIEGENIA-AUBI KG",vendor:"siegenia",params:{alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}};b.prototype=new e;b.prototype.constructor=b;b.prototype.evalTelegram=function(c){var f={};if(210==c.rorg)if(c=c.userData,
1==c[0]&&8==c.length){var a=c[1]&239,b=(c[2]<<24)+(c[3]<<16)+(c[4]<<8)+c[5],d=c[6]>>7;f={type:1,TBT:!1,batteryOK:!0,battery:c[6]&127,motionSensor:c[7]>>6,accelerationSensor:(c[7]&48)>>4,magneticSensor:(c[7]&12)>>2,error:c[7]&3,count:b};d&&(f.batteryOK=!1);100<f.battery&&(f.battery=100);f.code=a;switch(a){case 0:f.state="?";f.handle="?";f.counter00=b;break;case 1:f.state="closed";f.handle="closed";f.counter01=b;break;case 2:f.state="closed";f.handle="open";f.counter02=b;break;case 3:f.state="closed";
f.handle="tilted";f.counter03=b;break;case 4:f.state="open";f.handle="closed";f.counter04=b;break;case 5:f.state="open";f.handle="open";f.TBT=!0;f.counter05=b;break;case 6:f.state="open";f.handle="tilted";f.TBT=!0;f.counter06=b;break;case 7:f.state="tilted";f.handle="closed";f.TBT=!0;f.counter07=b;break;case 8:f.state="tilted";f.handle="open";f.TBT=!0;f.counter08=b;break;case 9:f.state="tilted";f.handle="tilted";f.counter09=b;break;case 10:f.state="?",f.handle="?",f.counter0A=b}}else if(2==c[0]&&
2==c.length)switch(f.type=2,c[1]&15){case 1:f.burglary=!0;break;default:f.burglary=!1}else if(17==c[0]&&2==c.length){f.type=17;switch((c[1]&192)>>6){case 0:f.calibrationState="ok";break;case 1:f.calibrationState="error";break;case 2:f.calibrationState="invalid";break;case 3:f.calibrationState="not_supported"}c=c[1]&63;f.calibrationStep=c;switch(c){case 0:f.calibrationCasement="none";f.calibrationHandle="none";break;case 1:f.calibrationCasement="closed";f.calibrationHandle="closed";break;case 2:f.calibrationCasement=
"closed";f.calibrationHandle="open";break;case 3:f.calibrationCasement="closed";f.calibrationHandle="tilted";break;case 4:f.calibrationCasement="open";f.calibrationHandle="closed";break;case 5:f.calibrationCasement="open";f.calibrationHandle="open";break;case 6:f.calibrationCasement="open";f.calibrationHandle="tilted";break;case 7:f.calibrationCasement="tilted";f.calibrationHandle="closed";break;case 8:f.calibrationCasement="tilted";f.calibrationHandle="open";break;case 9:f.calibrationCasement="tilted",
f.calibrationHandle="tilted"}}return f};b.prototype.evalData=function(c,f,a){var b=this;b._states.aliveTimeout.value=!1;clearTimeout(this._aliveTO);this._aliveTO=setTimeout(function(){b._aliveTimeout()},2E3*this._params.alive);if(c=this.evalTelegram(f)){if(2==c.type){f=(new Date).getTime();if(this._lastAlarm&&4E3>f-this._lastAlarm){a&&a(Error("duplicated alarm"));return}this._lastAlarm=f}f=[];c.aliveMsg||(f=this.checkStateChange(c));a&&a(null,f)}else a&&a(Error("data format invalid"))};b.prototype.checkStateChange=
function(c){var f=this._states,a=[],b;for(b in c)if("aliveMsg"!=b&&"type"!=b){var d={};d.key=b;d.value=c[b];d.changed=!1;var e=f[b]?f[b].value:null;e!=c[b]&&(d.oldvalue=e,d.changed=!0);"burglary"!=b&&"calibrationState"!=b&&"calibrationCasement"!=b&&"calibrationHandle"!=b&&(this._states[b]={value:c[b],time:(new Date).getTime()});a.push(d)}return a};b.prototype._resolveStates=function(c,f){f={};if(210==c[0])if(c=c.slice(1,c.length-5),1==c[0]&&8==c.length){var a=c[1]&239,b=(c[2]<<24)+(c[3]<<16)+(c[4]<<
8)+c[5],d=c[6]>>7;f={aliveMsg:1==(c[1]&128)>>7,TBT:!1,batteryOK:!0,battery:c[6]&127,motionSensor:c[7]>>6,accelerationSensor:(c[7]&48)>>4,magneticSensor:(c[7]&12)>>2,error:c[7]&3,count:b};d&&(f.batteryOK=!1);100<f.battery&&(f.battery=100);switch(a){case 0:f.state="closed";f.handle="closed";f.counter00=b;break;case 1:f.state="closed";f.handle="open";f.counter01=b;break;case 2:f.state="open";f.handle="open";f.counter02=b;break;case 3:f.state="closed";f.handle="tilted";f.counter03=b;break;case 4:f.state=
"tilted";f.handle="tilted";f.counter04=b;break;case 5:f.state="closed";f.handle="tilted";f.TBT=!0;f.counter05=b;break;case 6:f.state="tilted";f.handle="tilted";f.TBT=!0;f.counter06=b;break;case 7:f.state="closed";f.handle="open";f.TBT=!0;f.counter07=b;break;case 8:f.state="open";f.handle="open";f.TBT=!0;f.counter08=b;break;case 9:f.state="open";f.handle="closed";f.counter09=b;break;case 10:f.state="open",f.handle="tilted",f.counter0A=b}}else if(2==c[0]&&2==c.length)switch(c[1]&15){case 1:f.burglary=
!0;break;default:f.burglary=!1}else if(17==c[0]&&2==c.length){switch((c[1]&192)>>6){case 0:f.calibrationState="ok";break;case 1:f.calibrationState="error";break;case 2:f.calibrationState="invalid";break;case 3:f.calibrationState="not_supported"}switch(c[1]&63){case 0:f.calibrationCasement="none";f.calibrationHandle="none";break;case 1:f.calibrationCasement="closed";f.calibrationHandle="closed";break;case 2:f.calibrationCasement="closed";f.calibrationHandle="open";break;case 3:f.calibrationCasement=
"closed";f.calibrationHandle="tilted";break;case 4:f.calibrationCasement="open";f.calibrationHandle="closed";break;case 5:f.calibrationCasement="open";f.calibrationHandle="open";break;case 6:f.calibrationCasement="open";f.calibrationHandle="tilted";break;case 7:f.calibrationCasement="tilted";f.calibrationHandle="closed";break;case 8:f.calibrationCasement="tilted";f.calibrationHandle="open";break;case 9:f.calibrationCasement="tilted",f.calibrationHandle="tilted"}}return f};b.prototype._aliveTimeout=
function(){this.activeStateChange({aliveTimeout:!0})};b.prototype.fromJSON=function(c){if(!e.prototype.fromJSON.call(this,c))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});return this};b.prototype.fromDBJSON=function(c){if(!e.prototype.fromDBJSON.call(this,c))return null;this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0});return this};var a=function(c){e.call(this,c);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.MacoWindow");
this._data="d5-xx-xx";this._desc="Window";this._vendor="maco"};a.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"Mayer & Co Beschl\u00e4ge GmbH"};a.prototype=new e;a.prototype.constructor=a;a.prototype.evalData=function(c,f,a){(c=this._resolveStates(c,f))?(c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};a.prototype._resolveStates=function(c,f){f={};if(213==c[0]){c=c.slice(1,c.length-5);var a=(c[0]&8)>>3,b=(c[0]&6)>>1,d=c[0]&1;switch((c[0]&48)>>4){case 0:f.state=
"unused";break;case 1:f.state="tilted";break;case 2:f.state="open";break;case 3:f.state="closed"}f.learn=a;f.battery=b;f.alarm=d}return f};a.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:this._desc,manufacturer:"Mayer & Co Beschl\u00e4ge GmbH",vendor:this._vendor}};var g=function(c){e.call(this,c);this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SodaHandle");this._data="f6-so-da"};g.TEMPALTE={id:null,eep:null};g.prototype=new e;g.prototype.constructor=
g;g.prototype.evalTelegram=function(c){var f={};if(246==c.rorg)switch(c.userData){case 240:f.state="tilted";break;case 192:f.state="open";break;case 208:f.state="closed"}return f};g.prototype.evalData=function(c,f,a){(c=this.evalTelegram(f))?(c=this.checkStateChange(c),a&&a(null,c)):a&&a(Error("data format invalid"))};g.prototype.toJSON=function(c,f){return{address:this._address,data:this._data,vendor:"soda"}};g.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:"Window_Handle",
manufacturer:"SODA",vendor:"soda"}};var d=function(c){e.call(this,c);this._data="f6-??-??"};d.prototype=new e;d.prototype.constructor=d;var l=function(c){d.call(this,c);this._data="f6-01-01";this._longPressThreshold=1E3};l.STATES=["button"];l.COMMANDS=["shortPress","longPress","press","release"];l.prototype=new d;l.prototype.constructor=h;l.prototype.evalTelegram=function(c){var f={};246==c.rorg&&(f.button=c.userData>>4&1?"pressed":"released");return f};l.prototype.buildData=function(c){return c<<
4};l.prototype.checkStateChange=function(c){var f=this._states,a=[],b=(new Date).getTime(),d;for(d in c){var e={};e.key=d;e.value=c[d];e.changed=!1;var g=f[d]?f[d].value:null,h=f[d]?f[d].time:null,l=c[d];g!=l&&(e.oldvalue=g,e.changed=!0);this._states[d]={value:c[d],time:b};e.changed&&a.push(e);"pressed"==g&&"released"==l&&(!h||b-h<this._longPressThreshold?(e={},e.key=d,e.value="shortPress"):(e={},e.key=d,e.value="longPress"),e.changed=!0,a.push(e))}return a};l.prototype.executeCommand=function(c,
f,a){if(this._senderID)if(f&&f.value){var b=this,d=100;switch(f.value){case "longPress":d=this._longPressThreshold;case "shortPress":var r=this.buildData(1);var e=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null);c.sendTelegram(e,!0,function(f){f?a&&a(f):(b.activeStateChange({button:"pressed"}),setTimeout(function(){r=b.buildData(0);e=new x.hub.m.enocean.ESP3.Telegram.RPS(r,b._senderID,1,1,0,null);c.sendTelegram(e,!0,function(c){b.activeStateChange({button:"released"});a&&a(c)})},
d))});break;case "press":r=this.buildData(1);e=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null);c.sendTelegram(e,!0,function(c){b.activeStateChange({button:"pressed"});a&&a(c)});break;case "release":r=this.buildData(0),e=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),c.sendTelegram(e,!0,function(c){b.activeStateChange({button:"released"});a&&a(c)})}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var h=function(c){d.call(this,c);this._data=
"f6-02-01";this._longPressThreshold=1E3};h.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];h.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");h.prototype=new d;h.prototype.constructor=h;h.prototype.evalTelegram=function(c){var f={};if(246==c.rorg){var a=c.userData>>5&7,b=c.userData>>1&7,d=c.userData&1,e=c.t21,g=c.nu;c=c.userData>>4&1?"pressed":"released";
if(1==e&&1==g){switch(a){case 0:var h=c;break;case 1:var l=c;break;case 2:var k=c;break;case 3:var n=c}if(d)switch(b){case 0:h=c;break;case 1:l=c;break;case 2:k=c;break;case 3:n=c}}else if(1==e&&0==g)switch(a){case 0:n=k=l=h=c}h&&(f.buttonAI=h);l&&(f.buttonAO=l);k&&(f.buttonBI=k);n&&(f.buttonBO=n)}return f};h.prototype.buildData=function(c,f,a,b){return c<<5|f<<4|a<<1|b};h.prototype.checkStateChange=function(c){var f=this._states,a=[],b=(new Date).getTime(),d;for(d in c){var e={};e.key=d;e.value=
c[d];e.changed=!1;var g=f[d]?f[d].value:null,h=f[d]?f[d].time:null,l=c[d];g!=l&&(e.oldvalue=g,e.changed=!0);this._states[d]={value:c[d],time:b};e.changed&&("pressed"==l||"released"==l&&"pressed"==g)&&a.push(e);"pressed"==g&&"released"==l&&(!h||b-h<this._longPressThreshold?(e={},e.key=d,e.value="shortPress"):(e={},e.key=d,e.value="longPress"),e.changed=!0,a.push(e))}return a};h.prototype.executeCommand=function(c,f,a){if(this._senderID)if(f&&f.value){var b=this,d=100,r=f.value.substr(f.value.length-
2),e={},g=0;switch(r){case "AI":g=0;break;case "AO":g=1;break;case "BI":g=2;break;case "BO":g=3}switch(f.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":d=this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":var h=this.buildData(g,1,0,0);var l=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(l,!0,function(f){f?a&&a(f):(e["button"+r]="pressed",b.activeStateChange(e),setTimeout(function(){h=
b.buildData(0,0,0,0);l=new x.hub.m.enocean.ESP3.Telegram.RPS(h,b._senderID,1,1,0,null);c.sendTelegram(l,!0,function(c){e["button"+r]="released";b.activeStateChange(e);a&&a(c)})},d))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":h=this.buildData(g,1,0,0);l=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(l,!0,function(c){e["button"+r]="pressed";b.activeStateChange(e);a&&a(c)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":h=
b.buildData(0,0,0,0);l=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(l,!0,function(c){e["button"+r]="released";b.activeStateChange(e);a&&a(c)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var k=function(c){h.call(this,c);this._data="f6-02-02"};h.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"];k.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO".split(" ");
k.prototype=new h;k.prototype.constructor=k;var n=function(c){d.call(this,c);this._data="f6-02-03"};n.STATES=["state"];n.COMMANDS=["auto","manu","dimUp","dimDown"];n.prototype=new d;n.prototype.constructor=n;n.prototype.evalTelegram=function(c){var f={};if(246==c.rorg)switch(c.userData){case 48:f.state="auto";break;case 16:f.state="manu";break;case 112:f.state="dimUp";break;case 80:f.state="dimDown"}return f};n.prototype.executeCommand=function(c,f,a){if(this._senderID)if(f&&f.value){switch(f.value){case "auto":var b=
48;break;case "manu":b=16;break;case "dimUp":b=112;break;case "dimDown":b=80;break;default:a&&a(Error("unknow command"))}this.activeStateChange({state:f.value});f=new x.hub.m.enocean.ESP3.Telegram.RPS(b,this._senderID,1,1,0,null);c.sendTelegram(f,!0,function(c){a&&a(c)})}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var q=function(c){h.call(this,c);this._data="f6-02-04";this._longPressThreshold=1E3};q.STATES=["buttonAI","buttonAO","buttonBI","buttonBO","energyBow"];q.prototype=
new h;q.prototype.constructor=q;q.prototype.evalTelegram=function(c){var f={};if(246==c.rorg){var a=c.userData>>3&1,b=c.userData>>2&1,d=c.userData>>1&1,e=c.userData&1;f.energyBow=c.userData>>7&1?"pressed":"released";f.buttonBI=a?"pressed":"released";f.buttonBO=b?"pressed":"released";f.buttonAI=d?"pressed":"released";f.buttonAO=e?"pressed":"released"}return f};var p=function(c){h.call(this,c);this._data="f6-03-01";this._longPressThreshold=1E3};p.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");
p.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");p.prototype=new h;p.prototype.constructor=p;p.prototype.evalTelegram=function(c){var f={};if(246==c.rorg){var a=c.userData>>5&7,b=c.userData>>
1&7,d=c.userData&1,e=c.t21,g=c.nu;c=c.userData>>4&1?"pressed":"released";if(0==e&&1==g){switch(a){case 0:var h=c;break;case 1:var l=c;break;case 2:var k=c;break;case 3:var n=c;break;case 4:var ha=c;break;case 5:var q=c;break;case 6:var m=c;break;case 7:var p=c}if(d)switch(b){case 0:h=c;break;case 1:l=c;break;case 2:k=c;break;case 3:n=c;break;case 4:ha=c;break;case 5:q=c;break;case 6:m=c;break;case 7:p=c}}else if(0==e&&0==g)switch(a){case 0:case 7:p=m=q=ha=n=k=l=h=c}h&&(f.buttonAI=h);l&&(f.buttonAO=
l);k&&(f.buttonBI=k);n&&(f.buttonBO=n);ha&&(f.buttonCI=ha);q&&(f.buttonCO=q);m&&(f.buttonDI=m);p&&(f.buttonDO=p)}return f};p.prototype.executeCommand=function(c,f,a){if(this._senderID)if(f&&f.value){var b=this,d=100,r=f.value.substr(f.value.length-2),e={},g=0;switch(r){case "AI":g=0;break;case "AO":g=1;break;case "BI":g=2;break;case "BO":g=3;break;case "CI":g=4;break;case "CO":g=5;break;case "DI":g=6;break;case "DO":g=7}switch(f.value){case "longPressAI":case "longPressAO":case "longPressBI":case "longPressBO":case "longPressCI":case "longPressCO":case "longPressDI":case "longPressDO":d=
this._longPressThreshold;case "shortPressAI":case "shortPressAO":case "shortPressBI":case "shortPressBO":case "shortPressCI":case "shortPressCO":case "shortPressDI":case "shortPressDO":var h=this.buildData(g,1,0,0);var l=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(l,!0,function(f){f?a&&a(f):(e["button"+r]="pressed",b.activeStateChange(e),setTimeout(function(){h=b.buildData(0,0,0,0);l=new x.hub.m.enocean.ESP3.Telegram.RPS(h,b._senderID,1,1,0,null);c.sendTelegram(l,
!0,function(c){e["button"+r]="released";b.activeStateChange(e);a&&a(c)})},d))});break;case "pressAI":case "pressAO":case "pressBI":case "pressBO":case "pressCI":case "pressCO":case "pressDI":case "pressDO":h=this.buildData(g,1,0,0);l=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(l,!0,function(c){e["button"+r]="pressed";b.activeStateChange(e);a&&a(c)});break;case "releaseAI":case "releaseAO":case "releaseBI":case "releaseBO":case "releaseCI":case "releaseCO":case "releaseDI":case "releaseDO":h=
b.buildData(0,0,0,0);l=new x.hub.m.enocean.ESP3.Telegram.RPS(h,this._senderID,1,1,0,null);c.sendTelegram(l,!0,function(c){e["button"+r]="released";b.activeStateChange(e);a&&a(c)});break;default:a&&a(Error("unknow command"))}}else a&&a(Error("command invalid"));else a&&a(Error("sender id is null"))};var u=function(c){p.call(this,c);this._data="f6-03-02"};u.STATES="buttonAI buttonAO buttonBI buttonBO buttonCI buttonCO buttonDI buttonDO".split(" ");u.COMMANDS="shortPressAI longPressAI pressAI releaseAI shortPressAO longPressAO pressAO releaseAO shortPressBI longPressBI pressBI releaseBI shortPressBO longPressBO pressBO releaseBO shortPressCI longPressCI pressCI releaseCI shortPressCO longPressCO pressCO releaseCO shortPressDI longPressDI pressDI releaseDI shortPressDO longPressDO pressDO releaseDO".split(" ");
u.prototype=new p;u.prototype.constructor=u;var E=function(c){d.call(this,c);this._data="f6-04-01"};E.STATES=["keycard"];E.prototype=new d;E.prototype.constructor=E;E.prototype.evalTelegram=function(c){var f={};if(246==c.rorg){var a=c.t21,b=c.nu;c=c.userData;1==a&&1==b&&112==c?f.keycard="inserted":1==a&&0==b&&0==c&&(f.keycard="takeout")}return f};var y=function(c){d.call(this,c);this._data="f6-04-02"};y.STATES=["keycard"];y.prototype=new d;y.prototype.constructor=y;y.prototype.evalTelegram=function(c){var f=
{};if(246==c.rorg){var a=c.userData>>7&1;c=c.userData>>2&1;1==a&&1==c?f.keycard="inserted":0==a&&0==c&&(f.keycard="takeout")}return f};var C=function(c){d.call(this,c);this._data="f6-05-00"};C.STATES=["wind","lowbat"];C.prototype=new d;C.prototype.constructor=C;C.prototype.evalTelegram=function(c){var f={};if(246==c.rorg)switch(c.userData){case 0:f.wind="ok";this._states.lowbat||(f.lowbat=!1);break;case 16:f.wind="alarm";this._states.lowbat||(f.lowbat=!1);break;case 48:f.lowbat=!0}return f};var w=
function(c){d.call(this,c);this._data="f6-05-01"};w.COMMANDS=["reset"];w.STATES=["water"];w.prototype=new d;w.prototype.constructor=w;w.prototype.evalTelegram=function(c){var f={};if(246==c.rorg){var a=c.nu,b=c.userData;1==c.t21&&1==a&&17==b&&(f.water="alarm")}return f};w.prototype.executeCommand=function(c,f,a){if(f&&f.value)switch(f.value){case "reset":this.activeStateChange({water:"ok"});a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};var A=function(c){d.call(this,
c);this._data="f6-05-02"};A.STATES=["smoke","lowbat"];A.prototype=new d;A.prototype.constructor=A;A.prototype.evalTelegram=function(c){var f={};if(246==c.rorg)switch(c.userData){case 0:f.smoke="ok";this._states.lowbat||(f.lowbat=!1);break;case 16:f.smoke="alarm";this._states.lowbat||(f.lowbat=!1);break;case 48:f.lowbat=!0}return f};var O=function(c){d.call(this,c);this._data="f6-10-00"};O.STATES=["window","handle_pos","handle_raw"];O.prototype=new d;O.prototype.constructor=O;O.prototype.evalTelegram=
function(c){var f={};246==c.rorg&&(c=c.userData,0==(c&208^192)?(f.window="open",f.handle_pos="middle"):0==(c&240^240)?(f.window="closed",f.handle_pos="down"):0==(c&240^208)&&(f.window="tilted",f.handle_pos="up"),f.handle_raw=c);return f};var U=function(c){d.call(this,c);this._data="f6-10-01"};U.STATES=["window","handle_pos","handle_raw"];U.prototype=new d;U.prototype.constructor=U;U.prototype.evalTelegram=function(c){var f={};246==c.rorg&&(c=c.userData&15,0==(c&13^12)?(f.window="open",f.handle_pos=
"middle"):0==(c&15^15)?(f.window="closed",f.handle_pos="down"):0==(c&15^13)&&(f.window="tilted",f.handle_pos="up"),f.handle_raw=c);return f};var X=function(c){e.call(this,c);this._data="d5-??-??"};X.prototype=new e;X.prototype.constructor=X;var N=function(c){X.call(this,c);this._data="d5-00-01"};N.STATES=["contact","contact_raw"];N.prototype=new X;N.prototype.constructor=N;N.prototype.evalTelegram=function(c){var f={};213==c.rorg&&(c=c.userData,1==(c>>3&1)&&(c&=1,f.contact=c?"closed":"open",f.contact_raw=
c));return f};var t=function(c){e.call(this,c);this._data="a5-??-??";this.TEACH_IN_VARIATION=2;this.UNIQUE_GATEWAY_SENDERID=!0};t.prototype=new e;t.prototype.constructor=t;t.prototype.getTeachinType=function(){return"4BS"};t.prototype.isTeachinBidirectional=function(){return!1};var m=function(c){t.call(this,c);this._data="a5-02-??";this._tmpMin=-40;this._tmpMax=0};m.STATES=["temperature","temperature_raw"];m.prototype=new t;m.prototype.constructor=m;m.prototype.evalTelegram=function(c){var f={};if(165==
c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);1==(a>>3&1)&&(f.temperature=parseFloat(((255-c)/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),f.temperature_raw=c)}return f};var Y=function(c){m.call(this,c);this._data="a5-02-01";this._tmpMin=-40;this._tmpMax=0};Y.STATES=["temperature","temperature_raw"];Y.prototype=new m;Y.prototype.constructor=Y;var K=function(c){m.call(this,c);this._data="a5-02-02";this._tmpMin=-30;this._tmpMax=10};K.STATES=["temperature","temperature_raw"];
K.prototype=new m;K.prototype.constructor=K;var oa=function(c){m.call(this,c);this._data="a5-02-03";this._tmpMin=-20;this._tmpMax=20};oa.STATES=["temperature","temperature_raw"];oa.prototype=new m;oa.prototype.constructor=oa;var M=function(c){m.call(this,c);this._data="a5-02-04";this._tmpMin=-10;this._tmpMax=30};M.STATES=["temperature","temperature_raw"];M.prototype=new m;M.prototype.constructor=M;var P=function(c){m.call(this,c);this._data="a5-02-05";this._tmpMin=0;this._tmpMax=40};P.STATES=["temperature",
"temperature_raw"];P.prototype=new m;P.prototype.constructor=P;var ca=function(c){m.call(this,c);this._data="a5-02-06";this._tmpMin=10;this._tmpMax=50};ca.STATES=["temperature","temperature_raw"];ca.prototype=new m;ca.prototype.constructor=ca;var Z=function(c){m.call(this,c);this._data="a5-02-07";this._tmpMin=20;this._tmpMax=60};Z.STATES=["temperature","temperature_raw"];Z.prototype=new m;Z.prototype.constructor=Z;var aa=function(c){m.call(this,c);this._data="a5-02-08";this._tmpMin=30;this._tmpMax=
70};aa.STATES=["temperature","temperature_raw"];aa.prototype=new m;aa.prototype.constructor=aa;var Qa=function(c){m.call(this,c);this._data="a5-02-09";this._tmpMin=40;this._tmpMax=80};Qa.STATES=["temperature","temperature_raw"];Qa.prototype=new m;Qa.prototype.constructor=Qa;var v=function(c){m.call(this,c);this._data="a5-02-0a";this._tmpMin=50;this._tmpMax=90};v.STATES=["temperature","temperature_raw"];v.prototype=new m;v.prototype.constructor=v;var z=function(c){m.call(this,c);this._data="a5-02-0b";
this._tmpMin=60;this._tmpMax=100};z.STATES=["temperature","temperature_raw"];z.prototype=new m;z.prototype.constructor=z;var Oa=function(c){m.call(this,c);this._data="a5-02-10";this._tmpMin=-60;this._tmpMax=20};Oa.STATES=["temperature","temperature_raw"];Oa.prototype=new m;Oa.prototype.constructor=Oa;var dc=function(c){m.call(this,c);this._data="a5-02-11";this._tmpMin=-50;this._tmpMax=30};dc.STATES=["temperature","temperature_raw"];dc.prototype=new m;dc.prototype.constructor=dc;var Pa=function(c){m.call(this,
c);this._data="a5-02-12";this._tmpMin=-40;this._tmpMax=40};Pa.STATES=["temperature","temperature_raw"];Pa.prototype=new m;Pa.prototype.constructor=Pa;var ec=function(c){m.call(this,c);this._data="a5-02-13";this._tmpMin=-30;this._tmpMax=50};ec.STATES=["temperature","temperature_raw"];ec.prototype=new m;ec.prototype.constructor=ec;var fc=function(c){m.call(this,c);this._data="a5-02-14";this._tmpMin=-20;this._tmpMax=60};fc.STATES=["temperature","temperature_raw"];fc.prototype=new m;fc.prototype.constructor=
fc;var Ga=function(c){m.call(this,c);this._data="a5-02-15";this._tmpMin=-10;this._tmpMax=70};Ga.STATES=["temperature","temperature_raw"];Ga.prototype=new m;Ga.prototype.constructor=Ga;var gc=function(c){m.call(this,c);this._data="a5-02-16";this._tmpMin=0;this._tmpMax=80};gc.STATES=["temperature","temperature_raw"];gc.prototype=new m;gc.prototype.constructor=gc;var db=function(c){m.call(this,c);this._data="a5-02-17";this._tmpMin=10;this._tmpMax=90};db.STATES=["temperature","temperature_raw"];db.prototype=
new m;db.prototype.constructor=db;var hc=function(c){m.call(this,c);this._data="a5-02-18";this._tmpMin=20;this._tmpMax=100};hc.STATES=["temperature","temperature_raw"];hc.prototype=new m;hc.prototype.constructor=hc;var ic=function(c){m.call(this,c);this._data="a5-02-19";this._tmpMin=30;this._tmpMax=110};ic.STATES=["temperature","temperature_raw"];ic.prototype=new m;ic.prototype.constructor=ic;var jc=function(c){m.call(this,c);this._data="a5-02-1a";this._tmpMin=40;this._tmpMax=120};jc.STATES=["temperature",
"temperature_raw"];jc.prototype=new m;jc.prototype.constructor=jc;var kc=function(c){m.call(this,c);this._data="a5-02-1b";this._tmpMin=50;this._tmpMax=130};kc.STATES=["temperature","temperature_raw"];kc.prototype=new m;kc.prototype.constructor=kc;var Fa=function(c){t.call(this,c);this._data="a5-02-20";this._tmpMin=-10;this._tmpMax=41.2};Fa.STATES=["temperature","temperature_raw"];Fa.prototype=new t;Fa.prototype.constructor=Fa;Fa.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);
c=c.userData.readUInt16BE(1);1==(a>>3&1)&&(a=c&1023,f.temperature=parseFloat(((1023-a)/1023*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),f.temperature_raw=a)}return f};var lc=function(c){Fa.call(this,c);this._data="a5-02-30";this._tmpMin=-40;this._tmpMax=62.3};lc.STATES=["temperature","temperature_raw"];lc.prototype=new Fa;lc.prototype.constructor=lc;var ia=function(c){t.call(this,c);this._data="a5-04-??";this._humMin=0;this._humMax=100;this._tempMin=0;this._tempMax=40};ia.STATES=["humidity",
"humidity_raw","temperature","temperature_raw","available"];ia.prototype=new t;ia.prototype.constructor=ia;ia.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt8(1);1==(a>>3&1)&&(f.humidity=parseFloat((c/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),f.humidity_raw=c,f.temperature=parseFloat((b/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),f.temperature_raw=b,f.available=a>>1&1?!0:!1)}return f};
var mc=function(c){ia.call(this,c);this._data="a5-04-01"};mc.STATES=ia.STATES;mc.prototype=new ia;mc.prototype.constructor=mc;var Ra=function(c){ia.call(this,c);this._data="a5-04-02";this._tempMin=-20;this._tempMax=60};Ra.STATES=ia.STATES;Ra.prototype=new ia;Ra.prototype.constructor=Ra;var eb=function(c){ia.call(this,c);this._data="a5-04-03";this._tempMin=-20;this._tempMax=60};eb.STATES=["humidity","humidity_raw","temperature","temperature_raw","type"];eb.prototype=new ia;eb.prototype.constructor=
eb;eb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(f.humidity=parseFloat((c/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),f.humidity_raw=c,b&=1023,f.temperature=parseFloat((b/1023*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),f.temperature_raw=b,f.type=a&1?"event":"heartbeat")}return f};var L=function(c){t.call(this,c);this._data="a5-06-??";this._svcMin=0;this._svcMax=
5.1;this._ill2Min=300;this._ill2Max=3E4;this._ill1Min=600;this._ill1Max=6E4};L.STATES="voltage voltage_raw illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw range range_raw".split(" ");L.prototype=new t;L.prototype.constructor=L;L.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.voltage=parseFloat((c/255*(this._svcMax-
this._svcMin)+this._svcMin).toFixed(1));f.voltage_raw=c;f.illumination2=parseFloat((d/255*(this._ill2Max-this._ill2Min)+this._ill2Min).toFixed(1));f.illumination2_raw=d;f.illumination1=parseFloat((b/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1));f.illumination1_raw=b;a&=1;switch(a){case 0:f.range="db1";f.illumination=f.illumination1;f.illumination_raw=b;break;case 1:f.range="db2",f.illumination=f.illumination2,f.illumination_raw=b}f.range_raw=a}}return f};var Sa=function(c){L.call(this,
c);this._data="a5-06-01"};Sa.STATES=L.STATES;Sa.prototype=new L;Sa.prototype.constructor=Sa;var Ha=function(c){L.call(this,c);this._data="a5-06-02";this._ill2Min=0;this._ill2Max=510;this._ill1Min=0;this._ill1Max=1020};Ha.STATES=L.STATES;Ha.prototype=new L;Ha.prototype.constructor=Ha;var fb=function(c){L.call(this,c);this._data="a5-06-03";this._svcMin=0;this._svcMax=5.1};fb.STATES=["voltage","voltage_raw","illumination","illumination_raw"];fb.prototype=new L;fb.prototype.constructor=fb;fb.prototype.evalTelegram=
function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(f.voltage=parseFloat((c/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),f.voltage_raw=c,a=b>>6&1023,f.illumination=a,f.illumination_raw=a)}return f};var gb=function(c){L.call(this,c);this._data="a5-06-04";this._tmpMin=-20;this._tmpMax=60};gb.STATES="temperature temperature_raw illumination illumination_raw energy energy_raw temperature_avail energy_avail".split(" ");
gb.prototype=new L;gb.prototype.constructor=gb;gb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(f.temperature=parseFloat((c/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),f.temperature_raw=c,f.illumination=b,f.illumination_raw=b,b=a>>4&15,f.energy=parseFloat((b/15*100).toFixed(1)),f.energy_raw=b,f.temperature_avail=a>>1&1?!0:!1,f.temperature_avail||delete f.temperature,f.energy_avail=
a&1?!0:!1,f.energy_avail||delete f.energy)}return f};var nc=function(c){L.call(this,c);this._data="a5-06-05";this._ill2Min=0;this._ill2Max=5100;this._ill1Min=0;this._ill1Max=10200};nc.STATES=L.STATES;nc.prototype=new L;nc.prototype.constructor=nc;var V=function(c){t.call(this,c);this._data="a5-07-??";this._params||(this._params={reset_timeout:30});this._resetTO=null};V.COMMANDS=["reset"];V.prototype=new t;V.prototype.constructor=V;V.prototype._startPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),
this._resetTO=null);if(this._params.reset_timeout&&!(0>this._params.reset_timeout)){var c=this;this._resetTO=setTimeout(function(){c._resetTO=null;c._reset()},1E3*this._params.reset_timeout)}};V.prototype._stopPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null)};V.prototype._reset=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null);var c={key:"state",value:"off",changed:!1},f=this._states.state?this._states.state.value:null;"off"!=f&&(c.oldvalue=
f,c.changed=!0);this._states.state={value:"off",time:(new Date).getTime()};require("x.hub.m.enocean.js")._onEOEvents(this,[c])};V.prototype.executeCommand=function(c,f,a){if(f&&f.value)switch(f.value){case "reset":this._reset();a&&a();break;default:a&&a(Error("no such command"))}else a&&a(Error("command invalid"))};V.prototype.fromJSON=function(c){if(!e.prototype.fromJSON.call(this,c))return null;this._params||(this._params={reset_timeout:30});return this};V.prototype.fromDBJSON=function(c){if(!e.prototype.fromDBJSON.call(this,
c))return null;this._params||(this._params={reset_timeout:30});return this};var da=function(c){V.call(this,c);this._data="a5-07-01"};da.COMMANDS=["reset"];da.STATES=["voltage","voltage_raw","state","state_raw","voltage_avail"];da.prototype=new V;da.prototype.constructor=da;da.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt8(0);1==(a>>3&1)&&(f.voltage=parseFloat((c/250*5).toFixed(1)),f.voltage_raw=c,f.state=128<=
b?"on":"off",f.state_raw=b,f.voltage_avail=a&1?!0:!1,f.voltage_avail||delete f.voltage)}"on"==f.state?this._startPIROffTO():"off"==f.state&&this._stopPIROffTO();return f};var Ta=function(c){V.call(this,c);this._data="a5-07-02"};Ta.COMMANDS=["reset"];Ta.STATES=["voltage","voltage_raw","state","state_raw"];Ta.prototype=new V;Ta.prototype.constructor=Ta;Ta.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);1==(a>>3&1)&&(f.voltage=parseFloat((c/
250*5).toFixed(1)),f.voltage_raw=c,a=a>>7&1,f.state=a?"on":"off",f.state_raw=a)}"on"==f.state?this._startPIROffTO():"off"==f.state&&this._stopPIROffTO();return f};var Ua=function(c){V.call(this,c);this._data="a5-07-03"};Ua.COMMANDS=["reset"];Ua.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");Ua.prototype=new V;Ua.prototype.constructor=Ua;Ua.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(1);c=
c.userData.readUInt8(0);1==(a>>3&1)&&(f.voltage=parseFloat((c/250*5).toFixed(1)),f.voltage_raw=c,b=b>>6&1023,f.illumination=b,f.illumination_raw=b,a=a>>7&1,f.state=a?"on":"off",f.state_raw=a)}"on"==f.state?this._startPIROffTO():"off"==f.state&&this._stopPIROffTO();return f};var ya=function(c){t.call(this,c);this._data="a5-08-??";this._svcMin=0;this._svcMax=5.1;this._illMin=0;this._illMax=510;this._tmpMin=0;this._tmpMax=51};ya.prototype=new t;ya.prototype.constructor=ya;ya.prototype.evalTelegram=function(c){var f=
{};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.voltage=parseFloat((c/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));f.voltage_raw=c;f.illumination=parseFloat((d/255*(this._illMax-this._illMin)+this._illMin).toFixed(1));f.illumination_raw=d;f.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1));f.temperature_raw=b;b=a>>1&1;switch(b){case 0:f.state="on";break;case 1:f.state=
"off"}f.state_raw=b;a&=1;switch(a){case 0:f.button="pressed";break;case 1:f.button="released"}f.button_raw=a}}return f};var Va=function(c){ya.call(this,c);this._data="a5-08-01"};Va.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");Va.prototype=new ya;Va.prototype.constructor=Va;var oc=function(c){ya.call(this,c);this._data="a5-08-02";this._illMax=1020};oc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");
oc.prototype=new ya;oc.prototype.constructor=oc;var pc=function(c){ya.call(this,c);this._data="a5-08-03";this._illMax=1530;this._tmpMin=-30;this._tmpMax=50};pc.STATES="voltage voltage_raw illumination illumination_raw temperature temperature_raw state state_raw button button_raw".split(" ");pc.prototype=new ya;pc.prototype.constructor=pc;var F=function(c){t.call(this,c);this._data="a5-09-??"};F.prototype=new t;F.prototype.constructor=F;var hb=function(c){F.call(this,c);this._data="a5-09-02";this._svcMin=
0;this._svcMax=5.1;this._gasMin=0;this._gasMax=1020;this._tmpMin=0;this._tmpMax=51};hb.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available".split(" ");hb.prototype=new F;hb.prototype.constructor=hb;hb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(f.voltage=parseFloat((c/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),
f.voltage_raw=c,f.gas=parseFloat((d/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),f.gas_raw=d,f.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),f.temperature_raw=b,a=a>>1&1,f.temperature_available=a?!0:!1,a||delete f.temperature)}return f};var ib=function(c){F.call(this,c);this._data="a5-09-04";this._humMin=0;this._humMax=100;this._gasMin=0;this._gasMax=2550;this._tmpMin=0;this._tmpMax=51};ib.STATES="humidity humidity_raw gas gas_raw temperature temperature_raw temperature_available humidity_available".split(" ");
ib.prototype=new F;ib.prototype.constructor=ib;ib.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);1==(a>>3&1)&&(f.humidity=parseFloat((c/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),f.humidity_raw=c,f.gas=parseFloat((d/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),f.gas_raw=d,f.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),
f.temperature_raw=b,b=a>>2&1,f.humidity_available=b?!0:!1,b||delete f.humidity,a=a>>1&1,f.temperature_available=a?!0:!1,a||delete f.temperature)}return f};var jb=function(c){F.call(this,c);this._data="a5-09-05"};jb.STATES=["voc","voc_raw","voc_id","voc_id_raw","scale"];jb.prototype=new F;jb.prototype.constructor=jb;jb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt16BE(0);if(1==(a>>3&1)){a&=3;var d=1;switch(a){case 0:d=
.01;break;case 1:d=.1;break;case 2:d=1;break;case 3:d=10}f.scale=d;f.voc=c*d;f.voc_raw=c;switch(a){case 0:f.voc_id="VOCT";break;case 1:f.voc_id="Formaldehyde";break;case 2:f.voc_id="Benzene";break;case 3:f.voc_id="Styrene";break;case 4:f.voc_id="Toluene";break;case 5:f.voc_id="Tetrachloroethylene";break;case 6:f.voc_id="Xylene";break;case 7:f.voc_id="n-Hexane";break;case 8:f.voc_id="n-Octane";break;case 9:f.voc_id="Cyclopentane";break;case 10:f.voc_id="Methanol";break;case 11:f.voc_id="Ethanol";break;
case 12:f.voc_id="1-Pentanol";break;case 13:f.voc_id="Acetone";break;case 14:f.voc_id="ethylene Oxide";break;case 15:f.voc_id="Acetaldehyde ue";break;case 16:f.voc_id="Acetic Acid";break;case 17:f.voc_id="Propionice Acid";break;case 18:f.voc_id="Valeric Acid";break;case 19:f.voc_id="Butyric Acid";break;case 20:f.voc_id="Ammoniac";break;case 22:f.voc_id="Hydrogen Sulfide";break;case 23:f.voc_id="Dimethylsulfide";break;case 24:f.voc_id="2-Butanol";break;case 25:f.voc_id="2-Methylpropanol";break;case 26:f.voc_id=
"Diethyl ether";break;case 255:f.voc_id="ozone"}f.voc_id_raw=b}}return f};var kb=function(c){F.call(this,c);this._data="a5-09-06"};kb.STATES=["radon"];kb.prototype=new F;kb.prototype.constructor=kb;kb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt16BE(0);1==(a>>3&1)&&(f.radon=c>>6&1023)}return f};var lb=function(c){F.call(this,c);this._data="a5-09-07"};lb.STATES="pm10 pm25 pm1 pm10_active pm25_active pm25_active".split(" ");lb.prototype=
new F;lb.prototype.constructor=lb;lb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(2),d=c.userData.readUInt16BE(1);c=c.userData.readUInt16BE(0);1==(a>>3&1)&&(f.pm10=c>>7&511,f.pm25=d>>6&511,f.pm1=b>>5&511,b=a>>2&1,f.pm10_active=b?!0:!1,b||delete f.pm10,b=a>>1&1,f.pm25_active=b?!0:!1,b||delete f.pm25,a&=1,f.pm1_active=a?!0:!1,a||delete f.pm1)}return f};var mb=function(c){F.call(this,c);this._data="a5-09-08"};mb.STATES=["co2","co2_raw"];
mb.prototype=new F;mb.prototype.constructor=mb;mb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);1==(a>>3&1)&&(f.co2=parseFloat((c/255*2E3).toFixed(1)),f.co2_raw=c)}return f};var nb=function(c){F.call(this,c);this._data="a5-09-09"};nb.STATES=["co2","co2_raw","power_failure_detected"];nb.prototype=new F;nb.prototype.constructor=nb;nb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(2);
1==(a>>3&1)&&(f.co2=parseFloat((c/255*2E3).toFixed(1)),f.co2_raw=c,f.power_failure_detected=a>>2&1?!0:!1)}return f};var ob=function(c){F.call(this,c);this._data="a5-09-0a";this._svcMin=2;this._svcMax=5;this._tmpMin=-20;this._tmpMax=60};ob.STATES="voltage voltage_raw gas gas_raw temperature temperature_raw temperature_available voltage_available".split(" ");ob.prototype=new F;ob.prototype.constructor=ob;ob.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=
c.userData.readUInt8(2);c=c.userData.readUInt16BE(0);1==(a>>3&1)&&(f.gas=c,f.gas_raw=c,f.temperature=parseFloat((b/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),f.temperature_raw=b,b=a>>4&15,f.voltage=parseFloat((b/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),f.voltage_raw=b,b=a>>1&1,f.temperature_available=b?!0:!1,b||delete f.temperature,a&=1,f.voltage_available=a?!0:!1,a||delete f.voltage)}return f};var pb=function(c){F.call(this,c);this._data="a5-09-0b";this._svcMin=2;this._svcMax=
5};pb.STATES="voltage voltage_raw radio radio_raw scale unit unit_raw voltage_available".split(" ");pb.prototype=new F;pb.prototype.constructor=pb;pb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt16BE(2);c=c.userData.readUInt8(0);if(1==(a>>3&1)){c=c>>4&15;f.voltage=parseFloat((c/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1));f.voltage_raw=c;c=1;switch(a>>4&15){case 0:c=.001;break;case 1:c=.01;break;case 2:c=.1;break;case 3:c=
1;break;case 4:c=10;break;case 5:c=100;break;case 6:c=1E3;break;case 7:c=1E4;break;case 8:c=1E5}f.scale=c;f.radio=b/10*c;f.radio_raw=b;b=a>>1&3;switch(b){case 0:f.unit="\u03bcSv/h";break;case 1:f.unit="cpm";break;case 2:f.unit="Bq/L";break;case 3:f.unit="Bq/kg"}f.unit_raw=b;a&=1;f.voltage_available=a?!0:!1;a||delete f.voltage}}return f};var qb=function(c){F.call(this,c);this._data="a5-09-0c"};qb.STATES="voc voc_raw voc_id voc_id_raw unit unit_raw scale".split(" ");qb.prototype=new F;qb.prototype.constructor=
qb;qb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2);c=c.userData.readUInt16BE(0);if(1==(a>>3&1)){var d=a&3,e=1;switch(d){case 0:e=.01;break;case 1:e=.1;break;case 2:e=1;break;case 3:e=10}f.scale=e;a=a>>1&1;switch(a){case 0:f.unit="ppb";break;case 1:f.unit="\u03bcSv/m3"}f.unit_raw=a;f.voc=c*e;f.voc_raw=c;switch(d){case 0:f.voc_id="VOCT";break;case 1:f.voc_id="Formaldehyde";break;case 2:f.voc_id="Benzene";break;case 3:f.voc_id="Styrene";
break;case 4:f.voc_id="Toluene";break;case 5:f.voc_id="Tetrachloroethylene";break;case 6:f.voc_id="Xylene";break;case 7:f.voc_id="n-Hexane";break;case 8:f.voc_id="n-Octane";break;case 9:f.voc_id="Cyclopentane";break;case 10:f.voc_id="Methanol";break;case 11:f.voc_id="Ethanol";break;case 12:f.voc_id="1-Pentanol";break;case 13:f.voc_id="Acetone";break;case 14:f.voc_id="ethylene Oxide";break;case 15:f.voc_id="Acetaldehyde ue";break;case 16:f.voc_id="Acetic Acid";break;case 17:f.voc_id="Propionice Acid";
break;case 18:f.voc_id="Valeric Acid";break;case 19:f.voc_id="Butyric Acid";break;case 20:f.voc_id="Ammoniac";break;case 22:f.voc_id="Hydrogen Sulfide";break;case 23:f.voc_id="Dimethylsulfide";break;case 24:f.voc_id="2-Butanol";break;case 25:f.voc_id="2-Methylpropanol";break;case 26:f.voc_id="Diethyl ether";break;case 27:f.voc_id="Naphthalene";break;case 28:f.voc_id="4-Phenylcyclohexene";break;case 29:f.voc_id="Limonene";break;case 30:f.voc_id="Trichloroethylene";break;case 31:f.voc_id="Isovaleric acid";
break;case 32:f.voc_id="Indole";break;case 33:f.voc_id="Cadaverine";break;case 34:f.voc_id="Putrescine";break;case 35:f.voc_id="Caproic acid";break;case 255:f.voc_id="ozone"}f.voc_id_raw=b}}return f};var Wa=function(c){t.call(this,c);this._data="a5-10-??"};Wa.prototype=new t;Wa.prototype.constructor=Wa;var D=function(c){Wa.call(this,c);this._data="a5-10-01";this._params||(this._params={minSP:18,maxSP:26})};D.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");
D.prototype=new Wa;D.prototype.constructor=D;D.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.fan_speed=144>=c?"3":164>=c?"2":189>=c?"1":209>=c?"0":"auto";f.fan_speed_raw=c;f.setpoint=parseFloat((d/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));f.setpoint_raw=d;f.temperature=parseFloat(((255-b)/255*40).toFixed(1));f.temperature_raw=
b;a&=1;switch(a){case 0:f.button="pressed";break;case 1:f.button="released"}f.button_raw=a}}return f};D.prototype.fromJSON=function(c){if(!e.prototype.fromJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};D.prototype.fromDBJSON=function(c){if(!e.prototype.fromDBJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var la=function(c){D.call(this,c);this._data="a5-10-02"};la.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
la.prototype=new D;la.prototype.constructor=la;la.prototype.evalTelegram=function(c){var f=D.prototype.evalTelegram.call(this,c);if(0==Object.keys(f).length)return f;delete f.button;delete f.button_raw;c=c.userData.readUInt8(3)&1;f.slider=c?"day":"night";f.slider_raw=c;return f};var Ia=function(c){D.call(this,c);this._data="a5-10-03";this.TEACH_IN_VARIATION=1};Ia.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Ia.prototype=new D;Ia.prototype.constructor=Ia;Ia.prototype.evalTelegram=
function(c){c=D.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;delete c.button;delete c.button_raw;return c};var rb=function(c){D.call(this,c);this._data="a5-10-04"};rb.STATES="fan_speed fan_speed_raw setpoint setpoint_raw temperature temperature_raw".split(" ");rb.prototype=new D;rb.prototype.constructor=rb;rb.prototype.evalTelegram=function(c){c=D.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.button;
delete c.button_raw;return c};var sb=function(c){D.call(this,c);this._data="a5-10-05"};sb.STATES="setpoint setpoint_raw temperature temperature_raw button button_raw".split(" ");sb.prototype=new D;sb.prototype.constructor=sb;sb.prototype.evalTelegram=function(c){c=D.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var Ba=function(c){la.call(this,c);this._data="a5-10-06"};Ba.STATES="setpoint setpoint_raw temperature temperature_raw slider slider_raw".split(" ");
Ba.prototype=new la;Ba.prototype.constructor=Ba;Ba.prototype.evalTelegram=function(c){c=la.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var tb=function(c){D.call(this,c);this._data="a5-10-07"};tb.STATES=["fan_speed","fan_speed_raw","temperature","temperature_raw"];tb.prototype=new D;tb.prototype.constructor=tb;tb.prototype.evalTelegram=function(c){c=D.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;
delete c.setpoint;delete c.setpoint_raw;delete c.button;delete c.button_raw;return c};var pa=function(c){D.call(this,c);this._data="a5-10-08";this._params=null};pa.STATES="fan_speed fan_speed_raw temperature temperature_raw button button_raw".split(" ");pa.prototype=new D;pa.prototype.constructor=pa;pa.prototype.evalTelegram=function(c){c=D.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};pa.prototype.fromJSON=function(c){return e.prototype.fromJSON.call(this,
c)};pa.prototype.fromDBJSON=function(c){return e.prototype.fromDBJSON.call(this,c)};var qa=function(c){la.call(this,c);this._data="a5-10-09";this._params=null};qa.STATES="fan_speed fan_speed_raw temperature temperature_raw slider slider_raw".split(" ");qa.prototype=new la;qa.prototype.constructor=qa;qa.prototype.evalTelegram=function(c){c=la.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};qa.prototype.fromJSON=function(c){return e.prototype.fromJSON.call(this,
c)};qa.prototype.fromDBJSON=function(c){return e.prototype.fromDBJSON.call(this,c)};var Ca=function(c){D.call(this,c);this._data="a5-10-0a"};Ca.STATES="setpoint setpoint_raw temperature temperature_raw contact contact_raw".split(" ");Ca.prototype=new D;Ca.prototype.constructor=Ca;Ca.prototype.evalTelegram=function(c){var f=D.prototype.evalTelegram.call(this,c);if(0==Object.keys(f).length)return f;delete f.fan_speed;delete f.fan_speed_raw;delete f.button;delete f.button_raw;c=c.userData.readUInt8(3)&
1;f.contact=c?"open":"closed";f.contact_raw=c;return f};var Ja=function(c){Ca.call(this,c);this._data="a5-10-0b";this._params=null};Ja.STATES=["temperature","temperature_raw","contact","contact_raw"];Ja.prototype=new Ca;Ja.prototype.constructor=Ja;Ja.prototype.evalTelegram=function(c){c=Ca.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};Ja.prototype.fromJSON=function(c){return e.prototype.fromJSON.call(this,c)};Ja.prototype.fromDBJSON=
function(c){return e.prototype.fromDBJSON.call(this,c)};var ub=function(c){pa.call(this,c);this._data="a5-10-0c"};ub.STATES=["temperature","temperature_raw","button","button_raw"];ub.prototype=new pa;ub.prototype.constructor=ub;ub.prototype.evalTelegram=function(c){c=pa.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var vb=function(c){qa.call(this,c);this._data="a5-10-0d"};vb.STATES=["temperature","temperature_raw","slider",
"slider_raw"];vb.prototype=new qa;vb.prototype.constructor=vb;vb.prototype.evalTelegram=function(c){c=qa.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.fan_speed;delete c.fan_speed_raw;return c};var Q=function(c){Wa.call(this,c);this._data="a5-10-10";this._params||(this._params={minSP:18,maxSP:26})};Q.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw button button_raw".split(" ");Q.prototype=new Wa;Q.prototype.constructor=Q;Q.prototype.evalTelegram=
function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.setpoint=parseFloat((c/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1));f.setpoint_raw=c;f.humidity=parseFloat((d/250*100).toFixed(1));f.humidity_raw=d;f.temperature=parseFloat((b/250*40).toFixed(1));f.temperature_raw=b;a&=1;switch(a){case 0:f.button="pressed";break;case 1:f.button="released"}f.button_raw=a}}return f};
Q.prototype.fromJSON=function(c){if(!e.prototype.fromJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};Q.prototype.fromDBJSON=function(c){if(!e.prototype.fromDBJSON.call(this,c))return null;this._params||(this._params={minSP:18,maxSP:26});return this};var Da=function(c){Q.call(this,c);this._data="a5-10-11"};Da.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");Da.prototype=new Q;Da.prototype.constructor=
Da;Da.prototype.evalTelegram=function(c){var f=Q.prototype.evalTelegram.call(this,c);if(0==Object.keys(f).length)return f;delete f.button;delete f.button_raw;c=c.userData.readUInt8(3)&1;f.slider=c?"day":"night";f.slider_raw=c;return f};var wb=function(c){Q.call(this,c);this._data="a5-10-12"};wb.STATES="setpoint setpoint_raw humidity humidity_raw temperature temperature_raw".split(" ");wb.prototype=new Q;wb.prototype.constructor=wb;wb.prototype.evalTelegram=function(c){c=Q.prototype.evalTelegram.call(this,
c);if(0==Object.keys(c).length)return c;delete c.button;delete c.button_raw;return c};var xb=function(c){Q.call(this,c);this._data="a5-10-13"};xb.STATES="humidity humidity_raw temperature temperature_raw button button_raw".split(" ");xb.prototype=new Q;xb.prototype.constructor=xb;xb.prototype.evalTelegram=function(c){c=Q.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};var yb=function(c){Da.call(this,c);this._data="a5-10-14"};
yb.STATES="humidity humidity_raw temperature temperature_raw slider slider_raw".split(" ");yb.prototype=new Da;yb.prototype.constructor=yb;yb.prototype.evalTelegram=function(c){c=Da.prototype.evalTelegram.call(this,c);if(0==Object.keys(c).length)return c;delete c.setpoint;delete c.setpoint_raw;return c};var Xa=function(c){t.call(this,c);this._data="a5-11-??"};Xa.prototype=new t;Xa.prototype.constructor=Xa;var zb=function(c){Xa.call(this,c);this._data="a5-11-03"};zb.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw".split(" ");
zb.prototype=new Xa;zb.prototype.constructor=zb;zb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.position=c;c=d&127;f.angle=2*(d>>7&1?0-c:c);d=b>>7&1;f.position_flag=d?!0:!1;f.position_flag_raw=d;d=b>>6&1;f.angle_flag=d?!0:!1;f.angle_flag_raw=d;d=b>>4&3;f.error_raw=d;switch(d){case 0:f.error="no_error";break;case 1:f.error="no_end_position";break;case 2:f.error=
"intern_failure"}d=b>>2&3;f.end_position_raw=d;switch(d){case 0:f.end_position="no_end_position";break;case 1:f.end_position="end_position_not_reach";break;case 2:f.end_position="fully_open";break;case 3:f.end_position="fully_closed"}b&=3;f.state_raw=b;switch(b){case 0:f.state="no_status";break;case 1:f.state="stopped";break;case 2:f.state="opens";break;case 3:f.state="closes"}f.service_mode=a>>7&1;f.position_mode=a>>6&1}}return f};var Ya=function(c){Xa.call(this,c);this._data="a5-11-04"};Ya.STATES=
"state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");Ya.prototype=new Xa;Ya.prototype.constructor=Ya;Ya.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.service_mode=a>>7&1;var e=a>>6&1;f.op_hour_flag=
e?!0:!1;f.op_hour_flag_raw=e;e=a>>4&3;f.error_raw=e;switch(e){case 0:f.error="no_error";break;case 1:f.error="lamp_failure";break;case 2:f.error="intern_failure";break;case 3:f.error="extern_failure"}e=a&1;f.state=e?"on":"off";f.state_raw=e;a=a>>1&3;f.mode_raw=a;switch(a){case 0:f.level=c;f.op_hour=d<<8|b;break;case 1:a=c.toString(16);2>a.length&&(a="0"+a);d=d.toString(16);2>d.length&&(d="0"+d);b=b.toString(16);2>b.length&&(b="0"+b);f.rgb=a.toUpperCase()+d.toUpperCase()+b.toUpperCase();break;case 2:f.power_raw=
c<<8|d,f.power_unit_raw=b,d="mW W kW MW Wh kWh MWh GWh mA 1/10A mV 1/10V".split(" "),3>=b?(f.power=f.power_raw,f.power_unit=d[b]):7>=b?(f.energy=f.power_raw,f.energy_unit=d[b]):9>=b?(f.current=f.power_raw,f.current_unit=d[b]):11>=b&&(f.voltage=f.power_raw,f.voltage_unit=d[b])}}}return f};var ea=function(c){t.call(this,c);this._data="a5-12-??"};ea.STATES="meter_raw channel_raw type_raw scale_raw scale meter current cumulative".split(" ");ea.prototype=new t;ea.prototype.constructor=ea;ea.prototype.evalTelegram=
function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt32BE(0);if(1==(a>>3&1)){c=c>>8&16777215;f.meter_raw=c;f.channel_raw=a>>4&15;var b=a>>2&1;f.type_raw=b;a&=3;f.scale_raw=a;switch(a){case 0:f.scale=1;f.meter=c;break;case 1:f.scale=.1;f.meter=.1*c;break;case 2:f.scale=.01;f.meter=.01*c;break;case 3:f.scale=.001,f.meter=.001*c}b?f.current=f.meter:f.cumulative=f.meter}}return f};var Ab=function(c){ea.call(this,c);this._data="a5-12-00"};Ab.STATES=["current","counter",
"channel"];Ab.prototype=new ea;Ab.prototype.constructor=Ab;Ab.prototype.evalTelegram=function(c){c=ea.prototype.evalTelegram.call(this,c);c.counter=c.cumulative;c.channel=c.channel_raw;return c};var ma=function(c){ea.call(this,c);this._data="a5-12-01"};ma.STATES=["power","energy","tariff"];ma.prototype=new ea;ma.prototype.constructor=ma;ma.prototype.evalTelegram=function(c){c=ea.prototype.evalTelegram.call(this,c);c.energy=c.cumulative;c.power=c.current;c.tariff=c.channel_raw;return c};var Ka=function(c){ea.call(this,
c);this._data="a5-12-02"};Ka.STATES=["volume","flow","tariff"];Ka.prototype=new ea;Ka.prototype.constructor=Ka;Ka.prototype.evalTelegram=function(c){c=ea.prototype.evalTelegram.call(this,c);c.volume=c.cumulative;c.flow=c.current;c.tariff=c.channel_raw;return c};var qc=function(c){Ka.call(this,c);this._data="a5-12-03"};qc.STATES=["volume","flow","tariff"];qc.prototype=new Ka;qc.prototype.constructor=qc;var R=function(c){t.call(this,c);this._data="a5-13-??"};R.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
R.prototype=new t;R.prototype.constructor=R;R.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(2),d=c.userData.readUInt8(1),e=c.userData.readUInt8(0);if(1==(a>>3&1))switch(a>>4&15){case 1:f.lux=parseFloat((e/255*1E3).toFixed(1));f.lux_raw=e;var g=d;f.temperature=parseFloat((g/255*120-40).toFixed(1));f.temperature_raw=g;f.wind=parseFloat((b/255*70).toFixed(1));f.wind_raw=b;f.day_night=a>>2&1?"night":"day";f.rain=a>>1&1?"true":"false";
break;case 2:f.sun_west=parseFloat((e/255*150).toFixed(1));f.sun_west_raw=e;f.sun_south=parseFloat((d/255*150).toFixed(1));f.sun_south_raw=g;f.sun_east=parseFloat((b/255*150).toFixed(1));f.sun_east_raw=b;f.hemisphere=a>>2&1?"south":"north";break;case 3:f.day=e&15;f.month=d&7;f.year=(b&127)+2E3;f.date_src=a&1?"gps":"rtc";break;case 4:f.weekday=e>>5&7;f.hour=e&31;f.min=d&63;f.sec=b&63;f.time_format=a>>2&1?"12":"24";f.am_pm=a>>1&1?"pm":"am";f.time_src=a&1?"gps":"rtc";break;case 5:f.elv=e-90;f.elv_raw=
e;b=c.userData.readUInt16BE(1)&511;f.azm=b;f.azm_raw=b;break;case 6:c=(e>>4&15)<<8|d,b|=(e&15)<<8,f.latitude=parseFloat((c/4095*180-90).toFixed(1)),f.latitude_raw=c,f.longitude=parseFloat((b/4095*360-180).toFixed(1)),f.longitude_raw=b}}return f};var rc=function(c){R.call(this,c);this._data="a5-13-01"};rc.STATES="lux lux_raw temperature temperature_raw wind wind_raw day_night rain sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere day month year date_src weekday hour min sec time_format am_pm time_src elv azm latitude longitude latitude_raw longitude_raw".split(" ");
rc.prototype=new R;rc.prototype.constructor=rc;var sc=function(c){R.call(this,c);this._data="a5-13-02"};sc.STATES="sun_west sun_west_raw sun_south sun_south_raw sun_east sun_east_raw hemisphere".split(" ");sc.prototype=new R;sc.prototype.constructor=sc;var tc=function(c){R.call(this,c);this._data="a5-13-03"};tc.STATES=["day","month","year","date_src"];tc.prototype=new R;tc.prototype.constructor=tc;var uc=function(c){R.call(this,c);this._data="a5-13-04"};uc.STATES="weekday hour min sec time_format am_pm time_src".split(" ");
uc.prototype=new R;uc.prototype.constructor=uc;var vc=function(c){R.call(this,c);this._data="a5-13-05"};vc.STATES=["elv","azm"];vc.prototype=new R;vc.prototype.constructor=vc;var wc=function(c){R.call(this,c);this._data="a5-13-06"};wc.STATES=["latitude","longitude"];wc.prototype=new R;wc.prototype.constructor=wc;var Bb=function(c){e.call(this,c);this._data="a5-14-01"};Bb.STATES=["voltage","voltage_raw","state"];Bb.prototype=new e;Bb.prototype.constructor=Bb;Bb.prototype.evalTelegram=function(c){var f=
{};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.voltage=c/250*5;f.voltage_raw=c;a&=1;switch(a){case 0:f.state="closed";break;case 1:f.state="open"}f.state_raw=a}}return f};var Cb=function(c){e.call(this,c);this._data="a5-14-02"};Cb.STATES=["voltage","voltage_raw","illumination","illumination_raw","state"];Cb.prototype=new e;Cb.prototype.constructor=Cb;Cb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(1);
c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(f.voltage=c/250*5,f.voltage_raw=c,f.illumination=b/250*1E3,f.illumination_raw=b,a&=1,f.state_raw=a,a){case 0:f.state="closed";break;case 1:f.state="open"}}return f};var Db=function(c){e.call(this,c);this._data="a5-14-03"};Db.STATES=["voltage","voltage_raw","state","viberation"];Db.prototype=new e;Db.prototype.constructor=Db;Db.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>
3&1)){f.voltage=c/250*5;f.voltage_raw=c;switch(a&1){case 0:f.state="closed";break;case 1:f.state="open"}switch(a>>1&1){case 0:f.viberation=!1;break;case 1:f.viberation=!0}}}return f};var Eb=function(c){e.call(this,c);this._data="a5-14-04"};Eb.STATES="voltage voltage_raw illumination illumination_raw state viberation".split(" ");Eb.prototype=new e;Eb.prototype.constructor=Eb;Eb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(1);c=c.userData.readUInt8(0);
if(1==(a>>3&1)){f.voltage=c/250*5;f.voltage_raw=c;f.illumination=b/250*1E3;f.illumination_raw=b;switch(a&1){case 0:f.state="closed";break;case 1:f.state="open"}switch(a>>1&1){case 0:f.viberation=!1;break;case 1:f.viberation=!0}}}return f};var Fb=function(c){e.call(this,c);this._data="a5-14-05"};Fb.STATES=["voltage","voltage_raw","viberation"];Fb.prototype=new e;Fb.prototype.constructor=Fb;Fb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);
if(1==(a>>3&1))switch(f.voltage=c/250*5,f.voltage_raw=c,a>>1&1){case 0:f.viberation=!1;break;case 1:f.viberation=!0}}return f};var Gb=function(c){e.call(this,c);this._data="a5-14-06"};Gb.STATES=["voltage","voltage_raw","illumination","illumination_raw","viberation"];Gb.prototype=new e;Gb.prototype.constructor=Gb;Gb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3),b=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(f.voltage=c/250*5,f.voltage_raw=
c,f.illumination=b/250*1E3,f.illumination_raw=b,a>>1&1){case 0:f.viberation=!1;break;case 1:f.viberation=!0}}return f};var Hb=function(c){e.call(this,c);this._data="a5-14-07"};Hb.STATES=["voltage","voltage_raw","state","lock"];Hb.prototype=new e;Hb.prototype.constructor=Hb;Hb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.voltage=c/250*5;f.voltage_raw=c;switch(a>>2&1){case 0:f.state="closed";break;case 1:f.state=
"open"}switch(a>>1&1){case 0:f.lock="locked";break;case 1:f.lock="unlocked"}}}return f};var Ib=function(c){e.call(this,c);this._data="a5-14-08"};Ib.STATES=["voltage","voltage_raw","state","lock","viberation"];Ib.prototype=new e;Ib.prototype.constructor=Ib;Ib.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.voltage=c/250*5;f.voltage_raw=c;switch(a>>2&1){case 0:f.state="closed";break;case 1:f.state="open"}switch(a>>
1&1){case 0:f.lock="locked";break;case 1:f.lock="unlocked"}switch(a&1){case 0:f.viberation=!1;break;case 1:f.viberation=!0}}}return f};var Jb=function(c){e.call(this,c);this._data="a5-14-09"};Jb.STATES=["voltage","voltage_raw","state"];Jb.prototype=new e;Jb.prototype.constructor=Jb;Jb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1))switch(f.voltage=c/250*5,f.voltage_raw=c,a>>1&3){case 0:f.state="closed";break;case 1:f.state=
"tilted";break;case 2:f.state="reserved";break;case 3:f.state="open"}}return f};var Kb=function(c){e.call(this,c);this._data="a5-14-0a"};Kb.STATES=["voltage","voltage_raw","state","viberation"];Kb.prototype=new e;Kb.prototype.constructor=Kb;Kb.prototype.evalTelegram=function(c){var f={};if(165==c.rorg){var a=c.userData.readUInt8(3);c=c.userData.readUInt8(0);if(1==(a>>3&1)){f.voltage=c/250*5;f.voltage_raw=c;switch(a>>1&3){case 0:f.state="closed";break;case 1:f.state="tilted";break;case 2:f.state="reserved";
break;case 3:f.state="open"}switch(a&1){case 0:f.viberation=!1;break;case 1:f.viberation=!0}}}return f};var ja=function(c){t.call(this,c);this._data="a5-20-04";this.TEACH_IN_VARIATION=3;this._defaultSetpoint=15;this._defaultWakeupCycle=3;this._defaultDisplay=0;this._states={pending:{value:!1,time:(new Date).getTime()}};this._service_command_new=this._button_lock_new=this._display_new=this._wakeup_cycle_new=this._measurement_new=this._setpoint_new=this._valve_new=null};ja.COMMANDS="setValve setTo up down measureOn measureOff setWakeup setDisplay buttonLock buttonUnlock openValve closeValve init".split(" ");
ja.STATES="valve measurement button_lock temperature_selection feed_temperature setpoint error temperature wakeup_cycle display pending".split(" ");ja.prototype=new t;ja.prototype.constructor=ja;ja.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.wakeup_cycle||null==this._params.wakeup_cycle)this._params.wakeup_cycle=this._defaultWakeupCycle;if("undefined"==typeof this._params.display||null==this._params.display)this._params.display=this._defaultDisplay};
ja.prototype.getStatesBuffer=function(){var c=JSON.parse(JSON.stringify(this._states));c.wakeup_cycle={value:this._params.wakeup_cycle,time:-1};c.display={value:this._params.display,time:-1};"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(c.wakeup_cycle={value:this._wakeup_cycle_new,time:-1});"undefined"!=typeof this._display_new&&null!=this._display_new&&(c.display={value:this._display_new,time:-1});"undefined"!=typeof this._valve_new&&null!=this._valve_new&&(c.valve={value:this._valve_new,
time:-1});"undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new&&(c.setpoint={value:this._setpoint_new,time:-1});"undefined"!=typeof this._measurement_new&&null!=this._measurement_new&&(c.measurement={value:this._measurement_new,time:-1});"undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new&&(c.button_lock={value:this._button_lock_new,time:-1});return c};ja.prototype.getCurrentStates=function(){var c={},f=this.getStatesBuffer(),a;for(a in f)f.hasOwnProperty(a)&&f[a]&&
(c[a]=f[a].value);return c};ja.prototype.executeCommand=function(c,f,a){var b=(new Date).getTime();if(f&&f.value){"setValve"==f.value.substr(0,8)&&8<f.value.length?(c=f.value.substr(8),f={value:"setValve",ext:c}):"setTo"==f.value.substr(0,5)&&5<f.value.length?(c=f.value.substr(5),f={value:"setTo",ext:c}):"tempTo"==f.value.substr(0,6)&&6<f.value.length?(c=f.value.substr(6),f={value:"setTo",ext:c}):"up"==f.value.substr(0,2)&&2<f.value.length?(c=f.value.substr(2),f={value:"up",ext:c}):"down"==f.value.substr(0,
4)&&4<f.value.length?(c=f.value.substr(4),f={value:"down",ext:c}):"setWakeup"==f.value.substr(0,9)&&9<f.value.length?(c=f.value.substr(9),f={value:"setWakeup",ext:c}):"setDisplay"==f.value.substr(0,10)&&10<f.value.length&&(c=f.value.substr(10),f={value:"setDisplay",ext:c});var d=[];switch(f.value){case "setValve":if("undefined"==typeof f.ext||null==f.ext){a&&a(Error("set valve value invalid"));return}c=parseInt(f.ext);0>c&&(c=0);100<c&&(c=100);this._valve_new=c;this._states.pending={value:!0,time:b};
f={key:"valve",value:c,changed:!1};b=this._states.valve?this._states.valve.value:null;b!=c&&(f.oldvalue=b,f.changed=!0);d.push(f);break;case "setTo":if("undefined"==typeof f.ext||null==f.ext){a&&a(Error("set valve value invalid"));return}c=parseFloat(f.ext);10>c&&(c=10);30<c&&(c=30);this._setpoint_new=c;this._states.pending={value:!0,time:b};f={key:"setpoint",value:this._setpoint_new,changed:!1};b=this._states.setpoint?this._states.setpoint.value:null;b!=this._setpoint_new&&(f.oldvalue=b,f.changed=
!0);d.push(f);break;case "up":(c=f.ext)||(c=.5);c=parseFloat(c);if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new+=c;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value+c;else{a&&a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_new=10);30<this._setpoint_new&&(this._setpoint_new=30);this._states.pending={value:!0,
time:b};f={key:"setpoint",value:this._setpoint_new,changed:!1};b=this._states.setpoint?this._states.setpoint.value:null;b!=this._setpoint_new&&(f.oldvalue=b,f.changed=!0);d.push(f);break;case "down":(c=f.ext)||(c=.5);c=parseFloat(c);if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new-=c;else if(this._states&&this._states.setpoint&&"undefined"!=typeof this._states.setpoint.value&&null!=this._states.setpoint.value)this._setpoint_new=this._states.setpoint.value-c;else{a&&
a(Error("not current setpoint value"));return}10>this._setpoint_new&&(this._setpoint_ne=10);30<this._setpoint_new&&(this._setpoint_new=30);this._states.pending={value:!0,time:b};f={key:"setpoint",value:this._setpoint_new,changed:!1};b=this._states.setpoint?this._states.setpoint.value:null;b!=this._setpoint_new&&(f.oldvalue=b,f.changed=!0);d.push(f);break;case "measureOn":this._measurement_new="active";this._states.pending={value:!0,time:b};f={key:"measurement",value:this._measurement_new,changed:!1};
b=this._states.measurement?this._states.measurement.value:null;b!=this._measurement_new&&(f.oldvalue=b,f.changed=!0);d.push(f);break;case "measureOff":this._measurement_new="inactive";this._states.pending={value:!0,time:b};f={key:"measurement",value:this._measurement_new,changed:!1};b=this._states.measurement?this._states.measurement.value:null;b!=this._measurement_new&&(f.oldvalue=b,f.changed=!0);d.push(f);break;case "setWakeup":if("undefined"==typeof f.ext||null==f.ext){a&&a(Error("set wakup cycle value invalid"));
return}this._wakeup_cycle_new=c=parseInt(f.ext);this._states.pending={value:!0,time:b};f={key:"wakeup_cycle",value:this._wakeup_cycle_new,changed:!1};b=this._params.wakeup_cycle;b!=this._wakeup_cycle_new&&(f.oldvalue=b,f.changed=!0);d.push(f);break;case "setDisplay":if("undefined"==typeof f.ext||null==f.ext){a&&a(Error("set display orientation value invalid"));return}this._display_new=c=parseInt(f.ext);this._states.pending={value:!0,time:b};f={key:"display",value:this._display_new,changed:!1};b=this._params.display;
b!=this._display_new&&(f.oldvalue=b,f.changed=!0);d.push(f);break;case "buttonLock":this._button_lock_new="locked";this._states.pending={value:!0,time:b};f={key:"button_lock",value:this._button_lock_new,changed:!1};b=this._states.button_lock?this._states.button_lock.value:null;b!=this._button_lock_new&&(f.oldvalue=b,f.changed=!0);d.push(f);break;case "buttonUnlock":this._button_lock_new="unlocked";this._states.pending={value:!0,time:b};f={key:"button_lock",value:this._button_lock_new,changed:!1};
b=this._states.button_lock?this._states.button_lock.value:null;b!=this._button_lock_new&&(f.oldvalue=b,f.changed=!0);d.push(f);break;case "openValve":this._service_command_new=1;this._states.pending={value:!0,time:b};break;case "closeValve":this._service_command_new=3;this._states.pending={value:!0,time:b};break;case "init":this._service_command_new=2,this._states.pending={value:!0,time:b}}0<d.length&&require("x.hub.m.enocean.js")._onEOEvents(this,d);a&&a()}else a&&a(Error("command invalid"))};ja.prototype.evalData=
function(c,f,a){if(f=this.evalTelegram(f)){var b=this;this._sendResponse(c,f,function(c,f){c=b.checkStateChange(f);a&&a(null,c)})}else a&&a(Error("data format invalid"))};ja.prototype.evalTelegram=function(c){var a={};if(165==c.rorg){var b=c.userData.readUInt8(3),d=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(b>>3&1)){a.valve=c;a.measurement=b>>7&1?"inactive":"active";a.button_lock=b>>2&1?"locked":"unlocked";c=b>>1&1;b&=1;a.temperature_selection=c?"setpoint":
"feed_temperature";switch(c){case 0:a.feed_temperature=parseFloat((e/255*60+20).toFixed(1));break;case 1:a.setpoint=parseFloat((e/255*20+10).toFixed(1))}if(0==b)a.error="no_error",a.temperature=parseFloat((d/255*20+10).toFixed(1));else switch(d){case 17:a.error="measurement_error";break;case 18:a.error="battery_empty";break;case 20:a.error="frost_protection";break;case 33:a.error="blocked_valve";break;case 36:a.error="end_point_detection_error";break;case 40:a.error="no_valve";break;case 49:a.error=
"not_taught_in";break;case 53:a.error="no_response_from_controller";break;case 54:a.error="teach_in_error";break;default:a.error="unknow_error"}}}return a};ja.prototype._sendResponse=function(c,a,b){var f=(new Date).getTime(),d=JSON.parse(JSON.stringify(a));this._states.pending={value:!1,time:f};var e=!1;if("undefined"!=typeof this._valve_new&&null!=this._valve_new){var g=this._valve_new;this._states.valve={value:this._valve_new,time:f};this._valve_new=null;delete d.valve}else g="undefined"!=typeof a.valve&&
null!=a.valve?a.valve:this._states.valve?this._states.valve.value:null;if("undefined"==typeof g||null==g)g=0,d.valve=0;if("undefined"!=typeof this._setpoint_new&&null!=this._setpoint_new){var r=Math.round((this._setpoint_new-10)/20*255);this._states.setpoint={value:this._setpoint_new,time:f};this._setpoint_new=null;delete d.setpoint}else"undefined"!=typeof a.setpoint&&null!=a.setpoint?r=Math.round((a.setpoint-10)/20*255):this._states.setpoint&&"undefined"!=this._states.setpoint.value&&null!=this._states.setpoint.value&&
(r=Math.round((this._states.setpoint.value-10)/20*255));if("undefined"==typeof r||null==r)r=this._defaultSetpoint,r=Math.round((r-10)/20*255),d.setpoint=this._defaultSetpoint;if("undefined"!=typeof this._measurement_new&&null!=this._measurement_new){var h="active"==this._measurement_new?0:1;this._states.measurement={value:this._measurement_new,time:f};this._measurement_new=null;delete d.measurement}else"undefined"!=typeof a.measurement&&null!=a.measurement?h="active"==a.measurement?0:1:this._states.measurement&&
"undefined"!=this._states.measurement.value&&null!=this._states.measurement.value&&(h="active"==this._states.measurement.value?0:1);if("undefined"==typeof h||null==h)h=0,d.measurement="active";var l=this._params.wakeup_cycle;"undefined"!=typeof this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(l=this._wakeup_cycle_new,this._params.wakeup_cycle=this._wakeup_cycle_new,e=!0,this._wakeup_cycle_new=null);if("undefined"==typeof l||null==l)l=this._defaultWakeupCycle,this._params.wakeup_cycle=l;var k=
this._params.display;"undefined"!=typeof this._display_new&&null!=this._display_new&&(k=this._display_new,this._params.display=this._display_new,e=!0,this._display_new=null);if("undefined"==typeof k||null==k)k=this._defaultDisplay,this._params.display=k;if("undefined"!=typeof this._button_lock_new&&null!=this._button_lock_new){var ha="locked"==this._button_lock_new?1:0;this._states.button_lock={value:this._button_lock_new,time:f};this._button_lock_new=null;delete d.button_lock}else"undefined"!=typeof a.button_lock&&
null!=a.button_lock?ha="locked"==a.button_lock?1:0:this._states.button_lock&&this._states.button_lock.value&&(ha="locked"==this._states.button_lock.value?1:0);if("undefined"==typeof ha||null==ha)ha=0,d.button_lock="unlocked";a=0;"undefined"!=typeof this._service_command_new&&null!=this._service_command_new&&(a=this._service_command_new,this._service_command_new=null);g=new Buffer([g,r,(h&1)<<6|l&63,(k&3)<<4|8|(ha&1)<<2|a&3]);e&&require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated();e=
this._senderID;e||(e=x.hub.m.enocean.SENDER_ID);e=new x.hub.m.enocean.ESP3.Telegram.ADT(165,g,this._address,e,0);c.sendTelegram(e,!0,function(c){b&&b(c,d)})};var Za=function(c){t.call(this,c);this._data="a5-30-??"};Za.prototype=new t;Za.prototype.constructor=Za;var La=function(c){e.call(this,c);this._data="a5-30-01"};La.STATES=["battery_low","battery_raw","state","state_raw"];La.prototype=new Za;La.prototype.constructor=La;La.prototype.evalTelegram=function(c){var a={};if(165==c.rorg){var b=c.userData.readUInt8(3),
d=c.userData.readUInt8(2);c=c.userData.readUInt8(1);1==(b>>3&1)&&(a.battery_low=120>=c?!0:!1,a.battery_raw=c,a.state=195>=d?"closed":"open",a.state_raw=d)}return a};var Lb=function(c){e.call(this,c);this._data="a5-30-01\u00b4"};Lb.STATES=["state"];Lb.prototype=new Za;Lb.prototype.constructor=Lb;Lb.prototype.evalTelegram=function(c){var a={};165==c.rorg&&(c=c.userData.readUInt8(3),1==(c>>3&1)&&(a.state=c&1?"open":"closed"));return a};var W=function(c){e.call(this,c);this._data="a5-30-03"};W.STATES=
"temperature temperature_raw wake input3 input2 input1 input0".split(" ");W.prototype=new Za;W.prototype.constructor=W;W.prototype.evalTelegram=function(c){var a={};if(165==c.rorg){var b=c.userData.readUInt8(3),d=c.userData.readUInt8(2);c=c.userData.readUInt8(1);1==(b>>3&1)&&(a.temperature=(255-c)/255*40,a.temperature_raw=c,a.wake=d>>4&1,a.input3=d>>3&1,a.input2=d>>2&1,a.input1=d>>1&1,a.input0=d&1)}return a};var Mb=function(c){e.call(this,c);this._data="a5-30-04"};Mb.STATES=["analog_input","input2",
"input1","input0"];Mb.prototype=new Za;Mb.prototype.constructor=Mb;Mb.prototype.evalTelegram=function(c){var a={};if(165==c.rorg){var b=c.userData.readUInt8(3);c=c.userData.readUInt8(2);1==(b>>3&1)&&(a.analog_input=c,a.input2=b>>2&1,a.input1=b>>1&1,a.input0=b&1)}return a};var xc=function(c){t.call(this,c);this._data="a5-38-??"};xc.prototype=new t;xc.prototype.constructor=xc;var J=function(c){xc.call(this,c);this._data="a5-38-08"};J.prototype=new xc;J.prototype.constructor=J;J.prototype.evalTelegram=
function(c){var a={};if(165==c.rorg){var b=c.userData.readUInt8(3),d=c.userData.readUInt8(2),e=c.userData.readUInt8(1);c=c.userData.readUInt8(0);if(1==(b>>3&1))switch(c){case 2:a.level=Math.round(e/255*100),a.ramp=d,a.dim_range=b>>2&1?"relative":"absolute",a.store_final_value=b>>1&1,a.state=b&1?"on":"off"}}return a};J.prototype.switching=function(c,a,b){var f=this._senderID;this._senderID||(f=x.hub.m.enocean.SENDER_ID);a=new Buffer([1,a.TIM>>8&255,a.TIM&255,8|(a.LCK&1)<<2|(a.DEL&1)<<1|a.SW&1]);f=
new x.hub.m.enocean.ESP3.Telegram.BS4(a,f,0);f.setDstId(this._address);c.sendTelegram(f,!0,function(c){b&&b(c)})};J.prototype.dimming=function(c,a,b){var f=this._senderID;this._senderID||(f=x.hub.m.enocean.SENDER_ID);a=new Buffer([2,a.EDIM,a.RMP,8|(a.EDIMR&1)<<2|(a.STR&1)<<1|a.SW&1]);f=new x.hub.m.enocean.ESP3.Telegram.BS4(a,f,0);f.setDstId(this._address);c.sendTelegram(f,!0,function(c){b&&b(c)})};J.prototype.blind=function(c,a,b){var f=this._senderID;this._senderID||(f=x.hub.m.enocean.SENDER_ID);
f?(a=new Buffer([7,a.P1,a.P2,(a.FUNC&15)<<4|8|(a.SSF&1)<<2|(a.PAF&1)<<1|a.SMF&1]),f=new x.hub.m.enocean.ESP3.Telegram.BS4(a,f,0),f.setDstId(this._address),c.sendTelegram(f,!0,function(c){b&&b(c)})):b&&b(Error("no senderID"))};var yc=function(c){t.call(this,c);this._data="a5-3F-7F"};yc.prototype=new t;yc.prototype.constructor=yc;var fa=function(c){e.call(this,c);this._data="d2-??-??";this.UNIQUE_GATEWAY_SENDERID=!0};fa.prototype=new e;fa.prototype.constructor=fa;var G=function(c){fa.call(this,c);this._data=
"d2-01-??";this._lastQuery={};this._initCount=0};G.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");G.prototype=new fa;G.prototype.constructor=G;G.prototype.init=function(c){var a=this.getIOs();if(0<a.length){var b=require("x.hub.m.enocean.js")._esp3,d=0,e=this,g=function(){d++;d<a.length?e.statusQuery(b,{IO:a[d]},g):c&&c()};this.statusQuery(b,{IO:a[d]},g)}else c&&c()};G.prototype.getStatesBuffer=function(){0==
Object.keys(this._states).length?(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):this._initCount=0;return this._states};G.prototype.getIOs=function(){return[]};G.prototype.setOutput=function(c,a,b){var f=this._senderID;this._senderID||(f=x.hub.m.enocean.SENDER_ID);a=new Buffer([1,(a.DV&7)<<5|a.IO&31,a.OV&127]);f=new x.hub.m.enocean.ESP3.Telegram.VLD(a,f,0);this._senderID!=this._address&&
f.setDstId(this._address);c.sendTelegram(f,!0,function(c){b&&b(c)})};G.prototype.setLocal=function(c,a,b){a=new Buffer([(a.DE&1)<<7|2,(a.OC&1)<<7|(a.RO&1)<<6|(a.LC&1)<<5|a.IO&31,(a.DT2&15)<<4|a.DT3&15,(a.DN&1)<<7|(a.PF&1)<<6|(a.DS&3)<<4|a.DT1&15]);a=new x.hub.m.enocean.ESP3.Telegram.VLD(a,x.hub.m.enocean.SENDER_ID,0);a.setDstId(this._address);c.sendTelegram(a,!0,function(c){b&&b(c)})};G.prototype.statusQuery=function(c,a,b){this._senderID?(this._lastQuery[a.IO]=(new Date).getTime(),a=new Buffer([3,
a.IO&31]),a=new x.hub.m.enocean.ESP3.Telegram.VLD(a,this._senderID,0),a.setDstId(this._address),c.sendTelegram(a,!0,function(c){b&&b(c)})):b&&b(Error("no senderID"))};G.prototype.measurementQuery=function(c,a,b){a=new Buffer([6,(a.QU&1)<<5|a.IO&31]);a=new x.hub.m.enocean.ESP3.Telegram.VLD(a,this._senderID,0);a.setDstId(this._address);c.sendTelegram(a,!0,function(c){b&&b(c)})};G.prototype.evalTelegram=function(c){var a={};if(210==c.rorg){var b=c.userData.readUInt8(0);switch(b&15){case 4:if(3==c.userData.length){var d=
b>>7&1,e=b>>6&1;b=c.userData.readUInt8(1);var g=b>>7&1,h=b>>5&3,l=b&31;b=c.userData.readUInt8(2);c=b&127;a.power_failure_detection=d?!0:!1;a.power_failure=e?!0:!1;a.over_current_switch_off=g;a.error_level=h;a.io_channel=l;a.local_control=b>>7&1?!0:!1;a.output_value=c;a.output_state=c?"on":"off"}break;case 7:if(6==c.userData.length){b=c.userData.readUInt8(1);d=b>>5&7;l=b&31;b=c.userData.readUInt32BE(2);switch(d){case 0:a.unit="Ws";break;case 1:a.unit="Wh";break;case 2:a.unit="KWh";break;case 3:a.unit=
"W";break;case 4:a.unit="KW"}a.io_channel=l;a.value=b}}}return a};var na=function(c){G.call(this,c);this._data="d2-01-00"};na.COMMANDS=["on","off","toggle"];na.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");na.prototype=new G;na.prototype.constructor=na;na.prototype.getIOs=function(){return[0]};na.prototype.executeCommand=function(c,a,b){if(a&&a.value){var f=this;switch(a.value){case "on":this.activeStateChange({output_value:100,
output_state:"on"});this.setOutput(c,{DV:0,IO:0,OV:100},b);break;case "off":this.activeStateChange({output_value:0,output_state:"off"});this.setOutput(c,{DV:0,IO:0,OV:0},b);break;case "toggle":this._states.output_state?this.executeCommand(c,{value:"on"==this._states.output_state.value?"off":"on"},b):this.init(function(){setTimeout(function(){f._states.output_state?f.executeCommand(c,a,b):b&&b(Error("unkown current status"))},200)})}}else b&&b(Error("command invalid"))};var Nb=function(c){na.call(this,
c);this._data="d2-01-01"};Nb.COMMANDS=["on","off","toggle"];Nb.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state".split(" ");Nb.prototype=new na;Nb.prototype.constructor=Nb;var Ob=function(c){na.call(this,c);this._data="d2-01-03";this._lastOnLevel=-1};Ob.prototype=new na;Ob.prototype.constructor=Ob;Ob.prototype.evalData=function(c,a,b){(c=this.evalTelegram(a))?((0==c.output_value||"off"==c.output_state)&&this._states.output_value&&
this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value),c=this.checkStateChange(c),b&&b(null,c)):b&&b(Error("data format invalid"))};Ob.prototype.executeCommand=function(c,a,b){if(a&&a.value){if("dimTo"==a.value.substr(0,5)&&5<a.value.length){var f=a.value.substr(5);a={value:"dimTo",ext:f}}else"toggleTo"==a.value.substr(0,8)&&8<a.value.length&&(f=a.value.substr(8),a={value:"toggleTo",ext:f});(new Date).getTime();var d=this;switch(a.value){case "on":f=this._lastOnLevel;
if(-1==f||0==f)f=100;this.setOutput(c,{DV:0,IO:0,OV:f},function(a){a||d.activeStateChange({output_value:f,output_state:"on"});b&&b(a)});break;case "off":this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value);this.setOutput(c,{DV:0,IO:0,OV:0},function(a){a||d.activeStateChange({output_value:0,output_state:"off"});b&&b(a)});break;case "toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(c,
a,b):b&&b(Error("unkown current status"))},200)});break}this.executeCommand(c,{value:"on"==this._states.output_state.value?"off":"on"},b);break;case "toggleTo":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(c,a,b):b&&b(Error("unkown current status"))},200)});break}"on"==this._states.output_state.value?this.executeCommand(c,{value:"off"},b):this.executeCommand(c,{value:"dimTo",ext:a.ext},b);break;case "dimTo":if("undefined"==typeof a.ext||
null==a.ext){b&&b(Error("dim to value invalid"));break}f=parseFloat(a.ext);0>f&&(f=0);100<f&&(f=100);this.setOutput(c,{DV:0,IO:0,OV:f},function(a){a||d.activeStateChange({output_value:f,output_state:0==f?"off":"on"});b&&b(a)});break;case "dimUp":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(c,a,b):b&&b(Error("unkown current status"))},200)});break}f=parseInt(this._states.output_value.value);f+=5;100<f&&(f=100);this.executeCommand(c,
{value:"dimTo",ext:f},b);break;case "dimDown":if(!this._states.output_state){this.init(function(){setTimeout(function(){d._states.output_state?d.executeCommand(c,a,b):b&&b(Error("unkown current status"))},200)});break}f=parseInt(this._states.output_value.value);f-=5;0>f&&(f=0);this.executeCommand(c,{value:"dimTo",ext:f},b);break;default:b&&b(Error("unknow command"))}}else b&&b(Error("command invalid"))};var Ea=function(a){G.call(this,a);this._data="d2-01-11"};Ea.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle".split(" ");
Ea.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state".split(" ");Ea.prototype=new G;Ea.prototype.constructor=Ea;Ea.prototype.getIOs=function(){return[0,1]};Ea.prototype.evalTelegram=function(a){if(a=G.prototype.evalTelegram.call(this,a))switch(a.io_channel){case 0:a.ch1_output_value=a.output_value;a.ch1_output_state=a.output_state;break;case 1:a.ch2_output_value=
a.output_value,a.ch2_output_state=a.output_state}return a};Ea.prototype.executeCommand=function(a,f,b){if(f&&f.value){var c=this;switch(f.value){case "ch1On":this.activeStateChange({ch1_output_value:100,ch1_output_state:"on"});this.setOutput(a,{DV:0,IO:0,OV:100},b);break;case "ch1Off":this.activeStateChange({ch1_output_value:0,ch1_output_state:"off"});this.setOutput(a,{DV:0,IO:0,OV:0},b);break;case "ch1Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){c._states.output_state?
c.executeCommand(a,f,b):b&&b(Error("unkown current status"))},200)});break}var d="on"==this._states.ch1_output_state.value?"off":"on";this.activeStateChange({ch1_output_value:"on"==d?100:0,ch1_output_state:d});this.executeCommand(a,{value:"on"==d?"ch1On":"ch1Off"},b);break;case "ch2On":this.activeStateChange({ch2_output_value:100,ch2_output_state:"on"});this.setOutput(a,{DV:0,IO:1,OV:100},b);break;case "ch2Off":this.activeStateChange({ch2_output_value:0,ch2_output_state:"off"});this.setOutput(a,{DV:0,
IO:1,OV:0},b);break;case "ch2Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){c._states.output_state?c.executeCommand(a,f,b):b&&b(Error("unkown current status"))},200)});break}d="on"==this._states.ch2_output_state.value?"off":"on";this.activeStateChange({ch2_output_value:"on"==d?100:0,ch2_output_state:d});this.executeCommand(a,{value:"on"==d?"ch2On":"ch2Off"},b);break;default:b&&b(Error("unknown command"))}}else b&&b(Error("command invalid"))};var ra=function(a){G.call(this,
a);this._data="d2-01-13";this._queryInterval=3E4};ra.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle".split(" ");ra.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state".split(" ");ra.prototype=new G;ra.prototype.constructor=ra;ra.prototype.getStatesBuffer=
function(){var a=[];this._states.ch1_output_state||(!this._lastQuery[0]||now-this._lastQuery[0]>this._queryInterval)&&a.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||now-this._lastQuery[1]>this._queryInterval)&&a.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||now-this._lastQuery[2]>this._queryInterval)&&a.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||now-this._lastQuery[3]>this._queryInterval)&&a.push(3);0<a.length&&this._queryStates(a);return this._states};
ra.prototype._queryStates=function(a,f){var c=require("x.hub.m.enocean.js")._esp3,b=0,d=this,e=function(){b++;b<a.length?d.statusQuery(c,{IO:a[b]},e):f&&f()};this.statusQuery(c,{IO:a[b]},e)};ra.prototype.getIOs=function(){return[0,1,2,3]};ra.prototype.evalTelegram=function(a){if(a=G.prototype.evalTelegram.call(this,a))switch(a.io_channel){case 0:a.ch1_output_value=a.output_value;a.ch1_output_state=a.output_state;break;case 1:a.ch2_output_value=a.output_value;a.ch2_output_state=a.output_state;break;
case 2:a.ch3_output_value=a.output_value;a.ch3_output_state=a.output_state;break;case 3:a.ch4_output_value=a.output_value,a.ch4_output_state=a.output_state}return a};ra.prototype.executeCommand=function(a,f,b){if(f&&f.value){var c=this;switch(f.value?f.value.substr(0,3):null){case "ch1":var d=0;var e="ch1_output_value";var g="ch1_output_state";break;case "ch2":d=1;e="ch2_output_value";g="ch2_output_state";break;case "ch3":d=2;e="ch3_output_value";g="ch3_output_state";break;case "ch4":d=3,e="ch4_output_value",
g="ch4_output_state"}switch(f.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":var r={};r[e]=100;r[g]="on";var h={DV:0,IO:d,OV:100};this.activeStateChange(r);this.setOutput(a,h,b);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":r={};r[e]=0;r[g]="off";h={DV:0,IO:d,OV:0};this.activeStateChange(r);this.setOutput(a,h,b);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){c._states.output_state?
c.executeCommand(a,f,b):b&&b(Error("unkown current status"))},200)});break}if(!this._states[g]){b&&b(Error("state unknown"));break}h="on"==this._states[g].value?"off":"on";r={};r[e]="on"==h?100:0;r[g]=h;h={DV:0,IO:d,OV:"on"==h?100:0};this.activeStateChange(r);this.setOutput(a,h,b);break;default:b&&b(Error("unknown command"))}}else b&&b(Error("command invalid"))};var sa=function(a){G.call(this,a);this._data="d2-01-14";this._queryInterval=3E4};sa.COMMANDS="ch1On ch1Off ch1Toggle ch2On ch2Off ch2Toggle ch3On ch3Off ch3Toggle ch4On ch4Off ch4Toggle ch5On ch5Off ch5Toggle ch6On ch6Off ch6Toggle ch7On ch7Off ch7Toggle ch8On ch8Off ch8Toggle".split(" ");
sa.STATES="power_failure_detection power_failure over_current_switch_off error_level io_channel local_control output_value output_state ch1_output_value ch1_output_state ch2_output_value ch2_output_state ch3_output_value ch3_output_state ch4_output_value ch4_output_state ch5_output_value ch5_output_state ch6_output_value ch6_output_state ch7_output_value ch7_output_state ch8_output_value ch8_output_state".split(" ");sa.prototype=new G;sa.prototype.constructor=sa;sa.prototype._queryStates=function(a,
f){var c=require("x.hub.m.enocean.js")._esp3,b=0,d=this,e=function(){b++;b<a.length?d.statusQuery(c,{IO:a[b]},e):f&&f()};this.statusQuery(c,{IO:a[b]},e)};sa.prototype.getStatesBuffer=function(){var a=(new Date).getTime(),f=[];this._states.ch1_output_state||(!this._lastQuery[0]||a-this._lastQuery[0]>this._queryInterval)&&f.push(0);this._states.ch2_output_state||(!this._lastQuery[1]||a-this._lastQuery[1]>this._queryInterval)&&f.push(1);this._states.ch3_output_state||(!this._lastQuery[2]||a-this._lastQuery[2]>
this._queryInterval)&&f.push(2);this._states.ch4_output_state||(!this._lastQuery[3]||a-this._lastQuery[3]>this._queryInterval)&&f.push(3);this._states.ch5_output_state||(!this._lastQuery[4]||a-this._lastQuery[4]>this._queryInterval)&&f.push(4);this._states.ch6_output_state||(!this._lastQuery[5]||a-this._lastQuery[5]>this._queryInterval)&&f.push(5);this._states.ch7_output_state||(!this._lastQuery[6]||a-this._lastQuery[6]>this._queryInterval)&&f.push(6);this._states.ch8_output_state||(!this._lastQuery[7]||
a-this._lastQuery[7]>this._queryInterval)&&f.push(7);0<f.length&&this._queryStates(f);return this._states};sa.prototype.getIOs=function(){return[0,1,2,3,4,5,6,7]};sa.prototype.evalTelegram=function(a){if(a=G.prototype.evalTelegram.call(this,a))switch(a.io_channel){case 0:a.ch1_output_value=a.output_value;a.ch1_output_state=a.output_state;break;case 1:a.ch2_output_value=a.output_value;a.ch2_output_state=a.output_state;break;case 2:a.ch3_output_value=a.output_value;a.ch3_output_state=a.output_state;
break;case 3:a.ch4_output_value=a.output_value;a.ch4_output_state=a.output_state;break;case 4:a.ch5_output_value=a.output_value;a.ch5_output_state=a.output_state;break;case 5:a.ch6_output_value=a.output_value;a.ch6_output_state=a.output_state;break;case 6:a.ch7_output_value=a.output_value;a.ch7_output_state=a.output_state;break;case 7:a.ch8_output_value=a.output_value,a.ch8_output_state=a.output_state}return a};sa.prototype.executeCommand=function(a,f,b){if(f&&f.value){var c=this;switch(f.value?f.value.substr(0,
3):null){case "ch1":var d=0;var e="ch1_output_value";var g="ch1_output_state";break;case "ch2":d=1;e="ch2_output_value";g="ch2_output_state";break;case "ch3":d=2;e="ch3_output_value";g="ch3_output_state";break;case "ch4":d=3;e="ch4_output_value";g="ch4_output_state";break;case "ch5":d=4;e="ch5_output_value";g="ch5_output_state";break;case "ch6":d=5;e="ch6_output_value";g="ch6_output_state";break;case "ch7":d=6;e="ch7_output_value";g="ch7_output_state";break;case "ch8":d=7,e="ch8_output_value",g="ch8_output_state"}switch(f.value){case "ch1On":case "ch2On":case "ch3On":case "ch4On":case "ch5On":case "ch6On":case "ch7On":case "ch8On":var r=
{};r[e]=100;r[g]="on";var h={DV:0,IO:d,OV:100};this.activeStateChange(r);this.setOutput(a,h,b);break;case "ch1Off":case "ch2Off":case "ch3Off":case "ch4Off":case "ch5Off":case "ch6Off":case "ch7Off":case "ch8Off":r={};r[e]=0;r[g]="off";h={DV:0,IO:d,OV:0};this.activeStateChange(r);this.setOutput(a,h,b);break;case "ch1Toggle":case "ch2Toggle":case "ch3Toggle":case "ch4Toggle":case "ch5Toggle":case "ch6Toggle":case "ch7Toggle":case "ch8Toggle":if(!this._states.output_state){this.init(function(){setTimeout(function(){c._states.output_state?
c.executeCommand(a,f,b):b&&b(Error("unkown current status"))},200)});break}if(!this._states[g]){b&&b(Error("state unknown"));break}h="on"==this._states[g].value?"off":"on";r={};r[e]="on"==h?100:0;r[g]=h;h={DV:0,IO:d,OV:"on"==h?100:0};this.activeStateChange(r);this.setOutput(a,h,b);break;default:b&&b(Error("unknown command"))}}else b&&b(Error("command invalid"))};var zc=function(a){fa.call(this,a);this._data="d2-05-??"};zc.prototype=new fa;zc.prototype.constructor=zc;var S=function(a){zc.call(this,
a);this._data="d2-05-00"};S.COMMANDS="moveUp moveDown moveTo stepUp stepDown lamellaUp lamellaDown lamellaTo stop setRunTime setRotationTime setParams[15.2s]:[10,20,30ms]:[0-3]".split(" ");S.STATES=["state","angle","lock","channel"];S.prototype=new zc;S.prototype.constructor=S;S.prototype.init=function(a){var c=require("x.hub.m.enocean.js")._esp3;this.query(c,{CHN:0},a)};S.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length&&this.init();return this._states};S.prototype.goToPositionAngle=
function(a,f,b){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);f=new Buffer([f.POS&127,f.ANG&127,(f.REPO&7)<<4|f.LOCK&7,(f.CHN&15)<<4|1]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(f,c,0);c.setDstId(this._address);a.sendTelegram(c,!0,function(a){b&&b(a)})};S.prototype.stop=function(a,f,b){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);f=new Buffer([(f.CHN&15)<<4|2]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(f,c,0);c.setDstId(this._address);a.sendTelegram(c,!0,function(a){b&&
b(a)})};S.prototype.query=function(a,f,b){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);f=new Buffer([(f.CHN&15)<<4|3]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(f,c,0);c.setDstId(this._address);a.sendTelegram(c,!0,function(a){b&&b(a)})};S.prototype.setParameters=function(a,f,b){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);f=new Buffer([f.VERT>>8&127,f.VERT&255,f.ROT&255,f.AA&7,(f.CHN&15)<<4|5]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(f,c,0);c.setDstId(this._address);
a.sendTelegram(c,!0,function(a){b&&b(a)})};S.prototype.evalTelegram=function(a){var c={};if(210==a.rorg)switch(a.userData.readUInt8(a.userData.length-1)&15){case 4:if(4==a.userData.length){var b=a.userData.readUInt8(0);c.state=b&127;b=a.userData.readUInt8(1);c.angle=b&127;b=a.userData.readUInt8(2);switch(b&7){case 0:c.lock="normal";break;case 1:c.lock="blockage_mode";break;case 2:c.lock="alarm_mode"}b=a.userData.readUInt8(3);c.channel=b>>4&15}}return c};S.prototype.executeCommand=function(a,f,b){if(f&&
f.value){if("moveTo"==f.value.substr(0,6)&&6<f.value.length){var c=f.value.substr(6);f={value:"moveTo",ext:c}}else"lamellaTo"==f.value.substr(0,9)&&9<f.value.length?(c=f.value.substr(9),f={value:"lamellaTo",ext:c}):"setRunTime"==f.value.substr(0,10)&&10<f.value.length?(c=f.value.substr(10),f={value:"setRunTime",ext:c}):"setRotationTime"==f.value.substr(0,15)&&15<f.value.length?(c=f.value.substr(15),f={value:"setRotationTime",ext:c}):"setParams"==f.value.substr(0,9)&&9<f.value.length&&(c=f.value.substr(9),
f={value:"setParams",ext:c});var d=(new Date).getTime(),e=this;switch(f.value){case "moveUp":this.goToPositionAngle(a,{POS:0,ANG:0,REPO:0,LOCK:0,CHN:0},b);break;case "moveDown":this.goToPositionAngle(a,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:0},b);break;case "moveTo":if("undefined"==typeof f.ext||null==f.ext){b&&b(Error("move to value invalid"));break}c=parseFloat(f.ext);0>c&&(c=0);100<c&&(c=100);this._states.state={value:c,time:d};this.goToPositionAngle(a,{POS:c,ANG:255,REPO:0,LOCK:0,CHN:0},b);break;
case "stepUp":if(!this._states.state){this.init(function(){setTimeout(function(){e._states.state?e.executeCommand(a,f,b):b&&b(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){b&&b(Error("device status unknonw"));break}0!=this._states.angle.value?(c=this._states.angle.value-10,0>c&&(c=0),this._states.angle={value:c,time:d},this.goToPositionAngle(a,{POS:255,ANG:c,REPO:0,LOCK:0,CHN:0},b)):(c=this._states.state.value-5,0>c&&(c=0),this._states.state=
{value:c,time:d},this.goToPositionAngle(a,{POS:c,ANG:0,REPO:0,LOCK:0,CHN:0},b));break;case "stepDown":if(!this._states.state){this.init(function(){setTimeout(function(){e._states.state?e.executeCommand(a,f,b):b&&b(Error("get device status failed"))},200)});break}if(255==this._states.state.value||255==this._states.angle.value){b&&b(Error("device status unknonw"));break}100!=this._states.angle.value?(c=this._states.angle.value+10,100<c&&(c=100),this._states.angle={value:c,time:d},this.goToPositionAngle(a,
{POS:255,ANG:c,REPO:0,LOCK:0,CHN:0},b)):(c=this._states.state.value+5,100<c&&(c=100),this._states.state={value:c,time:d},this.goToPositionAngle(a,{POS:c,ANG:100,REPO:0,LOCK:0,CHN:0},b));break;case "lamellaUp":this.goToPositionAngle(a,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:0},b);break;case "lamellaDown":this.goToPositionAngle(a,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:0},b);break;case "lamellaTo":if("undefined"==typeof f.ext||null==f.ext){b&&b(Error("lamella to value invalid"));break}c=parseFloat(f.ext);0>c&&
(c=0);100<c&&(c=100);this._states.angle={value:c,time:d};this.goToPositionAngle(a,{POS:255,ANG:c,REPO:0,LOCK:0,CHN:0},b);break;case "stop":this.stop(a,{CHN:0},b);break;case "setRunTime":if(!f.ext){b&&b(Error("parameters is null"));break}c=100*parseFloat(f.ext);499>=c&&(c=500);this.setParameters(a,{VERT:c,ROT:255,AA:7,CHN:0},b);break;case "setRotationTime":if(!f.ext){b&&b(Error("parameters is null"));break}c=32767;d=parseInt(f.ext)/10;this.setParameters(a,{VERT:c,ROT:d,AA:7,CHN:0},b);break;case "setParams":if(!f.ext){b&&
b(Error("parameters is null"));break}var g=f.ext.split(":");if(3!=g.length){b&&b(Error("parameters format invalid"));break}c=g[0]?100*parseFloat(g[0]):32767;499>=c&&(c=32767);d=g[1]?parseInt(g[1])/10:255;g=g[2]?parseInt(g[2]):7;this.setParameters(a,{VERT:c,ROT:d,AA:g,CHN:0},b);break;default:b&&b(Error("unknow command"))}}else b&&b(Error("command invalid"))};var ta=function(a){S.call(this,a);this._data="d2-05-01";this._ch1QueryCount=0;this._ch1QueryTO=null;this._ch1QueryTimestamp=0};ta.COMMANDS="ch1moveUp ch1moveDown ch1moveTo ch1stepUp ch1stepDown ch1lamellaUp ch1lamellaDown ch1lamellaTo ch1stop ch2moveUp ch2moveDown ch2moveTo ch2stepUp ch2stepDown ch2lamellaUp ch2lamellaDown ch2lamellaTo ch2stop ch3moveUp ch3moveDown ch3moveTo ch3stepUp ch3stepDown ch3lamellaUp ch3lamellaDown ch3lamellaTo ch3stop ch4moveUp ch4moveDown ch4moveTo ch4stepUp ch4stepDown ch4lamellaUp ch4lamellaDown ch4lamellaTo ch4stop ch1setRunTime ch2setRunTime ch3setRunTime ch4setRunTime ch1setRotationTime ch2setRotationTime ch3setRotationTime ch4setRotationTime ch1setParams[15.2s]:[10,20,30ms]:[0-3] ch2setParams ch3setParams ch4setParams".split(" ");
ta.STATES="ch1state ch1angle ch1lock ch2state ch2angle ch2lock ch3state ch3angle ch3lock ch4state ch4angle ch4lock channel".split(" ");ta.prototype=new S;ta.prototype.constructor=ta;ta.prototype.init=function(a){this._queryStates([0,1,2,3],a)};ta.prototype.getStatesBuffer=function(){var a=[];this._states.ch1state||a.push(0);this._states.ch2state||a.push(1);this._states.ch3state||a.push(2);this._states.ch4state||a.push(3);0<a.length&&this._queryStates(a);return this._states};ta.prototype._queryStates=
function(a,f){var c=require("x.hub.m.enocean.js")._esp3,b=0,d=this,e=function(){b++;b<a.length?d.query(c,{CHN:a[b]},e):f&&f()};this.query(c,{CHN:a[b]},e)};ta.prototype.evalTelegram=function(a){if(a=S.prototype.evalTelegram.call(this,a))switch(a.channel){case 0:a.ch1state=a.state;a.ch1angle=a.angle;a.ch1lock=a.lock;break;case 1:a.ch2state=a.state;a.ch2angle=a.angle;a.ch2lock=a.lock;break;case 2:a.ch3state=a.state;a.ch3angle=a.angle;a.ch3lock=a.lock;break;case 3:a.ch4state=a.state,a.ch4angle=a.angle,
a.ch4lock=a.lock}return a};ta.prototype.executeCommand=function(a,f,b){if(f&&f.value){f=JSON.parse(JSON.stringify(f));var c=null;switch(f.value.substr(0,3)){case "ch1":c=0;var d="ch1state";var e="ch1angle";break;case "ch2":c=1;d="ch2state";e="ch2angle";break;case "ch3":c=2;d="ch3state";e="ch3angle";break;case "ch4":c=3;d="ch4state";e="ch4angle";break;default:b&&b(Error("unknown command"))}f.value=f.value.substr(3);if("moveTo"==f.value.substr(0,6)&&6<f.value.length){var g=f.value.substr(6);f={value:"moveTo",
ext:g}}else"lamellaTo"==f.value.substr(0,9)&&9<f.value.length?(g=f.value.substr(9),f={value:"lamellaTo",ext:g}):"setRunTime"==f.value.substr(0,10)&&10<f.value.length?(g=f.value.substr(10),f={value:"setRunTime",ext:g}):"setRotationTime"==f.value.substr(0,15)&&15<f.value.length?(g=f.value.substr(15),f={value:"setRotationTime",ext:g}):"setParams"==f.value.substr(0,9)&&9<f.value.length&&(g=f.value.substr(9),f={value:"setParams",ext:g});(new Date).getTime();var r=this;switch(f.value){case "moveUp":this.goToPositionAngle(a,
{POS:0,ANG:0,REPO:0,LOCK:0,CHN:c},b);break;case "moveDown":this.goToPositionAngle(a,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:c},b);break;case "moveTo":if("undefined"==typeof f.ext||null==f.ext){b&&b(Error("move to value invalid"));break}g=parseFloat(f.ext);0>g&&(g=0);100<g&&(g=100);var h={};h[d]=g;this.activeStateChange(h);this.goToPositionAngle(a,{POS:g,ANG:255,REPO:0,LOCK:0,CHN:c},b);break;case "stepUp":if(!this._states[d]){this.init(function(){setTimeout(function(){r._states[d]?r.executeCommand(a,f,
b):b&&b(Error("get device status failed"))},200)});break}if(255==this._states[d].value||255==this._states[e].value){b&&b(Error("device status unknonw"));break}0!=this._states[e].value?(g=this._states[e].value-10,0>g&&(g=0),h={},h[e]=g,this.activeStateChange(h),this.goToPositionAngle(a,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:c},b)):(g=this._states[d].value-5,0>g&&(g=0),h={},h[d]=g,this.activeStateChange(h),this.goToPositionAngle(a,{POS:g,ANG:0,REPO:0,LOCK:0,CHN:c},b));break;case "stepDown":if(!this._states[d]){this.init(function(){setTimeout(function(){r._states[d]?
r.executeCommand(a,f,b):b&&b(Error("get device status failed"))},200)});break}if(255==this._states[d].value||255==this._states[e].value){b&&b(Error("device status unknonw"));break}100!=this._states[e].value?(g=this._states[e].value+10,100<g&&(g=100),h={},h[e]=g,this.activeStateChange(h),this.goToPositionAngle(a,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:c},b)):(g=this._states[d].value+5,100<g&&(g=100),h={},h[d]=g,this.activeStateChange(h),this.goToPositionAngle(a,{POS:g,ANG:100,REPO:0,LOCK:0,CHN:c},b));break;
case "lamellaUp":this.goToPositionAngle(a,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:c},b);break;case "lamellaDown":this.goToPositionAngle(a,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:c},b);break;case "lamellaTo":if("undefined"==typeof f.ext||null==f.ext){b&&b(Error("lamella to value invalid"));break}g=parseFloat(f.ext);0>g&&(g=0);100<g&&(g=100);h={};h[e]=g;this.goToPositionAngle(a,{POS:255,ANG:g,REPO:0,LOCK:0,CHN:c},b);break;case "stop":this.stop(a,{CHN:c},b);break;case "setRunTime":if(!f.ext){b&&b(Error("parameters is null"));
break}e=100*parseFloat(f.ext);499>=e&&(e=500);this.setParameters(a,{VERT:e,ROT:255,AA:7,CHN:c},b);break;case "setRotationTime":if(!f.ext){b&&b(Error("parameters is null"));break}e=32767;h=parseInt(f.ext)/10;this.setParameters(a,{VERT:e,ROT:h,AA:7,CHN:c},b);break;case "setParams":if(!f.ext){b&&b(Error("parameters is null"));break}g=f.ext.split(":");if(3!=g.length){b&&b(Error("parameters format invalid"));break}e=g[0]?100*parseFloat(g[0]):32767;499>=e&&(e=32767);h=g[1]?parseInt(g[1])/10:255;g=g[2]?
parseInt(g[2]):7;this.setParameters(a,{VERT:e,ROT:h,AA:g,CHN:c},b);break;default:b&&b(Error("unknow command"))}}else b&&b(Error("command invalid"))};var Ac=function(a){fa.call(this,a);this._data="d2-06-??"};Ac.prototype=new fa;Ac.prototype.constructor=Ac;var za=function(a){fa.call(this,a);this._data="d2-06-01";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbir_new=this._suir_new=this._blcr_new=this._hccr_new=this._vacation_new=null};za.COMMANDS="vacationOn vacationOff handleClosedClickOn handleClosedClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
za.STATES="bal ppal state handle window br bl motion vacation temperature humidity illumination battery hccr blcr suir vbir".split(" ");za.prototype=new Ac;za.prototype.constructor=za;za.prototype.executeCommand=function(a,b,d){a=(new Date).getTime();if(b&&b.value){"setSensorUpdateInterval"==b.value.substr(0,23)&&23<b.value.length?(b=b.value.substr(23),b={value:"setSensorUpdateInterval",ext:b}):"setVacationBlinkInterval"==b.value.substr(0,24)&&24<b.value.length&&(b=b.value.substr(24),b={value:"setVacationBlinkInterval",
ext:b});switch(b.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({vacation:"off"});break;case "handleClosedClickOn":this._hccr_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({hccr:"on"});break;case "handleClosedClickOff":this._hccr_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcr_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcr_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("set sensor update interval value invalid"));return}b=parseInt(b.ext);5>b&&(b=5);65535<b&&(b=65535);this._suir_new=b;this._states.pending={value:!0,time:a};
this.activeStateChange({suir:b});break;case "setVacationBlinkInterval":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("set vacation blink interval value invalid"));return}b=parseInt(b.ext);3>b&&(b=3);255<b&&(b=255);this._vbir_new=b;this._states.pending={value:!0,time:a};this.activeStateChange({vbir:b})}d&&d()}else d&&d(Error("command invalid"))};za.prototype.evalData=function(a,b,d){var c=this.evalTelegram(b);this._vacation_new&&delete c.vacation;this._hccr_new&&delete c.hccr;this._blcr_new&&
delete c.blcr;this._suir_new&&delete c.suir;this._vbir_new&&delete c.vbir;210==b.rorg&&0==b.userData.readUInt8(0)&&this._sendResponse(a);c?(a=this.checkStateChange(c),d&&d(null,a)):d&&d(Error("data format invalid"))};za.prototype.evalTelegram=function(a){var c={};if(210==a.rorg)switch(a.userData.readUInt8(0)){case 0:var b=a.userData.readUInt8(1);var d=a.userData.readUInt8(2);var e=a.userData.readUInt8(3);var g=a.userData.readUInt8(4);var h=a.userData.readUInt8(5);var l=a.userData.readUInt8(6);var k=
a.userData.readUInt16BE(7);a=a.userData.readUInt8(9);a=a>>3&31;switch(b>>4&15){case 0:c.bal="ok";break;case 1:c.bal="alarm";break;case 14:c.bal="invalid";break;case 15:c.bal="unsupported"}switch(b&15){case 0:c.ppal="ok";break;case 1:c.ppal="alarm";break;case 14:c.ppal="invalid";break;case 15:c.ppal="unsupported"}switch(d>>4&15){case 0:c.handle="undefined";break;case 1:c.handle="up";break;case 2:c.handle="down";break;case 3:c.handle="left";break;case 4:c.handle="right";break;case 14:c.handle="invalid";
break;case 15:c.handle="unsupported"}switch(d&15){case 0:c.window="undefined";break;case 1:c.window="not_tilted";break;case 2:c.window="tilted";break;case 14:c.window="invalid";break;case 15:c.window="unsupported"}switch(e>>4&15){case 0:c.br="unchanged";break;case 1:c.br="pressed";break;case 2:c.br="releaseed";break;case 14:c.br="invalid";break;case 15:c.br="unsupported"}switch(e&15){case 0:c.bl="unchanged";break;case 1:c.bl="pressed";break;case 2:c.bl="releaseed";break;case 14:c.bl="invalid";break;
case 15:c.bl="unsupported"}switch(g>>4&15){case 0:c.motion="ok";break;case 1:c.motion="alarm";break;case 14:c.motion="invalid";break;case 15:c.motion="unsupported"}switch(g&15){case 0:c.vacation="unchanged";break;case 1:c.vacation="on";break;case 2:c.vacation="off";break;case 14:c.vacation="invalid";break;case 15:c.vacation="unsupported"}254==h?c.temperature="invalid":255==h?c.temperature="unsupported":250>=h&&(c.temperature=parseFloat((h/250*80-20).toFixed(2)));254==l?c.humidity="invalid":255==l?
c.humidity="unsupported":200>=l&&(c.humidity=parseFloat((l/2).toFixed(1)));65534==k?c.illumination="invalid":65535==k?c.illumination="unsupported":60001==k?c.illumination="over_range":6E4>=k&&(c.illumination=k);20>=a&&(c.battery=5*a);if("undefined"==c.window||"invalid"==c.window||"unsupported"==c.window||"not_tilted"==c.window)switch(c.handle){case "undefined":c.state="undefined";break;case "up":c.state="tilted";break;case "down":c.state="closed";break;case "left":c.state="open";break;case "right":c.state=
"open";break;case "invalid":c.state="invalid";break;case "unsupported":c.state="undefined"}else"tilted"==c.window&&(c.state="tilted");break;case 16:l=a.userData.readUInt8(1),k=a.userData.readUInt16BE(2),a=a.userData.readUInt8(4),b=k,d=a,c.vacation=l>>7&1?"on":"off",c.hccr=l>>6&1?"on":"off",c.blcr=l>>5&1?"on":"off",5<=b&&(c.suir=b),3<=d&&(c.vbir=d)}return c};za.prototype._sendResponse=function(a,b){var c=0;this._vacation_new&&"on"==this._vacation_new&&(c=1);var f=0;this._hccr_new&&"off"==this._hccr_new?
f=1:this._hccr_new&&"on"==this._hccr_new&&(f=2);var d=0;this._blcr_new&&"off"==this._blcr_new?d=1:this._blcr_new&&"on"==this._blcr_new&&(d=2);var e=0;this._suir_new&&(e=this._suir_new);var g=0;this._vbir_new&&(g=this._vbir_new);var h=new Buffer([128,128|(c&1)<<5|(f&3)<<3|(d&3)<<1,e>>8&255,e&255,g]),l=this._senderID;l||(l=x.hub.m.enocean.SENDER_ID);h=new x.hub.m.enocean.ESP3.Telegram.VLD(h,l,0);var k=this;a.sendTelegram(h,!0,function(a){k._vacation_new=null;k._hccr_new=null;k._blcr_new=null;k._suir_new=
null;k._vbir_new=null;var h={pending:!1};h.vacation=c?"on":"off";f&&(h.hccr=1==f?"off":"on");d&&(h.blcr=1==d?"off":"on");e&&(h.suir=e);g&&(h.vbir=g);k.activeStateChange(h);b&&b(a)})};var Aa=function(a){fa.call(this,a);this._data="d2-06-02";this._states={pending:{value:!1,time:(new Date).getTime()}};this._vbis_new=this._suis_new=this._blcs_new=this._lacs_new=this._vacation_new=null};Aa.COMMANDS="vacationOn vacationOff lockActiveClickOn lockActiveClickOff batteryLowClickOn batteryLowClickOff setSensorUpdateInterval setVacationBlinkInterval".split(" ");
Aa.STATES="operation_mode handle window state temperature humidity battery vacation hccr blcr suir vbir".split(" ");Aa.prototype=new Ac;Aa.prototype.constructor=Aa;Aa.prototype.executeCommand=function(a,b,d){a=(new Date).getTime();if(b&&b.value){"setSensorUpdateInterval"==b.value.substr(0,23)&&23<b.value.length?(b=b.value.substr(23),b={value:"setSensorUpdateInterval",ext:b}):"setVacationBlinkInterval"==b.value.substr(0,24)&&24<b.value.length&&(b=b.value.substr(24),b={value:"setVacationBlinkInterval",
ext:b});switch(b.value){case "vacationOn":this._vacation_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({vacation:"on"});break;case "vacationOff":this._vacation_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({vacation:"off"});break;case "lockActiveClickOn":this._lacs_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({hccr:"on"});break;case "lockActiveClickOff":this._lacs_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({hccr:"off"});
break;case "batteryLowClickOn":this._blcs_new="on";this._states.pending={value:!0,time:a};this.activeStateChange({blcr:"on"});break;case "batteryLowClickOff":this._blcs_new="off";this._states.pending={value:!0,time:a};this.activeStateChange({blcr:"off"});break;case "setSensorUpdateInterval":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("set sensor update interval value invalid"));return}b=parseInt(b.ext);5>b&&(b=5);65535<b&&(b=65535);this._suis_new=b;this._states.pending={value:!0,time:a};
this.activeStateChange({suir:b});break;case "setVacationBlinkInterval":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("set vacation blink interval value invalid"));return}b=parseInt(b.ext);3>b&&(b=3);255<b&&(b=255);this._vbis_new=b;this._states.pending={value:!0,time:a};this.activeStateChange({vbir:b})}d&&d()}else d&&d(Error("command invalid"))};Aa.prototype.evalData=function(a,b,d){var c=this.evalTelegram(b);this._vacation_new&&delete c.vacation;this._lacs_new&&delete c.hccr;this._blcs_new&&
delete c.blcr;this._suis_new&&delete c.suir;this._vbis_new&&delete c.vbir;210==b.rorg&&0==b.userData.readUInt8(0)&&this._sendResponse(a);c?(a=this.checkStateChange(c),d&&d(null,a)):d&&d(Error("data format invalid"))};Aa.prototype.evalTelegram=function(a){var c={};if(210==a.rorg)switch(a.userData.readUInt8(0)){case 0:var b=a.userData.readUInt8(1);var d=a.userData.readUInt8(2);var e=a.userData.readUInt8(3);a=a.userData.readUInt8(4);a=a>>3&31;switch(b>>6&3){case 0:c.operation_mode="standard";break;case 1:c.operation_mode=
"hst"}switch(b>>4&3){case 0:c.lock="unlocked";break;case 1:c.lock="locked"}switch(b>>2&3){case 0:c.window="not_tilted";break;case 1:c.window="tilted"}switch(b&3){case 0:c.alarm="ok";break;case 1:c.alarm="burglary_alarm";break;case 2:c.alarm="unlock_alarm"}254==d?c.temperature="invalid":255==d?c.temperature="unsupported":250>=d&&(c.temperature=parseFloat((d/250*80-20).toFixed(2)));254==e?c.humidity="invalid":255==e?c.humidity="unsupported":200>=e&&(c.humidity=parseFloat((e/2).toFixed(1)));20>=a&&(c.battery=
5*a);if("tilted"==c.window)c.state="tilted";else switch(c.lock){case "unlocked":c.state="open";break;case "locked":c.state="closed"}break;case 16:b=a.userData.readUInt8(1),d=a.userData.readUInt16BE(2),e=a=a.userData.readUInt8(4),c.vacation=b>>7&1?"on":"off",c.hccr=b>>6&1?"on":"off",c.blcr=b>>5&1?"on":"off",5<=d&&(c.suir=d),3<=e&&(c.vbir=e)}return c};Aa.prototype._sendResponse=function(a,b){var c=0;this._vacation_new&&"on"==this._vacation_new?c=1:this._vacation_new&&"off"==this._vacation_new&&(c=2);
var f=0;this._lacs_new&&"off"==this._lacs_new?f=1:this._lacs_new&&"on"==this._lacs_new&&(f=2);var d=0;this._blcs_new&&"off"==this._blcs_new?d=1:this._blcs_new&&"on"==this._blcs_new&&(d=2);var e=0;this._suis_new&&(e=this._suis_new);var g=0;this._vbis_new&&(g=this._vbis_new);var h=new Buffer([128,128|(c&3)<<4|(f&3)<<2|d&3,e>>8&255,e&255,g]),l=this._senderID;l||(l=x.hub.m.enocean.SENDER_ID);h=new x.hub.m.enocean.ESP3.Telegram.VLD(h,l,0);var k=this;a.sendTelegram(h,!0,function(a){k._vacation_new=null;
k._lacs_new=null;k._blcs_new=null;k._suis_new=null;k._vbis_new=null;var h={pending:!1};h.vacation=c?"on":"off";f&&(h.hccr=1==f?"off":"on");d&&(h.blcr=1==d?"off":"on");e&&(h.suir=e);g&&(h.vbir=g);k.activeStateChange(h);b&&b(a)})};var Bc=function(a){fa.call(this,a);this._data="d2-20-??"};Bc.prototype=new fa;Bc.prototype.constructor=Bc;var ba=function(a){Bc.call(this,a);this._data="d2-20-00";this._poller=null;this._pollInterval=6E4};ba.COMMANDS="setFanLevel fanLevelUp fanLevelDown requestStatus setHumLevel setCo2Level".split(" ");
ba.STATES="filter_remaining_time operating_time temperature message_code anti_freeze current_fan_level set_fan_level".split(" ");ba.prototype=new Bc;ba.prototype.constructor=ba;ba.prototype.init=function(a){var c=this;setTimeout(function(){var b=require("x.hub.m.enocean.js")._esp3;c.executeCommand(b,{value:"requestStatus"},a);c._restartPoller(b)},Math.floor(6E3*Math.random())+1E3)};ba.prototype.finalize=function(a){this._poller&&clearInterval(this._poller);a&&a()};ba.prototype._restartPoller=function(a){this._poller&&
clearInterval(this._poller);var c=this;this._poller=setInterval(function(){c.executeCommand(a,{value:"requestStatus"})},this._pollInterval)};ba.prototype.executeCommand=function(a,b,d){(new Date).getTime();if(b&&b.value){if("setFanLevel"==b.value.substr(0,11)&&11<b.value.length)b=b.value.substr(11),b={value:"setFanLevel",ext:b};else if("fanLevelUp"==b.value){var c=this.getBufferedState("set_fan_level");if("undefined"==typeof c||null==c){d&&d(Error("fanLevelUp unknown current fan level"));return}if(6==
c){d&&d();return}b={value:"setFanLevel",ext:c+1}}else if("fanLevelDown"==b.value){c=this.getBufferedState("set_fan_level");if("undefined"==typeof c||null==c){d&&d(Error("fanLevelUp unknown current fan level"));return}if(0==c){d&&d();return}b={value:"setFanLevel",ext:c-1}}else if("setHumLevel"==b.value.substr(0,11)&&11<b.value.length){c=this.getBufferedState("set_fan_level");if(5!=c){d&&d(Error("humidity regulation not active"));return}b=b.value.substr(11);b={value:"setHumLevel",ext:b}}else if("setCo2Level"==
b.value.substr(0,11)&&11<b.value.length){c=this.getBufferedState("set_fan_level");if(6!=c){d&&d(Error("co2 regulation not active"));return}b=b.value.substr(11);b={value:"setCo2Level",ext:b}}var f=this;switch(b.value){case "setFanLevel":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("setFanLevel value invalid"));break}var e=parseInt(b.ext);if(0>e||6<e){d&&d(Error("setFanLevel value invalid"));break}if(5==e||6==e){this.activeStateChange({set_fan_level:e});this._activateSensorRegulation(e);d&&
d();break}this._deactivateSensorRegulation();this._sendResponse(a,{LS:e,RS:1},function(c){c||f.activeStateChange({set_fan_level:e});f._restartPoller(a);d&&d(c)});break;case "setHumLevel":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("setHumLevel value invalid"));break}e=parseInt(b.ext);if(0>e||4<e){d&&d(Error("setHumLevel value invalid"));break}this._sendResponse(a,{LS:e,RS:1},function(c){f._restartPoller(a);d&&d(c)});break;case "setCo2Level":if("undefined"==typeof b.ext||null==b.ext){d&&
d(Error("setCo2Level value invalid"));break}e=parseInt(b.ext);if(0>e||4<e){d&&d(Error("setCo2Level value invalid"));break}this._sendResponse(a,{LS:e,RS:1},function(c){f._restartPoller(a);d&&d(c)});break;case "requestStatus":this._sendResponse(a,{LS:5,RS:1},function(a){d&&d(a)});break;default:d&&d(Error("unknown command"))}}else d&&d(Error("command invalid"))};ba.prototype.evalData=function(a,b,d){a=this.evalTelegram(b);this._states&&this._states.set_fan_level||(a.set_fan_level=a.current_fan_level);
this._states&&this._states.set_fan_level&&5!=this._states.set_fan_level.value&&6!=this._states.set_fan_level.value&&(a.set_fan_level=a.current_fan_level);a=this.checkStateChange(a);d&&d(null,a)};ba.prototype.evalTelegram=function(a){var c={};if(210==a.rorg)if(1==a.userData.length){var b=a.userData.readUInt8(0)&7;c.current_fan_level=b}else{b=a.userData.readUInt8(0);var d=a.userData.readUInt8(1),e=a.userData.readUInt16LE(2),g=a.userData.readUInt8(4),h=a.userData.readUInt8(5),l=a.userData.readUInt8(6),
k=a.userData.readUInt16LE(7),n=a.userData.readUInt8(9),q=a.userData.readUInt8(10),ha=a.userData.readInt16BE(11);a=a.userData.readUInt8(13);c.filter_remaining_time=g+":"+e+":"+d+":"+b;c.operating_time=n+":"+k+":"+l+":"+h;c.temperature=ha/10;c.message_code=q;c.anti_freeze=a>>4&1?"on":"off";c.current_fan_level=a&7}return c};ba.prototype._sendResponse=function(a,b,d){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);b=new Buffer([b.LS,b.RS]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(b,
c,0);this._senderID!=this._address&&c.setDstId(this._address);a.sendTelegram(c,!0,function(a){d&&d(a)})};ba.prototype._activateSensorRegulation=function(a){var c=require("x.hub.m.enocean.js").getRehauHandler();c&&c.activateSensorRegulation(this.getAddress(),a)};ba.prototype._deactivateSensorRegulation=function(){var a=require("x.hub.m.enocean.js").getRehauHandler();a&&a.deactivateSensorRegulation(this.getAddress())};var Pb=function(a){O.call(this,a);this._data="eltako_contact";this._vendor="eltako";
this._eepAlias="f6-10-00"};Pb.STATES=["contact","contact_raw"];Pb.prototype=new O;Pb.prototype.constructor=Pb;Pb.prototype.evalTelegram=function(a){var c={};246==a.rorg&&(a=a.userData,240==a?c.contact="closed":224==a&&(c.contact="open"),c.contact_raw=a);return c};var Ma=function(a){Va.call(this,a);this._data="eltako_motion";this._vendor="eltako";this._eepAlias="a5-08-01"};Ma.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");Ma.prototype=new Va;Ma.prototype.constructor=
Ma;Ma.prototype.evalTelegram=function(a){var c={};if(165==a.rorg){var b=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(b>>3&1)){c.voltage=parseFloat((a/255*5.1).toFixed(1));c.voltage_raw=a;c.illumination=parseFloat((d/255*2048).toFixed(1));c.illumination_raw=d;b=b>>1&1;switch(b){case 0:c.state="on";break;case 1:c.state="off"}c.state_raw=b}}return c};var ka=function(a){J.call(this,a);this._data="eltako_switch";this._vendor="eltako";this._eepAlias=
"f6-02-01"};ka.COMMANDS=["on","off","toggle"];ka.STATES=["state"];ka.prototype=new J;ka.prototype.constructor=ka;ka.prototype.getTeachinType=function(){return"4BS"};ka.prototype.handleLearnTelegram=function(a,b){if(b&&246==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(c,b){a._learnFinish(c,0,b)})};
ka.prototype.getTeachinTelegram=function(a,b,d){a=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};ka.prototype.evalTelegram=function(a){var c={};if(246==a.rorg)switch(a.userData){case 112:c.state="on";break;case 80:c.state="off"}return c};ka.prototype.executeCommand=function(a,b,d){if(b&&b.value)switch((new Date).getTime(),b.value){case "on":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:1},function(a){d&&d(a)});break;case "off":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:0},function(a){d&&
d(a)});break;case "toggle":if(!this._states.state){d&&d(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},d):this.executeCommand(a,{value:"on"},d);break;default:d&&d(Error("unknow command"))}else d&&d(Error("command invalid"))};var Oc=function(){var a=function(a){ka.call(this,a);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_switch"};a.prototype=new ka;a.prototype.constructor=a;a.prototype.handleTeachinTelegram=function(a,c){if(c&&165==
c.rorg&&c.userData){var b=c.userData.toString("hex"),f=a._teachSenderID;if(b&&f&&f.substr(2)==b.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._teachID,senderID:a._teachSenderID,data:a._teachProfile,vendor:a._teachVendor},{address:c.senderID,senderID:a._teachSenderID,data:a._teachProfile,vendor:a._teachVendor},function(c,b){a._teachFinish(c,b)})}};return a}(),I=function(a){J.call(this,a);this._data="eltako_dimmer";this._vendor="eltako";this._eepAlias="a5-38-08";
this._lastOnLevel=-1};I.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");I.STATES=["state","level","ramp_time"];I.prototype=new J;I.prototype.constructor=I;I.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.ramp_time||null==this._params.ramp_time)this._params.ramp_time=0};I.prototype.handleLearnTelegram=function(a,b){if(b&&165==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,
senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(c,b){a._learnFinish(c,0,b)})};I.prototype.getTeachinTelegram=function(a,b,d){a=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};I.prototype.getStatesBuffer=function(){var a=JSON.parse(JSON.stringify(this._states));a.ramp_time={value:this._params.ramp_time,time:-1};return a};I.prototype.getCurrentStates=function(){var a=
{},b=this.getStatesBuffer();b.level&&0==b.level.value&&b.state&&(b.state.value="off");b.state&&"off"==b.state.value&&b.level&&(b.level.value=0);for(var d in b)b.hasOwnProperty(d)&&b[d]&&(a[d]=b[d].value);return a};I.prototype.evalData=function(a,b,d){(a=this.evalTelegram(b))?(0==a.level&&(a.state="off"),"off"==a.state&&(a.level=0),(0==a.level||"off"==a.state)&&this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value),a=this.checkStateChange(a),d&&d(null,a)):d&&d(Error("data format invalid"))};
I.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),e=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1))switch(a){case 2:b.level=e,b.ramp=d,b.dim_range=c>>2&1?"relative":"absolute",b.store_final_value=c>>1&1,b.state=c&1?"on":"off"}}return b};I.prototype.executeCommand=function(a,b,d){if(b&&b.value){if("dimTo"==b.value.substr(0,5)&&5<b.value.length){var c=b.value.substr(5);b={value:"dimTo",ext:c}}else"toggleTo"==b.value.substr(0,
8)&&8<b.value.length?(c=b.value.substr(8),b={value:"toggleTo",ext:c}):"setRampTime"==b.value.substr(0,11)&&11<b.value.length&&(c=b.value.substr(11),b={value:"setRampTime",ext:c});(new Date).getTime();var f=this;switch(b.value){case "on":c=this._lastOnLevel;if(-1==c||0==c)c=100;this.dimming(a,{EDIM:c,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(a){a||f.activeStateChange({level:c,state:"on"});d&&d(a)});break;case "off":this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value);
this.dimming(a,{EDIM:0,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:0},function(a){a||f.activeStateChange({level:0,state:"off"});d&&d(a)});break;case "toggle":if(!this._states.state){d&&d(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},d):this.executeCommand(a,{value:"on"},d);break;case "toggleTo":if(!this._states.state){d&&d(Error("unknow previous dimmer state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},
d):this.executeCommand(a,{value:"dimTo",ext:b.ext},d);break;case "dimTo":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("dim to value invalid"));break}c=parseFloat(b.ext);0>c&&(c=0);100<c&&(c=100);if(0==c){this.executeCommand(a,{value:"off"},d);break}this.dimming(a,{EDIM:c,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(a){a||f.activeStateChange({level:c,state:"on"});d&&d(a)});break;case "dimUp":if(!this._states.level){d&&d(Error("unknow previous dimmer level"));break}c=parseInt(this._states.level.value);
c+=5;100<c&&(c=100);this.dimming(a,{EDIM:c,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(a){a||f.activeStateChange({level:c,state:"on"});d&&d(a)});break;case "dimDown":if(!this._states.level){d&&d(Error("unknow previous dimmer level"));break}c=parseInt(this._states.level.value);c-=5;0>c&&(c=0);if(0==c){this.executeCommand(a,{value:"off"},d);break}this.dimming(a,{EDIM:c,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(a){a||f.activeStateChange({level:c,state:"on"});d&&d(a)});break;
case "setRampTime":if(!b.ext){d&&d(Error("parameters is null"));break}c=parseInt(c);255<c&&(c=255);0>c&&(c=0);this._params.ramp_time=c;require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated(this,function(a){d&&d(a)});break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};var Qc=function(){var a=function(a){I.call(this,a);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_dimmer"};a.prototype=new I;a.prototype.constructor=a;a.prototype.handleTeachinTelegram=function(a,
b){if(b&&165==b.rorg&&b.userData){var c=b.userData.toString("hex"),f=a._teachSenderID;if(c&&f&&f.substr(2)==c.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._teachID,senderID:a._teachSenderID,data:a._teachProfile,vendor:a._teachVendor},{address:b.senderID,senderID:a._teachSenderID,data:a._teachProfile,vendor:a._teachVendor},function(b,c){a._teachFinish(b,c)})}};return a}(),$a=function(a){I.call(this,a);this._data="eltako_dimmer2";this._vendor="eltako";this._eepAlias=
"f6-02-01"};$a.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");$a.STATES=["state","ramp_time"];$a.prototype=new I;$a.prototype.constructor=I;$a.prototype.handleLearnTelegram=function(a,b){if(b&&246==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(b,c){a._learnFinish(b,
0,c)})};$a.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.state="on";break;case 80:b.state="off"}return b};var Qb=function(a){I.call(this,a);this._data="eltako_fsud"};Qb.COMMANDS="on off toggle dimTo dimUp dimDown toggleTo setRampTime".split(" ");Qb.STATES=["state","ramp_time"];Qb.prototype=new I;Qb.prototype.constructor=I;Qb.prototype.getTeachinTelegram=function(a,b,d){a=new Buffer([2,0,0,0]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};var T=function(a){yc.call(this,
a);this._data="eltako_blind";this._vendor="eltako";this._eepAlias="f6-02-01";this._syncRunning=!1;this._syncCB=this._syncTO=null};T.COMMANDS="up down stop stepUp stepDown setRV setRunTime moveTo sync".split(" ");T.STATES=["pos","sync"];T.prototype=new yc;T.prototype.constructor=T;T.prototype.setDefaultParams=function(){this._params||(this._params={});if("undefined"==typeof this._params.rv||null==this._params.rv)this._params.rv=200;if("undefined"==typeof this._params.rt||null==this._params.rt)this._params.rt=
200};T.prototype.handleLearnTelegram=function(a,b){if(b&&246==b.rorg)require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._learnAddress,senderID:a._learnSenderID,data:a._learnProfile,vendor:a._learnVendor},{address:b.senderID,senderID:a._learnSenderID,data:this._data,vendor:this._vendor},function(b,c){a._learnFinish(b,0,c)})};T.prototype.getTeachinTelegram=function(a,b,d){a=new Buffer([255,248,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(a,b,0)};T.prototype.getStatesBuffer=
function(){var a=JSON.parse(JSON.stringify(this._states));a.sync||(a.sync={value:!1,time:-1});a.rv={value:this._params.rv,time:-1};a.rt={value:this._params.rt,time:-1};return a};T.prototype.evalData=function(a,b,d){(a=this.evalTelegram(b))?(b=this.checkStateChange(a),a.sync&&this._syncRunning&&(this._syncRunning=!1,this._syncTO&&(clearTimeout(this._syncTO),this._syncTO=null),this._syncCB&&(this._syncCB(),this._syncCB=null)),d&&d(null,b)):d&&d(Error("data format invalid"))};T.prototype.evalTelegram=
function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.sync=!0;b.pos=0;break;case 80:b.sync=!0,b.pos=100}else if(165==a.rorg){var c=a.userData.readUInt16BE(0);a=a.userData.readUInt8(2);var d=this._params.rt;d||(d=200);var e=this._states.pos?this._states.pos.value:null;e||(e=0);if("undefined"!=typeof e&&null!=e)switch(c=10*c/d,a){case 1:b.pos=Math.max(0,Math.round(e-c));break;case 2:b.pos=Math.min(100,Math.round(e+c))}}return b};T.prototype.executeCommand=function(a,b,d){if(b&&b.value){if("stepUp"==
b.value.substr(0,6)&&6<b.value.length){var c=b.value.substr(6);b={value:"stepUp",ext:c}}else"stepDown"==b.value.substr(0,8)&&8<b.value.length?(c=b.value.substr(8),b={value:"stepDown",ext:c}):"setRV"==b.value.substr(0,5)&&5<b.value.length?(c=b.value.substr(5),b={value:"setRV",ext:c}):"setRunTime"==b.value.substr(0,10)&&10<b.value.length?(c=b.value.substr(10),b={value:"setRunTime",ext:c}):"moveTo"==b.value.substr(0,6)&&6<b.value.length&&(c=b.value.substr(6),b={value:"moveTo",ext:c});(new Date).getTime();
var f=this._params.rv;f||(f=200);var e=this._params.rt;e||(e=200);switch(b.value){case "up":this.doReq(a,{TIME:f,CMD:1,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "down":this.doReq(a,{TIME:f,CMD:2,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "stop":this.doReq(a,{TIME:0,CMD:0,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "stepUp":e="undefined"==typeof b.ext||null==b.ext?e/100:parseFloat(b.ext)/100*e;1>e&&(e=1);this.doReq(a,{TIME:e,CMD:1,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "stepDown":e=
"undefined"==typeof b.ext||null==b.ext?e/100:parseFloat(b.ext)/100*e;1>e&&(e=1);this.doReq(a,{TIME:e,CMD:2,LCK:0,TYPE:0},function(a){d&&d(a)});break;case "moveTo":if("undefined"==typeof b.ext||null==b.ext){d&&d(Error("value invalid"));break}b=parseInt(b.ext);c=0;this._states&&this._states.pos&&"undefined"!=typeof this._states.pos.value&&null!=this._states.pos.value&&(c=this._states.pos.value);e*=(b-c)/100;if(0<e)var g=2;else if(0>e)e=0-e,g=1;else if(0==e){d&&d();break}this.doReq(a,{TIME:e,CMD:g,LCK:0,
TYPE:1},function(a){d&&d(a)});break;case "sync":this.snyc(a,function(a){d&&d(a)});break;case "setRV":if(!b.ext){d&&d(Error("parameters is null"));break}c=parseInt(c);200<c&&(c=200);0>c&&(c=0);this._params.rv=c;a=require("x.hub.m.enocean.js")._deviceHandler;a.deviceParamsUpdated(this,function(a){d&&d(a)});break;case "setRunTime":if(!b.ext){d&&d(Error("parameters is null"));break}c=parseInt(c);200<c&&(c=200);0>c&&(c=0);this._params.rt=c;a=require("x.hub.m.enocean.js")._deviceHandler;a.deviceParamsUpdated(this,
function(a){d&&d(a)});break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};T.prototype.snyc=function(a,b){if(this._syncRunning)b&&b(Error("sync running"));else{var c=this,d=this._params.rv;d||(d=200);this._syncRunning=!0;this._syncTO=setTimeout(function(){c._syncRunning=!1;c._syncTO=null;c._states.pos={value:0,time:(new Date).getTime()}},1E3*(d+2));this.doReq(a,{TIME:d,CMD:1,LCK:0,TYPE:0},function(a){b&&b(a)})}};T.prototype.doReq=function(a,b,d){var c=this._senderID;this._senderID||
(c=x.hub.m.enocean.SENDER_ID);if(b.TYPE){var f=Math.round(10*b.TIME)>>8&255;var e=Math.round(10*b.TIME)&255}else f=0,e=Math.round(b.TIME)&255;b=new Buffer([f,e,b.CMD,8|(b.LCK&1)<<2|(b.TYPE&1)<<1]);c=new x.hub.m.enocean.ESP3.Telegram.BS4(b,c,0);c.setDstId(this._address);a.sendTelegram(c,!0,function(a){d&&d(a)})};var Rc=function(){var a=function(a){T.call(this,a);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_blind"};a.prototype=new T;a.prototype.constructor=a;a.prototype.handleTeachinTelegram=function(a,
b){if(b&&165==b.rorg&&b.userData){var c=b.userData.toString("hex"),d=a._teachSenderID;if(c&&d&&d.substr(2)==c.substr(0,6))require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:a._teachID,senderID:a._teachSenderID,data:a._teachProfile,vendor:a._teachVendor},{address:b.senderID,senderID:a._teachSenderID,data:a._teachProfile,vendor:a._teachVendor},function(b,c){a._teachFinish(b,c)})}};return a}(),Rb=function(a){Ra.call(this,a);this._data="eltako_weather";this._vendor="eltako";this._eepAlias=
"a5-04-02";this._engMax=7.2;this._engMin=0};Rb.STATES="energy energy_raw humidity humidity_raw temperature temperature_raw available".split(" ");Rb.prototype=new Ra;Rb.prototype.constructor=Rb;Rb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),e=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.energy=parseFloat((a/250*(this._engMax-this._engMin)+this._engMin).toFixed(1)),b.energy_raw=a,b.humidity=parseFloat((e/250*
(this._humMax-this._humMin)+this._humMin).toFixed(1)),b.humidity_raw=e,b.temperature=parseFloat((d/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),b.temperature_raw=d,b.available=c>>1&1?!0:!1)}return b};var Na=function(a){Sa.call(this,a);this._data="eltako_lux";this._vendor="eltako";this._eepAlias="a5-06-01";this._ill1Max=3E4;this._ill1Min=300};Na.STATES="illumination2 illumination2_raw illumination1 illumination1_raw illumination illumination_raw".split(" ");Na.prototype=new Sa;Na.prototype.constructor=
Na;Na.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.illumination2=a,b.illumination2_raw=a,b.illumination1=parseFloat((d/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1)),b.illumination1_raw=d,b.illumination=d?b.illumination1:b.illumination2,b.illumination_raw=d?b.illumination1_raw:b.illumination2_raw)}return b};var Cc=function(a){Ha.call(this,a);this._data=
"eltako_lux2";this._vendor="eltako";this._eepAlias="a5-06-02";this._ill2Min=0;this._ill2Max=1024};Cc.STATES=Ha.STATES;Cc.prototype=new Ha;Cc.prototype.constructor=Cc;var H=function(a){d.call(this,a);this._data="eltako_buttons";this._vendor="eltako";this._eepAlias="f6-02-01";this._longPressThreshold=1E3;this.BUTTONS=["button1","button2","button3","button4"]};H.STATES=["button1","button2","button3","button4"];H.EVENTS=["shortPress","longPress","press","release"];H.prototype=new d;H.prototype.constructor=
H;H.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:this.BUTTONS[0]&&(b[this.BUTTONS[0]]="pressed");break;case 80:this.BUTTONS[1]&&(b[this.BUTTONS[1]]="pressed");break;case 48:this.BUTTONS[2]&&(b[this.BUTTONS[2]]="pressed");break;case 16:this.BUTTONS[3]&&(b[this.BUTTONS[3]]="pressed");break;case 0:for(a=0;a<this.BUTTONS.length;a++)this.BUTTONS[a]&&(b[this.BUTTONS[a]]="released")}return b};H.prototype.checkStateChange=function(a){var b=this._states,c=[],d=(new Date).getTime(),
e;for(e in a){var g={};g.key=e;g.value=a[e];g.changed=!1;var h=b[e]?b[e].value:null,l=b[e]?b[e].time:null,k=a[e];if(h!=k||"pressed"==k)g.oldvalue=h,g.changed=!0;this._states[e]={value:a[e],time:d};g.changed&&("pressed"==k||"released"==k&&"pressed"==h)&&c.push(g);"pressed"==h&&"released"==k&&(!l||d-l<this._longPressThreshold?(g={},g.key=e,g.value="shortPress"):(g={},g.key=e,g.value="longPress"),g.changed=!0,c.push(g))}return c};var Dc=function(a){H.call(this,a);this._data="eltako_button1";this.BUTTONS=
[null,null,null,"button"]};Dc.STATES=["button"];Dc.prototype=new H;Dc.prototype.constructor=Dc;var Ec=function(a){H.call(this,a);this._data="eltako_sender2";this.BUTTONS=["A1","A3"]};Ec.STATES=["A1","A3"];Ec.prototype=new H;Ec.prototype.constructor=Ec;var Fc=function(a){H.call(this,a);this._data="eltako_sender4";this.BUTTONS=["E1","E2","E3","E4"]};Fc.STATES=["E1","E2","E3","E4"];Fc.prototype=new H;Fc.prototype.constructor=Fc;var Gc=function(a){H.call(this,a);this._data="eltako_button2";this.BUTTONS=
["buttonO","buttonI"]};Gc.STATES=["buttonO","buttonI"];Gc.prototype=new H;Gc.prototype.constructor=Gc;var Hc=function(a){H.call(this,a);this._data="eltako_button4";this.BUTTONS=["BO","BI","AO","AI"]};Hc.STATES=["BO","BI","AO","AI"];Hc.prototype=new H;Hc.prototype.constructor=Hc;var Sb=function(a){H.call(this,a);this._data="eltako_fsm60b"};Sb.STATES=["button"];Sb.prototype=new H;Sb.prototype.constructor=Sb;Sb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:case 80:case 16:b.button=
"pressed";break;case 0:b.button="released"}return b};var Tb=function(a){d.call(this,a);this._data="eltako_fkf";this._vendor="eltako";this._eepAlias="f6-04-01"};Tb.STATES=["keycard"];Tb.prototype=new d;Tb.prototype.constructor=Tb;Tb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var Ub=function(a){d.call(this,a);this._data="eltako_fkc";this._vendor="eltako";this._eepAlias="f6-04-01"};Ub.STATES=["keycard"];
Ub.prototype=new d;Ub.prototype.constructor=Ub;Ub.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.keycard="guest_card";case 32:b.keycard="service_card";case 16:b.keycard="inserted";case 0:b.keycard="takeout"}return b};var ua=function(a){Ba.call(this,a);this._data="eltako_thermo";this._vendor="eltako";this._eepAlias="a5-10-06"};ua.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");ua.prototype=new Ba;ua.prototype.constructor=
ua;ua.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),e=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.night_reduce=6>=a?0:12>=a?1:19>=a?2:25>=a?3:31>=a?4:5,b.night_reduce_raw=a,b.setpoint=parseFloat((e/255*40).toFixed(1)),b.setpoint_raw=e,b.temperature=parseFloat(((255-d)/255*40).toFixed(1)),b.temperature_raw=d)}return b};var Vb=function(a){ua.call(this,a);this._data="eltako_ftr65hb";this._vendor="eltako";this._eepAlias=
"a5-10-06"};Vb.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Vb.prototype=new ua;Vb.prototype.constructor=Vb;Vb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.setpoint=parseFloat((a/255*40).toFixed(1)),b.setpoint_raw=a,b.temperature=parseFloat(((255-d)/255*40).toFixed(1)),b.temperature_raw=d)}return b};var Ic=function(a){ua.call(this,a);this._data="eltako_futh65d";this._vendor=
"eltako";this._eepAlias="a5-10-12"};Ic.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");Ic.prototype=new ua;Ic.prototype.constructor=Ic;var Wb=function(a){Ia.call(this,a);this._data="eltako_ftr78s";this._vendor="eltako";this._eepAlias="a5-10-03"};Wb.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"];Wb.prototype=new Ia;Wb.prototype.constructor=Wb;Wb.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),
d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.setpoint=parseFloat((a/255*22+8).toFixed(1)),b.setpoint_raw=a,b.temperature=parseFloat(((255-d)/255*40).toFixed(1)),b.temperature_raw=d)}return b};var ab=function(a){ma.call(this,a);this._data="eltako_powermeter";this._vendor="eltako";this._eepAlias="a5-12-01"};ab.STATES=["power","energy","tariff"];ab.prototype=new ma;ab.prototype.constructor=ab;ab.prototype.evalTelegram=function(a){var b=ma.prototype.evalTelegram.call(this,a);165==
a.rorg&&143==a.userData.readUInt8(3)&&(b={});return b};var Jc=function(a){ma.call(this,a);this._data="eltako_powermeter2";this._vendor="eltako";this._eepAlias="a5-12-01"};Jc.STATES=["power","tariff"];Jc.prototype=new ma;Jc.prototype.constructor=ab;Jc.prototype.evalTelegram=function(a){a=ma.prototype.evalTelegram.call(this,a);delete a.energy;delete a.tariff;return a};var bb=function(a){H.call(this,a);this._data="eltako_fzs"};bb.STATES=["button"];bb.prototype=new H;bb.prototype.constructor=bb;bb.prototype.evalTelegram=
function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.button="pressed";break;case 0:b.button="released"}return b};bb.prototype.checkStateChange=function(a){var b=this._states,c=[],d=(new Date).getTime(),e;for(e in a){var g={};g.key=e;g.value=a[e];g.changed=!1;var h=b[e]?b[e].value:null,l=b[e]?b[e].time:null,k=a[e];h!=k&&(g.oldvalue=h,g.changed=!0);this._states[e]={value:a[e],time:d};g.changed&&c.push(g);"pressed"==h&&"released"==k&&(!l||d-l<this._longPressThreshold?(g={},g.key=e,g.value=
"shortPress"):(g={},g.key=e,g.value="longPress"),g.changed=!0,c.push(g))}return c};var Xb=function(a){h.call(this,a);this._data="eltako_relay2";this._vendor="eltako";this._eepAlias="f6-02-01"};Xb.STATES=["ch1","ch2"];Xb.prototype=new h;Xb.prototype.constructor=Xb;Xb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.ch1="on";break;case 80:b.ch1="off";break;case 48:b.ch2="on";break;case 16:b.ch2="off"}return b};var Yb=function(a){h.call(this,a);this._data="eltako_relay";
this._vendor="eltako";this._eepAlias="f6-02-01"};Yb.STATES=["state"];Yb.prototype=new h;Yb.prototype.constructor=Yb;Yb.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 112:b.state="on";break;case 80:b.state="off"}return b};var Zb=function(a){W.call(this,a);this._data="eltako_heat";this._vendor="eltako";this._eepAlias="a5-30-03"};Zb.STATES=["temperature","temperature_raw","alarm","alarm_raw"];Zb.prototype=new W;Zb.prototype.constructor=Zb;Zb.prototype.evalTelegram=
function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),e=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(c>>3&1)&&(b.temperature=parseFloat(((255-e)/255*40).toFixed(1)),b.temperature_raw=e,b.alarm=15==d?"alarm":"ok",b.alarm_raw=d)}return b};var $b=function(a){W.call(this,a);this._data="eltako_water_m3";this._vendor="eltako";this._eepAlias="a5-30-03"};$b.STATES=["water","water_raw"];$b.prototype=new W;$b.prototype.constructor=$b;$b.prototype.evalTelegram=function(a){var b=
{};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.water=15==a,b.water_raw=a)}return b};var ac=function(a){La.call(this,a);this._data="eltako_water_m4";this._vendor="eltako";this._eepAlias="a5-30-01"};ac.STATES=["water","water_raw"];ac.prototype=new La;ac.prototype.constructor=ac;ac.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);1==(c>>3&1)&&(b.water=0==a,b.water_raw=a)}return b};var va=function(a){J.call(this,
a);this.TEACH_IN_VARIATION=3;this._data="peha_powerswitch";this._vendor="peha";this._eepAlias="a5-38-08"};va.COMMANDS=["on","off","toggle"];va.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");va.prototype=new J;va.prototype.constructor=va;va.prototype.getTeachinType=function(){return"4BS"};va.prototype.evalTelegram=function(a){return Ya.prototype.evalTelegram.call(this,
a)};va.prototype.executeCommand=function(a,b,d){if(b&&b.value){(new Date).getTime();var c=this;switch(b.value){case "on":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:1},function(a){a||c.activeStateChange({state:"on"});d&&d(a)});break;case "off":this.switching(a,{TIM:0,LCK:0,DEL:0,SW:0},function(a){a||c.activeStateChange({state:"off"});d&&d(a)});break;case "toggle":if(!this._states.state){d&&d(Error("unknow previous switch state"));break}"on"==this._states.state.value?this.executeCommand(a,{value:"off"},
d):this.executeCommand(a,{value:"on"},d);break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};var cb=function(a){va.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_switch";this._vendor="peha";this._eepAlias="a5-38-08"};cb.COMMANDS=["on","off","toggle"];cb.STATES="state state_raw level rgb power energy current voltage power_raw power_unit energy_unit current_unit voltage_unit power_unit_raw op_hour error error_raw service_mode op_hour_flag op_hour_flag_raw mode_raw".split(" ");
cb.prototype=new va;cb.prototype.constructor=cb;cb.prototype.evalTelegram=function(a){a=Ya.prototype.evalTelegram.call(this,a);delete a.power;delete a.energy;delete a.current;delete a.voltage;delete a.power_unit;delete a.energy_unit;delete a.current_unit;delete a.voltage_unit;return a};var wa=function(a){J.call(this,a);this.TEACH_IN_VARIATION=3;this._data="peha_blind";this._vendor="peha";this._eepAlias="a5-38-08";this._initCount=0};wa.COMMANDS="up down stop stepUp stepDown moveTo lamellaUp lamellaDown lamellaStepUp lamellaStepDown lamellaTo setRunTime setLamellaRuntime".split(" ");
wa.STATES="position angle position_flag position_flag_raw angle_flag angle_flag_raw error error_raw end_position end_position_raw state state_raw service_mode position_mode".split(" ");wa.prototype=new J;wa.prototype.constructor=wa;wa.prototype.init=function(a){var b=require("x.hub.m.enocean.js")._esp3;this.blind(b,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0},function(b){a&&a()})};wa.prototype.getTeachinType=function(){return"4BS"};wa.prototype.getStatesBuffer=function(){0==Object.keys(this._states).length?
(100>=this._initCount&&0==this._initCount%10?this.init():100<=this._initCount&&600>=this._initCount&&0==this._initCount%60?this.init():this._initCount=0,this._initCount++):this._initCount=0;return this._states};wa.prototype.evalTelegram=function(a){return zb.prototype.evalTelegram.call(this,a)};wa.prototype.executeCommand=function(a,b,d){if(b&&b.value){(new Date).getTime();var c=this;if("stepUp"==b.value.substr(0,6)&&6<b.value.length){var f=b.value.substr(6);b={value:"stepUp",ext:f}}else"stepDown"==
b.value.substr(0,8)&&8<b.value.length?(f=b.value.substr(8),b={value:"stepDown",ext:f}):"setRunTime"==b.value.substr(0,10)&&10<b.value.length?(f=b.value.substr(10),b={value:"setRunTime",ext:f}):"moveTo"==b.value.substr(0,6)&&6<b.value.length&&(f=b.value.substr(6),b={value:"moveTo",ext:f});switch(b.value){case "up":this.blind(a,{P1:0,P2:0,FUNC:2,SSF:0,PAF:0,SMF:0},function(a){d&&d(a)});break;case "down":this.blind(a,{P1:0,P2:0,FUNC:3,SSF:0,PAF:0,SMF:0},function(a){d&&d(a)});break;case "stop":this.blind(a,
{P1:0,P2:0,FUNC:1,SSF:0,PAF:0,SMF:0},function(a){d&&d(a)});break;case "stepUp":f="undefined"==typeof b.ext||null==b.ext?5:parseInt(b.ext);var e=this._states.position?this._states.position.value:null;if("undefined"==typeof e||null==e){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});d&&d(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(f=e+f,100<f&&(f=100)):(f=e-f,0>f&&(f=0));this.blind(a,{P1:f,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||c.activeStateChange({position:f});
d&&d(a)});break;case "stepDown":f="undefined"==typeof b.ext||null==b.ext?5:parseInt(b.ext);e=this._states.position?this._states.position.value:null;if("undefined"==typeof e||null==e){this.blind(a,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0});d&&d(Error("unknown position"));break}this._states.position_mode&&this._states.position_mode.value?(f=e-f,0>f&&(f=0)):(f=e+f,100<f&&(f=100));this.blind(a,{P1:f,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||c.activeStateChange({position:f});d&&d(a)});break;case "moveTo":if("undefined"==
typeof b.ext||null==b.ext){d&&d(Error("value invalid"));break}e=parseInt(b.ext);this.blind(a,{P1:e,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(a){a||c.activeStateChange({position:e});d&&d(a)});break;case "setRunTime":if(!b.ext||-1==b.ext.indexOf(":")){d&&d(Error("value invalid"));break}var g=b.ext.split(":");b=g[0];g=g[1];if(!b&&g)b=g;else if(b&&!g)g=b;else if(!b&&!g){d&&d(Error("value invalid"));break}b=parseInt(b);g=parseInt(g);this.blind(a,{P1:b,P2:g,FUNC:7,SSF:0,PAF:0,SMF:0},function(a){a||c.activeStateChange({position:f});
d&&d(a)});break;default:d&&d(Error("unknow command"))}}else d&&d(Error("command invalid"))};var B=function(a){e.call(this,a);this._data="bb-aa-cc";this._vendor="rehau";this._eepAlias="d2-06-10";this._hopCount=0;this._saLearnMode=1;this._originalEEP="bb-aa-cc";this._reset_pre_alarm_new=this._reset_alarm_new=null;this._deviceTO=this._startTimeoutTimer();this._prealarmTO=this._alarmTO=null};B.COMMANDS="alertOn alertOff alertToggle resetAlarm resetPreAlarm preAlarmOn preAlarmOff preAlarmToggle".split(" ");
B.STATES="battery pre_alarm alarm window pre_alarm_enabled error pending alarm_enabled pre_alarm_enabled_device timeout".split(" ");B.prototype=new e;B.prototype.constructor=B;B.prototype.setDefaultParams=function(){var a=require("x.hub.m.enocean.js")._rehauHandler;if(a){var b=a.getSmartguardSetting(this._address),d=!0,e=!0;b&&(d=b.isAlarmActive(),e=b.isPreAlarmActive());this.activeStateChange({pending:!1,alarm_enabled:d,pre_alarm_enabled:e,timeout:!1,alarm_task_active:a.getAlarm(),pre_alarm_task_active:a.getAlarm()})}};
B.prototype.getStatesBuffer=function(){return this._states};B.prototype.evalData=function(a,b,d){var c=this.evalTelegram(b);if(c){c.timeout=!1;this._deviceTO&&(clearTimeout(this._deviceTO),this._deviceTO=this._startTimeoutTimer());if(208==b.rorg)b=this.checkStateChange(c);else{var f=!1;210==b.rorg&&2==b.userData.length&&(f=!0);b=this.getBufferedState("alarm_task_active");var e=this.getBufferedState("pre_alarm_task_active"),g=this.getBufferedState("alarm_enabled"),h=this.getBufferedState("pre_alarm_enabled");
c.pre_alarm?e?h?this._startPreAlarmTimer():c.pre_alarm=!1:c.pre_alarm=!1:this._clearPreAlarmTimer();c.alarm?b?g?this._startAlarmTimer():c.alarm=!1:c.alarm=!1:this._clearAlarmTimer();b=this.checkStateChange(c);var l=this;this._executePendingCommand(a,function(){l._reportStates(c)},f)}d&&d(null,b)}else d&&d(Error("data format invalid"))};B.prototype.evalTelegram=function(a){var b={},c=!1;if(210==a.rorg){if(1==a.userData.length)c=a.userData.readUInt8(0);else{var d=a.userData.readUInt8(0);c=a.userData.readUInt8(1)}2==
a.userData.length&&(b.battery=d);b.pre_alarm=c>>7&1?!0:!1;b.alarm=c>>6&1?!0:!1;b.window=c>>5&1?"closed":"open";b.pre_alarm_enabled_device=c>>4&1?!0:!1;b.error=c&15;c=!0}else 208==a.rorg&&(c=a.userData.readUInt8(0),b.battery=Math.round(c/100*255),b.battery_raw=c,c=!0);return c?b:null};B.prototype.executeCommand=function(a,b,d){if(b&&b.value){switch(b.value){case "alertOn":this._setAlarm(!0);break;case "alertOff":this._setAlarm(!1);break;case "alertToggle":this._states&&this._states.alarm_enabled?this._setAlarm(!this._states.alarm_enabled.value):
this._setAlarm(!0);break;case "resetAlarm":this._reset_alarm_new="on";this.activeStateChange({pending:!0});break;case "resetPreAlarm":this._reset_pre_alarm_new="on";this.activeStateChange({pending:!0});break;case "preAlarmOn":this._setPreAlarm(!0);break;case "preAlarmOff":this._setPreAlarm(!1);break;case "preAlarmToggle":this._states&&this._states.pre_alarm_enabled?this._setPreAlarm(!this._states.pre_alarm_enabled.value):this.pre_alarm_enabled(!0);break;case "alarmTaskOn":this._setAlarmTask(!0);break;
case "alarmTaskOff":this._setAlarmTask(!1);break;case "preAlarmTaskOn":this._setPreAlarmTask(!0);break;case "preAlarmTaskOff":this._setPreAlarmTask(!1);break;default:d&&d(Error("unknow command"));return}d&&d()}else d&&d(Error("command invalid"))};B.prototype._executePendingCommand=function(a,b,d){var c={AL:1,RSA:0,RSP:0,PAE:1},f=this._isAlarmActive();c.AL=f?1:0;f=this._isPreAlarmActive();c.PAE=f?1:0;this._reset_alarm_new&&(c.RSA="on"==this._reset_alarm_new?1:0);this._reset_pre_alarm_new&&(c.RSP="on"==
this._reset_pre_alarm_new?1:0);var e={pending:!1};1==c.RSP&&(e.pre_alarm=!1);1==c.RSA&&(e.alarm=!1);this._reset_pre_alarm_new=this._reset_alarm_new=null;var g=this;this._sendVLD(a,c,function(a){g.activeStateChange(e);b&&b(a)},d)};B.prototype._sendVLD=function(a,b,d,e){var c=this._senderID;this._senderID||(c=x.hub.m.enocean.SENDER_ID);b=(b.AL&1)<<7|(b.RSA&1)<<6|(b.RSP&1)<<5|(b.PAE&1)<<4;e=e?new Buffer([0,b]):new Buffer([b]);c=new x.hub.m.enocean.ESP3.Telegram.VLD(e,c,0);c.setDstId(this._address);a.sendTelegram(c,
!0,function(a){d&&d(a)})};B.prototype._reportStates=function(a){if(a&&0<Object.keys(a).length){var b=require("x.hub.m.enocean.js").getRehauHandler();b&&(a.alarm_enabled=this.getBufferedState("alarm_enabled"),a.pre_alarm_enabled=this.getBufferedState("pre_alarm_enabled"),b.onReceiveWindowSensorStates(this,a))}};B.prototype._setAlarm=function(a){this.activeStateChange({alarm_enabled:a});require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardAlarm(this._address,a)};B.prototype._setPreAlarm=function(a){this.activeStateChange({pre_alarm_enabled:a});
require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardPreAlarm(this._address,a)};B.prototype._setAlarmTask=function(a){this.activeStateChange({alarm_task_active:a})};B.prototype._setPreAlarmTask=function(a){this.activeStateChange({pre_alarm_task_active:a})};B.prototype._isAlarmActive=function(){var a=!0,b=!0;this._states&&this._states.alarm_enabled&&(b=this._states.alarm_enabled.value,"undefined"==typeof b||null==b)&&(b=!0);if(!b)return!1;this._states&&this._states.alarm_task_active&&(a=this._states.alarm_task_active.value,
"undefined"==typeof a||null==a)&&(a=!1);return a};B.prototype._isPreAlarmActive=function(){var a=!0,b=!0;this._states&&this._states.pre_alarm_enabled&&(b=this._states.pre_alarm_enabled.value,"undefined"==typeof b||null==b)&&(b=!0);if(!b)return!1;this._states&&this._states.pre_alarm_task_active&&(a=this._states.pre_alarm_task_active.value,"undefined"==typeof a||null==a)&&(a=!1);return a};B.prototype._startTimeoutTimer=function(){var a=this;return setTimeout(function(){a.activeStateChange({timeout:!0})},
36E5)};B.prototype._startPreAlarmTimer=function(){this._prealarmTO&&clearTimeout(this._prealarmTO);var a=this;this._prealarmTO=setTimeout(function(){a.activeStateChange({pre_alarm:!1});var b=a.getCurrentStates();a._reportStates(b)},1E4)};B.prototype._clearPreAlarmTimer=function(){this._prealarmTO&&(clearTimeout(this._prealarmTO),this._prealarmTO=null)};B.prototype._startAlarmTimer=function(){this._alarmTO&&clearTimeout(this._alarmTO);var a=this;this._alarmTO=setTimeout(function(){a.activeStateChange({alarm:!1});
var b=a.getCurrentStates();a._reportStates(b)},12E4)};B.prototype._clearAlarmTimer=function(){this._alarmTO&&(clearTimeout(this._alarmTO),this._alarmTO=null)};B.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params,hopCount:this._hopCount,saLearnMode:this._saLearnMode,originalEEP:this._originalEEP}};B.prototype.fromJSON=function(a){if(!a||!a.address||!a.data||a.data!=this._data)return null;
this._address=a.address;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();return this};B.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual,hopCount:this._hopCount,saLearnMode:this._saLearnMode,
originalEEP:this._originalEEP}};B.prototype.fromDBJSON=function(a){if(!a||!a.id||!a.eep||a.eep!=this._data)return null;this._address=a.id;this._senderID=a.senderID;this._vendor=a.vendor?a.vendor:this._vendor;this._virtual=a.virtual?!0:!1;this._params=a.params;this._hopCount=a.hopCount;this._saLearnMode=a.saLearnMode;a.originalEEP&&(this._originalEEP=a.originalEEP);this.setDefaultParams();return this};var Nc=function(a){B.call(this,a);this._data="d2-06-10"};Nc.prototype=new B;Nc.prototype.constructor=
Nc;var Kc=function(a){B.call(this,a);this._data="d2-06-ff"};Kc.prototype=new B;Kc.prototype.constructor=Kc;Kc.prototype.evalTelegram=function(a){var b={},c=!1;if(210==a.rorg){if(1==a.userData.length)c=a.userData.readUInt8(0);else{var d=a.userData.readUInt8(0);c=a.userData.readUInt8(1)}2==a.userData.length&&(b.battery=d);a=c>>2&3;b.pre_alarm=c>>7&1?!0:!1;b.alarm=c>>6&1?!0:!1;b.window=a?"closed":"open";b.pre_alarm_enabled_device=c>>4&1?!0:!1;0==a?b.window="closed":1==a?b.window="tilted":3==a&&(b.window=
"open");c=!0}else 208==a.rorg&&(c=a.userData.readUInt8(0),b.battery=c,c=!0);return c?b:null};var Lc=function(a){W.call(this,a);this._data="afriso_water_con";this._vendor="afriso";this._eepAlias="a5-30-03"};Lc.prototype=new W;Lc.prototype.constructor=Lc;Lc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.temperature=(255-a)/255*40,b.temperature_raw=a,b.water=0==(d>>4&1)?!0:!1)}return b};var bc=
function(a){w.call(this,a);this._data="afriso_water_eco";this._vendor="afriso";this._eepAlias="f6-05-01"};bc.prototype=new w;bc.prototype.constructor=bc;bc.prototype.evalTelegram=function(a){var b={};246==a.rorg&&(a=a.nu,1==a?b.water="true":0==a&&(b.water="false"));return b};bc.prototype.onLearn=function(){this._states.water={value:!1,time:(new Date).getTime()}};var Mc=function(a){W.call(this,a);this._data="afriso_asd_10";this._vendor="afriso";this._eepAlias="a5-30-03"};Mc.prototype=new W;Mc.prototype.constructor=
Mc;Mc.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2);a=a.userData.readUInt8(1);1==(c>>3&1)&&(b.temperature=(255-a)/255*40,b.temperature_raw=a,b.smoke=0==(d>>4&1)?!0:!1)}return b};var cc=function(a){O.call(this,a);this._data="hoppe_door";this._vendor="hoppe";this._eepAlias="f6-10-00"};cc.STATES=["door"];cc.prototype=new O;cc.prototype.constructor=cc;cc.prototype.evalTelegram=function(a){var b={};246==a.rorg&&(a=a.userData,0==(a&208^
192)?b.door="open":0==(a&240^240)&&(b.door="closed"),b.handle_raw=a);return b};var Pc=function(){var a=function(a){e.call(this,a);this._data="gp";this._gpInfo=null};a.prototype=new e;a.prototype.constructor=a;a.prototype.toJSON=function(){var a=e.prototype.toJSON.call(this);a.gpInfo=this._gpInfo;return a};a.prototype.fromJSON=function(a){if(!e.prototype.fromJSON.call(this,a))return null;a&&a.gpInfo&&(this._gpInfo=a.gpInfo);return this};a.prototype.toDBJSON=function(){var a=e.prototype.toDBJSON.call(this);
a.gpInfo=this._gpInfo;return a};a.prototype.fromDBJSON=function(a){if(!e.prototype.fromDBJSON.call(this,a))return null;a&&a.gpInfo&&(this._gpInfo=a.gpInfo);return this};return a}(),Sc=function(){var a=function(a){Pc.call(this,a);this._data="afriso_ais_10";this._vendor="afriso";this._eepAlias="gp"};a.prototype=new Pc;a.prototype.constructor=a;a.prototype.isGPMatch=function(a,b){return 45!=a?!1:8==b};a.prototype.evalTelegram=function(a){var b={};if(178==a.rorg){var c=a.data.readUInt8(0)>>7&1,d=a.data.readUInt8(0)>>
6&1;a=a.data.readUInt8(0)>>5&1;b.alarm=1==c?"on":"off";b.active=1==d?"on":"off";b.powerAlarm=1==a?"alarm":"no_change"}return b};a.prototype.executeCommand=function(a,b,c){if(b&&b.value){switch(b.value){case "arming":this._setActive(a,!0,c);break;case "disarming":this._setActive(a,!1,c);break;case "toggleArming":this._states&&this._states.active?this._setActive(a,"off"==this._states.active.value,c):this._setActive(a,!0,c);break;case "alarmOn":this._setAlarm(a,!0,c);break;case "alarmOff":this._setAlarm(a,
!1,c);break;case "toggleAlarm":this._states&&this._states.alarm?this._setAlarm(a,"off"==this._states.alarm.value,c):this._setAlarm(a,!1,c);break;default:c&&c(Error("unknow command"));return}c&&c()}else c&&c(Error("command invalid"))};a.prototype._setActive=function(a,b,c){var d=!1;this._states&&this._states.alarm&&"on"==this._states.alarm.value&&(d=!0);this._sendGPCD(a,d,b,c)};a.prototype._setAlarm=function(a,b,c){var d=!0;this._states&&this._states.active&&"off"==this._states.active.value&&(d=!1);
this._sendGPCD(a,b,d,c)};a.prototype._sendGPCD=function(a,b,c,d){var f=this._senderID;this._senderID||(f=x.hub.m.enocean.SENDER_ID);var e=0;b&&(e|=128);c&&(e|=64);b=new Buffer(1);b.writeUInt8(e,0);f=new x.hub.m.enocean.ESP3.Telegram.GP_CD(b,f,0);f.setDstId(this._address);a.sendTelegram(f,!0,function(a){d&&d(a)})};return a}(),xa=function(){var a=function(a){da.call(this,a);this._data="eltako_tf_ttb";this._vendor="eltako";this._eepAlias="a5-07-01";this._params={reset_timeout:300}};a.prototype=new da;
a.prototype.constructor=a;a.prototype.evalTelegram=function(a){return 246==a.rorg?l.prototype.evalTelegram.call(this,a):165==a.rorg?da.prototype.evalTelegram.call(this,a):{}};a.prototype.checkStateChange=function(a){return a.button?l.prototype.checkStateChange.call(this,a):da.prototype.checkStateChange.call(this,a)};a.prototype.fromJSON=function(a){da.prototype.fromJSON.call(this,a);this._params={reset_timeout:300};return this};var b=function(a){W.call(this,a);this._data="eltako_tf_smoke";this._vendor=
"eltako";this._eepAlias="a5-30-03"};b.STATES=["temperature","temperature_raw","smoke","smoke_raw"];b.prototype=new W;b.prototype.constructor=b;b.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),f=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(c>>3&1)&&(b.temperature=parseFloat(((255-f)/255*40).toFixed(1)),b.temperature_raw=f,b.smoke=15==d?!0:!1,b.smoke_raw=d)}return b};var d=function(a){O.call(this,a);this._data="eltako_tf_contact";
this._vendor="eltako";this._eepAlias="d5-00-01"};d.STATES=["contact","contact_raw","voltage","voltage_raw"];d.prototype=new N;d.prototype.constructor=d;d.prototype.evalTelegram=function(a){var b={};if(213==a.rorg){var c=a.userData;1==(c>>3&1)&&(c&=1,b.contact=c?"closed":"open",b.contact_raw=c)}else if(165==a.rorg){c=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);1==(c>>3&1)&&(b.voltage=parseFloat(d/255*5).toFixed(1),b.voltage_raw=d,b.energy=
parseFloat(a/255*5).toFixed(1),b.energy_raw=a)}return b};var e=function(a){Ma.call(this,a);this._data="eltako_motion2";this._vendor="eltako";this._eepAlias="a5-08-01"};e.STATES="voltage voltage_raw illumination illumination_raw state state_raw".split(" ");e.prototype=new Ma;e.prototype.constructor=e;e.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a.userData.readUInt8(2);var d=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1)){b.voltage=parseFloat((a/
255*5.1).toFixed(1));b.voltage_raw=a;b.illumination=parseFloat((d/255*510).toFixed(1));b.illumination_raw=d;switch(c){case 13:b.state="on";break;case 15:b.state="off"}b.motion_raw=c}}return b};var g=function(a){da.call(this,a);this._data="eltako_tf_motion";this._vendor="eltako";this._eepAlias="a5-07-01"};g.STATES=["motion","motion_raw"];g.prototype=new da;g.prototype.constructor=g;g.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3);a=a.userData.readUInt8(2);
1==(c>>3&1)&&(b.motion=200==a||255==a?!0:!1,b.motion_raw=a)}return b};var h=function(a){J.call(this,a);this._data="eltako_tf_input";this._vendor="eltako";this._eepAlias="a5-38-08"};h.STATES=["state","state_raw"];h.prototype=new J;h.prototype.constructor=h;h.prototype.evalTelegram=function(a){var b={};165==a.rorg&&(a=a.userData.readUInt8(3),1==(a>>3&1)&&(b.input=8==a?!1:!0,b.input_raw=a));return b};var k=function(a){Ba.call(this,a);this._data="eltako_tf_thermo";this._vendor="eltako";this._eepAlias=
"a5-10-06"};k.STATES="setpoint setpoint_raw temperature temperature_raw night_reduce night_reduce_raw".split(" ");k.prototype=new ua;k.prototype.constructor=k;k.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),f=a.userData.readUInt8(1);a.userData.readUInt8(0);1==(c>>3&1)&&(b.setpoint=parseFloat((f/255*40).toFixed(1)),b.setpoint_raw=f,b.temperature=parseFloat(((255-d)/255*40).toFixed(1)),b.temperature_raw=d)}return b};var n=function(a){Na.call(this,
a);this._data="eltako_tf_lux"};n.prototype=new Na;n.prototype.constructor=n;var q=function(a){J.call(this,a);this._data="eltako_dimmer_knob";this._vendor="eltako";this._eepAlias="a5-38-08"};q.STATES=["state","dimmerLevel"];q.prototype=new J;q.prototype.constructor=q;q.prototype.evalTelegram=function(a){var b={};if(165==a.rorg){var c=a.userData.readUInt8(3),d=a.userData.readUInt8(2),f=a.userData.readUInt8(1);a=a.userData.readUInt8(0);if(1==(c>>3&1))switch(a){case 2:b.dimmerLevel=f,b.ramp=d,b.dim_range=
c>>2&1?"relative":"absolute",b.store_final_value=c>>1&1,b.state=c&1?"on":"off"}}return b};var m=function(a){Oc.call(this,a);this.TEACH_IN_VARIATION=3;this._data="eltako_tf_alarm"};m.prototype=new Oc;m.prototype.constructor=m;m.prototype.evalTelegram=function(a){var b={};if(246==a.rorg)switch(a.userData){case 48:b.active=!0;break;case 16:b.active=!1}else 165==a.rorg&&(a=a.userData.readUInt8(3),8==a?b.alarm="ok":9==a&&(b.alarm="alarm"));return b};m.prototype.executeCommand=function(a,b,c){if(b&&b.value){var d=
null;switch(b.value){case "triggerAlarm":d=new Buffer([1,0,0,9]);break;case "deactivate":d=new Buffer([1,0,0,12]);break;case "activate":d=new Buffer([1,0,0,8]);break;default:c&&c(Error("unknow command"))}b=this._senderID;this._senderID||(b=x.hub.m.enocean.SENDER_ID);d=new x.hub.m.enocean.ESP3.Telegram.BS4(d,b,0);d.setDstId(this._address);a.sendTelegram(d,!0,function(a){c&&c(a)})}else c&&c(Error("command invalid"))};var p=function(a){H.call(this,a);this._data="eltako_f6t";this._vendor="eltako";this.BUTTONS=
"buttonCO buttonCI buttonBO buttonBI buttonAO buttonAI".split(" ")};p.STATES="buttonCO buttonCI buttonBO buttonBI buttonAO buttonAI".split(" ");p.prototype=new H;p.prototype.constructor=p;p.prototype.evalTelegram=function(a){var b={};if(246==a.rorg){var c=parseInt(this._address,16),d=a.senderID?parseInt(a.senderID,16):null;if(d&&d==c+1)switch(a.userData){case 112:b.buttonCI="pressed";break;case 80:b.buttonCO="pressed";break;case 0:for(a=0;a<this.BUTTONS.length;a++)this.BUTTONS[a]&&(b[this.BUTTONS[a]]=
"released")}else switch(a.userData){case 112:b.buttonAI="pressed";break;case 80:b.buttonAO="pressed";break;case 48:b.buttonBI="pressed";break;case 16:b.buttonBO="pressed";break;case 0:for(a=0;a<this.BUTTONS.length;a++)this.BUTTONS[a]&&(b[this.BUTTONS[a]]="released")}}return b};return{TF_TTB:a,TF_RWB:b,TF_FKB:d,TF_BHSB:g,TF_BHSB_FBH:e,TF_Input:h,TF_Thermo:k,TF_Lux:n,Dimmer_Knob:q,TF_Alarm:m,Eltako_F6T:p}}();return{"f6-??-??":d,"f6-01-01":l,"f6-02-01":h,"f6-02-02":k,"f6-02-03":n,"f6-02-04":q,"f6-03-01":p,
"f6-03-02":u,"f6-04-01":E,"f6-04-02":y,"f6-05-00":C,"f6-05-01":w,"f6-05-02":A,"f6-10-00":O,"f6-10-01":U,"d5-xx-xx":a,"d5-??-??":X,"d5-00-01":N,"f6-so-da":g,"a5-??-??":t,"a5-02-01":Y,"a5-02-02":K,"a5-02-03":oa,"a5-02-04":M,"a5-02-05":P,"a5-02-06":ca,"a5-02-07":Z,"a5-02-08":aa,"a5-02-09":Qa,"a5-02-0a":v,"a5-02-0b":z,"a5-02-10":Oa,"a5-02-11":dc,"a5-02-12":Pa,"a5-02-13":ec,"a5-02-14":fc,"a5-02-15":Ga,"a5-02-16":gc,"a5-02-17":db,"a5-02-18":hc,"a5-02-19":ic,"a5-02-1a":jc,"a5-02-1b":kc,"a5-02-20":Fa,"a5-02-30":lc,
"a5-04-01":mc,"a5-04-02":Ra,"a5-04-03":eb,"a5-06-01":Sa,"a5-06-02":Ha,"a5-06-03":fb,"a5-06-04":gb,"a5-06-05":nc,"a5-07-01":da,"a5-07-02":Ta,"a5-07-03":Ua,"a5-08-01":Va,"a5-08-02":oc,"a5-08-03":pc,"a5-09-02":hb,"a5-09-04":ib,"a5-09-05":jb,"a5-09-06":kb,"a5-09-07":lb,"a5-09-08":mb,"a5-09-09":nb,"a5-09-0a":ob,"a5-09-0b":pb,"a5-09-0c":qb,"a5-10-01":D,"a5-10-02":la,"a5-10-03":Ia,"a5-10-04":rb,"a5-10-05":sb,"a5-10-06":Ba,"a5-10-07":tb,"a5-10-08":pa,"a5-10-09":qa,"a5-10-0a":Ca,"a5-10-0b":Ja,"a5-10-0c":ub,
"a5-10-0d":vb,"a5-10-10":Q,"a5-10-11":Da,"a5-10-12":wb,"a5-10-13":xb,"a5-10-14":yb,"a5-12-00":Ab,"a5-12-01":ma,"a5-12-02":Ka,"a5-12-03":qc,"a5-13-01":rc,"a5-13-02":sc,"a5-13-03":tc,"a5-13-04":uc,"a5-13-05":vc,"a5-13-06":wc,"a5-14-01":Bb,"a5-14-02":Cb,"a5-14-03":Db,"a5-14-04":Eb,"a5-14-05":Fb,"a5-14-06":Gb,"a5-14-07":Hb,"a5-14-08":Ib,"a5-14-09":Jb,"a5-14-0a":Kb,"a5-20-04":ja,"a5-30-01":La,"a5-30-02":Lb,"a5-30-03":W,"a5-30-04":Mb,"a5-38-08":J,"d2-??-??":fa,"d2-01-00":na,"d2-01-01":Nb,"d2-01-03":Ob,
"d2-01-11":Ea,"d2-01-13":ra,"d2-01-14":sa,"d2-05-00":S,"d2-05-01":ta,"d2-06-01":za,"d2-06-02":Aa,"d2-06-10":Nc,"d2-06-ff":Kc,"d2-06-50":b,"d2-20-00":ba,eltako_dimmer:I,eltako_dimmer2:$a,eltako_fsud:Qb,eltako_motion:Ma,eltako_contact:Pb,eltako_weather:Rb,eltako_lux:Na,eltako_lux2:Cc,eltako_sender2:Ec,eltako_sender4:Fc,eltako_button1:Dc,eltako_button2:Gc,eltako_button4:Hc,eltako_blind:T,eltako_fsm60b:Sb,eltako_fkf:Tb,eltako_fkc:Ub,eltako_thermo:ua,eltako_ftr65hb:Vb,eltako_futh65d:Ic,eltako_ftr78s:Wb,
eltako_powermeter:ab,eltako_powermeter2:Jc,eltako_fzs:bb,eltako_switch:ka,eltako_relay:Yb,eltako_relay2:Xb,eltako_heat:Zb,eltako_water_m3:$b,eltako_water_m4:ac,eltako_tf_switch:Oc,eltako_tf_dimmer:Qc,eltako_tf_blind:Rc,peha_switch:cb,peha_powerswitch:va,peha_blind:wa,"bb-aa-cc":B,afriso_water_con:Lc,afriso_water_eco:bc,afriso_asd_10:Mc,hoppe_door:cc,gp:Pc,afriso_ais_10:Sc,eltako_tf_ttb:xa.TF_TTB,eltako_tf_smoke:xa.TF_RWB,eltako_tf_contact:xa.TF_FKB,eltako_tf_motion:xa.TF_BHSB,eltako_motion2:xa.TF_BHSB_FBH,
eltako_tf_thermo:xa.TF_Thermo,eltako_tf_input:xa.TF_Input,eltako_tf_lux:xa.TF_Lux,eltako_dimmer_knob:xa.Dimmer_Knob,eltako_tf_alarm:xa.TF_Alarm,eltako_f6t:xa.Eltako_F6T,parseDBJson:function(a){if(!a||!a.eep)return null;var b=this[a.eep];if(!b)return null;b=new b;return b=b.fromDBJSON(a)},parseJson:function(a){if(!a||!a.data)return null;var b=this[a.data];if(!b)return null;b=new b;return b=b.fromJSON(a)}}}();
x.hub.m.enocean.SiegeniaHandler=function(){var e=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SiegeniaHandler");this._esp3=b;this._calibateListener=this._window=this._windowID=this._esp3Listener=null};e.prototype.startCalibateWindow=function(b,a){if(this._calibateListener)a&&a(Error("configuraion of window running"));else{this._calibateListener=a;this._windowID=b;this._window=new x.hub.m.enocean.profiles["d2-06-50"];var e=this;this._esp3Listener={_onEOTelegram:function(a){var b=
!1;e._windowID&&e._windowID==a.senderID?b=!0:e._windowID||210!=a.rorg||(b=!0);b&&e._calibateListener&&(b=e._window.evalTelegram(a))&&17==b.type&&e._calibateListener(null,a.senderID,b)}};this._esp3.addListener(this._esp3Listener)}};e.prototype.stopCalibateWindow=function(){this._esp3Listener&&this._esp3.removeListener(this._esp3Listener);this._window=this._windowID=this._calibateListener=this._esp3Listener=null};e.prototype.configWindow=function(b,a,e,d){a="FFFFFFFF";d||(d=x.hub.m.enocean.SENDER_ID);
this._logger.log("info","config siegenia window:"+JSON.stringify(b));this._logger.log("info","window id:"+a+" sender id:"+d);var g=parseInt(b.alive),h=parseInt(b.sync),k=parseInt(b.eep),n=parseInt(b.type),q=parseInt(b.alarm);b=parseInt(b.alarm_sens);var p=[128,2,127,240,1,140,57,45,245],u=[192,13,127,242,49,0,0,2,g>>8&255],E=[193,g&255,0,1,2,h>>8&255,h&255,0,2],y=[194,1,k,0,3,1,n,0,4],C=[195,1,q,0,5,1,b,0,0],w=[128,2,127,240,2,140,57,45,245],A=this;this._logger.log("info","send config siegenia window (data1):"+
(new Buffer(p)).toString("hex"));this._esp3._recomm.sendRawSysEx(new Buffer(p),a,d,function(b){if(b&&(A._logger.log("warn","config siegenia window error (data1):"+b.message+" ["+b.code+"]"),100!=b.code)){e&&e(b);return}A._logger.log("info","send config siegenia window (data2):"+(new Buffer(u)).toString("hex"));A._esp3._recomm.sendRawSysEx(new Buffer(u),a,d,function(b){if(b&&(A._logger.log("warn","config siegenia window error (data2):"+b.message+" ["+b.code+"]"),100!=b.code)){e&&e(b);return}A._logger.log("info",
"send config siegenia window (data3):"+(new Buffer(E)).toString("hex"));A._esp3._recomm.sendRawSysEx(new Buffer(E),a,d,function(b){if(b&&(A._logger.log("warn","config siegenia window error (data3):"+b.message+" ["+b.code+"]"),100!=b.code)){e&&e(b);return}A._logger.log("info","send config siegenia window (data4):"+(new Buffer(y)).toString("hex"));A._esp3._recomm.sendRawSysEx(new Buffer(y),a,d,function(b){if(b&&(A._logger.log("warn","config siegenia window error (data4):"+b.message+" ["+b.code+"]"),
100!=b.code)){e&&e(b);return}A._logger.log("info","send config siegenia window (data5):"+(new Buffer(C)).toString("hex"));A._esp3._recomm.sendRawSysEx(new Buffer(C),a,d,function(b){if(b&&(A._logger.log("warn","config siegenia window error (data5):"+b.message+" ["+b.code+"]"),100!=b.code)){e&&e(b);return}A._logger.log("info","send config siegenia window (data6):"+(new Buffer(w)).toString("hex"));A._esp3._recomm.sendRawSysEx(new Buffer(w),a,d,function(a){a&&A._logger.log("warn","config siegenia window error (data5):"+
a.message+" ["+a.code+"]");a&&100!=a.code?e&&e(a):e&&e()})})})})})})};return e}();
x.hub.m.enocean.RehauHandler=function(){var e=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.InoventAccessory");this._inoventID=a;this._co2SensorID=this._humiditySensorID=null;this._co2RegulationActive=this._humRegulationActive=!1;this._humidityState=null;this._humidityLevel=0;this._co2State=null;this._co2Level=0};e.prototype.getHumiditySensorID=function(){return this._humiditySensorID};e.prototype.setHumiditySensorID=function(a){this._humiditySensorID=a};
e.prototype.getCo2SensorID=function(){return this._co2SensorID};e.prototype.setCo2SensorID=function(a){this._co2SensorID=a};e.prototype.activateSensorRegulation=function(a){if(5==a)this._humRegulationActive=!0,this._co2RegulationActive=!1;else if(6==a)this._humRegulationActive=!1,this._co2RegulationActive=!0;else{this._co2RegulationActive=this._humRegulationActive=!1;return}this._co2Level=this._humidityLevel=0;this._humRegulationActive&&this._humiditySensorID&&null!=this._humidityState&&this.executeHumidityRegulation(this._humidityState);
this._co2RegulationActive&&this._co2SensorID&&null!=this._co2State&&this.executeCo2Regulation(this._co2State)};e.prototype.deactivateSensorRegulation=function(){this._co2RegulationActive=this._humRegulationActive=!1;this._co2Level=this._humidityLevel=0};e.prototype.executeHumidityRegulation=function(a){this._humidityState=a;this._logger.log("trace","["+this._inoventID+"] receive hum:"+a);if(this._humRegulationActive){var b=this._calculateHumidityLevel(a);this._logger.log("trace","["+this._inoventID+
"] target level:"+b);(!this._humidityLevel||b!=this._humidityLevel&&this._exceedHumidityHysteresis(this._humidityLevel,a))&&this._changeHumLevel(b)}};e.prototype._calculateHumidityLevel=function(a){return 50>=a?1:60>=a?2:70>=a?3:4};e.prototype._exceedHumidityHysteresis=function(a,b){switch(a){case 1:return 55<=b;case 2:return 45>=b||65<=b;case 3:return 55>=b||75<=b;case 4:return 65>=b}};e.prototype._changeHumLevel=function(a){var b=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},
{value:"setHumLevel"+a},function(d){d&&d.error||(b._humidityLevel=a)})};e.prototype.executeCo2Regulation=function(a){this._co2State=a;this._logger.log("trace","["+this._inoventID+"] receive co2:"+a);if(this._co2RegulationActive){var b=this._calculateCo2Level(a);this._logger.log("trace","["+this._inoventID+"] target level:"+b);(!this._co2Level||b!=this._co2Level&&this._exceedCo2Hysteresis(this._co2Level,a))&&this._changeCo2Level(b)}};e.prototype._calculateCo2Level=function(a){return 600>=a?1:1E3>=
a?2:1500>=a?3:4};e.prototype._exceedCo2Hysteresis=function(a,b){switch(a){case 1:return 700<=b;case 2:return 500>=b||1100<=b;case 3:return 900>=b||1600<=b;case 4:return 1400>=b}};e.prototype._changeCo2Level=function(a){var b=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setCo2Level"+a},function(d){d&&d.error||(b._co2Level=a)})};e.prototype.toJSON=function(){return{humidity:this._humiditySensorID,co2:this._co2SensorID}};e.prototype.fromJSON=function(a){a&&(this._humiditySensorID=
a.humidity,this._co2SensorID=a.co2)};var b=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.WindowAlarm");this._handler=a;this._active=!1;this._sensors={}};b.prototype.setAlarm=function(a){this._logger.log("trace","set alarm active:"+a);this._active=a};b.prototype.getAlarm=function(){return this._active};b.prototype.onReceiveWindowSensorStates=function(a,b){this._logger.log("trace","receive window:"+a.getAddress()+" states:"+JSON.stringify(b));if(this._active){var d=
a.getAddress(),e=this._sensors[d];e||(this._sensors[d]={lastEvent:"IDLE"},e=this._sensors[d]);this._logger.log("trace","last event for window:"+a.getAddress()+" is:"+e.lastEvent);b&&(b.pre_alarm&&"PRE_ALARM"!=e.lastEvent?(e.lastEvent="PRE_ALARM",this._logger.log("trace","window:"+a.getAddress()+" pre_alarm triggered"),this.triggerAlarm(!0)):b.alarm&&"ALARM"!=e.lastEvent?(e.lastEvent="ALARM",this._logger.log("trace","window:"+a.getAddress()+" alarm triggered"),this.triggerAlarm()):b.alarm||b.pre_alarm||
(this._logger.log("trace","new event for window:"+a.getAddress()+" is:IDLE and stop timer"),e.lastEvent="IDLE"))}};b.prototype.triggerAlarm=function(a){require("x.hub.taskman.js").getRehauAlarmTaskManager().onWindowSensorAlarmTriggered(a)};var a=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.SmartguardSetting");this._smartguardID=a;this._prealarmActive=this._alarmActive=!0};a.prototype.isAlarmActive=function(){return this._alarmActive?!0:!1};a.prototype.isPreAlarmActive=
function(){return this._prealarmActive?!0:!1};a.prototype.setAlarm=function(a){this._alarmActive=a?!0:!1};a.prototype.setPreAlarm=function(a){this._prealarmActive=a?!0:!1};a.prototype.toJSON=function(){return{alarm:this._alarmActive,pre_alarm:this._prealarmActive}};a.prototype.fromJSON=function(a){a&&(this._alarmActive=a.alarm,this._prealarmActive=a.pre_alarm)};var g=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler");this._mainHandler=null;this._windowAlarm=new b(this);
this._inoventAccessories={};this._smartguardSettings={}};g.prototype.REHAU_FILE="enocean_rehau.json";g.prototype.init=function(a,b){this._logger.log("trace","init");var d=this;if(this._mainHandler=a)if(a=a.getDeviceHandler())a.on("deleteDevice",function(a){d.onDeleteDevice(a)});this._loadInoventAccessories(function(a,e,g){a&&d._logger.log("warn","init error:"+a.message);e&&(d._inoventAccessories=e);g&&(d._smartguardSettings=g);b&&b()})};g.prototype.getInoventAccessory=function(a){return a?this._inoventAccessories[a]:
null};g.prototype.deleteInoventAccessory=function(a,b){a&&this._inoventAccessories[a]?(delete this._inoventAccessories[a],this._saveData(b)):b&&b()};g.prototype.getSmartguardSetting=function(a){return a?this._smartguardSettings[a]:null};g.prototype.deleteSmartguardSetting=function(a,b){a&&this._smartguardSettings[a]?(delete this._smartguardSettings[a],this._saveData(b)):b&&b()};g.prototype.setHumidityAccessory=function(a,b,g){if(a){var d=this.getInoventAccessory(a);d||(d=new e(a),this._inoventAccessories[a]=
d);if(b&&"string"==typeof b&&"{"==b.charAt(0))try{b=JSON.parse(b)}catch(n){g&&g(Error("invalid humiditySensorID json: "+n.message));return}d.setHumiditySensorID(b);this._saveData(g)}else g&&g(Error("inoventID is null"))};g.prototype.setCo2Accessory=function(a,b,g){if(a){var d=this.getInoventAccessory(a);d||(d=new e(a),this._inoventAccessories[a]=d);d.setCo2SensorID(b);this._saveData(g)}else g&&g(Error("inoventID is null"))};g.prototype.activateSensorRegulation=function(a,b){(a=this.getInoventAccessory(a))&&
a.activateSensorRegulation(b)};g.prototype.deactivateSensorRegulation=function(a){(a=this.getInoventAccessory(a))&&a.deactivateSensorRegulation()};g.prototype.isWindowOpen=function(){var a=this._mainHandler.getDeviceHandler(),b=a.findDeviceWithData("bb-aa-cc"),e=a.findDeviceWithData("d2-06-10");a=a.findDeviceWithData("d2-06-ff");e&&(b=b.concat(e));a&&(b=b.concat(a));e=!1;for(a=0;a<b.length;a++){var g=b[a];if(g&&"open"==g.getBufferedState("window")){e=!0;break}}return e};g.prototype.setAlarm=function(a,
b){this._windowAlarm.setAlarm(a);var d=this._mainHandler.getDeviceHandler(),e=d.findDeviceWithData("bb-aa-cc"),g=d.findDeviceWithData("d2-06-10");d=d.findDeviceWithData("d2-06-ff");g&&(e=e.concat(g));d&&(e=e.concat(d));g=this._mainHandler.getESP3();for(d=0;d<e.length;d++){var l=e[d];l&&(l.executeCommand(g,{value:a?"alarmTaskOn":"alarmTaskOff"}),l.executeCommand(g,{value:a?"preAlarmTaskOn":"preAlarmTaskOff"}))}b&&b()};g.prototype.getAlarm=function(){return this._windowAlarm.getAlarm()};g.prototype.setSmartGuardAlarm=
function(b,e,g){if(b){var d=this._smartguardSettings[b];d||(d=new a(b),this._smartguardSettings[b]=d);d.setAlarm(e);this._saveData(g)}else g&&g(Error("smartguardID invalid"))};g.prototype.setSmartGuardPreAlarm=function(b,e,g){if(b){var d=this._smartguardSettings[b];d||(d=new a(b),this._smartguardSettings[b]=d);d.setPreAlarm(e);this._saveData(g)}else g&&g(Error("smartguardID invalid"))};g.prototype.onReceiveWindowSensorStates=function(a,b){this._windowAlarm.onReceiveWindowSensorStates(a,b)};g.prototype.onDeleteDevice=
function(a){if(a&&(a=a.getAddress()))if(this.getInoventAccessory(a))this.deleteInoventAccessory(a);else if(this.getSmartguardSetting(a))this.deleteSmartguardSetting(a);else{var b=!1,d;for(d in this._inoventAccessories){var e=this._inoventAccessories[d];e&&(e.getHumiditySensorID()==a&&(e.setHumiditySensorID(null),b=!0),e.getCo2SensorID()==a&&(e.setCo2SensorID(null),b=!0))}b&&this._saveData()}};g.prototype.onDeviceEvent=function(a,b){var d=function(a){for(var b=null,d=0;d<a.length;d++){var e=a[d];if(e&&
"humidity"==e.key){b=e.value;break}}return b},e=function(a){for(var b=null,d=0;d<a.length;d++){var e=a[d];if(e&&"co2"==e.key){b=e.value;break}}return b};if(a){var g="ENOCEAN";a.getType&&(g=a.getType());g||(g="ENOCEAN");var l=a.getAddress();if(l)if("HM"==g){if(b){this._logger.log("trace","process homematic device ("+l+") events:"+JSON.stringify(b));for(var p in this._inoventAccessories)if(a=this._inoventAccessories[p])(d=a.getHumiditySensorID())&&d.key&&d.address==l&&(g=b[d.key],void 0!=g&&null!=g&&
a.executeHumidityRegulation(g)),(d=a.getHumiditySensorID())&&d.key&&d.address==l&&(g=b[d.key],void 0!=g&&null!=g&&a.executeCo2Regulation(g))}}else if("ENOCEAN"==g&&a.getData){this._logger.log("trace","process enocean device ("+l+") events:"+JSON.stringify(b));g=null;switch(a.getData()){case "a5-04-01":case "a5-04-03":case "a5-10-12":g=d(b);break;case "a5-09-08":case "a5-09-09":g=e(b);break;default:return}if(void 0!=g&&null!=g)for(p in this._inoventAccessories)if(a=this._inoventAccessories[p])a.getHumiditySensorID()==
l&&a.executeHumidityRegulation(g),a.getCo2SensorID()==l&&a.executeCo2Regulation(g)}}};g.prototype._loadInoventAccessories=function(a){var b=this;this._loadFile(function(d,e){d?a&&a(d):(d=b._jsonToAccessoriesMap(e),e=b._jsonToSmartGuardSettingsMap(e),a&&a(null,d,e))})};g.prototype._jsonToAccessoriesMap=function(a){if(!a||!a.inovent)return{};var b={},d;for(d in a.inovent){var g=a.inovent[d];if(g){var n=new e(d);n.fromJSON(g);b[d]=n}}return b};g.prototype._jsonToSmartGuardSettingsMap=function(b){if(!b||
!b.smartguard)return{};var d={},e;for(e in b.smartguard){var g=b.smartguard[e];if(g){var n=new a(e);n.fromJSON(g);d[e]=n}}return d};g.prototype._loadFile=function(a){var b=this._getFilePath();fs_extra.ensureFile(b,function(d){d?a&&a(d):fs_extra.readFile(b,"utf8",function(b,d){if(b)a&&a(b);else if(d)try{var e=JSON.parse(d);a&&a(null,e)}catch(p){a&&a(p)}else a&&a(null,{})})})};g.prototype._getFilePath=function(){var a=require("x.hub.fileman.js").fileManager,b=require("path");require("fs");a=a.getUserRootDataPath();
return b.resolve(a,this.REHAU_FILE)};g.prototype._saveData=function(a){var b=this._accessoriesMapToJson(this._inoventAccessories),d=this._settingsMapToJson(this._smartguardSettings);this._saveFile({inovent:b?b:{},smartguard:d?d:{}},function(b){a&&a(b)})};g.prototype._accessoriesMapToJson=function(a){if(!a)return{};var b={},d;for(d in a){var e=a[d];e&&(e=e.toJSON(),b[d]=e)}return b};g.prototype._settingsMapToJson=function(a){if(!a)return{};var b={},d;for(d in a){var e=a[d];e&&(e=e.toJSON(),b[d]=e)}return b};
g.prototype._saveFile=function(a,b){var d=this._getFilePath();fs_extra.writeFile(d,JSON.stringify(a,null,2),function(a){b&&b(a)})};return g}();
x.hub.m.enocean.SDK=function(){var e=function(b){this._handler=b};e.prototype.send_SA_RD_LEARNEDCLIENTS=function(b,a){b=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_RD_LEARNEDCLIENTS;this._handler._esp3.sendSACommand(b,!0,function(b,d){a&&a(b,d)})};e.prototype.send_SA_WR_RESET=function(b,a){b&&b.saClientId?(b=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_RESET(b.saClientId),this._handler._esp3.sendSACommand(b,!0,function(b,d){a&&a(b,d)})):a&&a(Error("params invalid"))};e.prototype.send_SA_WR_POSTMASTER=function(b,
a){b?(b.mailboxCount||(b.mailboxCount=0),b=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_POSTMASTER(b.mailboxCount),this._handler._esp3.sendSACommand(b,!0,a)):a&&a(Error("params invalid"))};e.prototype.send_CO_WR_REPEATER=function(b,a){b?(b.enable||(b.enable=0),b.level||(b.level=0),b=new x.hub.m.enocean.ESP3.COMMAND_COMMAND.CO_WR_REPEATER(b.enable,b.level),this._handler._esp3.sendCommandCommand(b,!0,a)):a&&a(Error("params invalid"))};return e}();
x.hub.m.enocean.Util={esp2toesp3:function(e){if(!(e&&e instanceof x.hub.m.enocean.ESP2.Telegram))return null;e=e.toPayload();if(!e)return null;var b=e.getData(),a=e.getSenderID(),g=e.getStatus(),d=g&15;return e instanceof x.hub.m.enocean.ESP2.Payload.RPS?(b=b.readUInt8(0),e=new x.hub.m.enocean.ESP3.Telegram.RPS(b,a,g>>5&1,g>>4&1,d)):e instanceof x.hub.m.enocean.ESP2.Payload.BS1?(b=b.readUInt8(0),e=new x.hub.m.enocean.ESP3.Telegram.BS1(b,a,d)):e instanceof x.hub.m.enocean.ESP2.Payload.BS4?e=new x.hub.m.enocean.ESP3.Telegram.BS4(b,
a,d):null},esp3toesp2:function(e){if(!(e&&e instanceof x.hub.m.enocean.ESP3.Telegram))return null;var b=null,a=e.userData,g=e.senderID;e instanceof x.hub.m.enocean.ESP3.Telegram.RPS?(b=e.t21<<5|e.nu<<4||e.rc,b=new x.hub.m.enocean.ESP2.Payload.RPS(a,g,b)):e instanceof x.hub.m.enocean.ESP3.Telegram.BS1?(b=e.rc&15,b=new x.hub.m.enocean.ESP2.Payload.BS1(a,g,b)):e instanceof x.hub.m.enocean.ESP3.Telegram.BS4&&(b=e.rc&15,b=new x.hub.m.enocean.ESP2.Payload.BS4(a,g,b));return b?(a=new x.hub.m.enocean.ESP2.TRT,
a.fromPayload(b),a):null},buffer2esp3:function(e){if(85!=e[0]||6>=e.length)return null;var b=(e[1]<<8)+e[2],a=e[3],g=e[5];if(e.length<b+a+7||x.hub.m.enocean.CRC8(e.slice(1,5))!=g)return null;g=e[b+a+6];if(x.hub.m.enocean.CRC8(e.slice(6,6+b+a))!=g)return null;var d=e[4];g=e[6];var l=e.slice(6,6+b),h=e.slice(6+b,6+b+a);e.slice(0,6+b+a+1).toString("hex");e=new x.hub.m.enocean.ESP3.ESP3_Frame(d,l,h);166!=g&&210!=g&&165!=g&&246!=g&&213!=g||l.slice(b-5,b-1).toString("hex");return(b=e.toPacket())&&b instanceof
x.hub.m.enocean.ESP3.RADIO_ERP1_Packet?b.toRadioTelegram():null}};
x.hub.m.enocean.USBHandler=function(){var e=function(b){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.USBHandler");this._handler=b;this._usbDevices=[];this._connectedESP2=this._connectedESP3=null};e.prototype.attachSerial=function(b){this._logger.log("debug","attach usb port:"+b);var a=this._usbDevices.length;this._usbDevices.push({port:b});0==a&&this._attachNextDevice()};e.prototype.removeSerial=function(b){this._logger.log("debug","remove usb port:"+b);if(this._connectedESP3&&this._connectedESP3.port==
b){this._connectedESP3=null;var a=this._handler._esp3.getSerial();a&&a.getPort()==b&&this._handler._esp3.removeSerial(b)}this._connectedESP2&&this._connectedESP2.port==b&&(this._connectedESP2=null,(a=this._handler._esp2.getSerial())&&a.getPort()==b&&this._handler._esp2.removeSerial(b))};e.prototype._attachNextDevice=function(){if(0!=this._usbDevices.length){var b=this._usbDevices[0],a=this;this._logger.log("debug","connect usb port:"+b.port);this._testESP3(b.port,function(e){e?a._testESP2(b.port,
function(d){d||(a._connectedESP2=b);a._usbDevices.splice(0,1);a._attachNextDevice()}):(a._connectedESP3=b,a._usbDevices.splice(0,1),a._attachNextDevice())})}};e.prototype._testESP3=function(b,a){this._logger.log("debug","try esp3 on usb port:"+b);var e=this._handler._esp3;if(e.getSerial())this._logger.log("debug","enocean usb device already exist"),a(Error("enocean usb device already exist"));else{var d=this;e.attachSerial(b,function(e){e?d._logger.log("debug",b+" is not a enocean usb device, error:"+
e.message):d._logger.log("debug","success to connect to enocean usb device on port:"+b);a(e)})}};e.prototype._testESP2=function(b,a){this._logger.log("debug","try esp2 on usb port:"+b);var e=this._handler._esp2;if(e.getSerial())this._logger.log("debug","FGW14 device already exist"),a(Error("FGW14 device already exist"));else{var d=this;e.attachSerial(b,function(e){e?d._logger.log("debug",b+" is not a FGW14 gateway, error:"+e.message):d._logger.log("debug","connect to FGW14 on port "+b+" success");
a(e)})}};return e}();
x.hub.m.enocean.Handler=function(){var e=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Handler");this._secHandler=new this.SecurityHandler(this);this._deviceHandler=new this.DeviceHandler(this);this._esp3=new x.hub.m.enocean.ESP3(this);this._esp2=new x.hub.m.enocean.ESP2(this);this._learnHandler=new this.LearnHandler(this);this._siegeniaHandler=new x.hub.m.enocean.SiegeniaHandler(this._esp3);this._rehauHandler=new x.hub.m.enocean.RehauHandler;this._trackers=[];this._sdk=
new x.hub.m.enocean.SDK(this);this._usb=new x.hub.m.enocean.USBHandler(this)};util.inherits(e,EventEmitter);e.prototype.Serial=x.hub.m.enocean.Serial;e.prototype.SENSOR_FILE="enocean.json";e.prototype.SECURITY_FILE="enocean_sec.json";e.prototype.profiles=x.hub.m.enocean.profiles;e.prototype.ESP2=x.hub.m.enocean.ESP2;e.prototype.ESP3=x.hub.m.enocean.ESP3;e.prototype.SecurityHandler=x.hub.m.enocean.SecurityHandler;e.prototype.LearnHandler=x.hub.m.enocean.LearnHandler;e.prototype.DeviceHandler=x.hub.m.enocean.DeviceHandler;
e.prototype.getDeviceHandler=function(){return this._deviceHandler};e.prototype.getRehauHandler=function(){return this._rehauHandler};e.prototype.getESP3=function(){return this._esp3};e.prototype.init=function(b){localStorage&&localStorage.getItem("x.hub.m.enocean.SENDER_ID")&&(x.hub.m.enocean.SENDER_ID=localStorage.getItem("x.hub.m.enocean.SENDER_ID"));var a=this,e=require("x.hub.eventbus.js");e.on("x.hub.peripheralman.ADD_ENOCEAN",function(b){console.log("ADD_ENOCEAN",b);a._usb.attachSerial(b.port)});
e.on("x.hub.peripheralman.REMOVE_ENOCEAN",function(b){console.log("REMOVE_ENOCEAN",b);a._usb.removeSerial(b.port)});e.on("x.hub.peripheralman.ADD_SEIRAL",function(b){console.log("ADD_SEIRAL",b);b.type||a._usb.attachSerial(b.port)});e.on("x.hub.peripheralman.REMOVE_SEIRAL",function(b){console.log("REMOVE_SEIRAL",b);b.type||a._usb.removeSerial(b.port)});global.ENOCEAN_PORT&&"A20"!=global.PLATFORM&&"PI2"!=global.PLATFORM&&a._usb.attachSerial(global.ENOCEAN_PORT);global.ENOCEAN_FGW14_PORT&&"A20"!=global.PLATFORM&&
"PI2"!=global.PLATFORM&&a._usb.attachSerial(global.ENOCEAN_FGW14_PORT);e.on("gatewayevent",function(b,e,g){if(b&&e&&"ENOCEAN"!=e.address&&"STA"==g)a._rehauHandler.onDeviceEvent({_type:b.type,_adr:b.adr,getType:function(){return this._type},getAddress:function(){return this._adr}},b.state)});this._secHandler.init(function(){a._rehauHandler.init(a,function(){a._deviceHandler.init(function(){b&&b({})})})})};e.prototype.getSystems=function(){return["enocean"]};e.prototype.addStateDevice=function(b,a){a&&
a({})};e.prototype.getAllStates=function(){var b=[],a=this._deviceHandler.getAllDevices(),e;for(e in a)if(a.hasOwnProperty(e)){var d=a[e];d&&b.push({device:d.toJSON(),states:d.getStatesBuffer()})}return b};e.prototype.getStates=function(b){if(!b||!b.address)return null;var a=null;(b=this._deviceHandler.getDevice(b.address.toLowerCase()))&&(a=b.getStatesBuffer());return a};e.prototype.getState=function(b,a,e){var d=this.getStates(b),g=null;d&&"undefined"!=typeof d[a]&&null!=d[a]?(g=d[a],e&&e({data:g})):
e&&this.updateStates(b,function(b){b.error?e&&e(b):(b.data&&(g=d[a]),e({data:g}))});return g};e.prototype.executeCommand=function(b,a,e){this._esp3._baseID?this._esp3._baseID.toLowerCase()!=x.hub.m.enocean.SENDER_ID.toLowerCase()?e&&e({error:Error("enocean stick has a different baseID")}):b&&b.address?((b=b.address)&&(b=b.toLowerCase()),(b=this._deviceHandler.getDevice(b))?b.executeCommand?b.executeCommand(this._esp3,a,function(a){e&&e({error:a})}):e&&e({error:Error("device dese not support command")}):
e&&e({error:Error("no such device")})):e&&e({error:Error("device invalid")}):e&&e({error:Error("enocean stick not found")})};e.prototype.checkDeviceMatch=function(b,a){if(!(a&&a.device&&b&&b.device))return!1;(b=b.device.address)&&(b=b.toLowerCase());(a=a.device.address)&&(a=a.toLowerCase());return b==a};e.prototype.updateStates=function(b,a){a&&a({error:Error("not supported yet")})};e.prototype.executeCommandLegacy=function(b,a,e,d){b?d&&d({error:Error("not supported yet")}):this._esp3?a?this.executeCommand({address:a},
{value:e},function(a){d&&d({error:a?a.error:null})}):d&&d({error:Error("address invalid")}):d&&d({error:Error("not inited")})};e.prototype.getAllStatesLegacy=function(b,a){var e=[],d=this.getAllStates(),l=this._secHandler.getUnsyncDevice(),h=this;d.forEach(function(b){if(b&&b.device&&b.states){var d=b.device.address,g={type:"ENOCEAN",adr:d,data:b.device.data,vendor:b.device.vendor,state:{}},k;for(k in b.states)g.state[k]=b.states[k].value;h._secHandler.isSecureDevice(d)?(g.deviceProtocol="secure",
g.state.security_state=l[d]?"nok":"ok"):g.deviceProtocol="normal";a&&"1"==a.config&&(g.senderID=b.device.senderID,g.virtual=b.device.virtual,g.params=b.device.params,d&&l[d]&&(g.rlc_unsync=!0));e.push(g)}});b&&b({data:e})};e.prototype.getEnoceanInfo=function(){var b={baseID:x.hub.m.enocean.SENDER_ID,usb_connected:null!=this._esp3._serial,usb_baseID:this._esp3._baseID,num_free_senderID:this._deviceHandler.getFreeSenderIdCount(),fgw14_connected:null!=this._esp2.getSerial()};b.fgw14_connected&&(b.fgw14_port=
this._esp2.getSerial().getPort(),b.fgw14_baseID=this._esp2._baseID);return b};e.prototype.learnDevice=function(b,a){var e=b?b.senderID:null,d=b?b.data:null,l=b?b.vendor:null,h=b?b.address:null;if(h){d=this._deviceHandler.findDevice(b);if(!d){a&&a({error:Error("device not found")});return}var k=d.toJSON();d=k.data;l=k.vendor;e||(sednerID=k.senderID)}k={};k.saLearnMode=b?b.saLearnMode:null;this._learnHandler.learn(d,h,e,l,null,function(b,d,e){b?a&&a({error:b}):(b={},1==d?b.op=1:(b=e.toJSON(),b.op=0),
a&&a({data:b}))},k)};e.prototype.learnSoda=function(b){if(this._esp3._serial){var a=this,e=setTimeout(function(){a._esp3.removeListener(d);b&&b({error:Error("learn timeout")})},2E4),d={_onEOTelegram:function(g){if(246==g.rorg&&(192==g.userData||208==g.userData||240==g.userData)){clearTimeout(e);a._esp3.removeListener(d);var h={address:g.senderID,data:"f6-so-da",vendor:"soda"};a.addSensor(g.senderID,"f6-so-da","soda",null,function(a){a.error?b&&b(a):b&&b({data:h})})}}};this._esp3.addListener(d)}else b&&
b({error:Error("port not opened")})};e.prototype.teachinDevice=function(b,a){if(b)if(b.data){b.adr&&!b.address&&(b.address=b.adr);var e=this._deviceHandler.findDevice(b);e=e?e.toJSON():b;b.data!=e.data?a&&a({error:Error("device of another type with the same address exists")}):b.vendor&&b.vendor!=e.vendor?a&&a({error:Error("device of another vendor with the same address exists")}):this._learnHandler.teachin(e.data,e.address,e.senderID,e.vendor,function(b,e,g){b?a&&a({error:b}):(b={},e&&(b=e.toJSON()),
g&&(b.op=g),a&&a({data:b}))})}else a&&a({error:Error("data is null")});else a&&a({error:Error("query is null")})};e.prototype.generateVirtualDevice=function(b,a){this._deviceHandler.generateVirtual(b,function(b,d){a&&a({error:b,data:d?d.toJSON():null})})};e.prototype.sendToFGW14=function(b,a){this._logger.log("trace","stm -> fgw14, forward esp3 telegram:"+b.toString("hex"));if(this._esp2||this._esp2.getSerial())if(b=x.hub.m.enocean.Util.buffer2esp3(b))if(b=x.hub.m.enocean.Util.esp3toesp2(b)){this._logger.log("trace",
"stm -> fgw14, convert to esp2 telegram:"+b.toBuffer().toString("hex"));var e=this;this._esp2.sendTelegram(b,null,function(b){e._logger.log("trace","stm -> fgw14, forward finish "+(b?"failed:"+b.messsage:"success"));d=new x.hub.m.enocean.ESP3.Response(0);l=d.toPacket().toFrame().toBuffer();a&&a(l)})}else{this._logger.log("trace","stm -> fgw14, failed to convert esp3 telegram to esp2 telegram");var d=new x.hub.m.enocean.ESP3.Response(3);var l=d.toPacket().toFrame().toBuffer();a&&a(l)}else this._logger.log("trace",
"stm -> fgw14, invalid esp3 telegram"),d=new x.hub.m.enocean.ESP3.Response(3),l=d.toPacket().toFrame().toBuffer(),a&&a(l);else this._logger.log("trace","stm -> fgw14, fgw14 not connected"),d=new x.hub.m.enocean.ESP3.Response(1),l=d.toPacket().toFrame().toBuffer(),a&&a(l)};e.prototype._onESP2Telegram=function(b){if("CA"==global.HARDWARE_VERSION){var a=x.hub.m.enocean.Util.esp2toesp3(b);if(a){var e=this;b=a.toPacket().toFrame().toBuffer();this._logger.log("trace","convert to esp3 telegram:"+JSON.stringify(a.toJSON()));
this._logger.log("trace","convert to esp3:"+b.toString("hex")+" and forward to stm");(a=require("x.hub.v6.js").getSTM())&&a.sendCommand(144,b,function(a){e._logger.log("trace","forward to stm result:"+JSON.stringify(a))})}}};e.prototype._onEOFrame=function(b,a){this._trackers.forEach(function(e){e.onFrame(b,a)})};e.prototype._onEOTelegram=function(b){this._trackers.forEach(function(a){a.onTelegram(b)});var a=this._deviceHandler.getDevice(b.senderID);if(a){var e=this;a.evalData(this._esp3,b,function(b,
g){b||0==g.length||e._onEOEvents(a,g)})}};e.prototype._onEOEvents=function(b,a){var e=require("x.hub.eventbus.js");this._trackers.forEach(function(d){d.onResolveEvents(b._address,a)});this._rehauHandler.onDeviceEvent(b,a);var d=b.toJSON();d.sys="aio";d.type="ENOCEAN";for(var l=0,h=0;h<a.length;h++){var k=a[h];if(k)if("shortPress"==k.value||"longPress"==k.value||"pressed"==k.value||"released"==k.value){l++;var n={type:"ENOCEAN",adr:d.address,data:d.data,vendor:d.vendor,state:{}};n.state[k.key]=k.value;
e.emit("gatewayevent",n,{address:"ENOCEAN"},"BTN")}else if("d2-06-50"==d.data&&"burglary"==k.key){n={type:"ENOCEAN",adr:d.address,data:d.data,vendor:d.vendor,state:{}};n.state[k.key]=k.value;e.emit("gatewayevent",n,{address:"ENOCEAN"},"STA");return}}if(l==a.length)(d=b.getStatesLegacy())&&e.emit("udpevent",d,"STA");else if(d=b.getStatesLegacy())e.emit("gatewayevent",d,{address:"ENOCEAN"},"STA"),e.emit("udpevent",d,"STA")};e.prototype._saveEnoceanEvents=function(b,a){var e=require("x.hub.datastore.js").dataStore;
e&&e.openDB(function(d,e){if(!d){d=b._address;for(var g=[],k=(new Date).toISOString(),l=0;l<a.length;l++){var q=a[l];if(q&&q.changed){q=q.key+":"+q.value;var p=null;p=0==g.length?"SELECT '"+d+"' AS 'window', '"+q+"' AS 'state', '"+k+"' AS 'time'":"UNION ALL SELECT '"+d+"', '"+q+"', '"+k+"'";g.push(p)}}0<g.length&&(d=g.join(" "),e.run("INSERT INTO windowstate(window, state, time) "+d+";",function(a){e.close()}))}})};e.prototype.addSensor=function(b,a){b?b.data?"siegenia"!=b.vendor||b.params?this._deviceHandler.addDevice(b,
function(b,d){a&&a({error:b,data:d?d.toJSON():null})}):a&&a({error:Error("siegenia windows params is null")}):a&&a({error:Error("enocean profile is null")}):a&&a({error:Error("enocean device is null")})};e.prototype.updateSensor=function(b,a,e){b?a?this._deviceHandler.updateDevice(b,a,function(a,b){e&&e({error:a,data:b?b.toJSON():null})}):e&&e({error:Error("device info is null")}):e&&e({error:Error("device address is null")})};e.prototype.delSensor=function(b,a){b?this._deviceHandler.deleteDevice({address:b},
function(b){a&&a({error:b})}):a&&a({error:Error("enocean id is null")})};e.prototype.resetDefaultSenderID=function(b){x.hub.m.enocean.SENDER_ID=null;localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID","");b&&b({})};e.prototype.setRehauAlarm=function(b,a){this._rehauHandler.setAlarm(b,a)};e.prototype.isRehauWindowOpen=function(){return this._rehauHandler.isWindowOpen()};e.prototype.setInoventHumidityAccessory=function(b,a,e){this._rehauHandler.setHumidityAccessory(b,a,function(a){e&&e({error:a})})};
e.prototype.setInoventCo2Accessory=function(b,a,e){this._rehauHandler.setCo2Accessory(b,a,function(a){e&&e({error:a})})};e.prototype.getInoventAccessories=function(b,a){b=this._rehauHandler.getInoventAccessory(b);a&&a({data:b?b.toJSON():{}})};e.prototype.__addTelegramTracker=function(b){b&&b.onTelegram&&b.onResolveEvents&&-1==this._trackers.indexOf(b)&&this._trackers.push(b)};e.prototype.__removeTelegramTracker=function(b){b&&(b=this._trackers.indexOf(b),-1!=b&&this._trackers.splice(b,1))};e.prototype.__sendEspFrame=
function(b,a,e,d,l){a=a?new Buffer(a,"hex"):null;e=e?new Buffer(e,"hex"):null;d=d?!0:!1;b=new x.hub.m.enocean.ESP3.ESP3_Frame(b,a,e);this._esp3.sendFrame(b,d,function(a,b){l&&l({error:a,data:b?b.toJSON():null})})};e.prototype.__simulateRawEnoceanPacket=function(b,a){this._esp3.onSerialData(new Buffer(b,"hex"));a&&a()};e.prototype._doSDK=function(b,a){if(b&&b.method){var e="send_"+b.method;if(this._sdk[e])this._sdk[e](b.params,function(b){a&&a({error:b})});else a&&a({error:Error("no such method")})}else a&&
a({error:Error("data invalid")})};return e}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.enocean.Handler);
