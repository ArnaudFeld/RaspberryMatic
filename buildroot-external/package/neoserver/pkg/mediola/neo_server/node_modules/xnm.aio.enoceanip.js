var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.enoceanip=xnm.aio.enoceanip||{};xnm.aio.enoceanip.Util={clearHttpOptionForLog:function(f){try{var b=JSON.parse(JSON.stringify(f));b.auth&&(b.auth="xxxxxx:xxxxxx");if(b.headers)for(var e in headers)if(e&&"authorization"==e.toLocaleLowerCase()){var a=headers[e];if(a){var g=a.indexOf(" ");headers[e]=-1==g?"xxxxxx":a.substr(0,g)+" xxxxxx"}}return b}catch(c){return f}}};
xnm.aio.enoceanip.IP_Profiles=function(){var f=function(){var a=function(){};a.prototype.getMap=function(){return{ipevt:[{type:"enum",name:"button A0 pressed",ref:{value:"btnA0pressed",options:["true"]}},{type:"enum",name:"button A0 released",ref:{value:"btnA0released",options:["true"]}},{type:"enum",name:"button A0 short press",ref:{value:"btnA0shortPress",options:["true"]}},{type:"enum",name:"button A0 long press",ref:{value:"btnA0longPress",options:["true"]}},{type:"enum",name:"button AI pressed",
ref:{value:"btnAIpressed",options:["true"]}},{type:"enum",name:"button AI released",ref:{value:"btnAIreleased",options:["true"]}},{type:"enum",name:"button AI short press",ref:{value:"btnAIshortPress",options:["true"]}},{type:"enum",name:"button AI long press",ref:{value:"btnAIlongPress",options:["true"]}},{type:"enum",name:"button B0 pressed",ref:{value:"btnB0pressed",options:["true"]}},{type:"enum",name:"button B0 released",ref:{value:"btnB0released",options:["true"]}},{type:"enum",name:"button B0 short press",
ref:{value:"btnB0shortPress",options:["true"]}},{type:"enum",name:"button B0 long press",ref:{value:"btnB0longPress",options:["true"]}},{type:"enum",name:"button BI pressed",ref:{value:"btnBIpressed",options:["true"]}},{type:"enum",name:"button BI released",ref:{value:"btnBIreleased",options:["true"]}},{type:"enum",name:"button BI short press",ref:{value:"btnBIshortPress",options:["true"]}},{type:"enum",name:"button BI long press",ref:{value:"btnBIlongPress",options:["true"]}}]}};a.prototype.resolveState=
function(d,a){if(!a||!a.functions)return null;d=null;for(var h=0;h<a.functions.length;h++){var b=a.functions[h];if(b&&b.key)switch(b.key){case "buttonA0":d||(d={});switch(b.value){case "pressed":d.btnA0pressed=!0;break;case "released":d.btnA0released=!0}break;case "buttonAI":d||(d={});switch(b.value){case "pressed":d.btnAIpressed=!0;break;case "released":d.btnAIreleased=!0}break;case "buttonB0":d||(d={});switch(b.value){case "pressed":d.btnB0pressed=!0;break;case "released":d.btnB0released=!0}break;
case "buttonBI":d||(d={});switch(b.value){case "pressed":d.btnBIpressed=!0;break;case "released":d.btnBIreleased=!0}break;case "multipleButtons":switch(d||(d={}),b.value){case "pressed":d.multiBtnpressed=!0;break;case "released":d.multiBtnreleased=!0}}}return d};return{Version_0_9:new a}}(),b=function(){var a=function(){};a.prototype.getMap=function(){return{ipevt:[{type:"enum",name:"button A0 pressed",ref:{value:"btnA0pressed",options:["true"]}},{type:"enum",name:"button A0 released",ref:{value:"btnA0released",
options:["true"]}},{type:"enum",name:"button A0 short press",ref:{value:"btnA0shortPress",options:["true"]}},{type:"enum",name:"button A0 long press",ref:{value:"btnA0longPress",options:["true"]}},{type:"enum",name:"button AI pressed",ref:{value:"btnAIpressed",options:["true"]}},{type:"enum",name:"button AI released",ref:{value:"btnAIreleased",options:["true"]}},{type:"enum",name:"button AI short press",ref:{value:"btnAIshortPress",options:["true"]}},{type:"enum",name:"button AI long press",ref:{value:"btnAIlongPress",
options:["true"]}},{type:"enum",name:"button B0 pressed",ref:{value:"btnB0pressed",options:["true"]}},{type:"enum",name:"button B0 released",ref:{value:"btnB0released",options:["true"]}},{type:"enum",name:"button B0 short press",ref:{value:"btnB0shortPress",options:["true"]}},{type:"enum",name:"button B0 long press",ref:{value:"btnB0longPress",options:["true"]}},{type:"enum",name:"button BI pressed",ref:{value:"btnBIpressed",options:["true"]}},{type:"enum",name:"button BI released",ref:{value:"btnBIreleased",
options:["true"]}},{type:"enum",name:"button BI short press",ref:{value:"btnBIshortPress",options:["true"]}},{type:"enum",name:"button BI long press",ref:{value:"btnBIlongPress",options:["true"]}},{type:"enum",name:"button C0 pressed",ref:{value:"btnC0pressed",options:["true"]}},{type:"enum",name:"button C0 released",ref:{value:"btnC0released",options:["true"]}},{type:"enum",name:"button C0 short press",ref:{value:"btnC0shortPress",options:["true"]}},{type:"enum",name:"button C0 long press",ref:{value:"btnC0longPress",
options:["true"]}},{type:"enum",name:"button CI pressed",ref:{value:"btnCIpressed",options:["true"]}},{type:"enum",name:"button CI released",ref:{value:"btnCIreleased",options:["true"]}},{type:"enum",name:"button CI short press",ref:{value:"btnCIshortPress",options:["true"]}},{type:"enum",name:"button CI long press",ref:{value:"btnCIlongPress",options:["true"]}},{type:"enum",name:"button D0 pressed",ref:{value:"btnD0pressed",options:["true"]}},{type:"enum",name:"button D0 released",ref:{value:"btnD0released",
options:["true"]}},{type:"enum",name:"button D0 short press",ref:{value:"btnD0shortPress",options:["true"]}},{type:"enum",name:"button D0 long press",ref:{value:"btnD0longPress",options:["true"]}},{type:"enum",name:"button DI pressed",ref:{value:"btnDIpressed",options:["true"]}},{type:"enum",name:"button DI released",ref:{value:"btnDIreleased",options:["true"]}},{type:"enum",name:"button DI short press",ref:{value:"btnDIshortPress",options:["true"]}},{type:"enum",name:"button DI long press",ref:{value:"btnDIlongPress",
options:["true"]}}]}};a.prototype.resolveState=function(d,a){if(!a||!a.functions)return null;d=null;for(var h=0;h<a.functions.length;h++){var b=a.functions[h];if(b&&b.key)switch(b.key){case "buttonA0":d||(d={});switch(b.value){case "pressed":d.btnA0pressed=!0;break;case "released":d.btnA0released=!0}break;case "buttonAI":d||(d={});switch(b.value){case "pressed":d.btnAIpressed=!0;break;case "released":d.btnAIreleased=!0}break;case "buttonB0":d||(d={});switch(b.value){case "pressed":d.btnB0pressed=
!0;break;case "released":d.btnB0released=!0}break;case "buttonBI":d||(d={});switch(b.value){case "pressed":d.btnBIpressed=!0;break;case "released":d.btnBIreleased=!0}break;case "buttonC0":d||(d={});switch(b.value){case "pressed":d.btnC0pressed=!0;break;case "released":d.btnC0released=!0}break;case "buttonCI":d||(d={});switch(b.value){case "pressed":d.btnCIpressed=!0;break;case "released":d.btnCIreleased=!0}break;case "buttonD0":d||(d={});switch(b.value){case "pressed":d.btnD0pressed=!0;break;case "released":d.btnD0released=
!0}break;case "buttonDI":switch(d||(d={}),b.value){case "pressed":d.btnDIpressed=!0;break;case "released":d.btnDIreleased=!0}}}return d};return{Version_0_9:new a}}(),e=function(){var a=function(){};a.prototype.getMap=function(){return{status:[{type:"enum",name:"water detected",ref:{value:"water",options:["true","false"]}}],ipevt:[{type:"enum",name:"water detected",ref:{value:"water",options:["true","false"]}}]}};a.prototype.resolveState=function(d,a){if(!a||!a.functions)return null;d=null;for(var b=
0;b<a.functions.length;b++){var h=a.functions[b];h&&h.key&&"liquidDetected"==h.key&&(d||(d={}),d.water=h.value)}return d};return{Version_0_9:new a}}(),a=function(){var a=function(){};a.prototype.getMap=function(){return{status:[{type:"enum",name:"alarm",ref:{value:"alarm",options:["off","on"]}},{type:"enum",name:"battery Low",ref:{value:"lowbat",options:["true","false"]}}],ipevt:[{type:"enum",name:"alarm",ref:{value:"alarm",options:["off","on"]}},{type:"enum",name:"battery Low",ref:{value:"lowbat",
options:["true","false"]}}]}};a.prototype.resolveState=function(d,a){if(!a||!a.functions)return null;d=null;for(var b=0;b<a.functions.length;b++){var h=a.functions[b];h&&h.key&&("alarm"==h.key?(d||(d={}),d.alarm=h.value):"batteryLow"==h.key&&(d||(d={}),d.lowbat=h.value))}return d};return{Version_0_9:new a}}(),g=function(){var a=function(){};a.prototype.getMap=function(){return{status:[{type:"enum",name:"handle",ref:{value:"handle",options:["closed","open","up"]}}],ipevt:[{type:"enum",name:"handle",
ref:{value:"handle",options:["closed","open","up"]}}]}};a.prototype.resolveState=function(d,a){if(!a||!a.functions)return null;d=null;for(var b=0;b<a.functions.length;b++){var h=a.functions[b];h&&h.key&&"handle"==h.key&&(d||(d={}),d.handle=h.value)}return d};return{Version_0_9:new a}}(),c=function(){var a=function(){};a.prototype.getMap=function(){return{status:[{type:"float",name:"humidity",ref:{value:"humidity",extMeta:"0-100",scale:.4}},{type:"float",name:"temperature",ref:{value:"temperature",
extMeta:"0-40",scale:.16}}],ipevt:[{type:"float",name:"humidity",ref:{value:"humidity",extMeta:"0-100",scale:.4}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.16}}]}};a.prototype.resolveState=function(d,a){if(!a||!a.functions)return null;d=null;for(var b=0;b<a.functions.length;b++){var h=a.functions[b];h&&h.key&&(d||(d={}),d[h.key]=h.value)}return d};return{Version_0_9:new a}}(),l=function(){var a=function(){};a.prototype.getMap=function(){return{status:[{type:"int",
name:"error code",ref:{value:"errorCode",extMeta:"251-255"}},{type:"int",name:"illumination",ref:{value:"illumination",extMeta:"0-1000"}},{type:"enum",name:"motion detected",ref:{value:"motionDetected",options:["false","true"]}},{type:"float",name:"supply voltage",ref:{value:"supplyVoltage",extMeta:"0-5",scale:.02}}],ipevt:[{type:"int",name:"error code",ref:{value:"errorCode",extMeta:"251-255"}},{type:"int",name:"illumination",ref:{value:"illumination",extMeta:"0-1000"}},{type:"enum",name:"motion detected",
ref:{value:"motionDetected",options:["false","true"]}},{type:"float",name:"supply voltage",ref:{value:"supplyVoltage",extMeta:"0-5",scale:.02}}]}};a.prototype.resolveState=function(d,a){if(!a||!a.functions)return null;d=null;for(var b=0;b<a.functions.length;b++){var h=a.functions[b];h&&h.key&&(d||(d={}),d[h.key]=h.value)}return d};return{Version_0_9:new a}}(),k=function(){var a=function(){};a.prototype.getMap=function(){return{status:[{type:"int",name:"setpoint",ref:{value:"setpoint",extMeta:"0-255"}},
{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}],ipevt:[{type:"int",name:"setpoint",ref:{value:"setpoint",extMeta:"0-255"}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}]}};a.prototype.resolveState=function(d,a){if(!a||!a.functions)return null;d=null;for(var b=0;b<a.functions.length;b++){var h=a.functions[b];h&&h.key&&(d||(d={}),d[h.key]=h.value)}return d};var d=function(){};d.prototype.getMap=function(){return{status:[{type:"float",
name:"setpoint",ref:{value:"setpoint",extMeta:"-3-3",scale:.5}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.1}}],ipevt:[{type:"float",name:"setpoint",ref:{value:"setpoint",extMeta:"-3-3",scale:.5}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.1}}]}};d.prototype.resolveState=function(d,a){if(!a||!a.functions)return null;d=null;for(var b=0;b<a.functions.length;b++){var h=a.functions[b];h&&h.key&&(d||(d={}),d[h.key]=h.value)}return d};
return{Version_0_9:new a,Version_0_9_Thermokon:new d}}(),m=function(){var a=function(){};a.prototype.getMap=function(){return{command:[{type:"float",name:"set point",ref:{value:"setpoint",ext:"%f",extMeta:"0-40",scale:.5}},{type:"int",name:"set valve",ref:{value:"setvalve",ext:"%d",extMeta:"0-100"}}],status:[{type:"enum",name:"actuator obstructed",ref:{value:"actuatorObstructed",options:["false","true"]}},{type:"enum",name:"battery low",ref:{value:"batteryLow",options:["false","true"]}},{type:"enum",
name:"contact",ref:{value:"contact",options:["closed","open"]}},{type:"enum",name:"energy input enabled",ref:{value:"energyInput",options:["false","true"]}},{type:"enum",name:"energy storage charged",ref:{value:"energyStorageCharged",options:["false","true"]}},{type:"enum",name:"service mode",ref:{value:"serviceMode",options:["off","on"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}},{type:"int",name:"valve",ref:{value:"valve",extMeta:"0-100"}},{type:"enum",
name:"window",ref:{value:"window",options:["closed","open"]}}],ipevt:[{type:"enum",name:"actuator obstructed",ref:{value:"actuatorObstructed",options:["false","true"]}},{type:"enum",name:"battery low",ref:{value:"batteryLow",options:["false","true"]}},{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}},{type:"enum",name:"energy input enabled",ref:{value:"energyInput",options:["false","true"]}},{type:"enum",name:"energy storage charged",ref:{value:"energyStorageCharged",options:["false",
"true"]}},{type:"enum",name:"service mode",ref:{value:"serviceMode",options:["off","on"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}},{type:"int",name:"valve",ref:{value:"valve",extMeta:"0-100"}},{type:"enum",name:"window",ref:{value:"window",options:["closed","open"]}}]}};a.prototype.executeCommand=function(d,a,b,c){a=this.getPutStateBody(d,a);if(!a)return!1;b.setDeviceState(d.deviceId,a,function(d){c&&c(d)});return!0};a.prototype.getPutStateBody=function(d,
a){d=null;switch(a.value){case "setpoint":d={state:{functions:[{key:"switch",value:"on"}]}};break;case "off":d={state:{functions:[{key:"switch",value:"off"}]}};break;case "query":d={state:{functions:[{key:"query",value:"status"}]}}}return d};a.prototype.resolveState=function(d,a){if(!a||!a.functions)return null;d=null;for(var b=0;b<a.functions.length;b++){var h=a.functions[b];h&&h.key&&("switch"==h.key?(d||(d={}),d.state=h.value):"localControl"==h.key&&(d||(d={}),d.local_control=h.value))}return d};
return{Version_0_9:new a}}(),t=function(){var a=function(){};a.prototype.getMap=function(){return{status:[{type:"enum",name:"liquid detected",ref:{value:"liquidDetected",options:["false","true"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}],ipevt:[{type:"enum",name:"liquid detected",ref:{value:"liquidDetected",options:["false","true"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}]}};a.prototype.resolveState=function(d,
a){if(!a||!a.functions)return null;d=null;for(var b=0;b<a.functions.length;b++){var h=a.functions[b];h&&h.key&&(d||(d={}),d[h.key]=h.value)}return d};return{Version_0_9_Afriso:new a}}(),n=function(){var a=function(){};a.prototype.getMap=function(){return{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"query status",ref:{value:"query"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["off","on"]}},{type:"enum",name:"local control",
ref:{value:"local_control",options:["off","on"]}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["off","on"]}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}]}};a.prototype.executeCommand=function(d,a,b,c){a=this.getPutStateBody(d,a);if(!a)return!1;b.setDeviceState(d.deviceId,a,function(a){c&&c(a)});return!0};a.prototype.getPutStateBody=function(a,b){a=null;switch(b.value){case "on":a={state:{functions:[{key:"switch",value:"on"}]}};break;case "off":a=
{state:{functions:[{key:"switch",value:"off"}]}};break;case "query":a={state:{functions:[{key:"query",value:"status"}]}}}return a};a.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var d=0;d<b.functions.length;d++){var c=b.functions[d];c&&c.key&&("switch"==c.key?(a||(a={}),a.state=c.value):"localControl"==c.key&&(a||(a={}),a.local_control=c.value))}return a};return{Version_0_9:new a}}(),p=function(){var a=function(){};a.prototype.getMap=function(){return{command:[{type:"int",
name:"dim to",ref:{value:"dimTo",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"stop dim",ref:{value:"stop"}},{type:"enum",name:"query status",ref:{value:"query"}}],status:[{type:"int",name:"state",ref:{value:"state",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}],ipevt:[{type:"int",name:"state",ref:{value:"state",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}]}};a.prototype.executeCommand=
function(a,b,c,g){b=this.getPutStateBody(a,b);if(!b)return!1;c.setDeviceState(a.deviceId,b,function(a){g&&g(a)});return!0};a.prototype.getPutStateBody=function(a,b){a=null;switch(b.value){case "dimTo":if("undefined"==typeof b.ext||null==b.ext)return null;b=parseInt(b.ext);0>b&&(b=0);100<b&&(b=100);a={state:{functions:[{key:"dimValue",value:b},{key:"rampingMode",value:"switch"}]}};break;case "stop":a={state:{functions:[{key:"dimValue",value:"invalid"},{key:"rampingMode",value:"stop"}]}};break;case "query":a=
{state:{functions:[{key:"query",value:"status"}]}}}return a};a.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var d=0;d<b.functions.length;d++){var c=b.functions[d];c&&c.key&&("dimValue"==c.key?(a||(a={}),a.state=c.value):"localControl"==c.key&&(a||(a={}),a.local_control=c.value))}return a};return{Version_0_9:new a}}(),r=function(){var a=function(){};a.prototype.getMap=function(){return{command:[{type:"enum",name:"channel 1 on",ref:{value:"ch1on"}},{type:"enum",name:"channel 1 off",
ref:{value:"ch1off"}},{type:"enum",name:"channel 2 on",ref:{value:"ch2on"}},{type:"enum",name:"channel 2 off",ref:{value:"ch2off"}},{type:"enum",name:"all on",ref:{value:"allOn"}},{type:"enum",name:"all off",ref:{value:"allOff"}},{type:"enum",name:"query channel 1 status",ref:{value:"ch1query"}},{type:"enum",name:"query channel 2 status",ref:{value:"ch2query"}},{type:"enum",name:"query all status",ref:{value:"allQuery"}}],status:[{type:"enum",name:"channel 1 state",ref:{value:"ch1state",options:["off",
"on"]}},{type:"enum",name:"channel 2 state",ref:{value:"ch2state",options:["off","on"]}}],ipevt:[{type:"enum",name:"channel 1 state",ref:{value:"ch1state",options:["off","on"]}},{type:"enum",name:"channel 2 state",ref:{value:"ch2state",options:["off","on"]}}]}};a.prototype.executeCommand=function(a,b,c,g){b=this.getPutStateBody(a,b);if(!b)return!1;c.setDeviceState(a.deviceId,b,function(a){g&&g(a)});return!0};a.prototype.getPutStateBody=function(a,b){a=null;switch(b.value){case "ch1on":a={state:{functions:[{key:"channel",
value:0},{key:"switch",value:"on"}]}};break;case "ch1off":a={state:{functions:[{key:"channel",value:0},{key:"switch",value:"off"}]}};break;case "ch2on":a={state:{functions:[{key:"channel",value:1},{key:"switch",value:"on"}]}};break;case "ch2off":a={state:{functions:[{key:"channel",value:1},{key:"switch",value:"off"}]}};break;case "allOn":a={state:{functions:[{key:"channel",value:"all"},{key:"switch",value:"on"}]}};break;case "allOff":a={state:{functions:[{key:"channel",value:"all"},{key:"switch",
value:"off"}]}};break;case "ch1query":a={state:{functions:[{key:"channel",value:0},{key:"query",value:"status"}]}};break;case "ch2query":a={state:{functions:[{key:"channel",value:1},{key:"query",value:"status"}]}};break;case "allQuery":a={state:{functions:[{key:"channel",value:"all"},{key:"query",value:"status"}]}}}return a};a.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var d=0;d<b.functions.length;d++){var c=b.functions[d];c&&c.key&&"switch"==c.key&&(a||(a={}),
0==c.channel?a.ch1state=c.value:1==c.channel&&(a.ch2state=c.value))}return a};return{Version_0_9:new a}}(),q=function(){var a=function(){};a.prototype.getMap=function(){return{command:[{type:"int",name:"move to",ref:{value:"position",ext:"%d",extMeta:"0-100"}},{type:"int",name:"angle to",ref:{value:"angle",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"move up",ref:{value:"moveUp"}},{type:"enum",name:"move down",ref:{value:"moveDown"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"query status",
ref:{value:"query"}}],status:[{type:"int",name:"position",ref:{value:"position",ext:"%d",extMeta:"0-100"}},{type:"int",name:"angle",ref:{value:"angle",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"locking mode",ref:{value:"lockingMode",options:["block","unblock"]}}],ipevt:[{type:"int",name:"position",ref:{value:"position",ext:"%d",extMeta:"0-100"}},{type:"int",name:"angle",ref:{value:"angle",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"locking mode",ref:{value:"lockingMode",options:["block","unblock"]}}]}};
a.prototype.executeCommand=function(a,b,c,g){b=this.getPutStateBody(a,b);if(!b)return!1;c.setDeviceState(a.deviceId,b,function(a){g&&g(a)});return!0};a.prototype.getPutStateBody=function(a,b){a=null;switch(b.value){case "moveUp":a={state:{functions:[{key:"position",value:0},{key:"angle",value:0}]}};break;case "moveDown":a={state:{functions:[{key:"position",value:100},{key:"angle",value:100}]}};break;case "position":if("undefined"==typeof b.ext||null==b.ext)return null;b=parseInt(b.ext);0>b&&(b=0);
100<b&&(b=100);a={state:{functions:[{key:"position",value:b}]}};break;case "angle":if("undefined"==typeof b.ext||null==b.ext)return null;b=parseInt(b.ext);0>b&&(b=0);100<b&&(b=100);a={state:{functions:[{key:"angle",value:b}]}};break;case "stop":a={state:{functions:[{key:"stop",value:!0}]}};break;case "query":a={state:{functions:[{key:"query",value:"status"}]}}}return a};a.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var c=0;c<b.functions.length;c++){var d=b.functions[c];
if(d&&d.key)switch(d.key){case "buttonA0":a||(a={});switch(d.value){case "pressed":a.btnA0pressed=!0;break;case "released":a.btnA0released=!0}break;case "buttonAI":a||(a={});switch(d.value){case "pressed":a.btnAIpressed=!0;break;case "released":a.btnAIreleased=!0}break;case "buttonB0":a||(a={});switch(d.value){case "pressed":a.btnB0pressed=!0;break;case "released":a.btnB0released=!0}break;case "buttonBI":a||(a={});switch(d.value){case "pressed":a.btnBIpressed=!0;break;case "released":a.btnBIreleased=
!0}break;case "buttonC0":a||(a={});switch(d.value){case "pressed":a.btnC0pressed=!0;break;case "released":a.btnC0released=!0}break;case "buttonCI":a||(a={});switch(d.value){case "pressed":a.btnCIpressed=!0;break;case "released":a.btnCIreleased=!0}break;case "buttonD0":a||(a={});switch(d.value){case "pressed":a.btnD0pressed=!0;break;case "released":a.btnD0released=!0}break;case "buttonDI":a||(a={});switch(d.value){case "pressed":a.btnDIpressed=!0;break;case "released":a.btnDIreleased=!0}break;default:a||
(a={}),a[d.key]=d.value}}return a};return{Version_0_9:new a}}(),u=function(){var a=function(){};a.prototype.getMap=function(){return{status:[{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}}],ipevt:[{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}}]}};a.prototype.resolveState=function(a,b){if(!b||!b.functions)return null;a=null;for(var d=0;d<b.functions.length;d++){var c=b.functions[d];c&&c.key&&(a||(a={}),a[c.key]=c.value)}return a};return{Version_0_9:new a}}();
return{F6_02_01:f,F6_03_01:b,F6_05_01:e,F6_05_02:a,F6_10_00:g,A5_04_01:c,A5_07_03:l,A5_10_03:k,A5_20_01:m,A5_30_03:t,D2_01_01:n,D2_01_03:p,D2_01_11:r,D2_05_02:q,D5_00_01:u,getPorfile:function(a,b,c){a=a.replace(/-/g,"_").toUpperCase();b="Version_"+(b+"").replace(/\./g,"_");return c&&this[a]&&this[a][b+"_"+c]?this[a][b+"_"+c]:this[a]?this[a][b]:null}}}();
xnm.aio.enoceanip.IPClient=function(){var f=function(a,b,c){c=Error(c?c:"enocean ip error");c.code=a;c.httpStatus=b;return c},b=function(a,b,c){b=c?c:Error(b?b:"error");b.code=a;return b},e=function(a,b,c,e,f){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.enoceanip.IPClient");this._ip=a;this._port=b;this._username=c;this._password=e;this._useHttps=f;this._port||(this._port=8080)};e.prototype.getIP=function(){return this._ip};e.prototype.getPort=
function(){return this._port};e.prototype.toJSON=function(){return{ip:this._ip,port:this._port,username:this._username,password:this._password,useHttps:this._useHttps}};e.prototype.getSystemInfo=function(a){this._doEnoceanIPRequest("GET","/system/info",null,function(b,c){b?a&&a(b):c.systemInfo?a&&a(null,c.systemInfo):a&&a(f(-1,esponse.header.httpStatus,"invalid get system info response"))})};e.prototype.getProfiles=function(a){this._doEnoceanIPRequest("GET","/profiles",null,function(b,c){b?a&&a(b):
c.profiles?a&&a(null,c.profiles):a&&a(f(-1,esponse.header.httpStatus,"invalid get profiles response"))})};e.prototype.getProfileInfo=function(a,b,c){this._doEnoceanIPRequest("GET","/profiles/"+a+(b?"?version="+b:""),null,function(a,b){a?c&&c(a):b.profile?c&&c(null,b.profile):c&&c(f(-1,esponse.header.httpStatus,"invalid get profile info response"))})};e.prototype.getDevices=function(a){this._doEnoceanIPRequest("GET","/devices",null,function(b,c){b?a&&a(b):c.devices?a&&a(null,c.devices):a&&a(f(-1,esponse.header.httpStatus,
"invalid get devices response"))})};e.prototype.getDevicesStream=function(a,b,c,e){var g="/devices/stream";if(a||b||c)g+="?";a&&(g+="direction="+a+"&");b&&(g+="delimited="+b+"&");c&&(g+="output="+c+"&");return this._doEnoceanIPRequest("GET",g,null,function(a,b){a?e&&e(a):b.devices?e&&e(null,b.devices):e&&e(f(-1,esponse.header.httpStatus,"invalid get devices response"))},!0)};e.prototype.getDevicesStates=function(a){this._doEnoceanIPRequest("GET","/devices/states",null,function(b,c){b?a&&a(b):c.states?
a&&a(null,c.states):a&&a(f(-1,esponse.header.httpStatus,"invalid get devices states response"))})};e.prototype.getDevice=function(a,b){this._doEnoceanIPRequest("GET","/devices/"+a,null,function(a,e){a?b&&b(a):e.device?b&&b(null,e.device):b&&b(f(-1,esponse.header.httpStatus,"invalid get device response"))})};e.prototype.getDeviceProfile=function(a,b){this._doEnoceanIPRequest("GET","/devices/"+a+"/profile",null,function(a,e){a?b&&b(a):e.profile?b&&b(null,e.profile):b&&b(f(-1,esponse.header.httpStatus,
"invalid get device profile response"))})};e.prototype.getDeviceState=function(a,b){this._doEnoceanIPRequest("GET","/devices/"+a+"/state",null,function(a,e){a?b&&b(a):e.state?b&&b(null,e.state):b&&b(f(-1,esponse.header.httpStatus,"invalid get device state response"))})};e.prototype.setDeviceState=function(a,b,c){this._doEnoceanIPRequest("PUT","/devices/"+a+"/state",b,function(a,b){a?c&&c(a):c&&c(null)})};e.prototype._doEnoceanIPRequest=function(a,b,c,e,k){this._logger.log("debug","do EnoceanIP "+
a+" request with path:"+b+(c?" and json:"+JSON.stringify(c):""));var g=this;return this._doJSONRequest(a,b,null,c,function(a,b){g._logger.log("debug","get EnoceanIP response "+(a?"error:"+a.message:JSON.stringify(b)));if(a)e&&e(f(a.code,-1,a.message));else if(b.header){var c=b.header.httpStatus,l=b.header.code?b.header.code:0;200!=c&&202!=c&&(a=f(l,c,b.header.message));e&&e(a,b)}else e&&e(f(-1,-1,"enocean ip response has no 'header'"))},k)};e.prototype._doJSONRequest=function(a,e,c,f,k,m){var g=null;
f&&(g=JSON.stringify(f));return this._doRequest(a,e,c,g,function(a,c,e){if(a)k&&k(a);else if(a=e.statusCode,c)try{var g=JSON.parse(c);g?k&&k(null,g):k&&k(b(a,"invalid repsonse"))}catch(u){k&&k(b(a,null,u))}else k&&k(b(a,"repsonse body empty"))},m)};e.prototype._doRequest=function(a,e,c,f,k,m){a={host:this._ip,port:this._port,path:e,method:a,headers:{Connection:"close","Content-Type":"application/json"}};if(c)for(var g in c)c.hasOwnProperty(g)&&(a.headers[g]=c[g]);if(this._username||this._password)a.auth=
(this._username?this._username:"")+":"+(this._password?this._password:""),a.headers.Authorization="Basic "+(new Buffer((this._username?this._username:"")+":"+(this._password?this._password:""))).toString("base64");f&&(a.headers["Content-Length"]=f.length);c=require("http");this._useHttps&&(c=require("https"),"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0"));this._logger.log("trace","do "+(this._useHttps?"HTTPS":"HTTP")+" request:"+JSON.stringify(xnm.aio.enoceanip.Util.clearHttpOptionForLog(a)));
var l=this,p=k,r={_headerListener:null,_chunkListener:null,on:function(a,b){"chunk"==a?this._chunkListener=b:"header"==a&&(this._headerListener=b)},emit:function(a,b){try{"chunk"==a&&this._chunkListener?this._chunkListener(b):"header"==a&&this._headerListener&&this._headerListener(b)}catch(d){}}},q=c.request(a,function(a){a.setEncoding("utf-8");r.emit("header",a);var b="";a.on("data",function(a){b+=a;r.emit("chunk",a)});a.on("end",function(){l._logger.log("trace","receive code:"+a.statusCode+" headers:"+
JSON.stringify(a.headers)+" response:"+b);p&&(p(null,b,a),p=null)})});if(q.on)q.on("error",function(a){l._logger.log("trace","do request error:"+a.message);p&&(p(b(-1,null,a)),p=null)});q.setTimeout&&(k=2E3,m&&(k=6E5),q.setTimeout(k,function(){l._logger.log("trace","do request timeout");q.abort();p&&(p(b(-2,"http timeout")),p=null)}));f&&(this._logger.log("trace","do request send body:"+f),q.write(f));q.end();return r};return e}();
xnm.aio.enoceanip.DCGW=function(){var f=function(b,e,a,g,c){xnm.aio.enoceanip.IPClient.call(this,b,e,a,g,c);this._logger=require("x.logger.js").getLogger("xnm.aio.enoceanip.DCGW")};f.prototype=new xnm.aio.enoceanip.IPClient;f.prototype.constructor=f;f.prototype.listDevices=function(b){this.getDevices(function(e,a){if(e)b&&b(e);else if(a&&0!=a.length){e=[];for(var g=0;g<a.length;g++)e.push({sys:"dcgw",deviceId:a[g].deviceId,friendlyId:a[g].friendlyId,manufacturer:a[g].manufacturer,location:a[g].location,
eeps:a[g].eeps});b&&b(null,e)}else b&&b(null,[])})};f.prototype.executeCommandCreator=function(b,e,a){if(b&&b.deviceId&&b.eeps&&0!=b.eeps.length)if(e&&e.value){for(var g=null,c=0;c<b.eeps.length;c++){var f=b.eeps[c];if((f=xnm.aio.enoceanip.IP_Profiles.getPorfile(f.eep,f.version,f.variation))&&f.executeCommand&&(g=f.executeCommand(b,e,this,a)))break}g||a&&a(Error("command unknown"))}else a&&a(Error("command json invalid"));else a&&a(Error("device json invalid"))};f.prototype.getStatesCreator=function(b,
e,a){if(e&&0!=e.length){var g=this;this.getDevicesStates(function(b,f){if(b)a&&a(b);else{b={};var c;for(c=0;c<f.length;c++){var m=f[c];if(m&&m.deviceId)for(var l=0;l<e.length;l++){var n=e[l];n&&n.device&&n.device.deviceId==m.deviceId&&(b[m.deviceId]||(b[m.deviceId]=g.resolveDeviceState(n.device,m)))}}f=[];for(c=0;c<e.length;c++)(n=e[c])&&n.id&&n.device&&n.device.deviceId&&n.status&&n.status.value&&b[n.device.deviceId]&&(m=b[n.device.deviceId][n.status.value],"undefined"!=typeof m&&null!=m&&f.push({id:n.id,
status:m}));a&&a(null,f)}})}else a&&a(null,[])};f.prototype.resolveDeviceState=function(b,e){if(!b||!b.eeps||0==b.eeps.length)return null;for(var a=null,g=0;g<b.eeps.length;g++){var c=b.eeps[g];if((c=xnm.aio.enoceanip.IP_Profiles.getPorfile(c.eep,c.version,c.variation))&&c.resolveState){var f=c.resolveState(b,e);if(f&&(c=void 0,null!=f&&"undefined"!=typeof f))if(null==a||"undefined"==typeof a)a=f;else for(c in f)f.hasOwnProperty(c)&&(a[c]=f[c])}}return a};f.prototype.toJSON=function(){return{sys:"dcgw",
ip:this._ip,port:this._port,username:this._username,password:this._password,useHttps:this._useHttps}};f.prototype.equalsTo=function(b){return b&&b instanceof f?this._ip==b._ip&&this._port==b._port&&this._username==b._username&&this._password==b._password:!1};f.parseJSON=function(b){return b.ip?new f(b.ip,b.port,b.username,b.password,b.useHttps):null};return f}();
xnm.aio.enoceanip.DCGW.DM=function(){var f=function(b,e){this.code=b;this.message=e;this.stack=Error().stack};f.prototype=Error();f.prototype.name="DCGWDMError";f.prototype.code=0;f.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"dcgw",getGatewayType:function(){return[{sys:this.SYS,name:"OPUS Gateway",port:8080}]},createGateway:function(b,e,a){e=f.ERROR_CODE;b?b.ip?a(null,b):a(new f(e.INVALID,"ip is invalid")):a(new f(e.INVALID,"info is invalid"))},
updateGateway:function(b,e,a,g){b=f.ERROR_CODE;e?e.ip?g(null,e):g(new f(b.INVALID,"ip is invalid")):g(new f(b.INVALID,"update is invalid"))},deleteGateway:function(b,e,a){a()},createDevice:function(b,e,a){var g=f.ERROR_CODE;if(b)if(b.gateway)if(b.deviceId){e=e.data.gateways;var c;for(c=0;c<e.length;c++)if(e[c].index===b.gateway){var l=e[c];break}l?a(null,b):a(new f(g.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else a(new f(g.INVALID,"deviceId is invalid"));else a(new f(g.INVALID,"gateway is invalid"));
else a(new f(g.INVALID,"info is invalid"))},updateDevice:function(b,e,a){var g=f.ERROR_CODE;if(b)if(b.gateway)if(b.deviceId){e=e.data.gateways;var c;for(c=0;c<e.length;c++)if(e[c].index===b.gateway){var l=e[c];break}l?a(null,b):a(new f(g.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else a(new f(g.INVALID,"deviceId is invalid"));else a(new f(g.INVALID,"gateway is invalid"));else a(new f(g.INVALID,"info is invalid"))},deleteDevice:function(b,e,a){a()},applyUIFilter:function(b,e){var a=
this,f=function(a,b,c){var e=[];a.forEach(function(a){if("root"==a.type){a=JSON.parse(JSON.stringify(a));var g=f(a.children,b,c);g&&0<g.length&&(a.children=g,e.push(a))}else{g=c.elems;if("*"==g)g=!0;else{for(var k=!1,m=0;m<g.length;m++)if(g[m]==a.type){k=!0;break}g=k}g&&(a=JSON.parse(JSON.stringify(a)),e.push(a))}});return e},c=function(b,c){var e=[],g=a.getCommandStatusMap(b);if(g){var k=[];switch(c.catagory){case "command":g.command&&(k=f(g.command,b,c));break;case "status":g.status&&(k=f(g.status,
b,c));break;case "ipevt":g.ipevt&&(k=f(g.ipevt,b,c))}e=e.concat(k)}return e};if(!b.sys)return null;var l=JSON.parse(JSON.stringify(b)),k=null;switch(e.catagory){case "command":k=c(b,e);l.command=k;break;case "status":k=c(b,e);l.status=k;break;case "ipevt":k=c(b,e);l.ipevt=k;break;default:return null}return k&&0!=k.length?l:null},applyIPEventFilter:function(b){if(!b)return null;b=this.applyUIFilter(b,{catagory:"ipevt",elems:"*"});console.log("ipevt",b);return b},getCommandStatusMap:function(b){if(!b||
!b.eeps||0==b.eeps.length)return null;for(var e={command:[],status:[],ipevt:[]},a=0;a<b.eeps.length;a++){var g=b.eeps[a],c=xnm.aio.enoceanip.IP_Profiles.getPorfile(g.eep,g.version,g.variation);c&&(c=c.getMap())&&("to"!=g.direction&&"both"!=g.direction||!c.command||(e.command=e.command.concat(c.command)),"from"==g.direction||"both"==g.direction)&&(c.status&&(e.status=e.status.concat(c.status)),c.ipevt&&(e.ipevt=e.ipevt.concat(c.ipevt)))}return e}}}();
xnm.aio.enoceanip.Handler=function(){var f=function(){};f.prototype.DCGW=xnm.aio.enoceanip.DCGW;f.prototype.devicemanager=xnm.aio.enoceanip.DCGW.DM;f.prototype.registModule=function(b){b.register(this.devicemanager.SYS,"enoceanip")};f.prototype.resolveGateway=function(b){return b?b.sys==this.devicemanager.SYS?this.DCGW.parseJSON(b):null:null};f.prototype.getDeviceCommands=function(b,e){if(!b)return null;var a;b.sys==this.devicemanager.SYS&&(a=this.devicemanager.applyUIFilter(b,{catagory:"command",
elems:"*"}));b=a?a.command:[];e&&e(null,b)};f.prototype.getDeviceStatus=function(b,e){if(!b)return null;var a;b.sys==this.devicemanager.SYS&&(a=this.devicemanager.applyUIFilter(b,{catagory:"status",elems:"*"}));b=a?a.status:[];e&&e(null,b)};f.prototype.doCommand=function(b,e,a,g){(b=this.resolveGateway(b))?b.executeCommandCreator(e,a,function(a){g&&g(a)}):g&&g(Error("gateway json format invalid"))};f.prototype.doStatus=function(b,e,a,g,c){(e=this.resolveGateway(e))?e.getStatesCreator(null,[{id:b,
device:a,status:g}],function(a,b){a?c&&c(a):c&&c(null,b[0])}):c&&c(Error("device json format invalid"))};f.prototype.resolveEvent=function(b,e,a){return(b=this.resolveGateway(b))?b.resolveDeviceState(e,a):null};f.prototype.getDeviceList=function(b,e){(b=this.resolveGateway(b))?b.listDevices(function(a,b){e&&e(a,b)}):e&&e(Error("gateway json format invalid"))};f.prototype.discover=function(b,e){var a=require("x.mdns.js");a.clearRecordBuffer();a.discoverServiceWithTimeout("_enocean._tcp.local",b,function(a,
b){if(a)e&&e(a);else{for(var c=[],f=0;f<b.length;f++){var g=b[f];if(g.target&&g.ip&&0<g.ip.length){var t=g.target.toLowerCase();if(-1!=t.indexOf("dcgw")||-1!=t.indexOf("opus"))g=new xnm.aio.enoceanip.DCGW(g.ip[0]),c.push(g)}}e&&e(a,c)}})};return f}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.enoceanip.Handler);
