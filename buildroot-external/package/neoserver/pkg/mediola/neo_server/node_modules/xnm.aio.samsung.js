var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.samsung=xnm.aio.samsung||{};
xnm.aio.samsung.TV=function(){var c=function(b,a){this.code=b;this.callback=a;this._socket=this._tv=null;this._state=0};c.prototype.run=function(b){this._tv=b;var a=this;this._state=1;b._connect({onError:function(d){a._finish(d)},onTimeout:function(){a._finish(Error("response timeout"))},onData:function(d){if(2==a._state)if(d=b._resolveAuthRsp(b._hex2arr(d)),1!=d){var f="";-1==d?f="data format invalid":2==d?f="access denied":3==d?f="waiting for grant":4==d&&(f="timeout or cancelled");f=Error("auth error:"+
f);f.code=d;a._socket.end();a._finish(f)}else a._state=3,a.code&&(20>a.code.length?(d=b._str2b64arr(a.code.trim()),f=[d.length+5,0,0,0,0,d.length,0],f=f.concat(d),f=b._buildReq(f)):f=b._buildReq(b._hex2arr(a.code.trim()))),b._logger&&b._logger.log("trace","send samsung request:"+b._arr2hex(f)),a._socket.write(new Buffer(f));else 3==a._state&&(a._socket.end(),a._finish())},onClose:function(){a._finish()}},function(d,f){if(d)a._finish(d);else{a._socket=f;var k=b._buildAuth();a._state=2;b._logger&&b._logger.log("trace",
"send samsung auth request:"+b._arr2hex(k));f.write(new Buffer(k))}})};c.prototype._finish=function(b){b&&this._tv._logger.log("warn","execute samsung command error:"+b.message);this.callback&&this.callback(b);this.callback=null;this._tv._finishTask(this)};var e=function(b,a){this.ip=b;this.port=a;this.port||(this.port=55E3);this._logger=require("x.logger.js").getLogger("xnm.aio.samsung.TV");this._tasks=[]};e.HEADER=[0,19,0,105,112,104,111,110,101,46,105,97,112,112,46,115,97,109,115,117,110,103];
e.prototype._executeCommand=function(b,a){var d=new c(b,a);this._addTask(d)};e.prototype._addTask=function(b){var a=this._tasks.length;this._tasks.push(b);0==a&&this._doNextTask()};e.prototype._doNextTask=function(){this._tasks&&0<this._tasks.length&&this._tasks[0].run(this)};e.prototype._finishTask=function(b){this._tasks&&this._tasks[0]===b&&(this._tasks.splice(0,1),this._doNextTask())};e.prototype._buildAuth=function(){var b=this._str2b64arr("127.0.0.1"),a=[b.length&255,b.length>>8&255],d=this._str2b64arr("00-00-00-00-00-00"),
f=[d.length&255,d.length>>8&255],k=this._str2b64arr("aioRemote"),h=[k.length&255,k.length>>8&255],c=4+b.length+2+d.length+2+k.length,c=[c&255,c>>8&255];return[].concat(e.HEADER).concat(c).concat([100,0]).concat(a).concat(b).concat(f).concat(d).concat(h).concat(k)};e.prototype._resolveAuthRsp=function(b){if(3>b.length)return-1;var a=(b[2]<<8)+b[1];if(b.length<3+a)return-1;b=b.slice(3+a);if(2>b.length)return-1;a=(b[1]<<8)+b[0];if(b.length<2+a)return-1;b=b.slice(2,2+a);return 101==b[0]?4:10==b[0]?3:
100==b[0]&&0==b[2]?2:100==b[0]&&1==b[2]?1:-1};e.prototype._buildReq=function(b){return[].concat(e.HEADER).concat(b)};e.prototype._str2b64arr=function(b){b=(new Buffer(b)).toString("base64");for(var a=[],d=0;d<b.length;d++){var f=b.charCodeAt(d);a.push(f)}return a};e.prototype._hex2arr=function(b){for(var a=[],d=0;d<b.length;d+=2)a.push(parseInt(b.substr(d,2),16));return a};e.prototype._arr2hex=function(b){for(var a="",d=0;d<b.length;d++){for(var f=b[d].toString(16);2>f.length;)f="0"+f;a+=f.toUpperCase()}return a};
e.prototype._connect=function(b,a){var d=this,f={port:this.port,host:this.ip},k=!1,h=a,c=require("net").connect(f);b.__socket=c;c.setTimeout(1E4);c.setEncoding("hex");c.on("connect",function(){d._logger.log("trace","connect tcp to:"+d.ip);k=!0;if(h){var a=b.__socket;delete b.__socket;h(null,a)}});c.on("data",function(a){d._logger.log("trace","receive from tcp:"+d.ip+" data:"+a);b.onData(a)});c.on("error",function(a){k?(d._logger.log("trace","tcp:"+d.ip+" error:"+a.message),c.end(),b.onError(a)):(d._logger.log("trace",
"tcp:"+d.ip+" connection error:"+a.message),h&&(h(a),h=null))});c.on("timeout",function(){k?(d._logger.log("trace","tcp:"+d.ip+" data timeout"),c.end(),b.onTimeout()):(d._logger.log("trace","tcp:"+d.ip+" connection timeout"),c.end(),h&&(h(Error("connection timeout")),h=null))});c.on("close",function(){d._logger.log("trace","tcp:"+d.ip+" close socket");b.onClose()});c._doConnect&&"function"==typeof c._doConnect&&c._doConnect()};return e}();
xnm.aio.samsung.SmartHomeCloud=function(){var c=null,e=0,b=function(a,d){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.samsung.SmartHomeCloud");this._accessKey=a;this.userID=this.accessToken=null;this._appID="4199tgd4z8";this._appSecret="8913F3FF4E064526126408E0AD6E5911";this._channelKey="npbKUFXrEeIxhTwz3L3KrDI1GdooCfS37bG1dmSKctk=";this.userID=this.accessToken=null;c||(c=xnm.aio.samsung.SmartHomeCloud._StatusBuffer,e=xnm.aio.samsung.SmartHomeCloud._StatusBufferTO);
d?(this._server="simulator.cspserver.net",this._api="/api"):(this._server="api2.cspserver.net",this._api="/bridge/api");this.CommandHandler=null;this._getStateRunning=!1;this._getStateCallbacks=[]};b.prototype._sendRequest=function(a,d,f,b){var h=this;this.accessToken&&this.userID?this._doRequest(a,d,f,function(c,g,l){c&&401==l?(h._logger.log("debug","send request auth error"),h._getAuthToken(function(c){c?b&&b(c):h._doRequest(a,d,f,b)})):b&&b(c,g)}):(h._logger.log("debug","no accessToken or userID, do get auth token"),
this._getAuthToken(function(c){c?b&&b(c):h._sendRequest(a,d,f,b)}))};b.prototype._doRequest=function(a,d,b,c){a={host:this._server,path:this._api+d,method:a,headers:{"x-csp-channel-key":this._channelKey,"x-csp-appId":this._appID,"x-csp-userId":this.userID,Authorization:"Bearer "+this.accessToken,Connection:"close","Content-Type":"application/json;  charset=UTF-8"}};b&&(a.headers["Content-Length"]=b.length);d=require("https");"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED=
"0");this._logger.log("trace","do request:"+JSON.stringify(a));var h=this,e=c,g=d.request(a,function(a){a.setEncoding("utf-8");var d="";a.on("data",function(a){d+=a});a.on("end",function(){h._logger.log("trace","receive code:"+a.statusCode+" headers:"+JSON.stringify(a.headers)+" response:"+d);var b,f;if(204!=a.statusCode)try{f=d?JSON.parse(d):{}}catch(c){b=c}204==a.statusCode?f={}:401==a.statusCode?b=Error("auth error"):200!=a.statusCode&&(b=Error("http reponse:"+a.statusCode));e&&(e(b,f,a.statusCode),
e=null)})});if(g.on)g.on("error",function(a){h._logger.log("trace","do request error:"+a.message);e&&(e(a),e=null)});g.setTimeout&&g.setTimeout(2E3,function(){h._logger.log("trace","do request timeout");g.abort();e&&(e(Error("timeout")),e=null)});b&&(this._logger.log("trace","do request send body:"+b),g.write(b));g.end()};b.prototype._getAuthToken=function(a){var d=this,b=a;$.ajax({type:"GET",url:"https://smsng.mediola.com/getAccessToken?ak="+this._accessKey,timeout:4E3,cache:!1,dataType:"json",success:function(a){d._logger.log("trace",
"get auth token response:"+JSON.stringify(a));var c;a&&a.XC_SUC?(d.userID=a.XC_SUC.user,d.accessToken=a.XC_SUC.token):c=a&&a.XC_ERR?Error(a.XC_ERR):Error("get auth token error:"+a?JSON.stringify(a):"empty");b&&(b(c,a,200),b=null)},error:function(a,c){var e="get auth token error:"+(a?a.status:"0")+"-"+c;d._logger.log("trace",e);b&&(b(Error(e),a?a.responseText:null,a?a.status:null),b=null)}})};b.prototype._getBufferedStatus=function(a){for(var d in c)if(c.hasOwnProperty(d)){var b=c[d];if(b&&b.states&&
b.states[a])return b.states[a]}return null};b.prototype._getStates=function(a){var d=this;if(c[d._accessKey]&&c[d._accessKey].states){var b=c[d._accessKey].time;if(b&&(new Date).getTime()-b<e){a&&a(null,c[d._accessKey].states);return}}a&&-1==this._getStateCallbacks.indexOf(a)&&this._getStateCallbacks.push(a);this._getStateRunning||(this._getStateRunning=!0,this.getDevices(function(a,b){d._getStateRunning=!1;var f=d._getStateCallbacks;d._getStateCallbacks=[];if(a)f.forEach(function(d){d&&d(a)});else if(b&&
b.Devices){var g={},e=b.Devices;if(e)for(var r=0;r<e.length;r++)if(e[r]&&e[r].id){var p=xnm.aio.samsung.SmartHomeCloud._AlarmBuffer[e[r].id],m=JSON.parse(JSON.stringify(e[r]));m.Alarms=p;p=null;switch(m.type){case "Refrigerator":p=d._resolveFridgeStates(m);break;case "Washer":p=d._resolveWasherStates(m);break;case "Air_Conditioner":p=d._resolveACStates(m);break;case "Oven":p=d._resolveOvenStates(m);break;case "Dryer":p=d._resolveDryerStates(m);break;case "Robot_Cleaner":p=d._resolveRobotStates(m);
break;case "Air_Purifier":p=d._resolveAPStates(m)}p&&(g[e[r].id]=p)}c[d._accessKey]={time:(new Date).getTime(),states:g};f.forEach(function(a){a&&a(null,g)})}else f.forEach(function(a){a&&a(null,{})})}))};b.prototype._resolveFridgeStates=function(a){var d={};"undefined"!=typeof a.connected&&null!=a.connected&&(d.frdgConn=a.connected);a.Doors&&a.Doors.forEach(function(a){a&&a.id&&(a.openState&&(d["frdgDoorState"+a.id]="Close"==a.openState?"closed":"open"),a.name&&(d["frdgDoorName"+a.id]=a.name))});
if(a.Fridge&&a.Fridge.filterState){var b;switch(a.Fridge.filterState){case "1":b="good";break;case "2":b="order";break;case "3":b="replace"}b&&(d.frdgFilterState=b)}a.Temperatures&&a.Temperatures.forEach(function(a){if(a&&a.id){if(a.unit)switch(a.unit){case "Fahrenheit":d["frdgTempUnit"+a.id]="\u00b0F";break;case "Celsius":d["frdgTempUnit"+a.id]="\u00b0C";break;default:d["frdgTempUnit"+a.id]=a.unit}"undefined"!=typeof a.desired&&null!=a.desired&&(d["frdgTempState"+a.id]=parseFloat(a.desired).toFixed(1))}});
a.Mode&&a.Mode.modes&&(-1!=a.Mode.modes.indexOf("WATERFILTER_DISABLE")?d.frdgWFState="good":-1!=a.Mode.modes.indexOf("WATERFILTER_ENABLE")&&(d.frdgWFState="replace"));if(a.Alarms&&a.Alarms[0]){b=a.Alarms[0].id;a=a.Alarms[0].code;switch(a){case "71E":a="Freeze_High_Temp";break;case "72E":a="Fridge_High_Temp";break;case "F-Alarm":switch(b){case "0":a="Freeze_Door_Alarm";break;case "1":a="Fridge_Door_Alarm";break;case "2":a="CV_Door_Alarm";break;case "3":a="Single_Door_Alarm"}}d.frdgError=a}d.frdgError||
(d.frdgError="");return d};b.prototype._resolveWasherStates=function(a){var d={};"undefined"!=typeof a.connected&&null!=a.connected&&(d.wshConn=a.connected);if(a.Operation&&(a.Operation.progress&&(d.wshProgress=a.Operation.progress.toLowerCase()),a.Operation.state&&(d.wshState=a.Operation.state.toLowerCase()),a.Operation.remainingTime)){d.wshRTStr=a.Operation.remainingTime;var b=a.Operation.remainingTime.split(":");if(2<=b.length){var c=parseInt(b[0]),b=parseInt(b[1]);d.wshRT=60*c+b}}a.Configuration&&
(d.wshSmC=a.Configuration.remoteControlEnabled?"on":"off");a.Alarms&&a.Alarms[0]&&(d.wshError=a.Alarms[0].code);d.wshError||(d.wshError="");return d};b.prototype._resolveACStates=function(a){var d={};if("undefined"!=typeof a.connected&&null!=a.connected)switch(a.deviceSubType){case "FAC":d.facConn=a.connected;break;case "Room_Air_Conditioner":d.racConn=a.connected}if(a.Operation){var b;a.Operation.power&&(b=a.Operation.power.toLowerCase());switch(a.deviceSubType){case "FAC":d.facPower=b;break;case "Room_Air_Conditioner":d.racPower=
b}}a.Temperatures&&a.Temperatures.forEach(function(b){if(b&&b.id){var f;if(b.unit){switch(b.unit){case "Fahrenheit":f="\u00b0F";break;case "Celsius":f="\u00b0C";break;default:f=b.unit}switch(a.deviceSubType){case "FAC":d.facTempUnit=f;break;case "Room_Air_Conditioner":d.racTempUnit=f}}if("undefined"!=typeof b.desired&&null!=b.desired)switch(f=parseFloat(b.desired).toFixed(1),a.deviceSubType){case "FAC":d.facSetTemp=f;break;case "Room_Air_Conditioner":d.racSetTemp=f}if("undefined"!=typeof b.current&&
null!=b.current)switch(b=parseFloat(b.current).toFixed(1),a.deviceSubType){case "FAC":d.facTemp=b;break;case "Room_Air_Conditioner":d.racTemp=b}}});if(a.Mode&&a.Mode.modes&&a.Mode.modes&&a.Mode.modes[0])switch(b=a.Mode.modes[0],a.deviceSubType){case "FAC":d.facMode=b;break;case "Room_Air_Conditioner":d.racMode=b}if(a.Mode&&a.Mode.options){var c;-1!=a.Mode.options.indexOf("Smarton_LockOff")?c="on":-1!=a.Mode.options.indexOf("Smarton_LockOn")&&(c="off");switch(a.deviceSubType){case "FAC":d.facSmC=c}}a.Alarms&&
a.Alarms[0]&&("Room_Air_Conditioner"==a.deviceSubType?d.racError=a.Alarms[0].code:d.facError=a.Alarms[0].code);"Room_Air_Conditioner"==a.deviceSubType?d.racError||(d.racError=""):d.facError||(d.facError="");return d};b.prototype._resolveOvenStates=function(a){var d={},b=this._getBufferedStatus(a.id);b&&(d.ovenTemp=b.ovenTempRaw,d.ovenTempRaw=b.ovenTempRaw,d.ovenState=b.ovenState,d.ovenTempStr=b.ovenTempRaw);"undefined"!=typeof a.connected&&null!=a.connected&&(d.ovenConn=a.connected);a.Temperatures&&
a.Temperatures.forEach(function(a){if(a&&a.id){if(a.unit)switch(a.unit){case "Fahrenheit":d.ovenTempUnit="\u00b0F";break;case "Celsius":d.ovenTempUnit="\u00b0C";break;default:d.ovenTempUnit=a.unit}"undefined"!=typeof a.desired&&null!=a.desired&&(d.ovenTemp=parseFloat(a.desired).toFixed(1),d.ovenTempRaw=d.ovenTemp,d.ovenTempStr=d.ovenTemp)}});if(a.Operation&&(a.Operation.state&&(d.ovenOp=a.Operation.state.toLowerCase()),a.Operation.operationTime&&(d.ovenOTStr=a.Operation.operationTime),a.Operation.remainingTime)){d.ovenRTStr=
a.Operation.remainingTime;var c=a.Operation.remainingTime.split(":");2<=c.length&&(b=parseInt(c[0]),c=parseInt(c[1]),d.ovenRT=60*b+c)}a.Oven&&a.Oven.state&&(d.ovenState=a.Oven.state);if(a.Alarms&&a.Alarms[0])switch(a=a.Alarms[0].code,a){case "OV_T_0001":d.ovenError="Preheating finish";break;case "OV_T_0003":d.ovenError="Cooking finish";break;case "OV_T_0004":d.ovenError="Almost finished cooking";break;case "OV_T_0005":d.ovenError="Cooking was finished";break;case "OV_T_0006":d.ovenError="Cancellation while cooking";
break;case "OV_T_0007":d.ovenError="Cleaning mode finish";break;case "OV_T_0008":d.ovenError="Cleaning mode cancel";break;default:"OV_E_"==a.substr(0,5)&&(d.ovenError="ErrorCode_"+a.substr(5))}d.ovenError||(d.ovenError="");switch(d.ovenState){case "Preheat":case "Cleaning":case "Draining":case "Cooling":case "Rinsing":d.ovenTemp=0,d.ovenTempStr="--"}return d};b.prototype._resolveDryerStates=function(a){var d={};"undefined"!=typeof a.connected&&null!=a.connected&&(d.dryConn=a.connected);if(a.Operation&&
(a.Operation.progress&&(d.dryProgress=a.Operation.progress.toLowerCase()),a.Operation.state&&(d.dryState=a.Operation.state.toLowerCase()),a.Operation.remainingTime)){d.dryRTStr=a.Operation.remainingTime;var b=a.Operation.remainingTime.split(":");if(2<=b.length){var c=parseInt(b[0]),b=parseInt(b[1]);d.dryRT=60*c+b}}a.Configuration&&(d.drySmC=a.Configuration.remoteControlEnabled?"on":"off");a.Alarms&&a.Alarms[0]&&(d.dryError=a.Alarms[0].code);d.dryError||(d.dryError="");return d};b.prototype._resolveRobotStates=
function(a){var d={};"undefined"!=typeof a.connected&&null!=a.connected&&(d.rbtConn=a.connected);if(a.Mode&&a.Mode.modes){for(var b,c,h,e,g,l,r,p=0;p<a.Mode.modes.length;p++){var m=a.Mode.modes[p];m&&"Control"==m.substr(0,7)?b=m:m&&"Cleaning"==m.substr(0,8)?c=m:m&&"Turbo"==m.substr(0,5)?h=m:m&&"Access"==m.substr(0,6)&&(e=m);switch(m){case "Control_Homing":g="Stop cleaning & Return";break;case "Control_Idle":g="Idle";break;case "Control_Alarm":g="Alarming";break;case "Control_After":g="Returning for charging";
break;case "Control_Charging":g="Charging";break;case "Control_Pause":g="Pause";break;case "Control_PowerOff":g="Power off";break;case "Control_Reserve":g="Clean reserved (one time)";break;case "Control_Cleaning":g="Cleaning status";break;case "Control_Point":g="Point Cleaning";break;case "Cleaning_Auto":l="Start cleaning";break;case "Cleaning_Part":l="Parts Cleaning";break;case "Cleaning_Repeat":l="Repeat cleaning";break;case "Cleaning_Manual":l="Manual cleaning";break;case "Cleaning_Stop":l="Stop";
break;case "Turbo_On":r="Max";break;case "Turbo_Off":r="Normal";break;case "Turbo_Silence":r="Quiet"}}b&&g&&(d.rbtCtrMode=b,d.rbtCtrModeStr=g);c&&l&&(d.rbtClnMode=c,d.rbtClnModeStr=l);h&&r&&(d.rbtTrbMode=h,d.rbtTrbModeStr=r);"Control_Point"==d.rbtCtrMode&&(d.rbtClnMode="Cleaning_Manual",d.rbtClnModeStr="Manual cleaning");"Access_UnLock"==e?d.rbtRC="on":"Access_Lock"==e&&(d.rbtRC="off")}a.Alarms&&a.Alarms[0]&&(a=a.Alarms[0].code,d.rbtError="4"==a?"Normal":a);d.rbtError||(d.rbtError="");return d};b.prototype._resolveAPStates=
function(a){var d={};"undefined"!=typeof a.connected&&null!=a.connected&&(d.apConn=a.connected);a.Operation&&a.Operation.power&&(d.apPower=a.Operation.power.toLowerCase());a.Sensors&&a.Sensors.forEach(function(a){if(a&&a.type&&a.values)switch(a.type){case "Dust":d.apDust=a.values[0];d.apDustLvl=a.values[1];break;case "FineDust":d.apFDust=a.values[0];d.apFDustLvl=a.values[1];break;case "Odor":d.apOdorLvl=a.values[0]}});a.Wind&&(d.apWSLvl=a.Wind.speedLevel,0==a.Wind.speedLevel?d.apWS="Auto":1==a.Wind.speedLevel?
d.apWS="Sleeping":2==a.Wind.speedLevel?d.apWS="Low":3==a.Wind.speedLevel?d.apWS="Medium":4==a.Wind.speedLevel&&(d.apWS="High"));a.Alarms&&a.Alarms[0]&&(d.apError=a.Alarms[0].code);d.apError||(d.apError="");return d};b.prototype._executeCommand=function(a,d,b){if(a&&a.id&&a.type&&d&&d.value){var c=function(a){b&&b(a)};switch(a.type){case "Washer":this._execWasherCmd(a,d,c);break;case "Air_Conditioner":this._execACCmd(a,d,c);break;case "Oven":this._execOvenCmd(a,d,c);break;case "Dryer":this._execDryerCmd(a,
d,c);break;case "Robot_Cleaner":this._execRobotCmd(a,d,c);break;case "Air_Purifier":this._execAPCmd(a,d,c);break;default:b&&b(Error("unknown device type"))}}else b&&b(Error("parameter invalid"))};b.prototype._execWasherCmd=function(a,b,c){var e,h;switch(b.value){case "wshRun":e="Operation";h={Operation:{state:"Run"}};break;case "wshPause":e="Operation";h={Operation:{state:"Pause"}};break;case "wshCancel":e="Operation",h={Operation:{state:"Ready"}}}e&&h?this._sendRequest("PUT","/devices/"+a.id+"/"+
e,JSON.stringify(h),function(a){c&&c(a)}):c&&c(Error("command invalid"))};b.prototype._execACCmd=function(a,b,c){var e,h,n=this,g=this._getBufferedStatus(a.id);switch(b.value){case "facOn":case "racOn":e="Operation";h={Operation:{power:"On"}};break;case "facOff":case "racOff":e="Operation";h={Operation:{power:"Off"}};break;case "facToggle":case "racToggle":this._getStates(function(e,g){if(e)c&&c(e);else if(g&&g[a.id]){var h=g[a.id],h="facToggle"==b.value?h.facPower:h.racPower;"on"==h?n._execACCmd(a,
{value:"facToggle"==b.value?"facOff":"racOff"},c):"off"==h?n._execACCmd(a,{value:"facToggle"==b.value?"facOn":"racOn"},c):c&&c(Error("no valid status"))}else c&&c(Error("no status"))});return;case "facSetTo":case "racSetTo":if(!b.ext){c&&c(Error("command invalid"));return}e="Temperatures";h={Temperatures:[{id:"0",desired:parseFloat(b.ext)}]};break;case "facTempUp":case "facTempDown":case "racTempUp":case "racTempDown":if(g&&("Wind"==g.racMode||"Wind"==g.facMode)){e=null;e="facTempUp"==b.value||"facTempDown"==
b.value?"facError":"racError";xnm.aio.samsung.SmartHomeNotifyManager.onDummyNotification(a,e,"no temp. change in this mode");c&&c(Error("can not change temperature in wind mode"));return}if(!b.ext){c&&c(Error("command invalid"));return}this._getStates(function(e,g){if(e)c&&c(e);else if(g&&g[a.id]){var h=g[a.id],k=18,t=30,q;"facTempUp"==b.value||"facTempDown"==b.value?(q=h.facSetTemp,h=h.facTempUnit):(q=h.racSetTemp,h=h.racTempUnit);if(q){q=parseFloat(q);"\u00b0F"==h&&(k=65,t=86);h=parseFloat(b.ext);
if("facTempUp"==b.value||"racTempUp"==b.value)q+=h;else if("facTempDown"==b.value||"racTempDown"==b.value)q-=h;q>t&&(q=t);q<k&&(q=k);n._execACCmd(a,{value:"facTempUp"==b.value||"facTempDown"==b.value?"facSetTo":"racSetTo",ext:q},c)}else c&&c(Error("no valid status"))}else c&&c(Error("no status"))});return;case "facSetMode":case "racSetMode":if(!b.ext){c&&c(Error("command invalid"));return}e="Mode";h={Mode:{modes:[b.ext]}}}e&&h?this._sendRequest("PUT","/devices/"+a.id+"/"+e,JSON.stringify(h),function(a){c&&
c(a)}):c&&c(Error("command invalid"))};b.prototype._execOvenCmd=function(a,b,c){var e,h;switch(b.value){case "ovenStop":e="Operation",h={Operation:{state:"Ready"}}}e&&h?this._sendRequest("PUT","/devices/"+a.id+"/"+e,JSON.stringify(h),function(a){c&&c(a)}):c&&c(Error("command invalid"))};b.prototype._execDryerCmd=function(a,b,c){var e,h;switch(b.value){case "dryRun":e="Operation";h={Operation:{state:"Run"}};break;case "dryPause":e="Operation";h={Operation:{state:"Pause"}};break;case "dryCancel":e=
"Operation",h={Operation:{state:"Ready"}}}e&&h?this._sendRequest("PUT","/devices/"+a.id+"/"+e,JSON.stringify(h),function(a){c&&c(a)}):c&&c(Error("command invalid"))};b.prototype._execRobotCmd=function(a,b,c){var e,h;switch(b.value){case "rbtStart":e="Mode";h={Mode:{modes:["Cleaning_Auto"]}};break;case "rbtStop":e="Mode";h={Mode:{modes:["Control_Homing"]}};break;case "rbtTurbo":if(!b.ext){c&&c(Error("command ext invalid"));return}switch(b.ext){case "Max":b="Turbo_On";break;case "Normal":b="Turbo_Off";
break;case "Quiet":b="Turbo_Silence";break;default:c&&c(Error("command ext invalid"));return}e="Mode";h={Mode:{modes:[b]}}}e&&h?this._sendRequest("PUT","/devices/"+a.id+"/"+e,JSON.stringify(h),function(a){c&&c(a)}):c&&c(Error("command invalid"))};b.prototype._execAPCmd=function(a,b,c){var e,h,n=this;switch(b.value){case "apOn":e="Operation";h={Operation:{power:"On"}};break;case "apOff":e="Operation";h={Operation:{power:"Off"}};break;case "apToggle":this._getStates(function(b,d){if(b)c&&c(b);else if(d&&
d[a.id]){var e=d[a.id],e=e.apPower;"on"==e?n._execAPCmd(a,{value:"apOff"},c):"off"==e?n._execAPCmd(a,{value:"apOn"},c):c&&c(Error("no valid status"))}else c&&c(Error("no status"))});return;case "rbtSetWS":case "rbtSetWSLvl":if("undefined"==typeof b.ext||null==b.ext){c&&c(Error("command invalid"));return}var g;if("rbtSetWS"==b.value)switch(b.ext){case "Auto":g=0;break;case "Sleeping":g=1;break;case "Low":g=2;break;case "Medium":g=3;break;case "High":g=4}else g=parseInt(b.ext);4<g&&(g=4);0>g&&(g=0);
e="Wind";h={Wind:{speedLevel:g}};break;case "rbtSetWSUp":case "rbtSetWSDown":this._getStates(function(e,h){if(e)c&&c(e);else if(h&&h[a.id]){var g;g=h[a.id].apWSLvl;"undefined"==typeof g||null==g?c&&c(Error("no valid status")):(g=parseInt(g),"rbtSetWSUp"==b.value?g+=1:"rbtSetWSDown"==b.value&&--g,4<g&&(g=4),0>g&&(g=0),n._execAPCmd(a,{value:"rbtSetWSLvl",ext:g},c))}else c&&c(Error("no status"))});return}e&&h?this._sendRequest("PUT","/devices/"+a.id+"/"+e,JSON.stringify(h),function(a){c&&c(a)}):c&&c(Error("command invalid"))};
b.prototype.subscibe=function(a,b){this._sendRequest("POST","/subscriptions",JSON.stringify({Subscriptions:a}),function(a){b&&b(a)})};b.prototype.getDevices=function(a){this._sendRequest("GET","/devices",null,function(b,c){a&&a(b,c)})};b.prototype.getDeviceList=function(a){this.getDevices(function(b,c){if(b)a&&a(b);else if(c&&c.Devices){for(var e=[],h=c.Devices,n=0;n<h.length;n++){var g=h[n],l=null;if(g){switch(g.type){case "Refrigerator":g.sys="samsung_smarthome";delete g.resources;l=g;break;case "Washer":g.sys=
"samsung_smarthome";delete g.resources;delete g.Operation;delete g.Configuration;l=g;break;case "Air_Conditioner":g.sys="samsung_smarthome";delete g.resources;delete g.Operation;delete g.Temperatures;delete g.Mode;l=g;break;case "Oven":g.sys="samsung_smarthome";delete g.resources;delete g.Operation;delete g.Temperatures;delete g.Configuration;delete g.Oven;l=g;break;case "Dryer":g.sys="samsung_smarthome";delete g.resources;delete g.Operation;delete g.Configuration;l=g;break;case "Robot_Cleaner":g.sys=
"samsung_smarthome";delete g.resources;delete g.Mode;l=g;break;case "Air_Purifier":g.sys="samsung_smarthome",delete g.resources,delete g.Operation,delete g.Sensors,delete g.Wind,l=g}l&&e.push(l)}}a&&a(null,e)}else a&&a(null,[])})};b.prototype.executeCommand=function(a,b,c){cmd=JSON.stringify({Temperatures:[{desired:23,id:"0"}]});this._doRequest("PUT","/devices/"+a.address+"/Temperatures",cmd,function(a){XC.debugf(a);c&&c()})};b.prototype.executeCommandCreator=function(a,b,c){this._executeCommand(a,
b,c)};b.prototype.getStatesCreator=function(a,b,c){b?0==b.length?c&&c(null,[]):this._getStates(function(a,e){if(a)c&&c(a);else{for(var n=[],g=0;g<b.length;g++)if(b[g]&&b[g].id){var l="?";b[g].device&&b[g].device.id&&b[g].status&&b[g].status.value&&e&&e[b[g].device.id]&&(l=e[b[g].device.id][b[g].status.value],"undefined"==typeof l||null==l)&&(l="?");n.push({id:b[g].id,status:l})}c&&c(null,n)}}):c&&c(Error("deviceList is null"))};b.prototype.equalsTo=function(a){return a&&a instanceof b?this._accessKey==
a._accessKey:!1};b.prototype.toJSON=function(){return{sys:"samsung_smarthome",accessKey:this._accessKey}};b.parseJSON=function(a){return a.accessKey?new b(a.accessKey,a.test):null};return b}();xnm.aio.samsung.SmartHomeCloud._StatusBuffer={};xnm.aio.samsung.SmartHomeCloud._StatusBufferTO=5E3;xnm.aio.samsung.SmartHomeCloud._AlarmBuffer={};
xnm.aio.samsung.SmartHomeCloud.DM=function(){var c={command:[{type:"enum",name:"run",ref:{value:"wshRun"}},{type:"enum",name:"pause",ref:{value:"wshPause"}},{type:"enum",name:"cancel",ref:{value:"wshCancel"}}],status:[{type:"enum",name:"connected",ref:{value:"wshConn",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"wshState",options:["ready","run","pause"]}},{type:"enum",name:"progress",ref:{value:"wshProgress",options:"finish delaywash weightsensing prewash wash rinse spin drying cooling wrinkleprevent airwash none".split(" ")}},
{type:"string",name:"remaining time (string)",ref:{value:"wshRTStr"}},{type:"int",name:"remaining time",ref:{value:"wshRT",extMeta:"0-180"}},{type:"enum",name:"Smart Control state",ref:{value:"wshSmC",options:["on","off"]}},{type:"enum",name:"error state",ref:{value:"wshError",options:["FilterAlarm","DrumClean","ErrorCode_%d"]}}]},e={command:[{type:"enum",name:"power on",ref:{value:"facOn"}},{type:"enum",name:"power off",ref:{value:"facOff"}},{type:"enum",name:"power toggle",ref:{value:"facToggle"}},
{type:"float",name:"set desired temperature",ref:{value:"facSetTo",ext:"%f",extMeta:"18.0-30.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature up",ref:{value:"facTempUp",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature down",ref:{value:"facTempDown",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"enum",name:"set mode",ref:{value:"facSetMode",ext:"%e",extMeta:["Auto","Cool","Dry","Wind"]}}],status:[{type:"enum",name:"connected",
ref:{value:"facConn",options:["true","false"]}},{type:"enum",name:"power",ref:{value:"facPower",options:["on","off"]}},{type:"float",name:"current temperature",ref:{value:"facTemp"}},{type:"float",name:"desired temperature",ref:{value:"facSetTemp"}},{type:"enum",name:"temperature unit",ref:{value:"facTempUnit",options:["\u00b0C","\u00b0F","NotSupported"]}},{type:"enum",name:"mode",ref:{value:"facMode",options:"Auto Cool Dry Heat Wind CoolClean HeatClean DryClean NotSupported".split(" ")}},{type:"enum",
name:"Smart Control state",ref:{value:"facSmC",options:["on","off"]}},{type:"enum",name:"error state",ref:{value:"facError",options:["FilterAlarm","FilterAlarm_OFF","ErrorCode_%d"]}}]},b={command:[{type:"enum",name:"power on",ref:{value:"racOn"}},{type:"enum",name:"power off",ref:{value:"racOff"}},{type:"enum",name:"power toggle",ref:{value:"racToggle"}},{type:"float",name:"set desired temperature",ref:{value:"racSetTo",ext:"%f",extMeta:"18.0-30.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature up",
ref:{value:"racTempUp",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"float",name:"desired temperature down",ref:{value:"racTempDown",ext:"%f",extMeta:"0.1-5.0",scale:"0.1",unit:"\u00b0C"}},{type:"enum",name:"set mode",ref:{value:"racSetMode",ext:"%e",extMeta:["Auto","Cool","Dry","Wind"]}}],status:[{type:"enum",name:"connected",ref:{value:"racConn",options:["true","false"]}},{type:"enum",name:"power",ref:{value:"racPower",options:["on","off"]}},{type:"float",name:"current temperature",
ref:{value:"racTemp"}},{type:"float",name:"desired temperature",ref:{value:"racSetTemp"}},{type:"enum",name:"temperature unit",ref:{value:"racTempUnit",options:["\u00b0C","\u00b0F","NotSupported"]}},{type:"enum",name:"mode",ref:{value:"racMode",options:"Auto Cool Dry Heat Wind NotSupported".split(" ")}},{type:"enum",name:"error state",ref:{value:"racError",options:["FilterAlarm","FilterAlarm_OFF","ErrorCode_%d"]}}]},a={command:[{type:"enum",name:"stop",ref:{value:"ovenStop"}}],status:[{type:"enum",
name:"connected",ref:{value:"ovenConn",options:["true","false"]}},{type:"enum",name:"operation",ref:{value:"ovenOp",options:["run","ready"]}},{type:"string",name:"remaining time (string)",ref:{value:"ovenRTStr"}},{type:"int",name:"remaining time",ref:{value:"ovenRT",extMeta:"0-180"}},{type:"string",name:"operation time (string)",ref:{value:"ovenOTStr"}},{type:"float",name:"desired temperature",ref:{value:"ovenTemp"}},{type:"string",name:"desired temperature (string)",ref:{value:"ovenTempStr"}},{type:"enum",
name:"temperature unit",ref:{value:"ovenTempUnit",options:["\u00b0C","\u00b0F","NotSupported"]}},{type:"enum",name:"state",ref:{value:"ovenState",options:"Preheat Cooking Cleaning Draining Rinsing Cooling Ready".split(" ")}},{type:"enum",name:"error state",ref:{value:"ovenError",options:["ErrorCode_%d"]}}]},d={command:[{type:"enum",name:"run",ref:{value:"dryRun"}},{type:"enum",name:"pause",ref:{value:"dryPause"}},{type:"enum",name:"cancel",ref:{value:"dryCancel"}}],status:[{type:"enum",name:"connected",
ref:{value:"dryConn",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"dryState",options:["ready","run","pause"]}},{type:"enum",name:"progress",ref:{value:"dryProgress",options:"finish delaywash weightsensing drying cooling wrinkleprevent none".split(" ")}},{type:"string",name:"remaining time (string)",ref:{value:"dryRTStr"}},{type:"int",name:"remaining time",ref:{value:"dryRT",extMeta:"0-180"}},{type:"enum",name:"Smart Control state",ref:{value:"drySmC",options:["on","off"]}},{type:"enum",
name:"error state",ref:{value:"dryError",options:["FilterAlarm","DrumClean","ErrorCode_%d"]}}]},f={command:[{type:"enum",name:"start cleaning",ref:{value:"rbtStart"}},{type:"enum",name:"stop cleaning",ref:{value:"rbtStop"}},{type:"enum",name:"set turbo mode",ref:{value:"rbtTurbo",ext:"%e",extMeta:["Max","Normal","Quiet"]}}],status:[{type:"enum",name:"connected",ref:{value:"rbtConn",options:["true","false"]}},{type:"enum",name:"control mode",ref:{value:"rbtCtrMode",options:"Control_Homing Control_Idle Control_Alarm Control_After Control_Charging Control_Pause Control_PowerOff Control_Reserve Control_Cleaning Control_Point".split(" ")}},
{type:"string",name:"control mode (description)",ref:{value:"rbtCtrModeStr"}},{type:"enum",name:"cleaning mode",ref:{value:"rbtClnMode",options:["Cleaning_Auto","Cleaning_Part","Cleaning_Repeat","Cleaning_Manual","Cleaning_Stop"]}},{type:"string",name:"cleaning mode (description)",ref:{value:"rbtClnModeStr"}},{type:"enum",name:"turbo mode",ref:{value:"rbtTrbMode",options:["Turbo_On","Turbo_Off","Turbo_Silence"]}},{type:"string",name:"turbo mode (description)",ref:{value:"rbtTrbModeStr"}},{type:"enum",
name:"Smart Control state",ref:{value:"rbtRC",options:["on","off"]}},{type:"enum",name:"error state",ref:{value:"rbtError",options:["Normal","ErrorCode_%d"]}}]},k={command:[{type:"enum",name:"power on",ref:{value:"apOn"}},{type:"enum",name:"power off",ref:{value:"apOff"}},{type:"enum",name:"power toggle",ref:{value:"apToggle"}},{type:"enum",name:"set wind speed",ref:{value:"rbtSetWS",ext:"%e",extMeta:["Auto","Sleeping","Low","Medium","High"]}},{type:"int",name:"set wind speed level",ref:{value:"rbtSetWSLvl",
ext:"%d",extMeta:"0-4"}},{type:"enum",name:"wind speed up",ref:{value:"rbtSetWSUp"}},{type:"enum",name:"wind speed down",ref:{value:"rbtSetWSDown"}}],status:[{type:"enum",name:"connected",ref:{value:"apConn",options:["true","false"]}},{type:"enum",name:"power",ref:{value:"apPower",options:["on","off"]}},{type:"float",name:"PM 10.0 value",ref:{value:"apDust"}},{type:"int",name:"PM 10.0 level",ref:{value:"apDustLvl"}},{type:"float",name:"PM 2.5 value",ref:{value:"apFDust"}},{type:"int",name:"PM 2.5 level",
ref:{value:"apFDustLvl"}},{type:"int",name:"Gas level",ref:{value:"apOdorLvl"}},{type:"enum",name:"wind speed",ref:{value:"apWS",options:["Auto","Sleeping","Low","Medium","High"]}},{type:"int",name:"wind speed level",ref:{value:"apWSLvl"}},{type:"enum",name:"error state",ref:{value:"apError",options:["ErrorCode_%d"]}}]};return{SYS:"samsung_smarthome",registModule:function(a){a.register(this.SYS,"samsung")},getGatewayType:function(){return{sys:this.SYS,name:"Samsung Smart Home (Cloud)"}},getGatewayDeviceType:function(a){return a.sys==
this.SYS?[{sys:this.SYS,type:"Refrigerator",name:"Smart Refrigerator"}]:null},createGateway:function(a,b,c){b=xnm.aio.samsung.DMError;var d=xnm.aio.samsung.DMError.ERROR_CODE;a?a.accessKey?c(null,a):c(new b(d.INVALID,"accessKey is invalid")):c(new b(d.INVALID,"info is invalid"))},updateGateway:function(a,b,c,d){a=xnm.aio.samsung.DMError;c=xnm.aio.samsung.DMError.ERROR_CODE;b?b.accessKey?d(null,b):d(new a(c.INVALID,"ip is invalid")):d(new a(c.INVALID,"update is invalid"))},deleteGateway:function(a,
b,c){c()},createDevice:function(a,b,c){var d=xnm.aio.samsung.DMError,e=xnm.aio.samsung.DMError.ERROR_CODE;if(a)if(a.gateway)if(null==a.type||"undefined"==typeof a.type)c(new d(e.INVALID,"type is invalid"));else if(null==a.id||"undefined"==typeof a.id)c(new d(e.INVALID,"address is invalid"));else if(b.data&&b.data.gateways&&0!==b.data.gateways.length){b=b.data.gateways;var f,k;for(f=0;f<b.length;f++)if(b[f].index===a.gateway){k=b[f];break}k?c(null,a):c(new d(e.NOT_FOUND,"gateway with index "+a.gateway+
" not exists"))}else c(new d(e.NOT_FOUND,"gateway with index "+a.gateway+" not exists"));else c(new d(e.INVALID,"gateway is invalid"));else c(new d(e.INVALID,"info is invalid"))},updateDevice:function(a,b,c){var d=xnm.aio.samsung.DMError,e=xnm.aio.samsung.DMError.ERROR_CODE;if(a)if(a.gateway)if(null==a.type||"undefined"==typeof a.type)c(new d(e.INVALID,"type is invalid"));else if(null==a.id||"undefined"==typeof a.id)c(new d(e.INVALID,"address is invalid"));else if(b.data&&b.data.gateways&&0!==b.data.gateways.length){b=
b.data.gateways;var f,k;for(f=0;f<b.length;f++)if(b[f].index===a.gateway){k=b[f];break}k?c(null,a):c(new d(e.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else c(new d(e.NOT_FOUND,"gateway with index "+a.gateway+" not exists"));else c(new d(e.INVALID,"gateway is invalid"));else c(new d(e.INVALID,"info is invalid"))},deleteDevice:function(a,b,c){c()},getCommandStatusMap:function(h,n){if(!h)return null;switch(h.type){case "Refrigerator":return this._getFridgeMap(h);case "Washer":return c;
case "Air_Conditioner":switch(h.deviceSubType){case "FAC":return e;case "Room_Air_Conditioner":return b;default:return null}case "Oven":return a;case "Dryer":return d;case "Robot_Cleaner":return f;case "Air_Purifier":return k;default:return null}},_getFridgeMap:function(a){var b,c={command:[],status:[]};b={type:"enum",name:"connected",ref:{value:"frdgConn",options:["true","false"]}};c.status.push(b);a.Doors&&a.Doors.forEach(function(a){if(a&&a.id&&a.name){var b={type:"enum",name:a.name+" state",ref:{value:"frdgDoorState"+
a.id,options:["open","closed"]}};c.status.push(b);b={type:"string",name:a.name+" name",ref:{value:"frdgDoorName"+a.id}};c.status.push(b)}});a.Fridge&&(b={type:"enum",name:"filter state",ref:{value:"frdgFilterState",options:["good","order","replace"]}},c.status.push(b));a.Temperatures&&a.Temperatures.forEach(function(a){if(a&&a.id&&a.name){var b={type:"float",name:a.name+" temperature",ref:{value:"frdgTempState"+a.id,extMeta:"-22.0-14.0"}};c.status.push(b);b={type:"enum",name:a.name+" temperature unit",
ref:{value:"frdgTempUnit"+a.id,options:["\u00b0C","\u00b0F","NotSupported"]}};c.status.push(b)}});a.Mode&&a.Mode.modes&&(b={type:"enum",name:"water filter state",ref:{value:"frdgWFState",options:["good","replace"]}},c.status.push(b));b={type:"enum",name:"error state",ref:{value:"frdgError",options:"Freeze_Door_Alarm Freeze_High_Temp Fridge_Door_Alarm Freeze_High_Temp CV_Door_Alarm CV_High_Temp Single_Door_Alarm".split(" ")}};c.status.push(b);return c}}}();
xnm.aio.samsung.SmartHomeNotifyManager={_logger:null,_inited:!1,_listeners:[],_devices:[],init:function(c){if(this._inited)c&&c();else{this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.samsung.SmartHomeNotifyManager");var e=require("xnm.aio.webhook.js");if(e){var b=this;e.start(function(a){a||(b._inited=!0,e.addHandler("samsung_smarthome",b));c&&c(a)})}else c&&c(Error("no webhook lib"))}},addListener:function(c){c&&-1==this._listeners.indexOf(c)&&
this._listeners.push(c)},clearListeners:function(){this._listeners=[]},subscribe:function(c,e,b){var a=require("xnm.aio.webhook.js");if(a){var d;switch(c.sys){case xnm.aio.samsung.SmartHomeCloud.DM.SYS:d=xnm.aio.samsung.SmartHomeCloud.parseJSON(c);break;default:b&&b(Error("do not support"));return}if(d){var f=this;for(c=0;c<e.length;c++){for(var k=!1,h=0;h<this._devices.length;h++)if(e[c]&&this._devices[h]&&e[c].id==this._devices[h].id){k=!0;break}k||this._devices.push(e[c])}d.getDeviceList(function(c,
e){if(c)b&&b(c);else{var h=f._getDeviceIDs(e),k=f._getSubscriptions(e);d.subscibe(h,function(c){c?b&&b(c):a.subscribe("samsung_smarthome",k,b)})}})}else b&&b(Error("gateway json format invalid"))}else b&&b(Error("no webhook lib"))},unsubscribeAll:function(c){var e=require("xnm.aio.webhook.js");e?(this._devices=[],e.unsubscribeType("samsung_smarthome",c)):c&&c(Error("no webhook lib"))},isUniqueSubscribe:function(c,e){if(!c||"samsung_smarthome"!=c.type||!c.device)return!1;for(var b=0;b<e.length;b++)if(e[b]&&
"samsung_smarthome"==e[b].type&&e[b].device==c.device)return!1;return!0},onNotification:function(c){if(c){this._logger.log("trace","receive notification:"+JSON.stringify(c));for(var e,b=0;b<this._devices.length;b++)if(this._devices[b]&&this._devices[b].id==c.id){e=this._handleNotification(this._devices[b],c);break}this._logger.log("trace",this._listeners.length+" resolve state:"+JSON.stringify(e));if(e)for(c=0;c<this._listeners.length;c++)try{this._listeners[c](e)}catch(a){this._logger.log("trace",
"call listener error:"+a.message)}}},onDummyNotification:function(c,e,b){if(c){this._logger.log("trace","receive dummy notification:"+JSON.stringify(c)+" key:"+e+" value:"+b);for(var a=null,d=0;d<this._devices.length;d++)if(this._devices[d]&&this._devices[d].id==c.id){a=this._devices[d];break}if(a)for(c=a._alias+":"+e,e=0;e<this._listeners.length;e++)try{this._listeners[e]([{id:c,status:b}])}catch(f){this._logger.log("trace","call listener error:"+f.message)}}},_handleNotification:function(c,e){var b=
function(a,b){xnm.aio.samsung.SmartHomeCloud._AlarmBuffer[b.id]=b.Alarms;return b};"Alarms"==e.resource&&b(c,e);b=JSON.parse(JSON.stringify(e));"Device"==e.resource&&(b=e.Device,b.id=e.id);b.Alarms=xnm.aio.samsung.SmartHomeCloud._AlarmBuffer[e.id];var a=new xnm.aio.samsung.SmartHomeCloud;if(!c._alias)return null;switch(c.type){case "Refrigerator":b=a._resolveFridgeStates(b);break;case "Washer":b=a._resolveWasherStates(b);break;case "Air_Conditioner":b.deviceSubType=c.deviceSubType;b=a._resolveACStates(b);
break;case "Oven":b=a._resolveOvenStates(b);break;case "Dryer":b=a._resolveDryerStates(b);break;case "Robot_Cleaner":b=a._resolveRobotStates(b);break;case "Air_Purifier":b=a._resolveAPStates(b);break;default:return null}if(!b)return null;(function(a,b){var c=xnm.aio.samsung.SmartHomeCloud._StatusBuffer,d;for(d in c)if(c.hasOwnProperty(d)){var e=c[d],f=!1;e.states||(e.states={});e.states[a.id]||(e.states[a.id]={});for(var k in b)b.hasOwnProperty(k)&&(e.states[a.id][k]=b[k],f=!0);f&&(e.time=(new Date).getTime())}})(c,
b);var d,f=[],k;for(k in b)a=c._alias+":"+k,d=b[k],f.push({id:a,status:d});return f},_getDeviceIDs:function(c){for(var e=[],b=0;b<c.length;b++)c[b]&&c[b].id&&-1==e.indexOf(c[b].id)&&e.push(c[b].id);return e},_getSubscriptions:function(c){for(var e=[],b=[],a=0;a<c.length;a++)c[a]&&c[a].id&&-1==b.indexOf(c[a].id)&&(b.push(c[a].id),e.push({type:"samsung_smarthome",device:c[a].id}));return e}};
xnm.aio.samsung.DMError=function(){var c=function(c,b){this.code=c;this.message=b;this.stack=Error().stack};c.prototype=Error();c.prototype.name="SamsungDmError";c.prototype.code=0;c.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return c}();
xnm.aio.samsung.DM=function(){return{_getSystem:function(c){for(var e in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(e)){var b=xnm.aio.samsung[e];if(b&&b.DM&&b.DM.SYS==c)return b}return null},getGatewayType:function(){var c=[],e;for(e in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(e)){var b=xnm.aio.samsung[e];b&&b.DM&&b.DM.getGatewayType&&(b=b.DM.getGatewayType())&&c.push(b)}return c},getGatewayDeviceType:function(c){var e=[],b;for(b in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(b)){var a=
xnm.aio.samsung[b];a&&a.DM&&a.DM.getGatewayDeviceType&&(a=a.DM.getGatewayDeviceType(c))&&(Array.isArray(a)?e=e.concat(a):e.push(a))}return e},createGateway:function(c,e,b){var a=xnm.aio.samsung.DMError,d=xnm.aio.samsung.DMError.ERROR_CODE;if(c)if(c.sys){var f=this._getSystem(c.sys);f&&f.DM&&f.DM.createGateway?f.DM.createGateway(c,e,b):b&&b(new a(d.INVALID,"no such sys:"+c.sys))}else b&&b(new a(d.INVALID,"sys is invalid"));else b&&b(new a(d.INVALID,"info is invalid"))},updateGateway:function(c,e,b,
a){var d=xnm.aio.samsung.DMError,f=xnm.aio.samsung.DMError.ERROR_CODE;if(e)if(e.sys){var k=this._getSystem(e.sys);k&&k.DM&&k.DM.updateGateway?k.DM.updateGateway(c,e,b,a):a&&a(new d(f.INVALID,"no such sys:"+e.sys))}else a&&a(new d(f.INVALID,"sys is invalid"));else a(new d(f.INVALID,"info is invalid"))},deleteGateway:function(c,e,b){var a=xnm.aio.samsung.DMError,d=xnm.aio.samsung.DMError.ERROR_CODE;if(c)if(c.sys){var f=this._getSystem(c.sys);f&&f.DM&&f.DM.deleteGateway?f.DM.deleteGateway(c,e,b):b&&
b(new a(d.INVALID,"no such sys:"+c.sys))}else b&&b(new a(d.INVALID,"sys is invalid"));else b()},createDevice:function(c,e,b){var a=xnm.aio.samsung.DMError,d=xnm.aio.samsung.DMError.ERROR_CODE;if(c)if(c.sys){var f=this._getSystem(c.sys);f&&f.DM&&f.DM.createDevice?f.DM.createDevice(c,e,b):b&&b(new a(d.INVALID,"no such sys:"+c.sys))}else b&&b(new a(d.INVALID,"sys is invalid"));else b&&b(new a(d.INVALID,"info is invalid"))},updateDevice:function(c,e,b){var a=xnm.aio.samsung.DMError,d=xnm.aio.samsung.DMError.ERROR_CODE;
if(c)if(c.sys){var f=this._getSystem(c.sys);f&&f.DM&&f.DM.updateDevice?f.DM.updateDevice(c,e,b):b&&b(new a(d.INVALID,"no such sys:"+c.sys))}else b&&b(new a(d.INVALID,"sys is invalid"));else b(new a(d.INVALID,"info is invalid"))},deleteDevice:function(c,e,b){var a=xnm.aio.samsung.DMError,d=xnm.aio.samsung.DMError.ERROR_CODE;if(c)if(c.sys){var f=this._getSystem(c.sys);f&&f.DM&&f.DM.deleteDevice?f.DM.deleteDevice(c,e,b):b&&b(new a(d.INVALID,"no such sys:"+c.sys))}else b&&b(new a(d.INVALID,"sys is invalid"));
else b()},applyUIFilter:function(c,e){var b=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},a=function(a,c,d){var e=[];switch(d.catagory){case "command":a.command&&a.command.forEach(function(a){b(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){b(d.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},d=function(b,c){var d=[],e=null,f;b.sys&&(e=this._getSystem(b.sys))&&
e.DM&&e.DM.getCommandStatusMap&&(f=e.DM.getCommandStatusMap(b));f&&(e=a(f,b,c),d=d.concat(e));return d};if(!c.sys)return null;var f=JSON.parse(JSON.stringify(c)),k=null;switch(e.catagory){case "command":k=d.call(this,c,e);f.command=k;break;case "status":k=d.call(this,c,e);f.status=k;break;default:return null}return k&&0!=k.length?f:null}}}();
xnm.aio.samsung.Handler=function(){var c=function(){};c.prototype.devicemanager=xnm.aio.samsung.DM;c.prototype.SamsungTV=xnm.aio.samsung.TV;c.prototype.SmartHomeCloud=xnm.aio.samsung.SmartHomeCloud;c.prototype.SmartHomeNotifyManager=xnm.aio.samsung.SmartHomeNotifyManager;c.prototype.registModule=function(c){for(var b in xnm.aio.samsung)if(xnm.aio.samsung.hasOwnProperty(b)){var a=xnm.aio.samsung[b];a&&a.DM&&a.DM.registModule&&a.DM.registModule(c)}};c.prototype.resolveGateway=function(c){switch(c.sys){case xnm.aio.samsung.SmartHomeCloud.DM.SYS:return xnm.aio.samsung.SmartHomeCloud.parseJSON(c);
default:return null}};c.prototype.getDeviceCommands=function(c,b){var a=xnm.aio.samsung.DM.applyUIFilter(c,{catagory:"command",elems:"*"}),a=a?a.command:[];b&&b(null,a)};c.prototype.getDeviceStatus=function(c,b){var a=xnm.aio.samsung.DM.applyUIFilter(c,{catagory:"status",elems:"*"}),a=a?a.status:[];b&&b(null,a)};c.prototype.doCommand=function(c,b,a,d){c?(c=this.resolveGateway(c))?c.executeCommandCreator(b,a,function(a){d&&d(a)}):d&&d(Error("gateway json format invalid")):d&&d(Error("only support gateway"))};
c.prototype.doStatus=function(c,b,a,d,f){(b=this.resolveGateway(b))?b.getStatesCreator(null,[{id:c,device:a,status:d}],function(a,b){a?f&&f(a):f&&f(null,b[0])}):f&&f(Error("gateway json format invalid"))};c.prototype.getSmartHomeDeviceList=function(c,b){var a=this.resolveGateway(c);a?a.getDeviceList(function(a,c){b&&b(a,c)}):b&&b(Error("gateway json format invalid"))};return c}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.samsung.Handler);
