var xnm=xnm||{};xnm.aio=xnm.aio||{},xnm.aio.devicegroup=xnm.aio.devicegroup||{},xnm.aio.devicegroup.Group=function(){var e=function e(_e){this.info=_e;};return e.prototype.executeCommandCreator=function(e,n,i,r){if(this.info&&this.info.devices){if(n&&n.value){if(r){if(0!=this.info.devices.length){var a=this,o=0,t=function t(e){++o!=a.info.devices.length?a._executeCommand(r,a.info.devices[o],n,t):i&&i();};this._executeCommand(r,this.info.devices[o],n,t);}else i&&i();}else i&&i(new Error("commandhandler invlaid"));}else i&&i(new Error("command value is empty"));}else i&&i(new Error("info devices is invalid"));},e.prototype._executeCommand=function(e,n,i,r){var a={device:{room:n.room,name:n.device},cmd:i};e._executeCommand(a,function(e){r&&r(e);});},e;}(),xnm.aio.devicegroup.DM=function(){var e=function e(_e2,n){this.code=_e2,this.message=n,this.stack=new Error().stack;};return(e.prototype=new Error()).name="DeviceGroupDMError",e.prototype.code=0,e.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6},{SYS:"devicegroup",createDevice:function createDevice(n,i,r){var a=e,o=e.ERROR_CODE;n?n.devices?r(null,n):r(new a(o.INVALID,"devices is invalid")):r(new a(o.INVALID,"info is invalid"));},updateDevice:function updateDevice(n,i,r){var a=e,o=e.ERROR_CODE;n?n.devices?r(null,n):r(new a(o.INVALID,"devices is invalid")):r(new a(o.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(e,n,i){i();},applyUIFilter:function applyUIFilter(e,n,i,r){var a=function a(e,n){if(e.command){for(var i=[],r=0;r<n.length;r++){var a=!1,o=n[r];if(o&&o.ref&&o.ref.value){for(var t=0;t<e.command.length;t++){var c=e.command[r];if(c&&c.ref&&c.ref.value&&o.ref.value==c.ref.value){a=!0;break;}}a||i.push(o);}}e.command=e.command.concat(i);}else e.command=n;},o=function o(e,n){if(e.status){for(var i=[],r=0;r<n.length;r++){var a=!1,o=n[r];if(o&&o.ref&&o.ref.value){for(var t=0;t<e.status.length;t++){var c=e.status[r];if(c&&c.ref&&c.ref.value&&c.ref.value==c.ref.value){a=!0;break;}}a||i.push(o);}}e.status=e.status.concat(i);}else e.status=n;},t=function t(e,i,r){if(!(e&&r&&r.findDevice&&r.dm&&e.devices&&0!=e.devices.length))return null;for(var t={command:[],status:[]},c=0;c<e.devices.length;c++)if(e.devices[c]){var s=e.devices[c].room,u=e.devices[c].device,v=r.findDevice(s,u);if(v&&v.info&&v.info.sys){var f=r.dm.getModule(v.info.sys);if(f&&f.devicemanager&&f.devicemanager.applyUIFilter){var d=f.devicemanager.applyUIFilter(v.info,n,r.deviceinfo,r);d&&(d.command&&a(t,d.command),d.status&&o(t,d.status));}}}return t;},c=function c(e,n){if("*"==e)return!0;for(var i=!1,r=0;r<e.length;r++)if(e[r]==n){i=!0;break;}return i;},s=function s(e,n){var i=[],a=null,o=t(e,0,r);return o&&(a=function(e,n,i){var r=[];switch(i.catagory){case"command":e.command&&e.command.forEach(function(e){if(c(i.elems,e.type)){var n=JSON.parse(JSON.stringify(e));r.push(n);}});break;case"status":e.status&&e.status.forEach(function(e){if(c(i.elems,e.type)){var n=JSON.parse(JSON.stringify(e));r.push(n);}});}return r;}(o,0,n),i=i.concat(a)),i;};if(!e.sys)return null;var u=JSON.parse(JSON.stringify(e)),v=null;switch(n.catagory){case"command":v=s(e,n),u.command=v;break;case"status":v=s(e,n),u.status=v;break;default:return null;}return v&&0!=v.length?u:null;}};}(),xnm.aio.devicegroup.Handler=function(){var e=function e(){};return e.prototype.devicemanager=xnm.aio.devicegroup.DM,e.prototype.registModule=function(e){e.register(this.devicemanager.SYS,"devicegroup");},e.prototype.resolveDevice=function(e){return e&&e.devices?new xnm.aio.devicegroup.Group(e):null;},e;}(),"undefined"!=typeof module&&module&&module.exports&&(module.exports=new xnm.aio.devicegroup.Handler());