var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.devicegroup=xnm.aio.devicegroup||{};
xnm.aio.devicegroup.Group=function(){var a=function(c){this.info=c};a.prototype.executeCommandCreator=function(c,d,b,a){if(this.info&&this.info.devices)if(d&&d.value)if(a)if(0==this.info.devices.length)b&&b();else{var k=this,t=0,h=function(c){t++;t==k.info.devices.length?b&&b():k._executeCommand(a,k.info.devices[t],d,h)};this._executeCommand(a,this.info.devices[t],d,h)}else b&&b(Error("commandhandler invlaid"));else b&&b(Error("command value is empty"));else b&&b(Error("info devices is invalid"))};
a.prototype._executeCommand=function(c,a,b,l){c._executeCommand({device:{room:a.room,name:a.device},cmd:b},function(c){l&&l(c)})};return a}();
xnm.aio.devicegroup.DM=function(){var a=function(c,a){this.code=c;this.message=a;this.stack=Error().stack};a.prototype=Error();a.prototype.name="DeviceGroupDMError";a.prototype.code=0;a.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"devicegroup",createDevice:function(c,d,b){d=a.ERROR_CODE;c?c.devices?b(null,c):b(new a(d.INVALID,"devices is invalid")):b(new a(d.INVALID,"info is invalid"))},updateDevice:function(c,d,b){d=a.ERROR_CODE;c?c.devices?
b(null,c):b(new a(d.INVALID,"devices is invalid")):b(new a(d.INVALID,"info is invalid"))},deleteDevice:function(c,a,b){b()},applyUIFilter:function(a,d,b,l){var k=function(a,b){if("*"==a)return!0;for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},t=function(a,b,c){var d=[];switch(c.catagory){case "command":a.command&&a.command.forEach(function(a){k(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),d.push(a))});break;case "status":a.status&&a.status.forEach(function(a){k(c.elems,a.type)&&
(a=JSON.parse(JSON.stringify(a)),d.push(a))})}return d};b=function(a,c){var b=[],m=null;if(a&&l&&l.findDevice&&l.dm&&a.devices&&0!=a.devices.length)for(var m={command:[],status:[]},k=0;k<a.devices.length;k++){if(a.devices[k]){var f=l.findDevice(a.devices[k].room,a.devices[k].device);if(f&&f.info&&f.info.sys){var e=l.dm.getModule(f.info.sys);if(e&&e.devicemanager&&e.devicemanager.applyUIFilter&&(f=e.devicemanager.applyUIFilter(f.info,d,l.deviceinfo,l))){if(f.command){var e=m,g=f.command;if(e.command){for(var p=
[],q=0;q<g.length;q++){var h=!1,n=g[q];if(n&&n.ref&&n.ref.value){for(var r=0;r<e.command.length;r++){var u=e.command[q];if(u&&u.ref&&u.ref.value&&n.ref.value==u.ref.value){h=!0;break}}h||p.push(n)}}e.command=e.command.concat(p)}else e.command=g}if(f.status)if(e=m,f=f.status,e.status){g=[];for(p=0;p<f.length;p++)if(q=!1,(h=f[p])&&h.ref&&h.ref.value){for(n=0;n<e.status.length;n++)if((r=e.status[p])&&r.ref&&r.ref.value&&r.ref.value==r.ref.value){q=!0;break}q||g.push(h)}e.status=e.status.concat(g)}else e.status=
f}}}}else m=null;m&&(m=t(m,a,c),b=b.concat(m));return b};if(!a.sys)return null;var h=JSON.parse(JSON.stringify(a)),g=null;switch(d.catagory){case "command":g=b(a,d);h.command=g;break;case "status":g=b(a,d);h.status=g;break;default:return null}return g&&0!=g.length?h:null}}}();
xnm.aio.devicegroup.Handler=function(){var a=function(){};a.prototype.devicemanager=xnm.aio.devicegroup.DM;a.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"devicegroup")};a.prototype.resolveDevice=function(a){return a&&a.devices?new xnm.aio.devicegroup.Group(a):null};return a}();"undefined"!=typeof module&&module&&module.exports&&(module.exports=new xnm.aio.devicegroup.Handler);
