var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(a,d,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,c){a!=Array.prototype&&a!=Object.prototype&&(a[d]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,c,b){if(d){c=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var g=a[b];g in c||(c[g]={});c=c[g]}a=a[a.length-1];b=c[a];d=d(b);d!=b&&null!=d&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(d){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>d||1342177279<d)throw new RangeError("Invalid count value");d|=0;for(var b="";d;)if(d&1&&(b+=c),d>>>=1)c+=c;return b}},"es6","es3");var util=require("util"),EventEmitter=require("events"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.bose=x.hub.m.bose||{};x.hub.m.bose.MODULE=require("xnm.aio.bose.js");
x.hub.m.bose.AudioPlayer=function(){var a=function(){this._process={}};a.prototype.playFile=function(d,c,b){if(c&&c.file){var a=require("x.hub.resource.js").getFileURL(c.file,d.ip);a?(c.url=a,this.playUrl(d,c,b)):b&&b(Error("no such file"))}else b&&b(Error("invalid file"))};a.prototype.playUrl=function(d,c,b){if(c&&c.url){var a=x.hub.m.bose.MODULE.resolveDevice(d);if(a){var f=c.url,e=this;this._cancelPlay(a,function(d){d?b&&b(d):e._setVolume(a,c.volume,function(d){d?b&&b(d):e._setRepeat(a,c.repeat,
function(d){d?b&&b(d):e._unmute(a,function(d){d?b&&b(d):e._playUrl(a,f,function(d){d?b&&b(d):c.repeat&&-1!=c.repeat&&(e._process[a.getIP()]={url:f},e._process[a.getIP()].timeout=setTimeout(function(){var b=e._process[a.getIP()].url;e._process[a.getIP()]=null;e._stopPlay(a,b)},1E3*parseInt(c.repeat)))})})})})});b&&b(null,1)}else b&&b(Error("invalid device json"))}else b&&b(Error("invalid url"))};a.prototype._cancelPlay=function(d,c){var b=d.getIP();if(b&&this._process[b]){this._process[b].timeout&&
clearTimeout(this._process[b].timeout);var a=this._process[b].url;this._process[b]=null;a?this._stopPlay(d,a,c):c&&c()}else c&&c()};a.prototype._stopPlay=function(d,c,b){d._getNowPlaying(function(a,f){a||!f?d._clickKey("STOP",b):f.currentURI&&f.currentURI!=c?b&&b():d._clickKey("STOP",b)})};a.prototype._setVolume=function(a,c,b){c?a._setVolume(c,b):b&&b()};a.prototype._setRepeat=function(a,c,b){c?a._clickKey("REPEAT_ONE",b):b&&b()};a.prototype._unmute=function(a,c){c&&c()};a.prototype._playUrl=function(a,
c,b){c?a.playUrl(c,b):b&&b(Error("invalid url"))};return a}();
x.hub.m.bose.Handler=function(){var a=function(){this._audioPlayer=new x.hub.m.bose.AudioPlayer};util.inherits(a,EventEmitter);a.prototype.init=function(a){a&&a()};a.prototype.getSystems=function(){return["bose"]};a.prototype.executeCommand=function(a,c,b){c?"playFile"==c.value?this._audioPlayer.playFile(a,c,function(a){b&&b({error:a})}):"playUrl"==c.value&&(c.repeat||c.volume)?this._audioPlayer.playUrl(a,c,function(a){b&&b({error:a})}):x.hub.m.bose.MODULE.doCommand(a,c,b):b&&b({error:Error("invalid command")})};
return a}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.bose.Handler);
