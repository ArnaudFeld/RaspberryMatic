var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(d,c,b){if(null==d)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return d+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,c,b){if(d==Array.prototype||d==Object.prototype)return d;d[c]=b.value;return d};
$jscomp.getGlobal=function(d){d=["object"==typeof globalThis&&globalThis,d,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<d.length;++c){var b=d[c];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(d,c){var b=$jscomp.propertyToPolyfillSymbol[c];if(null==b)return d[c];b=d[b];return void 0!==b?b:d[c]};$jscomp.polyfill=function(d,c,b,a){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(d,c,b,a):$jscomp.polyfillUnisolated(d,c,b,a))};
$jscomp.polyfillUnisolated=function(d,c,b,a){b=$jscomp.global;d=d.split(".");for(a=0;a<d.length-1;a++){var e=d[a];if(!(e in b))return;b=b[e]}d=d[d.length-1];a=b[d];c=c(a);c!=a&&null!=c&&$jscomp.defineProperty(b,d,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(d,c,b,a){var e=d.split(".");d=1===e.length;a=e[0];a=!d&&a in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var f=e[g];if(!(f in a))return;a=a[f]}e=e[e.length-1];b=$jscomp.IS_SYMBOL_NATIVE&&"es6"===b?a[e]:null;c=c(b);null!=c&&(d?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:c}):c!==b&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(a,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:c})))};$jscomp.polyfill("String.prototype.repeat",function(d){return d?d:function(c){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>c||1342177279<c)throw new RangeError("Invalid count value");c|=0;for(var a="";c;)if(c&1&&(a+=b),c>>>=1)b+=b;return a}},"es6","es3");var util=require("util"),EventEmitter=require("events"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};
x.hub.m.bose=x.hub.m.bose||{};x.hub.m.bose.MODULE=require("xnm.aio.bose.js");
x.hub.m.bose.AudioPlayer=function(){var d=function(){this._process={}};d.prototype.playFile=function(c,b,a){if(b&&b.file){var e=require("x.hub.resource.js").getFileURL(b.file,c.ip);e?(b.url=e,this.playUrl(c,b,a)):a&&a(Error("no such file"))}else a&&a(Error("invalid file"))};d.prototype.playUrl=function(c,b,a){if(b&&b.url){var e=x.hub.m.bose.MODULE.resolveDevice(c);if(e){var g=b.url,f=this;this._cancelPlay(e,function(h){h?a&&a(h):f._setVolume(e,b.volume,function(k){k?a&&a(k):f._setRepeat(e,b.repeat,
function(l){l?a&&a(l):f._unmute(e,function(m){m?a&&a(m):f._playUrl(e,g,function(n){n?a&&a(n):b.repeat&&-1!=b.repeat&&(f._process[e.getIP()]={url:g},f._process[e.getIP()].timeout=setTimeout(function(){var p=f._process[e.getIP()].url;f._process[e.getIP()]=null;f._stopPlay(e,p)},1E3*parseInt(b.repeat)))})})})})});a&&a(null,1)}else a&&a(Error("invalid device json"))}else a&&a(Error("invalid url"))};d.prototype._cancelPlay=function(c,b){var a=c.getIP();if(a&&this._process[a]){this._process[a].timeout&&
clearTimeout(this._process[a].timeout);var e=this._process[a].url;this._process[a]=null;e?this._stopPlay(c,e,b):b&&b()}else b&&b()};d.prototype._stopPlay=function(c,b,a){c._getNowPlaying(function(e,g){e||!g?c._clickKey("STOP",a):g.currentURI&&g.currentURI!=b?a&&a():c._clickKey("STOP",a)})};d.prototype._setVolume=function(c,b,a){b?c._setVolume(b,a):a&&a()};d.prototype._setRepeat=function(c,b,a){b?c._clickKey("REPEAT_ONE",a):a&&a()};d.prototype._unmute=function(c,b){b&&b()};d.prototype._playUrl=function(c,
b,a){b?c.playUrl(b,a):a&&a(Error("invalid url"))};return d}();
x.hub.m.bose.Handler=function(){var d=function(){this._audioPlayer=new x.hub.m.bose.AudioPlayer};util.inherits(d,EventEmitter);d.prototype.init=function(c){c&&c()};d.prototype.getSystems=function(){return["bose"]};d.prototype.executeCommand=function(c,b,a){b?"playFile"==b.value?this._audioPlayer.playFile(c,b,function(e){a&&a({error:e})}):"playUrl"==b.value&&(b.repeat||b.volume)?this._audioPlayer.playUrl(c,b,function(e){a&&a({error:e})}):x.hub.m.bose.MODULE.doCommand(c,b,a):a&&a({error:Error("invalid command")})};
return d}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.bose.Handler);
