var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,a,b){c instanceof String&&(c=String(c));for(var d=c.length,f=0;f<d;f++){var k=c[f];if(a.call(b,k,f,c))return{i:f,v:k}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,a,b,d){if(a){b=$jscomp.global;c=c.split(".");for(d=0;d<c.length-1;d++){var f=c[d];f in b||(b[f]={});b=b[f]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.commandhandler=xnm.aio.commandhandler||{};
xnm.aio.commandhandler.CommandHandler=function(c){this.SystemData=c;this._states={};this.isInRemoteMode=this.isInDemoMode=!1;this.getStatesCallback=this.RemoteController=null;this.getCurrentState=function(a){return void 0!=this._states[a]?this._states[a]:"?"};this.setState=function(a,b,d){this._states[a]=b;this.RemoteController&&(this.RemoteController.currentPage&&this.RemoteController.currentPage.updatedState(a,b),this.RemoteController.refreshStates&&this.RemoteController.refreshStates())};this.receivedState=
function(a,b,d,f){var k=this;"hue"==a?this.SystemData.$devicesXML.find("gateways gateway[type='"+a+"']").each(function(){var e=$(this);k.SystemData.$devicesXML.find("devices device[gateway='"+e.attr("id")+"']").each(function(){var e={},g=$(this),f=g.attr("data");g.attr("subtype")&&(f=g.attr("subtype"));if(g.attr("address")==b){var c=g.parent().attr("id")+"."+g.attr("id");"hue"==a&&(e=require("xnm.aio.hue.js").getStateValues({type:f},d))}for(var p in e)"state"==p?k.setState(c,e[p]):k.setState(c+":"+
p,e[p])})}):("sonos"==a||"wemo"==a||"orvibo"==a||"edimax"==a||"kt"==a||"siegenia"==a)&&k.SystemData.$devicesXML.find("devices device[address='"+b+"']").each(function(){var b=$(this);var f=b.parent().attr("id")+"."+b.attr("id"),g=b.attr("data");b.attr("subtype")&&(g=b.attr("subtype"));b=require("xnm.aio."+a+".js").getStateValues({type:g},d);for(var c in b)"state"==c?k.setState(f,b[c]):k.setState(f+":"+c,b[c])})};this._executeDemoCommand=function(a,b){var d=b.location+"."+b.id;b.channel&&(d=d+":"+b.channel);
var f=a;"toggle"==a?f="on"==this._states[d]?"off":"off"==this._states[d]?"on":"0"==this._states[d]?"100":"0":"up"==a?(f=parseInt(this._states[d])+5,100<f&&(f=100),f=""+f):"down"==a?(f=parseInt(this._states[d])-5,0>f&&(f=0),f=""+f):"moveUp"==a?f="0":"moveDown"==a&&(f="100");this.setState(d,f);"PE"==b.type?"on"==f?this.setState(d+":current","123"):"off"==f?this.setState(d+":current","0"):this.setState(d+":current","?"):"FHT80B"==b.type&&(XC.debugf("FHT80b: "+a),b=b.location+"."+b.id,d=this._states[b+
":MC"],"setManu"==a?(this.setState(b+":M","manu",!0),this.setState(b+":MC",d.substr(0,d.length-4)+"manu")):"setAuto"==a?(this.setState(b+":M","auto",!0),this.setState(b+":MC",d.substr(0,d.length-4)+"auto")):(this.setState(b+":T",a,!0),this.setState(b+":MC",(5*a/10).toFixed(1)+"\u00b0"+d.substr(d.length-5))));this.getStatesCallback&&this.getStatesCallback()};this._executeGroupCommand=function(a,b){var d=this,f=a.split(":");2==f.length&&"lamella"==f[1]&&(a=f[0],b="L"+b);this.SystemData.$devicesXML.find("groups device[id='"+
a+"'] ref").each(function(){var a=$(this);XC.debugf("execute group command: "+a.text()+"."+b);d.execute(a.text()+"."+b,null,!0)})};this.execute=function(a,b,d,f){b=a.split(".");if(3==b.length)if("M:L1"==b[2]||"M:L2"==b[2])d=new xnm.aio.commandhandler.Macro(this,null,f),d.addCommand(b[0]+"."+b[1]+".moveUp"),"M:L1"==b[2]&&(d.addCommand("SLEEP 3500"),d.addCommand(b[0]+"."+b[1]+".moveDown"),d.addCommand("SLEEP 4500")),"M:L2"==b[2]&&(d.addCommand("SLEEP 8000"),d.addCommand(b[0]+"."+b[1]+".moveDown"),d.addCommand("SLEEP 8000")),
d.addCommand(b[0]+"."+b[1]+".stop"),d.start();else if(b[0]=="["+window.XC_Text.groups+"]")this._executeGroupCommand(b[1],b[2]);else if("[OVERVIEW]"==b[0]){var c=this;this.SystemData.$devicesXML.find("gateways gateway").each(function(){var a=$(this);if("aiogateway"==a.attr("type")){var b=new (require("xnm.aio.gateway.js").Gateway)(a.attr("ip"));c.isInRemoteMode&&b.setRemoteAccessMode(a.attr("sid"));b.executeRequest("SIAUGreset",null,function(a,d){b.getStates(c)})}})}else XC.debugf("execute gatewaycommand: "+
a),this.isInDemoMode||(this._states[b[0]+"."+b[1]]=b[2]),(a=this.SystemData.getDeviceData(b[0]+"."+b[1]))&&(d?this.executeCommand(b[2],a,f,!1):this.executeCommand(b[2],a,f,!0));else 2==b.length?(d=new xnm.aio.commandhandler.Macro(this,a,f),d.start()):0<a.indexOf("://")&&window.XC&&window.XC.callHost&&window.XC.callHost("SYSTEM","startApp",{scheme:a})};this.executeCommand=function(a,b,d,f){XC.debugf("execute command: "+a);if(this.isInDemoMode)this._executeDemoCommand(a,b),d&&d.call();else{if("CODE"==
b.type&&(b.code||this.SystemData.$ircodesXML.find("ircodes device[id='"+b.data+"'] key[id='"+a+"']").each(function(){b.code=$(this).attr("code")}),b.code)){var c=!1,e=b.code;0==e.indexOf("JS:")?(c=e.split(":"),4==c.length&&(new (require("xnm.aio.jointspace.js").Device)(c[1])).executeCommand(c[2],c[3],d),c=!0):0==e.indexOf("http:")||0==e.indexOf("HTTP:")?(new HTTPDevice,new (require("xnm.aio.commandhandler.js").executeHTTPCommand)(e,d),c=!0):0<e.indexOf("://")&&(window.XC&&window.XC.callHost&&window.XC.callHost("SYSTEM",
"startApp",{scheme:e}),c=!0);if(c)return}var h=this,g=this.SystemData.getGateway(b.gateway);if(g&&"aiogateway"==g.attr("type")){var l=new (require("xnm.aio.gateway.js").Gateway)(g.attr("ip"));this.isInRemoteMode&&l.setRemoteAccessMode(g.attr("sid"));l.executeCommand(a,b,function(){d&&d.call();f&&(h.isInRemoteMode?setTimeout(function(){l.getStates(h)},1E3):"IN"!=b.type||"fan"!=b.data&&"fanV2"!=b.data?l.getStates(h):(l.CommandHandler=h,l.executeRequest("ingetstate",{adr:b.address},function(a){a&&a.data&&
a.data.state&&l.evaluateINState(b.location+"."+b.id,b.data,a.data.state)})))})}else if(g&&"allone"==g.attr("type"))(a=require("xnm.aio.orvibo.js").getDevice({address:g.attr("udn")}))&&a.sendIR(b.code,function(){d&&d.call()});else if(g&&"hcgw"==g.attr("type")){var n=require("xnm.aio.hcgw.js"),p=n.getSignal(b.type,b.address,a);a=n.getDetectedGateways();if($.isEmptyObject(a))n.discoverGateways(function(a){$.isEmptyObject(a)&&(a={},g.children().each(function(){var b=$(this),d=new n.Gateway(b.attr("ip"));
"1"==b.attr("mode")&&(d.mode=1);a[b.attr("ip")]=d}));n.sendSignalToGateways(p,a,function(){d&&d.call()})});else{n.sendSignalToGateways(p,a,function(){f&&n.discoverGateways();d&&d.call()});c=g.getXMLString();g.children().remove();for(var m in a)e=$(this.SystemData.$devicesXML.get(0).createElement("transmitter")),e.attr("ip",m),e.attr("mode",a[m].mode),e.appendTo(g);c!=g.getXMLString()&&this.SystemData.saveData("devices")}}else if(h.isInRemoteMode)d&&(XC.debugf("executed command for unknown gateway"),
d.call());else if(g&&"hue"==g.attr("type")){var r=new (require("xnm.aio.hue.js").Bridge)(g.attr("ip"),g.attr("port"));r.executeCommand(b,a,function(){XC.debugf("executed hue command");d&&d.call();f&&r.getStates(h)})}else if(g&&"hm"==g.attr("type")){var t=new (require("xnm.aio.hm.js").CCU)(g.attr("ip"));t.executeCommand(b,a,function(){XC.debugf("executed hm command");d&&d.call();b.id&&(0>b.id.indexOf(".")&&(b.id=b.location+"."+b.id),f&&t.getStates(h,[b],function(a,b){if(!a&&b)for(a=0;a<b.length;a++)h.setState(b[a].id,
b[a].status)}))})}else if(g&&"fritzbox"==g.attr("type")){var u=new (require("xnm.aio.fritz.js").Box)(g.attr("ip"),g.attr("pwd"));u.executeCommand(b,a,function(){XC.debugf("executed fritz command");d&&d.call();b.id=b.location+"."+b.id;f&&u.getStates(h,[b])})}else if(g&&"alpha2"==g.attr("type")){var v=new (require("xnm.aio.moehlenhoff.js").Alpha2)(g.attr("ip"));v.executeCommand(b,a,function(){XC.debugf("executed moehlenhoff command");d&&d.call();b.id=b.location+"."+b.id;f&&v.getStates(h,[b])})}else if(g)XC.debugf("executeCommand for unknown gatewaytype");
else if(c=b.type,"wemo"==c||"orvibo"==c||"edimax"==c||"kt"==c||"sonos"==c||"siegenia"==c){m={address:b.address,data:b.data};"wemo"==c?(m.port=49154,c=b.address.split(":"),2==c.length&&(m.address=c[0],m.port=c[1])):"sonos"==c?m.port=1400:"siegenia"==c&&(m.pwd=b.pwd);var q=require("xnm.aio."+b.type+".js").getDevice(m);q?q.executeCommand(null,a,function(){XC.debugf("executed "+b.type+" command");d&&d.call();f&&q.getStates(h)}):d&&d.call()}else"aiogateway"==c&&(l=new (require("xnm.aio.gateway.js").Gateway)(b.address),
l.executeGatewayCommand(a,function(){d&&d.call()}))}};this.getStatesForDevice=function(a,b){if(a.attr){var d={};d.id=a.parent().attr("id")+"."+a.attr("id");d.type=a.attr("type");d.address=a.attr("address");d.data=a.attr("data");d.subtype=a.attr("data");d.pwd=a.attr("pwd");a.attr("subtype")&&(d.subtype=a.attr("subtype"));a.attr("gateway")&&(d.gateway=a.attr("gateway"));a=d}if("alpha2"==a.type)d=$(this.SystemData.$devicesXML.find("gateways gateway[id='"+a.gateway+"']")),(new (require("xnm.aio.moehlenhoff.js").Alpha2)(d.attr("ip"))).getStates(this,
a,b);else if("sonos"==a.type||"wemo"==a.type||"orvibo"==a.type||"edimax"==a.type||"kt"==a.type||"siegenia"==a.type)"wemo"==a.type?(a.port=49154,d=a.address.split(":"),2==d.length&&(a.address=d[0],a.port=d[1])):"sonos"==a.type&&(a.port=1400),(d=require("xnm.aio."+a.type+".js").getDevice(a))&&d.getStates(this,a,b)};this.getStatesForLocations=function(a){for(var b={},d=[],c=0;c<a.length;c++)a[c].find("device").each(function(){var a=$(this),c=a.attr("gateway");c&&!b[c]&&(b[c]=[]);var e={};e.id=a.parent().attr("id")+
"."+a.attr("id");e.type=a.attr("type");e.data=a.attr("data");e.address=a.attr("address");e.pwd=a.attr("pwd");e.subtype=a.attr("data");a.attr("subtype")&&(e.subtype=a.attr("subtype"));c?b[c].push(e):d.push(e)});var k=!1,e;for(e in b){var h=this;this.SystemData.$devicesXML.find("gateways gateway[id='"+e+"']").each(function(){var a=$(this);if("aiogateway"==a.attr("type")){var d=new (require("xnm.aio.gateway.js").Gateway)(a.attr("ip"));h.isInRemoteMode&&d.setRemoteAccessMode(a.attr("sid"));d.getStates(h,
b[e]);k=!0}else if("hm"==a.attr("type"))(new (require("xnm.aio.hm.js").CCU)(a.attr("ip"))).getStates(h,b[e],function(a,b){if(!a&&b)for(a=0;a<b.length;a++)h.setState(b[a].id,b[a].status)});else if("fritzbox"==a.attr("type"))(new (require("xnm.aio.fritz.js").Box)(a.attr("ip"),a.attr("pwd"))).getStates(h,b[e]);else if("alpha2"==a.attr("type"))(new (require("xnm.aio.moehlenhoff.js").Alpha2)(a.attr("ip"))).getStates(h,b[e]);else if(!h.isInRemoteMode&&"hue"==a.attr("type")){var c=new (require("xnm.aio.hue.js").Bridge)(a.attr("ip"),
a.attr("port"));c.getStates(h,b[e],function(a){"AUT"==a&&window.setTimeout(function(){XC.showConfirm(window.XC_Text.t_hueauth,function(){c.authorizeUser()},null)},0)})}})}if(!this.isInRemoteMode)for(c=0;c<d.length;c++)this.getStatesForDevice(d[c]);k||this.getStatesCallback&&this.getStatesCallback()};this.computeSIAUOverviewStates=function(){var a=this,b="closed",d="ok",c="ok",k="off";this.SystemData.$devicesXML.find("locations location device").each(function(){var e=$(this),f="";if("door"==e.attr("data")||
"window"==e.attr("data")||"genius"==e.attr("data")){var g=a.getCurrentState(e.parent().attr("id")+"."+e.attr("id"));"closed"!=g&&"closed_night"!=g&&"open_night"!=g&&(b="alert");a._states["[OVERVIEW].window-door"]=b}"smoke"==e.attr("data")&&("ok"!=a.getCurrentState(e.parent().attr("id")+"."+e.attr("id"))&&(d="alert"),a._states["[OVERVIEW]."+e.attr("data")]=d);"glass"==e.attr("data")&&("ok"!=a.getCurrentState(e.parent().attr("id")+"."+e.attr("id"))&&(c="alert"),a._states["[OVERVIEW]."+e.attr("data")]=
c);"HM"==e.attr("type")?(new (require("xnm.aio.gateway.js").Systems.HM),"dimmer"==e.attr("data")?f="dimmer":"switch"==e.attr("data")?f="switch":"light"==e.attr("data")?f="light":"meteringSwitch"==e.attr("data")&&(f="meteringSwitch")):"PE"==e.attr("type")&&"switch"==e.attr("data")&&(f="switch");if("light"==f||"dimmer"==f||"switch"==f||"meteringSwitch"==f)e=a.getCurrentState(e.parent().attr("id")+"."+e.attr("id")),"off"!=e&&"?"!=e&&"0"!=e&&(k="on"),a._states["[OVERVIEW].light-socket"]=k})};this.computeEscoOverviewStates=
function(){var a=this,b="closed",d="off",c="off",k="open";this.SystemData.$devicesXML.find("locations location device").each(function(){var e=$(this),f=e.attr("data");if("HM"==e.attr("type"))if(new (require("xnm.aio.gateway.js").Systems.HM),"door"==f||"window"==f||"esco-window"==f)e=a.getCurrentState(e.parent().attr("id")+"."+e.attr("id")),"closed"!=e&&"?"!=e&&"off"!=e&&"0"!=e&&(b="alert"),a._states["[OVERVIEW].window-door"]=b;else if("light"==f||"dimmer"==f)e=a.getCurrentState(e.parent().attr("id")+
"."+e.attr("id")),"off"!=e&&"?"!=e&&(d="alert"),a._states["[OVERVIEW].light"]=d;else if("switch"==f||"meteringSwitch"==f)e=a.getCurrentState(e.parent().attr("id")+"."+e.attr("id")),"off"!=e&&"?"!=e&&(c="alert"),a._states["[OVERVIEW].switch"]=c;else if("shutter"==f||"blind"==f||"awning"==f)e=a.getCurrentState(e.parent().attr("id")+"."+e.attr("id")),"off"!=e&&"?"!=e&&"0"!=e&&"0.5"!=e&&(k="alert"),a._states["[OVERVIEW].shutter"]=k})}};
xnm.aio.commandhandler.Macro=function(c,a,b){this._commandHandler=c;this._callback=b;this._commands=[];this._currentCommand=0;this._pause=250;if(a&&(c=a.split("."),2==c.length)){var d=this;this._commandHandler.SystemData.$macrosXML.find("location[id='"+c[0]+"'] macro[id='"+c[1]+"']").each(function(){$this=$(this);$this.children().each(function(){var a=$(this),b=a.attr("action"),c=a.attr("time");a=a.attr("sleep");b&&1<b.length?d.addCommand(b):c&&1<c.length?d.addCommand("SLEEP "+c):a&&1<a.length&&d.addCommand("SLEEP "+
a)})});c=this._commands.length;for(a=0;a<c;a++)if("IN"==this._commands[a].data.type&&6<this._commands[a].command.length&&"moveTo"==this._commands[a].command.substr(0,6))for(b=0;b<c;b++)"IN"==this._commands[b].data.type&&this._commands[a].data.address==this._commands[b].data.address&&1<this._commands[b].command.length&&"L"==this._commands[b].command.substr(0,1)&&(this._commands[a].command+=this._commands[b].command,this._commands[b].removed=!0)}};
xnm.aio.commandhandler.Macro.prototype.addCommand=function(c){var a=c.split(".");3==a.length?(c=this._commandHandler.SystemData.$devicesXML.find("locations location[id='"+a[0]+"'] device[id='"+a[1]+"']"))&&0<c.length&&($d=$(c[0]),data={},data.type=$d.attr("type"),data.address=$d.attr("address"),data.data=$d.attr("data"),data.gateway=$d.attr("gateway"),this._commands.push({type:"CMD",command:a[2],data:data})):2==a.length?(c=this._commandHandler.SystemData.$devicesXML.find("devices gateways gateway[id='"+
a[0]+"']"))&&0<c.length&&($g=$(c[0]),data={},data.type=$g.attr("type"),data.address=$g.attr("ip"),this._commands.push({type:"CMD",command:a[1],data:data})):1==a.length&&(a=c.split(" "),2==a.length&&"SLEEP"==a[0]&&this._commands.push({type:"SLEEP",command:a[1],data:{}}))};xnm.aio.commandhandler.Macro.prototype.start=function(){for(var c=[],a=this._commands.length-1;0<=a;a--)this._commands[a].removed||c.push(this._commands[a]);this._commands=c;this._executeNextCommand(!0)};
xnm.aio.commandhandler.Macro.prototype._executeNextCommand=function(c){if(this._commandHandler&&0<this._commands.length){var a=this._commands.pop(),b=this;"CMD"==a.type&&(c?this._commandHandler.executeCommand(a.command,a.data,function(){b._executeNextCommand()}):setTimeout(function(){b._commandHandler.executeCommand(a.command,a.data,function(){b._executeNextCommand()})},b._pause));"SLEEP"==a.type&&setTimeout(function(){b._executeNextCommand(!0)},parseInt(a.command))}else XC.debugf("macro finished"),
this._callback&&this._callback()};xnm.aio.commandhandler.Handler=function(){};xnm.aio.commandhandler.Handler.prototype.CommandHandler=xnm.aio.commandhandler.CommandHandler;xnm.aio.commandhandler.Handler.prototype.Macro=xnm.aio.commandhandler.Macro;xnm.aio.commandhandler.Handler.prototype.executeHTTPCommand=function(c,a){$.ajax({type:"GET",url:c,timeout:3E3,cache:!1,complete:function(b){a&&a.call()}})};
"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.commandhandler.Handler);
