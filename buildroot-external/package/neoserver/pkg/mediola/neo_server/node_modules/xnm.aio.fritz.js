var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(h,l,e){h instanceof String&&(h=String(h));for(var c=h.length,b=0;b<c;b++){var a=h[b];if(l.call(e,a,b,h))return{i:b,v:a}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(h,l,e){if(h==Array.prototype||h==Object.prototype)return h;h[l]=e.value;return h};$jscomp.getGlobal=function(h){h=["object"==typeof globalThis&&globalThis,h,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var l=0;l<h.length;++l){var e=h[l];if(e&&e.Math==Math)return e}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(h,l){var e=$jscomp.propertyToPolyfillSymbol[l];if(null==e)return h[l];e=h[e];return void 0!==e?e:h[l]};
$jscomp.polyfill=function(h,l,e,c){l&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(h,l,e,c):$jscomp.polyfillUnisolated(h,l,e,c))};$jscomp.polyfillUnisolated=function(h,l,e,c){e=$jscomp.global;h=h.split(".");for(c=0;c<h.length-1;c++){var b=h[c];if(!(b in e))return;e=e[b]}h=h[h.length-1];c=e[h];l=l(c);l!=c&&null!=l&&$jscomp.defineProperty(e,h,{configurable:!0,writable:!0,value:l})};
$jscomp.polyfillIsolated=function(h,l,e,c){var b=h.split(".");h=1===b.length;c=b[0];c=!h&&c in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var a=0;a<b.length-1;a++){var f=b[a];if(!(f in c))return;c=c[f]}b=b[b.length-1];e=$jscomp.IS_SYMBOL_NATIVE&&"es6"===e?c[b]:null;l=l(e);null!=l&&(h?$jscomp.defineProperty($jscomp.polyfills,b,{configurable:!0,writable:!0,value:l}):l!==e&&(void 0===$jscomp.propertyToPolyfillSymbol[b]&&($jscomp.propertyToPolyfillSymbol[b]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(b):
$jscomp.POLYFILL_PREFIX+b),$jscomp.defineProperty(c,$jscomp.propertyToPolyfillSymbol[b],{configurable:!0,writable:!0,value:l})))};$jscomp.polyfill("Array.prototype.find",function(h){return h?h:function(l,e){return $jscomp.findInternal(this,l,e).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.fritz=xnm.aio.fritz||{};
xnm.aio.fritz.SessionCache={_cache:{},STATE_TO:5E3,setSessionID:function(h,l){if(h){var e=this._cache[h];e||(this._cache[h]={},e=this._cache[h]);e.sessionID=l}},getSessionID:function(h){return h?this._cache[h]?this._cache[h].sessionID:null:null}};
xnm.aio.fritz.Box=function(){function h(c,b){var a=360,f=-1,d=null,g;for(g in l){var m=l[g];var k=Math.abs(c-m.hue);k<a&&(a=k,f=m.hue,d=g)}m=l[d];return[f,b>m.sat[0]?m.sat[0]:b>m.sat[1]?m.sat[1]:b>m.sat[2]?m.sat[2]:0]}var l={red:{hue:358,sat:[180,112,54],val:[255,255,255]},orange:{hue:35,sat:[214,140,72],val:[252,252,255]},yellow:{hue:52,sat:[153,102,51],val:[255,255,255]},lime:{hue:92,sat:[123,79,38],val:[248,250,252]},green:{hue:120,sat:[160,82,38],val:[220,232,242]},turquoise:{hue:160,sat:[145,
84,41],val:[235,242,248]},cyan:{hue:195,sat:[179,118,59],val:[255,255,255]},lightblue:{hue:212,sat:[169,110,56],val:[252,252,255]},blue:{hue:225,sat:[204,135,67],val:[255,255,255]},purple:{hue:266,sat:[169,110,54],val:[250,250,252]},magenta:{hue:296,sat:[140,92,46],val:[250,252,255]},pink:{hue:335,sat:[180,107,51],val:[255,248,250]}},e=function(c,b,a,f){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.fritz.Box");this.ip=c;this.port=
f;this.protocol="http";c&&"http://"==c.substr(0,7)?this.ip=c.substr(7):c&&"https://"==c.substr(0,8)&&(this.ip=c.substr(8),this.protocol="https");this.port||(this.port="https"==this.protocol?443:80);this.password=b;this.user="";a&&(this.user=a);this.CommandHandler=null};e.prototype._doRequest=function(c,b){var a=this;this._cachedSessionID()&&(c+="&sid="+this._cachedSessionID());var f=b;b={host:this.ip,port:this.port,path:c,method:"GET"};this._logger.log("trace","send ("+this.protocol+") req to:"+JSON.stringify(b));
var d="";c=require("http");"https"==this.protocol&&(c=require("https"),"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0"),b.port||(b.port=443));var g=c.request(b,function(m){m.on("data",function(k){d+=k});m.on("end",function(){var k=null;200==m.statusCode?a._logger.log("trace","http request success:"+d):(a._logger.log("trace","http request error:"+m.statusCode+"-"+d),k=Error("request failed with status code:"+m.statusCode));f&&f(k,d,m.statusCode);
f=null})});g.setTimeout&&g.setTimeout(6E4,function(){g.abort()});if(g.on&&"function"==typeof g.on)g.on("error",function(m){m||(m=Error("http request error"));a._logger.log("trace","http request error:"+m.message);f&&f(m);f=null});g.end()};e.prototype._sendRequest=function(c,b){var a=this;this._doRequest(c,function(f,d,g){f&&403==g?(a._setSessionID(null),a._getSessionID(function(m,k){m?(a._logger.log("trace","create new session error:"+m.message),b&&b(m)):(a._setSessionID(k),a._sendRequest(c,b))})):
b&&b(f,d)})};e.prototype._setSessionID=function(c){return xnm.aio.fritz.SessionCache.setSessionID(this.ip,c)};e.prototype._cachedSessionID=function(){return xnm.aio.fritz.SessionCache.getSessionID(this.ip)};e.prototype._getSessionID=function(c){var b=this;this._logger.log("trace","create new session");this._doRequest("/login_sid.lua",function(a,f){if(a)c&&c(a);else try{var d=$($.parseXML(f));if(d){var g=null;a=null;var m=d.find("SID");m&&(g=$(m[0]).text());(m=d.find("Challenge"))&&(a=$(m[0]).text());
if("0000000000000000"!=g)c&&c(null,g);else if(a){g=null;var k=require("x.crypt.js"),n=a+"-"+k.MD5(a+"-"+b.password,!0);b._doRequest("/login_sid.lua?username="+b.user+"&response="+n,function(p,q){if(p)c&&c(p);else try{var r=$($.parseXML(q));if(r){var t=r.find("SID");t&&(g=$(t[0]).text());"0000000000000000"==g&&(g=null)}g||(p=Error("session challenge fail"));c&&c(p,g)}catch(u){c&&c(u)}})}}}catch(p){c&&c(p)}})};e.prototype._getDeviceInfos=function(c){var b=this;b._sendRequest("/webservices/homeautoswitch.lua?switchcmd=getdevicelistinfos",
function(a,f){a?c&&c(a):(a=[],f&&(f=$($.parseXML(f)),a=b._resolveDevices(f)),c&&c(null,a))})};e.prototype._resolveDevices=function(c){var b=this,a=[];c.find("device").each(function(){var f=$(this);(f=b._resolveDevice(f))&&a.push(f)});c.find("group").each(function(){var f=$(this);(f=b._resolveGroup(f))&&a.push(f)});return a};e.prototype._resolveDevice=function(c){var b=c.attr("identifier");if(!b)return null;var a=c.find("name"),f="";a&&a[0]&&(f=$(a[0]).text());b=b.replace(" ","");a=c.attr("productname");
var d=c.attr("functionbitmask");d=parseInt(d);var g=null;if(d&1){if(!(d&8192))return null;var m=c.find("etsiunitinfo");if(m&&m[0]){g={};var k=$(m[0]).find("unittype");g.unittype=k&&k[0]?$(k[0]).text():null;m=$(m[0]).find("interfaces");g.interfaces=m&&m[0]?$(m[0]).text().split(","):null}}m="Comet DECT"==a?"thermo":"switch";"FRITZ!DECT 500"==a&&(m="colorlight");b={sys:"fritz",name:f,type:"fritz_dect",typeName:a,bitmask:parseInt(d),address:b,data:m,etsiunitinfo:g};b.states=this._resolveStates(b,c);return b};
e.prototype._resolveGroup=function(c){var b=c.attr("identifier");if(!b)return null;var a=c.find("name"),f="";a&&a[0]&&(f=$(a[0]).text());b=b.replace(" ","");(a=c.attr("productname"))||(a="Group");var d=c.attr("functionbitmask");b={sys:"fritz",name:f,type:"fritz_dect",typeName:a,bitmask:parseInt(d),address:b,data:"group"};b.states=this._resolveStates(b,c);return b};e.prototype._resolveStates=function(c,b){var a={},f=!1,d,g=b.find("present");if(g&&g[0])switch(f=!0,g=$(g[0]).text(),g){case "1":a.connected=
"true";break;case "0":a.connected="false";break;default:a.connected="?"}if((g=b.find("switch"))&&g[0]){f=!0;if((d=$(g[0]).find("state"))&&d[0])switch(d=$(d[0]).text(),d){case "1":a.state="on";break;case "0":a.state="off";break;default:a.state="?"}if((d=$(g[0]).find("mode"))&&d[0])switch(d=$(d[0]).text(),d){case "auto":a.switchMode="auto";break;case "manuell":a.switchMode="manu";break;default:a.switchMode="?"}}(g=b.find("powermeter"))&&g[0]&&(f=!0,(d=$(g[0]).find("power"))&&d[0]&&(d=$(d[0]).text(),
a.current=d?(parseInt(d)/1E3).toFixed(2):"?"),(d=$(g[0]).find("energy"))&&d[0]&&(d=$(d[0]).text(),a.energy=d?parseInt(d):"?"));(g=b.find("temperature"))&&g[0]&&(f=!0,(d=$(g[0]).find("celsius"))&&d[0]&&(d=$(d[0]).text(),a.tempC=d?(parseInt(d)/10).toFixed(1):"?"));(g=b.find("hkr"))&&g[0]&&(f=!0,(d=$(g[0]).find("tsoll"))&&d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.temp=254==d?28.5:253==d?7.5:(d/2).toFixed(1)):a.temp="?"),(d=$(g[0]).find("komfort"))&&d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.comfort=
254==d?28.5:253==d?7.5:(d/2).toFixed(1)):a.comfort="?"),(d=$(g[0]).find("absenk"))&&d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.absenk=254==d?28.5:253==d?7.5:(d/2).toFixed(1)):a.absenk="?"),(d=$(g[0]).find("batterylow"))&&d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.batlow=1==d?!0:!1):a.batlow="?"),(d=$(g[0]).find("battery"))&&d[0]&&((d=$(d[0]).text())?(d=parseInt(d),a.battery=d):a.battery="?"));if((g=b.find("simpleonoff"))&&g[0]&&(f=!0,(d=$(g[0]).find("state"))&&d[0]))switch(d=$(d[0]).text(),d){case "1":a.state=
"on";break;case "0":a.state="off";break;default:a.state="?"}(g=b.find("levelcontrol"))&&g[0]&&(f=!0,(d=$(g[0]).find("levelpercentage"))&&d[0]&&(d=$(d[0]).text(),d=parseInt(d),"colorlight"==c.data?a.brightness=d:a.level=d));if((g=b.find("colorcontrol"))&&g[0])if(f=!0,c=d=$(g[0]).attr("current_mode"),a.colormode=1==c?"color":4==c?"color_temperature":"unknonw",1==c?a.colortemperature=null:(d=$(g[0]).find("temperature"))&&d[0]&&(d=$(d[0]).text(),a.colortemperature=parseInt(d)),4==c)a.rgb="";else{if((d=
$(g[0]).find("hue"))&&d[0]){d=$(d[0]).text();var m=parseInt(d);m/=360}if((d=$(g[0]).find("saturation"))&&d[0]){d=$(d[0]).text();var k=parseInt(d);k/=255}d=this._HSVToRGB(m,k,a.brightness/100);g=("0"+parseInt(d[0]).toString(16)).slice(-2);g+=("0"+parseInt(d[1]).toString(16)).slice(-2);g+=("0"+parseInt(d[2]).toString(16)).slice(-2);a.rgb=g}f&&"off"==a.state&&"undefined"!=typeof a.brightness&&null!=a.brightness&&(a.brightness=0);return f?a:null};e.prototype.getDevices=function(c){this._getDeviceInfos(function(b,
a){var f=[];if(!b&&a)for(b=0;b<a.length;b++){var d=a[b];delete d.states;f.push(d)}c&&c(f)})};e.prototype.getStates=function(c){this._getDeviceInfos(function(b,a){var f={};if(a)for(var d=0;d<a.length;d++){var g=a[d];g.address&&g.states&&(f[g.address]=g.states)}c&&c(b,f)})};e.prototype.executeCommand=function(c,b,a){var f=b;b.value&&(f=b.value);var d=this;switch(f){case "on":var g="colorlight"==c.type?"setsimpleonoff&onoff=1":c.bitmask&&parseInt(c.bitmask)&32768?"setsimpleonoff&onoff=1":"setswitchon";
break;case "off":g="colorlight"==c.type?"setsimpleonoff&onoff=0":c.bitmask&&parseInt(c.bitmask)&32768?"setsimpleonoff&onoff=0":"setswitchoff";break;case "toggle":g="colorlight"==c.type?"setsimpleonoff&onoff=2":"setswitchtoggle";break;case "up":this.getStates(function(k,n){k?a&&a(k):n&&n[c.address]?(k=n[c.address].brightness,"undefined"==typeof k||null==k||isNaN(parseInt(k))?a&&a(Error("invalid brightness state")):(k=parseInt(k),k+=5,100<k&&(k=100),d.executeCommand(c,{value:"brightness",ext:k},a))):
a&&a(Error("get device states failed"))});return;case "down":this.getStates(function(k,n){k?a&&a(k):n&&n[c.address]?(k=n[c.address].brightness,"undefined"==typeof k||null==k||isNaN(parseInt(k))?a&&a(Error("invalid brightness state")):(k=parseInt(k),k-=5,0>k&&(k=0),d.executeCommand(c,{value:"brightness",ext:k},a))):a&&a(Error("get device states failed"))});return;case "brightness":"undefined"!=typeof b.ext&&null!=b.ext?(f=parseInt(b.ext),isNaN(f)||(0>f&&(f=0),100<f&&(f=100)),0!=f?(g="setlevelpercentage&level="+
f,this._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(k){k?a&&a(k):d.executeCommand(c,{value:"on"},a)})):this.executeCommand(c,{value:"off"},a)):a&&a(Error("invalid command "+b));return;case "rgb":if("undefined"!=typeof b.ext&&null!=b.ext&&6==b.ext.length){f=parseInt(b.ext.substr(0,2),16);var m=parseInt(b.ext.substr(2,2),16);b=parseInt(b.ext.substr(4,2),16);b=this._RGBToHSV(f,m,b);b=h(Math.round(b[0]),Math.round(255*b[1]));g=0==b[1]?"setcolortemperature&temperature=4200&duration=0":
"setcolor&hue="+b[0]+"&saturation="+b[1]+"&duration=0";this._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(k){k?a&&a(k):d.executeCommand(c,{value:"on"},a)})}else a&&a(Error("invalid command "+b));return;case "colortemperature":"undefined"!=typeof b.ext&&null!=b.ext&&(f=parseInt(b.ext),isNaN(f)||(2700>f&&(f=2700),6500<f&&(f=6500)),g="setcolortemperature&temperature="+(6200<f?6500:5600<f?5900:5E3<f?5300:4500<f?4700:4E3<f?4200:3600<f?3800:3200<f?3400:2850<f?3E3:
2700)+"&duration=0");break;case "thermoOn":g="sethkrtsoll&param=254";break;case "thermoOff":g="sethkrtsoll&param=253";break;case "tempUp":this.getStates(function(k,n){k?a&&a(k):n&&n[c.address]?(k=n[c.address].temp,!k||isNaN(parseFloat(k))?a&&a(Error("invalid setpoint state")):(k=parseFloat(k),k+=.5,28.5<k&&(k=28.5),g="sethkrtsoll&param="+2*k,d._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(p){a&&setTimeout(function(){a(p)},250)}))):a&&a(Error("get device states failed"))});
return;case "tempDown":this.getStates(function(k,n){k?a&&a(k):n&&n[c.address]?(k=n[c.address].temp,!k||isNaN(parseFloat(k))?a&&a(Error("invalid setpoint state")):(k=parseFloat(k),k-=.5,7.5>k&&(k=7.5),g="sethkrtsoll&param="+2*k,d._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(p){a&&setTimeout(function(){a(p)},250)}))):a&&a(Error("get device states failed"))});return;default:0==b.indexOf("temp")&&(g=b.replace("temp",""),g=parseFloat(g),g=7.5>=g||253==g?"sethkrtsoll&param=253":
28.5<=g||254==g?"sethkrtsoll&param=254":"sethkrtsoll&param="+2*g)}g?this._sendRequest("/webservices/homeautoswitch.lua?ain="+c.address+"&switchcmd="+g,function(k){a&&setTimeout(function(){a(k)},250)}):a&&a(Error("no such command "+b))};e.prototype.executeCommandCreator=function(c,b,a){if(c&&c.address&&b&&b.value){var f=b.value;if("temp"==b.value){if(!b.ext){a&&a(Error("parameter ext invalid"));return}f+=b.ext}else if("brightness"==b.value||"colortemperature"==b.value||"rgb"==b.value)f=b;this.executeCommand(c,
f,function(){a&&a()})}else a&&a(Error("parameter invalid"))};e.prototype.getStatesCreator=function(c,b,a){b?0==b.length?a&&a(null,[]):this.getStates(function(f,d){if(f)a&&a(f);else{f=[];for(var g=0;g<b.length;g++)if(b[g]&&b[g].id){var m="?";b[g].device&&b[g].device.address&&b[g].status&&b[g].status.value&&d&&d[b[g].device.address]&&(m=d[b[g].device.address][b[g].status.value],"undefined"==typeof m||null==m)&&(m="?");f.push({id:b[g].id,status:m})}a&&a(null,f)}}):a&&a(Error("deviceList is null"))};
e.prototype._RGBToHSV=function(c,b,a){c/=255;b/=255;a/=255;var f=Math.min(c,Math.min(b,a)),d=Math.max(c,Math.max(b,a));return f==d?[0,0,f]:[60*((c==f?3:a==f?1:5)-(c==f?b-a:a==f?c-b:a-c)/(d-f)),(d-f)/d,d]};e.prototype._HSVToRGB=function(c,b,a){var f=Math.floor(6*c),d=6*c-f;c=a*(1-b);var g=a*(1-d*b);b=a*(1-(1-d)*b);switch(f%6){case 0:var m=a;var k=b;var n=c;break;case 1:m=g;k=a;n=c;break;case 2:m=c;k=a;n=b;break;case 3:m=c;k=g;n=a;break;case 4:m=b;k=c;n=a;break;case 5:m=a,k=c,n=g}return[Math.round(255*
m),Math.round(255*k),Math.round(255*n)]};e.prototype.toJSON=function(){return{sys:"fritz",ip:this.ip,port:this.port,username:this.user,password:this.password}};e.prototype.equalsTo=function(c){return c&&c instanceof xnm.aio.fritz.Box?this.protocol==c.protocol&&this.ip==c.ip&&this.port==c.port&&this.user==c.user&&this.password==c.password:!1};return e}();
xnm.aio.fritz.DM=function(){var h=function(e,c){this.code=e;this.message=c;this.stack=Error().stack};h.prototype=Error();h.prototype.name="FritzDMError";h.prototype.code=0;h.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var l={fritz_dect:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},
{type:"float",name:"current power",ref:{value:"current",value_t:"currentPower"}}]},hkr:{command:[{type:"float",name:"set temperature",ref:{value:"temp",value_t:"themoTemp",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"enum",name:"temperature up",ref:{value:"tempUp"}},{type:"enum",name:"temperature down",ref:{value:"tempDown"}},{type:"enum",name:"thermostat on",ref:{value:"thermoOn"}},{type:"enum",name:"thermostat off",ref:{value:"thermoOff"}}],status:[{type:"float",name:"set temperature",ref:{value:"temp",
ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"float",name:"comfort temperature",ref:{value:"comfort",value_t:"tempComfort",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"float",name:"spar temperature",ref:{value:"absenk",value_t:"tempAbsenk",ext:"%f",extMeta:"7.5-28.5",scale:"0.5"}},{type:"enum",name:"battery low",ref:{value:"batlow",options:["true","false"]}}]},temp:{status:[{type:"float",name:"current temperature",ref:{value:"tempC",scale:"0.1"}}]},powermeter:{status:[{type:"float",name:"energy",
ref:{value:"energy"}},{type:"float",name:"current power",ref:{value:"current",value_t:"currentPower"}}]},"switch":{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}},{type:"enum",name:"switch mode",ref:{value:"switchMode",options:["auto","manu"]}}]},error:{status:[{type:"enum",name:"connected",ref:{value:"connected",options:["true",
"false"]}}]},simpleswitch:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}]},brightness:{command:[{type:"enum",name:"brightness up",ref:{value:"up"}},{type:"enum",name:"brightness down",ref:{value:"down"}},{type:"int",name:"brightness",ref:{value:"brightness",ext:"%d",extMeta:"0-100"}}],status:[{type:"int",name:"brightness",ref:{value:"brightness",
extMeta:"0-100"}}]},colortemperature:{command:[{type:"int",name:"color temperature",ref:{value:"colortemperature",value_t:"setColorTemp",ext:"%d",extMeta:"2700-6500",scale:"100"}}],status:[{type:"int",name:"color temperature",ref:{value:"colortemperature",value_t:"colortemp",extMeta:"2700-6500"}}]},color:{command:[{type:"rgb",name:"rgb color",ref:{value:"rgb",ext:"%s"}}],status:[{type:"string",name:"rgb color",ref:{value:"rgb",ext:"%s"}}]},colormode:{status:[{type:"enum",name:"color mode",ref:{value:"colormode",
value_t:"colorMode",options:["color","color_temperature","unknown"]}}]}};return{SYS:"fritz",getGatewayType:function(){return[{sys:this.SYS,name:"FRITZ!Box",port:80}]},getGatewayDeviceType:function(){return[{sys:this.SYS,type:"fritz_dect",name:"FRITZ! Smart Home"}]},createGateway:function(e,c,b){c=h.ERROR_CODE;e?e.ip?b(null,e):b(new h(c.INVALID,"ip is invalid")):b(new h(c.INVALID,"info is invalid"))},updateGateway:function(e,c,b,a){e=h.ERROR_CODE;c?c.ip?a(null,c):a(new h(e.INVALID,"ip is invalid")):
a(new h(e.INVALID,"update is invalid"))},deleteGateway:function(e,c,b){b()},createDevice:function(e,c,b){var a=h.ERROR_CODE;if(e)if(e.gateway)if(null==e.address||"undefined"==typeof e.address)b(new h(a.INVALID,"address is invalid"));else if(null==e.type||"undefined"==typeof e.type)b(new h(a.INVALID,"type is invalid"));else if(c.data&&c.data.gateways&&0!==c.data.gateways.length){c=c.data.gateways;var f;for(f=0;f<c.length;f++)if(c[f].index===e.gateway){var d=c[f];break}d?b(null,e):b(new h(a.NOT_FOUND,
"gateway with index "+e.gateway+" not exists"))}else b(new h(a.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));else b(new h(a.INVALID,"gateway is invalid"));else b(new h(a.INVALID,"info is invalid"))},updateDevice:function(e,c,b){var a=h.ERROR_CODE;if(e)if(e.gateway)if(null==e.address||"undefined"==typeof e.address)b(new h(a.INVALID,"address is invalid"));else if(null==e.type||"undefined"==typeof e.type)b(new h(a.INVALID,"type is invalid"));else if(c.data&&c.data.gateways&&0!==c.data.gateways.length){c=
c.data.gateways;var f;for(f=0;f<c.length;f++)if(c[f].index===e.gateway){var d=c[f];break}d?b(null,e):b(new h(a.NOT_FOUND,"gateway with index "+e.gateway+" not exists"))}else b(new h(a.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));else b(new h(a.INVALID,"gateway is invalid"));else b(new h(a.INVALID,"info is invalid"))},deleteDevice:function(e,c,b){b()},applyUIFilter:function(e,c){var b=this,a=function(m,k,n){var p=[];m.forEach(function(q){if("root"==q.type){q=JSON.parse(JSON.stringify(q));
var r=a(q.children,k,n);r&&0<r.length&&(q.children=r,p.push(q))}else{r=n.elems;if("*"==r)r=!0;else{for(var t=!1,u=0;u<r.length;u++)if(r[u]==q.type){t=!0;break}r=t}r&&(q=JSON.parse(JSON.stringify(q)),p.push(q))}});return p},f=function(m,k){var n=[],p=b.getCommandStatusMap(m);if(p){var q=[];switch(k.catagory){case "command":p.command&&(q=a(p.command,m,k));break;case "status":p.status&&(q=a(p.status,m,k))}n=n.concat(q)}return n};if(!e.sys)return null;var d=JSON.parse(JSON.stringify(e)),g=null;switch(c.catagory){case "command":g=
f(e,c);d.command=g;break;case "status":g=f(e,c);d.status=g;break;default:return null}return g&&0!=g.length?d:null},getCommandStatusMap:function(e){if(!e||!e.type)return null;var c=parseInt(e.bitmask),b=[];c?(c&64&&b.push("hkr"),c&128&&b.push("powermeter"),c&256&&b.push("temp"),c&512&&b.push("switch"),c&32768&&b.push("simpleswitch"),c&65536&&b.push("brightness"),c&131072&&(b.push("colortemperature"),b.push("color"),b.push("colormode"))):"colorlight"==e.type?b=["simpleswitch","brightness","colortemperature",
"color","colormode"]:b.push(e.type);if(0==b.length)return null;var a={command:[],status:[]};b.forEach(function(f){l[f]&&(l[f].command&&(a.command=a.command.concat(l[f].command)),l[f].status&&(a.status=a.status.concat(l[f].status)))});if(0<a.command.length||0<a.status.length)a.status=a.status.concat(l.error.status);return a},toGeneralDevice:function(e,c){var b=c=!1,a=!1,f=!1,d=!1,g=parseInt(e.bitmask);g?(g&64&&(d=!0),g&128&&(b=!0),g&256&&(f=!0),g&512&&(c=!0),g&32768&&(c=!0),g&131072&&(a=!0)):"switch"==
e.data?c=!0:"thermo"==e.data?d=!0:"colorlight"==e.data&&(a=!0);e=null;a?e={type:"dimmer",commands:{on:{},off:{},toggle:{},up:{},down:{},brightness:{value:{type:"INT",min:0,max:100,step:1}},colorTemperature:{value:{type:"INT",min:2700,max:6500,step:100}},color:{type:"RGB"}},states:{state:{values:["on","off"]},brightness:{min:0,max:100,unit:"%"},colorTemperature:{min:2700,max:6500}},details:{commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"},up:{value:"up"},down:{value:"down"},brightness:{value:"brightness",
ext:"%d"},colorTemperature:{value:"colortemperature",ext:"%d",extMeta:"2700-6500",scale:"100"},color:{value:"rgb",ext:"%s"}},states:{state:{value:"state"},brightness:{value:"brightness"},colorTemperature:{value:"colortemperature"}}}}:d?e={type:"heater",commands:{up:{},down:{},tempTo:{value:{type:"FLOAT",min:7.5,max:28.5,step:.5}}},states:{setpoint:{type:"FLOAT",min:6,max:30,step:.5,unit:"\u00b0C"},temperature:{type:"FLOAT"}},details:{commands:{up:{value:"tempUp"},down:{value:"tempDown"},tempTo:{value:"temp",
ext:"%f"}},states:{setpoint:{value:"temp"},temperature:{value:"tempC"}}}}:c?(e={type:"switch",commands:{on:{},off:{},toggle:{}},states:{state:{values:["on","off"]}},details:{commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"}},states:{state:{value:"state"}}}},b&&(e.states.power={type:"FLOAT"},e.states.consumption={type:"FLOAT"},e.details.states.power={value:"current"},e.details.states.consumption={value:"energy"})):f&&(e={type:"temperature",states:{temperature:{type:"FLOAT"}},details:{states:{temperature:{value:"tempC"}}}});
return e}}}();
xnm.aio.fritz.Handler=function(){var h=function(){};h.prototype.Box=xnm.aio.fritz.Box;h.prototype.devicemanager=xnm.aio.fritz.DM;h.prototype.registModule=function(l){l.register(this.devicemanager.SYS,"fritz")};h.prototype.resolveGateway=function(l){return l&&l.ip?new xnm.aio.fritz.Box(l.ip,l.password,l.username,l.port):null};h.prototype.getDeviceCommands=function(l,e){l=(l=xnm.aio.fritz.DM.applyUIFilter(l,{catagory:"command",elems:"*"}))?l.command:[];e&&e(null,l)};h.prototype.getDeviceStatus=function(l,
e){l=(l=xnm.aio.fritz.DM.applyUIFilter(l,{catagory:"status",elems:"*"}))?l.status:[];e&&e(null,l)};h.prototype.doCommand=function(l,e,c,b){(l=this.resolveGateway(l))?l.executeCommandCreator(e,c,function(a){b&&b(a)}):b&&b(Error("gateway json format invalid"))};h.prototype.doStatus=function(l,e,c,b,a){(e=this.resolveGateway(e))?e.getStatesCreator(null,[{id:l,device:c,status:b}],function(f,d){f?a&&a(f):a&&a(null,d[0])}):a&&a(Error("gateway json format invalid"))};h.prototype.getDeviceList=function(l,
e){(l=this.resolveGateway(l))?l.getDevices(function(c){e&&e(null,c)}):e&&e(Error("gateway json format invalid"))};return h}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.fritz.Handler);
