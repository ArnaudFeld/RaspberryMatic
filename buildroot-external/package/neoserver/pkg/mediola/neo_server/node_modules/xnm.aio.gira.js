var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var d=$jscomp.propertyToPolyfillSymbol[b];if(null==d)return a[b];d=a[d];return void 0!==d?d:a[b]};$jscomp.polyfill=function(a,b,d,e){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,d,e):$jscomp.polyfillUnisolated(a,b,d,e))};
$jscomp.polyfillUnisolated=function(a,b,d,e){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var c=a[e];if(!(c in d))return;d=d[c]}a=a[a.length-1];e=d[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,d,e){var c=a.split(".");a=1===c.length;e=c[0];e=!a&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var h=0;h<c.length-1;h++){var g=c[h];if(!(g in e))return;e=e[g]}c=c[c.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?e[c]:null;b=b(d);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,c,{configurable:!0,writable:!0,value:b}):b!==d&&(void 0===$jscomp.propertyToPolyfillSymbol[c]&&($jscomp.propertyToPolyfillSymbol[c]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(c):
$jscomp.POLYFILL_PREFIX+c),$jscomp.defineProperty(e,$jscomp.propertyToPolyfillSymbol[c],{configurable:!0,writable:!0,value:b})))};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(d){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var d=a.next();$jscomp.generator.ensureIteratorResultIsObject_(d);if(d.done)this.yieldResult=d.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(d.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,d){d?this.finallyContexts_[d]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(d){return{value:d,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,d){try{var e=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(e);if(!e.done)return this.context_.stop_(),e;var c=e.value}catch(h){return this.context_.yieldAllIterator_=null,this.context_.throw_(h),this.nextStep_()}this.context_.yieldAllIterator_=null;d.call(this.context_,c);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(e){return a.next(e)}function d(e){return a.throw(e)}return new Promise(function(e,c){function h(g){g.done?e(g.value):Promise.resolve(g.value).then(b,d).then(h,c)}h(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.initSymbol=function(){};$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(c,h){this.$jscomp$symbol$id_=c;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var d=0,e=function(c){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(c||"")+"_"+d++,c)};return e},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),d=0;d<b.length;d++){var e=$jscomp.global[b[d]];"function"===typeof e&&"function"!=typeof e.prototype[a]&&$jscomp.defineProperty(e.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function d(g){return g instanceof c?g:new c(function(f,k){f(g)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(g){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(g)};
var e=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(g){e(g,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var g=this.batch_;this.batch_=[];for(var f=0;f<g.length;++f){var k=g[f];g[f]=null;try{k()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(g){this.asyncExecuteFunction(function(){throw g;})};var c=function(g){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var f=this.createResolveAndReject_();
try{g(f.resolve,f.reject)}catch(k){f.reject(k)}};c.prototype.createResolveAndReject_=function(){function g(l){return function(m){k||(k=!0,l.call(f,m))}}var f=this,k=!1;return{resolve:g(this.resolveTo_),reject:g(this.reject_)}};c.prototype.resolveTo_=function(g){if(g===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(g instanceof c)this.settleSameAsPromise_(g);else{a:switch(typeof g){case "object":var f=null!=g;break a;case "function":f=!0;break a;default:f=!1}f?this.resolveToNonPromiseObj_(g):
this.fulfill_(g)}};c.prototype.resolveToNonPromiseObj_=function(g){var f=void 0;try{f=g.then}catch(k){this.reject_(k);return}"function"==typeof f?this.settleSameAsThenable_(f,g):this.fulfill_(g)};c.prototype.reject_=function(g){this.settle_(2,g)};c.prototype.fulfill_=function(g){this.settle_(1,g)};c.prototype.settle_=function(g,f){if(0!=this.state_)throw Error("Cannot settle("+g+", "+f+"): Promise already settled in state"+this.state_);this.state_=g;this.result_=f;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};c.prototype.scheduleUnhandledRejectionCheck_=function(){var g=this;e(function(){if(g.notifyUnhandledRejection_()){var f=$jscomp.global.console;"undefined"!==typeof f&&f.error(g.result_)}},1)};c.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var g=$jscomp.global.CustomEvent,f=$jscomp.global.Event,k=$jscomp.global.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof g?g=new g("unhandledrejection",{cancelable:!0}):
"function"===typeof f?g=new f("unhandledrejection",{cancelable:!0}):(g=$jscomp.global.document.createEvent("CustomEvent"),g.initCustomEvent("unhandledrejection",!1,!0,g));g.promise=this;g.reason=this.result_;return k(g)};c.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var g=0;g<this.onSettledCallbacks_.length;++g)h.asyncExecute(this.onSettledCallbacks_[g]);this.onSettledCallbacks_=null}};var h=new b;c.prototype.settleSameAsPromise_=function(g){var f=this.createResolveAndReject_();
g.callWhenSettled_(f.resolve,f.reject)};c.prototype.settleSameAsThenable_=function(g,f){var k=this.createResolveAndReject_();try{g.call(f,k.resolve,k.reject)}catch(l){k.reject(l)}};c.prototype.then=function(g,f){function k(n,u){return"function"==typeof n?function(w){try{l(n(w))}catch(v){m(v)}}:u}var l,m,q=new c(function(n,u){l=n;m=u});this.callWhenSettled_(k(g,l),k(f,m));return q};c.prototype.catch=function(g){return this.then(void 0,g)};c.prototype.callWhenSettled_=function(g,f){function k(){switch(l.state_){case 1:g(l.result_);
break;case 2:f(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?h.asyncExecute(k):this.onSettledCallbacks_.push(k);this.isRejectionHandled_=!0};c.resolve=d;c.reject=function(g){return new c(function(f,k){k(g)})};c.race=function(g){return new c(function(f,k){for(var l=$jscomp.makeIterator(g),m=l.next();!m.done;m=l.next())d(m.value).callWhenSettled_(f,k)})};c.all=function(g){var f=$jscomp.makeIterator(g),k=f.next();return k.done?d([]):new c(function(l,
m){function q(w){return function(v){n[w]=v;u--;0==u&&l(n)}}var n=[],u=0;do n.push(void 0),u++,d(k.value).callWhenSettled_(q(n.length-1),m),k=f.next();while(!k.done)})};return c},"es6","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(b,d){return b===d?0!==b||1/b===1/d:b!==b&&d!==d}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,d){var e=this;e instanceof String&&(e=String(e));var c=e.length;d=d||0;for(0>d&&(d=Math.max(d+c,0));d<c;d++){var h=e[d];if(h===b||Object.is(h,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,d){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,d||0)}},"es6","es3");
$jscomp.findInternal=function(a,b,d){a instanceof String&&(a=String(a));for(var e=a.length,c=0;c<e;c++){var h=a[c];if(b.call(d,h,c,a))return{i:c,v:h}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,d){return $jscomp.findInternal(this,b,d).v}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var d=0,e=!1,c={next:function(){if(!e&&d<a.length){var h=d++;return{value:b(h,a[h]),done:!1}}e=!0;return{done:!0,value:void 0}}};c[Symbol.iterator]=function(){return c};return c};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,d){return d})}},"es8","es3");
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.gira=xnm.aio.gira||{};xnm.aio.gira={_logger:{log:function(){}},parseJSON:function(a){return new xnm.aio.gira.GiraServer(a)}};
xnm.aio.gira.GiraServer=function(){var a=function(b,d){this._logger="undefined"==typeof require||null==require?{log:function(e,c){console&&console.log&&(e&&"error"!=e?console.log(e,c):console.log("error",c,c.stack))}}:require("x.logger.js").getLogger("xnm.aio.gira.GiraServer");this.REQUESTS_TIMEOUT_MS=d?d:1E4;this.gwInfo=b;this.cachedConfiguration=this.CommandHandler=null};a.prototype._doRequest=function(b,d,e,c,h){b={host:this.gwInfo.ip,port:this.gwInfo.port,path:d,method:String(b).toUpperCase(),
timeout:this.REQUESTS_TIMEOUT_MS,headers:{Connection:"close","Content-Type":"application/json"}};if(e)for(var g in e)e.hasOwnProperty(g)&&(b.headers[g]=e[g]);c&&(b.headers["Content-Length"]=c.length);this._logger.log("debug","call gira server on "+d+" with "+JSON.stringify(b));d=require("https");var f=this,k=h,l=d.request(b,function(m){m.setEncoding("utf-8");var q="";m.on("data",function(n){q+=n});m.on("end",function(){f._logger.log("debug","receive code:"+m.statusCode+" response:"+q);k&&(k(null,
q,m),k=null)})});if(l.on)l.on("error",function(m){f._logger.log("error","do request error:"+m.message);k&&(k(m),k=null)});l.setTimeout&&l.setTimeout(this.REQUESTS_TIMEOUT_MS,function(){f._logger.log("error","do request timeout");l.abort();k&&(k(Error("timeout")),k=null)});c&&(this._logger.log("debug","do request send body:"+c),l.write(c));l.end()};a.prototype.get=function(b,d,e){var c=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){return h.return(new Promise(function(g,f){return c._doRequest("get",
b,d,e,function(k,l){return k?f(k):g(l)})}))})};a.prototype.post=function(b,d,e){var c=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){return h.return(new Promise(function(g,f){return c._doRequest("post",b,d,e,function(k,l){return k?f(k):g(l)})}))})};a.prototype.put=function(b,d,e){var c=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){return h.return(new Promise(function(g,f){return c._doRequest("put",b,d,e,function(k,l){return k?f(k):g(l)})}))})};a.prototype.isGiraServer=
function(){var b=this,d,e,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress)return a.serversCache[b.gwInfo.ip]&&(d=a.serversCache[b.gwInfo.ip],e=Date.now(),e-d.time<a.cacheTime&&d.serverInfo)?(b._logger.log("debug","is gira server based on cached data"),h.return(d.serverInfo)):h.yield(b.get("/api/").then(function(g){var f=JSON.parse(g);return g&&f.info?f:!1}).catch(function(g){return!1}),2);c=h.yieldResult;a.serversCache[b.gwInfo.ip]={time:Date.now(),serverInfo:c};
return h.return(c)})};a.prototype.getToken=function(b,d,e){var c=this,h,g,f,k,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(m){if(1==m.nextAddress)return h={client:"com.mediola.creator"+(e?e:"")},g=b+":"+d,f={Authorization:"Basic "+Buffer.from(g).toString("base64")},m.yield(c.post("/api/clients",f,JSON.stringify(h)),2);k=m.yieldResult;if(!k)throw c.generateGiraError("can not get token, no result",3);l=JSON.parse(k);if(!l.token)throw c.generateGiraError("no token : "+k,3);return m.return(l.token)})};
a.prototype.getDevices=function(b){var d=this,e,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress)return h.yield(d.isGiraServer(),2);if(3!=h.nextAddress)return h.yieldResult?h.yield(d._getServerConfiguration(),3):(b(Error("server is unreachable")),h.return());e=h.yieldResult;if(!e||!e.functions||!e.locations)return b(Error("ui configuration is invalid")),h.return();c=d._convertConfigurationToMediolaDevices(e);b(null,c);h.jumpToEnd()})};a.prototype._convertConfigurationToMediolaDevices=
function(b){for(var d=[],e={},c=$jscomp.makeIterator(b.functions),h=c.next();!h.done;e={$jscomp$loop$prop$mediolaDevice$11:e.$jscomp$loop$prop$mediolaDevice$11},h=c.next())h=h.value,e.$jscomp$loop$prop$mediolaDevice$11={name:void 0,room:void 0,sys:"gira",address:void 0,type:void 0,supportedDataPoints:void 0},h.displayName&&(e.$jscomp$loop$prop$mediolaDevice$11.name=h.displayName),h.uid&&(e.$jscomp$loop$prop$mediolaDevice$11.address=h.uid),h.dataPoints&&(e.$jscomp$loop$prop$mediolaDevice$11.supportedDataPoints=
[],h.dataPoints.forEach(function(g){return function(f){g.$jscomp$loop$prop$mediolaDevice$11.supportedDataPoints.push({dataPointUid:f.uid,dataPointName:f.name})}}(e))),e.$jscomp$loop$prop$mediolaDevice$11.room=this._findDeviceRoom(b.locations,h.uid,""),e.$jscomp$loop$prop$mediolaDevice$11.type=this._findDeviceType(h.channelType),e.$jscomp$loop$prop$mediolaDevice$11.type&&"undefined"!==e.$jscomp$loop$prop$mediolaDevice$11.type&&d.push(e.$jscomp$loop$prop$mediolaDevice$11);return d};a.prototype._findDeviceRoom=
function(b,d,e){var c=!1,h=e;b=$jscomp.makeIterator(b);for(var g=b.next();!g.done;g=b.next())if(g=g.value,g.functions&&g.functions.includes(d)){h=e&&0<e.length?e+"::":"";h+=g.displayName;c=!0;break}else if(g.locations&&!c&&(h=this._findDeviceRoom(g.locations,d,g.displayName))){c=!0;break}return c?h:null};a.prototype._findDeviceType=function(b){var d="undefined";switch(b){case "de.gira.schema.channels.Switch":d="switch";break;case "de.gira.schema.channels.KNX.Dimmer":d="dimmer";break;case "de.gira.schema.channels.BlindWithPos":d=
"blind";break;case "de.gira.schema.channels.KNX.HeatingCoolingSwitchable":case "de.gira.schema.channels.RoomTemperatureSwitchable":d="heater";break;case "de.gira.schema.channels.DimmerRGBW":d="dimmerrgbw";break;case "de.gira.schema.channels.SceneControl":d="scene"}this._logger.log("debug",'[GiraServer._findDeviceType] Assigned channel type "'+(b+'" as device type "')+(d+'".'));return d};a.prototype.executeCommandCreator=function(b,d,e){var c=this,h,g,f,k,l,m,q,n,u,w,v,y,r,t,x,B,z;return $jscomp.asyncExecutePromiseGeneratorProgram(function(p){switch(p.nextAddress){case 1:return c._logger.log("debug",
"executing "+JSON.stringify(d)+" on "+JSON.stringify(b)),p.setCatchFinallyBlocks(2),p.yield(c.isGiraServer(),4);case 4:if(!p.yieldResult)return e(c.generateGiraError("server is unreachable",5)),p.return();if(c.cachedConfiguration){p.jumpTo(5);break}return p.yield(c._getServerConfiguration(),5);case 5:h=c.cachedConfiguration.functions.find(function(A){return A.uid==b.address});g=h.dataPoints;if(d&&("color"===d.value||"color_white"===d.value)){m="color_white"===d.value;q=c._whichDataPoint({value:"Red"},
g);n=c._whichDataPoint({value:"Green"},g);u=c._whichDataPoint({value:"Blue"},g);if(!q||!n||!u)return e(c.generateGiraError("Unsupported command",5)),p.return();w=null;return m&&(w=c._whichDataPoint({value:"White"},g),!w)?(e(c.generateGiraError("Unsupported command",5)),p.return()):p.yield(c._getDesiredValue(d,{}),11)}f=c._whichDataPoint(d,g);return f?p.yield(c._getDesiredValue(d,f),9):(e(c.generateGiraError("Unsupported command",5)),p.return());case 9:return k=p.yieldResult,"undefined"==typeof k||
null==k?(e(c.generateGiraError("Invalid value command",3)),p.return()):p.yield(c.setDataPointValue(f.uid,k),10);case 10:l=p.yieldResult;e(null,l);p.jumpTo(8);break;case 11:return v=p.yieldResult,!Array.isArray(v)||3>v.length?(e(c.generateGiraError("Invalid value command",3)),p.return()):p.yield(c.setDataPointValue(q.uid,v[0]),12);case 12:return y=p.yieldResult,p.yield(c.setDataPointValue(n.uid,v[1]),13);case 13:return r=p.yieldResult,p.yield(c.setDataPointValue(u.uid,v[2]),14);case 14:t=p.yieldResult;
x={red:y,green:r,blue:t};if(!m){p.jumpTo(15);break}return p.yield(c.setDataPointValue(w.uid,v[3]),16);case 16:B=p.yieldResult,x.white=B;case 15:e(null,x);case 8:p.leaveTryBlock(0);break;case 2:z=p.enterCatchBlock(),c._logger.log("error",z),e(z),p.jumpToEnd()}})};a.prototype._getDesiredValue=function(b,d){var e=this,c,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:c=b.ext;switch(b.value){case "on":case "StepUp":case "Up":c=1;break;case "off":case "StepDown":case "Down":c=
0;break;case "color":c=String(c).replace("#","").trim();if(6===c.length||8===c.length){if(c=[c.substring(0,2),c.substring(2,4),c.substring(4,6)],c.forEach(function(f,k){c[k]=Math.round(parseInt(f,16)/2.55)}),isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))c=null}else c=null;break;case "color_white":c=String(c).replace("#","").trim();if(8===c.length){if(c=[c.substring(0,2),c.substring(2,4),c.substring(4,6),c.substring(6,8)],c.forEach(function(f,k){c[k]=Math.round(parseInt(f,16)/2.55)}),isNaN(c[0])||isNaN(c[1])||
isNaN(c[2])||isNaN(c[3]))c=null}else c=null;break;case "toggle":return g.jumpTo(2)}g.jumpTo(3);break;case 2:return g.yield(e._getCurrentValueOfDataPoint(d.uid),4);case 4:h=g.yieldResult;c=0<h?0:1;g.jumpTo(3);break;case 3:return g.return(c)}})};a.prototype._getCurrentValueOfDataPoint=function(b){var d=this,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){e="/api/values/"+b+"?token="+d.gwInfo.token;return c.return(d.get(e).then(function(h){return JSON.parse(h).values[0].value}))})};
a.prototype._whichDataPoint=function(b,d){var e=b.value;e=this._nameOfCommandInKnx(e);return d.find(function(c){return c.name==e})};a.prototype._nameOfCommandInKnx=function(b){switch(b){case "on":case "off":case "toggle":b="OnOff";break;case "StepUp":case "StepDown":b="Step-Up-Down";break;case "Up":case "Down":b="Up-Down"}return b};a.prototype.setDataPointValue=function(b,d){var e=this,c,h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){c="/api/values/"+b+"?token="+e.gwInfo.token;h=
{value:d};return g.return(e.put(c,null,JSON.stringify(h)).catch(function(f){e._logger.log("error",f);return!1}))})};a.prototype.getStatesCreator=function(b,d,e){var c=this,h,g,f,k,l,m,q,n,u,w,v,y;return $jscomp.asyncExecutePromiseGeneratorProgram(function(r){switch(r.nextAddress){case 1:return r.setCatchFinallyBlocks(2),h=[],r.yield(c.isGiraServer(),4);case 4:if(!r.yieldResult)return d.forEach(function(t){h.push({id:t.id,status:"server unreachable"})}),e(null,h),r.return();if(c.cachedConfiguration){r.jumpTo(5);
break}return r.yield(c._getServerConfiguration(),5);case 5:return g=[],d.forEach(function(t){t=t.device;g.includes(t.address)||g.push(t.address)}),f=[],g.forEach(function(t){f.push(c._getFunctionDataPointsValues(t))}),r.yield(Promise.all(f),7);case 7:k=r.yieldResult;l={};m=$jscomp.makeIterator(d);for(q=m.next();!q.done;l={$jscomp$loop$prop$deviceJson$13:l.$jscomp$loop$prop$deviceJson$13,$jscomp$loop$prop$statusJson$14:l.$jscomp$loop$prop$statusJson$14,$jscomp$loop$prop$doesSupportIt$15:l.$jscomp$loop$prop$doesSupportIt$15},
q=m.next()){n=q.value;l.$jscomp$loop$prop$statusJson$14=n.status;l.$jscomp$loop$prop$deviceJson$13=n.device;u=k.find(function(t){return function(x){return x[t.$jscomp$loop$prop$deviceJson$13.address]}}(l));w=u[l.$jscomp$loop$prop$deviceJson$13.address];l.$jscomp$loop$prop$doesSupportIt$15=l.$jscomp$loop$prop$deviceJson$13.supportedDataPoints.find(function(t){return function(x){return(x.dataPointName||x.dataPontName)==t.$jscomp$loop$prop$statusJson$14.value}}(l));if(!l.$jscomp$loop$prop$doesSupportIt$15){h.push({id:n.id,
status:"undefined"});break}(v=w.find(function(t){return function(x){return x.uid==t.$jscomp$loop$prop$doesSupportIt$15.dataPointUid}}(l)))?h.push({id:n.id,status:v.value}):c._logger.log("error",'No datapoint "'+l.$jscomp$loop$prop$doesSupportIt$15.dataPointUid+'" found in result for "'+n.id+'".')}e(null,h);r.leaveTryBlock(0);break;case 2:y=r.enterCatchBlock(),c._logger.log("error",y),e(y),r.jumpToEnd()}})};a.prototype._getFunctionDataPointsValues=function(b){var d=this,e,c,h,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){switch(f.nextAddress){case 1:return e=
{},e[b]=[],f.setCatchFinallyBlocks(2),f.yield(d._prepareToken(),4);case 4:return c=f.yieldResult,f.yield(d.get("/api/values/"+b+"?token="+c),5);case 5:h=f.yieldResult;h=JSON.parse(h);if(!h||!h.values)throw Error("server response is not valid");e[b]=h.values;return f.return(e);case 2:return g=f.enterCatchBlock(),d._logger.log("error","error in getting data points values of "+b),d._logger.log("error",g),f.return(e)}})};a.prototype._getDataPointUid=function(b,d){d=$jscomp.makeIterator(d.dataPoints);
for(var e=d.next();!e.done;e=d.next())if(e=e.value,e.name==b)return e.uid;return null};a.prototype._getServerConfiguration=function(){var b=this,d,e,c,h,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){switch(f.nextAddress){case 1:return f.setCatchFinallyBlocks(2),f.yield(b._prepareToken(),4);case 4:return d=f.yieldResult,e="/api/uiconfig?token="+d+"&expand=dataPointFlags,parameters,locations,trades",f.yield(b.get(e),5);case 5:return c=f.yieldResult,h=JSON.parse(c),h.error&&"invalidAuth"==
h.error.code?f.yield(b._patchForCachedInvalidTokens(),7):(b.cachedConfiguration=h,f.return(b.cachedConfiguration));case 7:return f.return(f.yieldResult);case 6:f.leaveTryBlock(0);break;case 2:return g=f.enterCatchBlock(),b._logger.log("error","can not get configuration",g),f.return(b.cachedConfiguration)}})};a.prototype._prepareToken=function(){var b=this,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress)return b.gwInfo.token?e.return(b.gwInfo.token):e.yield(b.getToken(b.gwInfo.username,
b.gwInfo.password),3);d=e.yieldResult;b.gwInfo.token=d;return e.return(d)})};a.prototype._patchForCachedInvalidTokens=function(){var b=this,d,e,c,h,g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return d=b._getRandomIntInclusive(1,5),f.yield(b.getToken(b.gwInfo.username,b.gwInfo.password,d),2);if(3!=f.nextAddress)return e=f.yieldResult,c="/api/uiconfig?token="+e+"&expand=dataPointFlags,parameters,locations,trades",f.yield(b.get(c),3);h=f.yieldResult;g=JSON.parse(h);
if(g.error&&"invalidAuth"==g.error.code)throw Error("we can not get configuration in second try!");b.gwInfo.token=e;return f.return(g)})};a.prototype._getRandomIntInclusive=function(b,d){b=Math.ceil(b);d=Math.floor(d);return Math.floor(Math.random()*(d-b+1)+b)};a.prototype.toJSON=function(){return{sys:"gira",ip:this.gwInfo.ip,port:this.gwInfo.port}};a.prototype.equalsTo=function(b){return b&&b instanceof xnm.aio.gira.GiraServer?this.gwInfo.ip==b.gwInfo.ip:!1};a.prototype.generateGiraError=function(b,
d){var e=xnm.aio.gira.DM;return e||e.Error?new e.Error(d,b):Error(b)};a.parseJSON=function(b){return b.ip?new a(b.ip,b.port):null};a.serversCache={};a.cacheTime=3E5;return a}();
xnm.aio.gira.DM={MAP:{"switch":{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"switch status",ref:{value:"OnOff",options:[0,1]}}]},dimmer:{command:[{type:"enum",name:"off",ref:{value:"on"}},{type:"enum",name:"on",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"int",name:"brightness",ref:{value:"Brightness",value_t:"brightness",ext:"%d",extMeta:"0-100"}},
{type:"int",name:"shift",ref:{value:"Shift",ext:"%d",extMeta:"0-100"}}],status:[{type:"enum",name:"dimmer status",ref:{value:"OnOff",options:[0,1]}},{type:"int",name:"brightness",ref:{value:"Brightness",value_t:"brightness"}}]},blind:{command:[{type:"enum",name:"step up",ref:{value:"StepUp"}},{type:"enum",name:"step down",ref:{value:"StepDown"}},{type:"enum",name:"move up",ref:{value:"Up"}},{type:"enum",name:"move down",ref:{value:"Down"}},{type:"int",name:"position",ref:{value:"Position",ext:"%d",
extMeta:"0-100"}},{type:"int",name:"slat position",ref:{value:"Slat-Position",ext:"%d",extMeta:"0-100"}}],status:[{type:"int",name:"position",ref:{value:"Position"}},{type:"int",name:"slat position",ref:{value:"Slat-Position"}},{type:"enum",name:"movement status",ref:{value:"Movement",options:[0,1]}}]},heater:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"float",name:"set point",ref:{value:"Set-Point",value_t:"setpointTemp",ext:"%f",scale:.5}}],
status:[{type:"float",name:"current temperature",ref:{value:"Current",value_t:"currentTemperature"}},{type:"float",name:"set temperature",ref:{value:"Set-Point",value_t:"setTemperature"}}]},dimmerrgbw:{command:[{type:"enum",name:"off",ref:{value:"on"}},{type:"enum",name:"on",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"int",name:"brightness",ref:{value:"Brightness",value_t:"brightness",ext:"%d",extMeta:"0-100"}},{type:"int",name:"red",ref:{value:"Red",value_t:"red",ext:"%d",
extMeta:"0-100"}},{type:"int",name:"blue",ref:{value:"Blue",value_t:"blue",ext:"%d",extMeta:"0-100"}},{type:"int",name:"green",ref:{value:"Green",value_t:"green",ext:"%d",extMeta:"0-100"}},{type:"int",name:"White",ref:{value:"White",value_t:"white",ext:"%d",extMeta:"0-100"}},{type:"rgb",name:"color",ref:{value:"color",ext:"%rgb"}},{type:"rgbw",name:"color_white",ref:{value:"color_white",ext:"%rgbw"}}],status:[{type:"enum",name:"dimmer status",ref:{value:"OnOff",options:[0,1]}},{type:"int",name:"brightness",
ref:{value:"Brightness",value_t:"brightness"}},{type:"int",name:"red",ref:{value:"Red",value_t:"red"}},{type:"int",name:"blue",ref:{value:"Blue",value_t:"blue"}},{type:"int",name:"green",ref:{value:"Green",value_t:"green"}},{type:"int",name:"white",ref:{value:"White",value_t:"white"}}]},scene:{command:[{type:"int",name:"scene",ref:{value:"Scene",value_t:"scene",ext:"%d",extMeta:"1-64"}}]}},SYS:"gira",applyIPEventFilter:function(a,b){return a&&a.type?(a=xnm.aio.gira.DM.getIPevtMap(a))?{ipevt:a}:null:
null},applyUIFilter:function(a,b,d){if(!a.sys)return null;var e=function(k,l){if("*"===k||"*"===k[0])return!0;for(var m=0;m<k.length;m++)if(k[m]==l)return!0;return!1},c=function(k,l,m){var q=[];switch(m.catagory){case "command":k.command&&k.command.forEach(function(n){e(m.elems,n.type)&&(n=JSON.parse(JSON.stringify(n)),q.push(n))});break;case "status":k.status&&k.status.forEach(function(n){e(m.elems,n.type)&&(n=JSON.parse(JSON.stringify(n)),q.push(n))})}return q},h=function(k,l){var m=[],q=xnm.aio.gira.DM.getCommandStatusMap(k,
d);q&&(k=c(q,k,l),m=m.concat(k));return m},g=JSON.parse(JSON.stringify(a)),f=null;switch(b.catagory){case "command":f=h(a,b);g.command=f;break;case "status":f=h(a,b);g.status=f;break;default:return null}return f&&0!=f.length?g:null},supportSmartWidget:function(a,b){return a&&a.type&&"undefined"!==a.type?!0:!1},applySmartWidgetFilter:function(a,b,d,e,c){if(!b||!b.type)return null;d=function(g){var f=[];switch(g.type){case "blind":f.push("blind");break;case "dimmer":case "dimmerrgbw":f.push("dimmer",
"switch");"dimmerrgbw"===g.type&&f.push("rgb");break;case "switch":f.push("switch");break;case "heater":f.push("thermostat")}return f}(b);var h=function(g){var f={};switch(g.type){case "blind":f["%moveTo%"]={value:"Position",ext:"%d",extMeta:"0-100"};f["%moveDown%"]={value:"Down"};f["%moveUp%"]={value:"Up"};f["%lamellaTo%"]={value:"Slat-Position",ext:"%d",extMeta:"0-100"};break;case "dimmer":case "dimmerrgbw":case "switch":f["%dimOn%"]={value:"on"};f["%on%"]={value:"on"};f["%dimOff%"]={value:"off"};
f["%off%"]={value:"off"};f["%toggle%"]={value:"toggle"};"dimmer"===g.type?f["%dimTo%"]={value:"Brightness",ext:"%d",extMeta:"0-100"}:"dimmerrgbw"===g.type&&(f["%dimTo%"]={value:"Brightness",ext:"%d",extMeta:"0-100"},f["%red%"]={value:"Red",ext:"%d",extMeta:"0-100"},f["%green%"]={value:"Green",ext:"%d",extMeta:"0-100"},f["%blue%"]={value:"Blue",ext:"%d",extMeta:"0-100"},f["%white%"]={value:"White",ext:"%d",extMeta:"0-100"});break;case "heater":f["%thermoOff%"]={value:"off"},f["%thermoOn%"]={value:"off"},
f["%thermoTempTo%"]={value:"Set-Point",ext:"%d"}}return f}(b);b=function(g){var f={};switch(g.type){case "blind":f["%blindState%"]={value:"Position",extMeta:"0-100"};f["%lamellaState%"]={value:"Slat-Position",extMeta:"0-100"};break;case "dimmer":case "dimmerrgbw":case "switch":f["%switchState%"]={value:"OnOff"};"dimmer"===g.type?f["%dimmerState%"]={value:"Brightness",extMeta:"0-100"}:"dimmerrgbw"===g.type&&(f["%dimmerState%"]={value:"Brightness",extMeta:"0-100"},f["%red%"]={value:"Red",extMeta:"0-100"},
f["%green%"]={value:"Green",extMeta:"0-100"},f["%blue%"]={value:"Blue",extMeta:"0-100"},f["%white%"]={value:"White",extMeta:"0-100"});break;case "heater":f["%thermoCurrentTemp%"]={value:"Current"},f["%thermoSetTemp%"]={value:"Set-Point"}}return f}(b);return a._injectToSmartWidgetTemplate(e,d,c,h,b)},createDevice:function(a,b,d){b=xnm.aio.gira.DM;a?d(null,a):d(new b.Error(b.Error.ERROR_CODE.INVALID,"info is missing"))},createGateway:function(a,b,d){var e=this,c,h,g,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:return k.setCatchFinallyBlocks(2),
e._checkGwInfo(a),c=new xnm.aio.gira.GiraServer(a),k.yield(c.isGiraServer(),4);case 4:h=k.yieldResult;if(!h)throw new e.Error(e.Error.ERROR_CODE.NOT_FOUND,"no gira server");if(!a.username||!a.password){k.jumpTo(5);break}return k.yield(c.getToken(a.username,a.password),6);case 6:g=k.yieldResult,a.token=g;case 5:d(null,a);k.leaveTryBlock(0);break;case 2:f=k.enterCatchBlock(),e._handleError(f,d),k.jumpToEnd()}})},deleteDevice:function(a,b,d){d()},deleteGateway:function(a,b,d){d()},getCommandStatusMap:function(a,
b){if(!a.type||!xnm.aio.gira.DM.MAP[a.type])return null;b=JSON.parse(JSON.stringify(xnm.aio.gira.DM.MAP[a.type]));a=a.supportedDataPoints;b.command&&(b.command=this._filterCommandsOrStatuses(b.command,a));b.status&&(b.status=this._filterCommandsOrStatuses(b.status,a));return b},_filterCommandsOrStatuses:function(a,b){var d=this;return a.filter(function(e){var c=e.ref.value;c=d._fixNameOfCommand(c);return b.find(function(h){return(h.dataPointName||h.dataPontName)==c})})},_fixNameOfCommand:function(a){switch(a){case "on":case "off":case "toggle":a=
"OnOff";break;case "StepUp":case "StepDown":a="Step-Up-Down";break;case "Up":case "Down":a="Up-Down";break;case "color":a="Red";break;case "color_white":a="White"}return a},getGatewayType:function(){return[{sys:this.SYS,name:"Gira"}]},getIPDeviceType:function(){return[{sys:xnm.aio.gira.DM.SYS,name:"Gira"}]},getIPevtMap:function(a){return a.type&&xnm.aio.gira.DM.MAP[a.type]?xnm.aio.gira.DM.MAP[a.type].ipevt||null:null},toGeneralDevice:function(a){return a?"blind"===a.type?{type:"blind",commands:{position:{value:{type:"INT",
min:0,max:100}},rotation:{value:{type:"INT",min:0,max:100}},up:{},down:{}},states:{position:{type:"INT",min:0,max:100},rotation:{type:"INT",min:0,max:100}},details:{commands:{position:{value:"Position",ext:"%d",extMeta:"0-100"},rotation:{value:"Slat-Position",ext:"%d",extMeta:"0-100"},up:{value:"Up"},down:{value:"Down"}},states:{position:{value:"Position",ext:"%d",extMeta:"0-100"},rotation:{value:"Slat-Position",ext:"%d",extMeta:"0-100"}}}}:"dimmer"===a.type?{type:"dimmer",commands:{on:{},off:{},
toggle:{},brightness:{value:{type:"INT",min:0,max:100}}},states:{brightness:{type:"INT",min:0,max:100},state:{values:["on","off"]}},details:{commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"},brightness:{value:"Brightness",ext:"%d",extMeta:"0-100"}},states:{brightness:{value:"Brightness",ext:"%d",extMeta:"0-100"},state:{value:"OnOff"}}}}:"dimmerrgbw"===a.type?{type:"dimmer",commands:{on:{},off:{},toggle:{},brightness:{value:{type:"INT",min:0,max:100}},red:{value:{type:"INT",min:0,
max:100}},green:{value:{type:"INT",min:0,max:100}},blue:{value:{type:"INT",min:0,max:100}},white:{value:{type:"INT",min:0,max:100}}},states:{brightness:{type:"INT",min:0,max:100},state:{values:["on","off"]},red:{type:"INT",min:0,max:100},green:{type:"INT",min:0,max:100},blue:{type:"INT",min:0,max:100},white:{type:"INT",min:0,max:100}},details:{commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"},brightness:{value:"Brightness",ext:"%d",extMeta:"0-100"},red:{value:"Red",extMeta:"0-100"},
green:{value:"Green",extMeta:"0-100"},blue:{value:"Blue",extMeta:"0-100"},white:{value:"White",extMeta:"0-100"}},states:{state:{value:"OnOff"},brightness:{value:"Brightness",ext:"%d",extMeta:"0-100"},red:{value:"Red",extMeta:"0-100"},green:{value:"Green",extMeta:"0-100"},blue:{value:"Blue",extMeta:"0-100"},white:{value:"White",extMeta:"0-100"}}}}:"heater"===a.type?{type:"heater",commands:{on:{},off:{},tempTo:{value:{type:"FLOAT",step:.5}}},states:{setpoint:{value:{type:"FLOAT",step:.5}},temperature:{value:{type:"FLOAT",
step:.5}}},details:{commands:{on:{value:"on"},off:{value:"off"},tempTo:{value:"Set-Point",ext:"%f"}},states:{setpoint:{value:"Set-Point"},temperature:{value:"Current"}}}}:"switch"===a.type?{type:"switch",commands:{on:{},off:{},toggle:{}},states:{state:{values:["on","off"]}},details:{commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"}},states:{state:{value:"OnOff"}}}}:null:null},updateDevice:function(a,b,d){b=xnm.aio.gira.DM;a?d(null,a):d(new b.Error(b.Error.ERROR_CODE.INVALID,"info is missing"))},
updateGateway:function(a,b,d,e){var c=this;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(!b)return e(new c.Error(c.Error.ERROR_CODE.INVALID,"no new info")),h.return();c.createGateway(b,d,e);h.jumpToEnd()})},_checkGwInfo:function(a){if(!a)throw new this.Error(this.Error.ERROR_CODE.INVALID,"info is invalid");if(!a.ip)throw new this.Error(this.Error.ERROR_CODE.INVALID,"ip is invalid");},_handleError:function(a,b){console.log(a);a.code?b(a,null):b(new this.Error(this.Error.ERROR_CODE.UNKNOWN,
a.message?a.message:"unknown error"),null)}};xnm.aio.gira.DM.Error=function(a,b){this.code=a;this.message=b;this.stack=Error().stack};xnm.aio.gira.DM.Error.prototype=Error();xnm.aio.gira.DM.Error.prototype.name="GiraDMError";xnm.aio.gira.DM.Error.prototype.code=0;xnm.aio.gira.DM.Error.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOWN:4,NOT_FOUND:5,IP_EXISTS:6};xnm.aio.gira.Handler=function(){var a=require("x.logger.js");a&&(this._logger=a.getLogger("xnm.aio.gira"))};
xnm.aio.gira.Handler.prototype={devicemanager:xnm.aio.gira.DM,discoverWithTimeout:function(a,b){var d=this,e,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress)return h.setCatchFinallyBlocks(2),h.yield(d._findServersLocatedInNetwork(),4);if(2!=h.nextAddress)return e=h.yieldResult,b(null,e),h.leaveTryBlock(0);c=h.enterCatchBlock();d._logger.log("error","discoverWithTimeout");d._logger.log("error",c);b(c,null);h.jumpToEnd()})},doCommand:function(a,b,d){console.log("getDeviceCommands",
"deviceData",a);console.log("getDeviceCommands","commandData",b);var e=this.resolveDevice(a);e?e.executeCommandCreator(a,b,function(c){d&&d(c)}):d&&d(Error("device format invalid"))},doStatus:function(a,b,d,e){console.log("getDeviceCommands","alias",a);console.log("getDeviceCommands","deviceData",b);console.log("getDeviceCommands","statusData",d);(b=this.resolveDevice(b))?b.getStatesCreator(null,[{id:a,status:d}],function(c,h){c?e&&e(c):e&&e(null,h[0])}):e&&e(Error("device format invalid"))},getDeviceCommands:function(a,
b){console.log("getDeviceCommands","deviceData",a);a=(a=xnm.aio.gira.DM.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)},getDeviceList:function(a,b){var d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress){c.setCatchFinallyBlocks(2);if(!a.username)return b(Error("gateway does not have username")),c.return();if(!a.password)return b(Error("gateway does not have password")),c.return();if(!a.token)return b(Error("gateway does not have any token, try to connect to server again")),
c.return();d=new xnm.aio.gira.GiraServer(a);return d.isGiraServer()?c.yield(d.getDevices(b),4):(b(Error("server is not reachable")),c.return())}if(2!=c.nextAddress)return c.leaveTryBlock(0);e=c.enterCatchBlock();b(e);c.jumpToEnd()})},getDeviceStatus:function(a,b){b&&b(Error("not implemented"),null)},registModule:function(a){a.register(xnm.aio.gira.DM.SYS,"gira")},resolveDevice:function(a){return Error("not implemented")},resolveGateway:function(a){return a?xnm.aio.gira.parseJSON(a):null},_findServersLocatedInNetwork:function(){var a,
b,d,e,c,h,g,f,k,l,m,q,n,u,w,v,y,r,t,x,B;return $jscomp.asyncExecutePromiseGeneratorProgram(function(z){switch(z.nextAddress){case 1:a=[];b=require("os");if(!b)throw Error("it is not node environment");d=b.networkInterfaces();e=Object.keys(d);if(!d||0==e.length)throw Error("msg:no_interfaces");c=[];h=$jscomp.makeIterator(e);for(g=h.next();!g.done;g=h.next())for(f=g.value,k=d[f],l=$jscomp.makeIterator(k),m=l.next();!m.done;m=l.next())q=m.value,"IPv4"==q.family&&1!=q.internal&&c.push(q);if(5<c.length)throw Error("msg:max_interfaces|5");
n={};u=$jscomp.makeIterator(c);m=u.next();case 2:if(m.done){z.jumpTo(4);break}w=m.value;v=/(\d{1,3}\.\d{1,3}\.\d{1,3})/gm.exec(w.address);n.$jscomp$loop$prop$base$17=v[0];y=[];for(r=1;253>r;r++)t=n.$jscomp$loop$prop$base$17+"."+r,x=new xnm.aio.gira.GiraServer({sys:"gira",ip:t,port:443},5E3),y.push(x.isGiraServer());return z.yield(Promise.all(y),5);case 5:B=z.yieldResult;B.forEach(function(p){return function(A,C){A&&a.push({sys:"gira",deviceType:A.deviceType,deviceVersion:A.deviceVersion,ip:p.$jscomp$loop$prop$base$17+
"."+(C+1),port:443,name:A.deviceName,version:A.version})}}(n));n={$jscomp$loop$prop$base$17:n.$jscomp$loop$prop$base$17};m=u.next();z.jumpTo(2);break;case 4:return z.return(a)}})}};"undefined"!==typeof exports&&"undefined"!==typeof module&&module.exports&&(exports=module.exports=new xnm.aio.gira.Handler);
