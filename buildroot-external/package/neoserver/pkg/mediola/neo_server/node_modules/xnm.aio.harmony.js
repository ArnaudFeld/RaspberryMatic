var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.harmony=xnm.aio.harmony||{};
xnm.aio.harmony.Hub=function(){var d=function(a,g,b){this._hub=a;this._closeSocket=g;this._callback=b;this._data="";this._devices={devices:[],activities:[]}};d.prototype.execute=function(a){a.write('<iq type="get" id="2320426445" from="e01b88af-b4cd-4d1c-8e76-85562ea3fad5"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?config"></oa></iq>')};d.prototype._onSocketData=function(a){if("<iq/>"!=a&&(this._data+=a,-1!=this._data.indexOf("</iq>"))){a=this._data.indexOf("<![CDATA");
var g=this._data.indexOf("]]\x3e</oa>");if(0<a&&g>a&&(a=JSON.parse(this._data.substring(a+9,g)))&&a.activity&&a.device){for(g=0;g<a.device.length;g++){for(var b=[],c=0;c<a.device[g].controlGroup.length;c++)for(var n=a.device[g].controlGroup[c]["function"],h=0;h<n.length;h++)try{var d=JSON.parse(n[h].action);d&&d.command&&b.push({key:d.command})}catch(f){}this._devices.devices.push({sys:xnm.aio.harmony.DM.SYS,id:a.device[g].id,type:e.DEVICE_TYPE.IR,name:a.device[g].label,ircodes:{sys:xnm.aio.harmony.DM.SYS,
codes:b}})}for(g=0;g<a.activity.length;g++)this._devices.activities.push({sys:xnm.aio.harmony.DM.SYS,id:a.activity[g].id,type:e.DEVICE_TYPE.ACTIVITY,name:a.activity[g].label})}this._callback&&this._callback(null,this._devices);this._hub&&this._hub._onJobFinish(this,this._closeSocket)}};d.prototype._onSocketTimeout=function(){this._callback&&this._callback(null,this._devices);this._hub&&this._hub._onJobFinish(this,!0)};d.prototype._onJobCancelled=function(){this._callback&&this._callback(Error("job cancelled"))};
var b=function(a,g,b,c){this._type="send command";this._hub=a;this._closeSocket=g;this._callback=c;this._type=b.type;this._id=b.id;this._command=b.command;this._socket=null;this._released=!1};b.prototype.execute=function(a){var g;"IRCommand"==this._type?(this._hub&&this._hub._logger.log("debug","send press"),g='<iq type="render" id="3669650010" from="'+this._hub._sessionToken+'"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?holdAction">status=press:action={"command"::"'+
this._command+'","type"::"'+this._type+'","deviceId"::"'+this._id+'"}</oa></iq>\r\n'):(this._hub&&this._hub._logger.log("debug","send activity"),g='<iq type="startActivity" id="1028178097" from="'+this._hub._sessionToken+'"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?startActivity">activityId='+this._id+"</oa></iq>\r\n");this._socket=a;a.write(g)};b.prototype._onSocketData=function(){var a=!1;"IRCommand"==this._type&&this._released?a=!0:"IRCommand"!=this._type&&
(a=!0);"IRCommand"!=this._type||this._released||(this._hub&&this._hub._logger.log("debug","send release"),this._socket.write('<iq type="render" id="3669650010" from="'+this._hub._sessionToken+'"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?holdAction">status=release:action={"command"::"'+this._command+'","type"::"'+this._type+'","deviceId"::"'+this._id+'"}</oa></iq>\r\n'),this._released=!0);a&&(this._callback&&this._callback(null),this._hub&&this._hub._onJobFinish(this))};
b.prototype._onSocketTimeout=function(){this._callback&&this._callback(Error("harmony response timeout"));this._hub&&this._hub._onJobFinish(this)};b.prototype._onJobCancelled=function(){this._callback&&this._callback(Error("job cancelled"))};var c=function(a,g){this._type="ping";this._hub=a;this._callback=g;this._socket=null;this._released=!1};c.prototype.execute=function(a){this._socket=a;a.write('<iq type="get" id="ping"><ping xmlns="urn:xmpp:ping"/></iq>\r\n')};c.prototype._onSocketData=function(a){var g=
!1;-1!=a.indexOf("id='ping'")&&(g=!0);g&&(this._callback&&this._callback(null),this._hub&&this._hub._onJobFinish(this))};c.prototype._onSocketTimeout=function(){this._callback&&this._callback(Error("harmony response timeout"));this._hub&&this._hub._onJobFinish(this)};c.prototype._onJobCancelled=function(){this._callback&&this._callback(Error("job cancelled"))};var f=function(a,g){this._hub=a;this._callback=g;this._data="";this._devices={devices:[],activities:[]}};f.prototype.execute=function(a){a.write('<iq type="get" id="current_activity"><oa xmlns="connect.logitech.com" mime="vnd.logitech.harmony/vnd.logitech.harmony.engine?getCurrentActivity"></oa></iq>')};
f.prototype._onSocketData=function(a){if("<iq/>"!=a&&(this._data+=a,-1!=this._data.indexOf("</iq>"))){a=null;var g=this._data.indexOf("<![CDATA["),b=this._data.indexOf("]]\x3e");0<g&&b>g&&(g=this._data.substring(g+9,b),0==g.indexOf("result=")&&(a=g.substr(7)));this._callback&&this._callback(null,a);this._hub&&this._hub._onJobFinish(this)}};f.prototype._onSocketTimeout=function(){this._callback&&this._callback(null,this._devices);this._hub&&this._hub._onJobFinish(this)};f.prototype._onJobCancelled=
function(){this._callback&&this._callback(Error("job cancelled"))};var e=function(a,g,b,c,e,h){this._logger=require("x.logger.js").getLogger("xnm.aio.harmony.Hub");this.ip=a;this.port=5222;g&&(this.port=g);this.user=b;this.password=c;this.uuid=h;this._authToken=e;this._socket=this._sessionToken=null;this._fsm=0;this._jobQueue=[];this._listener=this._pingIT=null};e.SO_TIMEOUT=5E3;e.FSM_STATE={IDLE:0,CONNECTING:1,CONNECTED:2};e.DEVICE_TYPE={IR:"IRCommand",ACTIVITY:"Activity"};e.prototype.startMonitor=
function(a){var g=this;this._createSession(function(b){g._logger.log("debug","create session finish:"+b);b?(g._fsm=e.FSM_STATE.IDLE,g._clean()):(g._fsm=e.FSM_STATE.CONNECTED,g._startPing());a&&a(b)})};e.prototype.setMonitorListener=function(a){this._listener=a};e.prototype.executeCommandCreator=function(a,b,c,e){b&&b.value?a&&a.id?a.type?(this._logger.log("debug","execute command:"+b.value),this._sendCommand(a.type,b.value,a.id,e,function(a){c&&c(a)})):c&&c(Error("device has no type")):c&&c(Error("device has no id")):
c&&c(Error("command invalid"))};e.prototype.getStatesCreator=function(a,b,c){b?this.getCurrentActivity(function(a,e){for(var h=[],d=0;d<b.length;d++){var f=b[d],p="?";f&&f.id&&b[d].device&&(p=a?"?":-1==e?"off":f.device.id==e?"on":"off",h.push({id:b[d].id,status:p}))}c&&c(null,h)}):c&&c(Error("deviceList is null"))};e.prototype.getDevices=function(a,b){var c=new d(this,a,b);this._addJob(c)};e.prototype.getCurrentActivity=function(a){a=new f(this,a);this._addJob(a)};e.prototype._getAuthToken=function(a){this._logger.log("debug",
"get auth token");var b='{"password":"'+this.password+'", "email":"'+this.user+'"}',c=this,e=require("url").parse("https://svcs.myharmony.com/CompositeSecurityServices/Security.svc/json/GetUserAuthToken");e.port||(e.port=80);var e={host:e.hostname,port:e.port,path:e.path,method:"POST",headers:{"Content-Type":"application/json; charset=utf-8","Content-Length":b.length,Connection:"close"}},d=a;a=require("http").request(e,function(a){if(200==a.statusCode){a.setEncoding("binary");var b="";a.on("data",
function(a){b+=a});a.on("end",function(){var a=JSON.parse(b);a&&a.GetUserAuthTokenResult&&a.GetUserAuthTokenResult.UserAuthToken?((a=a.GetUserAuthTokenResult.UserAuthToken)||(a="dummy_token"),d&&(c._logger.log("trace","get auth token:"+a),d(null,a),d=null)):d&&(c._logger.log("trace","get token http reponse has no token, use dummy token"),d(null,"dummy_token"),d=null)})}else d&&(d(Error("get auth token http response:"+a.statusCode)),d=null)});if(a.on&&"function"==typeof a.on)a.on("error",function(a){d&&
(d(a),d=null)});a.write(b);a.end()};e.prototype._getSessionToken=function(a){this._logger.log("debug","get session token");if(this._sessionToken)a&&a(null,this._sessionToken);else{var b='<iq type="get" id="3174962747" from="guest"><oa xmlns="connect.logitech.com" mime="vnd.logitech.connect/vnd.logitech.pair">token='+this._authToken+":name=1vm7ATw/tN6HXGpQcCs/A5MkuvI#iOS6.0.1#iPhone</oa></iq>",c=!1,d=a,f=this;a={port:this.port,host:this.ip};var h=require("net").connect(a);h.setTimeout(e.SO_TIMEOUT);
h.setEncoding("utf8");h.on("connect",function(){f._logger.log("trace","get session token connect to hub:"+f.ip);c=!0;h.write(b)});h.on("data",function(a){f._logger.log("trace","get session token receive from hub:"+f.ip+" data:"+a);if("<iq/>"!=a){var b=a.indexOf(":identity=");0<b?d&&(d(null,a.substr(b+10,36)),d=null):d&&(d(Error("get session token response has no token")),d=null);h.end()}});h.on("error",function(a){c?(f._logger.log("trace","get session token hub:"+f.ip+" error:"+a.message),h.end()):
f._logger.log("trace","get session token hub:"+f.ip+" connection error:"+a.message);d&&(d(a),d=null)});h.on("timeout",function(){c?(f._logger.log("trace","get session token hub:"+f.ip+" data timeout"),d&&(d(Error("read timeout")),d=null),h.end()):(f._logger.log("trace","get session token hub:"+f.ip+" connection timeout"),d&&(d(Error("connection timeout")),d=null))});h.on("close",function(){f._logger.log("trace","get session token hub:"+f.ip+" close socket");d&&(d(Error("get session token socket closed")),
d=null)});h._doConnect&&"function"==typeof h._doConnect&&h._doConnect()}};e.prototype._login=function(a){this._logger.log("debug","login");var b='<auth xmlns="urn:ietf:params:xml:ns:xmpp-sasl" mechanism="PLAIN">'+(new Buffer(this._sessionToken+"@x.com"+this._sessionToken)).toString("base64")+"</auth>\r\n",c=!1,d=!1,f=a,h=this;a={port:this.port,host:this.ip};var m="",k=require("net").connect(a);k.setTimeout(e.SO_TIMEOUT);k.setEncoding("utf8");k.on("connect",function(){h._logger.log("trace","connect to hub:"+
h.ip);c=!0;k.write("<stream:stream xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams' version='1.0' to='x.com'>\r\n");k.write(b)});k.on("data",function(a){h._logger.log("trace","receive from hub:"+h.ip+" data:"+a);d?h._onSocketData(a):(m+=a,-1!=m.indexOf("<success")&&(h._logger.log("trace","loggin success"),d=!0,f&&(f(null,k),f=null)))});k.on("error",function(a){c?d?(h._logger.log("trace","hub:"+h.ip+" error:"+a.message),h._onSocketError(a)):(h._logger.log("trace","hub:"+h.ip+" login socket error:"+
a.message),f&&(f(a),f=null),k.end()):(h._logger.log("trace","hub:"+h.ip+" connection error:"+a.message),f&&(f(a),f=null))});k.on("timeout",function(){c?d?(h._logger.log("trace","hub:"+h.ip+" data timeout"),h._onSocketTimeout()):(h._logger.log("trace","hub:"+h.ip+" login data timeout"),m?(h._logger.log("trace","authentication fail"),f&&(f(Error("authentication fail")),f=null)):f&&(f(Error("login timeout")),f=null)):(h._logger.log("trace","hub:"+h.ip+" connection timeout"),f&&(f(Error("connection timeout")),
f=null))});k.on("close",function(){h._logger.log("trace","hub:"+h.ip+" close socket");c&&d&&h._onSocketClose()});k._doConnect&&"function"==typeof k._doConnect&&k._doConnect()};e.prototype._startPing=function(){var a=this;this._pingIT=setInterval(function(){var b=new c(a);a._addJob(b)},15E3)};e.prototype._parseNotify=function(a){var b=null;if(!a||-1==a.indexOf('type="connect.stateDigest?notify"'))return null;var c=a.indexOf("<![CDATA[");if(-1==c)return null;var c=c+9,d=a.indexOf("]]\x3e",c);if(-1==
d)return null;a=a.substring(c,d);try{var e=JSON.parse(a);if(e.activityId)switch(b={activityId:e.activityId},e.activityStatus){case 3:b.activityStatus="POWERING_OFF";break;case 2:b.activityStatus="RUNNING";break;case 1:b.activityStatus="STARTING";break;case 0:b.activityStatus="NO_ACTIVITY"}return b}catch(f){return null}};e.prototype._sendCommand=function(a,c,d,e,f){a=new b(this,e,{type:a,command:c,id:d},f);this._addJob(a)};e.prototype._addJob=function(a){var b=this._jobQueue.length;this._jobQueue.push(a);
0==b&&this._doNextJob()};e.prototype._onSocketTimeout=function(){if(this._jobQueue&&0<this._jobQueue.length){var a=this._jobQueue[0];a&&a._onSocketTimeout&&a._onSocketTimeout()}};e.prototype._onSocketError=function(){this._closeSocket()};e.prototype._onSocketClose=function(){this._clean();if(this._listener&&this._listener.onClose)this._listener.onClose()};e.prototype._onSocketData=function(a){if(this._jobQueue&&0<this._jobQueue.length){var b=this._jobQueue[0];b&&b._onSocketData&&b._onSocketData(a)}this._listener&&
this._listener.onData&&(b=this._parseNotify(a),this._listener.onData(a,b))};e.prototype._onJobFinish=function(a,b){a&&this._jobQueue&&this._jobQueue[0]===a&&(this._jobQueue.splice(0,1),b&&this._closeSocket(),this._doNextJob())};e.prototype._closeSocket=function(){this._logger.log("trace","manually close socket");this._socket&&this._socket.end();this._clean()};e.prototype._clean=function(){if(this._jobQueue)for(var a=0;a<this._jobQueue.length;a++)this._jobQueue[a]._onJobCancelled();this._jobQueue=
[];this._pingIT&&clearInterval(this._pingIT);this._sessionToken=this._socket=this._pingIT=null;this._fsm=e.FSM_STATE.IDLE};e.prototype._doNextJob=function(){var a=this;this._jobQueue&&0<this._jobQueue.length&&(this._fsm==e.FSM_STATE.IDLE?(this._logger.log("debug","not connected"),this._fsm=e.FSM_STATE.CONNECTING,this._createSession(function(b){a._logger.log("debug","create session finish:"+b);b?(a._fsm=e.FSM_STATE.IDLE,a._clean()):(a._fsm=e.FSM_STATE.CONNECTED,a._doNextJob())})):this._fsm==e.FSM_STATE.CONNECTED&&
(this._logger.log("debug","execute next job"),this._jobQueue[0].execute(this._socket)))};e.prototype._createSession=function(a){var b=this;this._authToken?this._sessionToken?this._login(function(c,d){c||!d?(b._sessionToken=null,a&&a(c?c:Error("socket is null"))):(b._socket=d,a&&a(c))}):this._getSessionToken(function(c,d){c?a&&a(c):d?(b._sessionToken=d,b._createSession(a)):a&&a(Error("invalid session token"))}):this._getAuthToken(function(c,d){c?a&&a(c):d?(b._authToken=d,b._createSession(a)):a&&a(Error("invalid auth token"))})};
e.prototype.toJSON=function(){return{sys:xnm.aio.harmony.DM.SYS,ip:this.ip,port:this.port,username:this.user,password:this.password,token:this._authToken,uuid:this.uuid}};e.prototype.equalsTo=function(a){return a&&a instanceof e?this.ip==a.ip&&this.port==a.port&&this.user==a.user&&this.password==a.password:!1};e.parseJSON=function(a){return a&&a.ip&&a.username&&a.password?new xnm.aio.harmony.Hub(a.ip,a.port,a.username,a.password,a.token,a.uuid):null};return e}();
xnm.aio.harmony.Discovery=function(){var d=function(){this.Hubs={};this._sockets=[];var b=this;this._server=require("net").createServer(function(a){a.on("data",function(a){var c={};a=a.toString().split(";");for(var d=0;d<a.length;d++){var e=a[d].split(":");2==e.length&&(c[e[0]]=e[1])}c.ip&&c.port&&c.uuid&&(b.Hubs[c.uuid]?b.Hubs[c.uuid].ip=c.ip:b.Hubs[c.uuid]=new xnm.aio.harmony.Hub(c.ip,c.port,c.email,null,null,c.uuid))});a.on("end",function(){});a.on("error",function(a){})});this._server.listen();
var c=require("os");require("dgram");if(c&&c.networkInterfaces){var c=c.networkInterfaces(),d;for(d in c)for(var e=c[d],a=0;a<e.length;a++)this._addDiscoverSocket(null,e[a])}else this._addDiscoverSocket(null,null)};d.prototype._addDiscoverSocket=function(b,c){var d=require("dgram"),e;c?"IPv4"==c.family&&0==c.internal&&(e=d.createSocket("udp4"),e.on("listening",function(){e.setBroadcast(!0)}),e.ip=c.address,this._sockets.push(e)):(e=d.createSocket("udp4"),this._sockets.push(e))};d.prototype._sendDiscoveryMessages=
function(){for(var b=0;b<this._sockets.length;b++)if(this._sockets[b].ip){var c=this._sockets[b].ip.substr(0,this._sockets[b].ip.lastIndexOf("."))+".255",d=new Buffer("_logitech-reverse-bonjour._tcp.local.\n"+this._server.address().port);this._sockets[b].send(d,0,d.length,5224,c)}};d.prototype.discoverHubs=function(){var b=this,c=0,d=setInterval(function(){b._sendDiscoveryMessages();1<=c++&&clearInterval(d)},250)};return d}();
xnm.aio.harmony.DM=function(){var d=function(b,c){this.code=b;this.message=c;this.stack=Error().stack};d.prototype=Error();d.prototype.name="HarmonyDeviceManagerError";d.prototype.code=0;d.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"harmony",getGatewayType:function(){return{sys:this.SYS,name:"Logitech Harmony Hub"}},createGateway:function(b,c,f){c=d.ERROR_CODE;b?b.ip?b.port?b.username?b.password?f(null,b):f(new d(c.INVALID,"password is invalid")):
f(new d(c.INVALID,"username is invalid")):f(new d(c.INVALID,"port is invalid")):f(new d(c.INVALID,"ip is invalid")):f(new d(c.INVALID,"info is invalid"))},updateGateway:function(b,c,f,e){b=d.ERROR_CODE;c?c.ip?c.port?c.username?c.password?e(null,c):e(new d(b.INVALID,"password is invalid")):e(new d(b.INVALID,"username is invalid")):e(new d(b.INVALID,"port is invalid")):e(new d(b.INVALID,"ip is invalid")):e(new d(b.INVALID,"update is invalid"))},deleteGateway:function(b,c,d){d()},createDevice:function(b,
c,f){var e=d.ERROR_CODE;if(b)if(b.gateway)if(c.data&&c.data.gateways&&0!==c.data.gateways.length){c=c.data.gateways;var a,g;for(a=0;a<c.length;a++)if(c[a].index===b.gateway){g=c[a];break}g?f(null,b):f(new d(e.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else f(new d(e.NOT_FOUND,"gateway with index "+b.gateway+" not exists"));else f(new d(e.INVALID,"gateway is invalid"));else f(new d(e.INVALID,"info is invalid"))},updateDevice:function(b,c,f){var e=d.ERROR_CODE;if(b)if(b.gateway){c=c.data.gateways;
var a,g;for(a=0;a<c.length;a++)if(c[a].index===b.gateway){g=c[a];break}g?f(null,b):f(new d(e.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else f(new d(e.INVALID,"gateway is invalid"));else f(new d(e.INVALID,"info is invalid"))},deleteDevice:function(b,c,d){d()},getCommandStatusMap:function(b){var c={command:[]};if(b&&b.type&&b.type==xnm.aio.harmony.Hub.DEVICE_TYPE.IR){if(b&&b.ircodes&&b.ircodes.codes){for(var d=0;d<b.ircodes.codes.length;d++){var e=b.ircodes.codes[d];c.command.push({type:"enum",
name:e.key,ref:{value:e.key}})}return c}}else if(b&&b.type&&b.type==xnm.aio.harmony.Hub.DEVICE_TYPE.ACTIVITY)return c.command.push({type:"enum",name:"execute",ref:{value:"execute"}}),c.status=[{type:"enum",name:"state",ref:{value:"state",options:["on","off"]}}],c.ipevt="-1"==b.id?[{type:"enum",name:"event",ref:{value:"event",options:["allOff"]}}]:[{type:"enum",name:"event",ref:{value:"event",options:["on","off"]}}],c;return null},applyUIFilter:function(b,c){var d=function(a,b){if("*"==a)return!0;
for(var c=!1,d=0;d<a.length;d++)if(a[d]==b){c=!0;break}return c},e=function(a,b,c){var e=[];switch(c.catagory){case "command":a.command&&a.command.forEach(function(a){d(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))});break;case "status":a.status&&a.status.forEach(function(a){d(c.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),e.push(a))})}return e},a=function(a,b){var c=[],d=null;if(d=xnm.aio.harmony.DM.getCommandStatusMap(a))d=e(d,a,b),c=c.concat(d);return c};if(!b.sys)return null;
var g=JSON.parse(JSON.stringify(b)),l=null;switch(c.catagory){case "command":l=a(b,c);g.command=l;break;case "status":l=a(b,c);g.status=l;break;default:return null}return l&&0!=l.length?g:null},applyIPEventFilter:function(b,c){if(!b.sys)return null;var d=JSON.parse(JSON.stringify(b)),e=xnm.aio.harmony.DM.getCommandStatusMap(b);if(!e)return d;d.ipevt=e.ipevt;return d}}}();xnm.aio.harmony.Handler=function(){this._Discovery=null};xnm.aio.harmony.Handler.prototype.devicemanager=xnm.aio.harmony.DM;
xnm.aio.harmony.Handler.prototype.Hub=xnm.aio.harmony.Hub;xnm.aio.harmony.Handler.prototype.discoverHubs=function(d,b){this._Discovery||(this._Discovery=new xnm.aio.harmony.Discovery);this._Discovery.discoverHubs();var c=this;setTimeout(function(){b&&b(null,c._Discovery.Hubs)},d)};xnm.aio.harmony.Handler.prototype.registModule=function(d){d.register(xnm.aio.harmony.DM.SYS,"harmony")};xnm.aio.harmony.Handler.prototype.resolveGateway=function(d){return xnm.aio.harmony.Hub.parseJSON(d)};
xnm.aio.harmony.Handler.prototype.getDeviceCommands=function(d,b){var c=xnm.aio.harmony.DM.applyUIFilter(d,{catagory:"command",elems:"*"}),c=c?c.command:[];b&&b(null,c)};xnm.aio.harmony.Handler.prototype.getDeviceStatus=function(d,b){var c=xnm.aio.harmony.DM.applyUIFilter(d,{catagory:"status",elems:"*"}),c=c?c.status:[];b&&b(null,c)};xnm.aio.harmony.Handler.prototype.getDevices=function(d,b){var c=this.resolveGateway(d);c?c.getDevices(!0,b):b&&b(Error("gateway json format invalid"))};
xnm.aio.harmony.Handler.prototype.doCommand=function(d,b,c,f){(d=this.resolveGateway(d))?d.executeCommandCreator(b,c,f,!0):f&&f(Error("gateway json format invalid"))};xnm.aio.harmony.Handler.prototype.doStatus=function(d,b,c,f,e){(b=this.resolveGateway(b))?b.getStatesCreator(null,[{id:d,device:c,status:f}],function(a,b){a?e&&e(a):e&&e(null,b[0])}):e&&e(Error("gateway json format invalid"))};
xnm.aio.harmony.Handler.prototype.getAuthToken=function(d,b){var c=this.resolveGateway(d);c?c._getAuthToken(b):b&&b(Error("gateway json format invalid"))};"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.harmony.Handler);
