var x=x||{};x.xmlrpc=x.xmlrpc||{};x.xmlrpc.Handler=function(){};x.xmlrpc.Handler.prototype.serializeReq=function(a,c){if(!a)throw Error("method name invalid");var b;b='<?xml version="1.0" encoding="UTF-8"?><methodCall>'+("<methodName>"+this._escapeXml(a)+"</methodName>");b+=this.serializeParams(c);return b+="</methodCall>"};
x.xmlrpc.Handler.prototype.serializeRsp=function(a,c){var b;b='<?xml version="1.0" encoding="UTF-8"?><methodResponse>';a?b+=this.serializeFault(a):c&&(b+=this.serializeParams(c));return b+"</methodResponse>"};x.xmlrpc.Handler.prototype.serializeFault=function(a){var c="<fault>";(a=this.serializeValue(a))&&(c+=a);return c+"</fault>"};
x.xmlrpc.Handler.prototype.serializeParams=function(a){var c="<params>",b;if(a)for(var e=0;e<a.length;e++)(b=this.serializeValue(a[e]))&&(c+="<param>"+b+"</param>");return c+"</params>"};
x.xmlrpc.Handler.prototype.serializeValue=function(a,c){if(null===a||"undefined"===typeof a)return"<value><nil/></value>";if(c)return"<value><"+c+">"+a+"</"+c+"></value>";var b,e;switch(typeof a){case "boolean":return"<value><boolean>"+(a?1:0)+"</boolean></value>";case "number":return 0===a%1?"<value><i4>"+a+"</i4></value>":"<value><double>"+a+"</double></value>";case "string":return"<value><string>"+this._escapeXml(a)+"</string></value>";case "object":if(a instanceof Date)return"<value><dateTime.iso8601>"+
this._formatDateISO8601(a)+"</dateTime.iso8601></value>";if("[object Array]"===Object.prototype.toString.call(a)){b="<value><array><data>";for(var d=0;d<a.length;d++)(e=this.serializeValue(a[d]))&&(b+=e);b+="</data></array></value>"}else{if(a.__rpcValueType)return this.serializeValue(a.__rpcValue,a.__rpcValueType);b="<value><struct>";for(d in a)a.hasOwnProperty(d)&&(e=this.serializeValue(a[d]))&&(b+="<member><name>"+this._escapeXml(d)+"</name>"+e+"</member>");b+="</struct></value>"}return b;default:return null}};
x.xmlrpc.Handler.prototype.deserializeReq=function(a){if(!a)throw Error("xml invalid");var c;try{c=$($.parseXML(a))}catch(b){throw b;}a=c.children();if(!a||1!=a.length)throw Error("method call invalid:0");c=$(a[0]);var e=c.prop("tagName");if("methodCall"!=e)throw Error("method call invalid:1");a=c.children();if(!a||2!=a.length)throw Error("method call invalid:2");c=$(a[0]);e=c.prop("tagName");if("methodName"!=e)throw Error("method call invalid:3");var d=c.text();c=$(a[1]);e=c.prop("tagName");if("params"!=
e)throw Error("method call invalid:4");return{methodName:d,params:this.deserializeParams(c)}};
x.xmlrpc.Handler.prototype.deserializeRsp=function(a){if(!a)throw Error("xml invalid");var c;try{c=$($.parseXML(a))}catch(b){throw b;}a=c.children();if(!a||1!=a.length)throw Error("method response invalid:0");a=$(a[0]);c=a.prop("tagName");if("methodResponse"!=c)throw Error("method response invalid:1");a=a.children();if(!a||1!=a.length)throw Error("method response invalid:2");a=$(a[0]);c=a.prop("tagName");if("fault"==c)return{error:this.deserializeFault(a)};if("params"==c)return{params:this.deserializeParams(a)};
throw Error("method response invalid:3");};x.xmlrpc.Handler.prototype.deserializeFault=function(a){if(!a)throw Error("fault node is null");if("fault"!=a.prop("tagName"))throw Error("fault invalid");a=a.children();if(!a||1!=a.length||!a[0])throw Error("fault value invalid");return this.deserializeValue($(a[0]))};
x.xmlrpc.Handler.prototype.deserializeParams=function(a){if(!a)throw Error("params node is null");if("params"!=a.prop("tagName"))throw Error("params invalid");a=a.children();var c=[];if(!a||0==a.length)return c;for(var b=0;b<a.length;b++){var e=$(a[b]);if(!e||"param"!=e.prop("tagName"))throw Error("params invalid");e=e.children();if(!e||1!=e.length||!e[0])throw Error("param invalid");e=$(e[0]);e=this.deserializeValue(e);c.push(e)}return c};
x.xmlrpc.Handler.prototype.deserializeValue=function(a){if(!a)throw Error("value node is null");var c=a.prop("tagName");if("value"!=c)throw Error("value invalid");var b=a.children();if(!b||0==b.length||!b[0])return b=a.text(),null==b||"undefiend"==typeof b?"":b;var e=$(b[0]),c=e.prop("tagName"),d;switch(c){case "nil":d=null;break;case "boolean":d=e.text();if(null==d||"undefined"==typeof d||0==d.length||"1"!=d&&"0"!=d)throw Error("boolean value invalid");d="1"==d;break;case "i4":case "int":d=e.text();
if(null==d||"undefined"==typeof d||0==d.length)throw Error("int value invalid");d=parseInt(d);if(isNaN(d))throw Error("int value invalid");break;case "double":d=e.text();if(null==d||"undefined"==typeof d||0==d.length)throw Error("double value invalid");d=parseFloat(d);if(isNaN(d))throw Error("double value invalid");break;case "string":d=(d=e.text())?d:"";break;case "dateTime.iso8601":d=e.text();if(null==d||"undefined"==typeof d||0==d.length)throw Error("dateTime value invalid");d=this._resolveDateISO8601(d);
break;case "array":b=e.children();if(!b||1!=b.length||!b[0])throw Error("array invalid");e=$(b[0]);c=e.prop("tagName");if("data"!=c)throw Error("array data invalid");b=e.children();d=[];if(b||0!=b.length)for(a=0;a<b.length;a++)b[a]&&(c=this.deserializeValue($(b[a])),d.push(c));break;case "struct":d={};b=e.children();if(!b||0==b.length)break;for(a=0;a<b.length;a++)if(b[a]){var e=$(b[a]),f=e.children();if(!f||2!=f.length)throw Error("struct member invalid");if(!f[0]||!f[1])throw Error("struct member invalid");
e=$(f[0]);c=e.prop("tagName");if("name"!=c)throw Error("struct member name invalid");c=e.text();if(!c)throw Error("struct member name invalid");e=$(f[1]);d[c]=this.deserializeValue(e)}}return d};x.xmlrpc.XML_CHAR_MAP={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"};x.xmlrpc.Handler.prototype._escapeXml=function(a){return a.replace(/[<>&"']/g,function(a){return x.xmlrpc.XML_CHAR_MAP[a]})};
x.xmlrpc.Handler.prototype._unescapeXml=function(a){if(!a)return a;a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");a=a.replace(/&amp;/g,"&");a=a.replace(/&quot;/g,'"');return a=a.replace(/&apos;/g,"'")};
x.xmlrpc.Handler.prototype._formatDateISO8601=function(a){var c=function(a){a=String(a);1===a.length&&(a="0"+a);return a};return Date.prototype.toISOString?a.toISOString():this.getUTCFullYear()+"-"+c(this.getUTCMonth()+1)+"-"+c(this.getUTCDate())+"T"+c(this.getUTCHours())+":"+c(this.getUTCMinutes())+":"+c(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1E3).toFixed(3)).slice(2,5)+"Z"};
x.xmlrpc.Handler.prototype._resolveDateISO8601=function(a){a=a.replace(/\D/g," ");a=a.split(" ");a[1]--;return new Date(Date.UTC(a[0],a[1],a[2],a[3],a[4],a[5]))};"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.xmlrpc.Handler);
