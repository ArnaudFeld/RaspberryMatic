var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(d,a,b){if(null==d)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return d+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,a,b){d!=Array.prototype&&d!=Object.prototype&&(d[a]=b.value)};$jscomp.getGlobal=function(d){d=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,d];for(var a=0;a<d.length;++a){var b=d[a];if(b&&b.Math==Math)return b}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,a,b,c){if(a){b=$jscomp.global;d=d.split(".");for(c=0;c<d.length-1;c++){var g=d[c];g in b||(b[g]={});b=b[g]}d=d[d.length-1];c=b[d];a=a(c);a!=c&&null!=a&&$jscomp.defineProperty(b,d,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("String.prototype.repeat",function(d){return d?d:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var c="";a;)if(a&1&&(c+=b),a>>>=1)b+=b;return c}},"es6","es3");var util=require("util"),EventEmitter=require("events"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.sonos=x.hub.m.sonos||{};x.hub.m.sonos.MODULE=require("xnm.aio.sonos.js");
x.hub.m.sonos.AudioPlayer=function(){var d=function(){this._process={}};d.prototype.playFile=function(a,b,c){if(b&&b.file){var d=require("x.hub.resource.js").getFileURL(b.file,a.ip);d?(b.url=d,this.playUrl(a,b,c)):c&&c(Error("no such file"))}else c&&c(Error("invalid file"))};d.prototype.playUrl=function(a,b,c){if(b&&b.url){var d=x.hub.m.sonos.MODULE.resolveDevice(a);if(d){var f=b.url,e=this;this._cancelPlay(d,function(a){a?c&&c(a):e._setVolume(d,b.volume,function(a){a?c&&c(a):e._unmute(d,function(a){a?
c&&c(a):e._playUrl(d,f,function(a){a?c&&c(a):e._setRepeat(d,b.repeat,function(a){a?c&&c(a):b.repeat&&-1!=b.repeat&&(e._process[d.ip]={url:f},e._process[d.ip].timeout=setTimeout(function(){var a=e._process[d.ip].url;e._process[d.ip]=null;e._stopPlay(d,a)},1E3*parseInt(b.repeat)))})})})})});c&&c(null,1)}else c&&c(Error("invalid device json"))}else c&&c(Error("invalid url"))};d.prototype._cancelPlay=function(a,b){if(a.ip&&this._process[a.ip]){this._process[a.ip].timeout&&clearTimeout(this._process[a.ip].timeout);
var c=this._process[a.ip].url;this._process[a.ip]=null;c?this._stopPlay(a,c,b):b&&b()}else b&&b()};d.prototype._stopPlay=function(a,b,c){a.getMediaInfo(function(d,f){d||!f?a.stop(c):f.currentURI&&f.currentURI!=b?c&&c():a.stop(c)})};d.prototype._setVolume=function(a,b,c){b?a.setVolume(b,c):c&&c()};d.prototype._setRepeat=function(a,b,c){b?a.repeatOne(c):a.repeatOff(c)};d.prototype._unmute=function(a,b){a.unmute(b)};d.prototype._playUrl=function(a,b,c){b?a.playUrl(b,c):c&&c(Error("invalid url"))};return d}();
x.hub.m.sonos.Handler=function(){var d=function(){this._audioPlayer=new x.hub.m.sonos.AudioPlayer};util.inherits(d,EventEmitter);d.prototype.init=function(a){a&&a()};d.prototype.getSystems=function(){return["sonos"]};d.prototype.executeCommand=function(a,b,c){b?"playFile"==b.value?this._audioPlayer.playFile(a,b,function(a){c&&c({error:a})}):"playUrl"==b.value?this._audioPlayer.playUrl(a,b,function(a){c&&c({error:a})}):x.hub.m.sonos.MODULE.doCommand(a,b,c):c&&c({error:Error("invalid command")})};return d}();
"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.sonos.Handler);
