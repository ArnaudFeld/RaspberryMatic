var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,e={next:function(){if(c<b.length){var d=c++;return{value:a(d,b[d]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(b,a,c,e){if(a){c=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var d=b[e];d in c||(c[d]={});c=c[d]}b=b[b.length-1];e=c[b];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.hautau=xnm.aio.hautau||{};
xnm.aio.hautau.Gateway=function(){var b=function(a,c){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.hautau.Gateway ");this.ip=a;this.port=c;this.port||(this.port=80);this.timeout=1E3;this._statesBuffer={};this._fifo=[]};b.DEVICETYPE_MAP={0:"general",1:"multisensor",2:"outputbox203v",4:"general",5:"ventra",6:"general",7:"general",8:"general",9:"drive",10:"general",11:"general",100:"general",101:"ska20cd",102:"drive",103:"hscd",
104:"general",106:"drive",107:"general",108:"general",255:"general"};b.prototype.executeCommandCreator=function(a,c,e){if(c&&c.value)if(a)if("undefined"==typeof a.address||null==a.address)e&&e(Error("device json format invali"));else switch(c.value){case "open":this._open(a.address,e);break;case "close":this._close(a.address,e);break;case "stop":this._stop(a.address,e);break;case "levelUp":this._setVentraLevel(a.address,"up",e);break;case "levelDown":this._setVentraLevel(a.address,"down",e);break;
case "levelTo":this._setVentraLevel(a.address,c.ext,e);break;case "keyboardOn":this._setVentraKeyboard(a.address,"on",e);break;case "keyboardOff":this._setVentraKeyboard(a.address,"off",e);break;case "lockOn":this._setHscdLock(a.address,"on",e);break;case "lockOff":this._setHscdLock(a.address,"off",e);break;default:e&&e(Error("command not exist"))}else e&&e(Error("device json is null"));else e&&e(Error("command json format invalid"))};b.prototype.getStatesCreator=function(a,c,e){for(var d={},b=0;b<
c.length;b++)(a=c[b])&&a.device&&"undefined"!=typeof a.device.address&&null!=a.device.address&&a.device.type&&(d[a.device.address]=a.device.type);var g=[],k=this,h=Object.keys(d);b=0;var m=function(a,f){if(!a&&f){a=h[b];if(f){for(var q=[],p=0;p<c.length;p++){var n=c[p];if(n&&n.id&&n.device&&n.device.address&&n.device.address==a&&n.status&&n.status.value){var l=f[n.status.value];"undefined"!=typeof l&&null!=l&&q.push({id:n.id,status:l})}}f=q}else f=[];f&&(g=g.concat(f))}b++;b<h.length?k._getDeviceStates(h[b],
d[h[b]],m):e&&e(null,g)};this._getDeviceStates(h[b],d[h[b]],m)};b.prototype.listDevices=function(a,c){var e=this,d=0,b=30;if("object"===typeof a&&null!==a){var g=Number(a.start);a=Number(a.end);!isNaN(g)&&0<=g&&255>=g&&(d=g);!isNaN(a)&&0<=a&&255>=a&&(b=a);b<d&&(b=d)}var k=d,h=0,m=[],l=function(a,f){a&&-3!=a.code?d==k&&5>h?(h++,e._ping(d,l)):c&&c(a,m):(!a&&f&&(f.sys="hautau",f.type=f.DeviceType,f.address=d,m.push(f)),d++,d>b?c&&c(null,m):e._ping(d,l))};this._ping(d,l)};b.prototype._getDeviceStates=
function(a,c,e){var d=(new Date).getTime(),f=!1,g=this._statesBuffer[a];g?g.timestamp&&3E3<d-g.timestamp&&(f=!0,g.timestamp=d):(f=!0,this._statesBuffer[a]={states:null,timestamp:d},g=this._statesBuffer[a]);c=b.DEVICETYPE_MAP[c];if("undefined"==typeof c||null==c)e&&e(Error("unknown device type"));else if(f){var k=this;switch(c){case "drive":this._getDriveStates(a,function(c,d){!c&&d&&(k._statesBuffer[a]={states:d,timestamp:(new Date).getTime()});e&&e(c,d)});break;case "multisensor":this._getMultiSensorStates(a,
function(c,d){!c&&d&&(k._statesBuffer[a]={states:d,timestamp:(new Date).getTime()});e&&e(c,d)});break;case "ska20cd":this._getSka20cdStates(a,function(c,d){!c&&d&&(k._statesBuffer[a]={states:d,timestamp:(new Date).getTime()});e&&e(c,d)});break;case "ventra":this._getVentraStates(a,function(c,d){!c&&d&&(k._statesBuffer[a]={states:d,timestamp:(new Date).getTime()});e&&e(c,d)});break;case "hscd":this._getHscdStates(a,function(c,d){!c&&d&&(k._statesBuffer[a]={states:d,timestamp:(new Date).getTime()});
e&&e(c,d)});break;default:e&&e(null,null)}}else e&&e(null,g.states)};b.prototype._open=function(a,c){this._executeRequest("/hautau/open",{adr:a},null,function(a,d){c&&c(a,d)})};b.prototype._close=function(a,c){this._executeRequest("/hautau/close",{adr:a},null,function(a,d){c&&c(a,d)})};b.prototype._stop=function(a,c){this._executeRequest("/hautau/stop",{adr:a},null,function(a,d){c&&c(a,d)})};b.prototype._getDriveStates=function(a,c){this._executeRequest("/hautau/drive",{adr:a,state:"show"},null,function(a,
d){a?c&&c(a,d):(a={Closed:"yes"==d.Closed,Opened:"yes"==d.Opened,PowerCutoff:"yes"==d.PowerCutoff,State:"yes"==d.Closed?"closed":"open"},c&&c(null,a))})};b.prototype._getMultiSensorStates=function(a,c){this._executeRequest("/hautau/multisensor",{adr:a,state:"show"},null,function(a,d){a?c&&c(a,d):(d.Temperature=d.Temperature.toFixed(1),c&&c(null,d))})};b.prototype._getSka20cdStates=function(a,c){this._executeRequest("/hautau/ska20cd",{adr:a,state:"show"},null,function(a,d){a?c&&c(a,d):(a={Closed:"yes"==
d.Closed,Opened:"yes"==d.Opened,PowerCutoff:"yes"==d.PowerCutoff,State:"yes"==d.Closed?"closed":"open"},c&&c(null,a))})};b.prototype._getVentraStates=function(a,c){this._executeRequest("/hautau/ventra",{adr:a,state:"show"},null,function(a,d){a?c&&c(a,d):(d.FilterChange="yes"==d.FilterChange,c&&c(null,d))})};b.prototype._setVentraLevel=function(a,c,b){var d=this;c||(c=0);this._executeRequest("/hautau/ventra",{adr:a,level:c},null,function(c,e){if(c)b&&b(c,e);else if("undefined"!=typeof e.Level&&null!=
e.Level){c=(new Date).getTime();var f=d._statesBuffer[a];f||(d._statesBuffer[a]={states:{},timestamp:c},f=this._statesBuffer[a]);f.states.Level=e.Level}})};b.prototype._setVentraKeyboard=function(a,c,b){var d=this;this._executeRequest("/hautau/ventra",{adr:a,keyboard:c},null,function(c,e){if(c)b&&b(c,e);else if("undefined"!=typeof e.Keyboard&&null!=e.Keyboard){c=(new Date).getTime();var f=d._statesBuffer[a];f||(d._statesBuffer[a]={states:{},timestamp:c},f=this._statesBuffer[a]);f.states.Keyboard=
e.Keyboard}})};b.prototype._getHscdStates=function(a,c){this._executeRequest("/hautau/hscd",{adr:a,state:"show"},null,function(a,d){a?c&&c(a,d):(d.WindowDown="yes"==d.WindowDown,d.WindowClosed="yes"==d.WindowClosed,d.State=d.WindowClosed?"closed":"open",c&&c(null,d))})};b.prototype._setHscdLock=function(a,c,b){var d=this;this._executeRequest("/hautau/hscd",{adr:a,lock:c},null,function(c,e){if(c)b&&b(c,e);else if("undefined"!=typeof e.Lock&&null!=e.Lock){c=(new Date).getTime();var f=d._statesBuffer[a];
f||(d._statesBuffer[a]={states:{},timestamp:c},f=this._statesBuffer[a]);f.states.Lock=e.Lock}})};b.prototype._ping=function(a,c){this._executeRequest("/hautau/ping",{adr:a},2E3,c)};b.prototype._executeRequest=function(a,c,b,d){var e=this._fifo.length;this._fifo.push({path:a,params:c,timeout:b,callback:d});0==e&&this._doNextRequest()};b.prototype._doNextRequest=function(){if(0!=this._fifo.length){var a=this._fifo[0],c=this;this._doJsonRequest(a.path,a.params,a.timeout,function(b,d){try{a.callback&&
a.callback(b,d)}catch(f){}c._fifo.splice(0,1);c._doNextRequest()})}};b.prototype._doJsonRequest=function(a,c,b,d){this._doRequest("GET",a,c,b,function(a,c){if(a)d&&d(a);else if(c)try{var b=JSON.parse(c);"ok"!=b.Result?(a=Error(b.Result?b.Result:"result param is empty"),a.code=-3,d&&d(a)):d&&d(null,b)}catch(h){h.code=-2,d&&d(h)}else a=Error("request empty"),a.code=-2,d&&d(a)})};b.prototype._doRequest=function(a,c,b,d,f){d||(d=this.timeout);var e=this;c="http://"+this.ip+":"+this.port+c;if(b){var k=
[],h;for(h in b){var m=b[h];if("undefined"==typeof m||null==m)m="";k.push(h+"="+encodeURIComponent(m))}c+="?"+k.join("&")}this._logger.log("trace","send "+a+" to url:"+c);var l=f;$.ajax({url:c,type:a,timeout:d,dataType:"text",cache:!0,success:function(a){e._logger.log("trace","http request success:"+a);l&&(l(null,a),l=null)},error:function(a,c){a="http request error:"+(a?a.status:"0")+"-"+c;e._logger.log("trace",a);l&&(a=Error(a),a.code=-1,l(a),l=null)}})};b.prototype.toJSON=function(){return{sys:"hautau",
ip:this.ip,port:this.port}};b.prototype.equalsTo=function(a){return a&&a instanceof b?this.ip==a.ip&&this.port==a.port:!1};b.parseJSON=function(a){return a.ip?new b(a.ip,a.port):null};return b}();
xnm.aio.hautau.DM=function(){var b=function(a,b){this.code=a;this.message=b;this.stack=Error().stack};b.prototype=Error();b.prototype.name="HautauDMError";b.prototype.code=0;b.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var a={general:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}]},outputbox203v:{command:[{type:"enum",name:"open",ref:{value:"open"}},
{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}]},multisensor:{status:[{type:"int",name:"co2",ref:{value:"CO2"}},{type:"float",name:"temperature",ref:{value:"Temperature"}},{type:"int",name:"humidity",ref:{value:"Humidity"}}]},drive:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"power cutoff",ref:{value:"PowerCutoff",options:["true",
"false"]}},{type:"enum",name:"opened",ref:{value:"Opened",options:["true","false"]}},{type:"enum",name:"closed",ref:{value:"Closed",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"State",options:["open","closed"]}}]},ska20cd:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"power cutoff",ref:{value:"PowerCutoff",options:["true","false"]}},{type:"enum",name:"opened",
ref:{value:"Opened",options:["true","false"]}},{type:"enum",name:"closed",ref:{value:"Closed",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"State",options:["open","closed"]}}]},ventra:{command:[{type:"int",name:"set level",ref:{value:"levelTo",ext:"%d",extMeta:"0-4"}},{type:"enum",name:"level up",ref:{value:"levelUp"}},{type:"enum",name:"level down",ref:{value:"levelDown"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:"no temperature fan1 fan2 keyboard opened".split(" ")}},
{type:"enum",name:"change filter",ref:{value:"FilterChange",options:["true","false"]}},{type:"int",name:"filter percent",ref:{value:"FilterPercent",extMeta:"0-100"}},{type:"int",name:"level0 runtime",ref:{value:"RuntimeLevel0"}},{type:"int",name:"level1 runtime",ref:{value:"RuntimeLevel1"}},{type:"int",name:"level2 runtime",ref:{value:"RuntimeLevel2"}},{type:"int",name:"level3 runtime",ref:{value:"RuntimeLevel3"}},{type:"int",name:"level",ref:{value:"Level",extMeta:"0-4"}},{type:"enum",name:"keyboard",
ref:{value:"Keyboard",options:["on","off"]}}]},hscd:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:"no safety current keyboard sw cpu checksum ram watchdog stop safetystop pos speed vars phase".split(" ")}},{type:"enum",name:"lock",ref:{value:"Lock",options:["on","off"]}},{type:"enum",name:"window down",ref:{value:"WindowDown",options:["true",
"false"]}},{type:"enum",name:"window closed",ref:{value:"WindowClosed",options:["true","false"]}},{type:"enum",name:"window state",ref:{value:"State",options:["open","closed"]}}]}};return{SYS:"hautau",getGatewayType:function(){return[{sys:this.SYS,name:"HAUTAU WLAN-Box",port:80}]},getGatewayDeviceType:function(){return[{sys:this.SYS,type:0,name:"Rauchmeldezentrale (RAZK)"},{sys:this.SYS,type:1,name:"Multisensor MS"},{sys:this.SYS,type:2,name:"Output Box 230V"},{sys:this.SYS,type:4,name:"LSF"},{sys:this.SYS,
type:5,name:"Fensterl\u00fcfter Ventra 301"},{sys:this.SYS,type:6,name:"Primat kompakt"},{sys:this.SYS,type:7,name:"Small Master"},{sys:this.SYS,type:8,name:"Fensterl\u00fcfter Monitor"},{sys:this.SYS,type:9,name:"Primat kompakt 195"},{sys:this.SYS,type:10,name:"RWA Taster"},{sys:this.SYS,type:11,name:"Rauchmelder"},{sys:this.SYS,type:100,name:"Wlan Box"},{sys:this.SYS,type:101,name:"SKA 20 comfort drive"},{sys:this.SYS,type:102,name:"SM2/EM2 comfort drive"},{sys:this.SYS,type:103,name:"Atrium HS comfort drive"},
{sys:this.SYS,type:104,name:"Lamelle"},{sys:this.SYS,type:106,name:"Neu Primat kompakt 195"},{sys:this.SYS,type:107,name:"SBS comfort drive"},{sys:this.SYS,type:108,name:"Primat kompakt SOBINCO"}]},createGateway:function(a,e,d){e=b.ERROR_CODE;a?a.ip?d(null,a):d(new b(e.INVALID,"ip is invalid")):d(new b(e.INVALID,"info is invalid"))},updateGateway:function(a,e,d,f){a=b.ERROR_CODE;e?e.ip?f(null,e):f(new b(a.INVALID,"ip is invalid")):f(new b(a.INVALID,"update is invalid"))},deleteGateway:function(a,
b,d){d()},createDevice:function(a,e,d){var c=b.ERROR_CODE;if(a)if(a.gateway)if(null==a.address||"undefined"==typeof a.address)d(new b(c.INVALID,"address is invalid"));else if(null==a.type||"undefined"==typeof a.type)d(new b(c.INVALID,"type is invalid"));else{e=e.data.gateways;var g;for(g=0;g<e.length;g++)if(e[g].index===a.gateway){var k=e[g];break}k?d(null,a):d(new b(c.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else d(new b(c.INVALID,"gateway is invalid"));else d(new b(c.INVALID,"info is invalid"))},
updateDevice:function(a,e,d){var c=b.ERROR_CODE;if(a)if(a.gateway)if(null==a.address||"undefined"==typeof a.address)d(new b(c.INVALID,"address is invalid"));else if(null==a.type||"undefined"==typeof a.type)d(new b(c.INVALID,"type is invalid"));else{e=e.data.gateways;var g;for(g=0;g<e.length;g++)if(e[g].index===a.gateway){var k=e[g];break}k?d(null,a):d(new b(c.NOT_FOUND,"gateway with index "+a.gateway+" not exists"))}else d(new b(c.INVALID,"gateway is invalid"));else d(new b(c.INVALID,"info is invalid"))},
deleteDevice:function(a,b,d){d()},applyUIFilter:function(a,b){var c=this,e=function(a,c,b){var d=[];a.forEach(function(a){if("root"==a.type){a=JSON.parse(JSON.stringify(a));var f=e(a.children,c,b);f&&0<f.length&&(a.children=f,d.push(a))}else{f=b.elems;if("*"==f)f=!0;else{for(var g=!1,h=0;h<f.length;h++)if(f[h]==a.type){g=!0;break}f=g}f&&(a=JSON.parse(JSON.stringify(a)),d.push(a))}});return d},g=function(a,b){var d=[],f=c.getCommandStatusMap(a);if(f){var g=[];switch(b.catagory){case "command":f.command&&
(g=e(f.command,a,b));break;case "status":f.status&&(g=e(f.status,a,b))}d=d.concat(g)}return d};if(!a.sys)return null;var k=JSON.parse(JSON.stringify(a)),h=null;switch(b.catagory){case "command":h=g(a,b);k.command=h;break;case "status":h=g(a,b);k.status=h;break;default:return null}return h&&0!=h.length?k:null},getCommandStatusMap:function(c){return c&&"undefined"!=typeof c.type&&null!=c.type?(c=xnm.aio.hautau.Gateway.DEVICETYPE_MAP[c.type])?a[c]:null:null}}}();
xnm.aio.hautau.Handler=function(){var b=function(){};b.prototype.Gateway=xnm.aio.hautau.Gateway;b.prototype.devicemanager=xnm.aio.hautau.DM;b.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"hautau")};b.prototype.resolveGateway=function(a){return a?this.Gateway.parseJSON(a):null};b.prototype.getDeviceCommands=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];c&&c(null,a)};b.prototype.getDeviceStatus=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,
{catagory:"status",elems:"*"}))?a.status:[];c&&c(null,a)};b.prototype.doCommand=function(a,c,b,d){(a=this.resolveGateway(a))?a.executeCommandCreator(c,b,function(a){d&&d(a)}):d&&d(Error("gateway json format invalid"))};b.prototype.doStatus=function(a,c,b,d,f){(c=this.resolveGateway(c))?c.getStatesCreator(null,[{id:a,device:b,status:d}],function(a,c){a?f&&f(a):f&&f(null,c[0])}):f&&f(Error("device json format invalid"))};b.prototype.getDeviceList=function(a,c,b){(a=this.resolveGateway(a))?a.listDevices(c,
function(a,c){b&&b(a,c)}):b&&b(Error("gateway json format invalid"))};return b}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.hautau.Handler);
