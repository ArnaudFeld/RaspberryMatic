var m=m||{};m.aio=m.aio||{};m.aio.importmanager=m.aio.importmanager||{};
m.aio.importmanager.Manager=function(){var h=function(){};h.prototype.importSteckerPRO=function(B,h,H,b){var I=function(b,k){var a={rooms:[],devices:[],gateways:[]};try{var c,f,e=$($.parseXML(k)),l=e.find("gateway");if(l&&0<l.length)for(c=0;c<l.length;c++){var n=l[c];if(n){var q=$(n).find("transmitter");if(q&&0<q.length&&q[0]){var p=$(q[0]),G=p.attr("ip"),r=p.attr("mode");G&&r&&(r=parseInt(r),a.gateways.push({index:a.gateways.length+1,name:("hc"==b?"HC":b)+" Gateway",info:{sys:"hcgw",ip:G,port:49880,
vendor:b,mode:1==r?1:0}}))}}}0==a.gateways.length&&a.gateways.push({index:a.gateways.length+1,name:("hc"==b?"HC":b)+" Gateway",info:{sys:"hcgw",ip:"0.0.0.0",port:49880,vendor:b,mode:1}});var w=e.find("location");if(w&&0<w.length)for(c=0;c<w.length;c++){var C=w[c];if(C){var D=$(C);if(f=D.attr("id")){var v={index:a.rooms.length+1,name:f};a.rooms.push(v);var t=D.find("device");if(t&&0<t.length)for(e=0;e<t.length;e++){var A=t[e];if(A){var x=$(A);f=x.attr("id");var y=x.attr("type"),z=x.attr("address"),
u=x.attr("data");if(f&&y&&z&&u){var g,d;switch(y){case "BS":g="brennenstuhl";d="RC 3600";"heater"==u&&(d="FHT 433");break;case "ELRO":g="brennenstuhl";d="RCS 1000N";break;case "DY":g="rohrmotor24";d="RMF Motor";break;case "DY2":g="rohrmotor24";d="RMF-RS1 (AP/UP)";break;case "IT":g="intertechno",9<=z.length?(d="IT-1500 ","shutter"==u?d="ITL-1000":"dimmer"==u&&(d="ITLR-300")):(d="CMR-300","shutter"==u&&(d="CMR-500"))}a.devices.push({index:a.devices.length+1,name:f,room:v.index,info:{sys:"hcgw",gateway:1,
data:u,type:"IT"==y&&9<=z.length?"IT2":y,manufacture:g,model:d,address:z}})}}}}}}}catch(h){console.error(h)}return a},J=function(b,k){var a={groups:[]};try{var c,f=$($.parseXML(b)).find("location");if(f&&0<f.length)for(c=0;c<f.length;c++){var e=f[c];if(e){var l=$(e),n=l.attr("id"),q;if(q=n)a:{for(var p=0;p<k.length;p++)if(k[p]===n){q=!0;break a}q=!1}if(q){var h={classid:"group",index:a.groups.length+1,name:n,macros:[]};a.groups.push(h);var r=l.find("macro");if(r&&0<r.length)for(p=0;p<r.length;p++){var w=
r[p];if(w){var C=$(w),D=C.attr("id");if(D){var v={classid:"macro",index:h.macros.length+1,name:D,commands:[]};h.macros.push(v);var t=C.find("command");if(t&&0<t.length)for(var A=0;A<t.length;A++){var x=t[A];if(x){var y=$(x),z=y.attr("action"),u=y.attr("sleep"),g;if(z){var d=z.split(".");3==d.length&&(g={classid:"command",index:v.commands.length+1,action:{type:"command",device:{name:d[1],room:d[0]},value:d[2]}},v.commands.push(g))}else u&&(g={classid:"sleep",index:v.commands.length+1,time:parseInt(u)},
v.commands.push(g))}}}}}}}}}catch(B){console.error(B)}return a},E=require("m.aio.configmanager.js"),F=E.LicenseManager;E.trace("/config/tenants/"+B,function(E,k){if(E)b&&b(E);else if(k&&k.license){var a;if(F.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"brennenstuhl"},k.license))a="brennenstuhl";else if(F.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"intertechno"},k.license))a="intertechno";else if(F.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"hc"},k.license))a="hc";
else{b&&b(Error("license do not have hcgw module"));return}a=I(a,h);var c=[];a&&a.rooms&&a.rooms.forEach(function(a){a&&a.name&&c.push(a.name)});var f=J(H,c),e=require("m.aio.devicemanager.js"),l=require("m.aio.macromanager.js");if(e=e.getIntHandler(B)){var n=l._getHandler(B);n?(e.data=a,e._save(function(a){a?b&&b(a):(n.macros=l.Macros.parse(f),n._saveMacros(function(a){b&&b(a)}))})):b&&b(Error("no such tenant for macros"))}else b&&b(Error("no such tenant"))}else b&&b("invalid tenant")})};return h}();
m.aio.importmanager.Handler=m.aio.importmanager.Manager;"undefined"!=typeof module&&null!=module&&(module.exports=new m.aio.importmanager.Handler);
