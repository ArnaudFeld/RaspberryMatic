var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var f=b.length,d=0;d<f;d++){var e=b[d];if(a.call(c,e,d,b))return{i:d,v:e}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){b=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,b];for(var a=0;a<b.length;++a){var c=b[a];if(c&&c.Math==Math)return c}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,a,c,f){if(a){c=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var d=b[f];d in c||(c[d]={});c=c[d]}b=b[b.length-1];f=c[b];a=a(f);a!=f&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");var m=m||{};m.aio=m.aio||{};m.aio.importmanager=m.aio.importmanager||{};
m.aio.importmanager.Manager=function(){var b=function(){};b.prototype.importSteckerPRO=function(a,c,f,d){var e=function(a,c){var d={rooms:[],devices:[],gateways:[]};try{var e,f,b=$($.parseXML(c)),l=b.find("gateway");if(l&&0<l.length)for(e=0;e<l.length;e++){var n=l[e];if(n){var g=$(n).find("transmitter");if(g&&0<g.length&&g[0]){var p=$(g[0]),k=p.attr("ip"),y=p.attr("mode");k&&y&&(y=parseInt(y),d.gateways.push({index:d.gateways.length+1,name:("hc"==a?"HC":a)+" Gateway",info:{sys:"hcgw",ip:k,port:49880,
vendor:a,mode:1==y?1:0}}))}}}0==d.gateways.length&&d.gateways.push({index:d.gateways.length+1,name:("hc"==a?"HC":a)+" Gateway",info:{sys:"hcgw",ip:"0.0.0.0",port:49880,vendor:a,mode:1}});var z=b.find("location");if(z&&0<z.length)for(e=0;e<z.length;e++){var E=z[e];if(E){var w=$(E);if(f=w.attr("id")){var A={index:d.rooms.length+1,name:f};d.rooms.push(A);var x=w.find("device");if(x&&0<x.length)for(a=0;a<x.length;a++){var F=x[a];if(F){var B=$(F);f=B.attr("id");var C=B.attr("type"),D=B.attr("address"),
t=B.attr("data");if(f&&C&&D&&t){switch(C){case "BS":var v="brennenstuhl";var r="RC 3600";"heater"==t&&(r="FHT 433");break;case "ELRO":v="brennenstuhl";r="RCS 1000N";break;case "DY":v="rohrmotor24";r="RMF Motor";break;case "DY2":v="rohrmotor24";r="RMF-RS1 (AP/UP)";break;case "IT":v="intertechno",9<=D.length?(r="IT-1500 ","shutter"==t?r="ITL-1000":"dimmer"==t&&(r="ITLR-300")):(r="CMR-300","shutter"==t&&(r="CMR-500"))}d.devices.push({index:d.devices.length+1,name:f,room:A.index,info:{sys:"hcgw",gateway:1,
data:t,type:"IT"==C&&9<=D.length?"IT2":C,manufacture:v,model:r,address:D}})}}}}}}}catch(H){console.error(H)}return d},n=function(a,c){var d={groups:[]};try{var e,f=$($.parseXML(a)).find("location");if(f&&0<f.length)for(e=0;e<f.length;e++){var b=f[e];if(b){var n=$(b),g=n.attr("id"),l;if(l=g)a:{for(a=0;a<c.length;a++)if(c[a]===g){l=!0;break a}l=!1}if(l){var p={classid:"group",index:d.groups.length+1,name:g,macros:[]};d.groups.push(p);var k=n.find("macro");if(k&&0<k.length)for(a=0;a<k.length;a++){var y=
k[a];if(y){var z=$(y),E=z.attr("id");if(E){var w={classid:"macro",index:p.macros.length+1,name:E,commands:[]};p.macros.push(w);var A=z.find("command");if(A&&0<A.length)for(var x=0;x<A.length;x++){var F=A[x];if(F){var B=$(F),C=B.attr("action"),D=B.attr("sleep");if(C){var t=C.split(".");if(3==t.length){var v={classid:"command",index:w.commands.length+1,action:{type:"command",device:{name:t[1],room:t[0]},value:t[2]}};w.commands.push(v)}}else D&&(v={classid:"sleep",index:w.commands.length+1,time:parseInt(D)},
w.commands.push(v))}}}}}}}}}catch(r){console.error(r)}return d},b=require("m.aio.configmanager.js"),p=b.LicenseManager;b.trace("/config/tenants/"+a,function(b,g){if(b)d&&d(b);else if(g&&g.license){if(p.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"brennenstuhl"},g.license))b="brennenstuhl";else if(p.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"intertechno"},g.license))b="intertechno";else if(p.permitFeature("read",{sys:"hcgw",ip:"127.0.0.1",vendor:"hc"},g.license))b="hc";else{d&&
d(Error("license do not have hcgw module"));return}b=e(b,c);var k=[];b&&b.rooms&&b.rooms.forEach(function(a){a&&a.name&&k.push(a.name)});var l=n(f,k);g=require("m.aio.devicemanager.js");var q=require("m.aio.macromanager.js");if(g=g.getIntHandler(a)){var u=q._getHandler(a);u?(g.data=b,g._save(function(a){a?d&&d(a):(u.macros=q.Macros.parse(l),u._saveMacros(function(a){d&&d(a)}))})):d&&d(Error("no such tenant for macros"))}else d&&d(Error("no such tenant"))}else d&&d("invalid tenant")})};b.prototype.getConfigList_IQP=
function(a,c,b,d){a+="/iqconfig/getconfigs";var e=require("url").parse(a);a=e.protocol;"http:"==a&&(a="http");"https:"==a&&(a="https");a||(a="https");var f=e.port;f||(f=443);c={host:e.hostname,port:f,path:e.path+"?app=iqontrolpro",auth:c+":"+b};c=require(a).request(c,function(a){a.setEncoding("utf8");var c="";a.on("data",function(a){c+=a});a.on("end",function(){if(200!=a.statusCode)d&&(d(Error("http reponse code:"+a.statusCode)),d=null);else try{var e=[];c&&(e=JSON.parse(c));d&&(d(null,e),d=null)}catch(g){d&&
(d(Error("invalid json reponse")),d=null)}})});c.on("timeout",function(){d&&(d(Error("http timeout")),d=null)});c.on("error",function(a){d&&(d(a),d=null)});c.end()};b.prototype.downloadConfig_IQP=function(a,c,b,d,e){a+="/iqconfig/getdevices";var f=require("url").parse(a);a=f.protocol;"http:"==a&&(a="http");"https:"==a&&(a="https");a||(a="https");var k=f.port;k||(k=443);c={host:f.hostname,port:k,path:f.path+"?app=iqontrolpro&name="+encodeURIComponent(d),auth:c+":"+b};c=require(a).request(c,function(a){a.setEncoding("utf8");
var c="";a.on("data",function(a){c+=a});a.on("end",function(){200!=a.statusCode?e&&(e(Error("http reponse code:"+a.statusCode)),e=null):e&&(e(null,c),e=null)})});c.on("timeout",function(){e&&(e(Error("http timeout")),e=null)});c.on("error",function(a){e&&(e(a),e=null)});c.end()};b.prototype.decryptConfig_IQP=function(a,c,b){a=require("x.crypt.js").AES.decodeString(a,c);if("string"==typeof a&&0<a.length){c=null;try{c=JSON.parse(a),b&&b(null,c)}catch(d){b&&b(Error("invalid config json"))}}else b&&b(Error("decryption failed"))};
b.prototype.importConfig_IQP=function(a,c,b,d,e){require("m.aio.configmanager.js").trace("/config/tenants/"+a,function(f,k){if(f)e&&e(f);else if(k&&k.license){f=c;c.system&&(f=c.system);var p=require("m.aio.devicemanager.js"),l=p.getIntHandler(a);if(l){var g=-1,h=[];if(f.rooms)for(var n=0;n<f.rooms.length;n++){var q=f.rooms[n];if(q)if("_cameras_288c9304ed854ca5f41185e88b240621"==q.name){g=q.index;break}else h.push(q.index)}else f.rooms=[];if(-1==g){for(g=1;-1!=h.indexOf(g);)g++;f.rooms.push({name:"_cameras_288c9304ed854ca5f41185e88b240621",
index:g})}if(f.devices)for(h=0;h<f.devices.length;h++){if(n=f.devices[h])n.info&&"cloudservice"==n.info.sys&&"ivideon"==n.info.module&&"camera"==n.info.type?n.room=g:n.info&&"cam"==n.info.sys&&(n.room=g)}else f.devices=[];if(f.gateways)for(g=0;g<f.gateways.length;g++){if(h=f.gateways[g])h.info&&"cloudservice"==h.info.sys&&(h.info.ip||(h.info.ip="cloud.mediola.com"),h.info.port||(h.info.port=443),h.info.username||h.info.password||(h.info.username=b,h.info.password=d)),h.info&&"aio"==h.info.sys&&"gtw"==
h.info.common_type&&(f.gateways.splice(g,1),g--)}else f.gateways=[];l.data=f;l._save(function(a){a?e&&e(a):p.reloadTenant(k,function(a){e&&e(a)})})}else e&&e(Error("no such tenant"))}else e&&e("invalid tenant")})};b.prototype.downloadMacros_IQP=function(a,c,f,b,e){a+="/iqconfig/getmacros";var d=require("url").parse(a);a=d.protocol;"http:"==a&&(a="http");"https:"==a&&(a="https");a||(a="https");var k=d.port;k||(k=443);c={host:d.hostname,port:k,path:d.path+"?app=iqontrolpro&name="+encodeURIComponent(b),
auth:c+":"+f};c=require(a).request(c,function(a){a.setEncoding("utf8");var c="";a.on("data",function(a){c+=a});a.on("end",function(){200!=a.statusCode?e&&(e(Error("http reponse code:"+a.statusCode)),e=null):e&&(e(null,c),e=null)})});c.on("timeout",function(){e&&(e(Error("http timeout")),e=null)});c.on("error",function(a){e&&(e(a),e=null)});c.end()};b.prototype.decryptMacros_IQP=function(a,c,b){a=require("x.crypt.js").AES.decodeString(a,c);if(0<a.length&&"string"==typeof a){c=null;try{c=JSON.parse(a),
b&&b(null,c)}catch(d){b&&b(Error("invalid macros json"))}}else b&&b(Error("decryption failed"))};b.prototype.importMacros_IQP=function(a,b,f){require("m.aio.configmanager.js").trace("/config/tenants/"+a,function(c,e){if(c)f&&f(c);else if(e&&e.license){c=require("m.aio.macromanager.js");var d=c._getHandler(a);if(d){var k=require("m.aio.devicemanager.js").getIntHandler(a);if(k){if(b&&b.groups)for(var p=0;p<b.groups.length;p++){var l=b.groups[p];if(l&&l.macros)for(var g=0;g<l.macros.length;g++){var h=
l.macros[g];if(h&&h.commands)for(var G=0;G<h.commands.length;G++){var q=h.commands[G];if(q&&q.action&&q.action.device){var u=q.action.device.room;u&&!isNaN(parseInt(u))&&(u=k.findRoomWithIndex(parseInt(u)))&&u.name&&(q.action.device.room=u.name)}}}}d.macros=c.Macros.parse(b);d._saveMacros(function(a){a?f&&f(a):require("m.aio.devicemanager.js").reloadTenant(e,function(a){f&&f(a)})})}else f&&f(Error("no device manager"))}else f&&f(Error("no such tenant"))}else f&&f("invalid tenant")})};return b}();
m.aio.importmanager.Handler=m.aio.importmanager.Manager;"undefined"!=typeof module&&null!=module&&(module.exports=new m.aio.importmanager.Handler);
