var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(h,e,n){h instanceof String&&(h=String(h));for(var g=h.length,k=0;k<g;k++){var l=h[k];if(e.call(n,l,k,h))return{i:k,v:l}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(h,e,n){h!=Array.prototype&&h!=Object.prototype&&(h[e]=n.value)};
$jscomp.getGlobal=function(h){return"undefined"!=typeof window&&window===h?h:"undefined"!=typeof global&&null!=global?global:h};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(h,e,n,g){if(e){n=$jscomp.global;h=h.split(".");for(g=0;g<h.length-1;g++){var k=h[g];k in n||(n[k]={});n=n[k]}h=h[h.length-1];g=n[h];e=e(g);e!=g&&null!=e&&$jscomp.defineProperty(n,h,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("Array.prototype.find",function(h){return h?h:function(e,h){return $jscomp.findInternal(this,e,h).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var h=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+h++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var h=$jscomp.global.Symbol.iterator;h||(h=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[h]&&$jscomp.defineProperty(Array.prototype,h,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(h){var e=0;return $jscomp.iteratorPrototype(function(){return e<h.length?{done:!1,value:h[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(h){$jscomp.initSymbolIterator();h={next:h};h[$jscomp.global.Symbol.iterator]=function(){return this};return h};$jscomp.iteratorFromArray=function(h,e){$jscomp.initSymbolIterator();h instanceof String&&(h+="");var n=0,g={next:function(){if(n<h.length){var k=n++;return{value:e(k,h[k]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill("Array.prototype.keys",function(h){return h?h:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6","es3");var util=require("util"),EventEmitter=require("events"),async=require("async"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.hm=x.hub.m.hm||{};x.hub.m.hm.CCU_INIT_STATE=!0;x.hub.m.hm.HM_MODULE=require("xnm.aio.hm.js");
x.hub.m.hm.RFDeviceTypes={"HM-PB-4Dis-WM":0,"ZEL STG RM DWT 10":0,"263 155":0,"HM-PB-4Dis-WM-2":0,ASH550I:1,ASH550:1,"HM-WDS10-TH-O":1,"263 158":1,"HM-WDS20-TH-O":1,"HM-WDS40-TH-I":1,"263 157":1,"IS-WDS-TH-OD-S-R3":1,"HM-WDS40-TH-I-2":1,"HM-LC-Bl1-SM":2,"HM-LC-Bl1-FM":2,"HM-LC-Bl1-PB-FM":2,"ZEL STG RM FEP 230V":2,"263 146":2,"HM-LC-BlX":2,"HM-LC-Bl1-SM-2":2,"HM-LC-Bl1-FM-2":2,"HM-LC-Bl1PBU-FM":2,"263 147":2,"HM-CC-RT-DN":3,"HM-CC-RT-DN-BoM":4,"HM-CC-TC":5,"ZEL STG RM FWT":5,"HM-CC-VD":6,"ZEL STG RM FSA":6,
CENTRAL:7,"HM-RCV-50":7,"HM-OU-CF-Pl":8,"HM-OU-CFM-Pl":9,"HM-OU-CFM-TW":9,"HM-OU-CM-PCB":10,"HM-LC-AO-SM":11,"HM-LC-Dim1L-Pl":11,"HM-LC-Dim1L-Pl-2":11,"HM-LC-Dim1L-CV":11,"263 132":11,"HM-LC-Dim2L-CV":11,"HM-LC-Dim2L-SM":11,"HSS-DX":11,"HM-LC-Dim1L-Pl-3":11,"HM-LC-Dim1L-CV-2":11,"HM-LC-Dim2L-SM-2":11,"HM-LC-Dim1PWM-CV":12,"HM-LC-Dim1PWM-CV-2":12,"HM-LC-Dim1TPBU-FM":13,"HM-LC-Dim1TPBU-FM-2":13,"263 133":13,"HM-LC-Dim1T-Pl":13,"HM-LC-Dim1T-CV":13,"HM-LC-Dim1T-FM":13,"HM-LC-Dim1T-Pl-3":13,"HM-LC-Dim1T-CV-2":13,
"HM-LC-Dim1T-FM-2":13,"HM-LC-Dim2T-SM":13,"HM-LC-Dim2T-SM-2":13,"HM-LC-Dim1T-Pl-2":13,"263 134":13,"HM-LC-Dim1T-DR":13,"HM-LC-Dim1T-FM-LF":13,"OLIGO.smart.iq.HM":11,"HM-Dis-WM55":14,"HM-MOD-EM-8":15,"HM-ES-PMSw1-Pl":16,"HM-ES-PMSw1-Pl-DN-R1":16,"HM-ES-PMSw1-Pl-DN-R2":16,"HM-ES-PMSw1-Pl-DN-R3":16,"HM-ES-PMSw1-Pl-DN-R4":16,"HM-ES-PMSw1-Pl-DN-R5":16,"HM-ES-PMSw1-DR":16,"HM-ES-PMSw1-SM":16,"HM-Dis-TD-T":17,"HM-Sec-Key":18,"HM-Sec-Key-S":18,"HM-Sec-Key-O":18,"HM-Sec-Key-Generic":18,KS550:19,KS888:19,KS550Tech:19,
KS550LC:19,"HM-WDS100-C6-O":19,"HM-WDS100-C6-O-2":19,"HM-OU-LED16":20,"HM-OU-X":20,"HM-PB-2-WM55-2":21,"HM-PB-2-WM55":21,"ZEL STG RM WT 2":21,"263 135":21,"HM-PB-2-FM":21,"HM-PBI-4-FM":21,"ZEL STG RM FST UP4":21,"263 145":21,"HM-PBI-X":21,"HM-RC-4-2":21,"HM-PB-6-WM55":21,"HM-RC-8":21,"HM-RC-4":21,"HM-RC-4-3":21,"HM-RC-4-B":21,"HM-RC-P1":21,"HM-RC-Sec3":21,"HM-RC-Sec3-B":21,"HM-RC-Key3":21,"HM-RC-Key3-B":21,"HM-PB-4-WM":21,"HM-PB-2-WM":21,"HM-RC-2-PBU-FM":21,"RC-H":21,atent:21,"ZEL STG RM HS 4":21,
"HM-RC-X":21,"BRC-H":21,"HM-RC-SB-X":21,"HM-RC-12":21,"HM-RC-12-B":21,"HM-RC-12-SW":21,"HM-RC-Key4-2":22,"HM-RC-Sec4-2":22,"HM-RC-Key4-3":22,"HM-RC-Sec4-3":22,"HM-RC-19":23,"HM-RC-19-B":23,"HM-RC-19-SW":23,"HM-Sen-RD-O":24,"HM-Sec-RHS":25,"HM-Sec-RHS-2":25,"ZEL STG RM FDK":25,"HM-Sec-xx":25,"HM-LC-Sw1-Pl":26,"HM-LC-Sw1-Pl-2":26,"HM-LC-Sw1-SM":26,"HM-LC-Sw2-SM":26,"HM-LC-Sw4-SM":26,"HM-LC-Sw4-PCB":26,"HM-LC-Sw4-WM":26,"HM-LC-Sw1-FM":26,"263 130":26,"HM-LC-Sw2-FM":26,"HM-LC-Sw1-PB-FM":26,"HM-LC-Sw2-PB-FM":26,
"HM-LC-Sw4-DR":26,"HM-LC-Sw2-DR":26,"ZEL STG RM FZS":26,"ZEL STG RM FZS-2":26,"HM-LC-Sw1PBU-FM":26,"HM-LC-Sw2PBU-FM":26,"263 131":26,"HM-MOD-Re-8":26,"HM-LC-Sw1-Ba-PCB":26,"HM-LC-Sw4-Ba-PCB":26,"HM-LC-Sw1-Pl-3":26,"HM-LC-Sw1-SM-2":26,"HM-LC-Sw4-SM-2":26,"HM-LC-Sw4-PCB-2":26,"HM-LC-Sw4-WM-2":26,"HM-LC-Sw1-FM-2":26,"HM-LC-Sw2-FM-2":26,"HM-LC-Sw4-DR-2":26,"HM-LC-Sw2-DR-2":26,"HM-LC-Sw1-Pl-DN-R1":26,"HM-LC-Sw1-Pl-DN-R2":26,"HM-LC-Sw1-Pl-DN-R3":26,"HM-LC-Sw1-Pl-DN-R4":26,"HM-LC-Sw1-Pl-DN-R5":26,"HM-LC-Sw1-DR":26,
"HM-LC-Sw1-Pl-CT-R1":26,"HM-LC-Sw1-Pl-CT-R2":26,"HM-LC-Sw1-Pl-CT-R3":26,"HM-LC-Sw1-Pl-CT-R4":26,"HM-LC-Sw1-Pl-CT-R5":26,"HM-LC-Sw1-PCB":26,"HM-LC-Sw1-Pl-OM54":26,"HM-LC-Sw1-SM-ATmega168":26,"HM-LC-Sw4-SM-ATmega168":26,S550IA:27,"HM-WDS30-T-O":27,"HM-Sec-SC":28,"ZEL STG RM FFK":28,"HM-Sec-SC-2":28,"HM-SCI-3-FM":29,"HM-CC-SCD":30,"263 160":30,"HM-Sec-MDIR-3":31,"HM-Sec-MDIR-2":31,"HM-Sec-MDIR":31,"263 162":31,"HM-Sec-MD":31,"HM-Sec-SD":32,"HM-Sec-SD-Generic":32,"HM-Sec-SD-2":32,"HM-Sec-SD-2-Generic":32,
"HM-Sec-SFA-SM":33,"HM-Sen-MDIR-SM":34,"HM-Sen-MDIR-O":34,"HM-MD":34,"HM-Sen-MDIR-O-2":34,"HM-Sen-MDIR-O-3":34,"HM-Sen-EP":35,"HM-Sen-X":35,"HM-Sen-Wa-Od":36,"HM-SwI-3-FM":37,"ZEL STG RM FSS UP3":37,"263 144":37,"HM-SwI-X":37,"HM-TC-IT-WM-W-EU":38,"HM-Sec-TiS":39,"HM-WDS30-OT2-SM":40,"HM-WDS30-OT2-SM-2":40,"HM-Sec-WDS":41,"HM-Sec-WDS-2":41,"HM-Sec-Win":42,"HM-Sec-Win-Generic":42,WS550:43,WS888:43,WS550Tech:43,WS550LCB:43,WS550LCW:43,"HM-WDC7000":43,"HMW-IO-12-Sw14-DR":44,"HMW-IO-12-Sw7-DR":45,"HMW-IO-12-FM":46,
"HMW-IO-4-FM":46,"HMW-LC-Bl1-DR":47,"HMW-LC-Dim1L-DR":48,"HMW-LC-Sw2-DR":49,"HMW-Sen-SC-12-DR":50,"HMW-Sen-SC-12-FM":50,"HM-CC-VG-1":51,"HM-ES-TX-WM":52,"HM-LC-RGBW-WM":53,"HM-Sec-SD-2-Team":54,"HM-Sen-LI-O":56,"HM-Sec-SCo":28,"HM-Sec-Sir-WM":57,"HM-LC-Ja1PBU-FM":58,"HM-MOD-EM-8Bit":59,"HM-Dis-EP-WM55":60,"HM-Sen-MDIR-WM55":61,"HM-LC-DW-WM":62};
x.hub.m.hm.RFDeviceCatagory=[{type:"button",channelNum:"*",channel:"KEY"},{type:"weather"},{type:"blind",channelNum:"*",channel:"BLIND"},{type:"heater2"},{type:"heater3"},{type:"wallthermo"},{type:"heater"},{type:"vbutton",channelNum:"*",channel:"VIRTUAL_KEY"},{type:"gong2"},{type:"gong"},{type:"gong"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"button",channelNum:"*",channel:"KEY"},{type:"mod_em_8",
channelNum:"*",channel:"KEY"},{type:"powerswitch"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"keymatic"},{type:"weatherstation"},{type:"ou_led16",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"rain"},{type:"window"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"temp"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"contact",channelNum:"*",
channel:"SHUTTER_CONTACT"},{type:"co2"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{type:"smoke"},{type:"siren",channelNum:"*",channel:"ALARMACTUATOR"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{},{type:"capacity"},{type:"switch_interface",channelNum:"*",channel:"SWITCH_INTERFACE"},{type:"wallthermo2"},{type:"tilt",channelNum:"*",channel:"TILT_SENSOR"},{type:"temp2",channel:"WEATHER"},{type:"water",channelNum:"*",channel:"WATERDETECTIONSENSOR"},{},{type:"weather2"},{},
{},{},{},{},{},{},{},{type:"energymeter"},{type:"rgb"},{},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"lux"},{type:"siren2"},{type:"jalousie",channelNum:"*",channel:"JALOUSIE"},{type:"mod_em_8bit"},{type:"button",channelNum:"*",channel:"KEY"},{},{type:"dualwhite"}];
x.hub.m.hm.IPDeviceTypes={"HMIP-PS":0,"HmIP-PCBS":0,"HmIP-PCBS-BAT":0,"HMIP-SWDO":1,"HmIP-SWDO-I":1,"HmIP-SWDM":1,"HmIP-SWDM-B2":1,"Contact AA":1,"HMIP-WTH":2,"HmIP-WTH-2":2,"HmIP-STH":2,"HmIP-STHD":2,"HMIP-eTRV":3,"HMIP-eTRV-2":3,"HmIP-eTRV-2-UK":3,"HmIP-eTRV-B":3,"HmIP-eTRV-B1":3,"HmIP-eTRV-B-UK":3,"HmIP-eTRV-C":3,"HMIP-WRC2":4,"HmIP-SMI":5,"HmIP-SMO":5,"HmIP-SMO-A":5,"HmIP-SRH":6,"HmIP-SWSD":7,"HmIP-PSM":8,"Smart Plug AA":8,"HmIP-PSM-PE":8,"HmIP-PSM-UK":8,"HmIP-PSM-IT":8,"HmIP-PSM-CH":8,"HmIP-BSM":9,
"HmIP-BDT":10,"HmIP-ASIR":11,"HmIP-KRC4":12,"HmIP-KRCA":12,"HmIP-PDT":13,"HmIP-PDT-UK":13,"HmIP-FSM":14,"HmIP-FSM16":14,"HmIP-BROLL":15,"HmIP-FROLL":15,"HmIP-FBL":16,"HmIP-BBL":16,"HmIP-SPI":17,"HmIP-FDT":18,"HmIP-BWTH":19,"HmIP-BWTH24":19,"HmIP-FAL230-C6":20,"HmIP-FAL24-C6":20,"HmIP-FAL230-C10":20,"HmIP-FAL24-C10":20,"HmIP-WRC6":21,"HmIP-SWO-B":22,"HmIP-SWO-PL":23,"HmIP-SWO-PR":27,"HmIP-STHO":24,"HmIP-STHO-A":24,"HmIP-SPDR":25,"HmIP-SMI55":26,"HmIP-RC8":28,"HmIP-MIOB":0,"HmIP-SWD":31,"HmIP-SAM":32,
"HmIP-WGC":33,"HmIP-BSL":34,"HmIP-MOD-TM":35,"HmIP-DBB":36,"HmIP-FCI1":37,"HmIP-FCI6":37,"HmIP-SLO":38,"HmIP-BRC2":4,"HmIP-PMFS":39,"HmIP-MOD-RC8":37,"HmIP-MOD-OC8":1};
x.hub.m.hm.IPDeviceCatagory=[{type:"ip_switch"},{type:"ip_contact"},{type:"ip_wallthermo"},{type:"ip_heater"},{type:"ip_button2"},{type:"ip_motion"},{type:"ip_window"},{type:"ip_smoke"},{type:"ip_powerswitch"},{type:"ip_energyactor"},{type:"ip_dimmer"},{type:"ip_siren"},{type:"ip_button4"},{type:"ip_dimmer2"},{type:"ip_energyactor2"},{type:"ip_blind"},{type:"ip_jalousie"},{type:"ip_presence"},{type:"ip_dimmer3"},{type:"ip_wallthermo2"},{type:"ip_floor_heater"},{type:"ip_button6"},{type:"ip_weather"},
{type:"ip_weather2"},{type:"ip_weather3"},{type:"ip_direction"},{type:"ip_motion2"},{type:"ip_weather4"},{type:"ip_button8"},{type:"ip_generic_input"},{type:"ip_analog_output"},{type:"ip_water"},{type:"ip_acce"},{type:"ip_garagedoor"},{type:"ip_bsl"},{type:"ip_tormatic"},{type:"ip_button"},{type:"ip_multi_input_bat"},{type:"ip_lux"},{type:"ip_pmfs"}];
x.hub.m.hm.Util={clearHttpOptionForLog:function(h){try{var e=JSON.parse(JSON.stringify(h));e.auth&&(e.auth="xxxxxx:xxxxxx");if(e.headers)for(var n in headers)if(n&&"authorization"==n.toLocaleLowerCase()){var g=headers[n];if(g){var k=g.indexOf(" ");headers[n]=-1==k?"xxxxxx":g.substr(0,k)+" xxxxxx"}}return e}catch(l){return h}}};
x.hub.m.hm.Client=function(){var h=function(e,h,g,k,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Client");this.ip=e;this.port=h;this.port||(this.port=2001);this.username=g;this.password=k;this.useHttps=l;this.timeout=2E4;this.xml2js=null};h.prototype._doRequest=function(e,h,g){var k=require("http");this.useHttps&&(k=require("https"));e={host:this.ip,port:this.port,path:"/",method:e,headers:{"User-Agent":"mediola",Connection:"keep-alive"}};this.username&&(e.auth=this.username+":"+(this.password?
this.password:""));h&&(e.headers["Content-Length"]=h.length);var l=g,n=this;this._logger.log("trace","send http request:"+x.hub.m.hm.Util.clearHttpOptionForLog(e));this._logger.log("trace","send http data:"+h);g=k.request(e,function(k){var g="";k.setEncoding("utf-8");k.on("data",function(k){g+=k});k.on("end",function(){n._logger.log("trace","http response status:"+k.statusCode);n._logger.log("trace","http response data:"+g);var m=null;200!=k.statusCode&&(m=Error("http response "+k.statusCode));l&&
l(m,g,k.statusCode)})});g.on("error",function(k){n._logger.log("trace","http request error:"+k.stack);l&&l(k);l=null});g.setTimeout(this.timeout,function(){n._logger.log("trace","http request timeout");l&&l(Error("http timeout"));l=null});h&&g.write(h);g.end()};h.prototype._doXMLRpcRequest=function(e,h,g){var k=require("x.xmlrpc.js");e='<?xml version="1.0" encoding="ISO-8859-1"?><methodCall><methodName>'+e+"</methodName><params>";for(var l=0;l<h.length;l++)e=h[l]&&h[l].type&&void 0!=h[l].value?e+
("<param>"+k.serializeValue(h[l].value,h[l].type)+"</param>"):e+("<param>"+k.serializeValue(h[l])+"</param>");this._doRequest("POST",e+"</params></methodCall>",function(l,m){if(l)g&&g(l);else if(m)try{var e=k.deserializeRsp(m);e.error?g&&g(Error("xml rcp return error:"+e.error.faultString+" @code:"+e.error.faultCode),e.error):g&&g(null,e.params)}catch(p){g&&g(p)}else g&&g(Error("xml rcp response format invalid"))})};h.prototype.convertHmIPKeyBase32ToBase16=function(e){e=e.replace(/-/g,"").toUpperCase();
var h="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),g=new ArrayBuffer(16);g=new Uint8Array(g);for(var k=0,l=e.length-1,q=0,m=g.length-1,r="";0<=l;){for(var p=0;p<h.length;p++)if(h[p]==e.charAt(l)){k|=p<<q;break}q+=5;for(l--;8<q&&0<=m;)g[m]=k&255,k>>=8,q-=8,m--}for(p=0;p<g.length;p++)16>g[p]&&(r+="0"),r+=g[p].toString(16);return r.toUpperCase()};h.prototype._getValue=function(e){var h=null;if(this.xml2js)if(e["boolean"]&&e["boolean"][0])h=parseInt(e["boolean"][0])?!0:!1;else if(e.i4&&e.i4[0])h=parseInt(e.i4[0]);
else if(e.double&&e.double[0])h=parseFloat(e.double[0]);else if(e.array&&e.array[0]&&e.array[0].data&&e.array[0].data[0]&&e.array[0].data[0].value){h=[];e=e.array[0].data[0].value;for(var g in e)h.push(e[g])}else h=e;else if(g=e,e=e.find("value"),0<e.length&&(g=$(e[0])),g&&(h=g.text(),!h&&g.children()&&0<g.children().length))if(e=$(g.children()[0]),"boolean"==e.prop("tagName"))h=parseInt(e.text())?!0:!1;else if("i4"==e.prop("tagName"))h=parseInt(e.text());else if("double"==e.prop("tagName"))h=parseFloat(e.text());
else if("array"==e.prop("tagName"))for(h=[],e=e.find("data value"),g=0;g<e.length;g++){var k=$(e[g]).text();k&&h.push(k)}else XC.debugf("unknown valuetype:"),XC.debugf(e.getXMLString());return h};h.prototype._getStructData=function(e){var h={};if(e.struct&&e.struct[0]&&e.struct[0].member){e=e.struct[0].member;for(var g in e)e[g].name&&e[g].name[0]&&e[g].value&&e[g].value[0]&&(h[e[g].name[0]]=this._getValue(e[g].value[0]))}return h};h.prototype._waitForNewDevices=function(e,h,g){var k=this;this.getDeviceList(function(l){if(0>=
h||Object.keys(l).length>Object.keys(e).length){for(var n in l)e[n]||XC.debugf("new device: "+n);g&&g(l)}else setTimeout(function(){k._waitForNewDevices(e,h-4,g)},4E3)})};h.prototype.init=function(e,h,g){this._doXMLRpcRequest("init",[e,h],function(k){g&&g(k)})};h.prototype.getIP=function(){return this.ip};h.prototype.getPort=function(){return this.port};h.prototype.setPort=function(e){this.port=e};h.prototype.getValue=function(e,h,g,k){e=[e,h];"undefined"!=typeof g&&null!=g&&e.push(g);this._doXMLRpcRequest("getValue",
e,function(g,e){var l=null;!g&&e?l=e[0]:g&&e&&(l=e);k&&k(g,l)})};h.prototype.setValue=function(e,h,g,k){this._doXMLRpcRequest("setValue",[e,h,g],function(g){k&&k(g)})};h.prototype.getParamset=function(e,h,g,k){this._doXMLRpcRequest("getParamset",[e,h,g],function(g,e){var l=null;!g&&e?l=e[0]:g&&e&&(l=e);k&&k(g,l)})};h.prototype.putParamset=function(e,h,g,k){this._doXMLRpcRequest("putParamset",[e,h,g],function(g,e){var l=null;!g&&e?l=e[0]:g&&e&&(l=e);k&&k(g,l)})};h.prototype.listDevices=function(e){this._doXMLRpcRequest("listDevices",
[],function(h,g){var k=[];!h&&g&&(k=g[0]);e&&e(h,k)})};h.prototype.deleteDevice=function(e,h,g){this._doXMLRpcRequest("deleteDevice",[e,h],function(k){g&&g(k)})};h.prototype.setInstallMode=function(e,h,g,k){var l=[];l.push(e);"undefined"!=typeof h&&null!=h&&l.push(h);"undefined"!=typeof g&&null!=g&&l.push(g);this._doXMLRpcRequest("setInstallMode",l,function(g){k&&k(g)})};h.prototype.setInstallModeWithWhitelist=function(e,h,g,k){var l=[];l.push(e);"undefined"!=typeof h&&null!=h&&l.push(h);"undefined"!=
typeof g&&null!=g&&l.push(g);this._doXMLRpcRequest("setInstallModeWithWhitelist",l,function(g){k&&k(g)})};h.prototype.addNewDevice=function(e){var h=this;this.getDeviceList(function(g){h._doRequest("setInstallMode",[!0,30,2],function(k){setTimeout(function(){h._waitForNewDevices(g,30,e)},4E3)})})};h.prototype.addNewDeviceWithSGTN=function(e,h,g){var k=this;this.getDeviceList(function(l){k._doRequest("setInstallModeWithWhitelist",[!0,30,[{ADDRESS:h,KEY_MODE:"LOCAL",KEY:g}]],function(g){setTimeout(function(){k._waitForNewDevices(l,
30,e)},4E3)})})};h.prototype.listBidcosInterfaces=function(e){this._doXMLRpcRequest("listBidcosInterfaces",[],function(h,g){var k=[];!h&&g&&(k=g[0]);e&&e(h,k)})};h.prototype.reportValueUsage=function(e,h,g,k){this._doXMLRpcRequest("reportValueUsage",[e,h,g],function(g,e){var l;!g&&e&&(l=e[0]);k&&k(g,l)})};h.prototype.ping=function(e,h){this._doXMLRpcRequest("ping",[e],function(g){h&&h(g)})};return h}();
x.hub.m.hm.Server=function(){var h=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Server");this._port=9099;e&&0<e&&(this._port=e);this._server=null;this._servlet={}};h.prototype.getPort=function(){return this._port};h.prototype.stop=function(e){this._server?this._server.close():e&&e()};h.prototype.start=function(e){if(this._server)e&&e();else{var h=e,g=this,k=require("http").createServer(function(k,e){g._logger.log("trace","receive request method:"+k.method);g._logger.log("trace",
"receive request path:"+k.url);g._logger.log("trace","receive request header:"+JSON.stringify(k.headers));var l="";k.on("data",function(k){l+=k.toString()});k.on("end",function(){g._logger.log("trace","receive request body:"+l);"POST"==k.method?g._handleRequest(l,k,e):(g._logger.log("trace","send 404 response"),e.writeHead(404,"Not found"),e.end())})});k.on("error",function(k){g._logger.log("trace","xmlrpc server err:"+k.stack);h&&h(k);h=null;g._server=null});k.listen(this._port,function(){g._logger.log("trace",
"xmlrpc server listening on port:"+g._port);g._server=k;h&&h();h=null})}};h.prototype.registServlet=function(e,h){e&&h&&(this._servlet[e]=h)};h.prototype.unregistServlet=function(e){e&&delete this._servlet[e]};h.prototype._handleRequest=function(e,h,g){var k=h.url,l=require("x.xmlrpc.js"),n=this;try{var m=l.deserializeReq(e);if("system.multicall"==m.methodName)this._handleMultiCall(m.params[0],h,g);else if(this._logger.log("debug","receive method call:"+m.methodName),this._logger.log("debug","params:"+
JSON.stringify(m.params)),"system.listMethods"==m.methodName)this._sendSuccessResponse(["event listDevices newDevices deleteDevices updateDevice replaceDevice readdedDevice".split(" ")],g);else if(this._servlet[k])this._servlet[k](m.methodName,m.params,function(k,l){k?n._sendErrorResponse(k,g):n._sendSuccessResponse([l],g)});else this._sendSuccessResponse([[]],g)}catch(r){this._sendErrorResponse(r,g)}};h.prototype._handleMultiCall=function(e,h,g){h=h.url;this._logger.log("trace","---------------------------------");
this._logger.log("trace","receive system.multicall");for(var k=0;k<e.length;k++){var l=e[k];this._logger.log("trace","receive method call:"+l.methodName);this._logger.log("trace","params:"+JSON.stringify(l.params));if(this._servlet[h])this._servlet[h](l.methodName,l.params)}this._logger.log("trace","---------------------------------");this._sendSuccessResponse([[]],g)};h.prototype._sendSuccessResponse=function(e,h){e=require("x.xmlrpc.js").serializeRsp(null,e);this._logger.log("trace","send xml success response:"+
e);h.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(e)+""});h.write(e);h.end()};h.prototype._sendErrorResponse=function(e,h){var g=require("x.xmlrpc.js"),k=-1;e.errCode&&(k=e.errCode);e=g.serializeRsp({faultCode:k,faultString:e.message});this._logger.log("trace","send xml fault response:"+e);h.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(e)+""});h.write(e);h.end()};return h}();
x.hub.m.hm._Controller=function(){var h=function(k,g,e,m,h,n){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller");this._client=new x.hub.m.hm.Client(k,g,e,m,h);this._initStates=n;this.interface=null;this._devices={};this._status={};this._learnDeviceCbs=[];this._learnDeviceTO=null;this._readValueCbs={}};util.inherits(h,EventEmitter);h.prototype.getIP=function(){return this._client.getIP()};h.prototype.getPort=function(){return this._client.getPort()};h.prototype.setPort=function(k){return this._client.setPort(k)};
h.prototype.getAllBufferedStates=function(){var k={},g;for(g in this._devices){var e=this._devices[g];!e.PARENT&&e.CHILDREN?k[g]={device:{type:e.TYPE,"interface":this.interface,address:e.ADDRESS,channels:{}},states:{}}:e.PARENT&&(k[e.PARENT].device.channels[e.ADDRESS]={type:e.TYPE,address:e.ADDRESS});if(e.CHILDREN)for(var m=0,h=e.CHILDREN.length;m<h;m++){var n=e.CHILDREN[m];if(this._status[n]){k[g].states[n]={};for(var v in this._status[n])k[g].states[n][v]=this._status[n][v]}}}return k};h.prototype.getBufferedState=
function(k){if(!k)return null;var g=k.indexOf(":");-1!=g&&(k=k.substr(0,g));k=this._devices[k];if(!k)return null;var e={};if(k.CHILDREN){var m=this;k.CHILDREN.forEach(function(k){if(m._status[k]){e[k]={};for(var g in m._status[k])e[k][g]=m._status[k][g]}})}return e};h.prototype.getBufferedDevices=function(){return this._getDeviceStructs(this._devices)};h.prototype.getState=function(k,g,e){var l=this.getBufferedState(k);if(l&&l[k]&&l[k][g]){l=l[k][g];var h=l.value;if("undefined"!=typeof h&&null!=h){e&&
e(null,l);return}}this.updateState(k,g,function(k,g){e&&e(k,g)})};h.prototype.updateState=function(k,g,e){var l=this;this.readValue(k,g,function(m,h){m?setTimeout(function(){var m,h=l.getBufferedState(k);h&&h[k]&&h[k][g]&&(m=h[k][g]);e&&e(null,m)},1E3):e&&e(null,{value:h,time:(new Date).getTime()})})};h.prototype.reset=function(k){var g=[];Object.keys(this._devices).forEach(function(k){k&&-1==k.indexOf(":")&&"BidCoS-RF"!=k&&g.push(k)});if(0==g.length)k&&k();else{var e=0,m=this,h=function(l){e++;e<
g.length?m.deleteDevice(g[e],h):k&&k()};this.deleteDevice(g[e],h)}};h.prototype.register=function(k,g,e){if(k){this._logger.log("debug","register:"+g+" to "+k);var l=this;this._client.init(k,g,function(k){l._logger.log("debug","registed:"+g+(k?" err:"+k.message:""));e&&e(k,k?null:g)})}else e&&e(Error("arguments invalid"))};h.prototype.unregister=function(k,g){k?this._client.init(k,"",function(k){g&&g(k)}):g&&g(Error("url invalid"))};h.prototype.getDevices=function(k){this._client.listDevices(function(g,
e){if(g)k&&k(g);else for(g=0;g<e.length;g++);})};h.prototype.learnNewDevice=function(k){var g=this._learnDeviceCbs.length;k&&-1==this._learnDeviceCbs.indexOf(k)&&this._learnDeviceCbs.push(k);if(0==g){var e=this;this._learnDeviceTO=setTimeout(function(){var k=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var g=0;g<k.length;g++){var l=k[g];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,1,function(k){if(k){e._learnDeviceTO&&(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=
null);var g=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var m=g[l];m&&m(k)}}})}};h.prototype.learnNewDeviceSN=function(k,g){var l=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==l){var e=this;this._learnDeviceTO=setTimeout(function(){var k=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var g=0;g<k.length;g++){var l=k[g];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,k,function(k){if(k){e._learnDeviceTO&&
(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=null);var g=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var m=g[l];m&&m(k)}}})}};h.prototype.learnNewIPDevice=function(k,g,e){var l=this._learnDeviceCbs.length;e&&-1==this._learnDeviceCbs.indexOf(e)&&this._learnDeviceCbs.push(e);if(0==l){var h=this;this._learnDeviceTO=setTimeout(function(){var k=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var g=0;g<k.length;g++){var l=k[g];l&&l(Error("learn device timeout"))}},6E4);k={ADDRESS:k.replace(/-/g,
"").toUpperCase(),KEY_MODE:"LOCAL",KEY:this._convertHmIPKeyBase32ToBase16(g)};this._client.setInstallModeWithWhitelist(!0,60,[k],function(k){if(k){h._learnDeviceTO&&(clearTimeout(h._learnDeviceTO),h._learnDeviceTO=null);var g=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var e=g[l];e&&e(k)}}})}};h.prototype.learnNewIPDeviceQR=function(k,g){var l=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==l){var e=this;this._learnDeviceTO=
setTimeout(function(){var k=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var g=0;g<k.length;g++){var l=k[g];l&&l(Error("learn device timeout"))}},3E4);g=k.substr(6,24);k=k.substring(k.length-32,k.length);k={ADDRESS:g.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:k.toUpperCase()};this._client.setInstallModeWithWhitelist(!0,30,[k],function(k){if(k){e._learnDeviceTO&&(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=null);var g=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var h=
g[l];h&&h(k)}}})}};h.prototype.deleteDevice=function(k,g){if(k){var l=k.indexOf(":");-1!=l&&(k=k.substr(0,l));this._client.deleteDevice(k,2,g)}else g&&g(Error("address is empty"))};h.prototype.readValue=function(k,g,e){var l=k+"."+g,h=this._readValueCbs[l];h||(h=[],this._readValueCbs[l]=h);var n=h.length;e&&-1==h.indexOf(e)&&h.push(e);if(0==n){var q=this;this._client.getValue(k,g,null,function(e,h){e||q._updateStatusBuffer(k,g,h);var m=q._readValueCbs[l];delete q._readValueCbs[l];m.forEach(function(k){k&&
k(e,h)})})}};h.prototype.writeValue=function(k,g,e,h){var l=this;this._client.setValue(k,g,e,function(m){m||l._updateStatusBuffer(k,g,e.type?e.value:e);h&&h(m)})};h.prototype.getValuesParamset=function(k,g){this._logger.log("trace","getValuesParamset:"+k);var l=this;this._client.getParamset(k,"VALUES",0,function(e,h){if(e)l._logger.log("trace","getValuesParamset error:"+e.message),g&&g(e);else{if(h){e=0;var m=k.indexOf(":");-1!=m&&(e=k.substr(m+1));for(var n in h)h.hasOwnProperty(n)&&(0==e?"INSTALL_MODE"!=
n&&l._updateStatusBuffer(k,n,h[n]):l._updateStatusBuffer(k,n,h[n]))}l._logger.log("trace","getValuesParamset finish:"+JSON.stringify(h));g&&g(null,h)}})};h.prototype.getParamset=function(g,l,e){this._client.getParamset(g,l,0,function(g,k){e&&e(g,k)})};h.prototype.setParamset=function(g,l,e,h){this._client.putParamset(g,l,e,function(g){h&&h(g)})};h.prototype.reportValueUsage=function(g,l,e,h){this._client.reportValueUsage(g,l,e,function(g,k){h&&h(g,k)})};h.prototype.getDevice=function(g){if(!g)return null;
var k=g,e=g.indexOf(":");-1!=e&&(k=g.substr(0,e));if(!this._devices[k])return null;var h=[];g=this._devices[k];h.push(g);if(g.CHILDREN){var n=this;g.CHILDREN.forEach(function(g){g&&n._devices[g]&&h.push(n._devices[g])})}return(g=this._getDeviceStructs(h))?g[k]:null};h.prototype._getDeviceStructs=function(g){if(!g)return null;var k={},e=this;g.forEach(function(g){if(g.ADDRESS&&g.TYPE)if(!g.PARENT&&g.CHILDREN)k[g.ADDRESS]={type:g.TYPE,"interface":e.interface,address:g.ADDRESS,channels:{}};else if(g.PARENT){var l=
k[g.PARENT];l&&(l.channels[g.ADDRESS]={type:g.TYPE,address:g.ADDRESS})}});return k};h.prototype._updateStatusBuffer=function(g,l,e,h){if("CENTRAL"!=g||"PONG"!=l){if("PRESS_SHORT"==l||"PRESS_LONG"==l||"PRESS_CONT"==l||"PRESS_LONG_RELEASE"==l){var k={};h={value:e,time:(new Date).getTime()};var m=!0}else{var n=this._status[g];n||(n={},this._status[g]=n);k=n[l];k||(k={},n[l]=k);h={value:e,time:h?h:(new Date).getTime()};k&&k.time&&h&&h.time&&k.time>h.time?m=!1:(n[l]=h,m=!0)}n=this.getDevice(g);m&&this.emit("event",
{device:n,"interface":this.interface,channel:g,datapoint:l,value:h,changed:k.value!=h.value,oldValue:k});k=g.indexOf(":");-1!=k&&(h=g.substr(0,k),"1"==g.substr(k+1)&&"STATE"==l&&0==e&&n&&n.channels&&n.channels[h+":2"]&&"POWERMETER"==n.channels[h+":2"].type&&(this._updateStatusBuffer(h+":2","POWER",0),this._updateStatusBuffer(h+":2","CURRENT",0)))}};h.prototype._initNewDeviceStates=function(g,l){if(this._initStates){var k=this,e=function(g,l){g.ADDRESS&&g.PARAMSETS&&-1!=g.PARAMSETS.indexOf("VALUES")?
k.getValuesParamset(g.ADDRESS,l):l()},h=0,n=function(){h++;h<g.length?e(g[h],n):l&&l()};e(g[h],n)}else l&&l()};h.prototype._convertHmIPKeyBase32ToBase16=function(g){g=g.replace(/-/g,"").toUpperCase();var k="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),e=new ArrayBuffer(16);e=new Uint8Array(e);for(var h=0,n=g.length-1,p=0,v=e.length-1,w="";0<=n;){for(var u=0;u<k.length;u++)if(k[u]==g.charAt(n)){h|=u<<p;break}p+=5;for(n--;8<p&&0<=v;)e[v]=h&255,h>>=8,p-=8,v--}for(u=0;u<e.length;u++)16>e[u]&&(w+="0"),
w+=e[u].toString(16);return w.toUpperCase()};h.prototype._xmlrpcCall=function(g,l,e){this._logger.log("trace","receive call:"+g);this._logger.log("trace","params:"+JSON.stringify(l));var k=[],h;switch(g){case "newDevices":if(l[1]){this._initNewDeviceStates(l[1],null);for(h=0;h<l[1].length;h++)(g=l[1][h])&&g.ADDRESS&&(this._devices[g.ADDRESS]=g);g=this._getDeviceStructs(l[1]);try{this.emit("newDevices",g)}catch(v){}if(!l[1]||!l[1][0]||"HM-RCV-50"!=l[1][0].TYPE)for(l=this._learnDeviceCbs,this._learnDeviceCbs=
[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),h=0;h<l.length;h++){var n=l[h];n&&n(null,g)}}break;case "readdedDevice":if(l[1]&&l[1][0])for(h=this.getDevice(l[1][0]),g={},g[l[1][0]]=h,l=this._learnDeviceCbs,this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),h=0;h<l.length;h++)(n=l[h])&&n(null,
g);break;case "listDevices":if(l[1]){l=[];for(h in this._devices)this._devices.hasOwnProperty(h)&&this._devices[h]&&l.push(this._devices[h]);k.push(l)}break;case "deleteDevices":if(l[1])for(h=0;h<l[1].length;h++)if(g=l[1][h])delete this._devices[g],delete this._status[g];break;case "event":this._logger.log("trace","get event:"+JSON.stringify(l)),this._updateStatusBuffer(l[1],l[2],l[3])}e&&e(null,k)};var e=function(g,l,e,h,n,p){x.hub.m.hm._Controller.call(this,g,l,e,h,n,p);this.interface="BidCos-RF";
this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.RF")};e.prototype=new h;e.prototype.constructor=e;e.prototype.listBidcosInterfaces=function(g){this._client.listBidcosInterfaces(function(k,e){g&&g(k,e)})};e.prototype.ping=function(g,l){this._client.ping(g,function(g){l&&l(g)})};var n=function(g,l,e,h,n,p){x.hub.m.hm._Controller.call(this,g,l,e,h,n,p);this.interface="BidCos-Wired";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.Wired")};util.inherits(n,h);var g=
function(g,l,e,h,n,p){x.hub.m.hm._Controller.call(this,g,l,e,h,n,p);this.interface="HmIP-RF";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IP")};util.inherits(g,h);g.prototype.deleteDevice=function(g,l){var k=g.indexOf(":");-1!=k&&(g=g.substr(0,k));this._client.deleteDevice(g,2,l)};h.getController=function(k,l,h){switch(k){case "BidCos-RF":k=e;break;case "BidCos-Wired":k=n;break;case "HmIP-RF":k=g;break;default:return null}return new k(l.ip,l.port,l.username,l.password,h.useHttps,
h.initStates)};return h}();
x.hub.m.hm.Monitor=function(){var h=function(g,k,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.ControllerMonitor");this._type=l;this._monitor=g;this._controller=k;this._xmlrpcServer=null;this._retryWait=1E4;this._retryCount=0;this._retryTO=null;this._state=0;this._err=null};h.prototype.start=function(g,k){0==this._state&&(this._xmlrpcServer=g,this._connect(g));k&&k()};h.prototype.stop=function(g,k){var l=this._state;this._retryTO&&clearTimeout(this._retryTO);this._retryTO=null;
this._state=0;this._err=null;this._retryCount=0;0!=l?this._unregister(g,function(){k&&k()}):k&&k()};h.prototype.getMonitorState=function(){return{state:this._state,error:this._err?this._err.message:null}};h.prototype._connect=function(){this._logger.log("info","start regist "+this._type+" monitor at "+this._controller.getIP()+":"+this._controller.getPort());this._state=1;var g=this;this._register(this._xmlrpcServer,function(k){k?(g._logger.log("warn","regist "+g._type+" monitor at "+g._controller.getIP()+
":"+g._controller.getPort()+" error:"+k.message),g._state=3,g._err=k,g._retryCount++,g._retryTO=setTimeout(function(){g._logger.log("trace","retry timeout for regist "+g._type+" monitor at "+g._controller.getIP()+":"+g._controller.getPort()+" expired");g._connect()},Math.min(6E4,Math.ceil(g._retryCount/10)*g._retryWait))):(g._logger.log("info","regist "+g._type+" monitor at "+g._controller.getIP()+":"+g._controller.getPort()+" success"),g._state=2,g._err=null,g._retryCount=0,g._monitor._onControllerMonitorConnected(g._type))})};
h.prototype._register=function(g,k){var l=this._monitor.localMac.replace(/:/g,""),e="/"+this._monitor.serialNumber;g=g.getPort();this._controller.register("http://"+this._monitor.localIP+":"+(g?g:80)+e,this._monitor.serialNumber+"_"+this._controller.getPort()+"_"+l,k)};h.prototype._unregister=function(g,k){var l="/"+this._monitor.serialNumber;g=g.getPort();this._controller.unregister("http://"+this._monitor.localIP+":"+(g?g:80)+l,k)};var e=function(g){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.PinPongHandler");
this._monitor=g;this._pingWait=3E4;this._pingTO=null;this._pingMiss=0};e.prototype.start=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._startPingTO()};e.prototype.stop=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0};e.prototype._startPingTO=function(){var g=this;this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingTO=setTimeout(function(){g._pingMiss++;4>g._pingMiss?(g._ping(),g._startPingTO()):
g._pingFail()},this._pingWait)};e.prototype._ping=function(g){var k=this._monitor._rfController;k?(this._logger.log("trace","send PING"),k.ping(this._monitor.localMac,function(k){g&&g(k)})):g&&g(Error("no rf controller for ping"))};e.prototype._pingFail=function(){this._logger.log("warn","PING Fail");this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._monitor._onPingFail()};e.prototype._onPong=function(){this._pingMiss=0};var n=function(g,k){this.ip=g.ip;this.serialNumber=
g.uuid;this.ccuType=g.type;this.ccuType||(this.ccuType=2);this.localIP=k?k.localIP:null;this.localMac=k?k.localMac:null;this.isChip=k?"chip"==k.localChip:!1;this.isCCU3=k?"ccu3"==k.localChip:!1;this.persistant=k?k.persistant:!1;this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor");g={ip:this.ip,port:null,username:g.username,password:g.password};k={useHttps:!1,initStates:this.isChip?!0:!1};g.port=this.isCCU3?32001:2001;this._rfController=x.hub.m.hm._Controller.getController("BidCos-RF",
g,k);this._rfController.on("event",this._onEvent.bind(this));this._rfController.on("newDevices",this._onNewDevices.bind(this));g.port=this.isCCU3?32010:2010;this._ipController=x.hub.m.hm._Controller.getController("HmIP-RF",g,k);this._ipController.on("event",this._onEvent.bind(this));this._ipController.on("newDevices",this._onNewDevices.bind(this));g.port=this.isCCU3?32E3:2E3;this._wiredController=x.hub.m.hm._Controller.getController("BidCos-Wired",g,k);this._wiredController.on("event",this._onEvent.bind(this));
this._wiredController.on("newDevices",this._onNewDevices.bind(this));this._wiredMonitor=this._ipMonitor=this._rfMonitor=null;this._pingpong=new e(this);this._pingTO=this._manager=this._xmlrpcServer=null;this._pingMiss=0;this._wiredRegisted=this._ipRegisted=this._rfRegisted=!1;this._reconnectTO=null;this._reconnectCount=0};util.inherits(n,EventEmitter);n.prototype.getMonitorState=function(g){var k={chip:this.isChip};if(this._rfMonitor){var l=this._rfMonitor.getMonitorState();k.bidcos=l}this._ipMonitor&&
(l=this._ipMonitor.getMonitorState(),k.hmip=l);this._wiredMonitor&&(l=this._wiredMonitor.getMonitorState(),k.bidcos_wired=l);k.bidcos&&2==k.bidcos.state?this._rfController.listBidcosInterfaces(function(l,e){e&&(k.info=e);g&&g(null,k)}):g&&g(null,k)};n.prototype.getAllBufferedStates=function(){var g={},k,l=this._rfController.getAllBufferedStates();if(l)for(k in l)l.hasOwnProperty(k)&&(g[k]=l[k]);if(l=this._wiredController.getAllBufferedStates())for(k in l)l.hasOwnProperty(k)&&(g[k]=l[k]);if(l=this._ipController.getAllBufferedStates())for(k in l)l.hasOwnProperty(k)&&
(g[k]=l[k]);return g};n.prototype.getBufferedDevice=function(g,k){switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:return null}return g.getDevice(k)};n.prototype.getState=function(g,k){if(!(g&&g.interface&&g.channel&&g.datapoint))return k&&k(Error("argument invalid")),null;switch(g.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=
this._ipController;break;default:return null}l.getState(g.channel,g.datapoint,k)};n.prototype.updateState=function(g,k){if(!(g&&g.interface&&g.channel&&g.datapoint))return k&&k(Error("argument invalid")),null;switch(g.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:return null}l.updateState(g.channel,g.datapoint,k)};n.prototype.init=function(g,k){this._logger.log("info","init monitor ("+
this.ip+")");this._xmlrpcServer=g;this._init(k)};n.prototype._init=function(g){var k=this;this.getSerialNumber(function(l){l?g&&g(l):k.register(k._xmlrpcServer,function(){g&&g()})})};n.prototype.update=function(g,k,l,e){l&&this.serialNumber!=l&&(this.serialNumber=l);var h=this;g&&this.ip!=g||k&&this.localIP!=k?this.unregister(this._xmlrpcServer,function(){h.ip=g;h.localIP=k;h.register(h._xmlrpcServer,e)}):e&&e()};n.prototype.finalize=function(g){this.removeAllListeners();this._manager&&this._manager.deleteMonitor(this.ip);
this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);this.unregister(this._xmlrpcServer,function(){g&&g()})};n.prototype.getSerialNumber=function(g){var k=this;global&&"CCU3"==global.PLATFORM?(this._rfController.setPort(32001),k.getRFInterfaces(function(l,e){l?(k._rfController.setPort(2001),k.getRFInterfaces(function(l,e){l?g&&g():(k.serialNumber=e[0].ADDRESS,g&&g(null,k.serialNumber))})):(k._ipController.setPort(32010),
k._wiredController.setPort(32E3),k.serialNumber=e[0].ADDRESS,g&&g(null,k.serialNumber))})):this.getRFInterfaces(function(l,e){l?g&&g():(k.serialNumber=e[0].ADDRESS,g&&g(null,k.serialNumber))})};n.prototype.getRFInterfaces=function(g){this._rfController.listBidcosInterfaces(function(k,l){g&&g(k,l)})};n.prototype.register=function(g,k){var l=this;g.registServlet("/"+this.serialNumber,function(g,k,e){l._xmlrpcCall(g,k,e)});this._rfMonitor=new h(this,this._rfController,"rf");this._ipMonitor=new h(this,
this._ipController,"ip");this._wiredMonitor=new h(this,this._wiredController,"wired");this._rfMonitor.start(g);this._ipMonitor.start(g);this.isChip||this._wiredMonitor.start(g);k&&k()};n.prototype.unregister=function(g,k){g.unregistServlet("/"+this.serialNumber);this._rfMonitor.stop(g);this._ipMonitor.stop(g);this.isChip||this._wiredMonitor.stop(g);k&&k()};n.prototype._onControllerMonitorConnected=function(g){"rf"==g&&this._pingpong.start()};n.prototype._onPingFail=function(){var g=this;this.unregister(this._xmlrpcServer,
function(){g.register(g._xmlrpcServer,function(){})})};n.prototype._onPong=function(){this._pingpong._onPong()};n.prototype.reset=function(g){var k=this;this._rfController.reset(function(){k._ipController.reset(function(){k._wiredController.reset(function(){g&&g()})})})};n.prototype.learnRF=function(g){this._rfController.learnNewDevice(function(k,l){g&&g(k,l)})};n.prototype.learnRFSN=function(g,k){this._rfController.learnNewDeviceSN(g,function(g,e){k&&k(g,e)})};n.prototype.learnIP=function(g,k,l){this._ipController.learnNewIPDevice(g,
k,function(g,k){l&&l(g,k)})};n.prototype.learnIPQR=function(g,k){this._ipController.learnNewIPDeviceQR(g,function(g,e){k&&k(g,e)})};n.prototype.deleteDevice=function(g,k,l){if(!g||!k)return l&&l(Error("argument invalid")),null;switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:l&&l(Error("no such interface"));return}g.deleteDevice(k,l)};n.prototype.getDevices=function(g){var k=0;this._rfController&&
k++;this._ipController&&k++;this._wiredController&&k++;var l=[],e=function(e){k--;e?g&&g(e):0==k&&g&&g(null,l)},h=this;this._rfController&&this._rfController.getBufferedDevices(function(g,k){g?(e&&e(g),e=null):(l=l.concat(h._parseDevices(k,"BidCos-RF")),e&&e())});this._ipController&&this._ipController.getBufferedDevices(function(g,k){g?(e&&e(g),e=null):(l=l.concat(h._parseDevices(k,"HmIP-RF")),e&&e())});this._wiredController&&this._wiredController.getBufferedDevices(function(g,k){g?(e&&e(g),e=null):
(l=l.concat(h._parseDevices(k,"BidCos-Wired")),e&&e())})};n.prototype.getParamset=function(g,k,e,h){if(g&&k&&e){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:h&&h(Error("unknow interface"));return}l.getParamset(k,e,function(g,k){h&&h(g,k)})}else h&&h(Error("argument invalid"))};n.prototype.setParamset=function(g,k,e,h,m){if(g&&k&&e&&h){var l=null;switch(g){case "BidCos-RF":l=this._rfController;
break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:m&&m(Error("unknow interface"));return}l.setParamset(k,e,h,function(g,k){m&&m(g,k)})}else m&&m(Error("argument invalid"))};n.prototype.readValue=function(g,k,e,h){if(g&&k&&e){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:h&&h(Error("unknow interface"));return}l.readValue(k,e,
function(g,k){h&&h(g,k)})}else h&&h(Error("argument invalid"))};n.prototype.writeValue=function(g,k,e,h,m){if(g&&k&&e){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:m&&m(Error("unknow interface"));return}l.writeValue(k,e,h,function(g){m&&m(g)})}else m&&m(Error("argument invalid"))};n.prototype.reportValueUsage=function(g,k,e,h){if(g&&k&&e){var l=null;switch(g){case "BidCos-RF":l=
this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:h&&h(Error("unknow interface"));return}l.reportValueUsage(k,e,1,function(g,k){h&&h(g,k)})}else h&&h(Error("argument invalid"))};n.prototype.updateStatusBuffer=function(g,k,e,h,m){if(g&&k&&e){switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:return}g._updateStatusBuffer(k,
e,h,m)}};n.prototype._parseDevices=function(g,k){k||(k="BidCos-RF");var e=new (require("xnm.aio.hm.js").CCU),h={},m;for(m in g)if(g.hasOwnProperty(m)){var n=g[m],p={typename:"DEVICE",hsstype:n.TYPE,address:n.ADDRESS,interface:k,rfAddr:n.RF_ADDRESS,channels:{}};if(n.CHILDREN)for(var v=0,w=n.CHILDREN.length;v<w;v++){var u=n.CHILDREN[v];p.channels[u]={hsstype:g[u].TYPE,address:u}}h[m]=p}return e._parseDevices(h)};n.prototype._xmlrpcCall=function(g,k,e){this._logger.log("trace","receive call:"+g);this._logger.log("trace",
"params:"+JSON.stringify(k));if("event"==g&&"CENTRAL"==k[1]&&"PONG"==k[2])this._onPong(),e&&e(null,[]);else{var l=k[0].split("_");3<=l.length?(l=l[1],-1!=l.indexOf("2001")&&this._rfController?this._rfController._xmlrpcCall(g,k,e):-1!=l.indexOf("2010")&&this._ipController?this._ipController._xmlrpcCall(g,k,e):-1!=l.indexOf("2000")&&this._wiredController?this._wiredController._xmlrpcCall(g,k,e):e&&e(null,[])):e&&e(null,[])}};n.prototype._onNewDevices=function(g){this._logger.log("debug","find new devices");
this._logger.log("debug",JSON.stringify(g));this.emit("new_devices",g)};n.prototype._onEvent=function(g){this._logger.log("trace","receive event:"+JSON.stringify(g));this._logger.log("debug","EVENT:\t"+g.interface+"\t"+g.device.type+"\t"+g.channel+"\t"+g.datapoint+"\t"+g.value.value);g.ip=this.ip;g.serialNumber=this.serialNumber;this.emit("event",g,this)};return n}();
x.hub.m.hm.MonitorManager=function(){var h=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.MonitorManager");this._monitors=[];this._xmlrpcServer=null;this._tmpMonitors={};this._monitorEvtListener=this.onDeviceEvent.bind(this)};h.prototype.init=function(e,h){this._xmlrpcServer=e;h&&h()};h.prototype.startMonitorForIP=function(e,h,g){this.startMonitor({ip:e},{localIP:h},g)};h.prototype.startMonitor=function(e,h,g){if(this._xmlrpcServer)if(e&&e.ip){var k=this.getMonitor(e.ip,e.uuid);
if(k)g&&g();else if(h||(h={}),h.localIP||(h.localIP=x.hub.m.hm._Util.getLocalIP(null,e.ip)),h.localIP){h.localMac||(h.localMac=x.hub.m.hm._Util.getLocalMac(h.localIP));var l=e.ip;this._tmpMonitors[l]||(this._tmpMonitors[l]=[]);var n=this._tmpMonitors[l].length,m=this._tmpMonitors[l];g||(g=function(){});-1==m.indexOf(g)&&m.push(g);if(!(0<n)){var r=this;k=new x.hub.m.hm.Monitor(e,h);k._manager=this;k.init(this._xmlrpcServer,function(g){g||(r._monitors.push(k),k.on("event",r._monitorEvtListener));var e=
r._tmpMonitors[l];delete r._tmpMonitors[l];e.forEach(function(k){k&&k(g)})})}}else g&&g(Error("local ip address invalid"))}else g&&g(Error("gateway invalid"));else g&&g(Error("xml rpc server not started"))};h.prototype.getAllMonitor=function(){return this._monitors};h.prototype.getMonitor=function(e,h){var g=null,k=null;this._monitors.forEach(function(l){l&&l.ip==e&&(g=l);l&&l.serialNumber==h&&(k=l)});return k?k:g};h.prototype.getMonitorStates=function(e){if(0==this._monitors.length)e&&e(null,[]);
else{var h=this,g=0,k=[],l=function(n,m){!n&&m&&(m.ip=h._monitors[g].ip,m.serialNumber=h._monitors[g].serialNumber,k.push(m));g++;g<h._monitors.length?h._monitors[g].getMonitorState(l):e&&e(null,k)};this._monitors[g].getMonitorState(l)}};h.prototype.deleteMonitor=function(e){for(var h=-1,g=0,k=this._monitors.length;g<k;g++){var l=this._monitors[g];if(l&&l.ip==e){h=g;break}}-1!=g&&this._monitors.splice(h,1)};h.prototype.onFindHomeMatic=function(e,h,g){var k=this.getMonitor(null,g),l=this.getMonitor(e);
l?(l.update(e,h,g),k&&k!=l&&(k.finalize(),this.deleteMonitor(k.ip))):(k&&(k.finalize(),this.deleteMonitor(k.ip)),this.startMonitorForIP(e,h))};h.prototype.onDeviceEvent=function(e,h){require("x.hub.m.hm.js").onDeviceEvent(e,h.isChip)};return h}();
x.hub.m.hm._Channel=function(){var h=function(){var g=[];this.map.forEach(function(k){k&&k.dpt&&k.state&&0<k.state.length&&-1==g.indexOf(k.dpt)&&g.push(k.dpt)});return g},e=function(g){var k=null;this.map.forEach(function(e){e&&e.dpt&&e.state&&-1!=e.state.indexOf(g)&&(k=e.dpt)});return k},n=function(g){var k=null;this.map.forEach(function(e){e&&e.dpt&&e.command&&-1!=e.command.indexOf(g)&&(k=e.dpt)});return k};return{"HmIP-RF":{T_MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},
{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]},{dpt:"ACTUAL_TEMPERATURE",state:["maintainTemp"],event:["maintainTemp"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){switch(g){case "UNREACH":return{timeout:k};case "LOW_BAT":return{lowbat:k};
case "SABOTAGE":return{sabotage:k};case "OPERATING_VOLTAGE":return{voltage:parseFloat(k)};case "ERROR_CODE":return{errorCode:parseInt(k)};case "ACTUAL_TEMPERATURE":return{maintainTemp:parseFloat(k)}}return null}},MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){switch(g){case "UNREACH":return{timeout:k};case "LOW_BAT":return{lowbat:k};
case "SABOTAGE":return{sabotage:k}}return null}},MAINTENANCE_BAT_EL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){switch(g){case "UNREACH":return{timeout:k};
case "LOW_BAT":return{lowbat:k};case "SABOTAGE":return{sabotage:k};case "OPERATING_VOLTAGE":return{voltage:parseFloat(k)};case "ERROR_CODE":return{errorCode:parseInt(k)};case "SENSOR_ERROR":return{sensorError:k}}return null}},MAINTENANCE_BAT_CL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){switch(g){case "UNREACH":return{timeout:k};case "LOW_BAT":return{lowbat:k}}return null}},
SWITCH_TRANSMITTER:{map:[{dpt:"STATE",state:["switchTState"],event:["switchTState"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "STATE":e=1==k?{switchTState:"on"}:0==k?{switchTState:"off"}:{switchTState:"?"}}return e}},SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"STATE",state:["switchState"],event:["switchState"],command:["on","off","toggle"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "STATE":e=1==k?{switchState:"on"}:
0==k?{switchState:"off"}:{switchState:"?"}}return e},executeCommand:function(g,k,e,h,m){var l=n.call(this,h);"onFor"==h.substr(0,5)&&(l="STATE");if(l)switch(h){case "on":g.writeValue(k,e,l,!0,m);break;case "off":g.writeValue(k,e,l,!1,m);break;case "toggle":g.getState({interface:k,channel:e,datapoint:l},function(h,n){h?m&&m(h):n?(h=!0,n.value&&(h=!1),g.writeValue(k,e,l,h,m)):m&&m(Error("get switch current value return invalid"))});break;default:"onFor"==h.substr(0,5)?(h=parseFloat(h.substr(5)),isNaN(h)?
m&&m(Error("onFor command invalid")):(l="ON_TIME",g.writeValue(k,e,l,{type:"double",value:h},function(h){h?m&&m(h):(l="STATE",g.writeValue(k,e,l,!0,m))}))):m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+h))}},ENERGIE_METER_TRANSMITTER:{map:[{dpt:"ENERGY_COUNTER",state:["meterEnergyCounter"],event:["meterEnergyCounter"]},{dpt:"POWER",state:["meterPower"],event:["meterPower"]},{dpt:"CURRENT",state:["meterCurrent"],event:["meterCurrent"]},{dpt:"VOLTAGE",state:["meterVoltage"],
event:["meterVoltage"]},{dpt:"FREQUENCY",state:["meterFrequency"],event:["meterFrequency"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){switch(g){case "ENERGY_COUNTER":return{meterEnergyCounter:parseFloat(k).toFixed(2)};case "POWER":return{meterPower:parseFloat(k).toFixed(2)};case "CURRENT":return{meterCurrent:parseFloat(k).toFixed(2)};case "VOLTAGE":return{meterVoltage:parseFloat(k).toFixed(2)};case "FREQUENCY":return{meterFrequency:parseFloat(k).toFixed(2)}}return null}},DIMMER_TRANSMITTER:{map:[{dpt:"LEVEL",
state:["dimmerTLevel"],event:["dimmerTLevel"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "LEVEL":e={dimmerTLevel:Math.round(100*parseFloat(k))};break;case "COLOR":e={dimmerTColor:"off blue green torqoise red purple yellow white".split(" ")[parseInt(k)]}}return e}},DIMMER_VIRTUAL_RECEIVER:{map:[{dpt:"LEVEL",state:["dimmerLevel"],event:["dimmerLevel"],command:["dimOff","dimUp","dimDown","dimTo","toggleTo"]},{dpt:"COLOR",state:["dimmerColor"],event:["dimmerColor"],
command:["colorTo"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "LEVEL":e={dimmerLevel:Math.round(100*parseFloat(k))}}return e},executeCommand:function(g,k,e,h,m){if(h){if("dimOff"==h.substr(0,6))var l="dimOff";else if("dimUp"==h.substr(0,5)){l="dimUp";var p=h.substr(5)}else if("dimDown"==h.substr(0,7))l="dimDown",p=h.substr(7);else if("dimTo"==h.substr(0,5)){if(l="dimTo",p=h.substr(5),!p){m&&m(Error("dimTo has no value"));return}}else if("toggleTo"==
h.substr(0,8)){if(l="toggleTo",p=h.substr(8),!p){m&&m(Error("toggleTo has no value"));return}}else if("colorTo"==h.substr(0,7)&&(l="colorTo",p=h.substr(7),!p)){m&&m(Error("colorTo has no value"));return}var q=n.call(this,l);if(q)switch(l){case "dimOff":g.writeValue(k,e,q,{type:"double",value:0},m);break;case "dimUp":p||(p=10);p=parseInt(p)/100;g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):
(p=l.value+p,1<p&&(p=1),g.writeValue(k,e,q,{type:"double",value:p},m))});break;case "dimDown":p||(p=10);p=parseInt(p)/100;g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(k,e,q,{type:"double",value:p},m))});break;case "toggleTo":p=parseInt(p)/100;g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):l?(l.value&&(p=0),g.writeValue(k,e,q,{type:"double",
value:p},m)):m&&m(Error("get switch current value return invalid"))});break;case "dimTo":p=parseInt(p)/100;g.writeValue(k,e,q,{type:"double",value:p},m);break;case "colorTo":p=p.toLowerCase();p="off blue green torqoise red purple yellow white".split(" ").indexOf(p);if(-1==p){m&&m(Error("unknown color"));break}g.writeValue(k,e,q,{type:"double",value:p},m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+h))}else m&&m(Error("command in null"))}},MOTIONDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_MOTION",
command:["reset"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"MOTION_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "MOTION":e={state:k?"on":"off"};break;case "ILLUMINATION":e={illumination:k};break;case "MOTION_DETECTION_ACTIVE":e={active:k}}return e},executeCommand:function(g,
k,e,h,m){if(h){var l=n.call(this,h);if(l)switch(h){case "reset":g.writeValue(k,e,l,!0,m);break;case "activate":g.writeValue(k,e,l,!0,m);break;case "deactivate":g.writeValue(k,e,l,!1,m);break;case "toggleActivate":g.getState({interface:k,channel:e,datapoint:l},function(h,n){h?m&&m(h):n?(h=!0,n.value&&(h=!1),g.writeValue(k,e,l,h,m)):m&&m(Error("get switch current value return invalid"))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+h))}else m&&
m(Error("command in null"))}},KEY_TRANRECEIVER:{map:[{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){k=null;switch(g){case "PRESS_SHORT":k={pressShort:!0};break;case "PRESS_LONG":k={pressLong:!0}}return k}},ALARM_SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"ACOUSTIC_ALARM_SELECTION",command:["setAudio"]},{dpt:"OPTICAL_ALARM_SELECTION",command:["setVisual"]},{dpt:"DURATION_UNIT",command:["setDuraionUnit"]},{dpt:"DURATION_VALUE",
command:["setDuraion"]},{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "STATE":e=1==k?{state:"on"}:0==k?{state:"off"}:{state:"?"}}return e},executeCommand:function(g,k,e,h,m){if(h){var l=null;if("triggerAlarm"==h.substr(0,12)){l="triggerAlarm";var p=h.substr(12);if(!p){m&&m(Error("triggerAlarm format invalid"));return}}if(n.call(this,l)||"triggerAlarm"==l)switch(l){case "triggerAlarm":var q=p.split(",");if(4>
q.length){m&&m(Error("triggerAlarm format invalid"));break}g.writeValue(k,e,"ACOUSTIC_ALARM_SELECTION",{type:"double",value:parseInt(q[0])},function(h,l){h?m&&m(h):g.writeValue(k,e,"OPTICAL_ALARM_SELECTION",{type:"double",value:parseInt(q[1])},function(h,l){h?m&&m(h):g.writeValue(k,e,"DURATION_VALUE",{type:"double",value:parseInt(q[2])},function(h,l){h?m&&m(h):g.writeValue(k,e,"DURATION_UNIT",{type:"double",value:parseInt(q[3])},m)})})});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+
h))}else m&&m(Error("command in null"))}},HEATING_CLIMATECONTROL_TRANSCEIVER:{map:[{dpt:"SET_POINT_TEMPERATURE",command:["tempTo","tempUp","tempDown"],state:["state"],event:["state"]},{dpt:"HUMIDITY",state:["hum"],event:["hum"]},{dpt:"CONTROL_MODE",command:["auto","manu"]},{dpt:"FROST_PROTECTION",state:["frost"],event:["frost"]},{dpt:"SET_POINT_MODE",state:["mode"],event:["mode"]},{dpt:"ACTIVE_PROFILE",command:["setProfile"],state:["profile"],event:["profile"]},{dpt:"WINDOW_STATE",command:["winOpen",
"winClose"],state:["window"],event:["window"]},{dpt:"ACTUAL_TEMPERATURE",state:["temp"],event:["temp"]},{dpt:"BOOST_MODE",command:["boostOn","boostOff"],state:["boost"],event:["boost"]},{dpt:"LEVEL",command:["setValve","valveUp","valveDown"],state:["valve"],event:["valve"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e={};switch(g){case "ACTIVE_PROFILE":e.profile=parseInt(k);break;case "ACTUAL_TEMPERATURE":e.temp=parseFloat(k);break;case "BOOST_MODE":e.boost=k;break;case "FROST_PROTECTION":e.frost=
k;break;case "HUMIDITY":e.hum=parseInt(k);break;case "SET_POINT_MODE":0==k?e.mode="auto":1==k&&(e.mode="manu");break;case "SET_POINT_TEMPERATURE":e.state=parseFloat(k);break;case "LEVEL":e.valve=Math.round(100*parseFloat(k));break;case "WINDOW_STATE":switch(k){case 0:e.window="closed";break;case 1:e.window="open"}break;default:return null}return e},executeCommand:function(g,k,e,h,m){if(h){var l=h;if("tempTo"==h.substr(0,6)){l="tempTo";var p=h.substr(6);if(!p){m&&m(Error("tempTo has no value"));return}}else if("tempUp"==
h.substr(0,6))l="tempUp",p=h.substr(6);else if("tempDown"==h.substr(0,8))l="tempDown",p=h.substr(8);else if("setProfile"==h.substr(0,10)){if(l="setProfile",p=h.substr(10),!p){m&&m(Error("setProfile has no value"));return}}else if("setValve"==h.substr(0,8)){if(l="setValve",p=h.substr(8),!p){m&&m(Error("setValve has no value"));return}}else"valveUp"==h.substr(0,7)?(l="valveUp",p=h.substr(7)):"valveDown"==h.substr(0,9)&&(l="valveDown",p=h.substr(9));var q=n.call(this,l);if(q)switch(l){case "tempTo":p=
parseFloat(p);if(isNaN(p)){m&&m(Error("tempTo value invalid"));break}30.5<p&&(p=30.5);4.5>p&&(p=4.5);g.writeValue(k,e,q,{type:"double",value:p},m);break;case "tempUp":p||(p=1);p=parseFloat(p);if(isNaN(p)){m&&m(Error("tempUp value invalid"));break}g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value+p,30.5<p&&(p=30.5),g.writeValue(k,e,q,{type:"double",value:p},m))});break;case "tempDown":p||
(p=1);p=parseFloat(p);if(isNaN(p)){m&&m(Error("tempDown value invalid"));break}g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,4.5>p&&(p=4.5),g.writeValue(k,e,q,{type:"double",value:p},m))});break;case "auto":g.writeValue(k,e,q,{type:"double",value:0},m);break;case "manu":g.writeValue(k,e,q,{type:"double",value:1},m);break;case "setProfile":p=parseInt(p);if(isNaN(p)){m&&m(Error("setTemp value invalid"));
break}g.writeValue(k,e,q,p,m);break;case "winOpen":g.writeValue(k,e,q,1,m);break;case "winClose":g.writeValue(k,e,q,0,m);break;case "boostOn":g.writeValue(k,e,q,!0,m);break;case "boostOff":g.writeValue(k,e,q,!1,m);break;case "setValve":p=parseInt(p);if(isNaN(p)){m&&m(Error("setValve value invalid"));break}p/=100;1<p&&(p=1);0>p&&(p=0);g.writeValue(k,e,q,{type:"double",value:p},m);break;case "valveUp":p||(p=10);p=parseInt(p);if(isNaN(p)){m&&m(Error("tempUp value invalid"));break}p/=100;g.getState({interface:k,
channel:e,datapoint:q},function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(k,e,q,{type:"double",value:p},m))});break;case "valveDown":p||(p=10);p=parseInt(p);if(isNaN(p)){m&&m(Error("tempUp value invalid"));break}p/=100;g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(k,
e,q,{type:"double",value:p},m))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+h))}else m&&m(Error("command in null"))}},SHUTTER_CONTACT_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "STATE":e={state:0==k?"closed":"open"}}return e}},SMOKE_DETECTOR:{map:[{dpt:"SMOKE_DETECTOR_COMMAND",command:"reservedAlarmOff intrusionAlarmOff intrusionAlarmOn smokeTest commTest commTestRepeated".split(" ")},
{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["state"],event:["state"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["alarmDetail"],event:["alarmDetail"]},{dpt:"SMOKE_DETECTOR_TEST_RESULT",state:["testResult"],event:["testResult"]},{dpt:"ERROR_CODE",state:["error"],event:["error"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "SMOKE_DETECTOR_ALARM_STATUS":e={state:0==k?"ok":"smoke"};e.alarmDetail=k;break;case "SMOKE_DETECTOR_TEST_RESULT":switch(k){case 0:e={testResult:"none"};
break;case 1:e={testResult:"smoke_ok"};break;case 2:e={testResult:"smoke_nok"};break;case 3:e={testResult:"comm_sent"};break;case 4:e={testResult:"comm_ok"}}break;case "ERROR_CODE":e={error:k}}return e},executeCommand:function(g,k,e,h,m){if(h){var l=n.call(this,h);if(l)switch(h){case "reservedAlarmOff":case "intrusionAlarmOff":case "intrusionAlarmOn":case "smokeTest":case "commTest":case "commTestRepeated":switch(h){case "reservedAlarmOff":var p=0;break;case "intrusionAlarmOff":p=1;break;case "intrusionAlarmOn":p=
2;break;case "smokeTest":p=3;break;case "commTest":p=4;break;case "commTestRepeated":p=5}g.writeValue(k,e,l,p,m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+h))}else m&&m(Error("command in null"))}},ROTARY_HANDLE_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "STATE":switch(k){case 0:e={state:"closed"};break;case 1:e={state:"tilted"};break;
case 2:e={state:"open"}}}return e}},SHUTTER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTLevel"],event:["blindTLevel"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "LEVEL":e={blindTLevel:Math.round(100*parseFloat(k))}}return e}},SHUTTER_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindLevel"],event:["blindLevel"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,
k){var e=null;switch(g){case "LEVEL":e={blindLevel:Math.round(100*parseFloat(k))}}return e},executeCommand:function(g,k,e,h,m){if(h){if("moveUp"==h.substr(0,6))var l="moveUp";else if("moveDown"==h.substr(0,8)){l="moveDown";var p=h.substr(8)}else if("stepUp"==h.substr(0,6))l="stepUp",p=h.substr(6);else if("stepDown"==h.substr(0,8))l="stepDown",p=h.substr(8);else if("moveTo"==h.substr(0,6)){if(l="moveTo",p=h.substr(6),!p){m&&m(Error("moveTo has no value"));return}}else"stop"==h.substr(0,4)&&(l="stop");
var q=n.call(this,l);if(q)switch(l){case "moveUp":g.writeValue(k,e,q,{type:"double",value:1},m);break;case "moveDown":g.writeValue(k,e,q,{type:"double",value:0},m);break;case "stop":g.writeValue(k,e,q,!0,m);break;case "stepUp":p||(p=5);p=parseInt(p)/100;g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(k,e,q,{type:"double",value:p},m))});break;case "stepDown":p||
(p=5);p=parseInt(p)/100;g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(k,e,q,{type:"double",value:p},m))});break;case "moveTo":p=parseInt(p)/100;g.writeValue(k,e,q,{type:"double",value:p},m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+h))}else m&&m(Error("command in null"))}},BLIND_TRANSMITTER:{map:[{dpt:"LEVEL",
state:["blindTPos"],event:["blindTPos"]},{dpt:"LEVEL_2",state:["lamellaTPos"],event:["lamellaTPos"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "LEVEL":e={blindTPos:Math.round(100*parseFloat(k))};break;case "LEVEL_2":e={lamellaTPos:Math.round(100*parseFloat(k))}}return e}},BLIND_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindPos"],event:["blindPos"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]},{dpt:"LEVEL_2",
state:["lamellaPos"],event:["lamellaPos"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "LEVEL":e={blindPos:Math.round(100*parseFloat(k))};break;case "LEVEL_2":e={lamellaPos:Math.round(100*parseFloat(k))}}return e},executeCommand:function(g,k,e,h,m){if(h){var l=h;if("lamellaStepUp"==h.substr(0,13)){l="lamellaStepUp";var p=h.substr(13)}else if("lamellaStepDown"==h.substr(0,
15))l="lamellaStepDown",p=h.substr(15);else if("lamellaTo"==h.substr(0,9)){if(l="lamellaTo",p=h.substr(9),!p){m&&m(Error("lamellaTo has no value"));return}}else if("stepUp"==h.substr(0,6))l="stepUp",p=h.substr(6);else if("stepDown"==h.substr(0,8))l="stepDown",p=h.substr(8);else if("moveTo"==h.substr(0,6)){if(l="moveTo",p=h.substr(6),!p){m&&m(Error("moveTo has no value"));return}}else"stop"==h.substr(0,4)&&(l="stop");var q=n.call(this,l);if(q)switch(l){case "moveUp":case "moveDown":g.writeValue(k,
e,"LEVEL_2",{type:"double",value:"moveUp"==l?1:0},function(h){h?m&&m(h):g.writeValue(k,e,"LEVEL",{type:"double",value:"moveUp"==l?1:0},function(g){m&&m(g)})});break;case "stop":g.writeValue(k,e,q,!0,m);break;case "moveTo":p=parseInt(p)/100;g.writeValue(k,e,"LEVEL",{type:"double",value:p},m);break;case "lamellaUp":case "lamellaDown":g.getState({interface:k,channel:e,datapoint:"LEVEL"},function(h,n){h?m&&m(h):g.writeValue(k,e,"LEVEL",{type:"double",value:n.value},function(h){h?m&&m(h):g.writeValue(k,
e,"LEVEL_2",{type:"double",value:"lamellaUp"==l?1:0},function(g){m&&m(g)})})});break;case "stepUp":case "stepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:k,channel:e,datapoint:"LEVEL"},function(h,n){h?m&&m(h):"undefined"==typeof n||null==n?m&&m(Error("get jalousie current value return invalid")):(p="stepUp"==l?n.value+p:n.value-p,1<p&&(p=1),0>p&&(p=0),g.writeValue(k,e,"LEVEL",{type:"double",value:p},m))});break;case "lamellaStepUp":case "lamellaStepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:k,
channel:e,datapoint:"LEVEL"},function(h,n){if(h)m&&m(h);else if("undefined"==typeof n||null==n)m&&m(Error("get jalousie current value return invalid"));else{var q=n.value;g.getState({interface:k,channel:e,datapoint:"LEVEL_2"},function(h,n){h?m&&m(h):"undefined"==typeof n||null==n?m&&m(Error("get jalousie current value return invalid")):(p="lamellaStepUp"==l?n.value+p:n.value-p,1<p&&(p=1),0>p&&(p=0),g.writeValue(k,e,"LEVEL_2",{type:"double",value:p},function(h){h?m&&m(h):g.writeValue(k,e,"LEVEL",{type:"double",
value:q},m)}))})}});break;case "lamellaTo":p=parseInt(p)/100;g.writeValue(k,e,"LEVEL_2",{type:"double",value:p},m);break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+h))}else m&&m(Error("command in null"))}},PRESENCEDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_PRESENCE",command:["reset"]},{dpt:"PRESENCE_DETECTION_STATE",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"CURRENT_ILLUMINATION",state:["current_illumination"],
event:["current_illumination"]},{dpt:"PRESENCE_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "PRESENCE_DETECTION_STATE":e={state:k?"on":"off"};break;case "ILLUMINATION":e={illumination:k};break;case "CURRENT_ILLUMINATION":e={current_illumination:k};break;case "PRESENCE_DETECTION_ACTIVE":e={active:k}}return e},executeCommand:function(g,k,e,h,m){if(h){var l=
n.call(this,h);if(l)switch(h){case "reset":g.writeValue(k,e,l,!0,m);break;case "activate":g.writeValue(k,e,l,!0,m);break;case "deactivate":g.writeValue(k,e,l,!1,m);break;case "toggleActivate":g.getState({interface:k,channel:e,datapoint:l},function(h,n){h?m&&m(h):n?(h=!0,n.value&&(h=!1),g.writeValue(k,e,l,h,m)):m&&m(Error("get switch current value return invalid"))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+h))}else m&&m(Error("command in null"))}},
CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER:{map:[{dpt:"EMERGENCY_OPERATION",state:["cl_fd_emergencyOP"],event:["cl_fd_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fd_frostProtection"],event:["cl_fd_frostProtection"]},{dpt:"STATE",state:["cl_fd_state"],event:["cl_fd_state"]},{dpt:"HUMIDITY_ALARM",state:["cl_fd_humidityAlarm"],event:["cl_fd_humidityAlarm"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "EMERGENCY_OPERATION":e={cl_fd_emergencyOP:k};break;
case "FROST_PROTECTION":e={cl_fd_frostProtection:k};break;case "STATE":e=1==k?{cl_fd_state:"on"}:0==k?{cl_fd_state:"off"}:{cl_fd_state:"?"};break;case "HUMIDITY_ALARM":e={cl_fd_humidityAlarm:k}}return e}},CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_fp_humidityLimiter"],event:["cl_fp_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_fp_emergencyOP"],event:["cl_fp_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fp_frostProtection"],event:["cl_fp_frostProtection"]},
{dpt:"STATE",state:["cl_fp_state"],event:["cl_fp_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_fp_dewPointAlarm"],event:["cl_fp_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_fp_externalClock"],event:["cl_fp_externalClock"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "HUMIDITY_LIMITER":e={cl_fp_humidityLimiter:k};break;case "EMERGENCY_OPERATION":e={cl_fp_emergencyOP:k};break;case "FROST_PROTECTION":e={cl_fp_frostProtection:k};break;case "STATE":e=1==
k?{cl_fp_state:"on"}:0==k?{cl_fp_state:"off"}:{cl_fp_state:"?"};break;case "DEW_POINT_ALARM":e={cl_fp_dewPointAlarm:k};break;case "EXTERNAL_CLOCK":e={cl_fp_externalClock:k}}return e}},CLIMATECONTROL_FLOOR_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_f_humidityLimiter"],event:["cl_f_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_f_emergencyOP"],event:["cl_f_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_f_frostProtection"],event:["cl_f_frostProtection"]},{dpt:"STATE",state:["cl_f_state"],
event:["cl_f_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_f_dewPointAlarm"],event:["cl_f_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_f_externalClock"],event:["cl_f_externalClock"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "HUMIDITY_LIMITER":e={cl_f_humidityLimiter:k};break;case "EMERGENCY_OPERATION":e={cl_f_emergencyOP:k};break;case "FROST_PROTECTION":e={cl_f_frostProtection:k};break;case "STATE":e=1==k?{cl_f_state:"on"}:0==k?{cl_f_state:"off"}:
{cl_f_state:"?"};break;case "DEW_POINT_ALARM":e={cl_f_dewPointAlarm:k};break;case "EXTERNAL_CLOCK":e={cl_f_externalClock:k}}return e}},WEATHER_TRANSMIT:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["weatherActualTemp"],event:["weatherActualTemp"]},{dpt:"HUMIDITY",state:["weatherHum"],event:["weatherHum"]},{dpt:"ILLUMINATION",state:["weatherIllu"],event:["weatherIllu"]},{dpt:"SUNSHINEDURATION",state:["weatherSunD"],event:["weatherSunD"]},{dpt:"SUNSHINEDURATION_OVERFLOW",state:["weatherSunDOF"],event:["weatherSunDOF"]},
{dpt:"SUNSHINE_THRESHOLD_OVERRUN",state:["weatherSunTOR"],event:["weatherSunTOR"]},{dpt:"WIND_SPEED",state:["weatherWindS"],event:["weatherWindS"]},{dpt:"WIND_THRESHOLD_OVERRUN",state:["weatherWindTOR"],event:["weatherWindTOR"]},{dpt:"WIND_DIR",state:["weatherWindD"],event:["weatherWindD"]},{dpt:"WIND_DIR_RANGE",state:["weatherWindDR"],event:["weatherWindDR"]},{dpt:"RAINING",state:["weatherRain"],event:["weatherRain"]},{dpt:"RAIN_COUNTER",state:["weatherRainC"],event:["weatherRainC"]},{dpt:"RAIN_COUNTER_OVERFLOW",
state:["weatherRainCOF"],event:["weatherRainCOF"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "ACTUAL_TEMPERATURE":e={weatherActualTemp:k};break;case "HUMIDITY":e={weatherHum:k};break;case "ILLUMINATION":e={weatherIllu:k};break;case "SUNSHINEDURATION":e={weatherSunD:k};break;case "SUNSHINEDURATION_OVERFLOW":e={weatherSunDOF:k};break;case "SUNSHINE_THRESHOLD_OVERRUN":e={weatherSunTOR:k};break;case "WIND_SPEED":e={weatherWindS:k};break;case "WIND_THRESHOLD_OVERRUN":e=
{weatherWindTOR:k};break;case "RAINING":e={weatherRain:k};break;case "RAIN_COUNTER":e={weatherRainC:k};break;case "RAIN_COUNTER_OVERFLOW":e={weatherRainCOF:k};break;case "WIND_DIR":e={weatherWindD:k};break;case "WIND_DIR_RANGE":e={weatherWindDR:k}}return e}},CLIMATE_TRANSCEIVER:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["temperature"],event:["temperature"]},{dpt:"HUMIDITY",state:["humidity"],event:["humidity"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "ACTUAL_TEMPERATURE":e=
{temperature:k};break;case "HUMIDITY":e={humidity:k}}return e}},PASSAGE_DETECTOR_DIRECTION_TRANSMITTER:{map:[{dpt:"CURRENT_PASSAGE_DIRECTION",state:["current_direction"],event:["current_direction"]},{dpt:"LAST_PASSAGE_DIRECTION",state:["last_direction"],event:["last_direction"]},{dpt:"PASSAGE_COUNTER_OVERFLOW",state:["passage_counter_overflow"],event:["passage_counter_overflow"]},{dpt:"PASSAGE_COUNTER_VALUE",state:["passage_counter"],event:["passage_counter"]}],getReadableDpts:h,getDptFromState:e,
parseDptState:function(g,k){var e=null;switch(g){case "CURRENT_PASSAGE_DIRECTION":e={current_direction:k};break;case "LAST_PASSAGE_DIRECTION":e={last_direction:k};break;case "PASSAGE_COUNTER_OVERFLOW":e={passage_counter_overflow:k};break;case "PASSAGE_COUNTER_VALUE":e={passage_counter:k}}return e}},GENERIC_INPUT_TRANSMITER:{map:[{dpt:"CHANGE_OVER",state:["genInputChangeOver"],event:["genInputChangeOver"]},{dpt:"EXTERNAL_CLOCK",state:["genInputExtClock"],event:["genInputExtClock"]},{dpt:"HUMIDITY_LIMITER",
state:["genInputHumidityLimiter"],event:["genInputHumidityLimiter"]},{dpt:"STATE",state:["genInputState"],event:["genInputState"]},{dpt:"TACTILE_SWITCH",state:["genInputTactileSwitch"],event:["genInputTactileSwitch"]},{dpt:"TEMPERATURE_LIMITER",state:["genInputTempLimiter"],event:["genInputTempLimiter"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "CHANGE_OVER":e={genInputChangeOver:k};break;case "EXTERNAL_CLOCK":e={genInputExtClock:k};break;case "HUMIDITY_LIMITER":e=
{genInputHumidityLimiter:k};break;case "STATE":e=1==k?{genInputState:"on"}:0==k?{genInputState:"off"}:{genInputState:"?"};break;case "TACTILE_SWITCH":e={genInputTactileSwitch:k};break;case "TEMPERATURE_LIMITER":e={genInputTempLimiter:k}}return e}},ANALOG_OUTPUT_TRANSCEIVER:{map:[{dpt:"LEVEL",state:["outputLevel"],event:["outputLevel"],command:["outputOff","outputUp","outputDown","outputTo","toggleTo"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "LEVEL":e=
{outputLevel:Math.round(100*parseFloat(k))}}return e},executeCommand:function(g,k,e,h,m){if(h){if("outputOff"==h.substr(0,9))var l="outputOff";else if("outputUp"==h.substr(0,8)){l="outputUp";var p=h.substr(8)}else if("outputDown"==h.substr(0,10))l="outputDown",p=h.substr(10);else if("outputTo"==h.substr(0,8)){if(l="outputTo",p=h.substr(8),!p){m&&m(Error("outputTo has no value"));return}}else if("toggleTo"==h.substr(0,8)){if(l="toggleTo",p=h.substr(8),!p){m&&m(Error("toggleTo has no value"));return}}else isNaN(parseInt(h))||
(l="outputTo",p=parseInt(h));var q=n.call(this,l);if(q)switch(l){case "outputOff":g.writeValue(k,e,q,{type:"double",value:0},m);break;case "outputUp":p||(p=10);p=parseInt(p)/100;g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(k,e,q,{type:"double",value:p},m))});break;case "outputDown":p||(p=10);p=parseInt(p)/100;g.getState({interface:k,channel:e,datapoint:q},
function(h,l){h?m&&m(h):"undefined"==typeof l||null==l?m&&m(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(k,e,q,{type:"double",value:p},m))});break;case "toggleTo":p=parseInt(p)/100;g.getState({interface:k,channel:e,datapoint:q},function(h,l){h?m&&m(h):l?(l.value&&(p=0),g.writeValue(k,e,q,{type:"double",value:p},m)):m&&m(Error("get switch current value return invalid"))});break;case "outputTo":p=parseInt(p)/100;g.writeValue(k,e,q,{type:"double",value:p},m);
break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+h))}else m&&m(Error("command in null"))}},WATER_DETECTION_TRANSMITTER:{map:[{dpt:"ALARMSTATE",state:["alarm"],event:["alarm"]},{dpt:"MOISTURE_DETECTED",state:["moisture"],event:["moisture"]},{dpt:"WATERLEVEL_DETECTED",state:["water"],event:["water"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "ALARMSTATE":e={alarm:k};break;case "MOISTURE_DETECTED":e={moisture:k};
break;case "WATERLEVEL_DETECTED":e={water:k}}return e}},ACCELERATION_TRANSCEIVER:{map:[{dpt:"MOTION",state:["motion"],event:["motion"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,k){var e=null;switch(g){case "MOTION":e={motion:k}}return e}},DOOR_RECEIVER:{map:[{dpt:"DOOR_STATE",state:["doorState"],event:["doorState"]},{dpt:"DOOR_COMMAND",command:["open","close","partialOpen","stop"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){var k=null;switch(g){case "DOOR_STATE":e=
parseInt(e),k=0==e?{doorState:"closed"}:1==e?{doorState:"open"}:2==e?{doorState:"ventilation"}:{doorState:"unknown"}}return k},executeCommand:function(g,e,h,q,m){if(q){var k=n.call(this,q);if(k)switch(q){case "open":g.writeValue(e,h,k,{type:"double",value:1},m);break;case "stop":g.writeValue(e,h,k,{type:"double",value:2},m);break;case "close":g.writeValue(e,h,k,{type:"double",value:3},m);break;case "partialOpen":g.writeValue(e,h,k,{type:"double",value:4},m);break;default:m&&m(Error("no such command"))}else m&&
m(Error("can not find datapoint for command:"+q))}else m&&m(Error("command in null"))}},SIMPLE_SWITCH_RECEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"],command:["on","off","toggle"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){var k=null;switch(g){case "STATE":k=1==e?{state:"on"}:0==e?{state:"off"}:{state:"?"}}return k},executeCommand:function(g,e,h,q,m){var k=n.call(this,q);if(k)switch(q){case "on":g.writeValue(e,h,k,!0,m);break;case "off":g.writeValue(e,h,k,!1,m);
break;case "toggle":g.getState({interface:e,channel:h,datapoint:k},function(l,n){l?m&&m(l):n?(l=!0,n.value&&(l=!1),g.writeValue(e,h,k,l,m)):m&&m(Error("get switch current value return invalid"))});break;default:m&&m(Error("no such command"))}else m&&m(Error("can not find datapoint for command:"+q))}},MULTI_MODE_INPUT_TRANSMITTER:{map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,
e){var k=null;switch(g){case "STATE":k=1==e?{state:"on"}:0==e?{state:"off"}:{state:"?"};break;case "PRESS_SHORT":k={pressShort:!0};break;case "PRESS_LONG":k={pressLong:!0}}return k}},BRIGHTNESS_TRANSMITTER:{map:[{dpt:"AVERAGE_ILLUMINATION",state:["avgIllu"],event:["avgIllu"]},{dpt:"CURRENT_ILLUMINATION",state:["illu"],event:["illu"]},{dpt:"HIGHEST_ILLUMINATION",state:["maxIllu"],event:["maxIllu"]},{dpt:"LOWEST_ILLUMINATION",state:["minIllu"],event:["minIllu"]}],getReadableDpts:h,getDptFromState:e,
parseDptState:function(g,e){var k=null;switch(g){case "AVERAGE_ILLUMINATION":k={avgIllu:parseFloat(parseFloat(e).toFixed(2))};break;case "CURRENT_ILLUMINATION":k={illu:parseFloat(parseFloat(e).toFixed(2))};break;case "HIGHEST_ILLUMINATION":k={maxIllu:parseFloat(parseFloat(e).toFixed(2))};break;case "LOWEST_ILLUMINATION":k={minIllu:parseFloat(parseFloat(e).toFixed(2))}}return k}},POWER_MAINS_TRANSMITTER:{map:[{dpt:"POWER_MAINS_FAILURE",state:["powerMainsFailure"],event:["powerMainsFailure"]}],getReadableDpts:h,
getDptFromState:e,parseDptState:function(g,e){var k=null;switch(g){case "POWER_MAINS_FAILURE":k={powerMainsFailure:e}}return k}}},"BidCos-RF":{MAINTENANCE:{device:"maintenance",map:[{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]},{dpt:"UNREACH",state:["timeout"],event:["timeout"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){switch(g){case "LOWBAT":return{lowbat:e};case "UNREACH":return{timeout:e};default:return null}}},KEY:{device:"button",map:[{dpt:"PRESS_SHORT",event:["pressShort"],
command:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"],command:["pressLong"]},{dpt:"PRESS_LONG_RELEASE",event:["pressLongRel"]},{dpt:"PRESS_CONT",event:["pressCont"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){switch(g){case "PRESS_SHORT":return{pressShort:e};case "PRESS_LONG":return{pressLong:e};case "PRESS_CONT":return{pressCont:e};case "PRESS_LONG_RELEASE":return{pressLongRel:e};default:return null}},executeCommand:function(g,e,h,q,m){var k=n.call(this,q);switch(q){case "pressShort":g.writeValue(e,
h,k,!0,m);break;case "pressLong":g.writeValue(e,h,k,!0,m);break;default:m&&m(Error("no such command"))}}},SWITCH_INTERFACE:{device:"switch_interface",map:[{dpt:"PRESS",event:["press"],command:["press"]}],parseDptState:function(g,e){switch(g){case "PRESS":return{press:!0};default:return null}},executeCommand:function(g,e,h,q,m){var k=n.call(this,q);switch(q){case "press":g.writeValue(e,h,k,!0,m);break;default:m&&m(Error("no such command"))}}},SHUTTER_CONTACT:{device:"contact",map:[{dpt:"STATE",state:["state"],
event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){switch(g){case "STATE":return{state:e?"open":"closed"};case "ERROR":return{error:1==e?"sabotage":"no_error"};case "LOWBAT":return{lowbat:e};default:return null}}},JALOUSIE:{device:"jalousie",map:[{dpt:"LEVEL",state:["jalState"],event:["jalState"],command:["moveUp","moveDown","stepUp","stepDown","%d"]},{dpt:"STOP",command:["stop"]},
{dpt:"LEVEL_SLATS",state:["jalLmlState"],event:["jalLmlState"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo%d"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){var k=null;switch(g){case "LEVEL":e=Math.round(100*parseFloat(e));k={jalState:e};break;case "LEVEL_SLATS":e=Math.round(100*parseFloat(e)),k={jalLmlState:e}}return k},executeCommand:function(g,e,h,q,m){var k=n.call(this,q);switch(q){case "moveUp":g.writeValue(e,h,k,{type:"double",value:1},
m);break;case "moveDown":g.writeValue(e,h,k,{type:"double",value:0},m);break;case "stepUp":g.getState({interface:e,channel:h,datapoint:k},function(l,n){if(l)m&&m(l);else if(n){var p=n.value+.05;1<p&&(p=1);g.writeValue(e,h,k,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current jalousie state result invalid"))});break;case "stepDown":g.getState({interface:e,channel:h,datapoint:k},function(l,n){if(l)m&&m(l);else if(n){var p=
n.value-.05;0>p&&(p=0);g.writeValue(e,h,k,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current blind state result invalid"))});break;case "stop":g.writeValue(e,h,k,!0,m);break;case "lamellaUp":g.writeValue(e,h,k,{type:"double",value:1},m);break;case "lamellaDown":g.writeValue(e,h,k,{type:"double",value:0},m);break;case "lamellaStepUp":g.getState({interface:e,channel:h,datapoint:k},function(l,n){if(l)m&&m(l);else if(n){var p=
n.value+.05;1<p&&(p=1);g.writeValue(e,h,k,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current lamella state result invalid"))});break;case "lamellaStepDown":g.getState({interface:e,channel:h,datapoint:k},function(l,n){if(l)m&&m(l);else if(n){var p=n.value-.05;0>p&&(p=0);g.writeValue(e,h,k,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current lamella state result invalid"))});
break;default:if("lamellaTo"==q.substr(0,9)){q=q.substr(9);var l=parseInt(q);l/=100;k="LEVEL_SLATS";g.writeValue(e,h,k,{type:"double",value:l},function(n){n?m&&m(n):(g.updateStatusBuffer(e,h,k,l,(new Date).getTime()+1E3),m&&m())})}else"moveTo"==q.substr(0,6)||q.match(/^[-+]?[0-9]+$/)?("moveTo"==q.substr(0,6)&&(q=q.substr(6)),l=parseInt(q),l/=100,k="LEVEL",g.writeValue(e,h,k,{type:"double",value:l},function(n){n?m&&m(n):(g.updateStatusBuffer(e,h,k,l,(new Date).getTime()+1E3),m&&m())})):m&&m(Error("no such command"))}}},
MOD_EM8BIT_TRANSMITTER:{map:[{dpt:"STATE",state:["state8bit"],event:["state8bit"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){var k=null;switch(g){case "STATE":e=parseInt(e);k={state8bit:e};break;case "LOWBAT":k={lowbat:e}}return k}},KEYMATIC:{device:"keymatic",map:[{dpt:"STATE",state:["state"],event:["state"],command:["open","close"]},{dpt:"OPEN",command:["openDoor"]},{dpt:"STATE_UNCERTAIN",state:["uncertain"],event:["uncertain"]},
{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){switch(g){case "STATE":return{state:e?"open":"closed"};case "STATE_UNCERTAIN":return{uncertain:e};case "ERROR":switch(e){case 0:e="no_error";break;case 1:e="cluth_failure";break;case 2:e="motor_aborted"}return{error:e}}return null},executeCommand:function(g,e,h,q,m){var k=n.call(this,q);switch(q){case "open":g.writeValue(e,h,k,!0,m);break;case "close":g.writeValue(e,h,k,!1,m);break;case "openDoor":g.writeValue(e,
h,k,!0,m);break;default:m&&m(Error("no such command"))}}},MOTION_DETECTOR:{device:"motion",map:[{dpt:"BRIGHTNESS",state:["bri"],event:["bri"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){var h={};switch(g){case "BRIGHTNESS":h.bri=e;break;case "MOTION":h.state=e?"motion":"ok";break;case "ERROR":h.error=e?"sabotage":"no_error";break;default:return null}return h}},DUAL_WHITE_BRIGHTNESS:{device:"dualwhite",
map:[{dpt:"DIRECTION",state:["direction"],event:["direction"]},{dpt:"ERROR_OVERHEAT",state:["error_overheat"],event:["error_overheat"]},{dpt:"ERROR_REDUCED",state:["error_reduced"],event:["error_reduced"]},{dpt:"LEVEL",state:["bri"],event:["bri"],command:["off","dimUp","dimDown","toggle","dimTo%d"]},{dpt:"LEVEL_REAL",state:["bri_real"],event:["bri_real"]},{dpt:"OLD_LEVEL",command:["on"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){var h={};switch(g){case "DIRECTION":h.direction=
e;break;case "ERROR_OVERHEAT":h.error_overheat=e?!0:!1;break;case "ERROR_REDUCED":h.error_reduced=e?!0:!1;break;case "LEVEL":h.bri=Math.round(100*parseFloat(e));break;case "LEVEL_REAL":h.bri_real=Math.round(100*parseFloat(e));break;default:return null}return h},executeCommand:function(g,e,h,q,m){var k=n.call(this,q);switch(q){case "on":g.writeValue(e,h,k,!0,m);break;case "off":g.writeValue(e,h,k,{type:"double",value:0},m);break;case "dimUp":g.getState({interface:e,channel:h,datapoint:k},function(l,
n){if(l)m&&m(l);else if(n){var p=n.value+.05;1<p&&(p=1);g.writeValue(e,h,k,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current jalousie state result invalid"))});break;case "dimDown":g.getState({interface:e,channel:h,datapoint:k},function(l,n){if(l)m&&m(l);else if(n){var p=n.value-.05;0>p&&(p=0);g.writeValue(e,h,k,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(e,h,k,p,(new Date).getTime()+
1E3),m&&m())})}else m&&m(Error("get current blind state result invalid"))});break;case "toggle":k="LEVEL";g.getState({interface:e,channel:h,datapoint:k},function(l,n){l?m&&m(l):n?0!=n.value?g.writeValue(e,h,k,{type:"double",value:0},m):g.writeValue(e,h,"OLD_LEVEL",!0,m):m&&m(Error("get current dimmer state result invalid"))});break;default:if("dimTo"==q.substr(0,5)){q=q.substr(5);var l=parseInt(q);l/=100;k="LEVEL";g.writeValue(e,h,k,{type:"double",value:l},function(n){n?m&&m(n):(g.updateStatusBuffer(e,
h,k,l,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("no such command"))}}},DUAL_WHITE_COLOR:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["color_direction"],event:["color_direction"]},{dpt:"LEVEL",state:["color"],event:["color"],command:["colorOff","colorUp","colorDown","colorToggle","colorTo%d"]},{dpt:"LEVEL_REAL",state:["color_real"],event:["color_real"]},{dpt:"OLD_LEVEL",command:["colorOn"]}],getReadableDpts:h,getDptFromState:e,parseDptState:function(g,e){var h={};switch(g){case "DIRECTION":h.direction=
e;break;case "LEVEL":h.color=Math.round(100*parseFloat(e));break;case "LEVEL_REAL":h.color_real=Math.round(100*parseFloat(e));break;default:return null}return h},executeCommand:function(g,e,h,q,m){var k=n.call(this,q);switch(q){case "colorOn":g.writeValue(e,h,k,!0,m);break;case "colorOff":g.writeValue(e,h,k,{type:"double",value:0},m);break;case "colorUp":g.getState({interface:e,channel:h,datapoint:k},function(l,n){if(l)m&&m(l);else if(n){var p=n.value+.05;1<p&&(p=1);g.writeValue(e,h,k,{type:"double",
value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current jalousie state result invalid"))});break;case "colorDown":g.getState({interface:e,channel:h,datapoint:k},function(l,n){if(l)m&&m(l);else if(n){var p=n.value-.05;0>p&&(p=0);g.writeValue(e,h,k,{type:"double",value:p},function(l){l?m&&m(l):(g.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("get current blind state result invalid"))});break;case "colorToggle":k=
"LEVEL";g.getState({interface:e,channel:h,datapoint:k},function(l,n){l?m&&m(l):n?0!=n.value?g.writeValue(e,h,k,{type:"double",value:0},m):g.writeValue(e,h,"OLD_LEVEL",!0,m):m&&m(Error("get current dimmer state result invalid"))});break;default:if("colorTo"==q.substr(0,7)){q=q.substr(7);var l=parseInt(q);l/=100;k="LEVEL";g.writeValue(e,h,k,{type:"double",value:l},function(n){n?m&&m(n):(g.updateStatusBuffer(e,h,k,l,(new Date).getTime()+1E3),m&&m())})}else m&&m(Error("no such command"))}}}}}}();
x.hub.m.hm._Device=function(){var h=function(f,a,b){this.deviceType=f;this.deviceIF=a;this.deviceAdr=b;this.legacyType=null};h.prototype.initStates=function(f,a){var b=this._getReadableDpts();this._initDptStates(f,b,a)};h.prototype._getReadableDpts=function(){return[]};h.prototype._getDptFromRef=function(f){return null};h.prototype._initDptStates=function(f,a,b){if(a&&0!=a.length){var c=0,g=this,e=function(h,k){c++;c==a.length?b&&b():f.readValue(g.deviceIF,a[c].channel,a[c].dpt,e)};f.readValue(this.deviceIF,
a[c].channel,a[c].dpt,e)}else b&&b()};h.prototype.parseDptState=function(f,a,b){return null};h.prototype.toLegacyAdr=function(){return this.deviceType+"."+this.deviceIF+"."+this.deviceAdr};h.prototype.toLegacyType=function(){return this.legacyType};h.prototype.getSerial=function(){var f=this.deviceAdr,a=this.deviceAdr.indexOf(":");-1!=a&&(f=f.substr(0,a));return f};h.prototype.parseChnState=function(f,a){var b={},c;for(c in a){var g=this.parseDptState(f,c,a[c].value);if(g){var e={},h=a[c].time,k;
for(k in g)e[k]={value:g[k],time:h};b=x.hub.m.hm._Util.mergeObj(b,e)}}return b};h.prototype.parseStates=function(f){var a={},b;for(b in f){var c=this.parseChnState(b,f[b]);c&&(a=x.hub.m.hm._Util.mergeObj(a,c))}return a};h.prototype.executeCommand=function(f,a,b){b&&b()};h.prototype.getState=function(f,a,b){switch(a){case "timeout":var c={channel:0,dataPoint:"UNREACH"};break;default:c=this._getDptFromRef(a)}if(c){var g=this;f.getState({interface:this.deviceIF,channel:c.channel,datapoint:c.dataPoint},
function(f,e){f?b&&b(f):e?(f=g.parseDptState(c.channel,c.dataPoint,e.value))?b&&b(null,{value:f[a],time:e.time}):b&&b(null,null):b&&b(null,null)})}else b&&b(Error("no such state"))};h.prototype.isButton=function(){return!1};var e=function(f,a,b){h.call(this,f,a,b);this.channel=0;this.legacyType="maintenance"};util.inherits(e,h);e.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"].MAINTENANCE.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+
":0",dpt:b})});return f};e.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};e.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||f!=this.channel)return null;
c={};"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b;return c};var n=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="button"};util.inherits(n,h);n.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};n.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=
0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};n.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "PRESS_SHORT":return{pressShort:b};
case "PRESS_LONG":return{pressLong:b};case "PRESS_CONT":return{pressCont:b};case "PRESS_LONG_RELEASE":return{pressLongRel:b};default:return null}};n.prototype.isButton=function(){return!0};n.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(g,e){g&&console.error("button claim PRESS_SHORT event error:"+g.stack);f.reportValueUsage(c.deviceIF,b,"PRESS_LONG",function(b,c){b&&
console.error("button claim PRESS_LONG event error:"+b.stack);a&&a()})})};var g=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="button"};util.inherits(g,h);g.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};g.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint=
"LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};g.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "PRESS_SHORT":return{pressShort:b};case "PRESS_LONG":return{pressLong:b};
case "PRESS_CONT":return{pressCont:b};case "PRESS_LONG_RELEASE":return{pressLongRel:b};default:return null}};g.prototype.isButton=function(){return!1};g.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(g,e){g&&console.error("button claim PRESS_SHORT event error:"+g.stack);f.reportValueUsage(c.deviceIF,b,"PRESS_LONG",function(b,c){b&&console.error("button claim PRESS_LONG event error:"+
b.stack);a&&a()})})};var k=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="switch"};util.inherits(k,h);k.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"}]};k.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&
this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};k.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var g=this;switch(a){case "on":var e="STATE";
f.writeValue(this.deviceIF,c,e,!0,b);break;case "off":e="STATE";f.writeValue(this.deviceIF,c,e,!1,b);break;case "toggle":e="STATE";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,h){a?b&&b(a):h?(a=!0,h.value&&(a=!1),f.writeValue(g.deviceIF,c,e,a,b)):b&&b(Error("get switch current value return invalid"))});break;default:"onFor"==a.substr(0,5)?(a=parseFloat(a.substr(5)),isNaN(a)?b&&b(Error("onFor command invalid")):(e="ON_TIME",f.writeValue(this.deviceIF,c,e,{type:"double",value:a},
function(a){a?b&&b(a):(e="STATE",f.writeValue(g.deviceIF,c,e,!0,b))}))):b&&b(Error("no such command"))}};k.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;var h;switch(a){case "STATE":return 1==b?h="on":
0==b&&(h="off"),{state:h};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};default:return null}};k.prototype.getConfig=function(f,a){var b=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var e={},g=null;f&&(g={AES_ACTIVE:f.AES_ACTIVE});e[b]=g;a&&a(c,e)}})};k.prototype.setConfig=function(f,a,b){if(a){var c=this.deviceAdr+":"+this.channel;if(a=a[c]){var e={};e.AES_ACTIVE=a.AES_ACTIVE;f.setParamset(this.deviceIF,c,"MASTER",e,function(c){b&&
b(c)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var l=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="dimmer"};util.inherits(l,h);l.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"}]};l.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "levelReal":a.dataPoint="LEVEL_REAL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};l.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.channel,e=this,g=null;switch(a){case "on":var h="OLD_LEVEL";f.writeValue(this.deviceIF,c,h,!0,b);break;case "off":h="LEVEL";f.writeValue(this.deviceIF,
c,h,{type:"double",value:0},b);break;case "dimUp":h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,g){a?b&&b(a):g?(a=g.value+.05,1<a&&(a=1),f.writeValue(e.deviceIF,c,h,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;case "dimDown":h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,g){a?b&&b(a):g?(a=g.value-.05,0>a&&(a=0),f.writeValue(e.deviceIF,c,h,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});
break;case "toggle":h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,g){a?b&&b(a):g?0!=g.value?f.writeValue(e.deviceIF,c,h,{type:"double",value:0},b):f.writeValue(e.deviceIF,c,"OLD_LEVEL",!0,b):b&&b(Error("get current dimmer state result invalid"))});break;default:"toggleTo"==a.substr(0,8)?(g=parseInt(a.substr(8)),isNaN(g)?b&&b(Error("toggleTo command invalid")):(h="LEVEL",g/=100,f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,k){a?b&&b(a):k?(a=
g,k.value&&(a=0),f.writeValue(e.deviceIF,c,h,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))}))):"onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)?("onTo"==a.substr(0,4)&&(a=a.substr(4)),g=parseInt(a),g/=100,h="LEVEL",f.writeValue(this.deviceIF,c,h,{type:"double",value:g},b)):b&&b(Error("no such command"))}};l.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var g=f.substr(0,c);f=f.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");
-1!=c&&(e=this.deviceAdr.substr(0,c));if(g!=e||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(b)),{state:a};case "LEVEL_REAL":return a=Math.round(100*parseFloat(b)),{levelReal:a};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};case "DIRECTION":return{direction:b};default:return null}};var q=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="blind"};
util.inherits(q,h);q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"DIRECTION"}]};q.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};q.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.channel,g=this,e=0;"stepUpFor"==a.substr(0,9)?((e=a.substr(9))||(e=1),e=parseFloat(e),a="stepUpFor"):"stepUp"==a.substr(0,6)?((e=a.substr(6))||(e=5),e=parseInt(e)/100,a="stepUp"):"stepDownFor"==a.substr(0,
11)?((e=a.substr(11))||(e=1),e=parseFloat(e),a="stepDownFor"):"stepDown"==a.substr(0,8)&&((e=a.substr(8))||(e=5),e=parseInt(e)/100,a="stepDown");switch(a){case "stepUp":var h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,k){if(a)b&&b(a);else if(k){e||(e=.05);var y=k.value+e;1<y&&(y=1);f.writeValue(g.deviceIF,c,h,{type:"double",value:y},function(a){a?b&&b(a):(f.updateStatusBuffer(g.deviceIF,c,h,y,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("get current blind state result invalid"))});
break;case "stepDown":h="LEVEL";f.getState({interface:this.deviceIF,channel:c,datapoint:h},function(a,k){if(a)b&&b(a);else if(k){e||(e=.05);var y=k.value-e;0>y&&(y=0);f.writeValue(g.deviceIF,c,h,{type:"double",value:y},function(a){a?b&&b(a):(f.updateStatusBuffer(g.deviceIF,c,h,y,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("get current blind state result invalid"))});break;case "stepUpFor":h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:1},function(a){a?b&&b(a):setTimeout(function(){h=
"STOP";f.writeValue(g.deviceIF,c,h,!0,b)},1E3*e)});break;case "stepDownFor":h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:0},function(a){a?b&&b(a):setTimeout(function(){h="STOP";f.writeValue(g.deviceIF,c,h,!0,b)},1E3*e)});break;case "up":h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:1},b);break;case "down":h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:0},b);break;case "stop":h="STOP";f.writeValue(this.deviceIF,c,h,!0,b);break;default:if("moveTo"==a.substr(0,
6)||a.match(/^[-+]?[0-9]+$/)){"moveTo"==a.substr(0,6)&&(a=a.substr(6));var k=parseInt(a);k/=100;h="LEVEL";f.writeValue(this.deviceIF,c,h,{type:"double",value:k},function(a){a?b&&b(a):(f.updateStatusBuffer(g.deviceIF,c,h,k,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("no such command"))}};q.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,
c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(b)),{state:a};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};case "DIRECTION":return{direction:b};default:return null}};q.prototype.getConfig=function(f,a){var b=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var e={},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,
REFERENCE_RUNNING_TIME_BOTTOM_TOP:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP,REFERENCE_RUNNING_TIME_TOP_BOTTOM:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});e[b]=g;a&&a(c,e)}})};q.prototype.setConfig=function(f,a,b){if(a){var c=this.deviceAdr+":"+this.channel;if(a=a[c]){var e={};e.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM=
{__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM};e.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;f.setParamset(this.deviceIF,c,"MASTER",e,function(c){b&&b(c)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var m=function(f,a,b){k.call(this,f,a,b);this.legacyType="powerswitch";this.powChannel=2};util.inherits(m,k);m.prototype._getReadableDpts=function(){var f=k.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.powChannel,
dpt:"BOOT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"ENERGY_COUNTER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"POWER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"CURRENT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"VOLTAGE"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"FREQUENCY"});return f};m.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";
break;case "state":a.channel+=":1";a.dataPoint="STATE";break;case "inhibit":a.channel+=":1";a.dataPoint="INHIBIT";break;case "working":a.channel+=":1";a.dataPoint="WORKING";break;case "boot":a.channel+=":2";a.dataPoint="BOOT";break;case "energy_counter":a.channel+=":2";a.dataPoint="ENERGY_COUNTER";break;case "power":a.channel+=":2";a.dataPoint="POWER";break;case "current":a.channel+=":2";a.dataPoint="CURRENT";break;case "voltage":a.channel+=":2";a.dataPoint="VOLTAGE";break;case "frequency":a.channel+=
":2";a.dataPoint="FREQUENCY";break;default:return null}return a};m.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);c=f.substr(c+1);return e!=this.deviceAdr?null:0==c?(f={},"UNREACH"==a?f.timeout=b:f["0_"+a.toLowerCase()]=b,f):"1"==c?k.prototype.parseDptState.call(this,f,a,b):"2"==c?(f={},f[a.toLowerCase()]=b,f):null};m.prototype.getConfig=function(f,a){var b=this,c=null;k.prototype.getConfig.call(this,f,function(e,g){e?a&&a(e):(c=g,b._getCh2Config(f,
function(b,f){if(b)a&&a(b);else{for(var e in f)f.hasOwnProperty(e)&&(c[e]=f[e]);a&&a(null,c)}}))})};m.prototype.setConfig=function(f,a,b){if(a){var c=Object.keys(a);if(c&&0!=c.length){var e=this;async.eachSeries(c,function(b,c){var g=b.indexOf(":");-1==g&&c(Error("channel address is null"));g=b.substr(g+1);1==g?k.prototype.setConfig.call(e,f,a,c):2==g?e._setCh2Config(f,a[b],c):c(Error("unknow channel:"+g))},function(c){b&&b(c)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};
m.prototype._getCh2Config=function(f,a){var b=this.deviceAdr+":2";f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var e={},g=null;f&&(g={AES_ACTIVE:f.AES_ACTIVE});e[b]=g;a&&a(c,e)}})};m.prototype._setCh2Config=function(f,a,b){if(a){var c=this.deviceAdr+":2",e={};e.AES_ACTIVE=a.AES_ACTIVE;f.setParamset(this.deviceIF,c,"MASTER",e,function(c){b&&b(c)})}else b&&b(Error("config data invalid"))};var r=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="weather"};util.inherits(r,
h);r.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"}]};r.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";
break;case "hum":a.dataPoint="HUMIDITY";break;default:return null}return a};r.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "TEMPERATURE":return a=parseFloat(b),{temp:a};case "HUMIDITY":return a=
parseInt(b),{hum:a};default:return null}};var p=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="weather2"};util.inherits(p,r);p.prototype._getReadableDpts=function(){var f=r.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.channel,dpt:"AIR_PRESSURE"});return f};p.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "air":a.dataPoint="AIR_PRESSURE";break;default:return r.prototype._getDptFromRef.call(this,
f)}return a};p.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c),g=f.substr(c+1),h=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(h=this.deviceAdr.substr(0,c));if(e!=h||0!=g&&g!=this.channel)return null;if(0==g)return f={},"UNREACH"==a?f.timeout=b:"LOWBAT"==a?f.lowbat=b:f["0_"+a.toLowerCase()]=b,f;f=r.prototype.parseDptState.call(this,f,a,b);switch(a){case "AIR_PRESSURE":f||(f={}),f.air=parseInt(b)}return f};var v=function(f,a,b){h.call(this,
f,a,b);this.channel=1;this.legacyType="weatherstation"};util.inherits(v,h);v.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAINING"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAIN_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_SPEED"},
{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION_RANGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"SUNSHINEDURATION"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"}]};v.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint=
"TEMPERATURE";break;case "hum":a.dataPoint="HUMIDITY";break;case "rain":a.dataPoint="RAINING";break;case "rainC":a.dataPoint="RAIN_COUNTER";break;case "windS":a.dataPoint="WIND_SPEED";break;case "windD":a.dataPoint="WIND_DIRECTION";break;case "windDR":a.dataPoint="WIND_DIRECTION_RANGE";break;case "sunD":a.dataPoint="SUNSHINEDURATION";break;case "bri":a.dataPoint="BRIGHTNESS";break;default:return null}return a};v.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=
f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "TEMPERATURE":c.temp=parseFloat(b);break;case "HUMIDITY":c.hum=parseInt(b);break;case "RAINING":c.rain=b;break;case "RAIN_COUNTER":c.rainC=parseFloat(b);break;case "WIND_SPEED":c.windS=parseFloat(b);break;case "WIND_DIRECTION":c.windD=
b;break;case "WIND_DIRECTION_RANGE":c.windDR=b;break;case "SUNSHINEDURATION":c.sunD=b;break;case "BRIGHTNESS":c.bri=b;break;default:return null}return c};var w=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="heater"};util.inherits(w,h);w.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"VALVE_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"});return f};w.prototype._getDptFromRef=
function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "error":a.dataPoint="ERROR";break;case "state":a.dataPoint="VALVE_STATE";break;default:return null}return a};w.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c={};if(0==f)return"UNREACH"==
a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(f==this.channel){switch(a){case "ERROR":switch(b){case 0:c.error="no_error";break;case 1:c.error="VALVE_DRIVE_BLOCKED";break;case 2:c.error="VALVE_DRIVE_LOOSE";break;case 3:c.error="ADJUSTING_RANGE_TO_SMALL";break;case 4:c.error="lowbat"}break;case "VALVE_STATE":c.state=b}return c}return null};var u=function(f,a,b){h.call(this,f,a,b);this.channel=4;this.legacyType="thermostat"};util.inherits(u,h);u.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"FAULT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"SET_TEMPERATURE"});return f};u.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(f){case "mode":a.dataPoint="CONTROL_MODE";break;case "error":a.dataPoint="FAULT_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "valveLvl":a.dataPoint="VALVE_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";break;case "act_temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};u.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.channel,e=this;switch(a){case "setAuto":var g=
"AUTO_MODE";f.writeValue(this.deviceIF,c,g,!0,function(a){a||f.updateStatusBuffer(e.deviceIF,c,"CONTROL_MODE",0);b&&b(a)});break;case "setManu":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,h){a?b&&b(a):(g="MANU_MODE",f.writeValue(e.deviceIF,c,g,{type:"double",value:h.value},function(a){a||f.updateStatusBuffer(e.deviceIF,c,"CONTROL_MODE",1);b&&b(a)}))});break;case "setBoost":g="BOOST_MODE";f.writeValue(this.deviceIF,c,g,!0,function(a){a||f.updateStatusBuffer(e.deviceIF,
c,"CONTROL_MODE",3);b&&b(a)});break;case "tempUp":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,h){a?b&&b(a):h?(a=h.value+.5,30.5<a&&(a=30.5),f.writeValue(e.deviceIF,c,g,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,h){a?b&&b(a):h?(a=h.value-.5,4.5>a&&(a=4.5),f.writeValue(e.deviceIF,c,g,{type:"double",value:a},
b)):b&&b(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),g="SET_TEMPERATURE",f.writeValue(this.deviceIF,c,g,{type:"double",value:a},b)):b&&b(Error("no such command"))}};u.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,
c));if(e!=g)return null;c={};if(0==f)return c["0_"+a.toLowerCase()]=b,c;if(f==this.channel){switch(a){case "CONTROL_MODE":switch(b){case 0:c.mode="auto";break;case 1:c.mode="manu";break;case 2:c.mode="party";break;case 3:c.mode="boost"}break;case "FAULT_REPORTING":switch(b){case 0:c.error="no_error";break;case 1:c.error="valve_tight";break;case 2:c.error="ADJUSTING_RANGE_TOO_LARGE";break;case 3:c.error="ADJUSTING_RANGE_TOO_SMALL";break;case 4:c.error="comm_error";break;case 5:c.error="";break;case 6:c.error=
"lowbat";break;case 7:c.error="VALVE_ERROR_POSITION"}break;case "BATTERY_STATE":c.batLvl=b;break;case "VALVE_STATE":c.valveLvl=b;break;case "BOOST_STATE":c.boostTime=b;break;case "ACTUAL_TEMPERATURE":c.act_temp=b;break;case "SET_TEMPERATURE":c.state=b;break;default:return null}return c}return null};var na=function(f,a,b){h.call(this,f,a,b);this.channel=4;this.legacyType="thermostat"};util.inherits(na,u);na.prototype._getReadableDpts=function(){var f=u.prototype._getReadableDpts.callback(this);f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"WINDOW_STATE"});return f};na.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "window":a.dataPoint="WINDOW_STATE";break;default:return u.prototype._getDptFromRef.call(this,f)}return a};na.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c),g=f.substr(c+1),h=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(h=this.deviceAdr.substr(0,c));if(e!=h)return null;c=
{};if(0==g)return c["0_"+a.toLowerCase()]=b,c;if(g==this.channel)switch(a){case "WINDOW_STATE":return c.window=b?"closed":"open",c;default:return u.prototype.parseDptState.call(this,f,a,b)}else return null};var R=function(f,a,b){h.call(this,f,a,b);this.weatherChannel=1;this.thermoChannel=2;this.legacyType="wallthermo"};util.inherits(R,h);R.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":0",dpt:"LOWBAT"});f.push({channel:this.deviceAdr+
":"+this.weatherChannel,dpt:"TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"HUMIDITY"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SETPOINT"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_COMMAND"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_DATA"});return f};R.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";
break;case "lowbat":b.channel=a+":0";b.dataPoint="LOWBAT";break;case "temp":b.channel=a+":1";b.dataPoint="TEMPERATURE";break;case "hum":b.channel=a+":1";b.dataPoint="HUMIDITY";break;case "state":b.channel=a+":2";b.dataPoint="SETPOINT";break;case "adjusting_command":b.channel=a+":2";b.dataPoint="ADJUSTING_COMMAND";break;case "adjusting_data":b.channel=a+":2";b.dataPoint="ADJUSTING_DATA";break;default:return null}return b};R.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.thermoChannel;
switch(a){case "tempUp":var e="SETPOINT";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,g){a?b&&b(a):g?(a=g.value+.5,30<a&&(a=30),f.writeValue(self.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":e="SETPOINT";f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,g){a?b&&b(a):g?(a=g.value-.5,6>a&&(a=6),f.writeValue(self.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});
break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),e="SETPOINT",f.writeValue(this.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("no such command"))}};R.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);if(e!=this.deviceAdr)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=b:"LOWBAT"==a?e.lowbat=b:e["0_"+a.toLowerCase()]=b,e;if("1"==f){switch(a){case "TEMPERATURE":e.temp=
b;break;case "HUMIDITY":e.hum=b}return e}if("2"==f){switch(a){case "SETPOINT":e.state=b;break;case "ADJUSTING_COMMAND":e.adjusting_command=b;break;case "ADJUSTING_DATA":e.adjusting_data=b}return e}return null};var S=function(f,a,b){h.call(this,f,a,b);this.thermoChannel=2;this.legacyType="wallthermostat"};util.inherits(S,h);S.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,
dpt:"LOWBAT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"COMMUNICATION_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"WINDOW_OPEN_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_HUMIDITY"});
f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SET_TEMPERATURE"});return f};S.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.thermoChannel,dataPoint:null};switch(f){case "mode":a.dataPoint="CONTROL_MODE";break;case "lowbat":a.dataPoint="LOWBAT_REPORTING";break;case "comm":a.dataPoint="COMMUNICATION_REPORTING";break;case "window":a.dataPoint="WINDOW_OPEN_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";
break;case "temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "hum":a.dataPoint="ACTUAL_HUMIDITY";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};S.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.thermoChannel,e=this;switch(a){case "setAuto":var g="AUTO_MODE";f.writeValue(this.deviceIF,c,g,!0,function(a){a||f.updateStatusBuffer(e.deviceIF,c,"CONTROL_MODE",0);b&&b(a)});break;case "setManu":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,
channel:c,datapoint:g},function(a,h){a?b&&b(a):(g="MANU_MODE",f.writeValue(e.deviceIF,c,g,{type:"double",value:h.value},function(a){a||f.updateStatusBuffer(e.deviceIF,c,"CONTROL_MODE",1);b&&b(a)}))});break;case "setBoost":g="BOOST_MODE";f.writeValue(this.deviceIF,c,g,!0,function(a){a||f.updateStatusBuffer(e.deviceIF,c,"CONTROL_MODE",3);b&&b(a)});break;case "tempUp":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,h){a?b&&b(a):h?(a=h.value+.5,30.5<a&&(a=30.5),
f.writeValue(e.deviceIF,c,g,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,h){a?b&&b(a):h?(a=h.value-.5,4.5>a&&(a=4.5),f.writeValue(e.deviceIF,c,g,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),
g="SET_TEMPERATURE",f.writeValue(this.deviceIF,c,g,{type:"double",value:a},b)):"setWeekProfile"==a.substr(0,14)?(a=parseInt(a.substr(14)),f.setParamset(this.deviceIF,this.deviceAdr,"MASTER",{WEEK_PROGRAM_POINTER:a-1},function(a){b&&b(a)})):b&&b(Error("no such command"))}};S.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);if(e!=this.deviceAdr)return null;e={};if(0==f)return e["0_"+a.toLowerCase()]=b,e;if("2"==f){switch(a){case "CONTROL_MODE":switch(b){case 0:e.mode=
"auto";break;case 1:e.mode="manu";break;case 2:e.mode="party";break;case 3:e.mode="boost"}break;case "LOWBAT_REPORTING":e.lowbat=b;break;case "COMMUNICATION_REPORTING":e.comm=b;break;case "WINDOW_OPEN_REPORTING":e.window=b;break;case "BATTERY_STATE":e.batLvl=b;break;case "BOOST_STATE":e.boostTime=b;break;case "ACTUAL_TEMPERATURE":e.temp=b;break;case "ACTUAL_HUMIDITY":e.hum=b;break;case "SET_TEMPERATURE":e.state=b}return e}return null};var oa=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType=
"contact"};util.inherits(oa,h);oa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};oa.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint=
"STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};oa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":return{state:b?"open":"closed"};
case "ERROR":return{error:1==b?"sabotage":"no_error"};case "LOWBAT":return{lowbat:b};default:return null}};var T=function(f,a,b){h.call(this,f,a,b);this.rainChannel=1;this.heatChannel=2;this.legacyType="rain"};util.inherits(T,h);T.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.rainChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+
":"+this.heatChannel,dpt:"WORKING"}]};T.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "rain":b.channel=a+":"+this.rainChannel;b.dataPoint="STATE";break;case "heat":b.channel=a+":"+this.heatChannel;b.dataPoint="STATE";break;case "inhibit":b.channel=a+":"+this.heatChannel;b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.heatChannel;b.dataPoint="WORKING";break;default:return null}return b};
T.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.heatChannel&&(c+=":"+this.heatChannel);var e=this;switch(a){case "heaterOn":var g="STATE";f.writeValue(this.deviceIF,c,g,!0,b);break;case "heaterOff":g="STATE";f.writeValue(this.deviceIF,c,g,!1,b);break;case "heaterToggle":g="STATE";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,h){a?b&&b(a):h?(a=!0,h.value&&(a=!1),f.writeValue(e.deviceIF,c,g,a,b)):b&&b(Error("get switch current value return invalid"))});
break;default:b&&b(Error("no such command"))}};T.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(1==f){switch(a){case "STATE":c.rain=1==b?"rain":"dry";break;default:return null}return c}if(2==f){switch(a){case "STATE":c.heat=b?"on":"off";break;case "INHIBIT":c.inhibit=
b;break;case "WORKING":c.working=b;break;default:return null}return c}};var B=function(f,a,b){h.call(this,f,a,b);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong2"};util.inherits(B,h);B.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.chimeChannel,
dpt:"STATE"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"WORKING"}]};B.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "led":b.channel=a+":"+this.ledChannel;b.dataPoint="STATE";break;case "led_inhibit":b.channel=a+":"+this.ledChannel;b.dataPoint="INHIBIT";break;case "led_working":b.channel=a+":"+this.ledChannel;b.dataPoint=
"WORKING";break;case "chime":b.channel=a+":"+this.chimeChannel;b.dataPoint="STATE";break;case "chime_inhibit":b.channel=a+":"+this.chimeChannel;b.dataPoint="INHIBIT";break;case "chime_working":b.channel=a+":"+this.chimeChannel;b.dataPoint="WORKING";break;default:return null}return b};B.prototype.executeCommand=function(f,a,b){switch(a){case "ledOn":a=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,a,"STATE",!0,b);break;case "ledOff":a=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,
a,"STATE",!1,b);break;case "chimeOn":a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"STATE",!0,b);break;case "chimeOff":a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"STATE",!1,b);break;default:b&&b(Error("no such command"))}};B.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=
{};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(1==f){switch(a){case "STATE":c.led=b?"on":"off";break;case "INHIBIT":c.led_inhibit=b;break;case "WORKING":c.led_working=b;break;default:return null}return c}if(2==f){switch(a){case "STATE":c.chime=b?"on":"off";break;case "INHIBIT":c.chime_inhibit=b;break;case "WORKING":c.chime_working=b;break;default:return null}return c}};var Ma=function(f,a,b){h.call(this,f,a,b);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong"};
util.inherits(Ma,B);Ma.prototype.executeCommand=function(f,a,b){if(0==a.indexOf("vChannel")){var c=a.substr(8);c=parseInt(c);a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"SUBMIT","0.8,1,5,"+c,b)}else if(0==a.indexOf("setChime")){var e=a.substr(8);parseInt(c);a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"SUBMIT",e,b)}else 0==a.indexOf("ledGreen")?((c=a.substr(8))||(c=10),a=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+
c+",34",b)):0==a.indexOf("ledRed")?((c=a.substr(6))||(c=10),a=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+c+",18",b)):B.prototype.executeCommand.call(this,f,a,b)};var pa=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="window"};util.inherits(pa,h);pa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"},
{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};pa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};pa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=
this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":switch(b){case 0:c.state="closed";break;case 1:c.state="tilted";break;case 2:c.state="open"}break;case "ERROR":switch(b){case 0:c.error="no_error";break;case 1:case 7:c.error="sabotage"}break;case "LOWBAT":c.lowbat=b;break;default:return null}return c};var qa=function(f,a,b){h.call(this,f,a,b);this.channel=
1;this.legacyType="temp"};util.inherits(qa,h);qa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"}]};qa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";
break;default:return null}return a};qa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "TEMPERATURE":return{temp:parseFloat(b)};default:return null}};var ra=function(f,a,b){h.call(this,f,a,
b);this.temp1=1;this.temp2=2;this.tempDiff12=3;this.tempDiff21=4;this.legacyType="temp2"};util.inherits(ra,h);ra.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.temp1,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.temp1,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.temp2,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff12,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff21,dpt:"TEMPERATURE"}]};ra.prototype._getDptFromRef=
function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "lowbat":a.channel=this.temp1;a.dataPoint="LOWBAT";break;case "temp1":a.channel=this.temp1;a.dataPoint="TEMPERATURE";break;case "temp2":a.channel=this.temp2;a.dataPoint="TEMPERATURE";break;case "tempDiff12":a.channel=this.tempDiff12;a.dataPoint="TEMPERATURE";break;case "tempDiff21":a.channel=this.tempDiff21;a.dataPoint="TEMPERATURE";break;default:return null}return a};
ra.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LOWBAT":return{lowbat:b};case "TEMPERATURE":return 1==f?{temp1:parseFloat(b)}:2==f?{temp2:parseFloat(b)}:3==f?{tempDiff12:parseFloat(b)}:4==f?{tempDiff21:parseFloat(b)}:null;default:return null}};
var sa=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="co2"};util.inherits(sa,h);sa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};sa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};sa.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":switch(b){case 0:c.state="normal";break;case 1:c.state="medium";break;case 2:c.state="high"}break;default:return null}return c};var ta=function(f,a,b){h.call(this,f,a,b);this.channel=
1;this.legacyType="motion"};util.inherits(ta,h);ta.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"},{channel:this.deviceAdr+":"+this.channel,dpt:"MOTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};ta.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint=
"LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "bri":a.dataPoint="BRIGHTNESS";break;case "state":a.dataPoint="MOTION";break;case "error":a.dataPoint="ERROR";break;default:return null}return a};ta.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==
a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "BRIGHTNESS":c.bri=b;break;case "MOTION":c.state=b?"motion":"ok";break;case "ERROR":c.error=b?"sabotage":"no_error";break;default:return null}return c};var ua=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="smoke"};util.inherits(ua,h);ua.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,
dpt:"STATE"}]};ua.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};ua.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,
c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":c.state=b?"smoke":"ok";break;default:return null}return c};var U=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="siren"};util.inherits(U,h);U.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,
dpt:"ERROR_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_BATTERY"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};U.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint=
"STATE";break;case "error_power":a.dataPoint="ERROR_POWER";break;case "error_sabotage":a.dataPoint="ERROR_SABOTAGE";break;case "error_battery":a.dataPoint="ERROR_BATTERY";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};U.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr+":"+this.channel,e=this;switch(a){case "on":var g="STATE";f.writeValue(this.deviceIF,c,g,!0,b);break;case "off":g="STATE";f.writeValue(this.deviceIF,
c,g,!1,b);break;case "toggle":g="STATE";f.getState({interface:this.deviceIF,channel:c,datapoint:g},function(a,h){a?b&&b(a):(a=!0,h.value&&(a=!1),f.writeValue(e.deviceIF,c,g,a,b))});break;default:b&&b(Error("no such command"))}};U.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==
a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":c.state=b?"on":"off";break;case "ERROR_POWER":c.error_power=b?"power_failure":"no_error";break;case "ERROR_SABOTAGE":c.error_sabotage=b?"sabotage":"no_error";break;case "ERROR_BATTERY":c.error_battery=b?"battery_defect":"no_error";break;case "INHIBIT":c.inhibit=b;break;case "WORKING":c.working=b;break;default:return null}return c};var va=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="capacity"};util.inherits(va,h);
va.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"FILLING_LEVEL"}]};va.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="FILLING_LEVEL";break;default:return null}return a};va.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "FILLING_LEVEL":c.state=b;break;default:return null}return c};var L=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="switch_interface"};util.inherits(L,
h);L.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};L.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};L.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==
c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "PRESS":return{press:b};default:return null}};L.prototype.isButton=function(){return!0};L.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);f.reportValueUsage(this.deviceIF,
b,"PRESS",function(b,f){b&&console.error("switch interface claim PRESS event error:"+b.stack);a&&a()})};var wa=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="tilt"};util.inherits(wa,h);wa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};wa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};wa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":c.state=
b?"open":"closed";break;case "LOWBAT":c.lowbat=b;break;default:return null}return c};var xa=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="water"};util.inherits(xa,h);xa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};xa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};xa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":switch(b){case 0:c.state=
"ok";break;case 1:c.state="moist";break;case 2:c.state="water"}break;case "LOWBAT":c.lowbat=b;break;default:return null}return c};var ya=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="energymeter"};util.inherits(ya,h);ya.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BOOT"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_ENERGY_COUNTER"},{channel:this.deviceAdr+
":"+this.channel,dpt:"GAS_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"POWER"}]};ya.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "boot":a.dataPoint="BOOT";break;case "gas_energy":a.dataPoint="GAS_ENERGY_COUNTER";break;case "gas_power":a.dataPoint="GAS_POWER";
break;case "energy":a.dataPoint="ENERGY_COUNTER";break;case "power":a.dataPoint="POWER";break;default:return null}return a};ya.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "BOOT":c.boot=
b;break;case "GAS_ENERGY_COUNTER":c.gas_energy=b;break;case "GAS_POWER":c.gas_power=b;break;case "ENERGY_COUNTER":c.energy=b;break;case "POWER":c.power=b;break;default:return null}return c};var M=function(f,a,b){h.call(this,f,a,b);this.dimChannel=1;this.rgbChannel=2;this.autoChannel=3;this.legacyType="rgb"};util.inherits(M,h);M.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.dimChannel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+
this.rgbChannel,dpt:"COLOR"},{channel:this.deviceAdr+":"+this.autoChannel,dpt:"PROGRAM"}]};M.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.channel=a+":"+this.dimChannel;b.dataPoint="LEVEL";break;case "color":b.channel=a+":"+this.rgbChannel;b.dataPoint="COLOR";break;case "program":b.channel=a+":"+this.autoChannel;b.dataPoint="PROGRAM";break;case "inhibit":b.channel=a+":"+this.dimChannel;
b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.dimChannel;b.dataPoint="WORKING";break;case "direction":b.channel=a+":"+this.dimChannel;b.dataPoint="DIRECTION";break;default:return null}return b};M.prototype.executeCommand=function(f,a,b){var c=this;switch(a){case "on":var e=this.deviceAdr+":"+this.dimChannel;var g="OLD_LEVEL";f.writeValue(this.deviceIF,e,g,!0,b);break;case "off":e=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.writeValue(this.deviceIF,e,g,{type:"double",value:0},
b);break;case "white":e=this.deviceAdr+":"+this.rgbChannel;g="COLOR";f.writeValue(this.deviceIF,e,g,200,b);break;case "dimUp":e=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(a,h){a?b&&b(a):h?(a=h.value+.05,1<a&&(a=1),f.writeValue(c.deviceIF,e,g,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;case "dimDown":e=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.getState({interface:this.deviceIF,
channel:e,datapoint:g},function(a,h){a?b&&b(a):h?(a=h.value-.05,0>a&&(a=0),f.writeValue(c.deviceIF,e,g,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;default:if("onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)){"onTo"==a.substr(0,4)&&(a=a.substr(4));var h=parseInt(a);e=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.writeValue(this.deviceIF,e,g,{type:"double",value:h/100},b)}else if("setProg"==a.substr(0,7))a=a.substr(7),h=parseInt(a),e=this.deviceAdr+":"+
this.autoChannel,g="PROGRAM",f.writeValue(this.deviceIF,e,g,h,b);else if("setRampTime"==a.substr(0,11))a=a.substr(11),h=parseFloat(a),e=this.deviceAdr+":"+this.dimChannel,g="RAMP_TIME",f.writeValue(this.deviceIF,e,g,{type:"double",value:h},b);else if(a.toLowerCase().match(/^([0-9a-f]{6})$/i)){h=parseInt(a.substr(0,2),16);var k=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);var l=0;h=this._RGBToHSV(h,k,a);l=.1>h[1]?200:Math.round(h[0]/1.8);e=this.deviceAdr+":"+this.rgbChannel;g="COLOR";f.writeValue(this.deviceIF,
e,g,l,b)}else b&&b(Error("no such command"))}};M.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.dimChannel&&f!=this.rgbChannel&&f!=this.autoChannel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LEVEL":c.state=100*parseFloat(b);break;case "COLOR":c.color=b;break;case "PROGRAM":c.program=
b;break;case "INHIBIT":c.inhibit=b;break;case "WORKING":c.working=b;break;case "DIRECTION":c.direction=b;break;default:return null}return c};M.prototype._RGBToHSV=function(f,a,b){f/=255;a/=255;b/=255;var c=Math.min(f,Math.min(a,b)),e=Math.max(f,Math.max(a,b));return c==e?[0,0,c]:[60*((f==c?3:b==c?1:5)-(f==c?a-b:b==c?f-a:b-f)/(e-c)),(e-c)/e,e]};var za=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="lux"};util.inherits(za,h);za.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LUX"}]};za.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LUX";break;default:return null}return a};za.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,
c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LUX":c.state=b;break;default:return null}return c};var V=function(f,a,b){h.call(this,f,a,b);this.swChannel1=1;this.swChannel2=2;this.panicChannel=3;this.armingChannel=4;this.legacyType="siren2"};util.inherits(V,h);V.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.swChannel1,dpt:"STATE"},{channel:this.deviceAdr+":"+this.swChannel2,dpt:"STATE"},{channel:this.deviceAdr+":"+this.panicChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ARMSTATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+
":"+this.armingChannel,dpt:"LOWBAT"}]};V.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "switchSensorInState":b.channel=a+":"+this.swChannel1;b.dataPoint="STATE";break;case "switchSensorExState":b.channel=a+":"+this.swChannel2;b.dataPoint="STATE";break;case "switchPanicState":b.channel=a+":"+this.panicChannel;b.dataPoint="STATE";break;case "arming":b.channel=a+":"+this.armingChannel;b.dataPoint=
"ARMSTATE";break;case "inhibit":b.channel=a+":"+this.armingChannel;b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.armingChannel;b.dataPoint="WORKING";break;case "sabotage":b.channel=a+":"+this.armingChannel;b.dataPoint="ERROR_SABOTAGE";break;case "lowbat":b.channel=a+":"+this.armingChannel;b.dataPoint="LOWBAT";break;default:return null}return b};V.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;
c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c={};if(0==f)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(1==f){switch(a){case "STATE":c.switchSensorInState=b?"on":"off";break;default:return null}return c}if(2==f){switch(a){case "STATE":c.switchSensorExState=b?"on":"off";break;default:return null}return c}if(3==f){switch(a){case "STATE":c.switchPanicState=b?"on":"off";break;default:return null}return c}if(4==f){switch(a){case "ARMSTATE":switch(b){case 0:c.arming=
"disarmed";break;case 1:c.arming="ex_armed";break;case 2:c.arming="all_armed";break;case 3:c.arming="blocked"}break;case "INHIBIT":c.inhibit=b;break;case "WORKING":c.working=b;break;case "ERROR_SABOTAGE":switch(b){case 0:c.sabotage="no_error";break;case 1:c.sabotage="ex_armed"}break;case "LOWBAT":c.lowbat=b;break;default:return null}return c}};V.prototype.executeCommand=function(f,a,b){var c=this;switch(a){case "switchSensorInOn":var e="STATE";var g=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,
g,e,!0,b);break;case "switchSensorInOff":e="STATE";g=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,g,e,!1,b);break;case "switchSensorInToggle":e="STATE";g=this.deviceAdr+":"+this.swChannel1;f.getState({interface:this.deviceIF,channel:g,datapoint:e},function(a,h){a?b&&b(a):(a=!0,h.value&&(a=!1),f.writeValue(c.deviceIF,g,e,a,b))});break;case "switchSensorExOn":e="STATE";g=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,g,e,!0,b);break;case "switchSensorExOff":e="STATE";
g=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,g,e,!1,b);break;case "switchSensorExToggle":e="STATE";g=this.deviceAdr+":"+this.swChannel2;f.getState({interface:this.deviceIF,channel:g,datapoint:e},function(a,h){a?b&&b(a):(a=!0,h.value&&(a=!1),f.writeValue(c.deviceIF,g,e,a,b))});break;case "switchPanicOn":e="STATE";g=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,g,e,!0,b);break;case "switchPanicOff":e="STATE";g=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,
g,e,!1,b);break;case "switchPanicToggle":e="STATE";g=this.deviceAdr+":"+this.panicChannel;f.getState({interface:this.deviceIF,channel:g,datapoint:e},function(a,h){a?b&&b(a):(a=!0,h.value&&(a=!1),f.writeValue(c.deviceIF,g,e,a,b))});break;case "armingDisarm":e="ARMSTATE";g=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,g,e,0,b);break;case "armingIntern":e="ARMSTATE";g=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,g,e,1,b);break;case "armingAll":e="ARMSTATE";g=this.deviceAdr+
":"+this.armingChannel;f.writeValue(this.deviceIF,g,e,2,b);break;default:b&&b(Error("no such command"))}};var W=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="jalousie"};util.inherits(W,h);W.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});(b=b.JALOUSIE.getReadableDpts())&&b.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};W.prototype._getDptFromRef=function(f){var a=
this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";break;default:if(b.channel=a+":"+this.channel,b.dataPoint=c.JALOUSIE.getDptFromState(f),!b.dataPoint)return null}return b};W.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["BidCos-RF"].JALOUSIE.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};W.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==
c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a)return{timeout:b};c={};c["0_"+a.toLowerCase()]=b;return c}return f==this.channel?c.JALOUSIE.parseDptState(a,b):null};var C=function(f,a,b){h.call(this,f,a,b);this.keyChannel1=1;this.keyChannel2=2;this.em8bitChannel=3;this.legacyType="mod_em_8bit"};util.inherits(C,h);C.prototype._getReadableDpts=
function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var c=b.KEY.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b});f.push({channel:a.deviceAdr+":2",dpt:b})});(c=b.MOD_EM8BIT_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};C.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=
a+":0";b.dataPoint="UNREACH";break;case "lowbat":b.channel=a+":3";b.dataPoint="LOWBAT";break;case "state8bit":b.channel=a+":3";b.dataPoint="STATE";break;default:return null}return b};C.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "ch1pressShort":a=this.deviceAdr+":"+this.keyChannel1;c.KEY.executeCommand(f,this.deviceIF,a,"pressShort",b);break;case "ch1pressLong":a=this.deviceAdr+":"+this.keyChannel1;c.KEY.executeCommand(f,this.deviceIF,a,"pressLong",
b);break;case "ch2pressShort":a=this.deviceAdr+":"+this.keyChannel2;c.KEY.executeCommand(f,this.deviceIF,a,"pressShort",b);break;case "ch2pressLong":a=this.deviceAdr+":"+this.keyChannel2;c.KEY.executeCommand(f,this.deviceIF,a,"pressLong",b);break;default:b&&b(Error("no such command"))}};C.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=
g)return null;e=x.hub.m.hm._Channel["BidCos-RF"];c=null;if(0==f){if("UNREACH"==a)return{timeout:b};c={};c["0_"+a.toLowerCase()]=b;return c}if(f==this.keyChannel1){if(a=e.KEY.parseDptState(a,b))c={},a.pressShort&&(c.ch1pressShort=!0),a.pressLong&&(c.ch1pressLong=!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(c.ch1pressCont=!0),a.pressLongRel&&(c.ch1pressLongRel=!0);return c}if(f==this.keyChannel2){if(a=e.KEY.parseDptState(a,b))c={},a.pressShort&&(c.ch2pressShort=!0),a.pressLong&&(c.ch2pressLong=
!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(c.ch2pressCont=!0),a.pressLongRel&&(c.ch2pressLongRel=!0);return c}return f==this.em8bitChannel?e.MOD_EM8BIT_TRANSMITTER.parseDptState(a,b):null};C.prototype.isButton=function(){return!0};C.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,b+":1","PRESS_SHORT",function(e,g){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);
f.reportValueUsage(c.deviceIF,b+":1","PRESS_LONG",function(e,g){e&&console.error("button claim PRESS_LONG event error:"+e.stack);f.reportValueUsage(c.deviceIF,b+":2","PRESS_SHORT",function(e,g){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);f.reportValueUsage(c.deviceIF,b+":2","PRESS_LONG",function(b,c){a&&a()})})})})};var D=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="mod_em_8"};util.inherits(D,h);D.prototype._getReadableDpts=function(){var f=[],a=this,b=
x.hub.m.hm._Channel["BidCos-RF"],c=b.KEY.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});(c=b.SWITCH_INTERFACE.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});(c=b.SHUTTER_CONTACT.getReadableDpts())&&c.forEach(function(b){"ERROR"!=b&&f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};D.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "state":a.dataPoint=
"STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};D.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"],e=this.deviceAdr+":"+this.channel;switch(a){case "pressShort":c.KEY.executeCommand(f,this.deviceIF,e,"pressShort",b);break;case "pressLong":c.KEY.executeCommand(f,this.deviceIF,e,"pressLong",b);break;case "press":c.SWITCH_INTERFACE.executeCommand(f,this.deviceIF,e,"press",b);break;default:b&&b(Error("no such command"))}};D.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["BidCos-RF"];e=null;if(f==this.channel){e={};if(f=c.KEY.parseDptState(a,b))f.pressShort&&(e.pressShort=!0),f.pressLong&&(e.pressLong=!0),"undefined"!=typeof f.pressCont&&null!=f.pressCont&&(e.pressCont=!0),f.pressLongRel&&(e.pressCont=!0);(f=c.SWITCH_INTERFACE.parseDptState(a,
b))&&f.press&&(e.press=!0);if(f=c.SHUTTER_CONTACT.parseDptState(a,b))f.state&&(e.state=f.state),"undefined"!=typeof f.lowbat&&null!=f.lowbat&&(e.lowbat=f.lowbat)}return e};D.prototype.isButton=function(){return!0};D.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(e,g){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);f.reportValueUsage(c.deviceIF,b,"PRESS_LONG",
function(e,g){e&&console.error("button claim PRESS_LONG event error:"+e.stack);f.reportValueUsage(c.deviceIF,b,"PRESS",function(b,c){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);a&&a()})})})};var X=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="keymatic"};util.inherits(X,h);X.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});
(c=b.KEYMATIC.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};X.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";break;case "lowbat":b.channel=a+":0";b.dataPoint="LOWBAT";break;case "state":b.channel=a+":1";b.dataPoint="STATE";break;case "uncertain":b.channel=a+":1";b.dataPoint="STATE_UNCERTAIN";break;case "error":b.channel=a+":1";b.dataPoint=
"ERROR";break;default:return null}return b};X.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "open":a=this.deviceAdr+":"+this.channel;c.KEYMATIC.executeCommand(f,this.deviceIF,a,"open",b);break;case "close":a=this.deviceAdr+":"+this.channel;c.KEYMATIC.executeCommand(f,this.deviceIF,a,"close",b);break;case "openDoor":a=this.deviceAdr+":"+this.channel;c.KEYMATIC.executeCommand(f,this.deviceIF,a,"openDoor",b);break;default:b&&b(Error("no such command"))}};
X.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a||"LOWBAT"==a)return c.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return f==this.channel?a=c.KEYMATIC.parseDptState(a,b):null};var E=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType=
"ou_led16"};util.inherits(E,h);E.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this.channel,dpt:"LED_STATUS"}]};E.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "led":a.dataPoint="LED_STATUS";break;default:return null}return a};E.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;
c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g||0!=f&&f!=this.channel)return null;if(0==f)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LED_STATUS":switch(b){case 0:return{led:"off"};case 1:return{led:"red"};case 2:return{led:"green"};case 3:return{led:"orange"};default:return null}default:return null}};E.prototype.executeCommand=function(f,a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);
switch(a){case "pressShort":f.writeValue(this.deviceIF,c,"PRESS_SHORT",!0,b);break;case "ledOff":f.writeValue(this.deviceIF,c,"LED_STATUS",0,b);break;case "ledRed":f.writeValue(this.deviceIF,c,"LED_STATUS",1,b);break;case "ledGreen":f.writeValue(this.deviceIF,c,"LED_STATUS",2,b);break;case "ledOrange":f.writeValue(this.deviceIF,c,"LED_STATUS",3,b);break;case "ledSleepOff":f.writeValue(this.deviceIF,c,"LED_SLEEP_MODE",0,b);break;case "ledSleepOn":f.writeValue(this.deviceIF,c,"LED_SLEEP_MODE",1,b);
break;default:b&&b(Error("no such command"))}};E.prototype.isButton=function(){return!0};E.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(b,f){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);a&&a()})};var Na=function(f,a,b){h.call(this,f,a,b);this.channel=3;this.legacyType="hm_dis_ep_wm55"};util.inherits(Na,h);Na.prototype.executeCommand=function(f,a,b){if("submit"==
a.substr(0,6)){var c=a.substr(6);a=this.deviceAdr+":"+this.channel;f.writeValue(this.deviceIF,a,"SUBMIT",c,b)}else b&&b(Error("no such command"))};var Y=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="dualwhite"};util.inherits(Y,h);Y.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.DUAL_WHITE_BRIGHTNESS.getReadableDpts())&&
c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});(c=b.DUAL_WHITE_COLOR.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b})});return f};Y.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "bri":case "bri_real":case "error_overheat":case "error_reduced":case "direction":b.channel=
a+":1";b.dataPoint=c.DUAL_WHITE_BRIGHTNESS.getDptFromState(f);break;case "color":case "color_real":case "color_direction":b.channel=a+":2";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return b};Y.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "off":case "on":case "toggle":case "dimUp":case "dimDown":c.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b);break;case "colorOff":case "colorOn":case "colorToggle":case "colorUp":case "colorDown":c.DUAL_WHITE_COLOR.executeCommand(f,
this.deviceIF,this.deviceAdr+":2",a,b);break;default:"dimTo"==a.substr(0,5)?c.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b):"colorTo"==a.substr(0,7)?c.DUAL_WHITE_COLOR.executeCommand(f,this.deviceIF,this.deviceAdr+":2",a,b):b&&b(Error("no such command"))}};Y.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=
g)return null;c=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a)return c.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.DUAL_WHITE_BRIGHTNESS.parseDptState(a,b):2==f?c.DUAL_WHITE_COLOR.parseDptState(a,b):null};var Oa=function(f,a,b){k.call(this,f,a,b);this.channel=3;this.legacyType="ip_switch"};util.inherits(Oa,k);var Aa=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_contact"};util.inherits(Aa,h);Aa.prototype._getReadableDpts=
function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SHUTTER_CONTACT_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Aa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":b.channel=a+":1";b.dataPoint=c.SHUTTER_CONTACT_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};Aa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==
a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.SHUTTER_CONTACT_TRANSCEIVER.parseDptState(a,b):null};var Z=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_heater"};util.inherits(Z,h);Z.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&
c.forEach(function(b){"HUMIDITY"!=b&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Z.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "mode":case "state":case "window":b.channel=a+":1";b.dataPoint=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);
break;default:return null}return b};Z.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};Z.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==
a||"LOW_BAT"==a)return c.MAINTENANCE.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}return 1==f?c.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b):e};var aa=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_powerswitch"};util.inherits(aa,h);aa.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&
c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":6",dpt:b})});return f};aa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "switchState":b.channel=a+":3";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":6";b.dataPoint=c.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return b};aa.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var e=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"on",b);break;case "off":e=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
e,"off",b);break;case "toggle":e=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggle",b);break;default:"onFor"==a.substr(0,5)?(e=this.deviceAdr+":3",c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,a,b)):b&&b(Error("no such command"))}};aa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;
c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a)return c.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 3==f?c.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b):6==f?c.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var ba=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_energyactor"};util.inherits(ba,h);ba.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==
b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SWITCH_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});(c=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":7",dpt:b})});return f};ba.prototype._getDptFromRef=
function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "switchState":b.channel=a+":3";b.dataPoint=c.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch4State":b.channel=a+":4";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch5State":b.channel=a+":5";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch6State":b.channel=a+":6";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":7";b.dataPoint=c.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return b};ba.prototype.executeCommand=function(f,a,b){var c=null,e=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch4on":case "ch5on":case "ch6on":switch(a){case "on":case "ch4on":c=
this.deviceAdr+":4";break;case "ch5on":c=this.deviceAdr+":5";break;case "ch6on":c=this.deviceAdr+":6"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"on",b);break;case "off":case "ch4off":case "ch5off":case "ch6off":switch(a){case "off":case "ch4off":c=this.deviceAdr+":4";break;case "ch5off":c=this.deviceAdr+":5";break;case "ch6off":c=this.deviceAdr+":6"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"off",b);break;case "toggle":case "ch4toggle":case "ch5toggle":case "ch6toggle":switch(a){case "toggle":case "ch4toggle":c=
this.deviceAdr+":4";break;case "ch5toggle":c=this.deviceAdr+":5";break;case "ch6toggle":c=this.deviceAdr+":6"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"toggle",b);break;default:b&&b(Error("no such command"))}};ba.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==
f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==f){if(a=e.SWITCH_TRANSMITTER.parseDptState(a,b))c={},c.switchState=a.switchTState;return c}if(4==f||5==f||6==f){if(a=e.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 4:c.ch4State=a.switchState;break;case 5:c.ch5State=a.switchState;break;case 6:c.ch6State=a.switchState}return c}return 7==f?e.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var ca=function(f,a,b){h.call(this,
f,a,b);this.channel=1;this.legacyType="ip_energyactor2"};util.inherits(ca,h);ca.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SWITCH_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b});
f.push({channel:a.deviceAdr+":3",dpt:b});f.push({channel:a.deviceAdr+":4",dpt:b})});(c=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":5",dpt:b})});return f};ca.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "switchState":b.channel=a+":1";b.dataPoint=c.SWITCH_TRANSMITTER.getDptFromState("switchTState");
break;case "ch2State":b.channel=a+":2";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":b.channel=a+":3";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":b.channel=a+":4";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":5";b.dataPoint=c.ENERGIE_METER_TRANSMITTER.getDptFromState(f);
break;default:return null}return b};ca.prototype.executeCommand=function(f,a,b){var c=null,e=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch2on":case "ch3on":case "ch4on":switch(a){case "on":case "ch2on":c=this.deviceAdr+":2";break;case "ch3on":c=this.deviceAdr+":3";break;case "ch4on":c=this.deviceAdr+":4"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"on",b);break;case "off":case "ch2off":case "ch3off":case "ch4off":switch(a){case "off":case "ch2off":c=this.deviceAdr+":2";
break;case "ch3off":c=this.deviceAdr+":3";break;case "ch4off":c=this.deviceAdr+":4"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"off",b);break;case "toggle":case "ch2toggle":case "ch3toggle":case "ch4toggle":switch(a){case "toggle":case "ch2toggle":c=this.deviceAdr+":2";break;case "ch3toggle":c=this.deviceAdr+":3";break;case "ch4toggle":c=this.deviceAdr+":4"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"toggle",b);break;default:b&&b(Error("no such command"))}};ca.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f){if(a=e.SWITCH_TRANSMITTER.parseDptState(a,b))c={},c.switchState=a.switchTState;return c}if(2==f||3==f||4==f){if(a=e.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,
b))switch(c={},parseInt(f)){case 2:c.ch2State=a.switchState;break;case 3:c.ch3State=a.switchState;break;case 4:c.ch4State=a.switchState}return c}return 5==f?e.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var da=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_dimmer"};util.inherits(da,h);da.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+
":0",dpt:b})});(c=b.DIMMER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});return f};da.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":b.channel=a+":3";b.dataPoint=c.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch5Level":b.channel=a+":5";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":b.channel=a+":6";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return b};
da.prototype.executeCommand=function(f,a,b){var c=null,e=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("dimUp")){var h=a.indexOf("dimUp");g=a.substr(0,h+5);var k=a.substr(h+5)}else-1!=a.indexOf("dimDown")?(h=a.indexOf("dimDown"),g=a.substr(0,h+7),k=a.substr(h+7)):-1!=a.indexOf("dimTo")?(h=a.indexOf("dimTo"),g=a.substr(0,h+5),k=a.substr(h+5)):-1!=a.indexOf("toggleTo")&&(h=a.indexOf("toggleTo"),g=a.substr(0,h+8),k=a.substr(h+8));var l=this;switch(g){case "dimOff":e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","dimOff",function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimOff",function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimOff",b)})});break;case "dimUp":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value+
k,1<k&&(k=1),k=Math.round(100*k),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+k,b)})}))});break;case "dimDown":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==
typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+k,b)})}))});break;case "dimTo":if(!k){b&&b(Error("dimTo has no value"));break}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!k){b&&b(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(c.value&&(k=0),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+k,b)})}))});break;case "ch4dimOff":case "ch5dimOff":case "ch6dimOff":switch(g){case "ch4dimOff":c=
this.deviceAdr+":4";break;case "ch5dimOff":c=this.deviceAdr+":5";break;case "ch6dimOff":c=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimOff",b);break;case "ch4dimUp":case "ch5dimUp":case "ch6dimUp":switch(g){case "ch4dimUp":c=this.deviceAdr+":4";break;case "ch5dimUp":c=this.deviceAdr+":5";break;case "ch6dimUp":c=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimUp"+k,b);break;case "ch4dimDown":case "ch5dimDown":case "ch6dimDown":switch(g){case "ch4dimDown":c=
this.deviceAdr+":4";break;case "ch5dimDown":c=this.deviceAdr+":5";break;case "ch6dimDown":c=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimDown"+k,b);break;case "ch4dimTo":case "ch5dimTo":case "ch6dimTo":switch(g){case "ch4dimTo":c=this.deviceAdr+":4";break;case "ch5dimTo":c=this.deviceAdr+":5";break;case "ch6dimTo":c=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimTo"+k,b);break;case "ch4toggleTo":case "ch5toggleTo":case "ch6toggleTo":switch(g){case "ch4toggleTo":c=
this.deviceAdr+":4";break;case "ch5toggleTo":c=this.deviceAdr+":5";break;case "ch6toggleTo":c=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"toggleTo"+k,b);break;default:b&&b(Error("no such command"))}};da.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=
null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==f){if(a=e.DIMMER_TRANSMITTER.parseDptState(a,b))c={},c.dimmerLevel=a.dimmerTLevel;return c}if(4==f||5==f||6==f){if(a=e.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 4:c.ch4Level=a.dimmerLevel;break;case 5:c.ch5Level=a.dimmerLevel;break;case 6:c.ch6Level=a.dimmerLevel}return c}return null};var ea=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_dimmer2"};util.inherits(ea,h);ea.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.DIMMER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b})});(c=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b});f.push({channel:a.deviceAdr+":4",dpt:b});
f.push({channel:a.deviceAdr+":5",dpt:b})});return f};ea.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":b.channel=a+":2";b.dataPoint=c.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":b.channel=a+":3";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;
case "ch5Level":b.channel=a+":4";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":b.channel=a+":5";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return b};ea.prototype.executeCommand=function(f,a,b){var c=null,e=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("dimUp")){var h=a.indexOf("dimUp");g=a.substr(0,h+5);var k=a.substr(h+5)}else-1!=a.indexOf("dimDown")?(h=a.indexOf("dimDown"),g=a.substr(0,h+7),k=
a.substr(h+7)):-1!=a.indexOf("dimTo")?(h=a.indexOf("dimTo"),g=a.substr(0,h+5),k=a.substr(h+5)):-1!=a.indexOf("toggleTo")&&(h=a.indexOf("toggleTo"),g=a.substr(0,h+8),k=a.substr(h+8));var l=this;switch(g){case "dimOff":e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3","dimOff",function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimOff",function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":5","dimOff",b)})});break;case "dimUp":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value+k,1<k&&(k=1),k=Math.round(100*k),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?
b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,b)})}))});break;case "dimDown":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,b)})}))});break;case "dimTo":if(!k){b&&b(Error("dimTo has no value"));break}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":5","dimTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":2","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!k){b&&b(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(c.value&&(k=0),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+k,b)})}))});break;case "ch3dimOff":case "ch4dimOff":case "ch5dimOff":switch(g){case "ch3dimOff":c=this.deviceAdr+":3";break;case "ch4dimOff":c=this.deviceAdr+":4";break;case "ch5dimOff":c=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
c,"dimOff",b);break;case "ch3dimUp":case "ch4dimUp":case "ch5dimUp":switch(g){case "ch3dimUp":c=this.deviceAdr+":3";break;case "ch4dimUp":c=this.deviceAdr+":4";break;case "ch5dimUp":c=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimUp"+k,b);break;case "ch3dimDown":case "ch4dimDown":case "ch5dimDown":switch(g){case "ch3dimDown":c=this.deviceAdr+":3";break;case "ch4dimDown":c=this.deviceAdr+":4";break;case "ch5dimDown":c=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,c,"dimDown"+k,b);break;case "ch3dimTo":case "ch4dimTo":case "ch5dimTo":switch(g){case "ch3dimTo":c=this.deviceAdr+":3";break;case "ch4dimTo":c=this.deviceAdr+":4";break;case "ch5dimTo":c=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimTo"+k,b);break;case "ch3toggleTo":case "ch4toggleTo":case "ch5toggleTo":switch(g){case "ch3toggleTo":c=this.deviceAdr+":3";break;case "ch4toggleTo":c=this.deviceAdr+":4";break;case "ch5toggleTo":c=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,c,"toggleTo"+k,b);break;default:b&&b(Error("no such command"))}};ea.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(2==f){if(a=e.DIMMER_TRANSMITTER.parseDptState(a,
b))c={},c.dimmerLevel=a.dimmerTLevel;return c}if(3==f||4==f||5==f){if(a=e.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 3:c.ch3Level=a.dimmerLevel;break;case 4:c.ch4Level=a.dimmerLevel;break;case 5:c.ch5Level=a.dimmerLevel}return c}return null};var fa=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_dimmer3"};util.inherits(fa,h);fa.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();
c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.DIMMER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});(c=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b});f.push({channel:a.deviceAdr+":3",dpt:b});f.push({channel:a.deviceAdr+":4",dpt:b})});return f};fa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},
c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":b.channel=a+":1";b.dataPoint=c.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch2Level":b.channel=a+":2";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch3Level":b.channel=a+":3";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;default:return null}return b};fa.prototype.executeCommand=function(f,a,b){var c=null,e=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("dimUp")){var h=a.indexOf("dimUp");g=a.substr(0,h+5);var k=a.substr(h+5)}else-1!=a.indexOf("dimDown")?(h=a.indexOf("dimDown"),g=a.substr(0,h+7),k=a.substr(h+7)):-1!=a.indexOf("dimTo")?(h=a.indexOf("dimTo"),g=a.substr(0,h+5),k=a.substr(h+5)):-1!=a.indexOf("toggleTo")&&(h=a.indexOf("toggleTo"),g=a.substr(0,h+8),k=a.substr(h+8));var l=this;switch(g){case "dimOff":e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":2","dimOff",function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimOff",function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimOff",b)})});break;case "dimUp":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value+
k,1<k&&(k=1),k=Math.round(100*k),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,b)})}))});break;case "dimDown":k=k?parseInt(k)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==
typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,b)})}))});break;case "dimTo":if(!k){b&&b(Error("dimTo has no value"));break}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":2","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":1","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!k){b&&b(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(c.value&&(k=0),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+k,function(a,c){a?b&&b(a,c):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+k,b)})}))});break;case "ch2dimOff":case "ch3dimOff":case "ch4dimOff":switch(g){case "ch2dimOff":c=
this.deviceAdr+":2";break;case "ch3dimOff":c=this.deviceAdr+":3";break;case "ch4dimOff":c=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimOff",b);break;case "ch2dimUp":case "ch3dimUp":case "ch4dimUp":switch(g){case "ch2dimUp":c=this.deviceAdr+":2";break;case "ch3dimUp":c=this.deviceAdr+":3";break;case "ch4dimUp":c=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimUp"+k,b);break;case "ch2dimDown":case "ch3dimDown":case "ch4dimDown":switch(g){case "ch2dimDown":c=
this.deviceAdr+":2";break;case "ch3dimDown":c=this.deviceAdr+":3";break;case "ch4dimDown":c=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimDown"+k,b);break;case "ch2dimTo":case "ch3dimTo":case "ch4dimTo":switch(g){case "ch2dimTo":c=this.deviceAdr+":2";break;case "ch3dimTo":c=this.deviceAdr+":3";break;case "ch4dimTo":c=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"dimTo"+k,b);break;case "ch2toggleTo":case "ch3toggleTo":case "ch4toggleTo":switch(g){case "ch2toggleTo":c=
this.deviceAdr+":2";break;case "ch3toggleTo":c=this.deviceAdr+":3";break;case "ch4toggleTo":c=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"toggleTo"+k,b);break;default:b&&b(Error("no such command"))}};fa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=
null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f){if(a=e.DIMMER_TRANSMITTER.parseDptState(a,b))c={},c.dimmerLevel=a.dimmerTLevel;return c}if(2==f||3==f||4==f){if(a=e.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 2:c.ch2Level=a.dimmerLevel;break;case 3:c.ch3Level=a.dimmerLevel;break;case 4:c.ch4Level=a.dimmerLevel}return c}return null};var ha=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_motion"};util.inherits(ha,h);ha.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};ha.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":b.channel=a+":1";b.dataPoint=c.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};ha.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":c.MOTIONDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b);break;default:b&&b(Error("no such command"))}};
ha.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,b):null};var F=function(f,a,b){h.call(this,
f,a,b);this.channel=3;this.legacyType="ip_motion2"};util.inherits(F,h);F.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};F.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,
dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":b.channel=a+":3";b.dataPoint=c.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};F.prototype.executeCommand=function(f,a,b){switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":break;default:b&&b(Error("no such command"))}};F.prototype.parseDptState=
function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}1==f&&(g=c.KEY_TRANRECEIVER.parseDptState(a,b))&&(g.pressShort&&(e={btn1pressShort:!0}),g.pressLong&&(e={btn1pressLong:!0}));2==f&&(g=
c.KEY_TRANRECEIVER.parseDptState(a,b))&&(g.pressShort&&(e={btn2pressShort:!0}),g.pressLong&&(e={btn2pressLong:!0}));return 3==f?c.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,b):e};F.prototype.isButton=function(){return!0};F.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,e){b&&console.error("button:1 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(c.deviceIF,
c.deviceAdr+":1","PRESS_LONG",function(b,e){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_SHORT",function(b,e){b&&console.error("button:2 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_LONG",function(b,c){b&&console.error("button:2 claim PRESS_LONG event error:"+b.stack);a&&a()})})})})};var N=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_button"};util.inherits(N,
h);N.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};N.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};
N.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}f==this.channel&&(a=e.KEY_TRANRECEIVER.parseDptState(a,b))&&(a.pressShort&&(c={pressShort:!0}),a.pressLong&&
(c={pressLong:!0}));return c};N.prototype.isButton=function(){return!0};N.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,e){b&&console.error("button:1 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":1","PRESS_LONG",function(b,c){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);a&&a()})})};var O=
function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_button2"};util.inherits(O,h);O.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};O.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};O.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}1==f&&(g=c.KEY_TRANRECEIVER.parseDptState(a,
b))&&(g.pressShort&&(e={btn1pressShort:!0}),g.pressLong&&(e={btn1pressLong:!0}));2==f&&(g=c.KEY_TRANRECEIVER.parseDptState(a,b))&&(g.pressShort&&(e={btn2pressShort:!0}),g.pressLong&&(e={btn2pressLong:!0}));return e};O.prototype.isButton=function(){return!0};O.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,e){b&&console.error("button:1 claim PRESS_SHORT event error:"+
b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":1","PRESS_LONG",function(b,e){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_SHORT",function(b,e){b&&console.error("button:2 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_LONG",function(b,c){b&&console.error("button:2 claim PRESS_LONG event error:"+b.stack);a&&a()})})})})};var G=function(f,a,b){h.call(this,f,a,b);this.channel=
1;this.legacyType="ip_button4"};util.inherits(G,h);G.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};G.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);
break;default:return null}return b};G.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f||2==f||3==f||4==f)if(a=e.KEY_TRANRECEIVER.parseDptState(a,b))c||
(c={}),a.pressShort&&(c["btn"+f+"pressShort"]=!0),a.pressLong&&(c["btn"+f+"pressLong"]=!0);return c};G.prototype.isButton=function(){return!0};G.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,f,function(){c._claimButtonEvent(2,f,function(){c._claimButtonEvent(3,f,function(){c._claimButtonEvent(4,f,function(){a&&a()})})})})};G.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,
this.deviceAdr+":"+f,"PRESS_SHORT",function(e,g){e&&console.error("button:"+f+" claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var H=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_button6"};util.inherits(H,h);H.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();
b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};H.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};H.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=
this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f||2==f||3==f||4==f||5==f||6==f)if(a=e.KEY_TRANRECEIVER.parseDptState(a,b))c||(c={}),a.pressShort&&(c["btn"+f+"pressShort"]=!0),a.pressLong&&(c["btn"+f+"pressLong"]=!0);return c};H.prototype.isButton=function(){return!0};H.prototype.claimEvent=
function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,f,function(){c._claimButtonEvent(2,f,function(){c._claimButtonEvent(3,f,function(){c._claimButtonEvent(4,f,function(){c._claimButtonEvent(5,f,function(){c._claimButtonEvent(6,f,function(){a&&a()})})})})})})};H.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(e,g){e&&console.error("button:"+
f+" claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var ia=function(f,a,b){h.call(this,f,a,b);this.channel=3;this.legacyType="ip_siren"};util.inherits(ia,h);ia.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});
(c=b.ALARM_SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};ia.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":b.channel=a+":3";b.dataPoint=c.ALARM_SWITCH_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return b};
ia.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].ALARM_SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3",a,b)};ia.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}return 3==f?c.ALARM_SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b):null};var z=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_wallthermo"};util.inherits(z,h);z.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){"LEVEL"!=
b&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};z.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":b.channel=a+":1";b.dataPoint=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);break;
default:return null}return b};z.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};z.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||
"LOW_BAT"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}return 1==f?c.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b):e};var Ba=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_wallthermo2"};util.inherits(Ba,z);Ba.prototype._getReadableDpts=function(){var f=z.prototype._getReadableDpts.call(this);f||(f=[]);var a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+
":8",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":10",dpt:b})});return f};Ba.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "valveState":b.channel=a+":10";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "cl_fd_emergencyOP":case "cl_fd_frostProtection":case "cl_fd_state":case "cl_fd_humidityAlarm":b.channel=
a+":8";b.dataPoint=c.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getDptFromState(f);break;default:return z.prototype._getDptFromRef.call(this,f)}return b};Ba.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f)return e.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b);if(8==f)return e.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.parseDptState(a,b);10==f&&(c={},a=e.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b),c.valveState=a?a.switchState:"?");return c};var ja=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_smoke"};util.inherits(ja,h);ja.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();
c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SMOKE_DETECTOR.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};ja.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":b.channel=
a+":1";b.dataPoint=c.SMOKE_DETECTOR.getDptFromState(f);break;default:return null}return b};ja.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].SMOKE_DETECTOR.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};ja.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];
e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}return 1==f?c.SMOKE_DETECTOR.parseDptState(a,b):e};var Ca=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_window"};util.inherits(Ca,h);Ca.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.ROTARY_HANDLE_TRANSCEIVER.getReadableDpts())&&
c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ca.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":b.channel=a+":1";b.dataPoint=c.ROTARY_HANDLE_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};Ca.prototype.parseDptState=function(f,
a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}return 1==f?c.ROTARY_HANDLE_TRANSCEIVER.parseDptState(a,b):e};var I=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_blind"};util.inherits(I,h);I.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SHUTTER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.SHUTTER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+
":6",dpt:b})});return f};I.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "blindLevel":b.channel=a+":3";b.dataPoint=c.SHUTTER_TRANSMITTER.getDptFromState("blindTLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=c.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch5Level":b.channel=a+":5";
b.dataPoint=c.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch6Level":b.channel=a+":6";b.dataPoint=c.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;default:return null}return b};I.prototype.executeCommand=function(f,a,b){var c=null,e=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("stepUp")){var h=a.indexOf("stepUp");g=a.substr(0,h+6);var k=a.substr(h+6)}else-1!=a.indexOf("stepDown")?(h=a.indexOf("stepDown"),g=a.substr(0,h+8),k=a.substr(h+8)):-1!=a.indexOf("moveTo")?
(h=a.indexOf("moveTo"),g=a.substr(0,h+6),k=a.substr(h+6)):-1!=a.indexOf("stop")&&(h=a.indexOf("stop"),g=a.substr(0,h+4),k=a.substr(h+4));var l=this;switch(g){case "stop":e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","stop",function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","stop",function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","stop",b)})});break;case "moveUp":e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","moveUp",function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveUp",function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveUp",b)})});break;case "moveDown":e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveDown",function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveDown",function(a,c){a?b&&
b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveDown",b)})});break;case "stepUp":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(k=c.value+k,1<k&&(k=1),k=Math.round(100*k),e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5","moveTo"+k,function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "stepDown":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):
(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+k,function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});
break;case "moveTo":if(!k){b&&b(Error("moveTo has no value"));break}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+k,function(a,c){a?b&&b(a,c):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+
1E3),b&&b(a))})})});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(g){case "ch4stop":c=this.deviceAdr+":4";break;case "ch5stop":c=this.deviceAdr+":5";break;case "ch6stop":c=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stop",b);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(g){case "ch4moveUp":c=this.deviceAdr+":4";break;case "ch5moveUp":c=this.deviceAdr+":5";break;case "ch6moveUp":c=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,c,"moveUp",b);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(g){case "ch4moveDown":c=this.deviceAdr+":4";break;case "ch5moveDown":c=this.deviceAdr+":5";break;case "ch6moveDown":c=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveDown",b);break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(g){case "ch4stepUp":c=this.deviceAdr+":4";break;case "ch5stepUp":c=this.deviceAdr+":5";break;case "ch6stepUp":c=this.deviceAdr+
":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stepUp"+k,b);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(g){case "ch4stepDown":c=this.deviceAdr+":4";break;case "ch5stepDown":c=this.deviceAdr+":5";break;case "ch6stepDown":c=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stepDown"+k,b);break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(g){case "ch4moveTo":c=this.deviceAdr+":4";break;case "ch5moveTo":c=this.deviceAdr+
":5";break;case "ch6moveTo":c=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveTo"+k,b);break;default:b&&b(Error("no such command"))}};I.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==f){if(a=e.SHUTTER_TRANSMITTER.parseDptState(a,b))c={},c.blindLevel=a.blindTLevel;return c}if(4==f||5==f||6==f){if(a=e.SHUTTER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 4:c.ch4Level=a.blindLevel;break;case 5:c.ch5Level=a.blindLevel;break;case 6:c.ch6Level=a.blindLevel}return c}return null};I.prototype.getConfig=function(f,a){var b=this.deviceAdr+":3";f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var e=
{},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});e[b]=g;a&&a(c,e)}})};I.prototype.setConfig=function(f,a,b){if(a){var c=this.deviceAdr+
":3";if(a=a[c]){var e={};e.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};e.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};f.setParamset(this.deviceIF,c,"MASTER",e,function(a){b&&b(a)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var J=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_jalousie"};util.inherits(J,h);J.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&
c.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.BLIND_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});return f};J.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];
switch(f){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(f);break;case "blindLevel":b.channel=a+":3";b.dataPoint=c.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":b.channel=a+":3";b.dataPoint=c.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;case "ch4blindLevel":b.channel=a+":4";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch4lamellaLevel":b.channel=a+":4";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");
break;case "ch5blindLevel":b.channel=a+":5";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch5lamellaLevel":b.channel=a+":5";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch6blindLevel":b.channel=a+":6";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch6lamellaLevel":b.channel=a+":6";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;default:return null}return b};J.prototype.executeCommand=
function(f,a,b){var c=null,e=x.hub.m.hm._Channel["HmIP-RF"],g=a;if(-1!=a.indexOf("stepUp")){var h=a.indexOf("stepUp");g=a.substr(0,h+6);var k=a.substr(h+6)}else-1!=a.indexOf("stepDown")?(h=a.indexOf("stepDown"),g=a.substr(0,h+8),k=a.substr(h+8)):-1!=a.indexOf("moveTo")?(h=a.indexOf("moveTo"),g=a.substr(0,h+6),k=a.substr(h+6)):-1!=a.indexOf("stop")?(h=a.indexOf("stop"),g=a.substr(0,h+4),k=a.substr(h+4)):-1!=a.indexOf("lamellaStepUp")?(h=a.indexOf("lamellaStepUp"),g=a.substr(0,h+13),k=a.substr(h+13)):
-1!=a.indexOf("lamellaStepDown")?(h=a.indexOf("lamellaStepDown"),g=a.substr(0,h+15),k=a.substr(h+15)):-1!=a.indexOf("lamellaTo")&&(h=a.indexOf("lamellaTo"),g=a.substr(0,h+9),k=a.substr(h+9));var l=this;switch(g){case "stop":case "moveUp":case "moveDown":e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4",g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5",g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":6",g,b)})});break;case "lamellaUp":case "lamellaDown":f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(k=c.value,k=Math.round(100*k),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4",g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5",g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6",g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+k,function(a,c){b&&b(a,c)})})})})})}))});break;case "stepUp":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},
function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(k=c.value+k,1<k&&(k=1),k=Math.round(100*k),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=
0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "stepDown":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5","moveTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "moveTo":if(!k){b&&b(Error("moveTo has no value"));break}e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5","moveTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+k,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "lamellaStepUp":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==
c)b&&b(Error("get blind current value return invalid"));else{var g=c.value;g=Math.round(100*g);f.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get lamella current value return invalid")):(k=c.value+k,1<k&&(k=1),k=Math.round(100*k),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","lamellaTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":4","moveTo"+g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","lamellaTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+g,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&
(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",c,(new Date).getTime()+1E3),b&&b(a))})})})})})}))})}});break;case "lamellaStepDown":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var g=c.value;g=Math.round(100*g);f.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,
c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get lamella current value return invalid")):(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","lamellaTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","lamellaTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5","moveTo"+g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+g,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",c,(new Date).getTime()+1E3),b&&b(a))})})})})})}))})}});break;case "lamellaTo":if(!k){b&&b(Error("lamellaTo has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var g=c.value;g=Math.round(100*g);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","lamellaTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","lamellaTo"+
k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+g,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+k,function(a,c){a?b&&b(a,c):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+g,function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",c,(new Date).getTime()+1E3),b&&b(a))})})})})})})}});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(g){case "ch4stop":c=
this.deviceAdr+":4";break;case "ch5stop":c=this.deviceAdr+":5";break;case "ch6stop":c=this.deviceAdr+":6"}e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stop",b);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(g){case "ch4moveUp":c=this.deviceAdr+":4";break;case "ch5moveUp":c=this.deviceAdr+":5";break;case "ch6moveUp":c=this.deviceAdr+":6"}e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveUp",b);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(g){case "ch4moveDown":c=
this.deviceAdr+":4";break;case "ch5moveDown":c=this.deviceAdr+":5";break;case "ch6moveDown":c=this.deviceAdr+":6"}e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveDown",b);break;case "ch4lamellaUp":case "ch5lamellaUp":case "ch6lamellaUp":switch(g){case "ch4lamellaUp":c=this.deviceAdr+":4";break;case "ch5lamellaUp":c=this.deviceAdr+":5";break;case "ch6lamellaUp":c=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,g){if(a)b&&b(a);else if("undefined"==
typeof g||null==g)b&&b(Error("get blind current value return invalid"));else{var k=g.value;k=Math.round(100*k);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"lamellaUp",function(a,g){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+k,function(a,c){b&&b(a,c)})})}});break;case "ch4lamellaDown":case "ch5lamellaDown":case "ch6lamellaDown":switch(g){case "ch4lamellaDown":c=this.deviceAdr+":4";break;case "ch5lamellaDown":c=this.deviceAdr+":5";break;case "ch6lamellaDown":c=
this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,g){if(a)b&&b(a);else if("undefined"==typeof g||null==g)b&&b(Error("get blind current value return invalid"));else{var k=g.value;k=Math.round(100*k);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"lamellaDown",function(a,g){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+k,function(a,c){b&&b(a,c)})})}});break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(g){case "ch4stepUp":c=
this.deviceAdr+":4";break;case "ch5stepUp":c=this.deviceAdr+":5";break;case "ch6stepUp":c=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stepUp"+k,b);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(g){case "ch4stepDown":c=this.deviceAdr+":4";break;case "ch5stepDown":c=this.deviceAdr+":5";break;case "ch6stepDown":c=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"stepDown"+k,b);break;case "ch4lamellaStepUp":case "ch5lamellaStepUp":case "ch6lamellaStepUp":switch(g){case "ch4lamellaStepUp":c=
this.deviceAdr+":4";break;case "ch5lamellaStepUp":c=this.deviceAdr+":5";break;case "ch6lamellaStepUp":c=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,g){if(a)b&&b(a);else if("undefined"==typeof g||null==g)b&&b(Error("get blind current value return invalid"));else{var h=g.value;h=Math.round(100*h);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"lamellaStepUp"+k,function(a,g){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+
h,function(a,c){b&&b(a,c)})})}});break;case "ch4lamellaStepDown":case "ch5lamellaStepDown":case "ch6lamellaStepDown":switch(g){case "ch4lamellaStepDown":c=this.deviceAdr+":4";break;case "ch5lamellaStepDown":c=this.deviceAdr+":5";break;case "ch6lamellaStepDown":c=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,g){if(a)b&&b(a);else if("undefined"==typeof g||null==g)b&&b(Error("get blind current value return invalid"));else{var h=g.value;h=Math.round(100*
h);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"lamellaStepDown"+k,function(a,g){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+h,function(a,c){b&&b(a,c)})})}});break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(g){case "ch4moveTo":c=this.deviceAdr+":4";break;case "ch5moveTo":c=this.deviceAdr+":5";break;case "ch6moveTo":c=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,c,"moveTo"+k,b);break;case "ch4lamellaTo":case "ch5lamellaTo":case "ch6lamellaTo":switch(g){case "ch4lamellaTo":c=
this.deviceAdr+":4";break;case "ch5lamellaTo":c=this.deviceAdr+":5";break;case "ch6lamellaTo":c=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,g){if(a)b&&b(a);else if("undefined"==typeof g||null==g)b&&b(Error("get blind current value return invalid"));else{var h=g.value;h=Math.round(100*h);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"lamellaTo"+k,function(a,g){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,c,"moveTo"+h,function(a,
c){b&&b(a,c)})})}});break;default:b&&b(Error("no such command"))}};J.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==f){if(b=e.BLIND_TRANSMITTER.parseDptState(a,b))c={},"LEVEL"==
a?c.blindLevel=b.blindTPos:"LEVEL_2"==a&&(c.lamellaLevel=b.lamellaTPos);return c}if(4==f||5==f||6==f){if(b=e.BLIND_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(f)){case 4:"LEVEL"==a?c.ch4blindLevel=b.blindPos:"LEVEL_2"==a&&(c.ch4lamellaLevel=b.lamellaPos);break;case 5:"LEVEL"==a?c.ch5blindLevel=b.blindPos:"LEVEL_2"==a&&(c.ch5lamellaLevel=b.lamellaPos);break;case 6:"LEVEL"==a?c.ch6blindLevel=b.blindPos:"LEVEL_2"==a&&(c.ch6lamellaLevel=b.lamellaPos)}return c}return null};J.prototype.getConfig=
function(f,a){var b=this.deviceAdr+":3";f.getParamset(this.deviceIF,b,"MASTER",function(c,f){if(c)a&&a(c);else{var e={},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,
REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});e[b]=g;a&&a(c,e)}})};J.prototype.setConfig=function(f,a,b){if(a){var c=this.deviceAdr+":3";if(a=a[c]){var e={};e.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};e.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE=
{__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};e.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_UNIT};e.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_VALUE};
f.setParamset(this.deviceIF,c,"MASTER",e,function(a){b&&b(a)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var ka=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_presence"};util.inherits(ka,h);ka.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.PRESENCEDETECTOR_TRANSCEIVER.getReadableDpts())&&
c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};ka.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "current_illumination":case "active":b.channel=a+":1";b.dataPoint=c.PRESENCEDETECTOR_TRANSCEIVER.getDptFromState(f);break;
default:return null}return b};ka.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":c.PRESENCEDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b);break;default:b&&b(Error("no such command"))}};ka.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&
(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.PRESENCEDETECTOR_TRANSCEIVER.parseDptState(a,b):null};var Da=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_floor_heater"};util.inherits(Da,h);Da.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_TRANSCEIVER.getReadableDpts();
b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};Da.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_f_humidityLimiter":case "cl_f_emergencyOP":case "cl_f_frostProtection":case "cl_f_state":case "cl_f_dewPointAlarm":case "cl_f_externalClock":b.channel=a+":"+this.channel;b.dataPoint=c.CLIMATECONTROL_FLOOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};
Da.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?c.CLIMATECONTROL_FLOOR_TRANSCEIVER.parseDptState(a,b):null};var Ea=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_floor_pump_heater"};util.inherits(Ea,h);Ea.prototype._getReadableDpts=function(){var f=
[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};Ea.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_fp_humidityLimiter":case "cl_fp_emergencyOP":case "cl_fp_frostProtection":case "cl_fp_state":case "cl_fp_dewPointAlarm":case "cl_fp_externalClock":b.channel=
a+":"+this.channel;b.dataPoint=c.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};Ea.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?c.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.parseDptState(a,b):null};var Fa=function(f,a,b){h.call(this,
f,a,b);this.channel=1;this.legacyType="ip_weather"};util.inherits(Fa,h);Fa.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WEATHER_TRANSMIT.getReadableDpts())&&c.forEach(function(b){-1==b.indexOf("RAIN")&&-1==b.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Fa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b=
{channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=c.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Fa.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,
c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.WEATHER_TRANSMIT.parseDptState(a,b):null};var Ga=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_weather2"};util.inherits(Ga,h);Ga.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+
":0",dpt:b})});(c=b.WEATHER_TRANSMIT.getReadableDpts())&&c.forEach(function(b){-1==b.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ga.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=c.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;b.dataPoint=
f}return b};Ga.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.WEATHER_TRANSMIT.parseDptState(a,b):null};var Ha=function(f,a,b){h.call(this,f,a,b);this.channel=
1;this.legacyType="ip_weather3"};util.inherits(Ha,h);Ha.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.CLIMATE_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ha.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];
switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=c.CLIMATE_TRANSCEIVER.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Ha.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==
a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.CLIMATE_TRANSCEIVER.parseDptState(a,b):null};var Ia=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_weather4"};util.inherits(Ia,h);Ia.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WEATHER_TRANSMIT.getReadableDpts())&&
c.forEach(function(b){-1==b.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ia.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=c.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Ia.prototype.parseDptState=function(f,
a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.WEATHER_TRANSMIT.parseDptState(a,b):null};var la=function(f,a,b){h.call(this,f,a,b);this.channel=2;this.legacyType="ip_direction"};util.inherits(la,
h);la.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b});f.push({channel:a.deviceAdr+":3",dpt:b})});return f};la.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];
switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "ch2State":b.channel=a+":2";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":b.channel=a+":3";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":b.channel=a+":4";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;default:b.channel=a+":2";f=c.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getDptFromState(f);
if(!f)return null;b.dataPoint=f}return b};la.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(2==f){if(a=e.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,
b))c={},"undefined"!=typeof a.current_direction&&(c.current_passage_r2l=a.current_direction),"undefined"!=typeof a.last_direction&&(c.last_passage_r2l=a.last_direction),"undefined"!=typeof a.passage_counter&&(c.r2l_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&(c.r2l_passage_counter_overflow=a.passage_counter_overflow);return c}if(3==f){if(a=e.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,b))c={},"undefined"!=typeof a.current_direction&&(c.current_passage_l2r=
a.current_direction),"undefined"!=typeof a.last_direction&&(c.last_passage_l2r=a.last_direction),"undefined"!=typeof a.passage_counter&&(c.l2r_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&(c.l2r_passage_counter_overflow=a.passage_counter_overflow);return c}return null};la.prototype.parseStates=function(f){var a={},b;for(b in f){var c=this.parseChnState(b,f[b]);c&&(a=x.hub.m.hm._Util.mergeObj(a,c))}a.current_passage_r2l&&a.current_passage_l2r&&(a.current_direction=
a.current_passage_r2l.value?{value:"right_to_left",time:a.current_passage_r2l.time}:{value:"left_to_right",time:a.current_passage_l2r.time});a.last_passage_r2l&&a.last_passage_l2r&&(a.last_direction=a.last_passage_r2l.value?{value:"right_to_left",time:a.last_passage_r2l.time}:{value:"left_to_right",time:a.last_passage_l2r.time});delete a.current_passage_r2l;delete a.current_passage_l2r;delete a.last_passage_r2l;delete a.last_passage_l2r;return a};var K=function(f,a,b){h.call(this,f,a,b);this.channel=
1;this.legacyType="ip_button8"};util.inherits(K,h);K.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};K.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);
break;default:return null}return b};K.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==f||2==f||3==f||4==f||5==f||6==f||7==f||8==f)if(a=e.KEY_TRANRECEIVER.parseDptState(a,
b))c||(c={}),a.pressShort&&(c["btn"+f+"pressShort"]=!0),a.pressLong&&(c["btn"+f+"pressLong"]=!0);return c};K.prototype.isButton=function(){return!0};K.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,f,function(){c._claimButtonEvent(2,f,function(){c._claimButtonEvent(3,f,function(){c._claimButtonEvent(4,f,function(){c._claimButtonEvent(5,f,function(){c._claimButtonEvent(6,f,function(){c._claimButtonEvent(7,
f,function(){c._claimButtonEvent(8,f,function(){a&&a()})})})})})})})})};K.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(e,g){e&&console.error("button:"+f+" claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var Ja=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_generic_input"};util.inherits(Ja,h);Ja.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].GENERIC_INPUT_TRANSMITER.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};Ja.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];b.channel=a+":"+this.channel;f=c.GENERIC_INPUT_TRANSMITER.getDptFromState(f);if(!f)return null;b.dataPoint=
f;return b};Ja.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?c.GENERIC_INPUT_TRANSMITER.parseDptState(a,b):null};var ma=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_analog_output"};util.inherits(ma,h);ma.prototype._getReadableDpts=function(){var f=
[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};ma.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "outputLevel":b.channel=a+":"+this.channel;b.dataPoint=c.ANALOG_OUTPUT_TRANSCEIVER.getDptFromState("outputLevel");break;default:return null}return b};ma.prototype.executeCommand=
function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,function(a,f){b&&b(a,f)})};ma.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];e=null;f==this.channel&&(e=c.ANALOG_OUTPUT_TRANSCEIVER.parseDptState(a,b));
return e};var Ka=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_water"};util.inherits(Ka,h);Ka.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WATER_DETECTION_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ka.prototype._getDptFromRef=function(f){var a=this.deviceAdr,
b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(f);break;case "alarm":case "moisture":case "water":b.channel=a+":1";b.dataPoint=c.WATER_DETECTION_TRANSMITTER.getDptFromState(f);break;default:return null}return b};Ka.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");
-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.WATER_DETECTION_TRANSMITTER.parseDptState(a,b):null};var La=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_acce"};util.inherits(La,h);La.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();
c&&c.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.ACCELERATION_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};La.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "volatage":case "errorCode":case "sensorError":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);
break;case "motion":b.channel=a+":1";b.dataPoint=c.ACCELERATION_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};La.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a||"SENSOR_ERROR"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==f?c.ACCELERATION_TRANSCEIVER.parseDptState(a,b):null};var A=function(f,a,b){h.call(this,f,a,b);this.channel=1;this.legacyType="ip_garagedoor"};util.inherits(A,h);A.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};A.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+
":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "voltage":case "errorCode":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};A.prototype.executeCommand=function(f,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var e=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"onFor0.5",b);break;default:"onFor"==a.substr(0,5)?(e=this.deviceAdr+":3",
c.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,a,b)):b&&b(Error("no such command"))}};A.prototype.parseDptState=function(f,a,b){var c=f.indexOf(":");if(-1==c)return null;var e=f.substr(0,c);f=f.substr(c+1);var g=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(g=this.deviceAdr.substr(0,c));if(e!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+
a.toLowerCase()]=b;return c}if(1==f){if(a=e.KEY_TRANRECEIVER.parseDptState(a,b))c||(c={}),a.pressShort&&(c.btnPressShort=!0),a.pressLong&&(c.btnPressLong=!0);return c}return null};A.prototype.isButton=function(){return!0};A.prototype.claimEvent=function(f,a){this._claimButtonEvent(1,f,function(){a&&a()})};A.prototype._claimButtonEvent=function(f,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(e,g){e&&console.error("button:"+f+" claim PRESS_SHORT event error:"+
e.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+f,"PRESS_LONG",function(a,c){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var Sa=function(){var f=function(a,b,c){h.call(this,a,b,c);this._chMaintenance=0;this._chKeyTransceiver1=1;this._chKeyTransceiver2=2;this._chSwitchTransmitter3=3;this._chSwitchVirtualReceiver4=4;this._chDimmerTransmitter7=7;this._chDimmerVirtualReceiver8=8;this._chDimmerTransmitter11=11;this._chDimmerVirtualReceiver12=12;this._chDimmerWeekProfile=
15;this.legacyType="ip_bsl"};util.inherits(f,h);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this._chSwitchTransmitter3,dpt:"STATE"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"COLOR"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"COLOR"}]};
f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "state":b.channel+=this._chSwitchTransmitter3;b.dataPoint="STATE";break;case "led1Level":b.channel+=this._chDimmerTransmitter7;b.dataPoint="LEVEL";break;case "led1Color":b.channel+=this._chDimmerTransmitter7;b.dataPoint="COLOR";break;case "led2Level":b.channel+=this._chDimmerTransmitter11;b.dataPoint="LEVEL";break;case "led2Color":b.channel+=
this._chDimmerTransmitter11;b.dataPoint="COLOR";break;default:return null}return b};f.prototype.executeCommand=function(a,b,c){var f=x.hub.m.hm._Channel["HmIP-RF"],e=this.getSerial();var g=b;if(-1!=b.indexOf("dimUp")){var k=b.indexOf("dimUp");g=b.substr(0,k+5);k=b.substr(k)}else-1!=b.indexOf("dimDown")?(k=b.indexOf("dimDown"),g=b.substr(0,k+7),k=b.substr(k)):-1!=b.indexOf("dimTo")?(k=b.indexOf("dimTo"),g=b.substr(0,k+5),k=b.substr(k)):-1!=b.indexOf("toggleTo")?(k=b.indexOf("toggleTo"),g=b.substr(0,
k+8),k=b.substr(k)):-1!=b.indexOf("colorTo")&&(k=b.indexOf("colorTo"),g=b.substr(0,k+7),k=b.substr(k));switch(g){case "on":case "off":case "toggle":b=e+":"+this._chSwitchVirtualReceiver4;f.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,g,c);break;case "led1on":case "led1off":case "led1dimUp":case "led1dimDown":case "led1dimTo":case "led1toggleTo":case "led1colorTo":case "led2on":case "led2off":case "led2dimUp":case "led2dimDown":case "led2dimTo":case "led2toggleTo":case "led2colorTo":b=
"led1"==g.substr(0,4)?e+":"+this._chDimmerVirtualReceiver12:e+":"+this._chDimmerVirtualReceiver8;"led1on"==g?k="dimTo100":"led1off"==g?k="dimOff":"led2on"==g?k="dimTo100":"led2off"==g&&(k="dimOff");f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,k,c);break;default:"onFor"==g.substr(0,5)?(b=e+":"+this._chSwitchVirtualReceiver4,f.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,g,c)):c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==
f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;e=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return e.MAINTENANCE.parseDptState(b,c);default:var g={};g["0_"+b.toLowerCase()]=c;return g}case this._chKeyTransceiver1:case this._chKeyTransceiver2:if(c=e.KEY_TRANRECEIVER.parseDptState(b,c))g||(g={}),c.pressShort&&(g["btn"+a+"pressShort"]=!0),c.pressLong&&(g["btn"+a+"pressLong"]=!0);return g;case this._chSwitchTransmitter3:switch(b){case "STATE":if(c=
e.SWITCH_TRANSMITTER.parseDptState(b,c))g={},g.state=c.switchTState;return g;default:return null}case this._chDimmerTransmitter7:if(c=e.DIMMER_TRANSMITTER.parseDptState(b,c))g={},"LEVEL"==b?g.led2Level=c.dimmerTLevel:"COLOR"==b&&(g.led2Color=c.dimmerTColor);return g;case this._chDimmerTransmitter11:if(c=e.DIMMER_TRANSMITTER.parseDptState(b,c))g={},"LEVEL"==b?g.led1Level=c.dimmerTLevel:"COLOR"==b&&(g.led1Color=c.dimmerTColor);return g;default:return null}};f.prototype.isButton=function(){return!0};
f.prototype.claimEvent=function(a,b){var c=this.getSerial(),f=this;a.reportValueUsage(this.deviceIF,c+":"+this._chKeyTransceiver1,"PRESS_SHORT",function(e,g){e&&console.error("button:1 claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(f.deviceIF,c+":"+f._chKeyTransceiver1,"PRESS_LONG",function(e,g){e&&console.error("button:1 claim PRESS_LONG event error:"+e.stack);a.reportValueUsage(f.deviceIF,c+":"+f._chKeyTransceiver2,"PRESS_SHORT",function(e,g){e&&console.error("button:2 claim PRESS_SHORT event error:"+
e.stack);a.reportValueUsage(f.deviceIF,c+":"+f._chKeyTransceiver2,"PRESS_LONG",function(a,c){a&&console.error("button:2 claim PRESS_LONG event error:"+a.stack);b&&b()})})})})};return f}(),Ta=function(){var f=function(a,b,c){h.call(this,a,b,c);this._chMaintenance=0;this._chDoorReceiver=1;this._chSimpleSwitchReceiver=2;this.legacyType="ip_tormatic"};util.inherits(f,h);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+
":"+this._chDoorReceiver,dpt:"DOOR_STATE"},{channel:this.deviceAdr+":"+this._chSimpleSwitchReceiver,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "doorState":b.channel+=this._chDoorReceiver;b.dataPoint="DOOR_STATE";break;case "lightState":b.channel+=this._chSimpleSwitchReceiver;b.dataPoint="STATE";break;default:return null}return b};f.prototype.executeCommand=
function(a,b,c){var f=x.hub.m.hm._Channel["HmIP-RF"],e=this.getSerial();switch(b){case "open":case "close":case "partialOpen":case "stop":e=e+":"+this._chDoorReceiver;f.DOOR_RECEIVER.executeCommand(a,this.deviceIF,e,b,c);break;case "lightOn":case "lightOff":case "lightToggle":b=b.substr(5).toLowerCase();e=e+":"+this._chSimpleSwitchReceiver;f.SIMPLE_SWITCH_RECEIVER.executeCommand(a,this.deviceIF,e,b,c);break;default:c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");
if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;e=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return e.MAINTENANCE.parseDptState(b,c);default:var g={};g["0_"+b.toLowerCase()]=c;return g}case this._chDoorReceiver:return(b=e.DOOR_RECEIVER.parseDptState(b,c))&&(g=b),g;case this._chSimpleSwitchReceiver:if(b=e.SIMPLE_SWITCH_RECEIVER.parseDptState(b,c))g={},g.lightState=b.state;return g;default:return null}};
return f}(),Ua=function(){var f=function(a,b,c){h.call(this,a,b,c);this._chMaintenance=0;this._chBrightness=1;this.legacyType="ip_lux"};util.inherits(f,h);f.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],f=c.MAINTENANCE_BAT_EL.getReadableDpts();f&&f.forEach(function(c){"SABOTAGE"!=c&&"ERROR_CODE"!=c&&"SENSOR_ERROR"!=c&&a.push({channel:b.deviceAdr+":0",dpt:c})});(f=c.BRIGHTNESS_TRANSMITTER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+
":1",dpt:c})});return a};f.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "volatage":c.channel=b+":0";c.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "illu":case "avgIllu":case "maxIllu":case "minIllu":c.channel=b+":1";c.dataPoint=f.BRIGHTNESS_TRANSMITTER.getDptFromState(a);break;default:return null}return c};f.prototype.parseDptState=function(a,b,c){var f=
a.indexOf(":");if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);var g=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(g=this.deviceAdr.substr(0,f));if(e!=g)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(0==a){if("UNREACH"==b||"LOW_BAT"==b||"OPERATING_VOLTAGE"==b)return f.MAINTENANCE_BAT_EL.parseDptState(b,c);f={};f["0_"+b.toLowerCase()]=c;return f}return 1==a?f.BRIGHTNESS_TRANSMITTER.parseDptState(b,c):null};return f}(),Va=function(){var f=function(a,b,c){h.call(this,a,b,c);this._chMaintenance=
0;this._chPowerMainsTransmitter=1;this.legacyType="ip_pmfs"};util.inherits(f,h);f.prototype._getReadableDpts=function(){var a=this.getSerial(),b=[],c=this,f=x.hub.m.hm._Channel["HmIP-RF"],e=f.MAINTENANCE.getReadableDpts();e&&e.forEach(function(f){"UNREACH"==f&&b.push({channel:a+":"+c._chMaintenance,dpt:f})});(e=f.POWER_MAINS_TRANSMITTER.getReadableDpts())&&e.forEach(function(f){b.push({channel:a+":"+c._chPowerMainsTransmitter,dpt:f})});return b};f.prototype._getDptFromRef=function(a){var b=this.getSerial(),
c={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":c.channel=b+":"+this._chMaintenance;c.dataPoint=f.MAINTENANCE.getDptFromState(a);break;case "powerMainsFailure":c.channel=b+":"+this._chPowerMainsTransmitter;c.dataPoint=f.POWER_MAINS_TRANSMITTER.getDptFromState(a);break;default:return null}return c};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);var g=this.deviceAdr;f=this.deviceAdr.indexOf(":");
-1!=f&&(g=this.deviceAdr.substr(0,f));if(e!=g)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(a==this._chMaintenance){if("UNREACH"==b)return f.MAINTENANCE.parseDptState(b,c);f={};f["0_"+b.toLowerCase()]=c;return f}return a==this._chPowerMainsTransmitter?f.POWER_MAINS_TRANSMITTER.parseDptState(b,c):null};return f}(),Pa=function(){var f=function(a,b,c){h.call(this,a,b,c);this._chKeyTransceivers=[1];this._chMaintenance=0;this._chMaintenanceDpts=["UNREACH","LOW_BAT"];this.legacyType=1==this._chKeyTransceivers.length?
"ip_button":"ip_button"+this._chKeyTransceivers};util.inherits(f,h);f.prototype._getReadableDpts=function(){var a=[],b=this,c=this.getSerial(),f=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getReadableDpts();f&&f.forEach(function(f){-1!=b._chMaintenanceDpts.indexOf(f)&&a.push({channel:c+":"+b._chMaintenance,dpt:f})});return a};f.prototype._getDptFromRef=function(a){return(a=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getDptFromState(a))?{channel:this.getSerial()+":"+this._chMaintenance,dataPoint:a}:
null};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var e=x.hub.m.hm._Channel["HmIP-RF"],g=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(g!=f)return null;if(parseInt(a)==this._chMaintenance){if(-1!=this._chMaintenanceDpts.indexOf(b))return e.T_MAINTENANCE.parseDptState(b,c);var k={};k["0_"+b.toLowerCase()]=c;return k}if(-1!=this._chKeyTransceivers.indexOf(parseInt(a))){if(tmp=e.KEY_TRANRECEIVER.parseDptState(b,c))k={},1==this._chKeyTransceivers.length?k=
tmp:(tmp.pressShort&&(k["btn"+a+"pressShort"]=!0),tmp.pressLong&&(k["btn"+a+"pressLong"]=!0));return k}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(a,b){var c=0,f=this,e=function(){c++;c<f._chKeyTransceivers.length?f._claimButtonEvent(f._chKeyTransceivers[c],a,e):b&&b()};this._claimButtonEvent(this._chKeyTransceivers[c],a,e)};f.prototype._claimButtonEvent=function(a,b,c){var f=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+a,"PRESS_SHORT",function(e,g){e&&
console.error("button:"+a+" claim PRESS_SHORT event error:"+e.stack);b.reportValueUsage(f.deviceIF,f.deviceAdr+":"+a,"PRESS_LONG",function(b,f){b&&console.error("button:"+a+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};f.parse=function(a){var b=null,c=a.address,e=a.address.indexOf(":");-1!=e&&(b=a.address.substr(e+1),c=a.address.substr(0,e));e=null;switch(a.type){case "HmIP-MOD-OC8":e=new f(a.type,a.interface,c),e._chMaintenance=0,e._chMaintenanceDpts=["UNREACH","OPERATING_VOLTAGE"],e._chKeyTransceivers=
[parseInt(b)]}return e};f.resolve=function(a,b){return"HmIP-MOD-OC8"==a?this._resolveIPMultiButton(a,b,1,8,["UNREACH","OPERATING_VOLTAGE"]):"HmIP-RCV-50"==a.substr(0,11)?this._resolveIPMultiButton(a,b,1,50,null):null};f._resolveIPMultiButton=function(a,b,c,e,g){var k,h=[];for(k=0;k<e;k++){var l=new f(a,b.interface,b.address+":"+(k+c));l._chMaintenance=0;g&&(l._chMaintenanceDpts=g);l._chKeyTransceivers=[k+c];h.push(l)}return h};return f}(),P=function(){var f=function(a,b,c){h.call(this,a,b,c);this.channel=
1;this._chMaintenance=0;this._chSwitchVirtualReceiver1=2;this._chSwitchVirtualReceiver2=3;this._chSwitchVirtualReceiver3=4;this._chSwitchWeekProfile=5;this.legacyType="ip_switch"};util.inherits(f,h);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;
b.dataPoint="UNREACH";break;case "state":b.channel+=this.channel;b.dataPoint="STATE";break;default:return null}return b};f.prototype.executeCommand=function(a,b,c){var f=this.getSerial(),e=this;switch(b){case "on":var g="STATE";var k=f+":"+this._chSwitchVirtualReceiver1;a.writeValue(this.deviceIF,k,g,!0,c);break;case "off":g="STATE";k=f+":"+this._chSwitchVirtualReceiver1;a.writeValue(this.deviceIF,k,g,!1,c);break;case "toggle":g="STATE";k=f+":"+this.channel;a.getState({interface:this.deviceIF,channel:k,
datapoint:g},function(b,h){b?c&&c(b):h?(b=!0,h.value&&(b=!1),g="STATE",k=f+":"+e._chSwitchVirtualReceiver1,a.writeValue(e.deviceIF,k,g,b,c)):c&&c(Error("get switch current value return invalid"))});break;default:"onFor"==b.substr(0,5)?(b=parseFloat(b.substr(5)),isNaN(b)?c&&c(Error("onFor command invalid")):(g="ON_TIME",k=f+":"+e._chSwitchVirtualReceiver1,a.writeValue(this.deviceIF,k,g,{type:"double",value:b},function(b){b?c&&c(b):(g="STATE",k=f+":"+e._chSwitchVirtualReceiver1,a.writeValue(e.deviceIF,
k,g,!0,c))}))):c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return{timeout:c};default:return e={},e["0_"+b.toLowerCase()]=c,e}case this.channel:switch(b){case "STATE":return{state:1==c?"on":"off"};default:return null}default:return null}};f.parse=function(a){var b=null,c=a.address.indexOf(":");
-1!=c&&(b=a.address.substr(c+1));c=null;switch(a.type){case "HmIP-MOD-OC8":c=this._parseTSwitch(a,b,41)}return c};f._parseTSwitch=function(a,b,c){a=new f(a.type,a.interface,a.address);a._chMaintenance=0;a.channel=parseInt(b);a._chSwitchVirtualReceiver1=a.channel+1;a._chSwitchVirtualReceiver2=a.channel+2;a._chSwitchVirtualReceiver3=a.channel+3;a._chSwitchWeekProfile=c;return a};f.resolve=function(a,b){var c=[];if("HmIP-MOD-OC8"==a)for(i=0;8>i;i++)d=new f(a,b.interface,b.address+":"+(4*i+9)),d._chMaintenance=
0,d.channel=4*i+9,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=41,c.push(d);return c};return f}(),Qa=function(){var f=function(a,b,c){h.call(this,a,b,c);this.channel=1;this._chMaintenance=0;this._chDimmerVirtualReceiver1=2;this._chDimmerVirtualReceiver2=3;this._chDimmerVirtualReceiver3=4;this._chDimmerWeekProfile=13;this.legacyType="ip_dimmer"};util.inherits(f,h);f.prototype._getReadableDpts=function(){var a=
[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],f=c.MAINTENANCE.getReadableDpts();f&&f.forEach(function(c){"UNREACH"==c&&a.push({channel:b.deviceAdr+":"+b._chMaintenance,dpt:c})});(f=c.DIMMER_TRANSMITTER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(f=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver1,dpt:c});a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver2,dpt:c});a.push({channel:b.deviceAdr+
":"+b._chDimmerVirtualReceiver3,dpt:c})});return a};f.prototype._getDptFromRef=function(a){var b=this.getSerail(),c={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":c.channel=b+":"+this._chMaintenance;c.dataPoint=f.MAINTENANCE.getDptFromState(a);break;case "dimmerLevel":c.channel=b+":"+this.channel;c.dataPoint=f.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;default:return null}return c};f.prototype.executeCommand=function(a,b,c){var f=x.hub.m.hm._Channel["HmIP-RF"],
e=b;if(-1!=b.indexOf("dimUp")){var g=b.indexOf("dimUp");e=b.substr(0,g+5);var k=b.substr(g+5)}else-1!=b.indexOf("dimDown")?(g=b.indexOf("dimDown"),e=b.substr(0,g+7),k=b.substr(g+7)):-1!=b.indexOf("dimTo")?(g=b.indexOf("dimTo"),e=b.substr(0,g+5),k=b.substr(g+5)):-1!=b.indexOf("toggleTo")&&(g=b.indexOf("toggleTo"),e=b.substr(0,g+8),k=b.substr(g+8));var h=this.getSerial(),l=this;switch(e){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,h+":"+this._chDimmerVirtualReceiver1,"dimOff",
c);break;case "dimUp":k=k?parseInt(k)/100:.1;a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(k=e.value+k,1<k&&(k=1),k=Math.round(100*k),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,h+":"+l._chDimmerVirtualReceiver1,"dimTo"+k,c))});break;case "dimDown":k=k?parseInt(k)/100:.1;a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},
function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(k=e.value-k,0>k&&(k=0),k=Math.round(100*k),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,h+":"+l._chDimmerVirtualReceiver1,"dimTo"+k,c))});break;case "dimTo":if(!k){c&&c(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,h+":"+l._chDimmerVirtualReceiver1,"dimTo"+k,channel);break;case "toggleTo":if(!k){c&&c(Error("toggle has no value"));break}a.getState({interface:this.deviceIF,
channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(e.value&&(k=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,h+":"+l._chDimmerVirtualReceiver1,"dimTo"+k,c))});break;default:c&&c(Error("no such command"))}};f.prototype.parseDptState=function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];
e=null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return f.MAINTENANCE.parseDptState(b,c);default:return e={},e["0_"+b.toLowerCase()]=c,e}case this.channel:if(b=f.DIMMER_TRANSMITTER.parseDptState(b,c))e={},e.dimmerLevel=b.dimmerTLevel;return e}return null};return f}(),Ra=function(){var f=function(a,b,c){h.call(this,a,b,c);this.channel=1;this._chMaintenance=0;this._chBlindVirtualReceiver1=2;this._chBlindVirtualReceiver2=3;this._chBlindVirtualReceiver3=4;this._chBlindWeekProfile=
5;this.legacyType="ip_jalousie"};util.inherits(f,h);f.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],f=c.MAINTENANCE.getReadableDpts();f&&f.forEach(function(c){"UNREACH"==c&&a.push({channel:b.deviceAdr+":"+b._chMaintenance,dpt:c})});(f=c.BLIND_TRANSMITTER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(f=c.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(c){a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver1,
dpt:c});a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver2,dpt:c});a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver3,dpt:c})});return a};f.prototype._getDptFromRef=function(a){var b=this.getSerial(),c={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":c.channel=b+":"+this._chMaintenance;c.dataPoint=f.MAINTENANCE.getDptFromState(a);break;case "blindLevel":c.channel=b+":"+this.channel;c.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("blindTPos");
break;case "lamellaLevel":c.channel=b+":"+this.channel;c.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;default:return null}return c};f.prototype.executeCommand=function(a,b,c){var f=x.hub.m.hm._Channel["HmIP-RF"],e=b;if(-1!=b.indexOf("stepUp")){var g=b.indexOf("stepUp");e=b.substr(0,g+6);var k=b.substr(g+6)}else-1!=b.indexOf("stepDown")?(g=b.indexOf("stepDown"),e=b.substr(0,g+8),k=b.substr(g+8)):-1!=b.indexOf("moveTo")?(g=b.indexOf("moveTo"),e=b.substr(0,g+6),k=b.substr(g+6)):
-1!=b.indexOf("stop")?(g=b.indexOf("stop"),e=b.substr(0,g+4),k=b.substr(g+4)):-1!=b.indexOf("lamellaStepUp")?(g=b.indexOf("lamellaStepUp"),e=b.substr(0,g+13),k=b.substr(g+13)):-1!=b.indexOf("lamellaStepDown")?(g=b.indexOf("lamellaStepDown"),e=b.substr(0,g+15),k=b.substr(g+15)):-1!=b.indexOf("lamellaTo")&&(g=b.indexOf("lamellaTo"),e=b.substr(0,g+9),k=b.substr(g+9));var h=this.getSerial(),l=this;switch(e){case "stop":case "moveUp":case "moveDown":f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,
h+":"+this._chBlindVirtualReceiver1,e,c);break;case "lamellaUp":case "lamellaDown":a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,g){b?c&&c(b):"undefined"==typeof g||null==g?c&&c(Error("get blind current value return invalid")):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,h+":"+this._chBlindVirtualReceiver1,"lamellaTo"+(e=100),function(b){b?c&&c(b):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,h+":"+l._chBlindVirtualReceiver1,"moveTo"+
Math.round(100*g.value),c)})});break;case "stepUp":case "stepDown":k=k?parseInt(k)/100:.05;a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,g){b?c&&c(b):"undefined"==typeof g||null==g?c&&c(Error("get blind current value return invalid")):(k="stepUp"==e?g.value+k:g.value-k,1<k&&(k=1),0>k&&(k=0),k=Math.round(100*k),f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,h+":"+l._chBlindVirtualReceiver1,"moveTo"+k,c))});break;case "moveTo":if(!k){c&&c(Error("moveTo has no value"));
break}f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,h+":"+this._chBlindVirtualReceiver1,"moveTo"+k,c);break;case "lamellaStepUp":case "lamellaStepDown":k=k?parseInt(k)/100:.05;a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,g){if(b)c&&c(b);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var m=g.value;m=Math.round(100*m);a.getState({interface:l.deviceIF,channel:h+":"+l.channel,datapoint:"LEVEL_2"},
function(b,g){b?c&&c(b):"undefined"==typeof g||null==g?c&&c(Error("get lamella current value return invalid")):(k="lamellaStepUp"==e?g.value+k:g.value-k,1<k&&(k=1),0>k&&(k=0),k=Math.round(100*k),f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,h+":"+l._chBlindVirtualReceiver1,"lamellaTo"+k,function(b,e){b?c&&c(b,e):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,h+":"+l._chBlindVirtualReceiver1,"moveTo"+m,c)}))})}});break;case "lamellaTo":if(!k){c&&c(Error("lamellaTo has no value"));break}a.getState({interface:this.deviceIF,
channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,e){if(b)c&&c(b);else if("undefined"==typeof e||null==e)c&&c(Error("get blind current value return invalid"));else{var g=e.value;g=Math.round(100*g);f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,h+":"+l._chBlindVirtualReceiver1,"lamellaTo"+k,function(b){b?c&&c(b):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,h+":"+l._chBlindVirtualReceiver1,"moveTo"+g,c)})}});break;default:c&&c(Error("no such command"))}};f.prototype.parseDptState=
function(a,b,c){var f=a.indexOf(":");if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];e=null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return f.MAINTENANCE.parseDptState(b,c);default:return e={},e["0_"+b.toLowerCase()]=c,e}case this.channel:if(c=f.BLIND_TRANSMITTER.parseDptState(b,c))e={},"LEVEL"==b?e.blindLevel=c.blindTPos:"LEVEL_2"==b&&(e.lamellaLevel=c.lamellaTPos);return e}return null};
f.prototype.getConfig=function(a,b){var c=this.getSerial()+":"+this.channel;a.getParamset(this.deviceIF,c,"MASTER",function(a,f){if(a)b&&b(a);else{var e={},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,
REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});e[c]=g;b&&b(a,e)}})};f.prototype.setConfig=function(a,b,c){if(b){var f=this.getSerial()+":"+this.channel;if(b=b[f]){var e={};e.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};e.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",
__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};e.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_UNIT};
e.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_VALUE};a.setParamset(this.deviceIF,f,"MASTER",e,function(b){c&&c(b)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};return f}(),Q=function(){var f=function(b,a,f){h.call(this,b,a,f);this.channel=1;this._chMaintenance=0;this.legacyType="ip_multi_input"};util.inherits(f,h);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,
dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(b){var a={channel:this.getSerial()+":",dataPoint:null};switch(b){case "timeout":a.channel+=this._chMaintenance;a.dataPoint="UNREACH";break;case "state":a.channel+=this.channel;a.dataPoint="STATE";break;default:return null}return a};f.prototype.parseDptState=function(a,c,f){var b=a.indexOf(":");if(-1==b)return null;var e=a.substr(0,b);a=a.substr(b+1);b=this.getSerial();if(e!=b)return null;e=x.hub.m.hm._Channel["HmIP-RF"];
switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":return{timeout:f};default:return e={},e["0_"+c.toLowerCase()]=f,e}case this.channel:switch(c){case "STATE":return{state:1==f?"on":"off"};case "PRESS_SHORT":case "PRESS_LONG":return e.KEY_TRANRECEIVER.parseDptState(c,f);default:return null}default:return null}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(a,c){this._claimButtonEvent(this.channel,a,function(){c&&c()})};f.prototype._claimButtonEvent=function(a,
c,f){var b=this.getSerial()+":"+a,e=this;c.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(g,k){g&&console.error("button:"+a+" claim PRESS_SHORT event error:"+g.stack);c.reportValueUsage(e.deviceIF,b,"PRESS_LONG",function(b,c){b&&console.error("button:"+a+" claim PRESS_LONG event error:"+b.stack);f&&f()})})};var a=function(a,c,e){f.call(this,a,c,e);this.legacyType="ip_multi_input_bat"};util.inherits(a,f);a.prototype._getReadableDpts=function(){for(var a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts,
c=x.hub.m.hm._Channel["HmIP-RF"].MULTI_MODE_INPUT_TRANSMITTER.getReadableDpts,f=[],e=0;e<a.length;e++)f.push({channel:this.deviceAdr+":"+this._chMaintenance,dpt:a[e]});for(e=0;e<c.length;e++)f.push({channel:this.deviceAdr+":"+this.channel,dpt:c[e]});return f};a.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "voltage":case "errorCode":b.channel+=this._chMaintenance;b.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(a);
break;case "state":b.channel+=this.channel;b.dataPoint=f.MULTI_MODE_INPUT_TRANSMITTER.getDptFromState(a);break;default:return null}return b};a.prototype.parseDptState=function(a,c,f){var b=a.indexOf(":");if(-1==b)return null;var e=a.substr(0,b);a=a.substr(b+1);b=this.getSerial();if(e!=b)return null;e=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":case "LOW_BAT":case "OPERATING_VOLTAGE":case "ERROR_CODE":return e.MAINTENANCE_BAT_EL.parseDptState(c,
f);default:return e={},e["0_"+c.toLowerCase()]=f,e}case this.channel:switch(c){case "STATE":case "PRESS_SHORT":case "PRESS_LONG":return e.MULTI_MODE_INPUT_TRANSMITTER.parseDptState(c,f);default:return null}default:return null}};f.resolve=function(b,c){if("HmIP-FCI"==b.substr(0,8)){var e=parseInt(b.substr(8));var g=a}else"HmIP-MOD-RC"==b.substr(0,11)?(e=parseInt(b.substr(11)),g=a):"HmIPW-DRI"==b.substr(0,9)&&(e=parseInt(b.substr(9)),g=f);return this._resolveIPMultiInput(b,c,e,g)};f._resolveIPMultiInput=
function(a,c,f,e){var b,g=[];for(b=0;b<f;b++){var k=new e(a,c.interface,c.address+":"+(b+1));k._chMaintenance=0;k.channel=b+1;g.push(k)}return g};f.parse=function(b){var c=null,f=b.address,e=b.address.indexOf(":");-1!=e&&(c=b.address.substr(e+1),f=b.address.substr(0,e));e=Q;if("HmIP-FCI1"==b.type||"HmIP-FCI6"==b.type||"HmIP-MOD-RC8"==b.type)e=a;b=new e(b.type,b.interface,f);b._chMaintenance=0;b.channel=parseInt(c);return b};return f}(),t={};t.CLASS_MAP={maintenance:e,button:n,vbutton:g,switch:k,dimmer:l,
blind:q,powerswitch:m,weather:r,heater:w,heater2:u,heater3:na,wallthermo:R,wallthermo2:S,contact:oa,weatherstation:v,rain:T,gong2:B,gong:Ma,window:pa,temp:qa,co2:sa,motion:ta,smoke:ua,siren:U,capacity:va,switch_interface:L,tilt:wa,temp2:ra,water:xa,weather2:p,energymeter:ya,rgb:M,lux:za,siren2:V,jalousie:W,mod_em_8bit:C,mod_em_8:D,keymatic:X,ou_led16:E,hm_dis_ep_wm55:Na,dualwhite:Y};t.CLASS_MAP_IP={ip_switch:Oa,ip_contact:Aa,ip_heater:Z,ip_powerswitch:aa,ip_energyactor:ba,ip_dimmer:da,ip_motion:ha,
ip_motion2:F,ip_button2:O,ip_siren:ia,ip_wallthermo:z,ip_smoke:ja,ip_window:Ca,ip_button4:G,ip_dimmer2:ea,ip_energyactor2:ca,ip_blind:I,ip_jalousie:J,ip_presence:ka,ip_dimmer3:fa,ip_wallthermo2:Ba,ip_floor_heater:Da,ip_floor_pump_heater:Ea,ip_button6:H,ip_weather:Fa,ip_weather2:Ga,ip_weather3:Ha,ip_weather4:Ia,ip_direction:la,ip_button8:K,ip_generic_input:Ja,ip_analog_output:ma,ip_water:Ka,ip_acce:La,ip_garagedoor:A,ip_bsl:Sa,ip_tormatic:Ta,ip_button:N,ip_lux:Ua,ip_pmfs:Va};t.parseJson=function(f){if(!(f&&
f.type&&f.interface&&f.address))return null;switch(f.interface){case "BidCos-RF":f=this._parseRFDeviceJson(f);break;case "HmIP-RF":f=this._parseIPDeviceJson(f);break;default:return null}return f};t._parseRFDeviceJson=function(f){var a=x.hub.m.hm.RFDeviceTypes[f.type];if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.RFDeviceCatagory[a];if(!a||!a.type)return null;var b=this.CLASS_MAP[a.type];if(!b)return null;a=null;var c=f.address.indexOf(":");-1!=c&&(a=f.address.substr(c+1));"HM-Dis-EP-WM55"==
f.type&&3==a&&(b=this.CLASS_MAP.hm_dis_ep_wm55);f=new b(f.type,f.interface,f.address);a&&(f.channel=parseInt(a));return f};t._parseIPDeviceJson=function(f){if("HmIPW"==f.type.substr(0,5))return this._parseIPW(f);if("HmIP-MIOB"==f.type)return t._parse_HMIP_MIOB(f);if("HmIP-FCI1"==f.type||"HmIP-FCI6"==f.type||"HmIP-MOD-RC8"==f.type)return Q.parse(f);var a=null,b=f.address.indexOf(":");-1!=b&&(a=f.address.substr(b+1));switch(f.type){case "HmIP-WHS2":return this._parseTSwitch(f,a,9);case "HmIP-MOD-OC8":return 8>=
parseInt(a)?Pa.parse(f):P.parse(f)}a=t._getIPMetaIndex(f.type);if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.IPDeviceCatagory[a];if(!a||!a.type)return null;var c=this.CLASS_MAP_IP[a.type];if(!c)return null;a=null;b=f.address.indexOf(":");-1!=b&&(a=f.address.substr(b+1));f=new c(f.type,f.interface,f.address);a&&(f.channel=parseInt(a));return f};t._parseIPW=function(f){var a=null;var b=f.address.indexOf(":");-1!=b&&(a=f.address.substr(b+1));return"HmIPW-DRS"==f.type.substr(0,9)?(b=parseInt(f.type.substr(9)),
f=new P(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chSwitchVirtualReceiver1=f.channel+1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=4*b+1,f):"HmIPW-DRD"==f.type.substr(0,9)?(b=parseInt(f.type.substr(9)),f=new Qa(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chDimmerVirtualReceiver1=f.channel+1,f._chDimmerVirtualReceiver2=f.channel+2,f._chDimmerVirtualReceiver3=f.channel+3,f._chDimmerWeekProfile=
4*b+1,f):"HmIPW-DRBL"==f.type.substr(0,10)?(b=parseInt(f.type.substr(10)),f=new Ra(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chBlindVirtualReceiver1=f.channel+1,f._chBlindVirtualReceiver2=f.channel+2,f._chBlindVirtualReceiver3=f.channel+3,f._chBlindWeekProfile=4*b+1,f):"HmIPW-DRI"==f.type.substr(0,9)?(parseInt(f.type.substr(9)),f=new Q(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f):"HmIPW-FIO"==f.type.substr(0,9)?(b=parseInt(f.type.substr(9)),
a=parseInt(a),a<=b?(f=new Q(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a)):(f=new P(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chSwitchVirtualReceiver1=f.channel+1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=b+4*b+1),f):null};t._parse_HMIP_MIOB=function(f){var a=f.address,b=null,c=f.address.indexOf(":");-1!=c&&(a=f.address.substr(0,c),b=f.address.substr(c+1));c=null;0==b?c=this.CLASS_MAP.maintenance:
3==b||7==b?c=this.CLASS_MAP_IP.ip_switch:9==b||10==b?c=this.CLASS_MAP_IP.ip_generic_input:11==b&&(c=this.CLASS_MAP_IP.ip_analog_output);return c?(f=new c(f.type,f.interface,a),f.channel=b,f):null};t._parseTSwitch=function(f,a,b){f=new P(f.type,f.interface,f.address);f._chMaintenance=0;f.channel=parseInt(a);f._chSwitchVirtualReceiver1=f.channel+1;f._chSwitchVirtualReceiver2=f.channel+2;f._chSwitchVirtualReceiver3=f.channel+3;f._chSwitchWeekProfile=b;return f};t.resolve=function(f){if(!f||!f.type||
!f.interface)return null;switch(f.interface){case "BidCos-RF":f=this._resolveRFFromType(f.type,f);break;case "HmIP-RF":f=this._resolveIPFromType(f.type,f);break;default:return null}return f?Array.isArray(f)?f:[f]:null};t._resolveRFFromType=function(f,a){if("HM-MOD-EM-8"==f)return this._resolve_HM_MOD_EM_8(f,a);if("HM-OU-LED16"==f)return this._resolve_HM_OU_LED16(f,a);if("HM-Dis-EP-WM55"==f)return this._resolve_HM_Dis_EP_WM55(f,a);var b=x.hub.m.hm.RFDeviceTypes[f];if("undefined"==typeof b||null==b)return null;
b=x.hub.m.hm.RFDeviceCatagory[b];if(!b||!b.type)return this._resolveRFFromTypeGeneral(f,a);var c=[];if(a.channels)for(var e in a.channels){var g=a.channels[e];g.type==b.channel&&c.push(g)}var k=this.CLASS_MAP[b.type];if(!k)return null;if("*"==b.channelNum){var h=[];c.forEach(function(b){var e=new k(f,a.interface,a.address),g=b.address.indexOf(":");1<c.length&&(e.deviceAdr=b.address);e.channel=b.address.substr(g+1);h.push(e)});return h}e=new k(f,a.interface,a.address);"undefined"!=typeof b.channelNum&&
null!=b.channelNum&&(e.channel=b.channelNum);return e};t._resolveIPFromType=function(f,a){if("HmIPW"==f.substr(0,5))return this._resolveIPW(f,a);if("HmIP-MOD-OC8"==f){var b=Pa.resolve(f,a),c=P.resolve(f,a);return b.concat(c)}if(0==f.indexOf("HmIP-FAL"))return t._resolve_HMIP_FAL_X(f,a);if(0==f.indexOf("HmIP-MIOB"))return t._resolve_HMIP_MIOB(f,a);switch(f){case "HmIP-WHS2":return this._resolveIPMultiSwitch(f,a,2);case "HmIP-FCI1":case "HmIP-FCI6":case "HmIP-MOD-RC8":return Q.resolve(f,a)}b=this._getIPMetaIndex(f);
if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.IPDeviceCatagory[b];if(!b||!b.type)return null;var e=[];if(a.channels)for(c in a.channels){var g=a.channels[c];g.type==b.channel&&e.push(g)}var k=this.CLASS_MAP_IP[b.type];if(!k)return null;if("*"==b.channelNum){var h=[];e.forEach(function(b){var c=new k(f,a.interface,a.address),g=b.address.indexOf(":");1<e.length&&(c.deviceAdr=b.address);c.channel=b.address.substr(g+1);h.push(c)});return h}c=new k(f,a.interface,a.address);"undefined"!=typeof b.channelNum&&
null!=b.channelNum&&(c.channel=b.channelNum);return c};t._resolveIPW=function(f,a){var b,c=[];if("HmIPW-DRS"==f.substr(0,9)){var e=parseInt(f.substr(9));c=this._resolveIPMultiSwitch(f,a,e)}else if("HmIPW-DRD"==f.substr(0,9))for(e=parseInt(f.substr(9)),b=0;b<e;b++){var g=new Qa(f,a.interface,a.address+":"+(4*b+1));g._chMaintenance=0;g.channel=4*b+1;g._chDimmerVirtualReceiver1=g.channel+1;g._chDimmerVirtualReceiver2=g.channel+2;g._chDimmerVirtualReceiver3=g.channel+3;g._chDimmerWeekProfile=4*e+1;c.push(g)}else if("HmIPW-DRBL"==
f.substr(0,10))for(e=parseInt(f.substr(10)),b=0;b<e;b++)g=new Ra(f,a.interface,a.address+":"+(4*b+1)),g._chMaintenance=0,g.channel=4*b+1,g._chBlindVirtualReceiver1=g.channel+1,g._chBlindVirtualReceiver2=g.channel+2,g._chBlindVirtualReceiver3=g.channel+3,g._chBlindWeekProfile=4*e+1,c.push(g);else if("HmIPW-DRI"==f.substr(0,9))for(e=parseInt(f.substr(9)),b=0;b<e;b++)g=new Q(f,a.interface,a.address+":"+(b+1)),g._chMaintenance=0,g.channel=b+1,c.push(g);else if("HmIPW-FIO"==f.substr(0,9))for(e=parseInt(f.substr(9)),
b=0;b<e;b++)g=new Q(f,a.interface,a.address+":"+(b+1)),g._chMaintenance=0,g.channel=b+1,c.push(g),g=new P(f,a.interface,a.address+":"+(4*b+e+1)),g._chMaintenance=0,g.channel=4*b+e+1,g._chSwitchVirtualReceiver1=g.channel+1,g._chSwitchVirtualReceiver2=g.channel+2,g._chSwitchVirtualReceiver3=g.channel+3,g._chSwitchWeekProfile=e+4*e+1,c.push(g);return c};t._resolveIPMultiSwitch=function(f,a,b){var c,e=[];for(c=0;c<b;c++){var g=new P(f,a.interface,a.address+":"+(4*c+1));g._chMaintenance=0;g.channel=4*
c+1;g._chSwitchVirtualReceiver1=g.channel+1;g._chSwitchVirtualReceiver2=g.channel+2;g._chSwitchVirtualReceiver3=g.channel+3;g._chSwitchWeekProfile=4*b+1;e.push(g)}return e};t._resolveRFFromTypeGeneral=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,e;for(e in c){var g=c[e];if(g&&g.type&&x.hub.m.hm._Channel["BidCos-RF"][g.type]&&(g=x.hub.m.hm._Channel["BidCos-RF"][g.type].device)&&(g=this.CLASS_MAP[g])){g=new g(f,a.interface,e);var k=e.indexOf(":");g.channel=e.substr(k+1);b.push(g)}}return b};
t._resolve_HM_MOD_EM_8=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,e;for(e in c){c=e.indexOf(":");c=e.substr(c+1);var g=new (0==c?this.CLASS_MAP.maintenance:this.CLASS_MAP.mod_em_8)(f,a.interface,e);g.channel=c;b.push(g)}return b};t._resolve_HM_OU_LED16=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,e;for(e in c){c=e.indexOf(":");c=e.substr(c+1);var g=new (0==c?this.CLASS_MAP.maintenance:this.CLASS_MAP.ou_led16)(f,a.interface,e);g.channel=c;b.push(g)}return b};
t._resolve_HM_Dis_EP_WM55=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,e;for(e in c){c=e.indexOf(":");c=e.substr(c+1);var g=null;0==c?g=this.CLASS_MAP.maintenance:1==c||2==c?g=this.CLASS_MAP.button:3==c&&(g=this.CLASS_MAP.hm_dis_ep_wm55);g&&(g=new g(f,a.interface,e),g.channel=c,b.push(g))}return b};t._resolve_HMIP_FAL_X=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,e;for(e in c){var g=c[e],k=e.indexOf(":");k=e.substr(k+1);if(0==k)var h=this.CLASS_MAP.maintenance;
else"CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER"==g.type?h=this.CLASS_MAP_IP.ip_floor_pump_heater:"CLIMATECONTROL_FLOOR_TRANSCEIVER"==g.type&&(h=this.CLASS_MAP_IP.ip_floor_heater);h&&(g=new h(f,a.interface,e),g.channel=k,b.push(g))}return b};t._resolve_HMIP_MIOB=function(f,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,e;for(e in c){c=e.indexOf(":");c=e.substr(c+1);var g=null;0==c?g=this.CLASS_MAP.maintenance:3==c||7==c?g=this.CLASS_MAP_IP.ip_switch:9==c||10==c?g=this.CLASS_MAP_IP.ip_generic_input:
11==c&&(g=this.CLASS_MAP_IP.ip_analog_output);g&&(g=new g(f,a.interface,e),g.channel=c,b.push(g))}return b};t._getIPMetaIndex=function(f){for(var a in x.hub.m.hm.IPDeviceTypes)if(x.hub.m.hm.IPDeviceTypes.hasOwnProperty(a)&&a.toUpperCase()==f.toUpperCase())return x.hub.m.hm.IPDeviceTypes[a];return null};return t}();
x.hub.m.hm.Manager=function(){var h=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager");this._gateway=e;this._devices={};this._meta={}};h.prototype.init=function(e){x.hub.m.hm._Util.isIP(this._gateway.ip)?(this._logger.log("info","start connect monitor to "+this._gateway.ip),this._startMonitor(e)):e&&e()};h.prototype.onDeviceEvent=function(e){this._logger.log("trace","receive device event:"+JSON.stringify({device:e.device?e.device.type:null,address:e.device?e.device.address:
null,channel:e.channel,datapoint:e.datapoint,value:e.value?e.value.value:null,ip:e.ip}));var h=function(e,g){var k=null;if(!g||0==g.length)return null;g.forEach(function(g){g&&g.key==e&&(k=g)});return k};if(!e||!e.device)return null;var g=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!g)return null;var k=e.device;k.hsstype=k.type;if(k.channels)for(var l in k.channels)if(k.channels.hasOwnProperty(l)){var q=k.channels[l];q.hsstype=q.type}k=g._parseDevice(k);if(!k||0==k.length)return null;var m;
1==k.length?m=k[0]:k.forEach(function(g){if(g.address==e.channel)m=g;else if(0==e.channel.indexOf(g.address)){var k=e.channel.split(":")[1];if(g.channels)for(var h in g.channels)if(g.channels[h].address==k){m=g;break}}});if(!m)return null;k=x.hub.m.hm._Util.getDeviceHashCode(m);var r=g.resolveState(m,e,e.oldValue.value);g=g.resolveState(m,e,e.value.value);if(!g)return null;this._logger.log("trace","event to device state");this._logger.log("trace","device:"+JSON.stringify(m));this._logger.log("trace",
"state:"+JSON.stringify(g));var p=[];Array.isArray(g)?g.forEach(function(e){var g=h(e.key,r);p.push({device:m,gateway:this._gateway,data:{key:e.key,value:e.value,changed:g?e.value!=g.value:!0,oldValue:g?g.value:void 0}})}.bind(this)):p.push({device:m,gateway:this._gateway,data:{key:g.key,value:g.value,changed:g.value!=r.value,oldValue:r.value}});this._generateEvent(k,p)};h.prototype._generateEvent=function(e,h){var g=require("x.hub.eventbus.js");if((e=this._meta[e])&&0<e.length)for(var k=0;k<e.length;k++){var l=
e[k];if(l)for(var n=0;n<h.length;n++){var m=h[n];m&&m.data&&(m.data.key==l.statusKey||"*"==m.data.key)&&g.emit("status",{module:"hm",device:m.device,gateway:m.gateway,data:m.data},l)}}};h.prototype.addStateDevice=function(e,h,g){if(e){e=JSON.parse(JSON.stringify(e));var k=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[k]||(delete e.gateway,this._devices[k]=e);this._meta[k]||(this._meta[k]=[]);g&&this._meta[k].push(g);h&&h()}else h&&h(Error("device json invalid"))};h.prototype.removeStateDevice=
function(e,h,g){if(!e)h&&h(Error("device json invalid"));else if(g){e=JSON.parse(JSON.stringify(e));e=x.hub.m.hm._Util.getDeviceHashCode(e);var k=this._meta[e];if(k){for(var l=-1,n=0;n<k.length;n++){var m=k[n];if(m&&"taskman"==m.src&&"taskman"==g.src&&m.taskID==g.taskID&&m.statusKey==g.statusKey){l=n;break}}0<=l&&k.splice(l,1);0==k.length&&(delete this._devices[e],delete this._meta[e])}h&&h()}};h.prototype.getAllStates=function(){var e=[],h;for(h in this._devices)if(this._devices.hasOwnProperty(h)){var g=
this._devices[h];g&&g.device&&(g=this.getStates(g.device))&&e.push(g)}return e};h.prototype.getStates=function(e){if(!e)return null;e=JSON.parse(JSON.stringify(e));var h=x.hub.m.hm._Util.getDeviceHashCode(e),g=this._devices[h];g||this.addStateDevice(e);var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return null;var l={};g=this._devices[h];for(var q in g.states)h=k.getBufferedState(g.states[q]),l[q]=this._resolveRawState(e,q,h);return{device:e,gateway:this._gateway,
states:l}};h.prototype.updateStates=function(e,h){if(e){e=JSON.parse(JSON.stringify(e));var g=x.hub.m.hm._Util.getDeviceHashCode(e),k=this._devices[g];k||this.addStateDevice(e);k=this._devices[g];this._updateStates(e,k.states,h)}else h&&h(Error("device json is null"))};h.prototype.getState=function(e,h,g){if(!e||!h)return g&&g(Error("argument invalid")),null;if("SysVar"==e.type||"CUxD"==e["interface"])x.hub.m.hm.HM_MODULE.doStatus("var",this._gateway,e,{value:h},function(e,k){e?g&&g(e):k?(e={value:k.status,
time:(new Date).getTime()},g&&g(null,e)):g&&g(Error("get sys var status return null"))});else{e=JSON.parse(JSON.stringify(e));var k=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[k]||this.addStateDevice(e);k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return g&&g(Error("no monitor for gateway")),null;var l=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!l)return g&&g(Error("gateway json invalid")),null;var n=l.resolveDatapointInfo(e,h);
if(!n)return g&&g(Error("device json or state ref invalid")),null;k.getState(n,function(k,q){if(k)g&&g(k);else if(q){k=l.resolveState(e,n,q.value);var m;k?Array.isArray(k)?k.forEach(function(e){e&&e.key==h&&(m={value:e.value,time:q.time})}):m={value:k.value,time:q.time}:m={value:k,time:q.time};g&&g(null,m)}else g&&g(null,null)})}};h.prototype.executeCommand=function(e,h,g){var k=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!k)return g&&g(Error("gateway json invalid")),null;k.executeCommandCreator(e,
h,g)};h.prototype.updateState=function(e,h,g){if(!e||!h)return g&&g(Error("argument invalid")),null;e=JSON.parse(JSON.stringify(e));var k=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[k]||this.addStateDevice(e);k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return g&&g(Error("no monitor for gateway")),null;var l=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!l)return g&&g(Error("gateway json invalid")),null;var n=l.resolveDatapointInfo(e,
h);if(!n)return g&&g(Error("device json or state ref invalid")),null;k.updateState(n,function(k,q){if(k)g&&g(k);else{k=l.resolveState(e,n,q);var m;k?Array.isArray(k)?k.forEach(function(e){e&&e.key==h&&(m={value:e.value})}):m={value:k.value}:m={value:k};g&&g(null,m)}})};h.prototype._startMonitor=function(e){var h=require("x.hub.m.hm.js")._monitorManager,g=this;h.startMonitor(this._gateway,{persistant:!0},function(k){var l=h.getMonitor(g._gateway.ip,g._gateway.uuid);if(l)l.on("new_devices",g._onNewDevices.bind(g));
e&&e(k)})};h.prototype._onNewDevices=function(e){var h=[],g;for(g in e)if(e.hasOwnProperty(g)){var k=x.hub.m.hm._Device.resolve(e[g]);k&&0<k.length&&(k=k.filter(function(e){return e&&e.isButton()}),h=h.concat(k))}var l=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(l&&0<h.length){var q=0,m=function(){q++;q<h.length&&h[q].claimEvent(l,m)};h[q].claimEvent(l,m)}};h.prototype._updateStates=function(e,h,g){var k=this;require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,
{persistant:!0},function(l){l?g&&g(l):k._getStateByScript(e,h,g)})};h.prototype._resolveDetailDpt=function(e){var h=require("xnm.aio.hm.js").devicemanager,g=h.applyUIFilter(e,{catagory:"status",elems:"*"}),k=g?g.status:null;h=(g=h.applyUIFilter(e,{catagory:"command",elems:"*"}))?g.command:null;g={states:{},commands:{}};if(k&&0<=k.length)for(var l=0;l<k.length;l++){var q=k[l],m=this._resolveDatapointRef(e,q.ref.value,!1);m&&(g.states[q.ref.value]=m)}if(h&&0<=h.length)for(l=0;l<h.length;l++)k=h[l],
(m=this._resolveDatapointRef(e,k.ref.value,!0))&&(g.commands[k.ref.value]=m);return g};h.prototype.learnRFDevice=function(e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnRF(function(g,k){if(g)e&&e(g);else{g=[];var h=new x.hub.m.hm.HM_MODULE.CCU,n;for(n in k){var m=k[n];m.hsstype=m.type;if(m.channels)for(n in m.channels)m.channels[n].hsstype=m.channels[n].type;(m=h._parseDevice(m))&&(g=g.concat(m))}e&&e(null,g)}}):e&&e(Error("monitor not started"))};
h.prototype.learnIPDevice=function(e,h,g){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);k?k.learnIP(e,h,function(e,k){if(e)g&&g(e);else{e=[];var h=new x.hub.m.hm.HM_MODULE.CCU,l;for(l in k){var n=k[l];n.hsstype=n.type;if(n.channels)for(l in n.channels)n.channels[l].hsstype=n.channels[l].type;(n=h._parseDevice(n))&&(e=e.concat(n))}g&&g(null,e)}}):g&&g(Error("monitor not started"))};h.prototype.learnIPDeviceQR=function(e,h){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,
this._gateway.uuid);g?g.learnIPQR(e,function(e,g){if(e)h&&h(e);else{e=[];var k=new x.hub.m.hm.HM_MODULE.CCU,l;for(l in g){var n=g[l];n.hsstype=n.type;if(n.channels)for(l in n.channels)n.channels[l].hsstype=n.channels[l].type;(n=k._parseDevice(n))&&(e=e.concat(n))}h&&h(null,e)}}):h&&h(Error("monitor not started"))};h.prototype.deleteDevice=function(e,h,g){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);k?k.deleteDevice(e,h,g):g&&g(Error("monitor not started"))};
h.prototype.getRFInterfaces=function(e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.getRFInterfaces(e):e&&e(Error("monitor not started"))};return h}();x.hub.m.hm.ChipManager=function(h){x.hub.m.hm.Manager.call(this,h);this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager.ChipManager")};util.inherits(x.hub.m.hm.ChipManager,x.hub.m.hm.Manager);
x.hub.m.hm.ChipManager.prototype.init=function(h){if(x.hub.m.hm._Util.isIP(this._gateway.ip)){this._logger.log("info","start connect monitor to "+this._gateway.ip);var e=this,n=require("x.hub.m.hm.js")._monitorManager;n.startMonitor(this._gateway,{localChip:"chip",persistant:!0},function(g){var k=n.getMonitor(e._gateway.ip,e._gateway.uuid);if(k)k.on("new_devices",e._onNewDevices.bind(e));h&&h(g)},!0,!0)}else h&&h()};
x.hub.m.hm.ChipManager.prototype.reset=function(h){var e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return h&&h(Error("no chip monitor")),null;e.reset(h)};
x.hub.m.hm.ChipManager.prototype.executeCommand=function(h,e,n){if(h&&h.address&&e)if(h=h.address.split("."),3>h.length)n&&n({error:Error("address invalid")});else{var g={type:h[0],interface:h[1],address:h[2]};h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return n&&n(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.executeCommand(h,e.value,n):n&&n(Error("unknow device"))}else n&&n(Error("argument invalid"))};
x.hub.m.hm.ChipManager.prototype.getState=function(h,e,n){if(!h||!h.address||!e)return n&&n(Error("argument invalid")),null;h=h.address.split(".");if(3>h.length)n&&n(Error("address invalid"));else{var g={type:h[0],interface:h[1],address:h[2]};h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return n&&n(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.getState(h,e.value,n):n&&n(Error("unknow device"))}};
x.hub.m.hm.ChipManager.prototype.getBufferedStateLegacy=function(h,e){if(!h)return null;h=x.hub.m.hm._Device.resolve(h);if(!h||0==h.length)return null;var n;1==h.length?n=h[0]:h.forEach(function(g){g.deviceAdr==e&&(n=g)});if(!n)return null;var g;if(h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid)){h=h.getAllBufferedStates();var k=n.deviceAdr,l=k.indexOf(":");-1!=l&&(k=k.substr(0,l));h[k]&&h[k].states&&(g=n.parseStates(h[k].states))}if(!g)return null;h={type:"HM",
adr:n.toLegacyAdr(),state:{}};for(var q in g)h.state[q]=g[q].value;return h};
x.hub.m.hm.ChipManager.prototype.checkButtonEvent=function(h){if(!h||!h.device||!h.datapoint||0!=h.datapoint.indexOf("PRESS"))return null;var e=x.hub.m.hm._Device.resolve(h.device);if(!e||0==e.length)return null;var n;1==e.length?n=e[0]:e.forEach(function(e){e.deviceAdr==h.channel&&(n=e)});if(!n)return null;e=n.parseDptState(h.channel,h.datapoint,h.value.value);if(!e)return null;var g={type:"HM",adr:n.deviceType+"."+n.deviceIF+"."+n.deviceAdr,state:{},_ver:"v5+"},k=Object.keys(e);g.state[k[0]]=e[k[0]];
require("x.hub.eventbus.js").emit("gatewayevent",g,{address:"HM"},"BTN")};
x.hub.m.hm.ChipManager.prototype.onDeviceEvent=function(h){if(!h||!h.device)return null;var e=x.hub.m.hm._Device.resolve(h.device);if(!e||0==e.length)return null;var n;1==e.length?n=e[0]:e.forEach(function(e){e.deviceAdr==h.channel&&(n=e)});if(!n)return null;e=n.parseDptState(h.channel,h.datapoint,h.oldValue.value);var g=n.parseDptState(h.channel,h.datapoint,h.value.value);if(!g)return null;var k={sys:"aio",type:"HM",address:n.deviceType+"."+n.deviceIF+"."+n.deviceAdr},l=this._gateway,q={key:null,
value:null,changed:h.changed,oldValue:null},m=Object.keys(g);q.key=m[0];q.value=g[m[0]];q.oldValue=e?e[m[0]]:void 0;this._logger.log("debug","EVENT:\t"+k.address+"\t"+q.key+"\t"+q.value);return{device:k,gateway:l,data:q}};
x.hub.m.hm.ChipManager.prototype.learnRFDevice=function(h){var e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);e?e.learnRF(function(e,g){if(e)h&&h(e);else{var k=[],l;for(l in g){var n=x.hub.m.hm._Device.resolve(g[l]);n&&(k=k.concat(n))}h&&h(e,k)}}):h&&h(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnRFDeviceSN=function(h,e){var n=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);n?n.learnRFSN(h,function(g,k){if(g)e&&e(g);else{var h=[],n;for(n in k){var m=x.hub.m.hm._Device.resolve(k[n]);m&&(h=h.concat(m))}e&&e(g,h)}}):e&&e(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDevice=function(h,e,n){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);g?g.learnIP(h,e,function(e,g){if(e)n&&n(e);else{var k=[],h;for(h in g){var l=x.hub.m.hm._Device.resolve(g[h]);l&&(k=k.concat(l))}n&&n(e,k)}}):n&&n(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDeviceQR=function(h,e){var n=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);n?n.learnIPQR(h,function(g,k){if(g)e&&e(g);else{var h=[],n;for(n in k){var m=x.hub.m.hm._Device.resolve(k[n]);m&&(h=h.concat(m))}e&&e(g,h)}}):e&&e(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.getAllBufferedStates=function(){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return[];h=h.getAllBufferedStates();var e=[],n;for(n in h){var g=h[n],k=x.hub.m.hm._Device.resolve(g.device);if(k)for(var l=0,q=k.length;l<q;l++){var m=k[l],r=m.parseStates(g.states);e.push({device:m,states:r})}}return e};
x.hub.m.hm.ChipManager.prototype.getConfig=function(h,e){if(h&&h.address)if(h=h.address.split("."),3>h.length)e&&e({error:Error("address invalid")});else{var n={type:h[0],interface:h[1],address:h[2]};h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return e&&e(Error("no chip monitor")),null;(n=x.hub.m.hm._Device.parseJson(n))?n.getConfig(h,e):e&&e(Error("unknow device"))}else e&&e(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype.setConfig=function(h,e,n){if(h&&h.address)if(h=h.address.split("."),3>h.length)n&&n({error:Error("address invalid")});else{var g={type:h[0],interface:h[1],address:h[2]};h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return n&&n(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.setConfig(h,e,n):n&&n(Error("unknow device"))}else n&&n(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype._onNewDevices=function(h){var e=[],n;for(n in h)if(h.hasOwnProperty(n)){var g=x.hub.m.hm._Device.resolve(h[n]);g&&0<g.length&&(g=g.filter(function(e){return e&&e.isButton()}),e=e.concat(g))}var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(k&&0<e.length){var l=0,q=function(){l++;l<e.length&&e[l].claimEvent(k,q)};e[l].claimEvent(k,q)}};
x.hub.m.hm.CCU2Discovery=function(){var h=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.CCU2Discovery");this._autoDiscoverTO=null;var h=this;this._hmHandlerCB=function(e,k){h._logger.log("debug","find ccu:"+e.uuid+"@"+e.ip+" from netif:"+k);h._searchCB&&h._searchCB(e,k);if(e.ip){var g=!1;h._searchTmpHMs.forEach(function(k){k.ip==e.ip&&(g=!0)});g||h._searchTmpHMs.push(e)}};this._searchCB=e;this._searchRunning=!1;this._searchTmpHMs=[];this._searchTmpCBs=[]};h.prototype.discover=
function(e){e&&-1==this._searchTmpCBs.indexOf(e)&&this._searchTmpCBs.push(e);if(!this._searchRunning){this._searchRunning=!0;this._searchTmpHMs=[];this._autoDiscoverTO&&(clearTimeout(this._autoDiscoverTO),this._autoDiscoverTO=null);require("xnm.aio.hm.js").discoverCCUs(this._hmHandlerCB);var h=this;setTimeout(function(){h._searchRunning=!1;h._autoDiscoverTO=setTimeout(function(){h.discover()},3E4);h._searchTmpCBs.forEach(function(e){e&&e(h._searchTmpHMs)});h._searchTmpCBs=[]},3E3)}};return h}();
x.hub.m.hm._Util={isDeviceJsonValid:function(h){return h&&h.type&&h.address&&h.interface},isGatewayJsonValid:function(h){return h&&h.ip},getDeviceHashCode:function(h){if(!h)return-1;var e=0;e=(e<<5)-e+this._getStringHashCode(h.type);e=(e<<5)-e+this._getStringHashCode(h.address);return e=(e<<5)-e+this._getStringHashCode(h.interface)},getGatewayHashCode:function(h){if(!h)return-1;var e=80;h.port&&((e=parseInt(h.port))||(e=80));var n=0;n=(n<<5)-n+this._getStringHashCode(h.ip);n=(n<<5)-n+e;n=(n<<5)-n+
this._getStringHashCode(h.uuid);n=(n<<5)-n+this._getStringHashCode(h.username);return n=(n<<5)-n+this._getStringHashCode(h.password)},getLocalIP:function(h,e){var n=function(e){return e?(e=e.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))?(+e[1]<<24)+(+e[2]<<16)+(+e[3]<<8)+ +e[4]:-1:-1};if("127.0.0.1"==e||"localhost"==e)return"127.0.0.1";var g=require("os").networkInterfaces(),k;for(k in g)if(g.hasOwnProperty(k))for(var l=g[k],q=0;q<l.length;q++){var m=l[q];if(m&&"IPv4"==m.family&&m.address){if(h==k||!h&&
!e)return m.address;if(!h&&m.netmask&&e){var r=n(m.netmask),p=n(m.address),v=n(e);if((p&r)==(v&r))return m.address}}}return null},getLocalMac:function(h){var e=require("os").networkInterfaces(),n;for(n in e)if(e.hasOwnProperty(n))for(var g=e[n],k=0;k<g.length;k++){var l=g[k];if(l&&"IPv4"==l.family&&l.address&&l.mac&&h==l.address)return l.mac}return"00:00:00:00:00:00"},isIP:function(h){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(h)},
mergeObj:function(h,e){var n={},g;for(g in h)h.hasOwnProperty(g)&&(n[g]=h[g]);for(g in e)e.hasOwnProperty(g)&&(n[g]=e[g]);return n},_getStringHashCode:function(h){var e=0,n;if("undefined"==typeof h||null==h)return-1;if(0===h.length)return e;var g=0;for(n=h.length;g<n;g++){var k=h.charCodeAt(g);e=(e<<5)-e+k}return e}};
x.hub.m.hm.UdpEventProducer=function(){var h=function(e){this._handler=e;this._pool={}};h.prototype.EVENT_TO=300;h.prototype.onEvent=function(e){if(e&&e.channel){var h=0,g=e.channel,k=g.indexOf(":");-1!=k&&(g=e.channel.substr(0,k),h=e.channel.substr(k+1));(k=this._pool[g])&&k.timeout&&clearTimeout(k.timeout);var l=this;k=setTimeout(function(){var e=l._pool[g];l._pool[g]=null;for(var k in e){var h=e[k];if(h=l._handler._chipManager.getBufferedStateLegacy(h.device,h.channel)){h._ver="v5+";var n=require("x.hub.eventbus.js");
n.emit("gatewayevent",h,{address:"HM"},"STA");n.emit("udpevent",h,"STA")}}},this.EVENT_TO);this._pool[g]||(this._pool[g]={});this._pool[g].timeout=k;this._pool[g][h]||(this._pool[g][h]=e)}};h.prototype.addSTAEvent=function(e){if(e&&e.adr){var h=(new Date).getTime(),g=e.adr,k=this._pool[g];k&&k.timeout&&clearTimeout(k.timeout);var l=this;k=setTimeout(function(){var e=l._pool[g];if(e&&e.states){var k=require("x.hub.eventbus.js");k.emit("gatewayevent",e.states,{address:"HM"},"STA");k.emit("udpevent",
e.states,"STA")}},this.EVENT_TO);this._pool[g]={states:e,timestamp:h,timeout:k}}};return h}();
x.hub.m.hm.Handler=function(){var h=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Handler");var e=this;this._udpEvtProducer=new x.hub.m.hm.UdpEventProducer(this);this._discoveryCB=function(h,g){e._onFindHM(h,g)};this._monitorManager=this._discovery=null;this._managers={};this._chipManager=this._xmlrpcServer=null};util.inherits(h,EventEmitter);h.prototype.CCU=x.hub.m.hm.CCU;h.prototype.XMLRPCClient=x.hub.m.hm.Client;h.prototype.init=function(e){var h=this;if(localStorage){var g=
!0;"false"==localStorage.getItem("x.hub.m.hm.CCU_INIT_STATE")&&(g=!1);x.hub.m.hm.CCU_INIT_STATE=g}require("x.hub.eventbus.js").on("x.hub.m.hm.CCU_INIT_STATE",function(e){var g=!0;"false"==e&&(g=!1);x.hub.m.hm.CCU_INIT_STATE=g});this._discovery=new x.hub.m.hm.CCU2Discovery(this._discoveryCB);this._monitorManager=new x.hub.m.hm.MonitorManager;this._xmlrpcServer=new x.hub.m.hm.Server(global.HM_LOCAL_PORT);this._xmlrpcServer.start(function(g){g?(h._logger.log("warn","start homematic local server error with port:"+
h._xmlrpcServer.getPort()),h._logger.log("warn",g.stack),e&&e({error:g})):h._monitorManager.init(h._xmlrpcServer,function(g){g?e&&e({error:g}):global&&global.HM_CHIP?h._initChipManager(function(g){e&&e({error:g})}):e&&e({})})})};h.prototype.getSystems=function(){return["hm"]};h.prototype.addStateDevice=function(e,h,g){if(e)if(e.gateway&&"mediola"!=e.gateway.uuid)if(e.gateway.ip&&x.hub.m.hm._Util.isIP(e.gateway.ip))if(x.hub.m.hm._Util.isIP(e.gateway.ip)){var k=this._getManager(e.gateway);k?k.addStateDevice(e,
function(e){h&&h({error:e})},g):(k=this._addManager(e.gateway),k.init(function(e){}),k.addStateDevice(e,function(e){h&&h({error:e})},g))}else this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),h&&h({error:Error("gateway ip is url")});else h&&h({error:Error("gateway ip format invalid")});else h&&h();else h&&h({error:Error("device json format invalid")})};h.prototype.removeStateDevice=function(e,h,g){if(e)if(e.gateway&&"mediola"!=e.gateway.uuid)if(e.gateway.ip&&
x.hub.m.hm._Util.isIP(e.gateway.ip))if(x.hub.m.hm._Util.isIP(e.gateway.ip)){var k=this._getManager(e.gateway);k?k.removeStateDevice(e,function(e){h&&h({error:e})},g):h&&h({})}else this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),h&&h({error:Error("gateway ip is url")});else h&&h({error:Error("gateway ip format invalid")});else h&&h();else h&&h({error:Error("device json format invalid")})};h.prototype.getAllStates=function(){return this._chipManager?this._chipManager.getAllBufferedStates():
[]};h.prototype.getStates=function(e){if(!(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)))return null;var h=this._getManager(e.gateway);if(h)return h.getStates(e);h=this._addManager(e.gateway);h.init();return null};h.prototype.getState=function(e,h,g){if(!e)return g&&g({error:Error("device is null")}),null;if(!e.gateway||"mediola"==e.gateway.uuid){if(!this._chipManager){g&&g({error:Error("chip manager not inited")});return}return this._chipManager.getState(e,
{value:h},function(e,h){g&&g({error:e,data:h})})}if(!x.hub.m.hm._Util.isDeviceJsonValid(e)||!e.gateway||!x.hub.m.hm._Util.isGatewayJsonValid(e.gateway))return g&&g({error:Error("device json invalid")}),null;x.hub.m.hm.HM_MODULE.doStatus("xhub",e.gateway,e,{value:h},function(e,h){e?g&&g({error:e}):h?g&&g({data:{value:h.status}}):g&&g({error:Error("do status failed")})})};h.prototype.executeCommand=function(e,h,g){e?h?e.gateway&&"mediola"!=e.gateway.uuid?e.gateway?x.hub.m.hm.HM_MODULE.doCommand(e.gateway,
e,h,function(e){e?g&&g({error:e}):g&&g({})}):g&&g({error:Error("gateway is null")}):this._chipManager?this._chipManager.executeCommand(e,h,function(e){g&&g({error:e})}):g&&g({error:Error("chip manager not inited")}):g&&g({error:Error("command invalid")}):g&&g({error:Error("device is null")})};h.prototype.updateStates=function(e,h){if(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)){var g=this._getManager(e.gateway);g?g.updateStates(e,function(e,
g){h&&h({error:e,data:g})}):(g=this._addManager(e.gateway),g.init(function(k){k?h&&h({error:k}):g.updateStates(e,function(e,g){h&&h({error:e,data:g})})}))}else h&&h({error:Error("device json format invalid")})};h.prototype.checkDeviceMatch=function(e,h){if(!(h&&h.device&&e&&e.device))return!1;if(h.gateway&&"mediola"!=h.gateway.uuid)return h=x.hub.m.hm._Util.getDeviceHashCode(h.device),e=x.hub.m.hm._Util.getDeviceHashCode(e.device),h==e;var g=e.device.address;e.device.interface&&e.device.type&&(g=
e.device.type+"."+e.device.interface+"."+e.device.address);return g!=h.device.address?!1:!0};h.prototype._initChipManager=function(e){var h="127.0.0.1";global&&global.HM_CHIP&&(h=global.HM_CHIP);this._chipManager=new x.hub.m.hm.ChipManager({ip:h,username:global.HM_CHIP_USERNAME,password:global.HM_CHIP_PASSWORD,uuid:"mediola"});this._chipManager.init(e)};h.prototype._initCCU3Manager=function(e){this._addManager({ip:"127.0.0.1",type:3}).init(function(h){e&&e(h)})};h.prototype._discover=function(e){this._discovery.discover(e)};
h.prototype._onFindHM=function(e,h){this._logger.log("debug","find ccu:"+e.uuid+"@"+e.ip+" from netif:"+h);this._monitorManager.onFindHomeMatic(e.ip,h,e.uuid)};h.prototype._getManager=function(e){e=x.hub.m.hm._Util.getGatewayHashCode(e);return this._managers[e]};h.prototype._addManager=function(e){var h=x.hub.m.hm._Util.getGatewayHashCode(e);e=new x.hub.m.hm.Manager(e);return this._managers[h]=e};h.prototype.onDeviceEvent=function(e,h){this._logger.log("trace","receive device event:"+JSON.stringify(e));
require("x.hub.eventbus.js");if(h)this._chipManager&&(this._chipManager.checkButtonEvent(e),this._udpEvtProducer.onEvent(e));else for(var g in this._managers)if(h=this._managers[g])try{h.onDeviceEvent(e)}catch(k){console.error(k)}};h.prototype.resetChip=function(e){this._chipManager?this._chipManager.reset(function(){e&&e({})}):e&&e(Error("chip manager not inited"))};h.prototype.initManager=function(e,h){if(e){var g=this._getManager(e);g||(g=this._addManager(e));g.init(function(e){h&&h({error:e})})}else h&&
h({error:Error("gateway invalid")})};h.prototype.learnRFDevice=function(e,h){if(e){var g=this._getManager(e);g?g.learnRFDevice(function(e,g){h&&h({error:e,data:g})}):(g=this._addManager(e),g.init(function(e){e?h&&h({error:e}):setTimeout(function(){g.learnRFDevice(function(e,g){h&&h({error:e,data:g})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDevice(function(e,g){if(e)h&&h({error:e});else{var k=[];g.forEach(function(e){if(e){var g=e.toLegacyAdr();e=e.toLegacyType();k.push({address:g,
type:e})}});h&&h({data:k})}}):h&&h(Error("chip manager not inited"))};h.prototype.learnRFDeviceSN=function(e,h,g){if(e){var k=this._getManager(e);k?k.learnRFDevice(function(e,h){g&&g({error:e,data:h})}):(k=this._addManager(e),k.init(function(e){e?g&&g({error:e}):setTimeout(function(){k.learnRFDevice(function(e,h){g&&g({error:e,data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDeviceSN(h,function(e,h){if(e)g&&g({error:e});else{var k=[];h.forEach(function(e){if(e){var g=e.toLegacyAdr();
e=e.toLegacyType();k.push({address:g,type:e})}});g&&g({data:k})}}):g&&g(Error("chip manager not inited"))};h.prototype.learnIPDevice=function(e,h,g,k){if(e){var l=this._getManager(e);l?l.learnIPDevice(h,g,function(e,g){k&&k({error:e,data:g})}):(l=this._addManager(e),l.init(function(e){e?k&&k({error:e}):setTimeout(function(){l.learnIPDevice(h,g,function(e,g){k&&k({error:e,data:g})})},3E3)}))}else h?g?this._chipManager?this._chipManager.learnIPDevice(h,g,function(e,g){if(e)k&&k({error:e});else{var h=
[];g.forEach(function(e){if(e){var g=e.toLegacyAdr();e=e.toLegacyType();h.push({address:g,type:e})}});k&&k({data:h})}}):k&&k(Error("chip manager not inited")):k&&k({error:Error("key is null")}):k&&k({error:Error("sgtin is null")})};h.prototype.learnIPDeviceQR=function(e,h,g){if(h)if(e){var k=this._getManager(e);k?k.learnIPDeviceQR(h,function(e,h){g&&g({error:e,data:h})}):(k=this._addManager(e),k.init(function(e){e?g&&g({error:e}):setTimeout(function(){k.learnIPDeviceQR(h,function(e,h){g&&g({error:e,
data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnIPDeviceQR(h,function(e,h){if(e)g&&g({error:e});else{var k=[];h.forEach(function(e){if(e){var g=e.toLegacyAdr();e=e.toLegacyType();k.push({address:g,type:e})}});g&&g({data:k})}}):g&&g(Error("chip manager not inited"));else g&&g({error:Error("qrKey is null")})};h.prototype.deleteDevice=function(e,h,g){if(h){var k=h.split(".");3>k.length?g&&g({error:Error("address invalid")}):(h=k[1],k=k[2],e?g&&g({error:Error("not supported yet")}):
this._chipManager?this._chipManager.deleteDevice(h,k,function(e){g&&g({error:e})}):g&&g(Error("chip manager not inited")))}else g&&g({error:Error("address invalid")})};h.prototype.getRFInterfaces=function(e,h){if(e){var g=this._getManager(e);g?g.getRFInterfaces(function(e,g){h&&h({error:e,data:g})}):(g=this._addManager(e),g.init(function(e){e?h&&h({error:e}):setTimeout(function(){g.getRFInterfaces(function(e,g){h&&h({error:e,data:g})})},3E3)}))}else this._chipManager?this._chipManager.getRFInterfaces(function(e,
g){h&&h({error:e,data:g})}):h&&h(Error("chip manager not inited"))};h.prototype.executeCommandLegacy=function(e,h,g,k){e?k&&k({error:Error("not supported yet")}):this._chipManager?h?this.executeCommand({address:h},{value:g},function(e){k&&k({error:e?e.error:null})}):k&&k({error:Error("address invalid")}):k&&k({error:Error("chip manager not inited")})};h.prototype.getAllStatesLegacy=function(e){var h=[];try{this.getAllStates().forEach(function(e){if(e&&e.device&&e.states){var g={type:"HM",adr:e.device.toLegacyAdr(),
state:{}},l;for(l in e.states)g.state[l]=e.states[l].value;h.push(g)}})}catch(g){console.error(g.stack)}e&&e({data:h})};h.prototype.getConfig=function(e,h){e?e.gateway&&"mediola"!=e.gateway.uuid?h&&h({error:Error("not supported yet")}):this._chipManager?this._chipManager.getConfig(e,function(e,k){h&&h({error:e,data:k})}):h&&h({error:Error("chip manager not inited")}):h&&h({error:Error("device is null")})};h.prototype.setConfig=function(e,h,g){e?e.gateway&&"mediola"!=e.gateway.uuid?g&&g({error:Error("not supported yet")}):
this._chipManager?this._chipManager.setConfig(e,h,function(e){g&&g({error:e})}):g&&g({error:Error("chip manager not inited")}):g&&g({error:Error("device is null")})};h.prototype.getMonitorStates=function(e){this._monitorManager.getMonitorStates(function(h,g){e&&e({error:h,data:g})})};h.prototype.getAllDevices=function(e){var h=[];try{this.getAllStates().forEach(function(e){e&&e.device&&e.states&&(e={type:"HM",address:e.device.toLegacyAdr(),data:e.device.toLegacyType(),snr:e.device.getSerial(),_ver:"v5+"},
h.push(e))})}catch(g){console.error(g.stack)}e&&e({data:h})};h.prototype.isWindowOpen=function(){try{for(var e=this.getAllStates(),h=0;h<e.length;h++){var g=e[h];if(g&&g.device&&g.states){var k=g.device.toLegacyType();if("window"==k){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("contact"==k){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("ip_contact"==k){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("ip_window"==k&&g.states.state&&"closed"!=
g.states.state.value)return!0}}}catch(l){return!1}};return h}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.hm.Handler);
