var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,h,m){e instanceof String&&(e=String(e));for(var f=e.length,k=0;k<f;k++){var l=e[k];if(h.call(m,l,k,e))return{i:k,v:l}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,h,m){e!=Array.prototype&&e!=Object.prototype&&(e[h]=m.value)};$jscomp.getGlobal=function(e){e=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,e];for(var h=0;h<e.length;++h){var m=e[h];if(m&&m.Math==Math)return m}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(e,h,m,f){if(h){m=$jscomp.global;e=e.split(".");for(f=0;f<e.length-1;f++){var k=e[f];k in m||(m[k]={});m=m[k]}e=e[e.length-1];f=m[e];h=h(f);h!=f&&null!=h&&$jscomp.defineProperty(m,e,{configurable:!0,writable:!0,value:h})}};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(h,e){return $jscomp.findInternal(this,h,e).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(e){var h=0;return function(){return h<e.length?{done:!1,value:e[h++]}:{done:!0}}};
$jscomp.arrayIterator=function(e){return{next:$jscomp.arrayIteratorImpl(e)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(e,h){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function e(m){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(m||"")+"_"+h++,m)}var h=0;return e}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.asyncIterator;e||(e=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};
$jscomp.iteratorFromArray=function(e,h){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var m=0,f={next:function(){if(m<e.length){var k=m++;return{value:h(k,e[k]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6","es3");
var util=require("util"),EventEmitter=require("events"),async=require("async"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.hm=x.hub.m.hm||{};x.hub.m.hm.CCU_INIT_STATE=!0;x.hub.m.hm.HM_MODULE=require("xnm.aio.hm.js");
x.hub.m.hm.RFDeviceTypes={"HM-PB-4Dis-WM":0,"ZEL STG RM DWT 10":0,"263 155":0,"HM-PB-4Dis-WM-2":0,ASH550I:1,ASH550:1,"HM-WDS10-TH-O":1,"263 158":1,"HM-WDS20-TH-O":1,"HM-WDS40-TH-I":1,"263 157":1,"IS-WDS-TH-OD-S-R3":1,"HM-WDS40-TH-I-2":1,"HM-LC-Bl1-SM":2,"HM-LC-Bl1-FM":2,"HM-LC-Bl1-PB-FM":2,"ZEL STG RM FEP 230V":2,"263 146":2,"HM-LC-BlX":2,"HM-LC-Bl1-SM-2":2,"HM-LC-Bl1-FM-2":2,"HM-LC-Bl1PBU-FM":2,"263 147":2,"HM-CC-RT-DN":3,"HM-CC-RT-DN-BoM":4,"HM-CC-TC":5,"ZEL STG RM FWT":5,"HM-CC-VD":6,"ZEL STG RM FSA":6,
CENTRAL:7,"HM-RCV-50":7,"HM-OU-CF-Pl":8,"HM-OU-CFM-Pl":9,"HM-OU-CFM-TW":9,"HM-OU-CM-PCB":10,"HM-LC-AO-SM":11,"HM-LC-Dim1L-Pl":11,"HM-LC-Dim1L-Pl-2":11,"HM-LC-Dim1L-CV":11,"263 132":11,"HM-LC-Dim2L-CV":11,"HM-LC-Dim2L-SM":11,"HSS-DX":11,"HM-LC-Dim1L-Pl-3":11,"HM-LC-Dim1L-CV-2":11,"HM-LC-Dim2L-SM-2":11,"HM-LC-Dim1PWM-CV":12,"HM-LC-Dim1PWM-CV-2":12,"HM-LC-Dim1TPBU-FM":13,"HM-LC-Dim1TPBU-FM-2":13,"263 133":13,"HM-LC-Dim1T-Pl":13,"HM-LC-Dim1T-CV":13,"HM-LC-Dim1T-FM":13,"HM-LC-Dim1T-Pl-3":13,"HM-LC-Dim1T-CV-2":13,
"HM-LC-Dim1T-FM-2":13,"HM-LC-Dim2T-SM":13,"HM-LC-Dim2T-SM-2":13,"HM-LC-Dim1T-Pl-2":13,"263 134":13,"HM-LC-Dim1T-DR":13,"HM-LC-Dim1T-FM-LF":13,"OLIGO.smart.iq.HM":11,"HM-Dis-WM55":14,"HM-MOD-EM-8":15,"HM-ES-PMSw1-Pl":16,"HM-ES-PMSw1-Pl-DN-R1":16,"HM-ES-PMSw1-Pl-DN-R2":16,"HM-ES-PMSw1-Pl-DN-R3":16,"HM-ES-PMSw1-Pl-DN-R4":16,"HM-ES-PMSw1-Pl-DN-R5":16,"HM-ES-PMSw1-DR":16,"HM-ES-PMSw1-SM":16,"HM-Dis-TD-T":17,"HM-Sec-Key":18,"HM-Sec-Key-S":18,"HM-Sec-Key-O":18,"HM-Sec-Key-Generic":18,KS550:19,KS888:19,KS550Tech:19,
KS550LC:19,"HM-WDS100-C6-O":19,"HM-WDS100-C6-O-2":19,"HM-OU-LED16":20,"HM-OU-X":20,"HM-PB-2-WM55-2":21,"HM-PB-2-WM55":21,"ZEL STG RM WT 2":21,"263 135":21,"HM-PB-2-FM":21,"HM-PBI-4-FM":21,"ZEL STG RM FST UP4":21,"263 145":21,"HM-PBI-X":21,"HM-RC-4-2":21,"HM-PB-6-WM55":21,"HM-RC-8":21,"HM-RC-4":21,"HM-RC-4-3":21,"HM-RC-4-B":21,"HM-RC-P1":21,"HM-RC-Sec3":21,"HM-RC-Sec3-B":21,"HM-RC-Key3":21,"HM-RC-Key3-B":21,"HM-PB-4-WM":21,"HM-PB-2-WM":21,"HM-RC-2-PBU-FM":21,"RC-H":21,atent:21,"ZEL STG RM HS 4":21,
"HM-RC-X":21,"BRC-H":21,"HM-RC-SB-X":21,"HM-RC-12":21,"HM-RC-12-B":21,"HM-RC-12-SW":21,"HM-RC-Key4-2":22,"HM-RC-Sec4-2":22,"HM-RC-Key4-3":22,"HM-RC-Sec4-3":22,"HM-RC-19":23,"HM-RC-19-B":23,"HM-RC-19-SW":23,"HM-Sen-RD-O":24,"HM-Sec-RHS":25,"HM-Sec-RHS-2":25,"ZEL STG RM FDK":25,"HM-Sec-xx":25,"HM-LC-Sw1-Pl":26,"HM-LC-Sw1-Pl-2":26,"HM-LC-Sw1-SM":26,"HM-LC-Sw2-SM":26,"HM-LC-Sw4-SM":26,"HM-LC-Sw4-PCB":26,"HM-LC-Sw4-WM":26,"HM-LC-Sw1-FM":26,"263 130":26,"HM-LC-Sw2-FM":26,"HM-LC-Sw1-PB-FM":26,"HM-LC-Sw2-PB-FM":26,
"HM-LC-Sw4-DR":26,"HM-LC-Sw2-DR":26,"ZEL STG RM FZS":26,"ZEL STG RM FZS-2":26,"HM-LC-Sw1PBU-FM":26,"HM-LC-Sw2PBU-FM":26,"263 131":26,"HM-MOD-Re-8":26,"HM-LC-Sw1-Ba-PCB":26,"HM-LC-Sw4-Ba-PCB":26,"HM-LC-Sw1-Pl-3":26,"HM-LC-Sw1-SM-2":26,"HM-LC-Sw4-SM-2":26,"HM-LC-Sw4-PCB-2":26,"HM-LC-Sw4-WM-2":26,"HM-LC-Sw1-FM-2":26,"HM-LC-Sw2-FM-2":26,"HM-LC-Sw4-DR-2":26,"HM-LC-Sw2-DR-2":26,"HM-LC-Sw1-Pl-DN-R1":26,"HM-LC-Sw1-Pl-DN-R2":26,"HM-LC-Sw1-Pl-DN-R3":26,"HM-LC-Sw1-Pl-DN-R4":26,"HM-LC-Sw1-Pl-DN-R5":26,"HM-LC-Sw1-DR":26,
"HM-LC-Sw1-Pl-CT-R1":26,"HM-LC-Sw1-Pl-CT-R2":26,"HM-LC-Sw1-Pl-CT-R3":26,"HM-LC-Sw1-Pl-CT-R4":26,"HM-LC-Sw1-Pl-CT-R5":26,"HM-LC-Sw1-PCB":26,"HM-LC-Sw1-Pl-OM54":26,"HM-LC-Sw1-SM-ATmega168":26,"HM-LC-Sw4-SM-ATmega168":26,S550IA:27,"HM-WDS30-T-O":27,"HM-Sec-SC":28,"ZEL STG RM FFK":28,"HM-Sec-SC-2":28,"HM-SCI-3-FM":29,"HM-CC-SCD":30,"263 160":30,"HM-Sec-MDIR-3":31,"HM-Sec-MDIR-2":31,"HM-Sec-MDIR":31,"263 162":31,"HM-Sec-MD":31,"HM-Sec-SD":32,"HM-Sec-SD-Generic":32,"HM-Sec-SD-2":32,"HM-Sec-SD-2-Generic":32,
"HM-Sec-SFA-SM":33,"HM-Sen-MDIR-SM":34,"HM-Sen-MDIR-O":34,"HM-MD":34,"HM-Sen-MDIR-O-2":34,"HM-Sen-MDIR-O-3":34,"HM-Sen-EP":35,"HM-Sen-X":35,"HM-Sen-Wa-Od":36,"HM-SwI-3-FM":37,"ZEL STG RM FSS UP3":37,"263 144":37,"HM-SwI-X":37,"HM-TC-IT-WM-W-EU":38,"HM-Sec-TiS":39,"HM-WDS30-OT2-SM":40,"HM-WDS30-OT2-SM-2":40,"HM-Sec-WDS":41,"HM-Sec-WDS-2":41,"HM-Sec-Win":42,"HM-Sec-Win-Generic":42,WS550:43,WS888:43,WS550Tech:43,WS550LCB:43,WS550LCW:43,"HM-WDC7000":43,"HMW-IO-12-Sw14-DR":44,"HMW-IO-12-Sw7-DR":45,"HMW-IO-12-FM":46,
"HMW-IO-4-FM":46,"HMW-LC-Bl1-DR":47,"HMW-LC-Dim1L-DR":48,"HMW-LC-Sw2-DR":49,"HMW-Sen-SC-12-DR":50,"HMW-Sen-SC-12-FM":50,"HM-CC-VG-1":51,"HM-ES-TX-WM":52,"HM-LC-RGBW-WM":53,"HM-Sec-SD-2-Team":54,"HM-Sen-LI-O":56,"HM-Sec-SCo":28,"HM-Sec-Sir-WM":57,"HM-LC-Ja1PBU-FM":58,"HM-MOD-EM-8Bit":59,"HM-Dis-EP-WM55":60,"HM-Sen-MDIR-WM55":61,"HM-LC-DW-WM":62};
x.hub.m.hm.RFDeviceCatagory=[{type:"button",channelNum:"*",channel:"KEY"},{type:"weather"},{type:"blind",channelNum:"*",channel:"BLIND"},{type:"heater2"},{type:"heater3"},{type:"wallthermo"},{type:"heater"},{type:"vbutton",channelNum:"*",channel:"VIRTUAL_KEY"},{type:"gong2"},{type:"gong"},{type:"gong"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"button",channelNum:"*",channel:"KEY"},{type:"mod_em_8",
channelNum:"*",channel:"KEY"},{type:"powerswitch"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"keymatic"},{type:"weatherstation"},{type:"ou_led16",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"rain"},{type:"window"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"temp"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"contact",channelNum:"*",
channel:"SHUTTER_CONTACT"},{type:"co2"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{type:"smoke"},{type:"siren",channelNum:"*",channel:"ALARMACTUATOR"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{},{type:"capacity"},{type:"switch_interface",channelNum:"*",channel:"SWITCH_INTERFACE"},{type:"wallthermo2"},{type:"tilt",channelNum:"*",channel:"TILT_SENSOR"},{type:"temp2",channel:"WEATHER"},{type:"water",channelNum:"*",channel:"WATERDETECTIONSENSOR"},{},{type:"weather2"},{},
{},{},{},{},{},{},{},{type:"energymeter"},{type:"rgb"},{},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"lux"},{type:"siren2"},{type:"jalousie",channelNum:"*",channel:"JALOUSIE"},{type:"mod_em_8bit"},{type:"button",channelNum:"*",channel:"KEY"},{},{type:"dualwhite"}];
x.hub.m.hm.IPDeviceTypes={"HMIP-PS":0,"HmIP-PCBS":0,"HmIP-PCBS-BAT":0,"HMIP-SWDO":1,"HmIP-SWDO-I":1,"HmIP-SWDM":1,"HmIP-SWDM-B2":1,"Contact AA":1,"HMIP-WTH":2,"HmIP-WTH-2":2,"HmIP-STH":2,"HmIP-STHD":2,"HMIP-eTRV":3,"HMIP-eTRV-2":3,"HmIP-eTRV-2-UK":3,"HmIP-eTRV-B":3,"HmIP-eTRV-B1":3,"HmIP-eTRV-B-UK":3,"HmIP-eTRV-C":3,"HMIP-WRC2":4,"HmIP-SMI":5,"HmIP-SMO":5,"HmIP-SMO-A":5,"HmIP-SRH":6,"HmIP-SWSD":7,"HmIP-PSM":8,"Smart Plug AA":8,"HmIP-PSM-PE":8,"HmIP-PSM-UK":8,"HmIP-PSM-IT":8,"HmIP-PSM-CH":8,"HmIP-BSM":9,
"HmIP-BDT":10,"HmIP-ASIR":11,"HmIP-KRC4":12,"HmIP-KRCA":12,"HmIP-PDT":13,"HmIP-PDT-UK":13,"HmIP-FSM":14,"HmIP-FSM16":14,"HmIP-BROLL":15,"HmIP-FROLL":15,"HmIP-FBL":16,"HmIP-BBL":16,"HmIP-SPI":17,"HmIP-FDT":18,"HmIP-BWTH":19,"HmIP-BWTH24":19,"HmIP-FAL230-C6":20,"HmIP-FAL24-C6":20,"HmIP-FAL230-C10":20,"HmIP-FAL24-C10":20,"HmIP-WRC6":21,"HmIP-SWO-B":22,"HmIP-SWO-PL":23,"HmIP-SWO-PR":27,"HmIP-STHO":24,"HmIP-STHO-A":24,"HmIP-SPDR":25,"HmIP-SMI55":26,"HmIP-RC8":28,"HmIP-MIOB":0,"HmIP-SWD":31,"HmIP-SAM":32,
"HmIP-WGC":33,"HmIP-BSL":34,"HmIP-MOD-TM":35,"HmIP-DBB":36,"HmIP-FCI1":37,"HmIP-FCI6":37,"HmIP-SLO":38,"HmIP-BRC2":4,"HmIP-PMFS":39,"HmIP-MOD-RC8":37,"HmIP-MOD-OC8":1};
x.hub.m.hm.IPDeviceCatagory=[{type:"ip_switch"},{type:"ip_contact"},{type:"ip_wallthermo"},{type:"ip_heater"},{type:"ip_button2"},{type:"ip_motion"},{type:"ip_window"},{type:"ip_smoke"},{type:"ip_powerswitch"},{type:"ip_energyactor"},{type:"ip_dimmer"},{type:"ip_siren"},{type:"ip_button4"},{type:"ip_dimmer2"},{type:"ip_energyactor2"},{type:"ip_blind"},{type:"ip_jalousie"},{type:"ip_presence"},{type:"ip_dimmer3"},{type:"ip_wallthermo2"},{type:"ip_floor_heater"},{type:"ip_button6"},{type:"ip_weather"},
{type:"ip_weather2"},{type:"ip_weather3"},{type:"ip_direction"},{type:"ip_motion2"},{type:"ip_weather4"},{type:"ip_button8"},{type:"ip_generic_input"},{type:"ip_analog_output"},{type:"ip_water"},{type:"ip_acce"},{type:"ip_garagedoor"},{type:"ip_bsl"},{type:"ip_tormatic"},{type:"ip_button"},{type:"ip_multi_input_bat"},{type:"ip_lux"},{type:"ip_pmfs"}];
x.hub.m.hm.Util={clearHttpOptionForLog:function(e){try{var h=JSON.parse(JSON.stringify(e));h.auth&&(h.auth="xxxxxx:xxxxxx");if(h.headers)for(var m in headers)if(m&&"authorization"==m.toLocaleLowerCase()){var f=headers[m];if(f){var k=f.indexOf(" ");headers[m]=-1==k?"xxxxxx":f.substr(0,k)+" xxxxxx"}}return h}catch(l){return e}}};
x.hub.m.hm.Client=function(){var e=function(h,e,f,k,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Client");this.ip=h;this.port=e;this.port||(this.port=2001);this.username=f;this.password=k;this.useHttps=l;this.timeout=2E4;this.xml2js=null};e.prototype._doRequest=function(h,e,f){var k=require("http");this.useHttps&&(k=require("https"));h={host:this.ip,port:this.port,path:"/",method:h,headers:{"User-Agent":"mediola",Connection:"keep-alive"}};this.username&&(h.auth=this.username+":"+(this.password?
this.password:""));e&&(h.headers["Content-Length"]=e.length);var l=f,m=this;this._logger.log("trace","send http request:"+x.hub.m.hm.Util.clearHttpOptionForLog(h));this._logger.log("trace","send http data:"+e);f=k.request(h,function(k){var f="";k.setEncoding("utf-8");k.on("data",function(k){f+=k});k.on("end",function(){m._logger.log("trace","http response status:"+k.statusCode);m._logger.log("trace","http response data:"+f);var n=null;200!=k.statusCode&&(n=Error("http response "+k.statusCode));l&&
l(n,f,k.statusCode)})});f.on("error",function(k){m._logger.log("trace","http request error:"+k.stack);l&&l(k);l=null});f.setTimeout(this.timeout,function(){m._logger.log("trace","http request timeout");l&&l(Error("http timeout"));l=null});e&&f.write(e);f.end()};e.prototype._doXMLRpcRequest=function(h,e,f){var k=require("x.xmlrpc.js");h='<?xml version="1.0" encoding="ISO-8859-1"?><methodCall><methodName>'+h+"</methodName><params>";for(var l=0;l<e.length;l++)h=e[l]&&e[l].type&&void 0!=e[l].value?h+
("<param>"+k.serializeValue(e[l].value,e[l].type)+"</param>"):h+("<param>"+k.serializeValue(e[l])+"</param>");this._doRequest("POST",h+"</params></methodCall>",function(l,n){if(l)f&&f(l);else if(n)try{var h=k.deserializeRsp(n);h.error?f&&f(Error("xml rcp return error:"+h.error.faultString+" @code:"+h.error.faultCode),h.error):f&&f(null,h.params)}catch(p){f&&f(p)}else f&&f(Error("xml rcp response format invalid"))})};e.prototype.convertHmIPKeyBase32ToBase16=function(h){h=h.replace(/-/g,"").toUpperCase();
var e="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),f=new ArrayBuffer(16);f=new Uint8Array(f);for(var k=0,l=h.length-1,q=0,n=f.length-1,r="";0<=l;){for(var p=0;p<e.length;p++)if(e[p]==h.charAt(l)){k|=p<<q;break}q+=5;for(l--;8<q&&0<=n;)f[n]=k&255,k>>=8,q-=8,n--}for(p=0;p<f.length;p++)16>f[p]&&(r+="0"),r+=f[p].toString(16);return r.toUpperCase()};e.prototype._getValue=function(h){var e=null;if(this.xml2js)if(h["boolean"]&&h["boolean"][0])e=parseInt(h["boolean"][0])?!0:!1;else if(h.i4&&h.i4[0])e=parseInt(h.i4[0]);
else if(h.double&&h.double[0])e=parseFloat(h.double[0]);else if(h.array&&h.array[0]&&h.array[0].data&&h.array[0].data[0]&&h.array[0].data[0].value){e=[];h=h.array[0].data[0].value;for(var f in h)e.push(h[f])}else e=h;else if(f=h,h=h.find("value"),0<h.length&&(f=$(h[0])),f&&(e=f.text(),!e&&f.children()&&0<f.children().length))if(h=$(f.children()[0]),"boolean"==h.prop("tagName"))e=parseInt(h.text())?!0:!1;else if("i4"==h.prop("tagName"))e=parseInt(h.text());else if("double"==h.prop("tagName"))e=parseFloat(h.text());
else if("array"==h.prop("tagName"))for(e=[],h=h.find("data value"),f=0;f<h.length;f++){var k=$(h[f]).text();k&&e.push(k)}else XC.debugf("unknown valuetype:"),XC.debugf(h.getXMLString());return e};e.prototype._getStructData=function(h){var e={};if(h.struct&&h.struct[0]&&h.struct[0].member){h=h.struct[0].member;for(var f in h)h[f].name&&h[f].name[0]&&h[f].value&&h[f].value[0]&&(e[h[f].name[0]]=this._getValue(h[f].value[0]))}return e};e.prototype._waitForNewDevices=function(h,e,f){var k=this;this.getDeviceList(function(l){if(0>=
e||Object.keys(l).length>Object.keys(h).length){for(var m in l)h[m]||XC.debugf("new device: "+m);f&&f(l)}else setTimeout(function(){k._waitForNewDevices(h,e-4,f)},4E3)})};e.prototype.init=function(h,e,f){this._doXMLRpcRequest("init",[h,e],function(k){f&&f(k)})};e.prototype.getIP=function(){return this.ip};e.prototype.getPort=function(){return this.port};e.prototype.setPort=function(h){this.port=h};e.prototype.getValue=function(h,e,f,k){h=[h,e];"undefined"!=typeof f&&null!=f&&h.push(f);this._doXMLRpcRequest("getValue",
h,function(f,h){var l=null;!f&&h?l=h[0]:f&&h&&(l=h);k&&k(f,l)})};e.prototype.setValue=function(h,e,f,k){this._doXMLRpcRequest("setValue",[h,e,f],function(f){k&&k(f)})};e.prototype.getParamset=function(h,e,f,k){this._doXMLRpcRequest("getParamset",[h,e,f],function(f,h){var l=null;!f&&h?l=h[0]:f&&h&&(l=h);k&&k(f,l)})};e.prototype.putParamset=function(h,e,f,k){this._doXMLRpcRequest("putParamset",[h,e,f],function(f,h){var l=null;!f&&h?l=h[0]:f&&h&&(l=h);k&&k(f,l)})};e.prototype.listDevices=function(h){this._doXMLRpcRequest("listDevices",
[],function(e,f){var k=[];!e&&f&&(k=f[0]);h&&h(e,k)})};e.prototype.deleteDevice=function(h,e,f){this._doXMLRpcRequest("deleteDevice",[h,e],function(k){f&&f(k)})};e.prototype.setInstallMode=function(h,e,f,k){var l=[];l.push(h);"undefined"!=typeof e&&null!=e&&l.push(e);"undefined"!=typeof f&&null!=f&&l.push(f);this._doXMLRpcRequest("setInstallMode",l,function(f){k&&k(f)})};e.prototype.setInstallModeWithWhitelist=function(h,e,f,k){var l=[];l.push(h);"undefined"!=typeof e&&null!=e&&l.push(e);"undefined"!=
typeof f&&null!=f&&l.push(f);this._doXMLRpcRequest("setInstallModeWithWhitelist",l,function(f){k&&k(f)})};e.prototype.addNewDevice=function(h){var e=this;this.getDeviceList(function(f){e._doRequest("setInstallMode",[!0,30,2],function(k){setTimeout(function(){e._waitForNewDevices(f,30,h)},4E3)})})};e.prototype.addNewDeviceWithSGTN=function(h,e,f){var k=this;this.getDeviceList(function(l){k._doRequest("setInstallModeWithWhitelist",[!0,30,[{ADDRESS:e,KEY_MODE:"LOCAL",KEY:f}]],function(f){setTimeout(function(){k._waitForNewDevices(l,
30,h)},4E3)})})};e.prototype.listBidcosInterfaces=function(h){this._doXMLRpcRequest("listBidcosInterfaces",[],function(e,f){var k=[];!e&&f&&(k=f[0]);h&&h(e,k)})};e.prototype.reportValueUsage=function(h,e,f,k){this._doXMLRpcRequest("reportValueUsage",[h,e,f],function(f,h){var l;!f&&h&&(l=h[0]);k&&k(f,l)})};e.prototype.ping=function(h,e){this._doXMLRpcRequest("ping",[h],function(f){e&&e(f)})};return e}();
x.hub.m.hm.Server=function(){var e=function(h){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Server");this._port=9099;h&&0<h&&(this._port=h);this._server=null;this._servlet={}};e.prototype.getPort=function(){return this._port};e.prototype.stop=function(h){this._server?this._server.close():h&&h()};e.prototype.start=function(h){if(this._server)h&&h();else{var e=h,f=this,k=require("http").createServer(function(k,h){f._logger.log("trace","receive request method:"+k.method);f._logger.log("trace",
"receive request path:"+k.url);f._logger.log("trace","receive request header:"+JSON.stringify(k.headers));var l="";k.on("data",function(k){l+=k.toString()});k.on("end",function(){f._logger.log("trace","receive request body:"+l);"POST"==k.method?f._handleRequest(l,k,h):(f._logger.log("trace","send 404 response"),h.writeHead(404,"Not found"),h.end())})});k.on("error",function(k){f._logger.log("trace","xmlrpc server err:"+k.stack);e&&e(k);e=null;f._server=null});k.listen(this._port,function(){f._logger.log("trace",
"xmlrpc server listening on port:"+f._port);f._server=k;e&&e();e=null})}};e.prototype.registServlet=function(h,e){h&&e&&(this._servlet[h]=e)};e.prototype.unregistServlet=function(h){h&&delete this._servlet[h]};e.prototype._handleRequest=function(h,e,f){var k=e.url,l=require("x.xmlrpc.js"),m=this;try{var n=l.deserializeReq(h);if("system.multicall"==n.methodName)this._handleMultiCall(n.params[0],e,f);else if(this._logger.log("debug","receive method call:"+n.methodName),this._logger.log("debug","params:"+
JSON.stringify(n.params)),"system.listMethods"==n.methodName)this._sendSuccessResponse(["event listDevices newDevices deleteDevices updateDevice replaceDevice readdedDevice".split(" ")],f);else if(this._servlet[k])this._servlet[k](n.methodName,n.params,function(k,l){k?m._sendErrorResponse(k,f):m._sendSuccessResponse([l],f)});else this._sendSuccessResponse([[]],f)}catch(r){this._sendErrorResponse(r,f)}};e.prototype._handleMultiCall=function(h,e,f){e=e.url;this._logger.log("trace","---------------------------------");
this._logger.log("trace","receive system.multicall");for(var k=0;k<h.length;k++){var l=h[k];this._logger.log("trace","receive method call:"+l.methodName);this._logger.log("trace","params:"+JSON.stringify(l.params));if(this._servlet[e])this._servlet[e](l.methodName,l.params)}this._logger.log("trace","---------------------------------");this._sendSuccessResponse([[]],f)};e.prototype._sendSuccessResponse=function(h,e){h=require("x.xmlrpc.js").serializeRsp(null,h);this._logger.log("trace","send xml success response:"+
h);e.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(h)+""});e.write(h);e.end()};e.prototype._sendErrorResponse=function(h,e){var f=require("x.xmlrpc.js"),k=-1;h.errCode&&(k=h.errCode);h=f.serializeRsp({faultCode:k,faultString:h.message});this._logger.log("trace","send xml fault response:"+h);e.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(h)+""});e.write(h);e.end()};return e}();
x.hub.m.hm._Controller=function(){var e=function(k,f,e,n,h,m){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller");this._client=new x.hub.m.hm.Client(k,f,e,n,h);this._initStates=m;this.interface=null;this._devices={};this._status={};this._learnDeviceCbs=[];this._learnDeviceTO=null;this._readValueCbs={}};util.inherits(e,EventEmitter);e.prototype.getIP=function(){return this._client.getIP()};e.prototype.getPort=function(){return this._client.getPort()};e.prototype.setPort=function(k){return this._client.setPort(k)};
e.prototype.getAllBufferedStates=function(){var k={},f;for(f in this._devices){var e=this._devices[f];!e.PARENT&&e.CHILDREN?k[f]={device:{type:e.TYPE,"interface":this.interface,address:e.ADDRESS,channels:{}},states:{}}:e.PARENT&&(k[e.PARENT].device.channels[e.ADDRESS]={type:e.TYPE,address:e.ADDRESS});if(e.CHILDREN)for(var n=0,h=e.CHILDREN.length;n<h;n++){var m=e.CHILDREN[n];if(this._status[m]){k[f].states[m]={};for(var t in this._status[m])k[f].states[m][t]=this._status[m][t]}}}return k};e.prototype.getBufferedState=
function(k){if(!k)return null;var f=k.indexOf(":");-1!=f&&(k=k.substr(0,f));k=this._devices[k];if(!k)return null;var e={};if(k.CHILDREN){var n=this;k.CHILDREN.forEach(function(k){if(n._status[k]){e[k]={};for(var f in n._status[k])e[k][f]=n._status[k][f]}})}return e};e.prototype.getBufferedDevices=function(){return this._getDeviceStructs(this._devices)};e.prototype.getState=function(k,f,e){var l=this.getBufferedState(k);if(l&&l[k]&&l[k][f]){l=l[k][f];var h=l.value;if("undefined"!=typeof h&&null!=h){e&&
e(null,l);return}}this.updateState(k,f,function(k,f){e&&e(k,f)})};e.prototype.updateState=function(k,f,e){var l=this;this.readValue(k,f,function(n,h){n?setTimeout(function(){var n,h=l.getBufferedState(k);h&&h[k]&&h[k][f]&&(n=h[k][f]);e&&e(null,n)},1E3):e&&e(null,{value:h,time:(new Date).getTime()})})};e.prototype.reset=function(k){var f=[];Object.keys(this._devices).forEach(function(k){k&&-1==k.indexOf(":")&&"BidCoS-RF"!=k&&f.push(k)});if(0==f.length)k&&k();else{var e=0,n=this,h=function(l){e++;e<
f.length?n.deleteDevice(f[e],h):k&&k()};this.deleteDevice(f[e],h)}};e.prototype.register=function(k,f,e){if(k){this._logger.log("debug","register:"+f+" to "+k);var l=this;this._client.init(k,f,function(k){l._logger.log("debug","registed:"+f+(k?" err:"+k.message:""));e&&e(k,k?null:f)})}else e&&e(Error("arguments invalid"))};e.prototype.unregister=function(k,f){k?this._client.init(k,"",function(k){f&&f(k)}):f&&f(Error("url invalid"))};e.prototype.getDevices=function(k){this._client.listDevices(function(f,
e){if(f)k&&k(f);else for(f=0;f<e.length;f++);})};e.prototype.learnNewDevice=function(k){var f=this._learnDeviceCbs.length;k&&-1==this._learnDeviceCbs.indexOf(k)&&this._learnDeviceCbs.push(k);if(0==f){var e=this;this._learnDeviceTO=setTimeout(function(){var k=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var f=0;f<k.length;f++){var l=k[f];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,1,function(k){if(k){e._learnDeviceTO&&(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=
null);var f=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var l=0;l<f.length;l++){var n=f[l];n&&n(k)}}})}};e.prototype.learnNewDeviceSN=function(k,f){var l=this._learnDeviceCbs.length;f&&-1==this._learnDeviceCbs.indexOf(f)&&this._learnDeviceCbs.push(f);if(0==l){var e=this;this._learnDeviceTO=setTimeout(function(){var k=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var f=0;f<k.length;f++){var l=k[f];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,k,function(k){if(k){e._learnDeviceTO&&
(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=null);var f=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var l=0;l<f.length;l++){var h=f[l];h&&h(k)}}})}};e.prototype.learnNewIPDevice=function(k,f,e){var l=this._learnDeviceCbs.length;e&&-1==this._learnDeviceCbs.indexOf(e)&&this._learnDeviceCbs.push(e);if(0==l){var h=this;this._learnDeviceTO=setTimeout(function(){var k=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var f=0;f<k.length;f++){var l=k[f];l&&l(Error("learn device timeout"))}},6E4);k={ADDRESS:k.replace(/-/g,
"").toUpperCase(),KEY_MODE:"LOCAL",KEY:this._convertHmIPKeyBase32ToBase16(f)};this._client.setInstallModeWithWhitelist(!0,60,[k],function(k){if(k){h._learnDeviceTO&&(clearTimeout(h._learnDeviceTO),h._learnDeviceTO=null);var f=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var l=0;l<f.length;l++){var e=f[l];e&&e(k)}}})}};e.prototype.learnNewIPDeviceQR=function(k,f){var l=this._learnDeviceCbs.length;f&&-1==this._learnDeviceCbs.indexOf(f)&&this._learnDeviceCbs.push(f);if(0==l){var e=this;this._learnDeviceTO=
setTimeout(function(){var k=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var f=0;f<k.length;f++){var l=k[f];l&&l(Error("learn device timeout"))}},3E4);f=k.substr(6,24);k=k.substring(k.length-32,k.length);k={ADDRESS:f.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:k.toUpperCase()};this._client.setInstallModeWithWhitelist(!0,30,[k],function(k){if(k){e._learnDeviceTO&&(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=null);var f=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var l=0;l<f.length;l++){var h=
f[l];h&&h(k)}}})}};e.prototype.deleteDevice=function(k,f){if(k){var l=k.indexOf(":");-1!=l&&(k=k.substr(0,l));this._client.deleteDevice(k,2,f)}else f&&f(Error("address is empty"))};e.prototype.readValue=function(k,f,e){var l=k+"."+f,h=this._readValueCbs[l];h||(h=[],this._readValueCbs[l]=h);var m=h.length;e&&-1==h.indexOf(e)&&h.push(e);if(0==m){var q=this;this._client.getValue(k,f,null,function(e,h){e||q._updateStatusBuffer(k,f,h);var n=q._readValueCbs[l];delete q._readValueCbs[l];n.forEach(function(k){k&&
k(e,h)})})}};e.prototype.writeValue=function(k,f,e,h){var l=this;this._client.setValue(k,f,e,function(n){n||l._updateStatusBuffer(k,f,e.type?e.value:e);h&&h(n)})};e.prototype.getValuesParamset=function(k,f){this._logger.log("trace","getValuesParamset:"+k);var l=this;this._client.getParamset(k,"VALUES",0,function(e,h){if(e)l._logger.log("trace","getValuesParamset error:"+e.message),f&&f(e);else{if(h){e=0;var n=k.indexOf(":");-1!=n&&(e=k.substr(n+1));for(var m in h)h.hasOwnProperty(m)&&(0==e?"INSTALL_MODE"!=
m&&l._updateStatusBuffer(k,m,h[m]):l._updateStatusBuffer(k,m,h[m]))}l._logger.log("trace","getValuesParamset finish:"+JSON.stringify(h));f&&f(null,h)}})};e.prototype.getParamset=function(k,f,e){this._client.getParamset(k,f,0,function(f,k){e&&e(f,k)})};e.prototype.setParamset=function(f,l,e,h){this._client.putParamset(f,l,e,function(f){h&&h(f)})};e.prototype.reportValueUsage=function(f,l,e,h){this._client.reportValueUsage(f,l,e,function(f,k){h&&h(f,k)})};e.prototype.getDevice=function(f){if(!f)return null;
var k=f,e=f.indexOf(":");-1!=e&&(k=f.substr(0,e));if(!this._devices[k])return null;var h=[];f=this._devices[k];h.push(f);if(f.CHILDREN){var m=this;f.CHILDREN.forEach(function(f){f&&m._devices[f]&&h.push(m._devices[f])})}return(f=this._getDeviceStructs(h))?f[k]:null};e.prototype._getDeviceStructs=function(f){if(!f)return null;var k={},e=this;f.forEach(function(f){if(f.ADDRESS&&f.TYPE)if(!f.PARENT&&f.CHILDREN)k[f.ADDRESS]={type:f.TYPE,"interface":e.interface,address:f.ADDRESS,channels:{}};else if(f.PARENT){var l=
k[f.PARENT];l&&(l.channels[f.ADDRESS]={type:f.TYPE,address:f.ADDRESS})}});return k};e.prototype._updateStatusBuffer=function(f,l,e,h){if("CENTRAL"!=f||"PONG"!=l){if("PRESS_SHORT"==l||"PRESS_LONG"==l||"PRESS_CONT"==l||"PRESS_LONG_RELEASE"==l){var k={};h={value:e,time:(new Date).getTime()};var n=!0}else{var m=this._status[f];m||(m={},this._status[f]=m);k=m[l];k||(k={},m[l]=k);h={value:e,time:h?h:(new Date).getTime()};k&&k.time&&h&&h.time&&k.time>h.time?n=!1:(m[l]=h,n=!0)}m=this.getDevice(f);n&&this.emit("event",
{device:m,"interface":this.interface,channel:f,datapoint:l,value:h,changed:k.value!=h.value,oldValue:k});k=f.indexOf(":");-1!=k&&(h=f.substr(0,k),"1"==f.substr(k+1)&&"STATE"==l&&0==e&&m&&m.channels&&m.channels[h+":2"]&&"POWERMETER"==m.channels[h+":2"].type&&(this._updateStatusBuffer(h+":2","POWER",0),this._updateStatusBuffer(h+":2","CURRENT",0)))}};e.prototype._initNewDeviceStates=function(f,l){if(this._initStates){var k=this,e=function(f,l){f.ADDRESS&&f.PARAMSETS&&-1!=f.PARAMSETS.indexOf("VALUES")?
k.getValuesParamset(f.ADDRESS,l):l()},h=0,m=function(){h++;h<f.length?e(f[h],m):l&&l()};e(f[h],m)}else l&&l()};e.prototype._convertHmIPKeyBase32ToBase16=function(f){f=f.replace(/-/g,"").toUpperCase();var k="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),e=new ArrayBuffer(16);e=new Uint8Array(e);for(var h=0,m=f.length-1,p=0,t=e.length-1,w="";0<=m;){for(var v=0;v<k.length;v++)if(k[v]==f.charAt(m)){h|=v<<p;break}p+=5;for(m--;8<p&&0<=t;)e[t]=h&255,h>>=8,p-=8,t--}for(v=0;v<e.length;v++)16>e[v]&&(w+="0"),
w+=e[v].toString(16);return w.toUpperCase()};e.prototype._xmlrpcCall=function(f,l,e){this._logger.log("trace","receive call:"+f);this._logger.log("trace","params:"+JSON.stringify(l));var k=[],h;switch(f){case "newDevices":if(l[1]){this._initNewDeviceStates(l[1],null);for(h=0;h<l[1].length;h++)(f=l[1][h])&&f.ADDRESS&&(this._devices[f.ADDRESS]=f);f=this._getDeviceStructs(l[1]);try{this.emit("newDevices",f)}catch(t){}if(!l[1]||!l[1][0]||"HM-RCV-50"!=l[1][0].TYPE)for(l=this._learnDeviceCbs,this._learnDeviceCbs=
[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),h=0;h<l.length;h++){var m=l[h];m&&m(null,f)}}break;case "readdedDevice":if(l[1]&&l[1][0])for(h=this.getDevice(l[1][0]),f={},f[l[1][0]]=h,l=this._learnDeviceCbs,this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),h=0;h<l.length;h++)(m=l[h])&&m(null,
f);break;case "listDevices":if(l[1]){l=[];for(h in this._devices)this._devices.hasOwnProperty(h)&&this._devices[h]&&l.push(this._devices[h]);k.push(l)}break;case "deleteDevices":if(l[1])for(h=0;h<l[1].length;h++)if(f=l[1][h])delete this._devices[f],delete this._status[f];break;case "event":this._logger.log("trace","get event:"+JSON.stringify(l)),this._updateStatusBuffer(l[1],l[2],l[3])}e&&e(null,k)};var h=function(f,l,e,h,m,p){x.hub.m.hm._Controller.call(this,f,l,e,h,m,p);this.interface="BidCos-RF";
this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.RF")};h.prototype=new e;h.prototype.constructor=h;h.prototype.listBidcosInterfaces=function(f){this._client.listBidcosInterfaces(function(k,e){f&&f(k,e)})};h.prototype.ping=function(f,l){this._client.ping(f,function(f){l&&l(f)})};var m=function(f,l,e,h,m,p){x.hub.m.hm._Controller.call(this,f,l,e,h,m,p);this.interface="BidCos-Wired";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.Wired")};util.inherits(m,e);var f=
function(f,l,e,h,m,p){x.hub.m.hm._Controller.call(this,f,l,e,h,m,p);this.interface="HmIP-RF";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IP")};util.inherits(f,e);f.prototype.deleteDevice=function(f,l){var k=f.indexOf(":");-1!=k&&(f=f.substr(0,k));this._client.deleteDevice(f,2,l)};e.getController=function(k,l,e){switch(k){case "BidCos-RF":k=h;break;case "BidCos-Wired":k=m;break;case "HmIP-RF":k=f;break;default:return null}return new k(l.ip,l.port,l.username,l.password,e.useHttps,
e.initStates)};return e}();
x.hub.m.hm.Monitor=function(){var e=function(f,k,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.ControllerMonitor");this._type=l;this._monitor=f;this._controller=k;this._xmlrpcServer=null;this._retryWait=1E4;this._retryCount=0;this._retryTO=null;this._state=0;this._err=null};e.prototype.start=function(f,k){0==this._state&&(this._xmlrpcServer=f,this._connect(f));k&&k()};e.prototype.stop=function(f,k){var l=this._state;this._retryTO&&clearTimeout(this._retryTO);this._retryTO=null;
this._state=0;this._err=null;this._retryCount=0;0!=l?this._unregister(f,function(){k&&k()}):k&&k()};e.prototype.getMonitorState=function(){return{state:this._state,error:this._err?this._err.message:null}};e.prototype._connect=function(){this._logger.log("info","start regist "+this._type+" monitor at "+this._controller.getIP()+":"+this._controller.getPort());this._state=1;var f=this;this._register(this._xmlrpcServer,function(k){k?(f._logger.log("warn","regist "+f._type+" monitor at "+f._controller.getIP()+
":"+f._controller.getPort()+" error:"+k.message),f._state=3,f._err=k,f._retryCount++,f._retryTO=setTimeout(function(){f._logger.log("trace","retry timeout for regist "+f._type+" monitor at "+f._controller.getIP()+":"+f._controller.getPort()+" expired");f._connect()},Math.min(6E4,Math.ceil(f._retryCount/10)*f._retryWait))):(f._logger.log("info","regist "+f._type+" monitor at "+f._controller.getIP()+":"+f._controller.getPort()+" success"),f._state=2,f._err=null,f._retryCount=0,f._monitor._onControllerMonitorConnected(f._type))})};
e.prototype._register=function(f,k){var l=this._monitor.localMac.replace(/:/g,""),e="/"+this._monitor.serialNumber;f=f.getPort();this._controller.register("http://"+this._monitor.localIP+":"+(f?f:80)+e,this._monitor.serialNumber+"_"+this._controller.getPort()+"_"+l,k)};e.prototype._unregister=function(f,k){var l="/"+this._monitor.serialNumber;f=f.getPort();this._controller.unregister("http://"+this._monitor.localIP+":"+(f?f:80)+l,k)};var h=function(f){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.PinPongHandler");
this._monitor=f;this._pingWait=3E4;this._pingTO=null;this._pingMiss=0};h.prototype.start=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._startPingTO()};h.prototype.stop=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0};h.prototype._startPingTO=function(){var f=this;this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingTO=setTimeout(function(){f._pingMiss++;4>f._pingMiss?(f._ping(),f._startPingTO()):
f._pingFail()},this._pingWait)};h.prototype._ping=function(f){var k=this._monitor._rfController;k?(this._logger.log("trace","send PING"),k.ping(this._monitor.localMac,function(k){f&&f(k)})):f&&f(Error("no rf controller for ping"))};h.prototype._pingFail=function(){this._logger.log("warn","PING Fail");this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._monitor._onPingFail()};h.prototype._onPong=function(){this._pingMiss=0};var m=function(f,k){this.ip=f.ip;this.serialNumber=
f.uuid;this.ccuType=f.type;this.ccuType||(this.ccuType=2);this.localIP=k?k.localIP:null;this.localMac=k?k.localMac:null;this.isChip=k?"chip"==k.localChip:!1;this.isCCU3=k?"ccu3"==k.localChip:!1;this.persistant=k?k.persistant:!1;this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor");f={ip:this.ip,port:null,username:f.username,password:f.password};k={useHttps:!1,initStates:this.isChip?!0:!1};f.port=this.isCCU3?32001:2001;this._rfController=x.hub.m.hm._Controller.getController("BidCos-RF",
f,k);this._rfController.on("event",this._onEvent.bind(this));this._rfController.on("newDevices",this._onNewDevices.bind(this));f.port=this.isCCU3?32010:2010;this._ipController=x.hub.m.hm._Controller.getController("HmIP-RF",f,k);this._ipController.on("event",this._onEvent.bind(this));this._ipController.on("newDevices",this._onNewDevices.bind(this));f.port=this.isCCU3?32E3:2E3;this._wiredController=x.hub.m.hm._Controller.getController("BidCos-Wired",f,k);this._wiredController.on("event",this._onEvent.bind(this));
this._wiredController.on("newDevices",this._onNewDevices.bind(this));this._wiredMonitor=this._ipMonitor=this._rfMonitor=null;this._pingpong=new h(this);this._pingTO=this._manager=this._xmlrpcServer=null;this._pingMiss=0;this._wiredRegisted=this._ipRegisted=this._rfRegisted=!1;this._reconnectTO=null;this._reconnectCount=0};util.inherits(m,EventEmitter);m.prototype.getMonitorState=function(f){var k={chip:this.isChip};if(this._rfMonitor){var l=this._rfMonitor.getMonitorState();k.bidcos=l}this._ipMonitor&&
(l=this._ipMonitor.getMonitorState(),k.hmip=l);this._wiredMonitor&&(l=this._wiredMonitor.getMonitorState(),k.bidcos_wired=l);k.bidcos&&2==k.bidcos.state?this._rfController.listBidcosInterfaces(function(l,e){e&&(k.info=e);f&&f(null,k)}):f&&f(null,k)};m.prototype.getAllBufferedStates=function(){var f={},k,l=this._rfController.getAllBufferedStates();if(l)for(k in l)l.hasOwnProperty(k)&&(f[k]=l[k]);if(l=this._wiredController.getAllBufferedStates())for(k in l)l.hasOwnProperty(k)&&(f[k]=l[k]);if(l=this._ipController.getAllBufferedStates())for(k in l)l.hasOwnProperty(k)&&
(f[k]=l[k]);return f};m.prototype.getBufferedDevice=function(f,k){switch(f){case "BidCos-RF":f=this._rfController;break;case "BidCos-Wired":f=this._wiredController;break;case "HmIP-RF":f=this._ipController;break;default:return null}return f.getDevice(k)};m.prototype.getState=function(f,k){if(!(f&&f.interface&&f.channel&&f.datapoint))return k&&k(Error("argument invalid")),null;switch(f.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=
this._ipController;break;default:return null}l.getState(f.channel,f.datapoint,k)};m.prototype.updateState=function(f,k){if(!(f&&f.interface&&f.channel&&f.datapoint))return k&&k(Error("argument invalid")),null;switch(f.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:return null}l.updateState(f.channel,f.datapoint,k)};m.prototype.init=function(f,k){this._logger.log("info","init monitor ("+
this.ip+")");this._xmlrpcServer=f;this._init(k)};m.prototype._init=function(f){var k=this;this.getSerialNumber(function(l){l?f&&f(l):k.register(k._xmlrpcServer,function(){f&&f()})})};m.prototype.update=function(f,k,l,e){l&&this.serialNumber!=l&&(this.serialNumber=l);var h=this;f&&this.ip!=f||k&&this.localIP!=k?this.unregister(this._xmlrpcServer,function(){h.ip=f;h.localIP=k;h.register(h._xmlrpcServer,e)}):e&&e()};m.prototype.finalize=function(f){this.removeAllListeners();this._manager&&this._manager.deleteMonitor(this.ip);
this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);this.unregister(this._xmlrpcServer,function(){f&&f()})};m.prototype.getSerialNumber=function(f){var k=this;global&&"CCU3"==global.PLATFORM?(this._rfController.setPort(32001),k.getRFInterfaces(function(l,e){l?(k._rfController.setPort(2001),k.getRFInterfaces(function(l,e){l?f&&f():(k.serialNumber=e[0].ADDRESS,f&&f(null,k.serialNumber))})):(k._ipController.setPort(32010),
k._wiredController.setPort(32E3),k.serialNumber=e[0].ADDRESS,f&&f(null,k.serialNumber))})):this.getRFInterfaces(function(l,e){l?f&&f():(k.serialNumber=e[0].ADDRESS,f&&f(null,k.serialNumber))})};m.prototype.getRFInterfaces=function(f){this._rfController.listBidcosInterfaces(function(k,l){f&&f(k,l)})};m.prototype.register=function(f,k){var l=this;f.registServlet("/"+this.serialNumber,function(f,k,e){l._xmlrpcCall(f,k,e)});this._rfMonitor=new e(this,this._rfController,"rf");this._ipMonitor=new e(this,
this._ipController,"ip");this._wiredMonitor=new e(this,this._wiredController,"wired");this._rfMonitor.start(f);this._ipMonitor.start(f);this.isChip||this._wiredMonitor.start(f);k&&k()};m.prototype.unregister=function(f,k){f.unregistServlet("/"+this.serialNumber);this._rfMonitor.stop(f);this._ipMonitor.stop(f);this.isChip||this._wiredMonitor.stop(f);k&&k()};m.prototype._onControllerMonitorConnected=function(f){"rf"==f&&this._pingpong.start()};m.prototype._onPingFail=function(){var f=this;this.unregister(this._xmlrpcServer,
function(){f.register(f._xmlrpcServer,function(){})})};m.prototype._onPong=function(){this._pingpong._onPong()};m.prototype.reset=function(f){var k=this;this._rfController.reset(function(){k._ipController.reset(function(){k._wiredController.reset(function(){f&&f()})})})};m.prototype.learnRF=function(f){this._rfController.learnNewDevice(function(k,l){f&&f(k,l)})};m.prototype.learnRFSN=function(f,k){this._rfController.learnNewDeviceSN(f,function(f,e){k&&k(f,e)})};m.prototype.learnIP=function(f,k,l){this._ipController.learnNewIPDevice(f,
k,function(f,k){l&&l(f,k)})};m.prototype.learnIPQR=function(f,k){this._ipController.learnNewIPDeviceQR(f,function(f,e){k&&k(f,e)})};m.prototype.deleteDevice=function(f,k,e){if(!f||!k)return e&&e(Error("argument invalid")),null;switch(f){case "BidCos-RF":f=this._rfController;break;case "BidCos-Wired":f=this._wiredController;break;case "HmIP-RF":f=this._ipController;break;default:e&&e(Error("no such interface"));return}f.deleteDevice(k,e)};m.prototype.getDevices=function(f){var k=0;this._rfController&&
k++;this._ipController&&k++;this._wiredController&&k++;var e=[],h=function(l){k--;l?f&&f(l):0==k&&f&&f(null,e)},n=this;this._rfController&&this._rfController.getBufferedDevices(function(f,k){f?(h&&h(f),h=null):(e=e.concat(n._parseDevices(k,"BidCos-RF")),h&&h())});this._ipController&&this._ipController.getBufferedDevices(function(f,k){f?(h&&h(f),h=null):(e=e.concat(n._parseDevices(k,"HmIP-RF")),h&&h())});this._wiredController&&this._wiredController.getBufferedDevices(function(f,k){f?(h&&h(f),h=null):
(e=e.concat(n._parseDevices(k,"BidCos-Wired")),h&&h())})};m.prototype.getParamset=function(f,k,e,h){if(f&&k&&e){var l=null;switch(f){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:h&&h(Error("unknow interface"));return}l.getParamset(k,e,function(f,k){h&&h(f,k)})}else h&&h(Error("argument invalid"))};m.prototype.setParamset=function(f,k,e,h,n){if(f&&k&&e&&h){var l=null;switch(f){case "BidCos-RF":l=this._rfController;
break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:n&&n(Error("unknow interface"));return}l.setParamset(k,e,h,function(f,k){n&&n(f,k)})}else n&&n(Error("argument invalid"))};m.prototype.readValue=function(f,k,e,h){if(f&&k&&e){var l=null;switch(f){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:h&&h(Error("unknow interface"));return}l.readValue(k,e,
function(f,k){h&&h(f,k)})}else h&&h(Error("argument invalid"))};m.prototype.writeValue=function(f,k,e,h,n){if(f&&k&&e){var l=null;switch(f){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:n&&n(Error("unknow interface"));return}l.writeValue(k,e,h,function(f){n&&n(f)})}else n&&n(Error("argument invalid"))};m.prototype.reportValueUsage=function(f,k,e,h){if(f&&k&&e){var l=null;switch(f){case "BidCos-RF":l=
this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:h&&h(Error("unknow interface"));return}l.reportValueUsage(k,e,1,function(f,k){h&&h(f,k)})}else h&&h(Error("argument invalid"))};m.prototype.updateStatusBuffer=function(f,k,e,h,n){if(f&&k&&e){switch(f){case "BidCos-RF":f=this._rfController;break;case "BidCos-Wired":f=this._wiredController;break;case "HmIP-RF":f=this._ipController;break;default:return}f._updateStatusBuffer(k,
e,h,n)}};m.prototype._parseDevices=function(f,k){k||(k="BidCos-RF");var e=new (require("xnm.aio.hm.js").CCU),h={},n;for(n in f)if(f.hasOwnProperty(n)){var m=f[n],p={typename:"DEVICE",hsstype:m.TYPE,address:m.ADDRESS,interface:k,rfAddr:m.RF_ADDRESS,channels:{}};if(m.CHILDREN)for(var t=0,w=m.CHILDREN.length;t<w;t++){var v=m.CHILDREN[t];p.channels[v]={hsstype:f[v].TYPE,address:v}}h[n]=p}return e._parseDevices(h)};m.prototype._xmlrpcCall=function(f,k,e){this._logger.log("trace","receive call:"+f);this._logger.log("trace",
"params:"+JSON.stringify(k));if("event"==f&&"CENTRAL"==k[1]&&"PONG"==k[2])this._onPong(),e&&e(null,[]);else{var h=k[0].split("_");3<=h.length?(h=h[1],-1!=h.indexOf("2001")&&this._rfController?this._rfController._xmlrpcCall(f,k,e):-1!=h.indexOf("2010")&&this._ipController?this._ipController._xmlrpcCall(f,k,e):-1!=h.indexOf("2000")&&this._wiredController?this._wiredController._xmlrpcCall(f,k,e):e&&e(null,[])):e&&e(null,[])}};m.prototype._onNewDevices=function(f){this._logger.log("debug","find new devices");
this._logger.log("debug",JSON.stringify(f));this.emit("new_devices",f)};m.prototype._onEvent=function(f){this._logger.log("trace","receive event:"+JSON.stringify(f));this._logger.log("debug","EVENT:\t"+f.interface+"\t"+f.device.type+"\t"+f.channel+"\t"+f.datapoint+"\t"+f.value.value);f.ip=this.ip;f.serialNumber=this.serialNumber;this.emit("event",f,this)};return m}();
x.hub.m.hm.MonitorManager=function(){var e=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.MonitorManager");this._monitors=[];this._xmlrpcServer=null;this._tmpMonitors={};this._monitorEvtListener=this.onDeviceEvent.bind(this)};e.prototype.init=function(e,m){this._xmlrpcServer=e;m&&m()};e.prototype.startMonitorForIP=function(e,m,f){this.startMonitor({ip:e},{localIP:m},f)};e.prototype.startMonitor=function(e,m,f){if(this._xmlrpcServer)if(e&&e.ip){var k=this.getMonitor(e.ip,e.uuid);
if(k)f&&f();else if(m||(m={}),m.localIP||(m.localIP=x.hub.m.hm._Util.getLocalIP(null,e.ip)),m.localIP){m.localMac||(m.localMac=x.hub.m.hm._Util.getLocalMac(m.localIP));var h=e.ip;this._tmpMonitors[h]||(this._tmpMonitors[h]=[]);var q=this._tmpMonitors[h].length,n=this._tmpMonitors[h];f||(f=function(){});-1==n.indexOf(f)&&n.push(f);if(!(0<q)){var r=this;k=new x.hub.m.hm.Monitor(e,m);k._manager=this;k.init(this._xmlrpcServer,function(f){f||(r._monitors.push(k),k.on("event",r._monitorEvtListener));var e=
r._tmpMonitors[h];delete r._tmpMonitors[h];e.forEach(function(k){k&&k(f)})})}}else f&&f(Error("local ip address invalid"))}else f&&f(Error("gateway invalid"));else f&&f(Error("xml rpc server not started"))};e.prototype.getAllMonitor=function(){return this._monitors};e.prototype.getMonitor=function(e,m){var f=null,k=null;this._monitors.forEach(function(h){h&&h.ip==e&&(f=h);h&&h.serialNumber==m&&(k=h)});return k?k:f};e.prototype.getMonitorStates=function(e){if(0==this._monitors.length)e&&e(null,[]);
else{var h=this,f=0,k=[],l=function(m,n){!m&&n&&(n.ip=h._monitors[f].ip,n.serialNumber=h._monitors[f].serialNumber,k.push(n));f++;f<h._monitors.length?h._monitors[f].getMonitorState(l):e&&e(null,k)};this._monitors[f].getMonitorState(l)}};e.prototype.deleteMonitor=function(e){for(var h=-1,f=0,k=this._monitors.length;f<k;f++){var l=this._monitors[f];if(l&&l.ip==e){h=f;break}}-1!=f&&this._monitors.splice(h,1)};e.prototype.onFindHomeMatic=function(e,m,f){var k=this.getMonitor(null,f),h=this.getMonitor(e);
h?(h.update(e,m,f),k&&k!=h&&(k.finalize(),this.deleteMonitor(k.ip))):(k&&(k.finalize(),this.deleteMonitor(k.ip)),this.startMonitorForIP(e,m))};e.prototype.onDeviceEvent=function(e,m){require("x.hub.m.hm.js").onDeviceEvent(e,m.isChip)};return e}();
x.hub.m.hm._Channel=function(){var e=function(){var f=[];this.map.forEach(function(k){k&&k.dpt&&k.state&&0<k.state.length&&-1==f.indexOf(k.dpt)&&f.push(k.dpt)});return f},h=function(f){var k=null;this.map.forEach(function(e){e&&e.dpt&&e.state&&-1!=e.state.indexOf(f)&&(k=e.dpt)});return k},m=function(f){var k=null;this.map.forEach(function(e){e&&e.dpt&&e.command&&-1!=e.command.indexOf(f)&&(k=e.dpt)});return k};return{"HmIP-RF":{T_MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},
{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]},{dpt:"ACTUAL_TEMPERATURE",state:["maintainTemp"],event:["maintainTemp"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){switch(f){case "UNREACH":return{timeout:k};case "LOW_BAT":return{lowbat:k};
case "SABOTAGE":return{sabotage:k};case "OPERATING_VOLTAGE":return{voltage:parseFloat(k)};case "ERROR_CODE":return{errorCode:parseInt(k)};case "ACTUAL_TEMPERATURE":return{maintainTemp:parseFloat(k)}}return null}},MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){switch(f){case "UNREACH":return{timeout:k};case "LOW_BAT":return{lowbat:k};
case "SABOTAGE":return{sabotage:k}}return null}},MAINTENANCE_BAT_EL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){switch(f){case "UNREACH":return{timeout:k};
case "LOW_BAT":return{lowbat:k};case "SABOTAGE":return{sabotage:k};case "OPERATING_VOLTAGE":return{voltage:parseFloat(k)};case "ERROR_CODE":return{errorCode:parseInt(k)};case "SENSOR_ERROR":return{sensorError:k}}return null}},MAINTENANCE_BAT_CL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"ERROR_NON_FLAT_POSITIONING",state:["sabotage"],event:["sabotage"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){switch(f){case "UNREACH":return{timeout:k};
case "LOW_BAT":return{lowbat:k};case "ERROR_NON_FLAT_POSITIONING":return{sabotage:k}}return null}},SWITCH_TRANSMITTER:{map:[{dpt:"STATE",state:["switchTState"],event:["switchTState"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "STATE":e=1==k?{switchTState:"on"}:0==k?{switchTState:"off"}:{switchTState:"?"}}return e}},SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"STATE",state:["switchState"],event:["switchState"],command:["on","off","toggle"]}],getReadableDpts:e,
getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "STATE":e=1==k?{switchState:"on"}:0==k?{switchState:"off"}:{switchState:"?"}}return e},executeCommand:function(f,k,e,h,n){var l=m.call(this,h);"onFor"==h.substr(0,5)&&(l="STATE");if(l)switch(h){case "on":f.writeValue(k,e,l,!0,n);break;case "off":f.writeValue(k,e,l,!1,n);break;case "toggle":f.getState({interface:k,channel:e,datapoint:l},function(h,m){h?n&&n(h):m?(h=!0,m.value&&(h=!1),f.writeValue(k,e,l,h,n)):n&&n(Error("get switch current value return invalid"))});
break;default:"onFor"==h.substr(0,5)?(h=parseFloat(h.substr(5)),isNaN(h)?n&&n(Error("onFor command invalid")):(l="ON_TIME",f.writeValue(k,e,l,{type:"double",value:h},function(h){h?n&&n(h):(l="STATE",f.writeValue(k,e,l,!0,n))}))):n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}},ENERGIE_METER_TRANSMITTER:{map:[{dpt:"ENERGY_COUNTER",state:["meterEnergyCounter"],event:["meterEnergyCounter"]},{dpt:"POWER",state:["meterPower"],event:["meterPower"]},{dpt:"CURRENT",
state:["meterCurrent"],event:["meterCurrent"]},{dpt:"VOLTAGE",state:["meterVoltage"],event:["meterVoltage"]},{dpt:"FREQUENCY",state:["meterFrequency"],event:["meterFrequency"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){switch(f){case "ENERGY_COUNTER":return{meterEnergyCounter:parseFloat(k).toFixed(2)};case "POWER":return{meterPower:parseFloat(k).toFixed(2)};case "CURRENT":return{meterCurrent:parseFloat(k).toFixed(2)};case "VOLTAGE":return{meterVoltage:parseFloat(k).toFixed(2)};
case "FREQUENCY":return{meterFrequency:parseFloat(k).toFixed(2)}}return null}},DIMMER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["dimmerTLevel"],event:["dimmerTLevel"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "LEVEL":e={dimmerTLevel:Math.round(100*parseFloat(k))};break;case "COLOR":e={dimmerTColor:"off blue green torqoise red purple yellow white".split(" ")[parseInt(k)]}}return e}},DIMMER_VIRTUAL_RECEIVER:{map:[{dpt:"LEVEL",state:["dimmerLevel"],event:["dimmerLevel"],
command:["dimOff","dimUp","dimDown","dimTo","toggleTo"]},{dpt:"COLOR",state:["dimmerColor"],event:["dimmerColor"],command:["colorTo"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "LEVEL":e={dimmerLevel:Math.round(100*parseFloat(k))}}return e},executeCommand:function(f,k,e,h,n){if(h){if("dimOff"==h.substr(0,6))var l="dimOff";else if("dimUp"==h.substr(0,5)){l="dimUp";var p=h.substr(5)}else if("dimDown"==h.substr(0,7))l="dimDown",p=h.substr(7);else if("dimTo"==
h.substr(0,5)){if(l="dimTo",p=h.substr(5),!p){n&&n(Error("dimTo has no value"));return}}else if("toggleTo"==h.substr(0,8)){if(l="toggleTo",p=h.substr(8),!p){n&&n(Error("toggleTo has no value"));return}}else if("colorTo"==h.substr(0,7)&&(l="colorTo",p=h.substr(7),!p)){n&&n(Error("colorTo has no value"));return}var q=m.call(this,l);if(q)switch(l){case "dimOff":f.writeValue(k,e,q,{type:"double",value:0},n);break;case "dimUp":p||(p=10);p=parseInt(p)/100;f.getState({interface:k,channel:e,datapoint:q},
function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),f.writeValue(k,e,q,{type:"double",value:p},n))});break;case "dimDown":p||(p=10);p=parseInt(p)/100;f.getState({interface:k,channel:e,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),f.writeValue(k,e,q,{type:"double",value:p},n))});break;case "toggleTo":p=parseInt(p)/100;
f.getState({interface:k,channel:e,datapoint:q},function(h,l){h?n&&n(h):l?(l.value&&(p=0),f.writeValue(k,e,q,{type:"double",value:p},n)):n&&n(Error("get switch current value return invalid"))});break;case "dimTo":p=parseInt(p)/100;f.writeValue(k,e,q,{type:"double",value:p},n);break;case "colorTo":p=p.toLowerCase();p="off blue green torqoise red purple yellow white".split(" ").indexOf(p);if(-1==p){n&&n(Error("unknown color"));break}f.writeValue(k,e,q,{type:"double",value:p},n);break;default:n&&n(Error("no such command"))}else n&&
n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},MOTIONDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_MOTION",command:["reset"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"MOTION_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "MOTION":e={state:k?
"on":"off"};break;case "ILLUMINATION":e={illumination:k};break;case "MOTION_DETECTION_ACTIVE":e={active:k}}return e},executeCommand:function(f,k,e,h,n){if(h){var l=m.call(this,h);if(l)switch(h){case "reset":f.writeValue(k,e,l,!0,n);break;case "activate":f.writeValue(k,e,l,!0,n);break;case "deactivate":f.writeValue(k,e,l,!1,n);break;case "toggleActivate":f.getState({interface:k,channel:e,datapoint:l},function(h,m){h?n&&n(h):m?(h=!0,m.value&&(h=!1),f.writeValue(k,e,l,h,n)):n&&n(Error("get switch current value return invalid"))});
break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},KEY_TRANRECEIVER:{map:[{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){k=null;switch(f){case "PRESS_SHORT":k={pressShort:!0};break;case "PRESS_LONG":k={pressLong:!0}}return k}},ALARM_SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"ACOUSTIC_ALARM_SELECTION",command:["setAudio"]},
{dpt:"OPTICAL_ALARM_SELECTION",command:["setVisual"]},{dpt:"DURATION_UNIT",command:["setDuraionUnit"]},{dpt:"DURATION_VALUE",command:["setDuraion"]},{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "STATE":e=1==k?{state:"on"}:0==k?{state:"off"}:{state:"?"}}return e},executeCommand:function(f,k,e,h,n){if(h){var l=null;if("triggerAlarm"==h.substr(0,12)){l="triggerAlarm";var p=h.substr(12);if(!p){n&&n(Error("triggerAlarm format invalid"));
return}}if(m.call(this,l)||"triggerAlarm"==l)switch(l){case "triggerAlarm":var q=p.split(",");if(4>q.length){n&&n(Error("triggerAlarm format invalid"));break}f.writeValue(k,e,"ACOUSTIC_ALARM_SELECTION",{type:"double",value:parseInt(q[0])},function(h,l){h?n&&n(h):f.writeValue(k,e,"OPTICAL_ALARM_SELECTION",{type:"double",value:parseInt(q[1])},function(h,l){h?n&&n(h):f.writeValue(k,e,"DURATION_VALUE",{type:"double",value:parseInt(q[2])},function(h,l){h?n&&n(h):f.writeValue(k,e,"DURATION_UNIT",{type:"double",
value:parseInt(q[3])},n)})})});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},HEATING_CLIMATECONTROL_TRANSCEIVER:{map:[{dpt:"SET_POINT_TEMPERATURE",command:["tempTo","tempUp","tempDown"],state:["state"],event:["state"]},{dpt:"HUMIDITY",state:["hum"],event:["hum"]},{dpt:"CONTROL_MODE",command:["auto","manu"]},{dpt:"FROST_PROTECTION",state:["frost"],event:["frost"]},{dpt:"SET_POINT_MODE",state:["mode"],event:["mode"]},
{dpt:"ACTIVE_PROFILE",command:["setProfile"],state:["profile"],event:["profile"]},{dpt:"WINDOW_STATE",command:["winOpen","winClose"],state:["window"],event:["window"]},{dpt:"ACTUAL_TEMPERATURE",state:["temp"],event:["temp"]},{dpt:"BOOST_MODE",command:["boostOn","boostOff"],state:["boost"],event:["boost"]},{dpt:"LEVEL",command:["setValve","valveUp","valveDown"],state:["valve"],event:["valve"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e={};switch(f){case "ACTIVE_PROFILE":e.profile=
parseInt(k);break;case "ACTUAL_TEMPERATURE":e.temp=parseFloat(k);break;case "BOOST_MODE":e.boost=k;break;case "FROST_PROTECTION":e.frost=k;break;case "HUMIDITY":e.hum=parseInt(k);break;case "SET_POINT_MODE":0==k?e.mode="auto":1==k&&(e.mode="manu");break;case "SET_POINT_TEMPERATURE":e.state=parseFloat(k);break;case "LEVEL":e.valve=Math.round(100*parseFloat(k));break;case "WINDOW_STATE":switch(k){case 0:e.window="closed";break;case 1:e.window="open"}break;default:return null}return e},executeCommand:function(f,
k,e,h,n){if(h){var l=h;if("tempTo"==h.substr(0,6)){l="tempTo";var p=h.substr(6);if(!p){n&&n(Error("tempTo has no value"));return}}else if("tempUp"==h.substr(0,6))l="tempUp",p=h.substr(6);else if("tempDown"==h.substr(0,8))l="tempDown",p=h.substr(8);else if("setProfile"==h.substr(0,10)){if(l="setProfile",p=h.substr(10),!p){n&&n(Error("setProfile has no value"));return}}else if("setValve"==h.substr(0,8)){if(l="setValve",p=h.substr(8),!p){n&&n(Error("setValve has no value"));return}}else"valveUp"==h.substr(0,
7)?(l="valveUp",p=h.substr(7)):"valveDown"==h.substr(0,9)&&(l="valveDown",p=h.substr(9));var q=m.call(this,l);if(q)switch(l){case "tempTo":p=parseFloat(p);if(isNaN(p)){n&&n(Error("tempTo value invalid"));break}30.5<p&&(p=30.5);4.5>p&&(p=4.5);f.writeValue(k,e,q,{type:"double",value:p},n);break;case "tempUp":p||(p=1);p=parseFloat(p);if(isNaN(p)){n&&n(Error("tempUp value invalid"));break}f.getState({interface:k,channel:e,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):
(p=l.value+p,30.5<p&&(p=30.5),f.writeValue(k,e,q,{type:"double",value:p},n))});break;case "tempDown":p||(p=1);p=parseFloat(p);if(isNaN(p)){n&&n(Error("tempDown value invalid"));break}f.getState({interface:k,channel:e,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,4.5>p&&(p=4.5),f.writeValue(k,e,q,{type:"double",value:p},n))});break;case "auto":f.writeValue(k,e,q,{type:"double",value:0},n);break;case "manu":f.writeValue(k,
e,q,{type:"double",value:1},n);break;case "setProfile":p=parseInt(p);if(isNaN(p)){n&&n(Error("setTemp value invalid"));break}f.writeValue(k,e,q,p,n);break;case "winOpen":f.writeValue(k,e,q,1,n);break;case "winClose":f.writeValue(k,e,q,0,n);break;case "boostOn":f.writeValue(k,e,q,!0,n);break;case "boostOff":f.writeValue(k,e,q,!1,n);break;case "setValve":p=parseInt(p);if(isNaN(p)){n&&n(Error("setValve value invalid"));break}p/=100;1<p&&(p=1);0>p&&(p=0);f.writeValue(k,e,q,{type:"double",value:p},n);
break;case "valveUp":p||(p=10);p=parseInt(p);if(isNaN(p)){n&&n(Error("tempUp value invalid"));break}p/=100;f.getState({interface:k,channel:e,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),f.writeValue(k,e,q,{type:"double",value:p},n))});break;case "valveDown":p||(p=10);p=parseInt(p);if(isNaN(p)){n&&n(Error("tempUp value invalid"));break}p/=100;f.getState({interface:k,channel:e,datapoint:q},function(h,
l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),f.writeValue(k,e,q,{type:"double",value:p},n))});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},SHUTTER_CONTACT_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "STATE":e={state:0==
k?"closed":"open"}}return e}},SMOKE_DETECTOR:{map:[{dpt:"SMOKE_DETECTOR_COMMAND",command:"reservedAlarmOff intrusionAlarmOff intrusionAlarmOn smokeTest commTest commTestRepeated".split(" ")},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["state"],event:["state"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["alarmDetail"],event:["alarmDetail"]},{dpt:"SMOKE_DETECTOR_TEST_RESULT",state:["testResult"],event:["testResult"]},{dpt:"ERROR_CODE",state:["error"],event:["error"]}],getReadableDpts:e,getDptFromState:h,
parseDptState:function(f,k){var e=null;switch(f){case "SMOKE_DETECTOR_ALARM_STATUS":e={state:0==k?"ok":"smoke"};e.alarmDetail=k;break;case "SMOKE_DETECTOR_TEST_RESULT":switch(k){case 0:e={testResult:"none"};break;case 1:e={testResult:"smoke_ok"};break;case 2:e={testResult:"smoke_nok"};break;case 3:e={testResult:"comm_sent"};break;case 4:e={testResult:"comm_ok"}}break;case "ERROR_CODE":e={error:k}}return e},executeCommand:function(f,k,e,h,n){if(h){var l=m.call(this,h);if(l)switch(h){case "reservedAlarmOff":case "intrusionAlarmOff":case "intrusionAlarmOn":case "smokeTest":case "commTest":case "commTestRepeated":switch(h){case "reservedAlarmOff":var p=
0;break;case "intrusionAlarmOff":p=1;break;case "intrusionAlarmOn":p=2;break;case "smokeTest":p=3;break;case "commTest":p=4;break;case "commTestRepeated":p=5}f.writeValue(k,e,l,p,n);break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},ROTARY_HANDLE_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "STATE":switch(k){case 0:e=
{state:"closed"};break;case 1:e={state:"tilted"};break;case 2:e={state:"open"}}}return e}},SHUTTER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTLevel"],event:["blindTLevel"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "LEVEL":e={blindTLevel:Math.round(100*parseFloat(k))}}return e}},SHUTTER_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindLevel"],event:["blindLevel"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]}],
getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "LEVEL":e={blindLevel:Math.round(100*parseFloat(k))}}return e},executeCommand:function(f,k,e,h,n){if(h){if("moveUp"==h.substr(0,6))var l="moveUp";else if("moveDown"==h.substr(0,8)){l="moveDown";var p=h.substr(8)}else if("stepUp"==h.substr(0,6))l="stepUp",p=h.substr(6);else if("stepDown"==h.substr(0,8))l="stepDown",p=h.substr(8);else if("moveTo"==h.substr(0,6)){if(l="moveTo",p=h.substr(6),!p){n&&n(Error("moveTo has no value"));
return}}else"stop"==h.substr(0,4)&&(l="stop");var q=m.call(this,l);if(q)switch(l){case "moveUp":f.writeValue(k,e,q,{type:"double",value:1},n);break;case "moveDown":f.writeValue(k,e,q,{type:"double",value:0},n);break;case "stop":f.writeValue(k,e,q,!0,n);break;case "stepUp":p||(p=5);p=parseInt(p)/100;f.getState({interface:k,channel:e,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),f.writeValue(k,e,q,{type:"double",
value:p},n))});break;case "stepDown":p||(p=5);p=parseInt(p)/100;f.getState({interface:k,channel:e,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),f.writeValue(k,e,q,{type:"double",value:p},n))});break;case "moveTo":p=parseInt(p)/100;f.writeValue(k,e,q,{type:"double",value:p},n);break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},
BLIND_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTPos"],event:["blindTPos"]},{dpt:"LEVEL_2",state:["lamellaTPos"],event:["lamellaTPos"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "LEVEL":e={blindTPos:Math.round(100*parseFloat(k))};break;case "LEVEL_2":e={lamellaTPos:Math.round(100*parseFloat(k))}}return e}},BLIND_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindPos"],event:["blindPos"],command:["moveUp","moveDown","stepUp",
"stepDown","moveTo"]},{dpt:"LEVEL_2",state:["lamellaPos"],event:["lamellaPos"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "LEVEL":e={blindPos:Math.round(100*parseFloat(k))};break;case "LEVEL_2":e={lamellaPos:Math.round(100*parseFloat(k))}}return e},executeCommand:function(f,k,e,h,n){if(h){var l=h;if("lamellaStepUp"==h.substr(0,13)){l="lamellaStepUp";var p=h.substr(13)}else if("lamellaStepDown"==
h.substr(0,15))l="lamellaStepDown",p=h.substr(15);else if("lamellaTo"==h.substr(0,9)){if(l="lamellaTo",p=h.substr(9),!p){n&&n(Error("lamellaTo has no value"));return}}else if("stepUp"==h.substr(0,6))l="stepUp",p=h.substr(6);else if("stepDown"==h.substr(0,8))l="stepDown",p=h.substr(8);else if("moveTo"==h.substr(0,6)){if(l="moveTo",p=h.substr(6),!p){n&&n(Error("moveTo has no value"));return}}else"stop"==h.substr(0,4)&&(l="stop");var q=m.call(this,l);if(q)switch(l){case "moveUp":case "moveDown":f.writeValue(k,
e,"LEVEL_2",{type:"double",value:"moveUp"==l?1:0},function(h){h?n&&n(h):f.writeValue(k,e,"LEVEL",{type:"double",value:"moveUp"==l?1:0},function(f){n&&n(f)})});break;case "stop":f.writeValue(k,e,q,!0,n);break;case "moveTo":p=parseInt(p)/100;f.writeValue(k,e,"LEVEL",{type:"double",value:p},n);break;case "lamellaUp":case "lamellaDown":f.getState({interface:k,channel:e,datapoint:"LEVEL"},function(h,m){h?n&&n(h):f.writeValue(k,e,"LEVEL",{type:"double",value:m.value},function(h){h?n&&n(h):f.writeValue(k,
e,"LEVEL_2",{type:"double",value:"lamellaUp"==l?1:0},function(f){n&&n(f)})})});break;case "stepUp":case "stepDown":p||(p=5);p=parseInt(p)/100;f.getState({interface:k,channel:e,datapoint:"LEVEL"},function(h,m){h?n&&n(h):"undefined"==typeof m||null==m?n&&n(Error("get jalousie current value return invalid")):(p="stepUp"==l?m.value+p:m.value-p,1<p&&(p=1),0>p&&(p=0),f.writeValue(k,e,"LEVEL",{type:"double",value:p},n))});break;case "lamellaStepUp":case "lamellaStepDown":p||(p=5);p=parseInt(p)/100;f.getState({interface:k,
channel:e,datapoint:"LEVEL"},function(h,m){if(h)n&&n(h);else if("undefined"==typeof m||null==m)n&&n(Error("get jalousie current value return invalid"));else{var q=m.value;f.getState({interface:k,channel:e,datapoint:"LEVEL_2"},function(h,m){h?n&&n(h):"undefined"==typeof m||null==m?n&&n(Error("get jalousie current value return invalid")):(p="lamellaStepUp"==l?m.value+p:m.value-p,1<p&&(p=1),0>p&&(p=0),f.writeValue(k,e,"LEVEL_2",{type:"double",value:p},function(h){h?n&&n(h):f.writeValue(k,e,"LEVEL",{type:"double",
value:q},n)}))})}});break;case "lamellaTo":p=parseInt(p)/100;f.writeValue(k,e,"LEVEL_2",{type:"double",value:p},n);break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},PRESENCEDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_PRESENCE",command:["reset"]},{dpt:"PRESENCE_DETECTION_STATE",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"CURRENT_ILLUMINATION",state:["current_illumination"],
event:["current_illumination"]},{dpt:"PRESENCE_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "PRESENCE_DETECTION_STATE":e={state:k?"on":"off"};break;case "ILLUMINATION":e={illumination:k};break;case "CURRENT_ILLUMINATION":e={current_illumination:k};break;case "PRESENCE_DETECTION_ACTIVE":e={active:k}}return e},executeCommand:function(f,k,e,h,n){if(h){var l=
m.call(this,h);if(l)switch(h){case "reset":f.writeValue(k,e,l,!0,n);break;case "activate":f.writeValue(k,e,l,!0,n);break;case "deactivate":f.writeValue(k,e,l,!1,n);break;case "toggleActivate":f.getState({interface:k,channel:e,datapoint:l},function(h,m){h?n&&n(h):m?(h=!0,m.value&&(h=!1),f.writeValue(k,e,l,h,n)):n&&n(Error("get switch current value return invalid"))});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},
CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER:{map:[{dpt:"EMERGENCY_OPERATION",state:["cl_fd_emergencyOP"],event:["cl_fd_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fd_frostProtection"],event:["cl_fd_frostProtection"]},{dpt:"STATE",state:["cl_fd_state"],event:["cl_fd_state"]},{dpt:"HUMIDITY_ALARM",state:["cl_fd_humidityAlarm"],event:["cl_fd_humidityAlarm"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "EMERGENCY_OPERATION":e={cl_fd_emergencyOP:k};break;
case "FROST_PROTECTION":e={cl_fd_frostProtection:k};break;case "STATE":e=1==k?{cl_fd_state:"on"}:0==k?{cl_fd_state:"off"}:{cl_fd_state:"?"};break;case "HUMIDITY_ALARM":e={cl_fd_humidityAlarm:k}}return e}},CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_fp_humidityLimiter"],event:["cl_fp_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_fp_emergencyOP"],event:["cl_fp_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fp_frostProtection"],event:["cl_fp_frostProtection"]},
{dpt:"STATE",state:["cl_fp_state"],event:["cl_fp_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_fp_dewPointAlarm"],event:["cl_fp_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_fp_externalClock"],event:["cl_fp_externalClock"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "HUMIDITY_LIMITER":e={cl_fp_humidityLimiter:k};break;case "EMERGENCY_OPERATION":e={cl_fp_emergencyOP:k};break;case "FROST_PROTECTION":e={cl_fp_frostProtection:k};break;case "STATE":e=1==
k?{cl_fp_state:"on"}:0==k?{cl_fp_state:"off"}:{cl_fp_state:"?"};break;case "DEW_POINT_ALARM":e={cl_fp_dewPointAlarm:k};break;case "EXTERNAL_CLOCK":e={cl_fp_externalClock:k}}return e}},CLIMATECONTROL_FLOOR_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_f_humidityLimiter"],event:["cl_f_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_f_emergencyOP"],event:["cl_f_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_f_frostProtection"],event:["cl_f_frostProtection"]},{dpt:"STATE",state:["cl_f_state"],
event:["cl_f_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_f_dewPointAlarm"],event:["cl_f_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_f_externalClock"],event:["cl_f_externalClock"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "HUMIDITY_LIMITER":e={cl_f_humidityLimiter:k};break;case "EMERGENCY_OPERATION":e={cl_f_emergencyOP:k};break;case "FROST_PROTECTION":e={cl_f_frostProtection:k};break;case "STATE":e=1==k?{cl_f_state:"on"}:0==k?{cl_f_state:"off"}:
{cl_f_state:"?"};break;case "DEW_POINT_ALARM":e={cl_f_dewPointAlarm:k};break;case "EXTERNAL_CLOCK":e={cl_f_externalClock:k}}return e}},WEATHER_TRANSMIT:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["weatherActualTemp"],event:["weatherActualTemp"]},{dpt:"HUMIDITY",state:["weatherHum"],event:["weatherHum"]},{dpt:"ILLUMINATION",state:["weatherIllu"],event:["weatherIllu"]},{dpt:"SUNSHINEDURATION",state:["weatherSunD"],event:["weatherSunD"]},{dpt:"SUNSHINEDURATION_OVERFLOW",state:["weatherSunDOF"],event:["weatherSunDOF"]},
{dpt:"SUNSHINE_THRESHOLD_OVERRUN",state:["weatherSunTOR"],event:["weatherSunTOR"]},{dpt:"WIND_SPEED",state:["weatherWindS"],event:["weatherWindS"]},{dpt:"WIND_THRESHOLD_OVERRUN",state:["weatherWindTOR"],event:["weatherWindTOR"]},{dpt:"WIND_DIR",state:["weatherWindD"],event:["weatherWindD"]},{dpt:"WIND_DIR_RANGE",state:["weatherWindDR"],event:["weatherWindDR"]},{dpt:"RAINING",state:["weatherRain"],event:["weatherRain"]},{dpt:"RAIN_COUNTER",state:["weatherRainC"],event:["weatherRainC"]},{dpt:"RAIN_COUNTER_OVERFLOW",
state:["weatherRainCOF"],event:["weatherRainCOF"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "ACTUAL_TEMPERATURE":e={weatherActualTemp:k};break;case "HUMIDITY":e={weatherHum:k};break;case "ILLUMINATION":e={weatherIllu:k};break;case "SUNSHINEDURATION":e={weatherSunD:k};break;case "SUNSHINEDURATION_OVERFLOW":e={weatherSunDOF:k};break;case "SUNSHINE_THRESHOLD_OVERRUN":e={weatherSunTOR:k};break;case "WIND_SPEED":e={weatherWindS:k};break;case "WIND_THRESHOLD_OVERRUN":e=
{weatherWindTOR:k};break;case "RAINING":e={weatherRain:k};break;case "RAIN_COUNTER":e={weatherRainC:k};break;case "RAIN_COUNTER_OVERFLOW":e={weatherRainCOF:k};break;case "WIND_DIR":e={weatherWindD:k};break;case "WIND_DIR_RANGE":e={weatherWindDR:k}}return e}},CLIMATE_TRANSCEIVER:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["temperature"],event:["temperature"]},{dpt:"HUMIDITY",state:["humidity"],event:["humidity"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,k){var e=null;switch(f){case "ACTUAL_TEMPERATURE":e=
{temperature:k};break;case "HUMIDITY":e={humidity:k}}return e}},PASSAGE_DETECTOR_DIRECTION_TRANSMITTER:{map:[{dpt:"CURRENT_PASSAGE_DIRECTION",state:["current_direction"],event:["current_direction"]},{dpt:"LAST_PASSAGE_DIRECTION",state:["last_direction"],event:["last_direction"]},{dpt:"PASSAGE_COUNTER_OVERFLOW",state:["passage_counter_overflow"],event:["passage_counter_overflow"]},{dpt:"PASSAGE_COUNTER_VALUE",state:["passage_counter"],event:["passage_counter"]}],getReadableDpts:e,getDptFromState:h,
parseDptState:function(f,k){var e=null;switch(f){case "CURRENT_PASSAGE_DIRECTION":e={current_direction:k};break;case "LAST_PASSAGE_DIRECTION":e={last_direction:k};break;case "PASSAGE_COUNTER_OVERFLOW":e={passage_counter_overflow:k};break;case "PASSAGE_COUNTER_VALUE":e={passage_counter:k}}return e}},GENERIC_INPUT_TRANSMITER:{map:[{dpt:"CHANGE_OVER",state:["genInputChangeOver"],event:["genInputChangeOver"]},{dpt:"EXTERNAL_CLOCK",state:["genInputExtClock"],event:["genInputExtClock"]},{dpt:"HUMIDITY_LIMITER",
state:["genInputHumidityLimiter"],event:["genInputHumidityLimiter"]},{dpt:"STATE",state:["genInputState"],event:["genInputState"]},{dpt:"TACTILE_SWITCH",state:["genInputTactileSwitch"],event:["genInputTactileSwitch"]},{dpt:"TEMPERATURE_LIMITER",state:["genInputTempLimiter"],event:["genInputTempLimiter"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k=null;switch(f){case "CHANGE_OVER":k={genInputChangeOver:e};break;case "EXTERNAL_CLOCK":k={genInputExtClock:e};break;case "HUMIDITY_LIMITER":k=
{genInputHumidityLimiter:e};break;case "STATE":k=1==e?{genInputState:"on"}:0==e?{genInputState:"off"}:{genInputState:"?"};break;case "TACTILE_SWITCH":k={genInputTactileSwitch:e};break;case "TEMPERATURE_LIMITER":k={genInputTempLimiter:e}}return k}},ANALOG_OUTPUT_TRANSCEIVER:{map:[{dpt:"LEVEL",state:["outputLevel"],event:["outputLevel"],command:["outputOff","outputUp","outputDown","outputTo","toggleTo"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k=null;switch(f){case "LEVEL":k=
{outputLevel:Math.round(100*parseFloat(e))}}return k},executeCommand:function(f,e,h,q,n){if(q){if("outputOff"==q.substr(0,9))var k="outputOff";else if("outputUp"==q.substr(0,8)){k="outputUp";var l=q.substr(8)}else if("outputDown"==q.substr(0,10))k="outputDown",l=q.substr(10);else if("outputTo"==q.substr(0,8)){if(k="outputTo",l=q.substr(8),!l){n&&n(Error("outputTo has no value"));return}}else if("toggleTo"==q.substr(0,8)){if(k="toggleTo",l=q.substr(8),!l){n&&n(Error("toggleTo has no value"));return}}else isNaN(parseInt(q))||
(k="outputTo",l=parseInt(q));var t=m.call(this,k);if(t)switch(k){case "outputOff":f.writeValue(e,h,t,{type:"double",value:0},n);break;case "outputUp":l||(l=10);l=parseInt(l)/100;f.getState({interface:e,channel:h,datapoint:t},function(k,m){k?n&&n(k):"undefined"==typeof m||null==m?n&&n(Error("get dimmer current value return invalid")):(l=m.value+l,1<l&&(l=1),f.writeValue(e,h,t,{type:"double",value:l},n))});break;case "outputDown":l||(l=10);l=parseInt(l)/100;f.getState({interface:e,channel:h,datapoint:t},
function(k,m){k?n&&n(k):"undefined"==typeof m||null==m?n&&n(Error("get dimmer current value return invalid")):(l=m.value-l,0>l&&(l=0),f.writeValue(e,h,t,{type:"double",value:l},n))});break;case "toggleTo":l=parseInt(l)/100;f.getState({interface:e,channel:h,datapoint:t},function(k,m){k?n&&n(k):m?(m.value&&(l=0),f.writeValue(e,h,t,{type:"double",value:l},n)):n&&n(Error("get switch current value return invalid"))});break;case "outputTo":l=parseInt(l)/100;f.writeValue(e,h,t,{type:"double",value:l},n);
break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+q))}else n&&n(Error("command in null"))}},WATER_DETECTION_TRANSMITTER:{map:[{dpt:"ALARMSTATE",state:["alarm"],event:["alarm"]},{dpt:"MOISTURE_DETECTED",state:["moisture"],event:["moisture"]},{dpt:"WATERLEVEL_DETECTED",state:["water"],event:["water"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k=null;switch(f){case "ALARMSTATE":k={alarm:e};break;case "MOISTURE_DETECTED":k={moisture:e};
break;case "WATERLEVEL_DETECTED":k={water:e}}return k}},ACCELERATION_TRANSCEIVER:{map:[{dpt:"MOTION",state:["motion"],event:["motion"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k=null;switch(f){case "MOTION":k={motion:e}}return k}},DOOR_RECEIVER:{map:[{dpt:"DOOR_STATE",state:["doorState"],event:["doorState"]},{dpt:"DOOR_COMMAND",command:["open","close","partialOpen","stop"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k=null;switch(f){case "DOOR_STATE":e=
parseInt(e),k=0==e?{doorState:"closed"}:1==e?{doorState:"open"}:2==e?{doorState:"ventilation"}:{doorState:"unknown"}}return k},executeCommand:function(f,e,h,q,n){if(q){var k=m.call(this,q);if(k)switch(q){case "open":f.writeValue(e,h,k,{type:"double",value:1},n);break;case "stop":f.writeValue(e,h,k,{type:"double",value:2},n);break;case "close":f.writeValue(e,h,k,{type:"double",value:3},n);break;case "partialOpen":f.writeValue(e,h,k,{type:"double",value:4},n);break;default:n&&n(Error("no such command"))}else n&&
n(Error("can not find datapoint for command:"+q))}else n&&n(Error("command in null"))}},SIMPLE_SWITCH_RECEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"],command:["on","off","toggle"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k=null;switch(f){case "STATE":k=1==e?{state:"on"}:0==e?{state:"off"}:{state:"?"}}return k},executeCommand:function(f,e,h,q,n){var k=m.call(this,q);if(k)switch(q){case "on":f.writeValue(e,h,k,!0,n);break;case "off":f.writeValue(e,h,k,!1,n);
break;case "toggle":f.getState({interface:e,channel:h,datapoint:k},function(l,m){l?n&&n(l):m?(l=!0,m.value&&(l=!1),f.writeValue(e,h,k,l,n)):n&&n(Error("get switch current value return invalid"))});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+q))}},MULTI_MODE_INPUT_TRANSMITTER:{map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,
e){var k=null;switch(f){case "STATE":k=1==e?{state:"on"}:0==e?{state:"off"}:{state:"?"};break;case "PRESS_SHORT":k={pressShort:!0};break;case "PRESS_LONG":k={pressLong:!0}}return k}},BRIGHTNESS_TRANSMITTER:{map:[{dpt:"AVERAGE_ILLUMINATION",state:["avgIllu"],event:["avgIllu"]},{dpt:"CURRENT_ILLUMINATION",state:["illu"],event:["illu"]},{dpt:"HIGHEST_ILLUMINATION",state:["maxIllu"],event:["maxIllu"]},{dpt:"LOWEST_ILLUMINATION",state:["minIllu"],event:["minIllu"]}],getReadableDpts:e,getDptFromState:h,
parseDptState:function(f,e){var k=null;switch(f){case "AVERAGE_ILLUMINATION":k={avgIllu:parseFloat(parseFloat(e).toFixed(2))};break;case "CURRENT_ILLUMINATION":k={illu:parseFloat(parseFloat(e).toFixed(2))};break;case "HIGHEST_ILLUMINATION":k={maxIllu:parseFloat(parseFloat(e).toFixed(2))};break;case "LOWEST_ILLUMINATION":k={minIllu:parseFloat(parseFloat(e).toFixed(2))}}return k}},POWER_MAINS_TRANSMITTER:{map:[{dpt:"POWER_MAINS_FAILURE",state:["powerMainsFailure"],event:["powerMainsFailure"]}],getReadableDpts:e,
getDptFromState:h,parseDptState:function(f,e){var k=null;switch(f){case "POWER_MAINS_FAILURE":k={powerMainsFailure:e}}return k}}},"BidCos-RF":{MAINTENANCE:{device:"maintenance",map:[{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]},{dpt:"UNREACH",state:["timeout"],event:["timeout"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){switch(f){case "LOWBAT":return{lowbat:e};case "UNREACH":return{timeout:e};default:return null}}},KEY:{device:"button",map:[{dpt:"PRESS_SHORT",event:["pressShort"],
command:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"],command:["pressLong"]},{dpt:"PRESS_LONG_RELEASE",event:["pressLongRel"]},{dpt:"PRESS_CONT",event:["pressCont"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){switch(f){case "PRESS_SHORT":return{pressShort:e};case "PRESS_LONG":return{pressLong:e};case "PRESS_CONT":return{pressCont:e};case "PRESS_LONG_RELEASE":return{pressLongRel:e};default:return null}},executeCommand:function(f,e,h,q,n){var k=m.call(this,q);switch(q){case "pressShort":f.writeValue(e,
h,k,!0,n);break;case "pressLong":f.writeValue(e,h,k,!0,n);break;default:n&&n(Error("no such command"))}}},SWITCH_INTERFACE:{device:"switch_interface",map:[{dpt:"PRESS",event:["press"],command:["press"]}],parseDptState:function(f,e){switch(f){case "PRESS":return{press:!0};default:return null}},executeCommand:function(f,e,h,q,n){var k=m.call(this,q);switch(q){case "press":f.writeValue(e,h,k,!0,n);break;default:n&&n(Error("no such command"))}}},SHUTTER_CONTACT:{device:"contact",map:[{dpt:"STATE",state:["state"],
event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){switch(f){case "STATE":return{state:e?"open":"closed"};case "ERROR":return{error:1==e?"sabotage":"no_error"};case "LOWBAT":return{lowbat:e};default:return null}}},JALOUSIE:{device:"jalousie",map:[{dpt:"LEVEL",state:["jalState"],event:["jalState"],command:["moveUp","moveDown","stepUp","stepDown","%d"]},{dpt:"STOP",command:["stop"]},
{dpt:"LEVEL_SLATS",state:["jalLmlState"],event:["jalLmlState"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo%d"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k=null;switch(f){case "LEVEL":e=Math.round(100*parseFloat(e));k={jalState:e};break;case "LEVEL_SLATS":e=Math.round(100*parseFloat(e)),k={jalLmlState:e}}return k},executeCommand:function(f,e,h,q,n){var k=m.call(this,q);switch(q){case "moveUp":f.writeValue(e,h,k,{type:"double",value:1},
n);break;case "moveDown":f.writeValue(e,h,k,{type:"double",value:0},n);break;case "stepUp":f.getState({interface:e,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);f.writeValue(e,h,k,{type:"double",value:p},function(l){l?n&&n(l):(f.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current jalousie state result invalid"))});break;case "stepDown":f.getState({interface:e,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=
m.value-.05;0>p&&(p=0);f.writeValue(e,h,k,{type:"double",value:p},function(l){l?n&&n(l):(f.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current blind state result invalid"))});break;case "stop":f.writeValue(e,h,k,!0,n);break;case "lamellaUp":f.writeValue(e,h,k,{type:"double",value:1},n);break;case "lamellaDown":f.writeValue(e,h,k,{type:"double",value:0},n);break;case "lamellaStepUp":f.getState({interface:e,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=
m.value+.05;1<p&&(p=1);f.writeValue(e,h,k,{type:"double",value:p},function(l){l?n&&n(l):(f.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current lamella state result invalid"))});break;case "lamellaStepDown":f.getState({interface:e,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);f.writeValue(e,h,k,{type:"double",value:p},function(l){l?n&&n(l):(f.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current lamella state result invalid"))});
break;default:if("lamellaTo"==q.substr(0,9)){q=q.substr(9);var l=parseInt(q);l/=100;k="LEVEL_SLATS";f.writeValue(e,h,k,{type:"double",value:l},function(m){m?n&&n(m):(f.updateStatusBuffer(e,h,k,l,(new Date).getTime()+1E3),n&&n())})}else"moveTo"==q.substr(0,6)||q.match(/^[-+]?[0-9]+$/)?("moveTo"==q.substr(0,6)&&(q=q.substr(6)),l=parseInt(q),l/=100,k="LEVEL",f.writeValue(e,h,k,{type:"double",value:l},function(m){m?n&&n(m):(f.updateStatusBuffer(e,h,k,l,(new Date).getTime()+1E3),n&&n())})):n&&n(Error("no such command"))}}},
MOD_EM8BIT_TRANSMITTER:{map:[{dpt:"STATE",state:["state8bit"],event:["state8bit"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k=null;switch(f){case "STATE":e=parseInt(e);k={state8bit:e};break;case "LOWBAT":k={lowbat:e}}return k}},KEYMATIC:{device:"keymatic",map:[{dpt:"STATE",state:["state"],event:["state"],command:["open","close"]},{dpt:"OPEN",command:["openDoor"]},{dpt:"STATE_UNCERTAIN",state:["uncertain"],event:["uncertain"]},
{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){switch(f){case "STATE":return{state:e?"open":"closed"};case "STATE_UNCERTAIN":return{uncertain:e};case "ERROR":switch(e){case 0:e="no_error";break;case 1:e="cluth_failure";break;case 2:e="motor_aborted"}return{error:e}}return null},executeCommand:function(f,e,h,q,n){var k=m.call(this,q);switch(q){case "open":f.writeValue(e,h,k,!0,n);break;case "close":f.writeValue(e,h,k,!1,n);break;case "openDoor":f.writeValue(e,
h,k,!0,n);break;default:n&&n(Error("no such command"))}}},MOTION_DETECTOR:{device:"motion",map:[{dpt:"BRIGHTNESS",state:["bri"],event:["bri"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k={};switch(f){case "BRIGHTNESS":k.bri=e;break;case "MOTION":k.state=e?"motion":"ok";break;case "ERROR":k.error=e?"sabotage":"no_error";break;default:return null}return k}},DUAL_WHITE_BRIGHTNESS:{device:"dualwhite",
map:[{dpt:"DIRECTION",state:["direction"],event:["direction"]},{dpt:"ERROR_OVERHEAT",state:["error_overheat"],event:["error_overheat"]},{dpt:"ERROR_REDUCED",state:["error_reduced"],event:["error_reduced"]},{dpt:"LEVEL",state:["bri"],event:["bri"],command:["off","dimUp","dimDown","toggle","dimTo%d"]},{dpt:"LEVEL_REAL",state:["bri_real"],event:["bri_real"]},{dpt:"OLD_LEVEL",command:["on"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(f,e){var k={};switch(f){case "DIRECTION":k.direction=
e;break;case "ERROR_OVERHEAT":k.error_overheat=e?!0:!1;break;case "ERROR_REDUCED":k.error_reduced=e?!0:!1;break;case "LEVEL":k.bri=Math.round(100*parseFloat(e));break;case "LEVEL_REAL":k.bri_real=Math.round(100*parseFloat(e));break;default:return null}return k},executeCommand:function(f,e,h,q,n){var k=m.call(this,q);switch(q){case "on":f.writeValue(e,h,k,!0,n);break;case "off":f.writeValue(e,h,k,{type:"double",value:0},n);break;case "dimUp":f.getState({interface:e,channel:h,datapoint:k},function(l,
m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);f.writeValue(e,h,k,{type:"double",value:p},function(l){l?n&&n(l):(f.updateStatusBuffer(e,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current jalousie state result invalid"))});break;case "dimDown":f.getState({interface:e,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);f.writeValue(e,h,k,{type:"double",value:p},function(l){l?n&&n(l):(f.updateStatusBuffer(e,h,k,p,(new Date).getTime()+
1E3),n&&n())})}else n&&n(Error("get current blind state result invalid"))});break;case "toggle":k="LEVEL";f.getState({interface:e,channel:h,datapoint:k},function(l,m){l?n&&n(l):m?0!=m.value?f.writeValue(e,h,k,{type:"double",value:0},n):f.writeValue(e,h,"OLD_LEVEL",!0,n):n&&n(Error("get current dimmer state result invalid"))});break;default:if("dimTo"==q.substr(0,5)){q=q.substr(5);var l=parseInt(q);l/=100;k="LEVEL";f.writeValue(e,h,k,{type:"double",value:l},function(m){m?n&&n(m):(f.updateStatusBuffer(e,
h,k,l,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("no such command"))}}},DUAL_WHITE_COLOR:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["color_direction"],event:["color_direction"]},{dpt:"LEVEL",state:["color"],event:["color"],command:["colorOff","colorUp","colorDown","colorToggle","colorTo%d"]},{dpt:"LEVEL_REAL",state:["color_real"],event:["color_real"]},{dpt:"OLD_LEVEL",command:["colorOn"]}],getReadableDpts:e,getDptFromState:h,parseDptState:function(e,k){var f={};switch(e){case "DIRECTION":f.direction=
k;break;case "LEVEL":f.color=Math.round(100*parseFloat(k));break;case "LEVEL_REAL":f.color_real=Math.round(100*parseFloat(k));break;default:return null}return f},executeCommand:function(e,k,h,q,n){var f=m.call(this,q);switch(q){case "colorOn":e.writeValue(k,h,f,!0,n);break;case "colorOff":e.writeValue(k,h,f,{type:"double",value:0},n);break;case "colorUp":e.getState({interface:k,channel:h,datapoint:f},function(l,m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);e.writeValue(k,h,f,{type:"double",
value:p},function(l){l?n&&n(l):(e.updateStatusBuffer(k,h,f,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current jalousie state result invalid"))});break;case "colorDown":e.getState({interface:k,channel:h,datapoint:f},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);e.writeValue(k,h,f,{type:"double",value:p},function(l){l?n&&n(l):(e.updateStatusBuffer(k,h,f,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current blind state result invalid"))});break;case "colorToggle":f=
"LEVEL";e.getState({interface:k,channel:h,datapoint:f},function(l,m){l?n&&n(l):m?0!=m.value?e.writeValue(k,h,f,{type:"double",value:0},n):e.writeValue(k,h,"OLD_LEVEL",!0,n):n&&n(Error("get current dimmer state result invalid"))});break;default:if("colorTo"==q.substr(0,7)){q=q.substr(7);var l=parseInt(q);l/=100;f="LEVEL";e.writeValue(k,h,f,{type:"double",value:l},function(m){m?n&&n(m):(e.updateStatusBuffer(k,h,f,l,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("no such command"))}}}}}}();
x.hub.m.hm._Device=function(){var e=function(g,a,b){this.deviceType=g;this.deviceIF=a;this.deviceAdr=b;this.legacyType=null};e.prototype.initStates=function(g,a){var b=this._getReadableDpts();this._initDptStates(g,b,a)};e.prototype._getReadableDpts=function(){return[]};e.prototype._getDptFromRef=function(g){return null};e.prototype._initDptStates=function(g,a,b){if(a&&0!=a.length){var c=0,e=this,f=function(A,k){c++;c==a.length?b&&b():g.readValue(e.deviceIF,a[c].channel,a[c].dpt,f)};g.readValue(this.deviceIF,
a[c].channel,a[c].dpt,f)}else b&&b()};e.prototype.parseDptState=function(g,a,b){return null};e.prototype.toLegacyAdr=function(){return this.deviceType+"."+this.deviceIF+"."+this.deviceAdr};e.prototype.toLegacyType=function(){return this.legacyType};e.prototype.getSerial=function(){var g=this.deviceAdr,a=this.deviceAdr.indexOf(":");-1!=a&&(g=g.substr(0,a));return g};e.prototype.parseChnState=function(g,a){var b={},c;for(c in a){var e=this.parseDptState(g,c,a[c].value);if(e){var f={},k=a[c].time,h;
for(h in e)f[h]={value:e[h],time:k};b=x.hub.m.hm._Util.mergeObj(b,f)}}return b};e.prototype.parseStates=function(g){var a={},b;for(b in g){var c=this.parseChnState(b,g[b]);c&&(a=x.hub.m.hm._Util.mergeObj(a,c))}return a};e.prototype.executeCommand=function(g,a,b){b&&b()};e.prototype.getState=function(g,a,b){switch(a){case "timeout":var c={channel:this.deviceAdr+":0",dataPoint:"UNREACH"};break;default:c=this._getDptFromRef(a)}if(c){var e=this;g.getState({interface:this.deviceIF,channel:c.channel,datapoint:c.dataPoint},
function(g,f){g?b&&b(g):f?(g=e.parseDptState(c.channel,c.dataPoint,f.value))?b&&b(null,{value:g[a],time:f.time}):b&&b(null,null):b&&b(null,null)})}else b&&b(Error("no such state"))};e.prototype.isButton=function(){return!1};var h=function(g,a,b){e.call(this,g,a,b);this.channel=0;this.legacyType="maintenance"};util.inherits(h,e);h.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"].MAINTENANCE.getReadableDpts();b&&b.forEach(function(b){g.push({channel:a.deviceAdr+
":0",dpt:b})});return g};h.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};h.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var e=g.substr(0,c);g=g.substr(c+1);var f=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(f=this.deviceAdr.substr(0,c));if(e!=f||g!=this.channel)return null;
c={};"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b;return c};var m=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="button"};util.inherits(m,e);m.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};m.prototype._getDptFromRef=function(g){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(g){case "lowbat":a.channel=
0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};m.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var e=g.substr(0,c);g=g.substr(c+1);var f=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(f=this.deviceAdr.substr(0,c));if(e!=f||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "PRESS_SHORT":return{pressShort:b};
case "PRESS_LONG":return{pressLong:b};case "PRESS_CONT":return{pressCont:b};case "PRESS_LONG_RELEASE":return{pressLongRel:b};default:return null}};m.prototype.isButton=function(){return!0};m.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;g.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(e,f){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);g.reportValueUsage(c.deviceIF,b,"PRESS_LONG",function(b,c){b&&
console.error("button claim PRESS_LONG event error:"+b.stack);a&&a()})})};var f=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="button"};util.inherits(f,e);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};f.prototype._getDptFromRef=function(g){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint=
"LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};f.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var e=g.substr(0,c);g=g.substr(c+1);var f=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(f=this.deviceAdr.substr(0,c));if(e!=f||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "PRESS_SHORT":return{pressShort:b};case "PRESS_LONG":return{pressLong:b};
case "PRESS_CONT":return{pressCont:b};case "PRESS_LONG_RELEASE":return{pressLongRel:b};default:return null}};f.prototype.isButton=function(){return!1};f.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;g.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(e,f){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);g.reportValueUsage(c.deviceIF,b,"PRESS_LONG",function(b,c){b&&console.error("button claim PRESS_LONG event error:"+
b.stack);a&&a()})})};var k=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="switch"};util.inherits(k,e);k.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"}]};k.prototype._getDptFromRef=function(g){var a=this.deviceAdr;-1==a.indexOf(":")&&
this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};k.prototype.executeCommand=function(g,a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;switch(a){case "on":var f="STATE";
g.writeValue(this.deviceIF,c,f,!0,b);break;case "off":f="STATE";g.writeValue(this.deviceIF,c,f,!1,b);break;case "toggle":f="STATE";g.getState({interface:this.deviceIF,channel:c,datapoint:f},function(a,k){a?b&&b(a):k?(a=!0,k.value&&(a=!1),g.writeValue(e.deviceIF,c,f,a,b)):b&&b(Error("get switch current value return invalid"))});break;default:"onFor"==a.substr(0,5)?(a=parseFloat(a.substr(5)),isNaN(a)?b&&b(Error("onFor command invalid")):(f="ON_TIME",g.writeValue(this.deviceIF,c,f,{type:"double",value:a},
function(a){a?b&&b(a):(f="STATE",g.writeValue(e.deviceIF,c,f,!0,b))}))):b&&b(Error("no such command"))}};k.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var e=g.substr(0,c);g=g.substr(c+1);var f=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(f=this.deviceAdr.substr(0,c));if(e!=f||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;var k;switch(a){case "STATE":return 1==b?k="on":
0==b&&(k="off"),{state:k};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};default:return null}};k.prototype.getConfig=function(g,a){var b=this.deviceAdr+":"+this.channel;g.getParamset(this.deviceIF,b,"MASTER",function(c,g){if(c)a&&a(c);else{var e={},f=null;g&&(f={AES_ACTIVE:g.AES_ACTIVE});e[b]=f;a&&a(c,e)}})};k.prototype.setConfig=function(g,a,b){if(a){var c=this.deviceAdr+":"+this.channel;if(a=a[c]){var e={};e.AES_ACTIVE=a.AES_ACTIVE;g.setParamset(this.deviceIF,c,"MASTER",e,function(c){b&&
b(c)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var l=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="dimmer"};util.inherits(l,e);l.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"}]};l.prototype._getDptFromRef=function(g){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(g){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "levelReal":a.dataPoint="LEVEL_REAL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};l.prototype.executeCommand=function(g,a,b){var c=this.deviceAdr+":"+this.channel,e=this,f=null;switch(a){case "on":var k="OLD_LEVEL";g.writeValue(this.deviceIF,c,k,!0,b);break;case "off":k="LEVEL";g.writeValue(this.deviceIF,
c,k,{type:"double",value:0},b);break;case "dimUp":k="LEVEL";g.getState({interface:this.deviceIF,channel:c,datapoint:k},function(a,f){a?b&&b(a):f?(a=f.value+.05,1<a&&(a=1),g.writeValue(e.deviceIF,c,k,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;case "dimDown":k="LEVEL";g.getState({interface:this.deviceIF,channel:c,datapoint:k},function(a,f){a?b&&b(a):f?(a=f.value-.05,0>a&&(a=0),g.writeValue(e.deviceIF,c,k,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});
break;case "toggle":k="LEVEL";g.getState({interface:this.deviceIF,channel:c,datapoint:k},function(a,f){a?b&&b(a):f?0!=f.value?g.writeValue(e.deviceIF,c,k,{type:"double",value:0},b):g.writeValue(e.deviceIF,c,"OLD_LEVEL",!0,b):b&&b(Error("get current dimmer state result invalid"))});break;default:"toggleTo"==a.substr(0,8)?(f=parseInt(a.substr(8)),isNaN(f)?b&&b(Error("toggleTo command invalid")):(k="LEVEL",f/=100,g.getState({interface:this.deviceIF,channel:c,datapoint:k},function(a,h){a?b&&b(a):h?(a=
f,h.value&&(a=0),g.writeValue(e.deviceIF,c,k,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))}))):"onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)?("onTo"==a.substr(0,4)&&(a=a.substr(4)),f=parseInt(a),f/=100,k="LEVEL",g.writeValue(this.deviceIF,c,k,{type:"double",value:f},b)):b&&b(Error("no such command"))}};l.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var e=g.substr(0,c);g=g.substr(c+1);var f=this.deviceAdr;c=this.deviceAdr.indexOf(":");
-1!=c&&(f=this.deviceAdr.substr(0,c));if(e!=f||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(b)),{state:a};case "LEVEL_REAL":return a=Math.round(100*parseFloat(b)),{levelReal:a};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};case "DIRECTION":return{direction:b};default:return null}};var q=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="blind"};
util.inherits(q,e);q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"DIRECTION"}]};q.prototype._getDptFromRef=function(g){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(g){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};q.prototype.executeCommand=function(g,a,b){var c=this.deviceAdr+":"+this.channel,e=this,f=0;"stepUpFor"==a.substr(0,9)?((f=a.substr(9))||(f=1),f=parseFloat(f),a="stepUpFor"):"stepUp"==a.substr(0,6)?((f=a.substr(6))||(f=5),f=parseInt(f)/100,a="stepUp"):"stepDownFor"==a.substr(0,
11)?((f=a.substr(11))||(f=1),f=parseFloat(f),a="stepDownFor"):"stepDown"==a.substr(0,8)&&((f=a.substr(8))||(f=5),f=parseInt(f)/100,a="stepDown");switch(a){case "stepUp":var k="LEVEL";g.getState({interface:this.deviceIF,channel:c,datapoint:k},function(a,h){if(a)b&&b(a);else if(h){f||(f=.05);var A=h.value+f;1<A&&(A=1);g.writeValue(e.deviceIF,c,k,{type:"double",value:A},function(a){a?b&&b(a):(g.updateStatusBuffer(e.deviceIF,c,k,A,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("get current blind state result invalid"))});
break;case "stepDown":k="LEVEL";g.getState({interface:this.deviceIF,channel:c,datapoint:k},function(a,h){if(a)b&&b(a);else if(h){f||(f=.05);var A=h.value-f;0>A&&(A=0);g.writeValue(e.deviceIF,c,k,{type:"double",value:A},function(a){a?b&&b(a):(g.updateStatusBuffer(e.deviceIF,c,k,A,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("get current blind state result invalid"))});break;case "stepUpFor":k="LEVEL";g.writeValue(this.deviceIF,c,k,{type:"double",value:1},function(a){a?b&&b(a):setTimeout(function(){k=
"STOP";g.writeValue(e.deviceIF,c,k,!0,b)},1E3*f)});break;case "stepDownFor":k="LEVEL";g.writeValue(this.deviceIF,c,k,{type:"double",value:0},function(a){a?b&&b(a):setTimeout(function(){k="STOP";g.writeValue(e.deviceIF,c,k,!0,b)},1E3*f)});break;case "up":k="LEVEL";g.writeValue(this.deviceIF,c,k,{type:"double",value:1},b);break;case "down":k="LEVEL";g.writeValue(this.deviceIF,c,k,{type:"double",value:0},b);break;case "stop":k="STOP";g.writeValue(this.deviceIF,c,k,!0,b);break;default:if("moveTo"==a.substr(0,
6)||a.match(/^[-+]?[0-9]+$/)){"moveTo"==a.substr(0,6)&&(a=a.substr(6));var h=parseInt(a);h/=100;k="LEVEL";g.writeValue(this.deviceIF,c,k,{type:"double",value:h},function(a){a?b&&b(a):(g.updateStatusBuffer(e.deviceIF,c,k,h,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("no such command"))}};q.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(f!=e||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(b)),{state:a};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};case "DIRECTION":return{direction:b};default:return null}};q.prototype.getConfig=function(g,a){var b=this.deviceAdr+":"+this.channel;g.getParamset(this.deviceIF,b,"MASTER",function(c,g){if(c)a&&a(c);else{var f={},e=null;g&&(e={CHANGE_OVER_DELAY:g.CHANGE_OVER_DELAY,
REFERENCE_RUNNING_TIME_BOTTOM_TOP:g.REFERENCE_RUNNING_TIME_BOTTOM_TOP,REFERENCE_RUNNING_TIME_TOP_BOTTOM:g.REFERENCE_RUNNING_TIME_TOP_BOTTOM,REFERENCE_RUN_COUNTER:g.REFERENCE_RUN_COUNTER});f[b]=e;a&&a(c,f)}})};q.prototype.setConfig=function(g,a,b){if(a){var c=this.deviceAdr+":"+this.channel;if(a=a[c]){var f={};f.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};f.REFERENCE_RUNNING_TIME_BOTTOM_TOP={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP};f.REFERENCE_RUNNING_TIME_TOP_BOTTOM=
{__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM};f.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;g.setParamset(this.deviceIF,c,"MASTER",f,function(c){b&&b(c)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var n=function(g,a,b){k.call(this,g,a,b);this.legacyType="powerswitch";this.powChannel=2};util.inherits(n,k);n.prototype._getReadableDpts=function(){var g=k.prototype._getReadableDpts.call(this);g.push({channel:this.deviceAdr+":"+this.powChannel,
dpt:"BOOT"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"ENERGY_COUNTER"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"POWER"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"CURRENT"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"VOLTAGE"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"FREQUENCY"});return g};n.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr,dataPoint:null};switch(g){case "timeout":a.channel=0;a.dataPoint="UNREACH";
break;case "state":a.channel+=":1";a.dataPoint="STATE";break;case "inhibit":a.channel+=":1";a.dataPoint="INHIBIT";break;case "working":a.channel+=":1";a.dataPoint="WORKING";break;case "boot":a.channel+=":2";a.dataPoint="BOOT";break;case "energy_counter":a.channel+=":2";a.dataPoint="ENERGY_COUNTER";break;case "power":a.channel+=":2";a.dataPoint="POWER";break;case "current":a.channel+=":2";a.dataPoint="CURRENT";break;case "voltage":a.channel+=":2";a.dataPoint="VOLTAGE";break;case "frequency":a.channel+=
":2";a.dataPoint="FREQUENCY";break;default:return null}return a};n.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);c=g.substr(c+1);return f!=this.deviceAdr?null:0==c?(g={},"UNREACH"==a?g.timeout=b:g["0_"+a.toLowerCase()]=b,g):"1"==c?k.prototype.parseDptState.call(this,g,a,b):"2"==c?(g={},g[a.toLowerCase()]=b,g):null};n.prototype.getConfig=function(g,a){var b=this,c=null;k.prototype.getConfig.call(this,g,function(f,e){f?a&&a(f):(c=e,b._getCh2Config(g,
function(b,g){if(b)a&&a(b);else{for(var f in g)g.hasOwnProperty(f)&&(c[f]=g[f]);a&&a(null,c)}}))})};n.prototype.setConfig=function(g,a,b){if(a){var c=Object.keys(a);if(c&&0!=c.length){var f=this;async.eachSeries(c,function(b,c){var e=b.indexOf(":");-1==e&&c(Error("channel address is null"));e=b.substr(e+1);1==e?k.prototype.setConfig.call(f,g,a,c):2==e?f._setCh2Config(g,a[b],c):c(Error("unknow channel:"+e))},function(c){b&&b(c)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};
n.prototype._getCh2Config=function(g,a){var b=this.deviceAdr+":2";g.getParamset(this.deviceIF,b,"MASTER",function(c,g){if(c)a&&a(c);else{var f={},e=null;g&&(e={AES_ACTIVE:g.AES_ACTIVE});f[b]=e;a&&a(c,f)}})};n.prototype._setCh2Config=function(g,a,b){if(a){var c=this.deviceAdr+":2",f={};f.AES_ACTIVE=a.AES_ACTIVE;g.setParamset(this.deviceIF,c,"MASTER",f,function(c){b&&b(c)})}else b&&b(Error("config data invalid"))};var r=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="weather"};util.inherits(r,
e);r.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"}]};r.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";
break;case "hum":a.dataPoint="HUMIDITY";break;default:return null}return a};r.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "TEMPERATURE":return a=parseFloat(b),{temp:a};case "HUMIDITY":return a=
parseInt(b),{hum:a};default:return null}};var p=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="weather2"};util.inherits(p,r);p.prototype._getReadableDpts=function(){var g=r.prototype._getReadableDpts.call(this);g.push({channel:this.deviceAdr+":"+this.channel,dpt:"AIR_PRESSURE"});return g};p.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "air":a.dataPoint="AIR_PRESSURE";break;default:return r.prototype._getDptFromRef.call(this,
g)}return a};p.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c),e=g.substr(c+1),k=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(k=this.deviceAdr.substr(0,c));if(f!=k||0!=e&&e!=this.channel)return null;if(0==e)return g={},"UNREACH"==a?g.timeout=b:"LOWBAT"==a?g.lowbat=b:g["0_"+a.toLowerCase()]=b,g;g=r.prototype.parseDptState.call(this,g,a,b);switch(a){case "AIR_PRESSURE":g||(g={}),g.air=parseInt(b)}return g};var t=function(g,a,b){e.call(this,
g,a,b);this.channel=1;this.legacyType="weatherstation"};util.inherits(t,e);t.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAINING"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAIN_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_SPEED"},
{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION_RANGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"SUNSHINEDURATION"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"}]};t.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint=
"TEMPERATURE";break;case "hum":a.dataPoint="HUMIDITY";break;case "rain":a.dataPoint="RAINING";break;case "rainC":a.dataPoint="RAIN_COUNTER";break;case "windS":a.dataPoint="WIND_SPEED";break;case "windD":a.dataPoint="WIND_DIRECTION";break;case "windDR":a.dataPoint="WIND_DIRECTION_RANGE";break;case "sunD":a.dataPoint="SUNSHINEDURATION";break;case "bri":a.dataPoint="BRIGHTNESS";break;default:return null}return a};t.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=
g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "TEMPERATURE":c.temp=parseFloat(b);break;case "HUMIDITY":c.hum=parseInt(b);break;case "RAINING":c.rain=b;break;case "RAIN_COUNTER":c.rainC=parseFloat(b);break;case "WIND_SPEED":c.windS=parseFloat(b);break;case "WIND_DIRECTION":c.windD=
b;break;case "WIND_DIRECTION_RANGE":c.windDR=b;break;case "SUNSHINEDURATION":c.sunD=b;break;case "BRIGHTNESS":c.bri=b;break;default:return null}return c};var w=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="heater"};util.inherits(w,e);w.prototype._getReadableDpts=function(){var g=[];g.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"VALVE_STATE"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"});return g};w.prototype._getDptFromRef=
function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "error":a.dataPoint="ERROR";break;case "state":a.dataPoint="VALVE_STATE";break;default:return null}return a};w.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c={};if(0==g)return"UNREACH"==
a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(g==this.channel){switch(a){case "ERROR":switch(b){case 0:c.error="no_error";break;case 1:c.error="VALVE_DRIVE_BLOCKED";break;case 2:c.error="VALVE_DRIVE_LOOSE";break;case 3:c.error="ADJUSTING_RANGE_TO_SMALL";break;case 4:c.error="lowbat"}break;case "VALVE_STATE":c.state=b}return c}return null};var v=function(g,a,b){e.call(this,g,a,b);this.channel=4;this.legacyType="thermostat"};util.inherits(v,e);v.prototype._getReadableDpts=function(){var g=[];g.push({channel:this.deviceAdr+
":"+this.channel,dpt:"CONTROL_MODE"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"FAULT_REPORTING"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"BATTERY_STATE"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"BOOST_STATE"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"ACTUAL_TEMPERATURE"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"SET_TEMPERATURE"});return g};v.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(g){case "mode":a.dataPoint="CONTROL_MODE";break;case "error":a.dataPoint="FAULT_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "valveLvl":a.dataPoint="VALVE_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";break;case "act_temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};v.prototype.executeCommand=function(g,a,b){var c=this.deviceAdr+":"+this.channel,f=this;switch(a){case "setAuto":var e=
"AUTO_MODE";g.writeValue(this.deviceIF,c,e,!0,function(a){a||g.updateStatusBuffer(f.deviceIF,c,"CONTROL_MODE",0);b&&b(a)});break;case "setManu":e="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,k){a?b&&b(a):(e="MANU_MODE",g.writeValue(f.deviceIF,c,e,{type:"double",value:k.value},function(a){a||g.updateStatusBuffer(f.deviceIF,c,"CONTROL_MODE",1);b&&b(a)}))});break;case "setBoost":e="BOOST_MODE";g.writeValue(this.deviceIF,c,e,!0,function(a){a||g.updateStatusBuffer(f.deviceIF,
c,"CONTROL_MODE",3);b&&b(a)});break;case "tempUp":e="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,k){a?b&&b(a):k?(a=k.value+.5,30.5<a&&(a=30.5),g.writeValue(f.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":e="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,k){a?b&&b(a):k?(a=k.value-.5,4.5>a&&(a=4.5),g.writeValue(f.deviceIF,c,e,{type:"double",value:a},
b)):b&&b(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),e="SET_TEMPERATURE",g.writeValue(this.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("no such command"))}};v.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(f!=e)return null;c={};if(0==g)return c["0_"+a.toLowerCase()]=b,c;if(g==this.channel){switch(a){case "CONTROL_MODE":switch(b){case 0:c.mode="auto";break;case 1:c.mode="manu";break;case 2:c.mode="party";break;case 3:c.mode="boost"}break;case "FAULT_REPORTING":switch(b){case 0:c.error="no_error";break;case 1:c.error="valve_tight";break;case 2:c.error="ADJUSTING_RANGE_TOO_LARGE";break;case 3:c.error="ADJUSTING_RANGE_TOO_SMALL";break;case 4:c.error="comm_error";break;case 5:c.error="";break;case 6:c.error=
"lowbat";break;case 7:c.error="VALVE_ERROR_POSITION"}break;case "BATTERY_STATE":c.batLvl=b;break;case "VALVE_STATE":c.valveLvl=b;break;case "BOOST_STATE":c.boostTime=b;break;case "ACTUAL_TEMPERATURE":c.act_temp=b;break;case "SET_TEMPERATURE":c.state=b;break;default:return null}return c}return null};var na=function(g,a,b){e.call(this,g,a,b);this.channel=4;this.legacyType="thermostat"};util.inherits(na,v);na.prototype._getReadableDpts=function(){var g=v.prototype._getReadableDpts.callback(this);g.push({channel:this.deviceAdr+
":"+this.channel,dpt:"WINDOW_STATE"});return g};na.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "window":a.dataPoint="WINDOW_STATE";break;default:return v.prototype._getDptFromRef.call(this,g)}return a};na.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c),e=g.substr(c+1),k=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(k=this.deviceAdr.substr(0,c));if(f!=k)return null;c=
{};if(0==e)return c["0_"+a.toLowerCase()]=b,c;if(e==this.channel)switch(a){case "WINDOW_STATE":return c.window=b?"closed":"open",c;default:return v.prototype.parseDptState.call(this,g,a,b)}else return null};var R=function(g,a,b){e.call(this,g,a,b);this.weatherChannel=1;this.thermoChannel=2;this.legacyType="wallthermo"};util.inherits(R,e);R.prototype._getReadableDpts=function(){var g=[];g.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});g.push({channel:this.deviceAdr+":0",dpt:"LOWBAT"});g.push({channel:this.deviceAdr+
":"+this.weatherChannel,dpt:"TEMPERATURE"});g.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"HUMIDITY"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SETPOINT"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_COMMAND"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_DATA"});return g};R.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(g){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";
break;case "lowbat":b.channel=a+":0";b.dataPoint="LOWBAT";break;case "temp":b.channel=a+":1";b.dataPoint="TEMPERATURE";break;case "hum":b.channel=a+":1";b.dataPoint="HUMIDITY";break;case "state":b.channel=a+":2";b.dataPoint="SETPOINT";break;case "adjusting_command":b.channel=a+":2";b.dataPoint="ADJUSTING_COMMAND";break;case "adjusting_data":b.channel=a+":2";b.dataPoint="ADJUSTING_DATA";break;default:return null}return b};R.prototype.executeCommand=function(g,a,b){var c=this.deviceAdr+":"+this.thermoChannel;
switch(a){case "tempUp":var f="SETPOINT";g.getState({interface:this.deviceIF,channel:c,datapoint:f},function(a,e){a?b&&b(a):e?(a=e.value+.5,30<a&&(a=30),g.writeValue(self.deviceIF,c,f,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":f="SETPOINT";g.getState({interface:this.deviceIF,channel:c,datapoint:f},function(a,e){a?b&&b(a):e?(a=e.value-.5,6>a&&(a=6),g.writeValue(self.deviceIF,c,f,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});
break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),f="SETPOINT",g.writeValue(this.deviceIF,c,f,{type:"double",value:a},b)):b&&b(Error("no such command"))}};R.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);if(f!=this.deviceAdr)return null;f={};if(0==g)return"UNREACH"==a?f.timeout=b:"LOWBAT"==a?f.lowbat=b:f["0_"+a.toLowerCase()]=b,f;if("1"==g){switch(a){case "TEMPERATURE":f.temp=
b;break;case "HUMIDITY":f.hum=b}return f}if("2"==g){switch(a){case "SETPOINT":f.state=b;break;case "ADJUSTING_COMMAND":f.adjusting_command=b;break;case "ADJUSTING_DATA":f.adjusting_data=b}return f}return null};var S=function(g,a,b){e.call(this,g,a,b);this.thermoChannel=2;this.legacyType="wallthermostat"};util.inherits(S,e);S.prototype._getReadableDpts=function(){var g=[];g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"CONTROL_MODE"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,
dpt:"LOWBAT_REPORTING"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"COMMUNICATION_REPORTING"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"WINDOW_OPEN_REPORTING"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BATTERY_STATE"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BOOST_STATE"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_TEMPERATURE"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_HUMIDITY"});
g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SET_TEMPERATURE"});return g};S.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.thermoChannel,dataPoint:null};switch(g){case "mode":a.dataPoint="CONTROL_MODE";break;case "lowbat":a.dataPoint="LOWBAT_REPORTING";break;case "comm":a.dataPoint="COMMUNICATION_REPORTING";break;case "window":a.dataPoint="WINDOW_OPEN_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";
break;case "temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "hum":a.dataPoint="ACTUAL_HUMIDITY";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};S.prototype.executeCommand=function(g,a,b){var c=this.deviceAdr+":"+this.thermoChannel,f=this;switch(a){case "setAuto":var e="AUTO_MODE";g.writeValue(this.deviceIF,c,e,!0,function(a){a||g.updateStatusBuffer(f.deviceIF,c,"CONTROL_MODE",0);b&&b(a)});break;case "setManu":e="SET_TEMPERATURE";g.getState({interface:this.deviceIF,
channel:c,datapoint:e},function(a,k){a?b&&b(a):(e="MANU_MODE",g.writeValue(f.deviceIF,c,e,{type:"double",value:k.value},function(a){a||g.updateStatusBuffer(f.deviceIF,c,"CONTROL_MODE",1);b&&b(a)}))});break;case "setBoost":e="BOOST_MODE";g.writeValue(this.deviceIF,c,e,!0,function(a){a||g.updateStatusBuffer(f.deviceIF,c,"CONTROL_MODE",3);b&&b(a)});break;case "tempUp":e="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,k){a?b&&b(a):k?(a=k.value+.5,30.5<a&&(a=30.5),
g.writeValue(f.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":e="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,k){a?b&&b(a):k?(a=k.value-.5,4.5>a&&(a=4.5),g.writeValue(f.deviceIF,c,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),
e="SET_TEMPERATURE",g.writeValue(this.deviceIF,c,e,{type:"double",value:a},b)):"setWeekProfile"==a.substr(0,14)?(a=parseInt(a.substr(14)),g.setParamset(this.deviceIF,this.deviceAdr,"MASTER",{WEEK_PROGRAM_POINTER:a-1},function(a){b&&b(a)})):b&&b(Error("no such command"))}};S.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);if(f!=this.deviceAdr)return null;f={};if(0==g)return f["0_"+a.toLowerCase()]=b,f;if("2"==g){switch(a){case "CONTROL_MODE":switch(b){case 0:f.mode=
"auto";break;case 1:f.mode="manu";break;case 2:f.mode="party";break;case 3:f.mode="boost"}break;case "LOWBAT_REPORTING":f.lowbat=b;break;case "COMMUNICATION_REPORTING":f.comm=b;break;case "WINDOW_OPEN_REPORTING":f.window=b;break;case "BATTERY_STATE":f.batLvl=b;break;case "BOOST_STATE":f.boostTime=b;break;case "ACTUAL_TEMPERATURE":f.temp=b;break;case "ACTUAL_HUMIDITY":f.hum=b;break;case "SET_TEMPERATURE":f.state=b}return f}return null};var oa=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType=
"contact"};util.inherits(oa,e);oa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};oa.prototype._getDptFromRef=function(g){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(g){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint=
"STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};oa.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":return{state:b?"open":"closed"};
case "ERROR":return{error:1==b?"sabotage":"no_error"};case "LOWBAT":return{lowbat:b};default:return null}};var T=function(g,a,b){e.call(this,g,a,b);this.rainChannel=1;this.heatChannel=2;this.legacyType="rain"};util.inherits(T,e);T.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.rainChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+
":"+this.heatChannel,dpt:"WORKING"}]};T.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "rain":b.channel=a+":"+this.rainChannel;b.dataPoint="STATE";break;case "heat":b.channel=a+":"+this.heatChannel;b.dataPoint="STATE";break;case "inhibit":b.channel=a+":"+this.heatChannel;b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.heatChannel;b.dataPoint="WORKING";break;default:return null}return b};
T.prototype.executeCommand=function(g,a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.heatChannel&&(c+=":"+this.heatChannel);var f=this;switch(a){case "heaterOn":var e="STATE";g.writeValue(this.deviceIF,c,e,!0,b);break;case "heaterOff":e="STATE";g.writeValue(this.deviceIF,c,e,!1,b);break;case "heaterToggle":e="STATE";g.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,k){a?b&&b(a):k?(a=!0,k.value&&(a=!1),g.writeValue(f.deviceIF,c,e,a,b)):b&&b(Error("get switch current value return invalid"))});
break;default:b&&b(Error("no such command"))}};T.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(1==g){switch(a){case "STATE":c.rain=1==b?"rain":"dry";break;default:return null}return c}if(2==g){switch(a){case "STATE":c.heat=b?"on":"off";break;case "INHIBIT":c.inhibit=
b;break;case "WORKING":c.working=b;break;default:return null}return c}};var E=function(g,a,b){e.call(this,g,a,b);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong2"};util.inherits(E,e);E.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.chimeChannel,
dpt:"STATE"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"WORKING"}]};E.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "led":b.channel=a+":"+this.ledChannel;b.dataPoint="STATE";break;case "led_inhibit":b.channel=a+":"+this.ledChannel;b.dataPoint="INHIBIT";break;case "led_working":b.channel=a+":"+this.ledChannel;b.dataPoint=
"WORKING";break;case "chime":b.channel=a+":"+this.chimeChannel;b.dataPoint="STATE";break;case "chime_inhibit":b.channel=a+":"+this.chimeChannel;b.dataPoint="INHIBIT";break;case "chime_working":b.channel=a+":"+this.chimeChannel;b.dataPoint="WORKING";break;default:return null}return b};E.prototype.executeCommand=function(g,a,b){switch(a){case "ledOn":a=this.deviceAdr+":"+this.ledChannel;g.writeValue(this.deviceIF,a,"STATE",!0,b);break;case "ledOff":a=this.deviceAdr+":"+this.ledChannel;g.writeValue(this.deviceIF,
a,"STATE",!1,b);break;case "chimeOn":a=this.deviceAdr+":"+this.chimeChannel;g.writeValue(this.deviceIF,a,"STATE",!0,b);break;case "chimeOff":a=this.deviceAdr+":"+this.chimeChannel;g.writeValue(this.deviceIF,a,"STATE",!1,b);break;default:b&&b(Error("no such command"))}};E.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=
{};if(0==g)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(1==g){switch(a){case "STATE":c.led=b?"on":"off";break;case "INHIBIT":c.led_inhibit=b;break;case "WORKING":c.led_working=b;break;default:return null}return c}if(2==g){switch(a){case "STATE":c.chime=b?"on":"off";break;case "INHIBIT":c.chime_inhibit=b;break;case "WORKING":c.chime_working=b;break;default:return null}return c}};var Ma=function(g,a,b){e.call(this,g,a,b);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong"};
util.inherits(Ma,E);Ma.prototype.executeCommand=function(g,a,b){if(0==a.indexOf("vChannel")){var c=a.substr(8);c=parseInt(c);a=this.deviceAdr+":"+this.chimeChannel;g.writeValue(this.deviceIF,a,"SUBMIT","0.8,1,5,"+c,b)}else if(0==a.indexOf("setChime")){var f=a.substr(8);parseInt(c);a=this.deviceAdr+":"+this.chimeChannel;g.writeValue(this.deviceIF,a,"SUBMIT",f,b)}else 0==a.indexOf("ledGreen")?((c=a.substr(8))||(c=10),a=this.deviceAdr+":"+this.ledChannel,g.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+
c+",34",b)):0==a.indexOf("ledRed")?((c=a.substr(6))||(c=10),a=this.deviceAdr+":"+this.ledChannel,g.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+c+",18",b)):E.prototype.executeCommand.call(this,g,a,b)};var pa=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="window"};util.inherits(pa,e);pa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"},
{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};pa.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};pa.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=
this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":switch(b){case 0:c.state="closed";break;case 1:c.state="tilted";break;case 2:c.state="open"}break;case "ERROR":switch(b){case 0:c.error="no_error";break;case 1:case 7:c.error="sabotage"}break;case "LOWBAT":c.lowbat=b;break;default:return null}return c};var qa=function(g,a,b){e.call(this,g,a,b);this.channel=
1;this.legacyType="temp"};util.inherits(qa,e);qa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"}]};qa.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";
break;default:return null}return a};qa.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "TEMPERATURE":return{temp:parseFloat(b)};default:return null}};var ra=function(g,a,b){e.call(this,g,a,
b);this.temp1=1;this.temp2=2;this.tempDiff12=3;this.tempDiff21=4;this.legacyType="temp2"};util.inherits(ra,e);ra.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.temp1,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.temp1,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.temp2,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff12,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff21,dpt:"TEMPERATURE"}]};ra.prototype._getDptFromRef=
function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "lowbat":a.channel=this.temp1;a.dataPoint="LOWBAT";break;case "temp1":a.channel=this.temp1;a.dataPoint="TEMPERATURE";break;case "temp2":a.channel=this.temp2;a.dataPoint="TEMPERATURE";break;case "tempDiff12":a.channel=this.tempDiff12;a.dataPoint="TEMPERATURE";break;case "tempDiff21":a.channel=this.tempDiff21;a.dataPoint="TEMPERATURE";break;default:return null}return a};
ra.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LOWBAT":return{lowbat:b};case "TEMPERATURE":return 1==g?{temp1:parseFloat(b)}:2==g?{temp2:parseFloat(b)}:3==g?{tempDiff12:parseFloat(b)}:4==g?{tempDiff21:parseFloat(b)}:null;default:return null}};
var sa=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="co2"};util.inherits(sa,e);sa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};sa.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};sa.prototype.parseDptState=
function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":switch(b){case 0:c.state="normal";break;case 1:c.state="medium";break;case 2:c.state="high"}break;default:return null}return c};var ta=function(g,a,b){e.call(this,g,a,b);this.channel=
1;this.legacyType="motion"};util.inherits(ta,e);ta.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"},{channel:this.deviceAdr+":"+this.channel,dpt:"MOTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};ta.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint=
"LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "bri":a.dataPoint="BRIGHTNESS";break;case "state":a.dataPoint="MOTION";break;case "error":a.dataPoint="ERROR";break;default:return null}return a};ta.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==
a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "BRIGHTNESS":c.bri=b;break;case "MOTION":c.state=b?"motion":"ok";break;case "ERROR":c.error=b?"sabotage":"no_error";break;default:return null}return c};var ua=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="smoke"};util.inherits(ua,e);ua.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,
dpt:"STATE"}]};ua.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};ua.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":c.state=b?"smoke":"ok";break;default:return null}return c};var U=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="siren"};util.inherits(U,e);U.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,
dpt:"ERROR_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_BATTERY"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};U.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint=
"STATE";break;case "error_power":a.dataPoint="ERROR_POWER";break;case "error_sabotage":a.dataPoint="ERROR_SABOTAGE";break;case "error_battery":a.dataPoint="ERROR_BATTERY";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};U.prototype.executeCommand=function(g,a,b){var c=this.deviceAdr+":"+this.channel,f=this;switch(a){case "on":var e="STATE";g.writeValue(this.deviceIF,c,e,!0,b);break;case "off":e="STATE";g.writeValue(this.deviceIF,
c,e,!1,b);break;case "toggle":e="STATE";g.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,k){a?b&&b(a):(a=!0,k.value&&(a=!1),g.writeValue(f.deviceIF,c,e,a,b))});break;default:b&&b(Error("no such command"))}};U.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==
a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":c.state=b?"on":"off";break;case "ERROR_POWER":c.error_power=b?"power_failure":"no_error";break;case "ERROR_SABOTAGE":c.error_sabotage=b?"sabotage":"no_error";break;case "ERROR_BATTERY":c.error_battery=b?"battery_defect":"no_error";break;case "INHIBIT":c.inhibit=b;break;case "WORKING":c.working=b;break;default:return null}return c};var va=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="capacity"};util.inherits(va,e);
va.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"FILLING_LEVEL"}]};va.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="FILLING_LEVEL";break;default:return null}return a};va.prototype.parseDptState=
function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "FILLING_LEVEL":c.state=b;break;default:return null}return c};var M=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="switch_interface"};util.inherits(M,
e);M.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};M.prototype._getDptFromRef=function(g){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};M.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==
c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "PRESS":return{press:b};default:return null}};M.prototype.isButton=function(){return!0};M.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);g.reportValueUsage(this.deviceIF,
b,"PRESS",function(b,g){b&&console.error("switch interface claim PRESS event error:"+b.stack);a&&a()})};var wa=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="tilt"};util.inherits(wa,e);wa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};wa.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(g){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};wa.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":c.state=
b?"open":"closed";break;case "LOWBAT":c.lowbat=b;break;default:return null}return c};var xa=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="water"};util.inherits(xa,e);xa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};xa.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};xa.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "STATE":switch(b){case 0:c.state=
"ok";break;case 1:c.state="moist";break;case 2:c.state="water"}break;case "LOWBAT":c.lowbat=b;break;default:return null}return c};var ya=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="energymeter"};util.inherits(ya,e);ya.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BOOT"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_ENERGY_COUNTER"},{channel:this.deviceAdr+
":"+this.channel,dpt:"GAS_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"POWER"}]};ya.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "boot":a.dataPoint="BOOT";break;case "gas_energy":a.dataPoint="GAS_ENERGY_COUNTER";break;case "gas_power":a.dataPoint="GAS_POWER";
break;case "energy":a.dataPoint="ENERGY_COUNTER";break;case "power":a.dataPoint="POWER";break;default:return null}return a};ya.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "BOOT":c.boot=
b;break;case "GAS_ENERGY_COUNTER":c.gas_energy=b;break;case "GAS_POWER":c.gas_power=b;break;case "ENERGY_COUNTER":c.energy=b;break;case "POWER":c.power=b;break;default:return null}return c};var N=function(g,a,b){e.call(this,g,a,b);this.dimChannel=1;this.rgbChannel=2;this.autoChannel=3;this.legacyType="rgb"};util.inherits(N,e);N.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.dimChannel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+
this.rgbChannel,dpt:"COLOR"},{channel:this.deviceAdr+":"+this.autoChannel,dpt:"PROGRAM"}]};N.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.channel=a+":"+this.dimChannel;b.dataPoint="LEVEL";break;case "color":b.channel=a+":"+this.rgbChannel;b.dataPoint="COLOR";break;case "program":b.channel=a+":"+this.autoChannel;b.dataPoint="PROGRAM";break;case "inhibit":b.channel=a+":"+this.dimChannel;
b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.dimChannel;b.dataPoint="WORKING";break;case "direction":b.channel=a+":"+this.dimChannel;b.dataPoint="DIRECTION";break;default:return null}return b};N.prototype.executeCommand=function(g,a,b){var c=this;switch(a){case "on":var f=this.deviceAdr+":"+this.dimChannel;var e="OLD_LEVEL";g.writeValue(this.deviceIF,f,e,!0,b);break;case "off":f=this.deviceAdr+":"+this.dimChannel;e="LEVEL";g.writeValue(this.deviceIF,f,e,{type:"double",value:0},
b);break;case "white":f=this.deviceAdr+":"+this.rgbChannel;e="COLOR";g.writeValue(this.deviceIF,f,e,200,b);break;case "dimUp":f=this.deviceAdr+":"+this.dimChannel;e="LEVEL";g.getState({interface:this.deviceIF,channel:f,datapoint:e},function(a,k){a?b&&b(a):k?(a=k.value+.05,1<a&&(a=1),g.writeValue(c.deviceIF,f,e,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;case "dimDown":f=this.deviceAdr+":"+this.dimChannel;e="LEVEL";g.getState({interface:this.deviceIF,
channel:f,datapoint:e},function(a,k){a?b&&b(a):k?(a=k.value-.05,0>a&&(a=0),g.writeValue(c.deviceIF,f,e,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;default:if("onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)){"onTo"==a.substr(0,4)&&(a=a.substr(4));var k=parseInt(a);f=this.deviceAdr+":"+this.dimChannel;e="LEVEL";g.writeValue(this.deviceIF,f,e,{type:"double",value:k/100},b)}else if("setProg"==a.substr(0,7))a=a.substr(7),k=parseInt(a),f=this.deviceAdr+":"+
this.autoChannel,e="PROGRAM",g.writeValue(this.deviceIF,f,e,k,b);else if("setRampTime"==a.substr(0,11))a=a.substr(11),k=parseFloat(a),f=this.deviceAdr+":"+this.dimChannel,e="RAMP_TIME",g.writeValue(this.deviceIF,f,e,{type:"double",value:k},b);else if(a.toLowerCase().match(/^([0-9a-f]{6})$/i)){k=parseInt(a.substr(0,2),16);var h=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);var l=0;k=this._RGBToHSV(k,h,a);l=.1>k[1]?200:Math.round(k[0]/1.8);f=this.deviceAdr+":"+this.rgbChannel;e="COLOR";g.writeValue(this.deviceIF,
f,e,l,b)}else b&&b(Error("no such command"))}};N.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.dimChannel&&g!=this.rgbChannel&&g!=this.autoChannel)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LEVEL":c.state=100*parseFloat(b);break;case "COLOR":c.color=b;break;case "PROGRAM":c.program=
b;break;case "INHIBIT":c.inhibit=b;break;case "WORKING":c.working=b;break;case "DIRECTION":c.direction=b;break;default:return null}return c};N.prototype._RGBToHSV=function(g,a,b){g/=255;a/=255;b/=255;var c=Math.min(g,Math.min(a,b)),f=Math.max(g,Math.max(a,b));return c==f?[0,0,c]:[60*((g==c?3:b==c?1:5)-(g==c?a-b:b==c?g-a:b-g)/(f-c)),(f-c)/f,f]};var za=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="lux"};util.inherits(za,e);za.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LUX"}]};za.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LUX";break;default:return null}return a};za.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,
c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LUX":c.state=b;break;default:return null}return c};var V=function(g,a,b){e.call(this,g,a,b);this.swChannel1=1;this.swChannel2=2;this.panicChannel=3;this.armingChannel=4;this.legacyType="siren2"};util.inherits(V,e);V.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.swChannel1,dpt:"STATE"},{channel:this.deviceAdr+":"+this.swChannel2,dpt:"STATE"},{channel:this.deviceAdr+":"+this.panicChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ARMSTATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+
":"+this.armingChannel,dpt:"LOWBAT"}]};V.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "switchSensorInState":b.channel=a+":"+this.swChannel1;b.dataPoint="STATE";break;case "switchSensorExState":b.channel=a+":"+this.swChannel2;b.dataPoint="STATE";break;case "switchPanicState":b.channel=a+":"+this.panicChannel;b.dataPoint="STATE";break;case "arming":b.channel=a+":"+this.armingChannel;b.dataPoint=
"ARMSTATE";break;case "inhibit":b.channel=a+":"+this.armingChannel;b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.armingChannel;b.dataPoint="WORKING";break;case "sabotage":b.channel=a+":"+this.armingChannel;b.dataPoint="ERROR_SABOTAGE";break;case "lowbat":b.channel=a+":"+this.armingChannel;b.dataPoint="LOWBAT";break;default:return null}return b};V.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;
c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c={};if(0==g)return"UNREACH"==a?c.timeout=b:c["0_"+a.toLowerCase()]=b,c;if(1==g){switch(a){case "STATE":c.switchSensorInState=b?"on":"off";break;default:return null}return c}if(2==g){switch(a){case "STATE":c.switchSensorExState=b?"on":"off";break;default:return null}return c}if(3==g){switch(a){case "STATE":c.switchPanicState=b?"on":"off";break;default:return null}return c}if(4==g){switch(a){case "ARMSTATE":switch(b){case 0:c.arming=
"disarmed";break;case 1:c.arming="ex_armed";break;case 2:c.arming="all_armed";break;case 3:c.arming="blocked"}break;case "INHIBIT":c.inhibit=b;break;case "WORKING":c.working=b;break;case "ERROR_SABOTAGE":switch(b){case 0:c.sabotage="no_error";break;case 1:c.sabotage="ex_armed"}break;case "LOWBAT":c.lowbat=b;break;default:return null}return c}};V.prototype.executeCommand=function(g,a,b){var c=this;switch(a){case "switchSensorInOn":var f="STATE";var e=this.deviceAdr+":"+this.swChannel1;g.writeValue(this.deviceIF,
e,f,!0,b);break;case "switchSensorInOff":f="STATE";e=this.deviceAdr+":"+this.swChannel1;g.writeValue(this.deviceIF,e,f,!1,b);break;case "switchSensorInToggle":f="STATE";e=this.deviceAdr+":"+this.swChannel1;g.getState({interface:this.deviceIF,channel:e,datapoint:f},function(a,k){a?b&&b(a):(a=!0,k.value&&(a=!1),g.writeValue(c.deviceIF,e,f,a,b))});break;case "switchSensorExOn":f="STATE";e=this.deviceAdr+":"+this.swChannel2;g.writeValue(this.deviceIF,e,f,!0,b);break;case "switchSensorExOff":f="STATE";
e=this.deviceAdr+":"+this.swChannel2;g.writeValue(this.deviceIF,e,f,!1,b);break;case "switchSensorExToggle":f="STATE";e=this.deviceAdr+":"+this.swChannel2;g.getState({interface:this.deviceIF,channel:e,datapoint:f},function(a,k){a?b&&b(a):(a=!0,k.value&&(a=!1),g.writeValue(c.deviceIF,e,f,a,b))});break;case "switchPanicOn":f="STATE";e=this.deviceAdr+":"+this.panicChannel;g.writeValue(this.deviceIF,e,f,!0,b);break;case "switchPanicOff":f="STATE";e=this.deviceAdr+":"+this.panicChannel;g.writeValue(this.deviceIF,
e,f,!1,b);break;case "switchPanicToggle":f="STATE";e=this.deviceAdr+":"+this.panicChannel;g.getState({interface:this.deviceIF,channel:e,datapoint:f},function(a,k){a?b&&b(a):(a=!0,k.value&&(a=!1),g.writeValue(c.deviceIF,e,f,a,b))});break;case "armingDisarm":f="ARMSTATE";e=this.deviceAdr+":"+this.armingChannel;g.writeValue(this.deviceIF,e,f,0,b);break;case "armingIntern":f="ARMSTATE";e=this.deviceAdr+":"+this.armingChannel;g.writeValue(this.deviceIF,e,f,1,b);break;case "armingAll":f="ARMSTATE";e=this.deviceAdr+
":"+this.armingChannel;g.writeValue(this.deviceIF,e,f,2,b);break;default:b&&b(Error("no such command"))}};var W=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="jalousie"};util.inherits(W,e);W.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"];g.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});(b=b.JALOUSIE.getReadableDpts())&&b.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b})});return g};W.prototype._getDptFromRef=function(g){var a=
this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["BidCos-RF"];switch(g){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";break;default:if(b.channel=a+":"+this.channel,b.dataPoint=c.JALOUSIE.getDptFromState(g),!b.dataPoint)return null}return b};W.prototype.executeCommand=function(g,a,b){x.hub.m.hm._Channel["BidCos-RF"].JALOUSIE.executeCommand(g,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};W.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==
c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["BidCos-RF"];if(0==g){if("UNREACH"==a)return{timeout:b};c={};c["0_"+a.toLowerCase()]=b;return c}return g==this.channel?c.JALOUSIE.parseDptState(a,b):null};var F=function(g,a,b){e.call(this,g,a,b);this.keyChannel1=1;this.keyChannel2=2;this.em8bitChannel=3;this.legacyType="mod_em_8bit"};util.inherits(F,e);F.prototype._getReadableDpts=
function(){var g=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"];g.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var c=b.KEY.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b});g.push({channel:a.deviceAdr+":2",dpt:b})});(c=b.MOD_EM8BIT_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b})});return g};F.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null};switch(g){case "timeout":b.channel=
a+":0";b.dataPoint="UNREACH";break;case "lowbat":b.channel=a+":3";b.dataPoint="LOWBAT";break;case "state8bit":b.channel=a+":3";b.dataPoint="STATE";break;default:return null}return b};F.prototype.executeCommand=function(g,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "ch1pressShort":a=this.deviceAdr+":"+this.keyChannel1;c.KEY.executeCommand(g,this.deviceIF,a,"pressShort",b);break;case "ch1pressLong":a=this.deviceAdr+":"+this.keyChannel1;c.KEY.executeCommand(g,this.deviceIF,a,"pressLong",
b);break;case "ch2pressShort":a=this.deviceAdr+":"+this.keyChannel2;c.KEY.executeCommand(g,this.deviceIF,a,"pressShort",b);break;case "ch2pressLong":a=this.deviceAdr+":"+this.keyChannel2;c.KEY.executeCommand(g,this.deviceIF,a,"pressLong",b);break;default:b&&b(Error("no such command"))}};F.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=
e)return null;f=x.hub.m.hm._Channel["BidCos-RF"];c=null;if(0==g){if("UNREACH"==a)return{timeout:b};c={};c["0_"+a.toLowerCase()]=b;return c}if(g==this.keyChannel1){if(a=f.KEY.parseDptState(a,b))c={},a.pressShort&&(c.ch1pressShort=!0),a.pressLong&&(c.ch1pressLong=!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(c.ch1pressCont=!0),a.pressLongRel&&(c.ch1pressLongRel=!0);return c}if(g==this.keyChannel2){if(a=f.KEY.parseDptState(a,b))c={},a.pressShort&&(c.ch2pressShort=!0),a.pressLong&&(c.ch2pressLong=
!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(c.ch2pressCont=!0),a.pressLongRel&&(c.ch2pressLongRel=!0);return c}return g==this.em8bitChannel?f.MOD_EM8BIT_TRANSMITTER.parseDptState(a,b):null};F.prototype.isButton=function(){return!0};F.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;g.reportValueUsage(this.deviceIF,b+":1","PRESS_SHORT",function(f,e){f&&console.error("button claim PRESS_SHORT event error:"+f.stack);
g.reportValueUsage(c.deviceIF,b+":1","PRESS_LONG",function(f,e){f&&console.error("button claim PRESS_LONG event error:"+f.stack);g.reportValueUsage(c.deviceIF,b+":2","PRESS_SHORT",function(f,e){f&&console.error("button claim PRESS_SHORT event error:"+f.stack);g.reportValueUsage(c.deviceIF,b+":2","PRESS_LONG",function(b,c){a&&a()})})})})};var G=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="mod_em_8"};util.inherits(G,e);G.prototype._getReadableDpts=function(){var g=[],a=this,b=
x.hub.m.hm._Channel["BidCos-RF"],c=b.KEY.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});(c=b.SWITCH_INTERFACE.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});(c=b.SHUTTER_CONTACT.getReadableDpts())&&c.forEach(function(b){"ERROR"!=b&&g.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return g};G.prototype._getDptFromRef=function(g){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "state":a.dataPoint=
"STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};G.prototype.executeCommand=function(g,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"],f=this.deviceAdr+":"+this.channel;switch(a){case "pressShort":c.KEY.executeCommand(g,this.deviceIF,f,"pressShort",b);break;case "pressLong":c.KEY.executeCommand(g,this.deviceIF,f,"pressLong",b);break;case "press":c.SWITCH_INTERFACE.executeCommand(g,this.deviceIF,f,"press",b);break;default:b&&b(Error("no such command"))}};G.prototype.parseDptState=
function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["BidCos-RF"];f=null;if(g==this.channel){f={};if(g=c.KEY.parseDptState(a,b))g.pressShort&&(f.pressShort=!0),g.pressLong&&(f.pressLong=!0),"undefined"!=typeof g.pressCont&&null!=g.pressCont&&(f.pressCont=!0),g.pressLongRel&&(f.pressCont=!0);(g=c.SWITCH_INTERFACE.parseDptState(a,
b))&&g.press&&(f.press=!0);if(g=c.SHUTTER_CONTACT.parseDptState(a,b))g.state&&(f.state=g.state),"undefined"!=typeof g.lowbat&&null!=g.lowbat&&(f.lowbat=g.lowbat)}return f};G.prototype.isButton=function(){return!0};G.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;g.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(f,e){f&&console.error("button claim PRESS_SHORT event error:"+f.stack);g.reportValueUsage(c.deviceIF,b,"PRESS_LONG",
function(f,e){f&&console.error("button claim PRESS_LONG event error:"+f.stack);g.reportValueUsage(c.deviceIF,b,"PRESS",function(b,c){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);a&&a()})})})};var X=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="keymatic"};util.inherits(X,e);X.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});
(c=b.KEYMATIC.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});return g};X.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null};switch(g){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";break;case "lowbat":b.channel=a+":0";b.dataPoint="LOWBAT";break;case "state":b.channel=a+":1";b.dataPoint="STATE";break;case "uncertain":b.channel=a+":1";b.dataPoint="STATE_UNCERTAIN";break;case "error":b.channel=a+":1";b.dataPoint=
"ERROR";break;default:return null}return b};X.prototype.executeCommand=function(g,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "open":a=this.deviceAdr+":"+this.channel;c.KEYMATIC.executeCommand(g,this.deviceIF,a,"open",b);break;case "close":a=this.deviceAdr+":"+this.channel;c.KEYMATIC.executeCommand(g,this.deviceIF,a,"close",b);break;case "openDoor":a=this.deviceAdr+":"+this.channel;c.KEYMATIC.executeCommand(g,this.deviceIF,a,"openDoor",b);break;default:b&&b(Error("no such command"))}};
X.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["BidCos-RF"];if(0==g){if("UNREACH"==a||"LOWBAT"==a)return c.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return g==this.channel?a=c.KEYMATIC.parseDptState(a,b):null};var H=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType=
"ou_led16"};util.inherits(H,e);H.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this.channel,dpt:"LED_STATUS"}]};H.prototype._getDptFromRef=function(g){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(g){case "led":a.dataPoint="LED_STATUS";break;default:return null}return a};H.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;
c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e||0!=g&&g!=this.channel)return null;if(0==g)return c={},"UNREACH"==a?c.timeout=b:"LOWBAT"==a?c.lowbat=b:c["0_"+a.toLowerCase()]=b,c;switch(a){case "LED_STATUS":switch(b){case 0:return{led:"off"};case 1:return{led:"red"};case 2:return{led:"green"};case 3:return{led:"orange"};default:return null}default:return null}};H.prototype.executeCommand=function(g,a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);
switch(a){case "pressShort":g.writeValue(this.deviceIF,c,"PRESS_SHORT",!0,b);break;case "ledOff":g.writeValue(this.deviceIF,c,"LED_STATUS",0,b);break;case "ledRed":g.writeValue(this.deviceIF,c,"LED_STATUS",1,b);break;case "ledGreen":g.writeValue(this.deviceIF,c,"LED_STATUS",2,b);break;case "ledOrange":g.writeValue(this.deviceIF,c,"LED_STATUS",3,b);break;case "ledSleepOff":g.writeValue(this.deviceIF,c,"LED_SLEEP_MODE",0,b);break;case "ledSleepOn":g.writeValue(this.deviceIF,c,"LED_SLEEP_MODE",1,b);
break;default:b&&b(Error("no such command"))}};H.prototype.isButton=function(){return!0};H.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);g.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(b,g){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);a&&a()})};var Na=function(g,a,b){e.call(this,g,a,b);this.channel=3;this.legacyType="hm_dis_ep_wm55"};util.inherits(Na,e);Na.prototype.executeCommand=function(g,a,b){if("submit"==
a.substr(0,6)){var c=a.substr(6);a=this.deviceAdr+":"+this.channel;g.writeValue(this.deviceIF,a,"SUBMIT",c,b)}else b&&b(Error("no such command"))};var Y=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="dualwhite"};util.inherits(Y,e);Y.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.DUAL_WHITE_BRIGHTNESS.getReadableDpts())&&
c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});(c=b.DUAL_WHITE_COLOR.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":2",dpt:b})});return g};Y.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["BidCos-RF"];switch(g){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "bri":case "bri_real":case "error_overheat":case "error_reduced":case "direction":b.channel=
a+":1";b.dataPoint=c.DUAL_WHITE_BRIGHTNESS.getDptFromState(g);break;case "color":case "color_real":case "color_direction":b.channel=a+":2";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState(g);break;default:return null}return b};Y.prototype.executeCommand=function(g,a,b){var c=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "off":case "on":case "toggle":case "dimUp":case "dimDown":c.DUAL_WHITE_BRIGHTNESS.executeCommand(g,this.deviceIF,this.deviceAdr+":1",a,b);break;case "colorOff":case "colorOn":case "colorToggle":case "colorUp":case "colorDown":c.DUAL_WHITE_COLOR.executeCommand(g,
this.deviceIF,this.deviceAdr+":2",a,b);break;default:"dimTo"==a.substr(0,5)?c.DUAL_WHITE_BRIGHTNESS.executeCommand(g,this.deviceIF,this.deviceAdr+":1",a,b):"colorTo"==a.substr(0,7)?c.DUAL_WHITE_COLOR.executeCommand(g,this.deviceIF,this.deviceAdr+":2",a,b):b&&b(Error("no such command"))}};Y.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=
e)return null;c=x.hub.m.hm._Channel["BidCos-RF"];if(0==g){if("UNREACH"==a)return c.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==g?c.DUAL_WHITE_BRIGHTNESS.parseDptState(a,b):2==g?c.DUAL_WHITE_COLOR.parseDptState(a,b):null};var Pa=function(g,a,b){k.call(this,g,a,b);this.channel=3;this.legacyType="ip_switch"};util.inherits(Pa,k);var Aa=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_contact"};util.inherits(Aa,e);Aa.prototype._getReadableDpts=
function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SHUTTER_CONTACT_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});return g};Aa.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "sabotage":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":b.channel=a+":1";b.dataPoint=c.SHUTTER_CONTACT_TRANSCEIVER.getDptFromState(g);break;default:return null}return b};Aa.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==
a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==g?c.SHUTTER_CONTACT_TRANSCEIVER.parseDptState(a,b):null};var Z=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_heater"};util.inherits(Z,e);Z.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&
c.forEach(function(b){"HUMIDITY"!=b&&g.push({channel:a.deviceAdr+":1",dpt:b})});return g};Z.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "profile":case "temp":case "boost":case "frost":case "mode":case "state":case "window":b.channel=a+":1";b.dataPoint=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(g);
break;default:return null}return b};Z.prototype.executeCommand=function(g,a,b){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};Z.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==g){if("UNREACH"==
a||"LOW_BAT"==a)return c.MAINTENANCE.parseDptState(a,b);f={};f["0_"+a.toLowerCase()]=b;return f}return 1==g?c.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b):f};var aa=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_powerswitch"};util.inherits(aa,e);aa.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&
c.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":6",dpt:b})});return g};aa.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "switchState":b.channel=a+":3";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":6";b.dataPoint=c.ENERGIE_METER_TRANSMITTER.getDptFromState(g);break;default:return null}return b};aa.prototype.executeCommand=function(g,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var f=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,f,"on",b);break;case "off":f=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,
f,"off",b);break;case "toggle":f=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,f,"toggle",b);break;default:"onFor"==a.substr(0,5)?(f=this.deviceAdr+":3",c.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,f,a,b)):b&&b(Error("no such command"))}};aa.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;
c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a)return c.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 3==g?c.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b):6==g?c.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var ba=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_energyactor"};util.inherits(ba,e);ba.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==
b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SWITCH_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":4",dpt:b});g.push({channel:a.deviceAdr+":5",dpt:b});g.push({channel:a.deviceAdr+":6",dpt:b})});(c=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":7",dpt:b})});return g};ba.prototype._getDptFromRef=
function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "switchState":b.channel=a+":3";b.dataPoint=c.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch4State":b.channel=a+":4";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch5State":b.channel=a+":5";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch6State":b.channel=a+":6";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":7";b.dataPoint=c.ENERGIE_METER_TRANSMITTER.getDptFromState(g);break;default:return null}return b};ba.prototype.executeCommand=function(g,a,b){var c=null,f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch4on":case "ch5on":case "ch6on":switch(a){case "on":case "ch4on":c=
this.deviceAdr+":4";break;case "ch5on":c=this.deviceAdr+":5";break;case "ch6on":c=this.deviceAdr+":6"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"on",b);break;case "off":case "ch4off":case "ch5off":case "ch6off":switch(a){case "off":case "ch4off":c=this.deviceAdr+":4";break;case "ch5off":c=this.deviceAdr+":5";break;case "ch6off":c=this.deviceAdr+":6"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"off",b);break;case "toggle":case "ch4toggle":case "ch5toggle":case "ch6toggle":switch(a){case "toggle":case "ch4toggle":c=
this.deviceAdr+":4";break;case "ch5toggle":c=this.deviceAdr+":5";break;case "ch6toggle":c=this.deviceAdr+":6"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"toggle",b);break;default:b&&b(Error("no such command"))}};ba.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==
g){if("UNREACH"==a)return f.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==g){if(a=f.SWITCH_TRANSMITTER.parseDptState(a,b))c={},c.switchState=a.switchTState;return c}if(4==g||5==g||6==g){if(a=f.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(g)){case 4:c.ch4State=a.switchState;break;case 5:c.ch5State=a.switchState;break;case 6:c.ch6State=a.switchState}return c}return 7==g?f.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var ca=function(g,a,b){e.call(this,
g,a,b);this.channel=1;this.legacyType="ip_energyactor2"};util.inherits(ca,e);ca.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SWITCH_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":2",dpt:b});
g.push({channel:a.deviceAdr+":3",dpt:b});g.push({channel:a.deviceAdr+":4",dpt:b})});(c=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":5",dpt:b})});return g};ca.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "switchState":b.channel=a+":1";b.dataPoint=c.SWITCH_TRANSMITTER.getDptFromState("switchTState");
break;case "ch2State":b.channel=a+":2";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":b.channel=a+":3";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":b.channel=a+":4";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":5";b.dataPoint=c.ENERGIE_METER_TRANSMITTER.getDptFromState(g);
break;default:return null}return b};ca.prototype.executeCommand=function(g,a,b){var c=null,f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch2on":case "ch3on":case "ch4on":switch(a){case "on":case "ch2on":c=this.deviceAdr+":2";break;case "ch3on":c=this.deviceAdr+":3";break;case "ch4on":c=this.deviceAdr+":4"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"on",b);break;case "off":case "ch2off":case "ch3off":case "ch4off":switch(a){case "off":case "ch2off":c=this.deviceAdr+":2";
break;case "ch3off":c=this.deviceAdr+":3";break;case "ch4off":c=this.deviceAdr+":4"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"off",b);break;case "toggle":case "ch2toggle":case "ch3toggle":case "ch4toggle":switch(a){case "toggle":case "ch2toggle":c=this.deviceAdr+":2";break;case "ch3toggle":c=this.deviceAdr+":3";break;case "ch4toggle":c=this.deviceAdr+":4"}f.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"toggle",b);break;default:b&&b(Error("no such command"))}};ca.prototype.parseDptState=
function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a)return f.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==g){if(a=f.SWITCH_TRANSMITTER.parseDptState(a,b))c={},c.switchState=a.switchTState;return c}if(2==g||3==g||4==g){if(a=f.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,
b))switch(c={},parseInt(g)){case 2:c.ch2State=a.switchState;break;case 3:c.ch3State=a.switchState;break;case 4:c.ch4State=a.switchState}return c}return 5==g?f.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var da=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_dimmer"};util.inherits(da,e);da.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&g.push({channel:a.deviceAdr+
":0",dpt:b})});(c=b.DIMMER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":4",dpt:b});g.push({channel:a.deviceAdr+":5",dpt:b});g.push({channel:a.deviceAdr+":6",dpt:b})});return g};da.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "dimmerLevel":b.channel=a+":3";b.dataPoint=c.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch5Level":b.channel=a+":5";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":b.channel=a+":6";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return b};
da.prototype.executeCommand=function(g,a,b){var c=null,f=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("dimUp")){var k=a.indexOf("dimUp");e=a.substr(0,k+5);var h=a.substr(k+5)}else-1!=a.indexOf("dimDown")?(k=a.indexOf("dimDown"),e=a.substr(0,k+7),h=a.substr(k+7)):-1!=a.indexOf("dimTo")?(k=a.indexOf("dimTo"),e=a.substr(0,k+5),h=a.substr(k+5)):-1!=a.indexOf("toggleTo")&&(k=a.indexOf("toggleTo"),e=a.substr(0,k+8),h=a.substr(k+8));var l=this;switch(e){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,this.deviceAdr+":4","dimOff",function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","dimOff",function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","dimOff",b)})});break;case "dimUp":h=h?parseInt(h)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(h=c.value+
h,1<h&&(h=1),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","dimTo"+h,b)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==
typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(h=c.value-h,0>h&&(h=0),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","dimTo"+h,b)})}))});break;case "dimTo":if(!h){b&&b(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,this.deviceAdr+":4","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","dimTo"+h,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!h){b&&b(Error("toggle has no value"));break}g.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(c.value&&(h=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","dimTo"+h,b)})}))});break;case "ch4dimOff":case "ch5dimOff":case "ch6dimOff":switch(e){case "ch4dimOff":c=
this.deviceAdr+":4";break;case "ch5dimOff":c=this.deviceAdr+":5";break;case "ch6dimOff":c=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimOff",b);break;case "ch4dimUp":case "ch5dimUp":case "ch6dimUp":switch(e){case "ch4dimUp":c=this.deviceAdr+":4";break;case "ch5dimUp":c=this.deviceAdr+":5";break;case "ch6dimUp":c=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimUp"+h,b);break;case "ch4dimDown":case "ch5dimDown":case "ch6dimDown":switch(e){case "ch4dimDown":c=
this.deviceAdr+":4";break;case "ch5dimDown":c=this.deviceAdr+":5";break;case "ch6dimDown":c=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimDown"+h,b);break;case "ch4dimTo":case "ch5dimTo":case "ch6dimTo":switch(e){case "ch4dimTo":c=this.deviceAdr+":4";break;case "ch5dimTo":c=this.deviceAdr+":5";break;case "ch6dimTo":c=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimTo"+h,b);break;case "ch4toggleTo":case "ch5toggleTo":case "ch6toggleTo":switch(e){case "ch4toggleTo":c=
this.deviceAdr+":4";break;case "ch5toggleTo":c=this.deviceAdr+":5";break;case "ch6toggleTo":c=this.deviceAdr+":6"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"toggleTo"+h,b);break;default:b&&b(Error("no such command"))}};da.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=
null;if(0==g){if("UNREACH"==a)return f.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==g){if(a=f.DIMMER_TRANSMITTER.parseDptState(a,b))c={},c.dimmerLevel=a.dimmerTLevel;return c}if(4==g||5==g||6==g){if(a=f.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(g)){case 4:c.ch4Level=a.dimmerLevel;break;case 5:c.ch5Level=a.dimmerLevel;break;case 6:c.ch6Level=a.dimmerLevel}return c}return null};var ea=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType=
"ip_dimmer2"};util.inherits(ea,e);ea.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.DIMMER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":2",dpt:b})});(c=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b});g.push({channel:a.deviceAdr+":4",dpt:b});
g.push({channel:a.deviceAdr+":5",dpt:b})});return g};ea.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "dimmerLevel":b.channel=a+":2";b.dataPoint=c.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":b.channel=a+":3";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;
case "ch5Level":b.channel=a+":4";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":b.channel=a+":5";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return b};ea.prototype.executeCommand=function(g,a,b){var c=null,f=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("dimUp")){var k=a.indexOf("dimUp");e=a.substr(0,k+5);var h=a.substr(k+5)}else-1!=a.indexOf("dimDown")?(k=a.indexOf("dimDown"),e=a.substr(0,k+7),h=
a.substr(k+7)):-1!=a.indexOf("dimTo")?(k=a.indexOf("dimTo"),e=a.substr(0,k+5),h=a.substr(k+5)):-1!=a.indexOf("toggleTo")&&(k=a.indexOf("toggleTo"),e=a.substr(0,k+8),h=a.substr(k+8));var l=this;switch(e){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":3","dimOff",function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimOff",function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+
":5","dimOff",b)})});break;case "dimUp":h=h?parseInt(h)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(h=c.value+h,1<h&&(h=1),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,c){a?
b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","dimTo"+h,b)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(h=c.value-h,0>h&&(h=0),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","dimTo"+h,b)})}))});break;case "dimTo":if(!h){b&&b(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":3","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+
":5","dimTo"+h,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":2","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!h){b&&b(Error("toggle has no value"));break}g.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(c.value&&(h=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,
l.deviceAdr+":3","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","dimTo"+h,b)})}))});break;case "ch3dimOff":case "ch4dimOff":case "ch5dimOff":switch(e){case "ch3dimOff":c=this.deviceAdr+":3";break;case "ch4dimOff":c=this.deviceAdr+":4";break;case "ch5dimOff":c=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,
c,"dimOff",b);break;case "ch3dimUp":case "ch4dimUp":case "ch5dimUp":switch(e){case "ch3dimUp":c=this.deviceAdr+":3";break;case "ch4dimUp":c=this.deviceAdr+":4";break;case "ch5dimUp":c=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimUp"+h,b);break;case "ch3dimDown":case "ch4dimDown":case "ch5dimDown":switch(e){case "ch3dimDown":c=this.deviceAdr+":3";break;case "ch4dimDown":c=this.deviceAdr+":4";break;case "ch5dimDown":c=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,c,"dimDown"+h,b);break;case "ch3dimTo":case "ch4dimTo":case "ch5dimTo":switch(e){case "ch3dimTo":c=this.deviceAdr+":3";break;case "ch4dimTo":c=this.deviceAdr+":4";break;case "ch5dimTo":c=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimTo"+h,b);break;case "ch3toggleTo":case "ch4toggleTo":case "ch5toggleTo":switch(e){case "ch3toggleTo":c=this.deviceAdr+":3";break;case "ch4toggleTo":c=this.deviceAdr+":4";break;case "ch5toggleTo":c=this.deviceAdr+":5"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,c,"toggleTo"+h,b);break;default:b&&b(Error("no such command"))}};ea.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a)return f.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(2==g){if(a=f.DIMMER_TRANSMITTER.parseDptState(a,
b))c={},c.dimmerLevel=a.dimmerTLevel;return c}if(3==g||4==g||5==g){if(a=f.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(g)){case 3:c.ch3Level=a.dimmerLevel;break;case 4:c.ch4Level=a.dimmerLevel;break;case 5:c.ch5Level=a.dimmerLevel}return c}return null};var fa=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_dimmer3"};util.inherits(fa,e);fa.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();
c&&c.forEach(function(b){"UNREACH"==b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.DIMMER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});(c=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":2",dpt:b});g.push({channel:a.deviceAdr+":3",dpt:b});g.push({channel:a.deviceAdr+":4",dpt:b})});return g};fa.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},
c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "dimmerLevel":b.channel=a+":1";b.dataPoint=c.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch2Level":b.channel=a+":2";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch3Level":b.channel=a+":3";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=c.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;default:return null}return b};fa.prototype.executeCommand=function(g,a,b){var c=null,f=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("dimUp")){var k=a.indexOf("dimUp");e=a.substr(0,k+5);var h=a.substr(k+5)}else-1!=a.indexOf("dimDown")?(k=a.indexOf("dimDown"),e=a.substr(0,k+7),h=a.substr(k+7)):-1!=a.indexOf("dimTo")?(k=a.indexOf("dimTo"),e=a.substr(0,k+5),h=a.substr(k+5)):-1!=a.indexOf("toggleTo")&&(k=a.indexOf("toggleTo"),e=a.substr(0,k+8),h=a.substr(k+8));var l=this;switch(e){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,this.deviceAdr+":2","dimOff",function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":3","dimOff",function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimOff",b)})});break;case "dimUp":h=h?parseInt(h)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(h=c.value+
h,1<h&&(h=1),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":2","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,b)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==
typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(h=c.value-h,0>h&&(h=0),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":2","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,b)})}))});break;case "dimTo":if(!h){b&&b(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,this.deviceAdr+":2","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":1","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!h){b&&b(Error("toggle has no value"));break}g.getState({interface:this.deviceIF,
channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get dimmer current value return invalid")):(c.value&&(h=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":2","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(a,c){a?b&&b(a,c):f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","dimTo"+h,b)})}))});break;case "ch2dimOff":case "ch3dimOff":case "ch4dimOff":switch(e){case "ch2dimOff":c=
this.deviceAdr+":2";break;case "ch3dimOff":c=this.deviceAdr+":3";break;case "ch4dimOff":c=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimOff",b);break;case "ch2dimUp":case "ch3dimUp":case "ch4dimUp":switch(e){case "ch2dimUp":c=this.deviceAdr+":2";break;case "ch3dimUp":c=this.deviceAdr+":3";break;case "ch4dimUp":c=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimUp"+h,b);break;case "ch2dimDown":case "ch3dimDown":case "ch4dimDown":switch(e){case "ch2dimDown":c=
this.deviceAdr+":2";break;case "ch3dimDown":c=this.deviceAdr+":3";break;case "ch4dimDown":c=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimDown"+h,b);break;case "ch2dimTo":case "ch3dimTo":case "ch4dimTo":switch(e){case "ch2dimTo":c=this.deviceAdr+":2";break;case "ch3dimTo":c=this.deviceAdr+":3";break;case "ch4dimTo":c=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"dimTo"+h,b);break;case "ch2toggleTo":case "ch3toggleTo":case "ch4toggleTo":switch(e){case "ch2toggleTo":c=
this.deviceAdr+":2";break;case "ch3toggleTo":c=this.deviceAdr+":3";break;case "ch4toggleTo":c=this.deviceAdr+":4"}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"toggleTo"+h,b);break;default:b&&b(Error("no such command"))}};fa.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=
null;if(0==g){if("UNREACH"==a)return f.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==g){if(a=f.DIMMER_TRANSMITTER.parseDptState(a,b))c={},c.dimmerLevel=a.dimmerTLevel;return c}if(2==g||3==g||4==g){if(a=f.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(g)){case 2:c.ch2Level=a.dimmerLevel;break;case 3:c.ch3Level=a.dimmerLevel;break;case 4:c.ch4Level=a.dimmerLevel}return c}return null};var ha=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType=
"ip_motion"};util.inherits(ha,e);ha.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});return g};ha.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "sabotage":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":case "illumination":case "active":b.channel=a+":1";b.dataPoint=c.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(g);break;default:return null}return b};ha.prototype.executeCommand=function(g,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":c.MOTIONDETECTOR_TRANSCEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":1",a,b);break;default:b&&b(Error("no such command"))}};
ha.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==g?c.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,b):null};var I=function(g,a,b){e.call(this,
g,a,b);this.channel=3;this.legacyType="ip_motion2"};util.inherits(I,e);I.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b})});return g};I.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,
dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":case "illumination":case "active":b.channel=a+":3";b.dataPoint=c.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(g);break;default:return null}return b};I.prototype.executeCommand=function(g,a,b){switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":break;default:b&&b(Error("no such command"))}};I.prototype.parseDptState=
function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);f={};f["0_"+a.toLowerCase()]=b;return f}1==g&&(e=c.KEY_TRANRECEIVER.parseDptState(a,b))&&(e.pressShort&&(f={btn1pressShort:!0}),e.pressLong&&(f={btn1pressLong:!0}));2==g&&(e=
c.KEY_TRANRECEIVER.parseDptState(a,b))&&(e.pressShort&&(f={btn2pressShort:!0}),e.pressLong&&(f={btn2pressLong:!0}));return 3==g?c.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,b):f};I.prototype.isButton=function(){return!0};I.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;g.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,f){b&&console.error("button:1 claim PRESS_SHORT event error:"+b.stack);g.reportValueUsage(c.deviceIF,
c.deviceAdr+":1","PRESS_LONG",function(b,f){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);g.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_SHORT",function(b,f){b&&console.error("button:2 claim PRESS_SHORT event error:"+b.stack);g.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_LONG",function(b,c){b&&console.error("button:2 claim PRESS_LONG event error:"+b.stack);a&&a()})})})})};var O=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_button"};util.inherits(O,
e);O.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});return g};O.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;default:return null}return b};
O.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return f.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}g==this.channel&&(a=f.KEY_TRANRECEIVER.parseDptState(a,b))&&(a.pressShort&&(c={pressShort:!0}),a.pressLong&&
(c={pressLong:!0}));return c};O.prototype.isButton=function(){return!0};O.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;g.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,f){b&&console.error("button:1 claim PRESS_SHORT event error:"+b.stack);g.reportValueUsage(c.deviceIF,c.deviceAdr+":1","PRESS_LONG",function(b,c){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);a&&a()})})};var P=
function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_button2"};util.inherits(P,e);P.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});return g};P.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;default:return null}return b};P.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);f={};f["0_"+a.toLowerCase()]=b;return f}1==g&&(e=c.KEY_TRANRECEIVER.parseDptState(a,
b))&&(e.pressShort&&(f={btn1pressShort:!0}),e.pressLong&&(f={btn1pressLong:!0}));2==g&&(e=c.KEY_TRANRECEIVER.parseDptState(a,b))&&(e.pressShort&&(f={btn2pressShort:!0}),e.pressLong&&(f={btn2pressLong:!0}));return f};P.prototype.isButton=function(){return!0};P.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;g.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,f){b&&console.error("button:1 claim PRESS_SHORT event error:"+
b.stack);g.reportValueUsage(c.deviceIF,c.deviceAdr+":1","PRESS_LONG",function(b,f){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);g.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_SHORT",function(b,f){b&&console.error("button:2 claim PRESS_SHORT event error:"+b.stack);g.reportValueUsage(c.deviceIF,c.deviceAdr+":2","PRESS_LONG",function(b,c){b&&console.error("button:2 claim PRESS_LONG event error:"+b.stack);a&&a()})})})})};var J=function(g,a,b){e.call(this,g,a,b);this.channel=
1;this.legacyType="ip_button4"};util.inherits(J,e);J.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});return g};J.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);
break;default:return null}return b};J.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return f.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==g||2==g||3==g||4==g)if(a=f.KEY_TRANRECEIVER.parseDptState(a,b))c||
(c={}),a.pressShort&&(c["btn"+g+"pressShort"]=!0),a.pressLong&&(c["btn"+g+"pressLong"]=!0);return c};J.prototype.isButton=function(){return!0};J.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,g,function(){c._claimButtonEvent(2,g,function(){c._claimButtonEvent(3,g,function(){c._claimButtonEvent(4,g,function(){a&&a()})})})})};J.prototype._claimButtonEvent=function(g,a,b){var c=this;a.reportValueUsage(this.deviceIF,
this.deviceAdr+":"+g,"PRESS_SHORT",function(f,e){f&&console.error("button:"+g+" claim PRESS_SHORT event error:"+f.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+g,"PRESS_LONG",function(a,c){a&&console.error("button:"+g+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var K=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_button6"};util.inherits(K,e);K.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();
b&&b.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});return g};K.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;default:return null}return b};K.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=
this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return f.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==g||2==g||3==g||4==g||5==g||6==g)if(a=f.KEY_TRANRECEIVER.parseDptState(a,b))c||(c={}),a.pressShort&&(c["btn"+g+"pressShort"]=!0),a.pressLong&&(c["btn"+g+"pressLong"]=!0);return c};K.prototype.isButton=function(){return!0};K.prototype.claimEvent=
function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,g,function(){c._claimButtonEvent(2,g,function(){c._claimButtonEvent(3,g,function(){c._claimButtonEvent(4,g,function(){c._claimButtonEvent(5,g,function(){c._claimButtonEvent(6,g,function(){a&&a()})})})})})})};K.prototype._claimButtonEvent=function(g,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+g,"PRESS_SHORT",function(f,e){f&&console.error("button:"+
g+" claim PRESS_SHORT event error:"+f.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+g,"PRESS_LONG",function(a,c){a&&console.error("button:"+g+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var ia=function(g,a,b){e.call(this,g,a,b);this.channel=3;this.legacyType="ip_siren"};util.inherits(ia,e);ia.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});
(c=b.ALARM_SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b})});return g};ia.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":b.channel=a+":3";b.dataPoint=c.ALARM_SWITCH_VIRTUAL_RECEIVER.getDptFromState(g);break;default:return null}return b};
ia.prototype.executeCommand=function(g,a,b){x.hub.m.hm._Channel["HmIP-RF"].ALARM_SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":3",a,b)};ia.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}return 3==g?c.ALARM_SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b):null};var C=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_wallthermo"};util.inherits(C,e);C.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){"LEVEL"!=
b&&g.push({channel:a.deviceAdr+":1",dpt:b})});return g};C.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":b.channel=a+":1";b.dataPoint=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(g);break;
default:return null}return b};C.prototype.executeCommand=function(g,a,b){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};C.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==g){if("UNREACH"==a||
"LOW_BAT"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);f={};f["0_"+a.toLowerCase()]=b;return f}return 1==g?c.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b):f};var Ba=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_wallthermo2"};util.inherits(Ba,C);Ba.prototype._getReadableDpts=function(){var g=C.prototype._getReadableDpts.call(this);g||(g=[]);var a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+
":8",dpt:b})});(c=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":10",dpt:b})});return g};Ba.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "valveState":b.channel=a+":10";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "cl_fd_emergencyOP":case "cl_fd_frostProtection":case "cl_fd_state":case "cl_fd_humidityAlarm":b.channel=
a+":8";b.dataPoint=c.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getDptFromState(g);break;default:return C.prototype._getDptFromRef.call(this,g)}return b};Ba.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return f.MAINTENANCE_BAT_EL.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==g)return f.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b);if(8==g)return f.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.parseDptState(a,b);10==g&&(c={},a=f.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b),c.valveState=a?a.switchState:"?");return c};var ja=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_smoke"};util.inherits(ja,e);ja.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();
c&&c.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SMOKE_DETECTOR.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});return g};ja.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":b.channel=
a+":1";b.dataPoint=c.SMOKE_DETECTOR.getDptFromState(g);break;default:return null}return b};ja.prototype.executeCommand=function(g,a,b){x.hub.m.hm._Channel["HmIP-RF"].SMOKE_DETECTOR.executeCommand(g,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};ja.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];
f=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE.parseDptState(a,b);f={};f["0_"+a.toLowerCase()]=b;return f}return 1==g?c.SMOKE_DETECTOR.parseDptState(a,b):f};var Ca=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_window"};util.inherits(Ca,e);Ca.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.ROTARY_HANDLE_TRANSCEIVER.getReadableDpts())&&
c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});return g};Ca.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":b.channel=a+":1";b.dataPoint=c.ROTARY_HANDLE_TRANSCEIVER.getDptFromState(g);break;default:return null}return b};Ca.prototype.parseDptState=function(g,
a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);f={};f["0_"+a.toLowerCase()]=b;return f}return 1==g?c.ROTARY_HANDLE_TRANSCEIVER.parseDptState(a,b):f};var y=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType=
"ip_blind"};util.inherits(y,e);y.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.SHUTTER_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.SHUTTER_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":4",dpt:b});g.push({channel:a.deviceAdr+":5",dpt:b});g.push({channel:a.deviceAdr+
":6",dpt:b})});return g};y.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "blindLevel":b.channel=a+":3";b.dataPoint=c.SHUTTER_TRANSMITTER.getDptFromState("blindTLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=c.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch5Level":b.channel=a+":5";
b.dataPoint=c.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch6Level":b.channel=a+":6";b.dataPoint=c.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;default:return null}return b};y.prototype.executeCommand=function(g,a,b){var c=null,f=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("stepUp")){var h=a.indexOf("stepUp");e=a.substr(0,h+6);var k=a.substr(h+6)}else-1!=a.indexOf("stepDown")?(h=a.indexOf("stepDown"),e=a.substr(0,h+8),k=a.substr(h+8)):-1!=a.indexOf("moveTo")?
(h=a.indexOf("moveTo"),e=a.substr(0,h+6),k=a.substr(h+6)):-1!=a.indexOf("stop")&&(h=a.indexOf("stop"),e=a.substr(0,h+4),k=a.substr(h+4));var l=this;switch(e){case "stop":f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":4","stop",function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","stop",function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","stop",b)})});break;case "moveUp":f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,this.deviceAdr+":4","moveUp",function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo0",b)})});break;case "moveDown":f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":4","moveDown",function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?
b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo0",b)})});break;case "stepUp":k=k?parseInt(k)/100:.05;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(k=c.value+k,1<k&&(k=1),k=Math.round(100*k),f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,
l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo0",function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "stepDown":k=k?parseInt(k)/100:.05;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):
(k=c.value-k,0>k&&(k=0),k=Math.round(100*k),f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo0",function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});
break;case "moveTo":if(!k){b&&b(Error("moveTo has no value"));break}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":4","moveTo"+k,function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo0",function(a,c){a?b&&b(a,c):f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo0",function(a,c){a?b&&b(a,c):(c=k/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+
1E3),b&&b(a))})})});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(e){case "ch4stop":c=this.deviceAdr+":4";break;case "ch5stop":c=this.deviceAdr+":5";break;case "ch6stop":c=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"stop",b);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(e){case "ch4moveUp":c=this.deviceAdr+":4";break;case "ch5moveUp":c=this.deviceAdr+":5";break;case "ch6moveUp":c=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,c,"moveUp",b);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(e){case "ch4moveDown":c=this.deviceAdr+":4";break;case "ch5moveDown":c=this.deviceAdr+":5";break;case "ch6moveDown":c=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"moveDown",b);break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(e){case "ch4stepUp":c=this.deviceAdr+":4";break;case "ch5stepUp":c=this.deviceAdr+":5";break;case "ch6stepUp":c=this.deviceAdr+
":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"stepUp"+k,b);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(e){case "ch4stepDown":c=this.deviceAdr+":4";break;case "ch5stepDown":c=this.deviceAdr+":5";break;case "ch6stepDown":c=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"stepDown"+k,b);break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(e){case "ch4moveTo":c=this.deviceAdr+":4";break;case "ch5moveTo":c=this.deviceAdr+
":5";break;case "ch6moveTo":c=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"moveTo"+k,b);break;default:b&&b(Error("no such command"))}};y.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a)return f.MAINTENANCE.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==g){if(a=f.SHUTTER_TRANSMITTER.parseDptState(a,b))c={},c.blindLevel=a.blindTLevel;return c}if(4==g||5==g||6==g){if(a=f.SHUTTER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(g)){case 4:c.ch4Level=a.blindLevel;break;case 5:c.ch5Level=a.blindLevel;break;case 6:c.ch6Level=a.blindLevel}return c}return null};y.prototype.getConfig=function(g,a){var b=this.deviceAdr+":3";g.getParamset(this.deviceIF,b,"MASTER",function(c,g){if(c)a&&a(c);else{var f=
{},e=null;g&&(e={CHANGE_OVER_DELAY:g.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUN_COUNTER:g.REFERENCE_RUN_COUNTER});f[b]=e;a&&a(c,f)}})};y.prototype.setConfig=function(g,a,b){if(a){var c=this.deviceAdr+
":3";if(a=a[c]){var f={};f.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};f.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};g.setParamset(this.deviceIF,c,"MASTER",f,function(a){b&&b(a)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};y.prototype.isButton=function(){return!0};y.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,g,function(){c._claimButtonEvent(2,g,function(){a&&
a()})})};y.prototype._claimButtonEvent=function(g,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+g,"PRESS_SHORT",function(f,e){f&&console.error("button:"+g+" claim PRESS_SHORT event error:"+f.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+g,"PRESS_LONG",function(a,c){a&&console.error("button:"+g+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var z=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_jalousie"};util.inherits(z,e);z.prototype._getReadableDpts=
function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE.getReadableDpts();c&&c.forEach(function(b){"UNREACH"==b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.BLIND_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":3",dpt:b})});(c=b.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":4",dpt:b});g.push({channel:a.deviceAdr+":5",dpt:b});g.push({channel:a.deviceAdr+":6",dpt:b})});return g};z.prototype._getDptFromRef=
function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":b.channel=a+":0";b.dataPoint=c.MAINTENANCE.getDptFromState(g);break;case "blindLevel":b.channel=a+":3";b.dataPoint=c.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":b.channel=a+":3";b.dataPoint=c.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;case "ch4blindLevel":b.channel=a+":4";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");
break;case "ch4lamellaLevel":b.channel=a+":4";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch5blindLevel":b.channel=a+":5";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch5lamellaLevel":b.channel=a+":5";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch6blindLevel":b.channel=a+":6";b.dataPoint=c.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch6lamellaLevel":b.channel=a+":6";b.dataPoint=
c.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;default:return null}return b};z.prototype.executeCommand=function(g,a,b){var c=null,f=x.hub.m.hm._Channel["HmIP-RF"],e=a;if(-1!=a.indexOf("stepUp")){var k=a.indexOf("stepUp");e=a.substr(0,k+6);var h=a.substr(k+6)}else-1!=a.indexOf("stepDown")?(k=a.indexOf("stepDown"),e=a.substr(0,k+8),h=a.substr(k+8)):-1!=a.indexOf("moveTo")?(k=a.indexOf("moveTo"),e=a.substr(0,k+6),h=a.substr(k+6)):-1!=a.indexOf("stop")?(k=a.indexOf("stop"),e=a.substr(0,
k+4),h=a.substr(k+4)):-1!=a.indexOf("lamellaStepUp")?(k=a.indexOf("lamellaStepUp"),e=a.substr(0,k+13),h=a.substr(k+13)):-1!=a.indexOf("lamellaStepDown")?(k=a.indexOf("lamellaStepDown"),e=a.substr(0,k+15),h=a.substr(k+15)):-1!=a.indexOf("lamellaTo")&&(k=a.indexOf("lamellaTo"),e=a.substr(0,k+9),h=a.substr(k+9));var l=this;switch(e){case "stop":case "moveUp":case "moveDown":f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":4",e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,
l.deviceIF,l.deviceAdr+":5",e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6",e,b)})});break;case "lamellaUp":case "lamellaDown":g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(h=c.value,h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4",e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,
l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5",e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6",e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,c){b&&b(a,c)})})})})})}))});break;case "stepUp":h=
h?parseInt(h)/100:.05;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(h=c.value+h,1<h&&(h=1),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,
l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "stepDown":h=h?parseInt(h)/100:.05;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get blind current value return invalid")):(h=c.value-h,0>h&&(h=0),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,
l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "moveTo":if(!h){b&&b(Error("moveTo has no value"));break}f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,this.deviceAdr+":4","moveTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",c,(new Date).getTime()+1E3),b&&b(a))})})});break;case "lamellaStepUp":h=h?parseInt(h)/100:.05;g.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var e=c.value;e=Math.round(100*e);g.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get lamella current value return invalid")):(h=c.value+h,1<h&&(h=1),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+
":4","lamellaTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","moveTo"+e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo"+e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,
l.deviceIF,l.deviceAdr+":6","moveTo"+e,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",c,(new Date).getTime()+1E3),b&&b(a))})})})})})}))})}});break;case "lamellaStepDown":h=h?parseInt(h)/100:.05;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var e=c.value;e=Math.round(100*
e);g.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,c){a?b&&b(a):"undefined"==typeof c||null==c?b&&b(Error("get lamella current value return invalid")):(h=c.value-h,0>h&&(h=0),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","moveTo"+e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,
l.deviceAdr+":5","lamellaTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo"+e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo"+e,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",c,(new Date).getTime()+1E3),b&&
b(a))})})})})})}))})}});break;case "lamellaTo":if(!h){b&&b(Error("lamellaTo has no value"));break}g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var e=c.value;e=Math.round(100*e);f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,
l.deviceAdr+":4","moveTo"+e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":5","moveTo"+e,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(a,c){a?b&&b(a,c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,l.deviceAdr+":6","moveTo"+e,function(a,c){a?b&&b(a,c):(c=h/100,1<c&&
(c=1),0>c&&(c=0),g.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",c,(new Date).getTime()+1E3),b&&b(a))})})})})})})}});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(e){case "ch4stop":c=this.deviceAdr+":4";break;case "ch5stop":c=this.deviceAdr+":5";break;case "ch6stop":c=this.deviceAdr+":6"}f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"stop",b);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(e){case "ch4moveUp":c=this.deviceAdr+":4";break;case "ch5moveUp":c=
this.deviceAdr+":5";break;case "ch6moveUp":c=this.deviceAdr+":6"}f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"moveUp",b);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(e){case "ch4moveDown":c=this.deviceAdr+":4";break;case "ch5moveDown":c=this.deviceAdr+":5";break;case "ch6moveDown":c=this.deviceAdr+":6"}f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"moveDown",b);break;case "ch4lamellaUp":case "ch5lamellaUp":case "ch6lamellaUp":switch(e){case "ch4lamellaUp":c=
this.deviceAdr+":4";break;case "ch5lamellaUp":c=this.deviceAdr+":5";break;case "ch6lamellaUp":c=this.deviceAdr+":6"}g.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,e){if(a)b&&b(a);else if("undefined"==typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var h=e.value;h=Math.round(100*h);f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,c,"lamellaUp",function(a,e){a?b&&b(a):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,c,"moveTo"+h,function(a,
c){b&&b(a,c)})})}});break;case "ch4lamellaDown":case "ch5lamellaDown":case "ch6lamellaDown":switch(e){case "ch4lamellaDown":c=this.deviceAdr+":4";break;case "ch5lamellaDown":c=this.deviceAdr+":5";break;case "ch6lamellaDown":c=this.deviceAdr+":6"}g.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,e){if(a)b&&b(a);else if("undefined"==typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var h=e.value;h=Math.round(100*h);f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,
l.deviceIF,c,"lamellaDown",function(a,e){a?b&&b(a):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,c,"moveTo"+h,function(a,c){b&&b(a,c)})})}});break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(e){case "ch4stepUp":c=this.deviceAdr+":4";break;case "ch5stepUp":c=this.deviceAdr+":5";break;case "ch6stepUp":c=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"stepUp"+h,b);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(e){case "ch4stepDown":c=
this.deviceAdr+":4";break;case "ch5stepDown":c=this.deviceAdr+":5";break;case "ch6stepDown":c=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"stepDown"+h,b);break;case "ch4lamellaStepUp":case "ch5lamellaStepUp":case "ch6lamellaStepUp":switch(e){case "ch4lamellaStepUp":c=this.deviceAdr+":4";break;case "ch5lamellaStepUp":c=this.deviceAdr+":5";break;case "ch6lamellaStepUp":c=this.deviceAdr+":6"}g.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,
e){if(a)b&&b(a);else if("undefined"==typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var k=e.value;k=Math.round(100*k);f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,c,"lamellaStepUp"+h,function(a,e){a?b&&b(a):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,c,"moveTo"+k,function(a,c){b&&b(a,c)})})}});break;case "ch4lamellaStepDown":case "ch5lamellaStepDown":case "ch6lamellaStepDown":switch(e){case "ch4lamellaStepDown":c=this.deviceAdr+":4";break;case "ch5lamellaStepDown":c=
this.deviceAdr+":5";break;case "ch6lamellaStepDown":c=this.deviceAdr+":6"}g.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,e){if(a)b&&b(a);else if("undefined"==typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var k=e.value;k=Math.round(100*k);f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,c,"lamellaStepDown"+h,function(a,e){a?b&&b(a):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,c,"moveTo"+k,function(a,c){b&&b(a,c)})})}});break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(e){case "ch4moveTo":c=
this.deviceAdr+":4";break;case "ch5moveTo":c=this.deviceAdr+":5";break;case "ch6moveTo":c=this.deviceAdr+":6"}f.SHUTTER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,c,"moveTo"+h,b);break;case "ch4lamellaTo":case "ch5lamellaTo":case "ch6lamellaTo":switch(e){case "ch4lamellaTo":c=this.deviceAdr+":4";break;case "ch5lamellaTo":c=this.deviceAdr+":5";break;case "ch6lamellaTo":c=this.deviceAdr+":6"}g.getState({interface:this.deviceIF,channel:c,datapoint:"LEVEL"},function(a,e){if(a)b&&b(a);else if("undefined"==
typeof e||null==e)b&&b(Error("get blind current value return invalid"));else{var k=e.value;k=Math.round(100*k);f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,c,"lamellaTo"+h,function(a,e){a?b&&b(a):f.BLIND_VIRTUAL_RECEIVER.executeCommand(g,l.deviceIF,c,"moveTo"+k,function(a,c){b&&b(a,c)})})}});break;default:b&&b(Error("no such command"))}};z.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");
-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a)return f.MAINTENANCE.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(3==g){if(b=f.BLIND_TRANSMITTER.parseDptState(a,b))c={},"LEVEL"==a?c.blindLevel=b.blindTPos:"LEVEL_2"==a&&(c.lamellaLevel=b.lamellaTPos);return c}if(4==g||5==g||6==g){if(b=f.BLIND_VIRTUAL_RECEIVER.parseDptState(a,b))switch(c={},parseInt(g)){case 4:"LEVEL"==a?c.ch4blindLevel=b.blindPos:"LEVEL_2"==
a&&(c.ch4lamellaLevel=b.lamellaPos);break;case 5:"LEVEL"==a?c.ch5blindLevel=b.blindPos:"LEVEL_2"==a&&(c.ch5lamellaLevel=b.lamellaPos);break;case 6:"LEVEL"==a?c.ch6blindLevel=b.blindPos:"LEVEL_2"==a&&(c.ch6lamellaLevel=b.lamellaPos)}return c}return null};z.prototype.getConfig=function(g,a){var b=this.deviceAdr+":3";g.getParamset(this.deviceIF,b,"MASTER",function(c,g){if(c)a&&a(c);else{var f={},e=null;g&&(e={CHANGE_OVER_DELAY:g.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:g.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:g.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:g.REFERENCE_RUN_COUNTER});f[b]=e;a&&a(c,f)}})};z.prototype.setConfig=function(g,a,b){if(a){var c=
this.deviceAdr+":3";if(a=a[c]){var f={};f.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};f.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};f.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_UNIT};f.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_VALUE};g.setParamset(this.deviceIF,c,"MASTER",f,function(a){b&&b(a)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};z.prototype.isButton=
function(){return!0};z.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,g,function(){c._claimButtonEvent(2,g,function(){a&&a()})})};z.prototype._claimButtonEvent=function(g,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+g,"PRESS_SHORT",function(f,e){f&&console.error("button:"+g+" claim PRESS_SHORT event error:"+f.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+g,"PRESS_LONG",
function(a,c){a&&console.error("button:"+g+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var ka=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_presence"};util.inherits(ka,e);ka.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.PRESENCEDETECTOR_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+
":1",dpt:b})});return g};ka.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":case "illumination":case "current_illumination":case "active":b.channel=a+":1";b.dataPoint=c.PRESENCEDETECTOR_TRANSCEIVER.getDptFromState(g);break;default:return null}return b};ka.prototype.executeCommand=
function(g,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":c.PRESENCEDETECTOR_TRANSCEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":1",a,b);break;default:b&&b(Error("no such command"))}};ka.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];
if(0==g){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==g?c.PRESENCEDETECTOR_TRANSCEIVER.parseDptState(a,b):null};var Da=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_floor_heater"};util.inherits(Da,e);Da.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_TRANSCEIVER.getReadableDpts();b&&b.forEach(function(b){g.push({channel:a.deviceAdr+
":"+a.channel,dpt:b})});return g};Da.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "cl_f_humidityLimiter":case "cl_f_emergencyOP":case "cl_f_frostProtection":case "cl_f_state":case "cl_f_dewPointAlarm":case "cl_f_externalClock":b.channel=a+":"+this.channel;b.dataPoint=c.CLIMATECONTROL_FLOOR_TRANSCEIVER.getDptFromState(g);break;default:return null}return b};Da.prototype.parseDptState=function(g,
a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];return g==this.channel?c.CLIMATECONTROL_FLOOR_TRANSCEIVER.parseDptState(a,b):null};var Ea=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_floor_pump_heater"};util.inherits(Ea,e);Ea.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getReadableDpts();
b&&b.forEach(function(b){g.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return g};Ea.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "cl_fp_humidityLimiter":case "cl_fp_emergencyOP":case "cl_fp_frostProtection":case "cl_fp_state":case "cl_fp_dewPointAlarm":case "cl_fp_externalClock":b.channel=a+":"+this.channel;b.dataPoint=c.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getDptFromState(g);break;default:return null}return b};
Ea.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];return g==this.channel?c.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.parseDptState(a,b):null};var Fa=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_weather"};util.inherits(Fa,e);Fa.prototype._getReadableDpts=function(){var g=
[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WEATHER_TRANSMIT.getReadableDpts())&&c.forEach(function(b){-1==b.indexOf("RAIN")&&-1==b.indexOf("WIND_DIR")&&g.push({channel:a.deviceAdr+":1",dpt:b})});return g};Fa.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=
a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(g);break;default:b.channel=a+":1";g=c.WEATHER_TRANSMIT.getDptFromState(g);if(!g)return null;b.dataPoint=g}return b};Fa.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,
b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==g?c.WEATHER_TRANSMIT.parseDptState(a,b):null};var Ga=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_weather2"};util.inherits(Ga,e);Ga.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WEATHER_TRANSMIT.getReadableDpts())&&c.forEach(function(b){-1==b.indexOf("WIND_DIR")&&g.push({channel:a.deviceAdr+
":1",dpt:b})});return g};Ga.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(g);break;default:b.channel=a+":1";g=c.WEATHER_TRANSMIT.getDptFromState(g);if(!g)return null;b.dataPoint=g}return b};Ga.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+
1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==g?c.WEATHER_TRANSMIT.parseDptState(a,b):null};var Ha=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_weather3"};util.inherits(Ha,e);Ha.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],
c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.CLIMATE_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});return g};Ha.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(g);break;default:b.channel=
a+":1";g=c.CLIMATE_TRANSCEIVER.getDptFromState(g);if(!g)return null;b.dataPoint=g}return b};Ha.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==g?c.CLIMATE_TRANSCEIVER.parseDptState(a,
b):null};var Ia=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_weather4"};util.inherits(Ia,e);Ia.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WEATHER_TRANSMIT.getReadableDpts())&&c.forEach(function(b){-1==b.indexOf("WIND_DIR")&&g.push({channel:a.deviceAdr+":1",dpt:b})});return g};Ia.prototype._getDptFromRef=function(g){var a=
this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(g);break;default:b.channel=a+":1";g=c.WEATHER_TRANSMIT.getDptFromState(g);if(!g)return null;b.dataPoint=g}return b};Ia.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==g?c.WEATHER_TRANSMIT.parseDptState(a,b):null};var la=function(g,a,b){e.call(this,g,a,b);this.channel=2;this.legacyType="ip_direction"};util.inherits(la,e);la.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){g.push({channel:a.deviceAdr+
":0",dpt:b})});(c=b.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":2",dpt:b});g.push({channel:a.deviceAdr+":3",dpt:b})});return g};la.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "ch2State":b.channel=a+":2";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch3State":b.channel=a+":3";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":b.channel=a+":4";b.dataPoint=c.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;default:b.channel=a+":2";g=c.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getDptFromState(g);if(!g)return null;b.dataPoint=g}return b};la.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");
-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return f.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(2==g){if(a=f.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,b))c={},"undefined"!=typeof a.current_direction&&(c.current_passage_r2l=a.current_direction),"undefined"!=typeof a.last_direction&&(c.last_passage_r2l=a.last_direction),"undefined"!=typeof a.passage_counter&&
(c.r2l_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&(c.r2l_passage_counter_overflow=a.passage_counter_overflow);return c}if(3==g){if(a=f.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,b))c={},"undefined"!=typeof a.current_direction&&(c.current_passage_l2r=a.current_direction),"undefined"!=typeof a.last_direction&&(c.last_passage_l2r=a.last_direction),"undefined"!=typeof a.passage_counter&&(c.l2r_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&
(c.l2r_passage_counter_overflow=a.passage_counter_overflow);return c}return null};la.prototype.parseStates=function(g){var a={},b;for(b in g){var c=this.parseChnState(b,g[b]);c&&(a=x.hub.m.hm._Util.mergeObj(a,c))}a.current_passage_r2l&&a.current_passage_l2r&&(a.current_direction=a.current_passage_r2l.value?{value:"right_to_left",time:a.current_passage_r2l.time}:{value:"left_to_right",time:a.current_passage_l2r.time});a.last_passage_r2l&&a.last_passage_l2r&&(a.last_direction=a.last_passage_r2l.value?
{value:"right_to_left",time:a.last_passage_r2l.time}:{value:"left_to_right",time:a.last_passage_l2r.time});delete a.current_passage_r2l;delete a.current_passage_l2r;delete a.last_passage_r2l;delete a.last_passage_l2r;return a};var L=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_button8"};util.inherits(L,e);L.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+
":0",dpt:b})});return g};L.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;default:return null}return b};L.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,
c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a)return f.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==g||2==g||3==g||4==g||5==g||6==g||7==g||8==g)if(a=f.KEY_TRANRECEIVER.parseDptState(a,b))c||(c={}),a.pressShort&&(c["btn"+g+"pressShort"]=!0),a.pressLong&&(c["btn"+g+"pressLong"]=!0);return c};L.prototype.isButton=function(){return!0};L.prototype.claimEvent=function(g,a){var b=this.deviceAdr;-1==b.indexOf(":")&&
this.channel&&(b+=":"+this.channel);var c=this;this._claimButtonEvent(1,g,function(){c._claimButtonEvent(2,g,function(){c._claimButtonEvent(3,g,function(){c._claimButtonEvent(4,g,function(){c._claimButtonEvent(5,g,function(){c._claimButtonEvent(6,g,function(){c._claimButtonEvent(7,g,function(){c._claimButtonEvent(8,g,function(){a&&a()})})})})})})})})};L.prototype._claimButtonEvent=function(g,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+g,"PRESS_SHORT",function(f,e){f&&console.error("button:"+
g+" claim PRESS_SHORT event error:"+f.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+g,"PRESS_LONG",function(a,c){a&&console.error("button:"+g+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var Ja=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_generic_input"};util.inherits(Ja,e);Ja.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].GENERIC_INPUT_TRANSMITER.getReadableDpts();b&&b.forEach(function(b){g.push({channel:a.deviceAdr+
":"+a.channel,dpt:b})});return g};Ja.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];b.channel=a+":"+this.channel;g=c.GENERIC_INPUT_TRANSMITER.getDptFromState(g);if(!g)return null;b.dataPoint=g;return b};Ja.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));
if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];return g==this.channel?c.GENERIC_INPUT_TRANSMITER.parseDptState(a,b):null};var ma=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_analog_output"};util.inherits(ma,e);ma.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.getReadableDpts();b&&b.forEach(function(b){g.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return g};ma.prototype._getDptFromRef=function(g){var a=
this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "outputLevel":b.channel=a+":"+this.channel;b.dataPoint=c.ANALOG_OUTPUT_TRANSCEIVER.getDptFromState("outputLevel");break;default:return null}return b};ma.prototype.executeCommand=function(g,a,b){x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":"+this.channel,a,function(a,g){b&&b(a,g)})};ma.prototype.parseDptState=function(g,a,b){var c=
g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];f=null;g==this.channel&&(f=c.ANALOG_OUTPUT_TRANSCEIVER.parseDptState(a,b));return f};var Ka=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_water"};util.inherits(Ka,e);Ka.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_CL.getReadableDpts();
c&&c.forEach(function(b){g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.WATER_DETECTION_TRANSMITTER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",dpt:b})});return g};Ka.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_CL.getDptFromState(g);break;case "alarm":case "moisture":case "water":b.channel=
a+":1";b.dataPoint=c.WATER_DETECTION_TRANSMITTER.getDptFromState(g);break;default:return null}return b};Ka.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a||"LOW_BAT"==a||"ERROR_NON_FLAT_POSITIONING"==a)return c.MAINTENANCE_BAT_CL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=
b;return c}return 1==g?c.WATER_DETECTION_TRANSMITTER.parseDptState(a,b):null};var La=function(g,a,b){e.call(this,g,a,b);this.channel=1;this.legacyType="ip_acce"};util.inherits(La,e);La.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],c=b.MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});(c=b.ACCELERATION_TRANSCEIVER.getReadableDpts())&&c.forEach(function(b){g.push({channel:a.deviceAdr+":1",
dpt:b})});return g};La.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "volatage":case "errorCode":case "sensorError":b.channel=a+":0";b.dataPoint=c.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "motion":b.channel=a+":1";b.dataPoint=c.ACCELERATION_TRANSCEIVER.getDptFromState(g);break;default:return null}return b};La.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");
if(-1==c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;c=x.hub.m.hm._Channel["HmIP-RF"];if(0==g){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a||"SENSOR_ERROR"==a)return c.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}return 1==g?c.ACCELERATION_TRANSCEIVER.parseDptState(a,b):null};var D=function(g,a,b){e.call(this,g,a,b);this.channel=
1;this.legacyType="ip_garagedoor"};util.inherits(D,e);D.prototype._getReadableDpts=function(){var g=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&g.push({channel:a.deviceAdr+":0",dpt:b})});return g};D.prototype._getDptFromRef=function(g){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},c=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "voltage":case "errorCode":b.channel=a+":0";b.dataPoint=
c.MAINTENANCE_BAT_EL.getDptFromState(g);break;default:return null}return b};D.prototype.executeCommand=function(g,a,b){var c=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var f=this.deviceAdr+":3";c.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,f,"onFor0.5",b);break;default:"onFor"==a.substr(0,5)?(f=this.deviceAdr+":3",c.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,f,a,b)):b&&b(Error("no such command"))}};D.prototype.parseDptState=function(g,a,b){var c=g.indexOf(":");if(-1==
c)return null;var f=g.substr(0,c);g=g.substr(c+1);var e=this.deviceAdr;c=this.deviceAdr.indexOf(":");-1!=c&&(e=this.deviceAdr.substr(0,c));if(f!=e)return null;f=x.hub.m.hm._Channel["HmIP-RF"];c=null;if(0==g){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a)return f.MAINTENANCE_BAT_EL.parseDptState(a,b);c={};c["0_"+a.toLowerCase()]=b;return c}if(1==g){if(a=f.KEY_TRANRECEIVER.parseDptState(a,b))c||(c={}),a.pressShort&&(c.btnPressShort=!0),a.pressLong&&(c.btnPressLong=!0);return c}return null};
D.prototype.isButton=function(){return!0};D.prototype.claimEvent=function(g,a){this._claimButtonEvent(1,g,function(){a&&a()})};D.prototype._claimButtonEvent=function(g,a,b){var c=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+g,"PRESS_SHORT",function(f,e){f&&console.error("button:"+g+" claim PRESS_SHORT event error:"+f.stack);a.reportValueUsage(c.deviceIF,c.deviceAdr+":"+g,"PRESS_LONG",function(a,c){a&&console.error("button:"+g+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var Sa=
function(){var g=function(a,b,c){e.call(this,a,b,c);this._chMaintenance=0;this._chKeyTransceiver1=1;this._chKeyTransceiver2=2;this._chSwitchTransmitter3=3;this._chSwitchVirtualReceiver4=4;this._chDimmerTransmitter7=7;this._chDimmerVirtualReceiver8=8;this._chDimmerTransmitter11=11;this._chDimmerVirtualReceiver12=12;this._chDimmerWeekProfile=15;this.legacyType="ip_bsl"};util.inherits(g,e);g.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+
":"+this._chSwitchTransmitter3,dpt:"STATE"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"COLOR"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"COLOR"}]};g.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "state":b.channel+=
this._chSwitchTransmitter3;b.dataPoint="STATE";break;case "led1Level":b.channel+=this._chDimmerTransmitter7;b.dataPoint="LEVEL";break;case "led1Color":b.channel+=this._chDimmerTransmitter7;b.dataPoint="COLOR";break;case "led2Level":b.channel+=this._chDimmerTransmitter11;b.dataPoint="LEVEL";break;case "led2Color":b.channel+=this._chDimmerTransmitter11;b.dataPoint="COLOR";break;default:return null}return b};g.prototype.executeCommand=function(a,b,c){var g=x.hub.m.hm._Channel["HmIP-RF"],f=this.getSerial();
var e=b;if(-1!=b.indexOf("dimUp")){var h=b.indexOf("dimUp");e=b.substr(0,h+5);h=b.substr(h)}else-1!=b.indexOf("dimDown")?(h=b.indexOf("dimDown"),e=b.substr(0,h+7),h=b.substr(h)):-1!=b.indexOf("dimTo")?(h=b.indexOf("dimTo"),e=b.substr(0,h+5),h=b.substr(h)):-1!=b.indexOf("toggleTo")?(h=b.indexOf("toggleTo"),e=b.substr(0,h+8),h=b.substr(h)):-1!=b.indexOf("colorTo")&&(h=b.indexOf("colorTo"),e=b.substr(0,h+7),h=b.substr(h));switch(e){case "on":case "off":case "toggle":b=f+":"+this._chSwitchVirtualReceiver4;
g.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,e,c);break;case "led1on":case "led1off":case "led1dimUp":case "led1dimDown":case "led1dimTo":case "led1toggleTo":case "led1colorTo":case "led2on":case "led2off":case "led2dimUp":case "led2dimDown":case "led2dimTo":case "led2toggleTo":case "led2colorTo":b="led1"==e.substr(0,4)?f+":"+this._chDimmerVirtualReceiver12:f+":"+this._chDimmerVirtualReceiver8;"led1on"==e?h="dimTo100":"led1off"==e?h="dimOff":"led2on"==e?h="dimTo100":"led2off"==e&&(h=
"dimOff");g.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,h,c);break;default:"onFor"==e.substr(0,5)?(b=f+":"+this._chSwitchVirtualReceiver4,g.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,e,c)):c&&c(Error("no such command"))}};g.prototype.parseDptState=function(a,b,c){var g=a.indexOf(":");if(-1==g)return null;var f=a.substr(0,g);a=a.substr(g+1);g=this.getSerial();if(f!=g)return null;f=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return f.MAINTENANCE.parseDptState(b,
c);default:var e={};e["0_"+b.toLowerCase()]=c;return e}case this._chKeyTransceiver1:case this._chKeyTransceiver2:if(c=f.KEY_TRANRECEIVER.parseDptState(b,c))e||(e={}),c.pressShort&&(e["btn"+a+"pressShort"]=!0),c.pressLong&&(e["btn"+a+"pressLong"]=!0);return e;case this._chSwitchTransmitter3:switch(b){case "STATE":if(c=f.SWITCH_TRANSMITTER.parseDptState(b,c))e={},e.state=c.switchTState;return e;default:return null}case this._chDimmerTransmitter7:if(c=f.DIMMER_TRANSMITTER.parseDptState(b,c))e={},"LEVEL"==
b?e.led2Level=c.dimmerTLevel:"COLOR"==b&&(e.led2Color=c.dimmerTColor);return e;case this._chDimmerTransmitter11:if(c=f.DIMMER_TRANSMITTER.parseDptState(b,c))e={},"LEVEL"==b?e.led1Level=c.dimmerTLevel:"COLOR"==b&&(e.led1Color=c.dimmerTColor);return e;default:return null}};g.prototype.isButton=function(){return!0};g.prototype.claimEvent=function(a,b){var c=this.getSerial(),g=this;a.reportValueUsage(this.deviceIF,c+":"+this._chKeyTransceiver1,"PRESS_SHORT",function(f,e){f&&console.error("button:1 claim PRESS_SHORT event error:"+
f.stack);a.reportValueUsage(g.deviceIF,c+":"+g._chKeyTransceiver1,"PRESS_LONG",function(f,e){f&&console.error("button:1 claim PRESS_LONG event error:"+f.stack);a.reportValueUsage(g.deviceIF,c+":"+g._chKeyTransceiver2,"PRESS_SHORT",function(f,e){f&&console.error("button:2 claim PRESS_SHORT event error:"+f.stack);a.reportValueUsage(g.deviceIF,c+":"+g._chKeyTransceiver2,"PRESS_LONG",function(a,c){a&&console.error("button:2 claim PRESS_LONG event error:"+a.stack);b&&b()})})})})};return g}(),Ta=function(){var g=
function(a,b,c){e.call(this,a,b,c);this._chMaintenance=0;this._chDoorReceiver=1;this._chSimpleSwitchReceiver=2;this.legacyType="ip_tormatic"};util.inherits(g,e);g.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this._chDoorReceiver,dpt:"DOOR_STATE"},{channel:this.deviceAdr+":"+this._chSimpleSwitchReceiver,dpt:"STATE"}]};g.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};
switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "doorState":b.channel+=this._chDoorReceiver;b.dataPoint="DOOR_STATE";break;case "lightState":b.channel+=this._chSimpleSwitchReceiver;b.dataPoint="STATE";break;default:return null}return b};g.prototype.executeCommand=function(a,b,c){var g=x.hub.m.hm._Channel["HmIP-RF"],f=this.getSerial();switch(b){case "open":case "close":case "partialOpen":case "stop":f=f+":"+this._chDoorReceiver;g.DOOR_RECEIVER.executeCommand(a,
this.deviceIF,f,b,c);break;case "lightOn":case "lightOff":case "lightToggle":b=b.substr(5).toLowerCase();f=f+":"+this._chSimpleSwitchReceiver;g.SIMPLE_SWITCH_RECEIVER.executeCommand(a,this.deviceIF,f,b,c);break;default:c&&c(Error("no such command"))}};g.prototype.parseDptState=function(a,b,c){var g=a.indexOf(":");if(-1==g)return null;var f=a.substr(0,g);a=a.substr(g+1);g=this.getSerial();if(f!=g)return null;f=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return f.MAINTENANCE.parseDptState(b,
c);default:var e={};e["0_"+b.toLowerCase()]=c;return e}case this._chDoorReceiver:return(b=f.DOOR_RECEIVER.parseDptState(b,c))&&(e=b),e;case this._chSimpleSwitchReceiver:if(b=f.SIMPLE_SWITCH_RECEIVER.parseDptState(b,c))e={},e.lightState=b.state;return e;default:return null}};return g}(),Ua=function(){var g=function(a,b,c){e.call(this,a,b,c);this._chMaintenance=0;this._chBrightness=1;this.legacyType="ip_lux"};util.inherits(g,e);g.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],
g=c.MAINTENANCE_BAT_EL.getReadableDpts();g&&g.forEach(function(c){"SABOTAGE"!=c&&"ERROR_CODE"!=c&&"SENSOR_ERROR"!=c&&a.push({channel:b.deviceAdr+":0",dpt:c})});(g=c.BRIGHTNESS_TRANSMITTER.getReadableDpts())&&g.forEach(function(c){a.push({channel:b.deviceAdr+":1",dpt:c})});return a};g.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},g=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "volatage":c.channel=b+":0";c.dataPoint=
g.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "illu":case "avgIllu":case "maxIllu":case "minIllu":c.channel=b+":1";c.dataPoint=g.BRIGHTNESS_TRANSMITTER.getDptFromState(a);break;default:return null}return c};g.prototype.parseDptState=function(a,b,c){var g=a.indexOf(":");if(-1==g)return null;var f=a.substr(0,g);a=a.substr(g+1);var e=this.deviceAdr;g=this.deviceAdr.indexOf(":");-1!=g&&(e=this.deviceAdr.substr(0,g));if(f!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];if(0==a){if("UNREACH"==b||"LOW_BAT"==
b||"OPERATING_VOLTAGE"==b)return g.MAINTENANCE_BAT_EL.parseDptState(b,c);g={};g["0_"+b.toLowerCase()]=c;return g}return 1==a?g.BRIGHTNESS_TRANSMITTER.parseDptState(b,c):null};return g}(),Va=function(){var g=function(a,b,c){e.call(this,a,b,c);this._chMaintenance=0;this._chPowerMainsTransmitter=1;this.legacyType="ip_pmfs"};util.inherits(g,e);g.prototype._getReadableDpts=function(){var a=this.getSerial(),b=[],c=this,g=x.hub.m.hm._Channel["HmIP-RF"],f=g.MAINTENANCE.getReadableDpts();f&&f.forEach(function(g){"UNREACH"==
g&&b.push({channel:a+":"+c._chMaintenance,dpt:g})});(f=g.POWER_MAINS_TRANSMITTER.getReadableDpts())&&f.forEach(function(g){b.push({channel:a+":"+c._chPowerMainsTransmitter,dpt:g})});return b};g.prototype._getDptFromRef=function(a){var b=this.getSerial(),c={channel:null,dataPoint:null},g=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":c.channel=b+":"+this._chMaintenance;c.dataPoint=g.MAINTENANCE.getDptFromState(a);break;case "powerMainsFailure":c.channel=b+":"+this._chPowerMainsTransmitter;
c.dataPoint=g.POWER_MAINS_TRANSMITTER.getDptFromState(a);break;default:return null}return c};g.prototype.parseDptState=function(a,b,c){var g=a.indexOf(":");if(-1==g)return null;var f=a.substr(0,g);a=a.substr(g+1);var e=this.deviceAdr;g=this.deviceAdr.indexOf(":");-1!=g&&(e=this.deviceAdr.substr(0,g));if(f!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];if(a==this._chMaintenance){if("UNREACH"==b)return g.MAINTENANCE.parseDptState(b,c);g={};g["0_"+b.toLowerCase()]=c;return g}return a==this._chPowerMainsTransmitter?
g.POWER_MAINS_TRANSMITTER.parseDptState(b,c):null};return g}(),Oa=function(){var g=function(a,b,c){e.call(this,a,b,c);this._chKeyTransceivers=[1];this._chMaintenance=0;this._chMaintenanceDpts=["UNREACH","LOW_BAT"];this.legacyType=1==this._chKeyTransceivers.length?"ip_button":"ip_button"+this._chKeyTransceivers};util.inherits(g,e);g.prototype._getReadableDpts=function(){var a=[],b=this,c=this.getSerial(),g=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getReadableDpts();g&&g.forEach(function(g){-1!=
b._chMaintenanceDpts.indexOf(g)&&a.push({channel:c+":"+b._chMaintenance,dpt:g})});return a};g.prototype._getDptFromRef=function(a){return(a=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getDptFromState(a))?{channel:this.getSerial()+":"+this._chMaintenance,dataPoint:a}:null};g.prototype.parseDptState=function(a,b,c){var g=a.indexOf(":");if(-1==g)return null;var f=x.hub.m.hm._Channel["HmIP-RF"],e=a.substr(0,g);a=a.substr(g+1);g=this.getSerial();if(e!=g)return null;if(parseInt(a)==this._chMaintenance){if(-1!=
this._chMaintenanceDpts.indexOf(b))return f.T_MAINTENANCE.parseDptState(b,c);var h={};h["0_"+b.toLowerCase()]=c;return h}if(-1!=this._chKeyTransceivers.indexOf(parseInt(a))){if(tmp=f.KEY_TRANRECEIVER.parseDptState(b,c))h={},1==this._chKeyTransceivers.length?h=tmp:(tmp.pressShort&&(h["btn"+a+"pressShort"]=!0),tmp.pressLong&&(h["btn"+a+"pressLong"]=!0));return h}};g.prototype.isButton=function(){return!0};g.prototype.claimEvent=function(a,b){var c=0,g=this,f=function(){c++;c<g._chKeyTransceivers.length?
g._claimButtonEvent(g._chKeyTransceivers[c],a,f):b&&b()};this._claimButtonEvent(this._chKeyTransceivers[c],a,f)};g.prototype._claimButtonEvent=function(a,b,c){var g=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+a,"PRESS_SHORT",function(f,e){f&&console.error("button:"+a+" claim PRESS_SHORT event error:"+f.stack);b.reportValueUsage(g.deviceIF,g.deviceAdr+":"+a,"PRESS_LONG",function(b,g){b&&console.error("button:"+a+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};g.parse=function(a){var b=
null,c=a.address,f=a.address.indexOf(":");-1!=f&&(b=a.address.substr(f+1),c=a.address.substr(0,f));f=null;switch(a.type){case "HmIP-MOD-OC8":f=new g(a.type,a.interface,c),f._chMaintenance=0,f._chMaintenanceDpts=["UNREACH","OPERATING_VOLTAGE"],f._chKeyTransceivers=[parseInt(b)]}return f};g.resolve=function(a,b){return"HmIP-MOD-OC8"==a?this._resolveIPMultiButton(a,b,1,8,["UNREACH","OPERATING_VOLTAGE"]):"HmIP-RCV-50"==a.substr(0,11)?this._resolveIPMultiButton(a,b,1,50,null):null};g._resolveIPMultiButton=
function(a,b,c,f,e){var h,k=[];for(h=0;h<f;h++){var l=new g(a,b.interface,b.address+":"+(h+c));l._chMaintenance=0;e&&(l._chMaintenanceDpts=e);l._chKeyTransceivers=[h+c];k.push(l)}return k};return g}(),Q=function(){var g=function(a,b,c){e.call(this,a,b,c);this.channel=1;this._chMaintenance=this._switchIdx=0;this._chSwitchVirtualReceiver1=2;this._chSwitchVirtualReceiver2=3;this._chSwitchVirtualReceiver3=4;this._chSwitchWeekProfile=5;this.legacyType="ip_switch"};util.inherits(g,e);g.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};g.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "state":b.channel+=this.channel;b.dataPoint="STATE";break;default:return null}return b};g.prototype.executeCommand=function(a,b,c){var g=this.getSerial(),f=this;switch(b){case "on":var e=
"STATE";var h=g+":"+this._chSwitchVirtualReceiver1;a.writeValue(this.deviceIF,h,e,!0,c);break;case "off":e="STATE";h=g+":"+this._chSwitchVirtualReceiver1;a.writeValue(this.deviceIF,h,e,!1,c);break;case "toggle":e="STATE";h=g+":"+this.channel;a.getState({interface:this.deviceIF,channel:h,datapoint:e},function(b,k){b?c&&c(b):k?(b=!0,k.value&&(b=!1),e="STATE",h=g+":"+f._chSwitchVirtualReceiver1,a.writeValue(f.deviceIF,h,e,b,c)):c&&c(Error("get switch current value return invalid"))});break;default:"onFor"==
b.substr(0,5)?(b=parseFloat(b.substr(5)),isNaN(b)?c&&c(Error("onFor command invalid")):(e="ON_TIME",h=g+":"+f._chSwitchVirtualReceiver1,a.writeValue(this.deviceIF,h,e,{type:"double",value:b},function(b){b?c&&c(b):(e="STATE",h=g+":"+f._chSwitchVirtualReceiver1,a.writeValue(f.deviceIF,h,e,!0,c))}))):c&&c(Error("no such command"))}};g.prototype.parseDptState=function(a,b,c){var g=a.indexOf(":");if(-1==g)return null;var f=a.substr(0,g);a=a.substr(g+1);g=this.getSerial();if(f!=g)return null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return{timeout:c};
default:return f={},f["0_"+b.toLowerCase()]=c,f}case this.channel:switch(b){case "STATE":return{state:1==c?"on":"off"};default:return null}default:return null}};g.parse=function(a){var b=null,c=a.address.indexOf(":");-1!=c&&(b=a.address.substr(c+1));c=null;switch(a.type){case "HmIP-MOD-OC8":c=this._parseTSwitch(a,b,41)}return c};g._parseTSwitch=function(a,b,c){a=new g(a.type,a.interface,a.address);a._chMaintenance=0;a.channel=parseInt(b);a._chSwitchVirtualReceiver1=a.channel+1;a._chSwitchVirtualReceiver2=
a.channel+2;a._chSwitchVirtualReceiver3=a.channel+3;a._chSwitchWeekProfile=c;return a};g.resolve=function(a,b,c,f){var e=[];if("HmIP-MOD-OC8"==a)for(l=0;8>l;l++)d=new g(a,b.interface,b.address+":"+(4*l+9)),d._chMaintenance=0,d.channel=4*l+9,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=41,e.push(d);else if(!c||!c.length){c=[];if(b.channels)for(l in b.channels){var h=b.channels[l];if(h&&"SWITCH_TRANSMITTER"==
h.type&&h.address){var k=h.address.indexOf(":");-1!=k&&(h=parseInt(h.address.substr(k+1)),isNaN(h)||c.push(h))}else h&&"SWITCH_WEEK_PROFILE"==h.type&&h.addres&&(k=h.address.indexOf(":"),-1!=k&&(h=parseInt(h.address.substr(k+1)),isNaN(h)||(f=h)))}if(c&&c.length)for(var l=0;l<c.length;l++)d=new g(a,b.interface,b.address+":"+c[l]),d._chMaintenance=0,d.channel=c[l],d._switchIdx=l,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=
f,e.push(d)}return e};return g}(),Qa=function(){var g=function(a,b,c){e.call(this,a,b,c);this.channel=1;this._chMaintenance=0;this._chDimmerVirtualReceiver1=2;this._chDimmerVirtualReceiver2=3;this._chDimmerVirtualReceiver3=4;this._chDimmerWeekProfile=13;this.legacyType="ip_dimmer"};util.inherits(g,e);g.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],g=c.MAINTENANCE.getReadableDpts();g&&g.forEach(function(c){"UNREACH"==c&&a.push({channel:b.deviceAdr+":"+b._chMaintenance,
dpt:c})});(g=c.DIMMER_TRANSMITTER.getReadableDpts())&&g.forEach(function(c){a.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(g=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&g.forEach(function(c){a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver1,dpt:c});a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver2,dpt:c});a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver3,dpt:c})});return a};g.prototype._getDptFromRef=function(a){var b=this.getSerail(),c={channel:null,dataPoint:null},
g=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":c.channel=b+":"+this._chMaintenance;c.dataPoint=g.MAINTENANCE.getDptFromState(a);break;case "dimmerLevel":c.channel=b+":"+this.channel;c.dataPoint=g.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;default:return null}return c};g.prototype.executeCommand=function(a,b,c){var g=x.hub.m.hm._Channel["HmIP-RF"],f=b;if(-1!=b.indexOf("dimUp")){var e=b.indexOf("dimUp");f=b.substr(0,e+5);var h=b.substr(e+5)}else-1!=b.indexOf("dimDown")?(e=b.indexOf("dimDown"),
f=b.substr(0,e+7),h=b.substr(e+7)):-1!=b.indexOf("dimTo")?(e=b.indexOf("dimTo"),f=b.substr(0,e+5),h=b.substr(e+5)):-1!=b.indexOf("toggleTo")&&(e=b.indexOf("toggleTo"),f=b.substr(0,e+8),h=b.substr(e+8));var k=this.getSerial(),l=this;switch(f){case "dimOff":g.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chDimmerVirtualReceiver1,"dimOff",c);break;case "dimUp":h=h?parseInt(h)/100:.1;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,f){b?
c&&c(b):"undefined"==typeof f||null==f?c&&c(Error("get dimmer current value return invalid")):(h=f.value+h,1<h&&(h=1),h=Math.round(100*h),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,c))});break;case "dimDown":h=h?parseInt(h)/100:.1;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,f){b?c&&c(b):"undefined"==typeof f||null==f?c&&c(Error("get dimmer current value return invalid")):(h=f.value-h,0>h&&(h=0),
h=Math.round(100*h),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,c))});break;case "dimTo":if(!h){c&&c(Error("dimTo has no value"));break}g.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,channel);break;case "toggleTo":if(!h){c&&c(Error("toggle has no value"));break}a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,f){b?c&&c(b):"undefined"==typeof f||null==
f?c&&c(Error("get dimmer current value return invalid")):(f.value&&(h=0),g.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,c))});break;default:c&&c(Error("no such command"))}};g.prototype.parseDptState=function(a,b,c){var g=a.indexOf(":");if(-1==g)return null;var f=a.substr(0,g);a=a.substr(g+1);g=this.getSerial();if(f!=g)return null;g=x.hub.m.hm._Channel["HmIP-RF"];f=null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return g.MAINTENANCE.parseDptState(b,
c);default:return f={},f["0_"+b.toLowerCase()]=c,f}case this.channel:if(b=g.DIMMER_TRANSMITTER.parseDptState(b,c))f={},f.dimmerLevel=b.dimmerTLevel;return f}return null};return g}(),Ra=function(){var g=function(a,b,c){e.call(this,a,b,c);this.channel=1;this._chMaintenance=0;this._chBlindVirtualReceiver1=2;this._chBlindVirtualReceiver2=3;this._chBlindVirtualReceiver3=4;this._chBlindWeekProfile=5;this.legacyType="ip_jalousie"};util.inherits(g,e);g.prototype._getReadableDpts=function(){var a=[],b=this,
c=x.hub.m.hm._Channel["HmIP-RF"],g=c.MAINTENANCE.getReadableDpts();g&&g.forEach(function(c){"UNREACH"==c&&a.push({channel:b.deviceAdr+":"+b._chMaintenance,dpt:c})});(g=c.BLIND_TRANSMITTER.getReadableDpts())&&g.forEach(function(c){a.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(g=c.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&g.forEach(function(c){a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver1,dpt:c});a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver2,dpt:c});a.push({channel:b.deviceAdr+
":"+b._chBlindVirtualReceiver3,dpt:c})});return a};g.prototype._getDptFromRef=function(a){var b=this.getSerial(),c={channel:null,dataPoint:null},g=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":c.channel=b+":"+this._chMaintenance;c.dataPoint=g.MAINTENANCE.getDptFromState(a);break;case "blindLevel":c.channel=b+":"+this.channel;c.dataPoint=g.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":c.channel=b+":"+this.channel;c.dataPoint=g.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");
break;default:return null}return c};g.prototype.executeCommand=function(a,b,c){var g=x.hub.m.hm._Channel["HmIP-RF"],f=b;if(-1!=b.indexOf("stepUp")){var e=b.indexOf("stepUp");f=b.substr(0,e+6);var h=b.substr(e+6)}else-1!=b.indexOf("stepDown")?(e=b.indexOf("stepDown"),f=b.substr(0,e+8),h=b.substr(e+8)):-1!=b.indexOf("moveTo")?(e=b.indexOf("moveTo"),f=b.substr(0,e+6),h=b.substr(e+6)):-1!=b.indexOf("stop")?(e=b.indexOf("stop"),f=b.substr(0,e+4),h=b.substr(e+4)):-1!=b.indexOf("lamellaStepUp")?(e=b.indexOf("lamellaStepUp"),
f=b.substr(0,e+13),h=b.substr(e+13)):-1!=b.indexOf("lamellaStepDown")?(e=b.indexOf("lamellaStepDown"),f=b.substr(0,e+15),h=b.substr(e+15)):-1!=b.indexOf("lamellaTo")&&(e=b.indexOf("lamellaTo"),f=b.substr(0,e+9),h=b.substr(e+9));var k=this.getSerial(),l=this;switch(f){case "stop":case "moveUp":case "moveDown":g.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,f,c);break;case "lamellaUp":case "lamellaDown":a.getState({interface:this.deviceIF,channel:k+":"+this.channel,
datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):g.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,"lamellaTo"+(f=100),function(b){b?c&&c(b):g.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+Math.round(100*e.value),c)})});break;case "stepUp":case "stepDown":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,
datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(h="stepUp"==f?e.value+h:e.value-h,1<h&&(h=1),0>h&&(h=0),h=Math.round(100*h),g.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+h,c))});break;case "moveTo":if(!h){c&&c(Error("moveTo has no value"));break}g.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,"moveTo"+h,c);break;case "lamellaStepUp":case "lamellaStepDown":h=
h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,e){if(b)c&&c(b);else if("undefined"==typeof e||null==e)c&&c(Error("get blind current value return invalid"));else{var m=e.value;m=Math.round(100*m);a.getState({interface:l.deviceIF,channel:k+":"+l.channel,datapoint:"LEVEL_2"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get lamella current value return invalid")):(h="lamellaStepUp"==f?e.value+h:e.value-h,1<h&&(h=
1),0>h&&(h=0),h=Math.round(100*h),g.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"lamellaTo"+h,function(b,f){b?c&&c(b,f):g.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+m,c)}))})}});break;case "lamellaTo":if(!h){c&&c(Error("lamellaTo has no value"));break}a.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(b,f){if(b)c&&c(b);else if("undefined"==typeof f||null==f)c&&c(Error("get blind current value return invalid"));
else{var e=f.value;e=Math.round(100*e);g.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"lamellaTo"+h,function(b){b?c&&c(b):g.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+e,c)})}});break;default:c&&c(Error("no such command"))}};g.prototype.parseDptState=function(a,b,c){var g=a.indexOf(":");if(-1==g)return null;var f=a.substr(0,g);a=a.substr(g+1);g=this.getSerial();if(f!=g)return null;g=x.hub.m.hm._Channel["HmIP-RF"];
f=null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return g.MAINTENANCE.parseDptState(b,c);default:return f={},f["0_"+b.toLowerCase()]=c,f}case this.channel:if(c=g.BLIND_TRANSMITTER.parseDptState(b,c))f={},"LEVEL"==b?f.blindLevel=c.blindTPos:"LEVEL_2"==b&&(f.lamellaLevel=c.lamellaTPos);return f}return null};g.prototype.getConfig=function(a,b){var c=this.getSerial()+":"+this.channel;a.getParamset(this.deviceIF,c,"MASTER",function(a,g){if(a)b&&b(a);else{var f={},e=null;g&&
(e={CHANGE_OVER_DELAY:g.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:g.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:g.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:g.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:g.REFERENCE_RUNNING_TIME_SLATS_VALUE,
REFERENCE_RUN_COUNTER:g.REFERENCE_RUN_COUNTER});f[c]=e;b&&b(a,f)}})};g.prototype.setConfig=function(a,b,c){if(b){var g=this.getSerial()+":"+this.channel;if(b=b[g]){var f={};f.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};f.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};
f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};f.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_UNIT};f.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_VALUE};a.setParamset(this.deviceIF,g,"MASTER",f,
function(b){c&&c(b)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};return g}(),B=function(){var g=function(b,a,g){e.call(this,b,a,g);this.channel=1;this._chMaintenance=0;this.legacyType="ip_multi_input"};util.inherits(g,e);g.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};g.prototype._getDptFromRef=function(b){var a={channel:this.getSerial()+
":",dataPoint:null};switch(b){case "timeout":a.channel+=this._chMaintenance;a.dataPoint="UNREACH";break;case "state":a.channel+=this.channel;a.dataPoint="STATE";break;default:return null}return a};g.prototype.parseDptState=function(a,c,g){var b=a.indexOf(":");if(-1==b)return null;var f=a.substr(0,b);a=a.substr(b+1);b=this.getSerial();if(f!=b)return null;f=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":return{timeout:g};default:return f={},f["0_"+
c.toLowerCase()]=g,f}case this.channel:switch(c){case "STATE":return{state:1==g?"on":"off"};case "PRESS_SHORT":case "PRESS_LONG":return f.KEY_TRANRECEIVER.parseDptState(c,g);default:return null}default:return null}};g.prototype.isButton=function(){return!0};g.prototype.claimEvent=function(a,c){this._claimButtonEvent(this.channel,a,function(){c&&c()})};g.prototype._claimButtonEvent=function(a,c,g){var b=this.getSerial()+":"+a,f=this;c.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(e,h){e&&
console.error("button:"+a+" claim PRESS_SHORT event error:"+e.stack);c.reportValueUsage(f.deviceIF,b,"PRESS_LONG",function(b,c){b&&console.error("button:"+a+" claim PRESS_LONG event error:"+b.stack);g&&g()})})};var a=function(a,c,f){g.call(this,a,c,f);this.legacyType="ip_multi_input_bat"};util.inherits(a,g);a.prototype._getReadableDpts=function(){for(var a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts,c=x.hub.m.hm._Channel["HmIP-RF"].MULTI_MODE_INPUT_TRANSMITTER.getReadableDpts,
g=[],f=0;f<a.length;f++)g.push({channel:this.deviceAdr+":"+this._chMaintenance,dpt:a[f]});for(f=0;f<c.length;f++)g.push({channel:this.deviceAdr+":"+this.channel,dpt:c[f]});return g};a.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null},g=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "voltage":case "errorCode":b.channel+=this._chMaintenance;b.dataPoint=g.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "state":b.channel+=this.channel;
b.dataPoint=g.MULTI_MODE_INPUT_TRANSMITTER.getDptFromState(a);break;default:return null}return b};a.prototype.parseDptState=function(a,c,g){var b=a.indexOf(":");if(-1==b)return null;var f=a.substr(0,b);a=a.substr(b+1);b=this.getSerial();if(f!=b)return null;f=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(c){case "UNREACH":case "LOW_BAT":case "OPERATING_VOLTAGE":case "ERROR_CODE":return f.MAINTENANCE_BAT_EL.parseDptState(c,g);default:return f={},f["0_"+c.toLowerCase()]=
g,f}case this.channel:switch(c){case "STATE":case "PRESS_SHORT":case "PRESS_LONG":return f.MULTI_MODE_INPUT_TRANSMITTER.parseDptState(c,g);default:return null}default:return null}};g.resolve=function(b,c,f){if("HmIP-FCI"==b.substr(0,8)){f=parseInt(b.substr(8));var e=a}else if("HmIP-MOD-RC"==b.substr(0,11))f=parseInt(b.substr(11)),e=a;else if("HmIPW-DRI"==b.substr(0,9))f=parseInt(b.substr(9)),e=g;else{if(!f||!f.length)if(f=[],c.channels)for(e in c.channels){var h=c.channels[e];if(h&&"MULTI_MODE_INPUT_TRANSMITTER"==
h.type&&h.address){var k=h.address.indexOf(":");-1!=k&&(h=parseInt(h.address.substr(k+1)),isNaN(h)||f.push(h))}}if(!f||!f.length)return[];e=[];for(h=0;h<f.length;h++)k=new g(b,c.interface,c.address+":"+f[h]),k._chMaintenance=0,k.channel=f[h],e.push(k);return e}return this._resolveIPMultiInput(b,c,f,e)};g._resolveIPMultiInput=function(a,c,g,f){var b,e=[];for(b=0;b<g;b++){var h=new f(a,c.interface,c.address+":"+(b+1));h._chMaintenance=0;h.channel=b+1;e.push(h)}return e};g.parse=function(b){var c=null,
g=b.address,f=b.address.indexOf(":");-1!=f&&(c=b.address.substr(f+1),g=b.address.substr(0,f));f=B;if("HmIP-FCI1"==b.type||"HmIP-FCI6"==b.type||"HmIP-MOD-RC8"==b.type)f=a;b=new f(b.type,b.interface,g);b._chMaintenance=0;b.channel=parseInt(c);return b};return g}(),Wa=function(){var g=function(a,b,c){e.call(this,a,b,c);this.channel=3;this._chKeyTransceivers=[];this._chMaintenance=0;this._chMaintenanceDpts=["UNREACH"];this._chMotionDetectorTransceiver=3;this.legacyType="ip_motion2"};util.inherits(g,e);
g.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],g=c.MAINTENANCE_BAT_EL.getReadableDpts();g&&g.forEach(function(c){-1!=b._chMaintenanceDpts.indexOf(c)&&a.push({channel:serialNum+":"+b._chMaintenance,dpt:c})});(g=c.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&g.forEach(function(c){a.push({channel:b.deviceAdr+":"+b._chMotionDetectorTransceiver,dpt:c})});return a};g.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},
g=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=g.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "state":case "illumination":case "active":c.channel=b+":"+this._chMotionDetectorTransceiver;c.dataPoint=g.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(a);break;default:return null}return c};g.prototype.executeCommand=function(a,b,c){var g=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "reset":case "activate":case "deactivate":case "toggleActivate":g.MOTIONDETECTOR_TRANSCEIVER.executeCommand(a,
this.deviceIF,this.deviceAdr+":"+this._chMotionDetectorTransceiver,b,c);break;default:c&&c(Error("no such command"))}};g.prototype.parseDptState=function(a,b,c){var g=a.indexOf(":");if(-1==g)return null;var f=a.substr(0,g);a=a.substr(g+1);var e=this.deviceAdr;g=this.deviceAdr.indexOf(":");-1!=g&&(e=this.deviceAdr.substr(0,g));if(f!=e)return null;g=x.hub.m.hm._Channel["HmIP-RF"];f=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return g.MAINTENANCE_BAT_EL.parseDptState(b,c);f={};f["0_"+b.toLowerCase()]=
c;return f}1==a&&(e=g.KEY_TRANRECEIVER.parseDptState(b,c))&&(e.pressShort&&(f={btn1pressShort:!0}),e.pressLong&&(f={btn1pressLong:!0}));2==a&&(e=g.KEY_TRANRECEIVER.parseDptState(b,c))&&(e.pressShort&&(f={btn2pressShort:!0}),e.pressLong&&(f={btn2pressLong:!0}));return 3==a?g.MOTIONDETECTOR_TRANSCEIVER.parseDptState(b,c):f};g.prototype.isButton=function(){return 0<this._chKeyTransceivers.length};g.prototype.claimEvent=function(a,b){if(this._chKeyTransceivers&&this._chKeyTransceivers.length){var c=function(b,
c,g,f){a.reportValueUsage(b,c+":"+g,"PRESS_SHORT",function(e,h){e&&console.error("button:1 claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(b,c+":"+g,"PRESS_LONG",function(a,b){a&&console.error("button:1 claim PRESS_LONG event error:"+a.stack);f()})})},g=this,f=0,e=function(){f++;f<g._chKeyTransceivers.length?c(g.deviceIF,g.deviceAdr,g._chKeyTransceivers[f],e):b&&b()},h=this.deviceAdr;-1==h.indexOf(":")&&this.channel&&(h+=":"+this.channel);c(this.deviceIF,this.deviceAdr,this._chKeyTransceivers[f],
e)}else b&&b()};g.resolve=function(a,b){b=new g(a,b.interface,b.address);"HmIPW-SMI55"==a&&(b._chKeyTransceivers=[1,2],b._chMotionDetectorTransceiver=3);return b};return g}(),u={};u.CLASS_MAP={maintenance:h,button:m,vbutton:f,switch:k,dimmer:l,blind:q,powerswitch:n,weather:r,heater:w,heater2:v,heater3:na,wallthermo:R,wallthermo2:S,contact:oa,weatherstation:t,rain:T,gong2:E,gong:Ma,window:pa,temp:qa,co2:sa,motion:ta,smoke:ua,siren:U,capacity:va,switch_interface:M,tilt:wa,temp2:ra,water:xa,weather2:p,
energymeter:ya,rgb:N,lux:za,siren2:V,jalousie:W,mod_em_8bit:F,mod_em_8:G,keymatic:X,ou_led16:H,hm_dis_ep_wm55:Na,dualwhite:Y};u.CLASS_MAP_IP={ip_switch:Pa,ip_contact:Aa,ip_heater:Z,ip_powerswitch:aa,ip_energyactor:ba,ip_dimmer:da,ip_motion:ha,ip_motion2:I,ip_button2:P,ip_siren:ia,ip_wallthermo:C,ip_smoke:ja,ip_window:Ca,ip_button4:J,ip_dimmer2:ea,ip_energyactor2:ca,ip_blind:y,ip_jalousie:z,ip_presence:ka,ip_dimmer3:fa,ip_wallthermo2:Ba,ip_floor_heater:Da,ip_floor_pump_heater:Ea,ip_button6:K,ip_weather:Fa,
ip_weather2:Ga,ip_weather3:Ha,ip_weather4:Ia,ip_direction:la,ip_button8:L,ip_generic_input:Ja,ip_analog_output:ma,ip_water:Ka,ip_acce:La,ip_garagedoor:D,ip_bsl:Sa,ip_tormatic:Ta,ip_button:O,ip_lux:Ua,ip_pmfs:Va};u.parseJson=function(g){if(!(g&&g.type&&g.interface&&g.address))return null;switch(g.interface){case "BidCos-RF":g=this._parseRFDeviceJson(g);break;case "HmIP-RF":g=this._parseIPDeviceJson(g);break;default:return null}return g};u._parseRFDeviceJson=function(g){var a=x.hub.m.hm.RFDeviceTypes[g.type];
if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.RFDeviceCatagory[a];if(!a||!a.type)return null;var b=this.CLASS_MAP[a.type];if(!b)return null;a=null;var c=g.address.indexOf(":");-1!=c&&(a=g.address.substr(c+1));"HM-Dis-EP-WM55"==g.type&&3==a&&(b=this.CLASS_MAP.hm_dis_ep_wm55);g=new b(g.type,g.interface,g.address);a&&(g.channel=parseInt(a));return g};u._parseIPDeviceJson=function(g){if("HmIPW"==g.type.substr(0,5))return this._parseIPW(g);if("HmIP-MIOB"==g.type)return u._parse_HMIP_MIOB(g);
if("HmIP-FCI1"==g.type||"HmIP-FCI6"==g.type||"HmIP-MOD-RC8"==g.type)return B.parse(g);var a=null,b=g.address.indexOf(":");-1!=b&&(a=g.address.substr(b+1));switch(g.type){case "HmIP-WHS2":return this._parseTSwitch(g,a,9);case "HmIP-MOD-OC8":return 8>=parseInt(a)?Oa.parse(g):Q.parse(g)}a=u._getIPMetaIndex(g.type);if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.IPDeviceCatagory[a];if(!a||!a.type)return null;var c=this.CLASS_MAP_IP[a.type];if(!c)return null;a=null;b=g.address.indexOf(":");
-1!=b&&(a=g.address.substr(b+1));g=new c(g.type,g.interface,g.address);a&&(g.channel=parseInt(a));return g};u._parseIPW=function(g){var a=null;var b=g.address.indexOf(":");-1!=b&&(a=g.address.substr(b+1));return"HmIPW-DRS"==g.type.substr(0,9)?(b=parseInt(g.type.substr(9)),g=new Q(g.type,g.interface,g.address),g._chMaintenance=0,g.channel=parseInt(a),g._chSwitchVirtualReceiver1=g.channel+1,g._chSwitchVirtualReceiver2=g.channel+2,g._chSwitchVirtualReceiver3=g.channel+3,g._chSwitchWeekProfile=4*b+1,
g):"HmIPW-DRD"==g.type.substr(0,9)?(b=parseInt(g.type.substr(9)),g=new Qa(g.type,g.interface,g.address),g._chMaintenance=0,g.channel=parseInt(a),g._chDimmerVirtualReceiver1=g.channel+1,g._chDimmerVirtualReceiver2=g.channel+2,g._chDimmerVirtualReceiver3=g.channel+3,g._chDimmerWeekProfile=4*b+1,g):"HmIPW-DRBL"==g.type.substr(0,10)?(b=parseInt(g.type.substr(10)),g=new Ra(g.type,g.interface,g.address),g._chMaintenance=0,g.channel=parseInt(a),g._chBlindVirtualReceiver1=g.channel+1,g._chBlindVirtualReceiver2=
g.channel+2,g._chBlindVirtualReceiver3=g.channel+3,g._chBlindWeekProfile=4*b+1,g):"HmIPW-DRI"==g.type.substr(0,9)?(parseInt(g.type.substr(9)),g=new B(g.type,g.interface,g.address),g._chMaintenance=0,g.channel=parseInt(a),g):"HmIPW-FIO"==g.type.substr(0,9)?(b=parseInt(g.type.substr(9)),a=parseInt(a),a<=b?(g=new B(g.type,g.interface,g.address),g._chMaintenance=0,g.channel=parseInt(a)):(g=new Q(g.type,g.interface,g.address),g._chMaintenance=0,g.channel=parseInt(a),g._chSwitchVirtualReceiver1=g.channel+
1,g._chSwitchVirtualReceiver2=g.channel+2,g._chSwitchVirtualReceiver3=g.channel+3,g._chSwitchWeekProfile=b+4*b+1),g):null};u._parse_HMIP_MIOB=function(g){var a=g.address,b=null,c=g.address.indexOf(":");-1!=c&&(a=g.address.substr(0,c),b=g.address.substr(c+1));c=null;0==b?c=this.CLASS_MAP.maintenance:3==b||7==b?c=this.CLASS_MAP_IP.ip_switch:9==b||10==b?c=this.CLASS_MAP_IP.ip_generic_input:11==b&&(c=this.CLASS_MAP_IP.ip_analog_output);return c?(g=new c(g.type,g.interface,a),g.channel=b,g):null};u._parseTSwitch=
function(g,a,b){g=new Q(g.type,g.interface,g.address);g._chMaintenance=0;g.channel=parseInt(a);g._chSwitchVirtualReceiver1=g.channel+1;g._chSwitchVirtualReceiver2=g.channel+2;g._chSwitchVirtualReceiver3=g.channel+3;g._chSwitchWeekProfile=b;return g};u.resolve=function(g){if(!g||!g.type||!g.interface)return null;switch(g.interface){case "BidCos-RF":g=this._resolveRFFromType(g.type,g);break;case "HmIP-RF":g=this._resolveIPFromType(g.type,g);break;default:return null}return g?Array.isArray(g)?g:[g]:
null};u._resolveRFFromType=function(g,a){if("HM-MOD-EM-8"==g)return this._resolve_HM_MOD_EM_8(g,a);if("HM-OU-LED16"==g)return this._resolve_HM_OU_LED16(g,a);if("HM-Dis-EP-WM55"==g)return this._resolve_HM_Dis_EP_WM55(g,a);var b=x.hub.m.hm.RFDeviceTypes[g];if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.RFDeviceCatagory[b];if(!b||!b.type)return this._resolveRFFromTypeGeneral(g,a);var c=[];if(a.channels)for(var f in a.channels){var e=a.channels[f];e.type==b.channel&&c.push(e)}var h=this.CLASS_MAP[b.type];
if(!h)return null;if("*"==b.channelNum){var k=[];c.forEach(function(b){var f=new h(g,a.interface,a.address),e=b.address.indexOf(":");1<c.length&&(f.deviceAdr=b.address);f.channel=b.address.substr(e+1);k.push(f)});return k}f=new h(g,a.interface,a.address);"undefined"!=typeof b.channelNum&&null!=b.channelNum&&(f.channel=b.channelNum);return f};u._resolveIPFromType=function(g,a){if("HmIPW"==g.substr(0,5))return this._resolveIPW(g,a);if("HmIP-MOD-OC8"==g){var b=Oa.resolve(g,a),c=Q.resolve(g,a);return b.concat(c)}if(0==
g.indexOf("HmIP-FAL"))return u._resolve_HMIP_FAL_X(g,a);if(0==g.indexOf("HmIP-MIOB"))return u._resolve_HMIP_MIOB(g,a);if("HmIP-DRSI"==g.substr(0,9)){b=parseInt(g.substr(9));c=[];for(var f=1;f<=b;f++)c.push(f);return B.resolve(g,a,c)}if("HmIP-DRDI"==g.substr(0,9)){b=parseInt(g.substr(9));c=[];for(f=1;f<=b;f++)c.push(f);return B.resolve(g,a,c)}if("HmIP-DRBLI"==g.substr(0,10)){b=parseInt(g.substr(10));c=[];for(f=1;f<=2*b;f++)c.push(f);return B.resolve(g,a,c)}switch(g){case "HmIP-PCBS2":return Oa._resolveIPMultiButton(g,
a,1,2,["UNREACH","OPERATING_VOLTAGE"]);case "HmIP-WHS2":return this._resolveIPMultiSwitch(g,a,2);case "HmIP-FCI1":case "HmIP-FCI6":case "HmIP-MOD-RC8":return B.resolve(g,a)}b=this._getIPMetaIndex(g);if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.IPDeviceCatagory[b];if(!b||!b.type)return null;var e=[];if(a.channels)for(c in a.channels)f=a.channels[c],f.type==b.channel&&e.push(f);var h=this.CLASS_MAP_IP[b.type];if(!h)return null;if("*"==b.channelNum){var k=[];e.forEach(function(b){var c=
new h(g,a.interface,a.address),f=b.address.indexOf(":");1<e.length&&(c.deviceAdr=b.address);c.channel=b.address.substr(f+1);k.push(c)});return k}c=new h(g,a.interface,a.address);"undefined"!=typeof b.channelNum&&null!=b.channelNum&&(c.channel=b.channelNum);return c};u._resolveIPW=function(g,a){var b,c=[];if("HmIPW-DRS"==g.substr(0,9)){var f=parseInt(g.substr(9));c=this._resolveIPMultiSwitch(g,a,f)}else if("HmIPW-DRD"==g.substr(0,9))for(f=parseInt(g.substr(9)),b=0;b<f;b++){var e=new Qa(g,a.interface,
a.address+":"+(4*b+1));e._chMaintenance=0;e.channel=4*b+1;e._chDimmerVirtualReceiver1=e.channel+1;e._chDimmerVirtualReceiver2=e.channel+2;e._chDimmerVirtualReceiver3=e.channel+3;e._chDimmerWeekProfile=4*f+1;c.push(e)}else if("HmIPW-DRBL"==g.substr(0,10))for(f=parseInt(g.substr(10)),b=0;b<f;b++)e=new Ra(g,a.interface,a.address+":"+(4*b+1)),e._chMaintenance=0,e.channel=4*b+1,e._chBlindVirtualReceiver1=e.channel+1,e._chBlindVirtualReceiver2=e.channel+2,e._chBlindVirtualReceiver3=e.channel+3,e._chBlindWeekProfile=
4*f+1,c.push(e);else if("HmIPW-DRI"==g.substr(0,9))for(f=parseInt(g.substr(9)),b=0;b<f;b++)e=new B(g,a.interface,a.address+":"+(b+1)),e._chMaintenance=0,e.channel=b+1,c.push(e);else if("HmIPW-FIO"==g.substr(0,9))for(f=parseInt(g.substr(9)),b=0;b<f;b++)e=new B(g,a.interface,a.address+":"+(b+1)),e._chMaintenance=0,e.channel=b+1,c.push(e),e=new Q(g,a.interface,a.address+":"+(4*b+f+1)),e._chMaintenance=0,e.channel=4*b+f+1,e._chSwitchVirtualReceiver1=e.channel+1,e._chSwitchVirtualReceiver2=e.channel+2,
e._chSwitchVirtualReceiver3=e.channel+3,e._chSwitchWeekProfile=f+4*f+1,c.push(e);else"HmIPW-SMI55"==g&&(e=Wa.resolve(g,a),c.push(e));return c};u._resolveIPMultiSwitch=function(g,a,b){var c,f=[];for(c=0;c<b;c++){var e=new Q(g,a.interface,a.address+":"+(4*c+1));e._chMaintenance=0;e.channel=4*c+1;e._chSwitchVirtualReceiver1=e.channel+1;e._chSwitchVirtualReceiver2=e.channel+2;e._chSwitchVirtualReceiver3=e.channel+3;e._chSwitchWeekProfile=4*b+1;f.push(e)}return f};u._resolveRFFromTypeGeneral=function(g,
a){var b=[];if(!a||!a.channels)return null;var c=a.channels,f;for(f in c){var e=c[f];if(e&&e.type&&x.hub.m.hm._Channel["BidCos-RF"][e.type]&&(e=x.hub.m.hm._Channel["BidCos-RF"][e.type].device)&&(e=this.CLASS_MAP[e])){e=new e(g,a.interface,f);var h=f.indexOf(":");e.channel=f.substr(h+1);b.push(e)}}return b};u._resolve_HM_MOD_EM_8=function(g,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,f;for(f in c){c=f.indexOf(":");c=f.substr(c+1);var e=new (0==c?this.CLASS_MAP.maintenance:this.CLASS_MAP.mod_em_8)(g,
a.interface,f);e.channel=c;b.push(e)}return b};u._resolve_HM_OU_LED16=function(g,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,f;for(f in c){c=f.indexOf(":");c=f.substr(c+1);var e=new (0==c?this.CLASS_MAP.maintenance:this.CLASS_MAP.ou_led16)(g,a.interface,f);e.channel=c;b.push(e)}return b};u._resolve_HM_Dis_EP_WM55=function(g,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,f;for(f in c){c=f.indexOf(":");c=f.substr(c+1);var e=null;0==c?e=this.CLASS_MAP.maintenance:1==c||2==
c?e=this.CLASS_MAP.button:3==c&&(e=this.CLASS_MAP.hm_dis_ep_wm55);e&&(e=new e(g,a.interface,f),e.channel=c,b.push(e))}return b};u._resolve_HMIP_FAL_X=function(g,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,f;for(f in c){var e=c[f],h=f.indexOf(":");h=f.substr(h+1);if(0==h)var k=this.CLASS_MAP.maintenance;else"CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER"==e.type?k=this.CLASS_MAP_IP.ip_floor_pump_heater:"CLIMATECONTROL_FLOOR_TRANSCEIVER"==e.type&&(k=this.CLASS_MAP_IP.ip_floor_heater);k&&(e=
new k(g,a.interface,f),e.channel=h,b.push(e))}return b};u._resolve_HMIP_MIOB=function(g,a){var b=[];if(!a||!a.channels)return null;var c=a.channels,f;for(f in c){c=f.indexOf(":");c=f.substr(c+1);var e=null;0==c?e=this.CLASS_MAP.maintenance:3==c||7==c?e=this.CLASS_MAP_IP.ip_switch:9==c||10==c?e=this.CLASS_MAP_IP.ip_generic_input:11==c&&(e=this.CLASS_MAP_IP.ip_analog_output);e&&(e=new e(g,a.interface,f),e.channel=c,b.push(e))}return b};u._getIPMetaIndex=function(g){for(var a in x.hub.m.hm.IPDeviceTypes)if(x.hub.m.hm.IPDeviceTypes.hasOwnProperty(a)&&
a.toUpperCase()==g.toUpperCase())return x.hub.m.hm.IPDeviceTypes[a];return null};return u}();
x.hub.m.hm.Manager=function(){var e=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager");this._gateway=e;this._devices={};this._meta={}};e.prototype.init=function(e){x.hub.m.hm._Util.isIP(this._gateway.ip)?(this._logger.log("info","start connect monitor to "+this._gateway.ip),this._startMonitor(e)):e&&e()};e.prototype.onDeviceEvent=function(e){this._logger.log("trace","receive device event:"+JSON.stringify({device:e.device?e.device.type:null,address:e.device?e.device.address:
null,channel:e.channel,datapoint:e.datapoint,value:e.value?e.value.value:null,ip:e.ip}));var h=function(f,e){var h=null;if(!e||0==e.length)return null;e.forEach(function(e){e&&e.key==f&&(h=e)});return h};if(!e||!e.device)return null;var f=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!f)return null;var k=e.device;k.hsstype=k.type;if(k.channels)for(var l in k.channels)if(k.channels.hasOwnProperty(l)){var q=k.channels[l];q.hsstype=q.type}k=f._parseDevice(k);if(!k||0==k.length)return null;var n;
1==k.length?n=k[0]:k.forEach(function(f){if(f.address==e.channel)n=f;else if(0==e.channel.indexOf(f.address)){var h=e.channel.split(":")[1];if(f.channels)for(var k in f.channels)if(f.channels[k].address==h){n=f;break}}});if(!n)return null;k=x.hub.m.hm._Util.getDeviceHashCode(n);var r=f.resolveState(n,e,e.oldValue.value);f=f.resolveState(n,e,e.value.value);if(!f)return null;this._logger.log("trace","event to device state");this._logger.log("trace","device:"+JSON.stringify(n));this._logger.log("trace",
"state:"+JSON.stringify(f));var p=[];Array.isArray(f)?f.forEach(function(f){var e=h(f.key,r);p.push({device:n,gateway:this._gateway,data:{key:f.key,value:f.value,changed:e?f.value!=e.value:!0,oldValue:e?e.value:void 0}})}.bind(this)):p.push({device:n,gateway:this._gateway,data:{key:f.key,value:f.value,changed:f.value!=r.value,oldValue:r.value}});this._generateEvent(k,p)};e.prototype._generateEvent=function(e,m){var f=require("x.hub.eventbus.js");if((e=this._meta[e])&&0<e.length)for(var h=0;h<e.length;h++){var l=
e[h];if(l)for(var q=0;q<m.length;q++){var n=m[q];n&&n.data&&(n.data.key==l.statusKey||"*"==n.data.key)&&f.emit("status",{module:"hm",device:n.device,gateway:n.gateway,data:n.data},l)}}};e.prototype.addStateDevice=function(e,m,f){if(e){e=JSON.parse(JSON.stringify(e));var h=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[h]||(delete e.gateway,this._devices[h]=e);this._meta[h]||(this._meta[h]=[]);f&&this._meta[h].push(f);m&&m()}else m&&m(Error("device json invalid"))};e.prototype.removeStateDevice=
function(e,m,f){if(!e)m&&m(Error("device json invalid"));else if(f){e=JSON.parse(JSON.stringify(e));e=x.hub.m.hm._Util.getDeviceHashCode(e);var h=this._meta[e];if(h){for(var l=-1,q=0;q<h.length;q++){var n=h[q];if(n&&"taskman"==n.src&&"taskman"==f.src&&n.taskID==f.taskID&&n.statusKey==f.statusKey){l=q;break}}0<=l&&h.splice(l,1);0==h.length&&(delete this._devices[e],delete this._meta[e])}m&&m()}};e.prototype.getAllStates=function(){var e=[],m;for(m in this._devices)if(this._devices.hasOwnProperty(m)){var f=
this._devices[m];f&&f.device&&(f=this.getStates(f.device))&&e.push(f)}return e};e.prototype.getStates=function(e){if(!e)return null;e=JSON.parse(JSON.stringify(e));var h=x.hub.m.hm._Util.getDeviceHashCode(e),f=this._devices[h];f||this.addStateDevice(e);var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return null;var l={};f=this._devices[h];for(var q in f.states)h=k.getBufferedState(f.states[q]),l[q]=this._resolveRawState(e,q,h);return{device:e,gateway:this._gateway,
states:l}};e.prototype.updateStates=function(e,m){if(e){e=JSON.parse(JSON.stringify(e));var f=x.hub.m.hm._Util.getDeviceHashCode(e),h=this._devices[f];h||this.addStateDevice(e);h=this._devices[f];this._updateStates(e,h.states,m)}else m&&m(Error("device json is null"))};e.prototype.getState=function(e,m,f){if(!e||!m)return f&&f(Error("argument invalid")),null;if("SysVar"==e.type||"CUxD"==e["interface"])x.hub.m.hm.HM_MODULE.doStatus("var",this._gateway,e,{value:m},function(e,h){e?f&&f(e):h?(e={value:h.status,
time:(new Date).getTime()},f&&f(null,e)):f&&f(Error("get sys var status return null"))});else{e=JSON.parse(JSON.stringify(e));var h=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[h]||this.addStateDevice(e);h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return f&&f(Error("no monitor for gateway")),null;var l=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!l)return f&&f(Error("gateway json invalid")),null;var q=l.resolveDatapointInfo(e,m);
if(!q)return f&&f(Error("device json or state ref invalid")),null;h.getState(q,function(h,k){if(h)f&&f(h);else if(k){h=l.resolveState(e,q,k.value);var n;h?Array.isArray(h)?h.forEach(function(f){f&&f.key==m&&(n={value:f.value,time:k.time})}):n={value:h.value,time:k.time}:n={value:h,time:k.time};f&&f(null,n)}else f&&f(null,null)})}};e.prototype.executeCommand=function(e,m,f){var h=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!h)return f&&f(Error("gateway json invalid")),null;h.executeCommandCreator(e,
m,f)};e.prototype.updateState=function(e,m,f){if(!e||!m)return f&&f(Error("argument invalid")),null;e=JSON.parse(JSON.stringify(e));var h=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[h]||this.addStateDevice(e);h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return f&&f(Error("no monitor for gateway")),null;var l=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!l)return f&&f(Error("gateway json invalid")),null;var q=l.resolveDatapointInfo(e,
m);if(!q)return f&&f(Error("device json or state ref invalid")),null;h.updateState(q,function(h,k){if(h)f&&f(h);else{h=l.resolveState(e,q,k);var n;h?Array.isArray(h)?h.forEach(function(f){f&&f.key==m&&(n={value:f.value})}):n={value:h.value}:n={value:h};f&&f(null,n)}})};e.prototype._startMonitor=function(e){var h=require("x.hub.m.hm.js")._monitorManager,f=this;h.startMonitor(this._gateway,{persistant:!0},function(k){var l=h.getMonitor(f._gateway.ip,f._gateway.uuid);if(l)l.on("new_devices",f._onNewDevices.bind(f));
e&&e(k)})};e.prototype._onNewDevices=function(e){var h=[],f;for(f in e)if(e.hasOwnProperty(f)){var k=x.hub.m.hm._Device.resolve(e[f]);k&&0<k.length&&(k=k.filter(function(f){return f&&f.isButton()}),h=h.concat(k))}var l=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(l&&0<h.length){var q=0,n=function(){q++;q<h.length&&h[q].claimEvent(l,n)};h[q].claimEvent(l,n)}};e.prototype._updateStates=function(e,m,f){var h=this;require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,
{persistant:!0},function(k){k?f&&f(k):h._getStateByScript(e,m,f)})};e.prototype._resolveDetailDpt=function(e){var h=require("xnm.aio.hm.js").devicemanager,f=h.applyUIFilter(e,{catagory:"status",elems:"*"}),k=f?f.status:null;h=(f=h.applyUIFilter(e,{catagory:"command",elems:"*"}))?f.command:null;f={states:{},commands:{}};if(k&&0<=k.length)for(var l=0;l<k.length;l++){var q=k[l],n=this._resolveDatapointRef(e,q.ref.value,!1);n&&(f.states[q.ref.value]=n)}if(h&&0<=h.length)for(l=0;l<h.length;l++)k=h[l],
(n=this._resolveDatapointRef(e,k.ref.value,!0))&&(f.commands[k.ref.value]=n);return f};e.prototype.learnRFDevice=function(e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnRF(function(f,h){if(f)e&&e(f);else{f=[];var k=new x.hub.m.hm.HM_MODULE.CCU,m;for(m in h){var n=h[m];n.hsstype=n.type;if(n.channels)for(m in n.channels)n.channels[m].hsstype=n.channels[m].type;(n=k._parseDevice(n))&&(f=f.concat(n))}e&&e(null,f)}}):e&&e(Error("monitor not started"))};
e.prototype.learnIPDevice=function(e,m,f){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnIP(e,m,function(e,h){if(e)f&&f(e);else{e=[];var k=new x.hub.m.hm.HM_MODULE.CCU,l;for(l in h){var m=h[l];m.hsstype=m.type;if(m.channels)for(l in m.channels)m.channels[l].hsstype=m.channels[l].type;(m=k._parseDevice(m))&&(e=e.concat(m))}f&&f(null,e)}}):f&&f(Error("monitor not started"))};e.prototype.learnIPDeviceQR=function(e,m){var f=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,
this._gateway.uuid);f?f.learnIPQR(e,function(f,e){if(f)m&&m(f);else{f=[];var h=new x.hub.m.hm.HM_MODULE.CCU,k;for(k in e){var l=e[k];l.hsstype=l.type;if(l.channels)for(k in l.channels)l.channels[k].hsstype=l.channels[k].type;(l=h._parseDevice(l))&&(f=f.concat(l))}m&&m(null,f)}}):m&&m(Error("monitor not started"))};e.prototype.deleteDevice=function(e,m,f){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.deleteDevice(e,m,f):f&&f(Error("monitor not started"))};
e.prototype.getRFInterfaces=function(e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.getRFInterfaces(e):e&&e(Error("monitor not started"))};return e}();x.hub.m.hm.ChipManager=function(e){x.hub.m.hm.Manager.call(this,e);this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager.ChipManager")};util.inherits(x.hub.m.hm.ChipManager,x.hub.m.hm.Manager);
x.hub.m.hm.ChipManager.prototype.init=function(e){if(x.hub.m.hm._Util.isIP(this._gateway.ip)){this._logger.log("info","start connect monitor to "+this._gateway.ip);var h=this,m=require("x.hub.m.hm.js")._monitorManager;m.startMonitor(this._gateway,{localChip:"chip",persistant:!0},function(f){var k=m.getMonitor(h._gateway.ip,h._gateway.uuid);if(k)k.on("new_devices",h._onNewDevices.bind(h));e&&e(f)},!0,!0)}else e&&e()};
x.hub.m.hm.ChipManager.prototype.reset=function(e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return e&&e(Error("no chip monitor")),null;h.reset(e)};
x.hub.m.hm.ChipManager.prototype.executeCommand=function(e,h,m){if(e&&e.address&&h)if(e=e.address.split("."),3>e.length)m&&m({error:Error("address invalid")});else{var f={type:e[0],interface:e[1],address:e[2]};e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return m&&m(Error("no chip monitor")),null;(f=x.hub.m.hm._Device.parseJson(f))?f.executeCommand(e,h.value,m):m&&m(Error("unknow device"))}else m&&m(Error("argument invalid"))};
x.hub.m.hm.ChipManager.prototype.getState=function(e,h,m){if(!e||!e.address||!h)return m&&m(Error("argument invalid")),null;e=e.address.split(".");if(3>e.length)m&&m(Error("address invalid"));else{var f={type:e[0],interface:e[1],address:e[2]};e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return m&&m(Error("no chip monitor")),null;(f=x.hub.m.hm._Device.parseJson(f))?f.getState(e,h.value,m):m&&m(Error("unknow device"))}};
x.hub.m.hm.ChipManager.prototype.getBufferedStateLegacy=function(e,h){if(!e)return null;e=x.hub.m.hm._Device.resolve(e);if(!e||0==e.length)return null;var m;1==e.length?m=e[0]:e.forEach(function(f){f.deviceAdr==h&&(m=f)});if(!m)return null;var f;if(e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid)){e=e.getAllBufferedStates();var k=m.deviceAdr,l=k.indexOf(":");-1!=l&&(k=k.substr(0,l));e[k]&&e[k].states&&(f=m.parseStates(e[k].states))}if(!f)return null;e={type:"HM",
adr:m.toLegacyAdr(),state:{}};for(var q in f)e.state[q]=f[q].value;return e};
x.hub.m.hm.ChipManager.prototype.checkButtonEvent=function(e){if(!e||!e.device||!e.datapoint||0!=e.datapoint.indexOf("PRESS"))return null;var h=x.hub.m.hm._Device.resolve(e.device);if(!h||0==h.length)return null;var m;1==h.length?m=h[0]:h.forEach(function(f){f.deviceAdr==e.channel&&(m=f)});if(!m)return null;h=m.parseDptState(e.channel,e.datapoint,e.value.value);if(!h)return null;var f={type:"HM",adr:m.deviceType+"."+m.deviceIF+"."+m.deviceAdr,state:{},_ver:"v5+"},k=Object.keys(h);f.state[k[0]]=h[k[0]];
require("x.hub.eventbus.js").emit("gatewayevent",f,{address:"HM"},"BTN")};
x.hub.m.hm.ChipManager.prototype.onDeviceEvent=function(e){if(!e||!e.device)return null;var h=x.hub.m.hm._Device.resolve(e.device);if(!h||0==h.length)return null;var m;1==h.length?m=h[0]:h.forEach(function(f){f.deviceAdr==e.channel&&(m=f)});if(!m)return null;h=m.parseDptState(e.channel,e.datapoint,e.oldValue.value);var f=m.parseDptState(e.channel,e.datapoint,e.value.value);if(!f)return null;var k={sys:"aio",type:"HM",address:m.deviceType+"."+m.deviceIF+"."+m.deviceAdr},l=this._gateway,q={key:null,
value:null,changed:e.changed,oldValue:null},n=Object.keys(f);q.key=n[0];q.value=f[n[0]];q.oldValue=h?h[n[0]]:void 0;this._logger.log("debug","EVENT:\t"+k.address+"\t"+q.key+"\t"+q.value);return{device:k,gateway:l,data:q}};
x.hub.m.hm.ChipManager.prototype.learnRFDevice=function(e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnRF(function(h,f){if(h)e&&e(h);else{var k=[],l;for(l in f){var m=x.hub.m.hm._Device.resolve(f[l]);m&&(k=k.concat(m))}e&&e(h,k)}}):e&&e(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnRFDeviceSN=function(e,h){var m=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);m?m.learnRFSN(e,function(f,e){if(f)h&&h(f);else{var k=[],m;for(m in e){var n=x.hub.m.hm._Device.resolve(e[m]);n&&(k=k.concat(n))}h&&h(f,k)}}):h&&h(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDevice=function(e,h,m){var f=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);f?f.learnIP(e,h,function(f,e){if(f)m&&m(f);else{var h=[],k;for(k in e){var l=x.hub.m.hm._Device.resolve(e[k]);l&&(h=h.concat(l))}m&&m(f,h)}}):m&&m(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDeviceQR=function(e,h){var m=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);m?m.learnIPQR(e,function(f,e){if(f)h&&h(f);else{var k=[],m;for(m in e){var n=x.hub.m.hm._Device.resolve(e[m]);n&&(k=k.concat(n))}h&&h(f,k)}}):h&&h(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.getAllBufferedStates=function(){var e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return[];e=e.getAllBufferedStates();var h=[],m;for(m in e){var f=e[m],k=x.hub.m.hm._Device.resolve(f.device);if(k)for(var l=0,q=k.length;l<q;l++){var n=k[l],r=n.parseStates(f.states);h.push({device:n,states:r})}}return h};
x.hub.m.hm.ChipManager.prototype.getConfig=function(e,h){if(e&&e.address)if(e=e.address.split("."),3>e.length)h&&h({error:Error("address invalid")});else{var m={type:e[0],interface:e[1],address:e[2]};e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return h&&h(Error("no chip monitor")),null;(m=x.hub.m.hm._Device.parseJson(m))?m.getConfig(e,h):h&&h(Error("unknow device"))}else h&&h(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype.setConfig=function(e,h,m){if(e&&e.address)if(e=e.address.split("."),3>e.length)m&&m({error:Error("address invalid")});else{var f={type:e[0],interface:e[1],address:e[2]};e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return m&&m(Error("no chip monitor")),null;(f=x.hub.m.hm._Device.parseJson(f))?f.setConfig(e,h,m):m&&m(Error("unknow device"))}else m&&m(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype._onNewDevices=function(e){var h=[],m;for(m in e)if(e.hasOwnProperty(m)){var f=x.hub.m.hm._Device.resolve(e[m]);f&&0<f.length&&(f=f.filter(function(f){return f&&f.isButton()}),h=h.concat(f))}var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(k&&0<h.length){var l=0,q=function(){l++;l<h.length&&h[l].claimEvent(k,q)};h[l].claimEvent(k,q)}};
x.hub.m.hm.CCU2Discovery=function(){var e=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.CCU2Discovery");this._autoDiscoverTO=null;var h=this;this._hmHandlerCB=function(f,e){h._logger.log("debug","find ccu:"+f.uuid+"@"+f.ip+" from netif:"+e);h._searchCB&&h._searchCB(f,e);if(f.ip){var k=!1;h._searchTmpHMs.forEach(function(e){e.ip==f.ip&&(k=!0)});k||h._searchTmpHMs.push(f)}};this._searchCB=e;this._searchRunning=!1;this._searchTmpHMs=[];this._searchTmpCBs=[]};e.prototype.discover=
function(e){e&&-1==this._searchTmpCBs.indexOf(e)&&this._searchTmpCBs.push(e);if(!this._searchRunning){this._searchRunning=!0;this._searchTmpHMs=[];this._autoDiscoverTO&&(clearTimeout(this._autoDiscoverTO),this._autoDiscoverTO=null);require("xnm.aio.hm.js").discoverCCUs(this._hmHandlerCB);var h=this;setTimeout(function(){h._searchRunning=!1;h._autoDiscoverTO=setTimeout(function(){h.discover()},3E4);h._searchTmpCBs.forEach(function(f){f&&f(h._searchTmpHMs)});h._searchTmpCBs=[]},3E3)}};return e}();
x.hub.m.hm._Util={isDeviceJsonValid:function(e){return e&&e.type&&e.address&&e.interface},isGatewayJsonValid:function(e){return e&&e.ip},getDeviceHashCode:function(e){if(!e)return-1;var h=0;h=(h<<5)-h+this._getStringHashCode(e.type);h=(h<<5)-h+this._getStringHashCode(e.address);return h=(h<<5)-h+this._getStringHashCode(e.interface)},getGatewayHashCode:function(e){if(!e)return-1;var h=80;e.port&&((h=parseInt(e.port))||(h=80));var m=0;m=(m<<5)-m+this._getStringHashCode(e.ip);m=(m<<5)-m+h;m=(m<<5)-m+
this._getStringHashCode(e.uuid);m=(m<<5)-m+this._getStringHashCode(e.username);return m=(m<<5)-m+this._getStringHashCode(e.password)},getLocalIP:function(e,h){var m=function(f){return f?(f=f.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))?(+f[1]<<24)+(+f[2]<<16)+(+f[3]<<8)+ +f[4]:-1:-1};if("127.0.0.1"==h||"localhost"==h)return"127.0.0.1";var f=require("os").networkInterfaces(),k;for(k in f)if(f.hasOwnProperty(k))for(var l=f[k],q=0;q<l.length;q++){var n=l[q];if(n&&"IPv4"==n.family&&n.address){if(e==k||!e&&
!h)return n.address;if(!e&&n.netmask&&h){var r=m(n.netmask),p=m(n.address),t=m(h);if((p&r)==(t&r))return n.address}}}return null},getLocalMac:function(e){var h=require("os").networkInterfaces(),m;for(m in h)if(h.hasOwnProperty(m))for(var f=h[m],k=0;k<f.length;k++){var l=f[k];if(l&&"IPv4"==l.family&&l.address&&l.mac&&e==l.address)return l.mac}return"00:00:00:00:00:00"},isIP:function(e){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)},
mergeObj:function(e,h){var m={},f;for(f in e)e.hasOwnProperty(f)&&(m[f]=e[f]);for(f in h)h.hasOwnProperty(f)&&(m[f]=h[f]);return m},_getStringHashCode:function(e){var h=0,m;if("undefined"==typeof e||null==e)return-1;if(0===e.length)return h;var f=0;for(m=e.length;f<m;f++){var k=e.charCodeAt(f);h=(h<<5)-h+k}return h}};
x.hub.m.hm.UdpEventProducer=function(){var e=function(e){this._handler=e;this._pool={}};e.prototype.EVENT_TO=300;e.prototype.onEvent=function(e){if(e&&e.channel){var h=0,f=e.channel,k=f.indexOf(":");-1!=k&&(f=e.channel.substr(0,k),h=e.channel.substr(k+1));(k=this._pool[f])&&k.timeout&&clearTimeout(k.timeout);var l=this;k=setTimeout(function(){var e=l._pool[f];l._pool[f]=null;for(var h in e){var k=e[h];if(k=l._handler._chipManager.getBufferedStateLegacy(k.device,k.channel)){k._ver="v5+";var m=require("x.hub.eventbus.js");
m.emit("gatewayevent",k,{address:"HM"},"STA");m.emit("udpevent",k,"STA")}}},this.EVENT_TO);this._pool[f]||(this._pool[f]={});this._pool[f].timeout=k;this._pool[f][h]||(this._pool[f][h]=e)}};e.prototype.addSTAEvent=function(e){if(e&&e.adr){var h=(new Date).getTime(),f=e.adr,k=this._pool[f];k&&k.timeout&&clearTimeout(k.timeout);var l=this;k=setTimeout(function(){var e=l._pool[f];if(e&&e.states){var h=require("x.hub.eventbus.js");h.emit("gatewayevent",e.states,{address:"HM"},"STA");h.emit("udpevent",
e.states,"STA")}},this.EVENT_TO);this._pool[f]={states:e,timestamp:h,timeout:k}}};return e}();
x.hub.m.hm.Handler=function(){var e=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Handler");var e=this;this._udpEvtProducer=new x.hub.m.hm.UdpEventProducer(this);this._discoveryCB=function(h,f){e._onFindHM(h,f)};this._monitorManager=this._discovery=null;this._managers={};this._chipManager=this._xmlrpcServer=null};util.inherits(e,EventEmitter);e.prototype.CCU=x.hub.m.hm.CCU;e.prototype.XMLRPCClient=x.hub.m.hm.Client;e.prototype.init=function(e){var h=this;if(localStorage){var f=
!0;"false"==localStorage.getItem("x.hub.m.hm.CCU_INIT_STATE")&&(f=!1);x.hub.m.hm.CCU_INIT_STATE=f}require("x.hub.eventbus.js").on("x.hub.m.hm.CCU_INIT_STATE",function(f){var e=!0;"false"==f&&(e=!1);x.hub.m.hm.CCU_INIT_STATE=e});this._discovery=new x.hub.m.hm.CCU2Discovery(this._discoveryCB);this._monitorManager=new x.hub.m.hm.MonitorManager;this._xmlrpcServer=new x.hub.m.hm.Server(global.HM_LOCAL_PORT);this._xmlrpcServer.start(function(f){f?(h._logger.log("warn","start homematic local server error with port:"+
h._xmlrpcServer.getPort()),h._logger.log("warn",f.stack),e&&e({error:f})):h._monitorManager.init(h._xmlrpcServer,function(f){f?e&&e({error:f}):global&&global.HM_CHIP?h._initChipManager(function(f){e&&e({error:f})}):e&&e({})})})};e.prototype.getSystems=function(){return["hm"]};e.prototype.addStateDevice=function(e,m,f){if(e)if(e.gateway&&"mediola"!=e.gateway.uuid)if(e.gateway.ip&&x.hub.m.hm._Util.isIP(e.gateway.ip))if(x.hub.m.hm._Util.isIP(e.gateway.ip)){var h=this._getManager(e.gateway);h?h.addStateDevice(e,
function(f){m&&m({error:f})},f):(h=this._addManager(e.gateway),h.init(function(f){}),h.addStateDevice(e,function(f){m&&m({error:f})},f))}else this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),m&&m({error:Error("gateway ip is url")});else m&&m({error:Error("gateway ip format invalid")});else m&&m();else m&&m({error:Error("device json format invalid")})};e.prototype.removeStateDevice=function(e,m,f){if(e)if(e.gateway&&"mediola"!=e.gateway.uuid)if(e.gateway.ip&&
x.hub.m.hm._Util.isIP(e.gateway.ip))if(x.hub.m.hm._Util.isIP(e.gateway.ip)){var h=this._getManager(e.gateway);h?h.removeStateDevice(e,function(f){m&&m({error:f})},f):m&&m({})}else this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),m&&m({error:Error("gateway ip is url")});else m&&m({error:Error("gateway ip format invalid")});else m&&m();else m&&m({error:Error("device json format invalid")})};e.prototype.getAllStates=function(){return this._chipManager?this._chipManager.getAllBufferedStates():
[]};e.prototype.getStates=function(e){if(!(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)))return null;var h=this._getManager(e.gateway);if(h)return h.getStates(e);h=this._addManager(e.gateway);h.init();return null};e.prototype.getState=function(e,m,f){if(!e)return f&&f({error:Error("device is null")}),null;if(!e.gateway||"mediola"==e.gateway.uuid){if(!this._chipManager){f&&f({error:Error("chip manager not inited")});return}return this._chipManager.getState(e,
{value:m},function(e,h){f&&f({error:e,data:h})})}if(!x.hub.m.hm._Util.isDeviceJsonValid(e)||!e.gateway||!x.hub.m.hm._Util.isGatewayJsonValid(e.gateway))return f&&f({error:Error("device json invalid")}),null;x.hub.m.hm.HM_MODULE.doStatus("xhub",e.gateway,e,{value:m},function(e,h){e?f&&f({error:e}):h?f&&f({data:{value:h.status}}):f&&f({error:Error("do status failed")})})};e.prototype.executeCommand=function(e,m,f){e?m?e.gateway&&"mediola"!=e.gateway.uuid?e.gateway?x.hub.m.hm.HM_MODULE.doCommand(e.gateway,
e,m,function(e){e?f&&f({error:e}):f&&f({})}):f&&f({error:Error("gateway is null")}):this._chipManager?this._chipManager.executeCommand(e,m,function(e){f&&f({error:e})}):f&&f({error:Error("chip manager not inited")}):f&&f({error:Error("command invalid")}):f&&f({error:Error("device is null")})};e.prototype.updateStates=function(e,m){if(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)){var f=this._getManager(e.gateway);f?f.updateStates(e,function(f,
e){m&&m({error:f,data:e})}):(f=this._addManager(e.gateway),f.init(function(h){h?m&&m({error:h}):f.updateStates(e,function(f,e){m&&m({error:f,data:e})})}))}else m&&m({error:Error("device json format invalid")})};e.prototype.checkDeviceMatch=function(e,m){if(!(m&&m.device&&e&&e.device))return!1;if(m.gateway&&"mediola"!=m.gateway.uuid)return m=x.hub.m.hm._Util.getDeviceHashCode(m.device),e=x.hub.m.hm._Util.getDeviceHashCode(e.device),m==e;var f=e.device.address;e.device.interface&&e.device.type&&(f=
e.device.type+"."+e.device.interface+"."+e.device.address);return f!=m.device.address?!1:!0};e.prototype._initChipManager=function(e){var h="127.0.0.1";global&&global.HM_CHIP&&(h=global.HM_CHIP);this._chipManager=new x.hub.m.hm.ChipManager({ip:h,username:global.HM_CHIP_USERNAME,password:global.HM_CHIP_PASSWORD,uuid:"mediola"});this._chipManager.init(e)};e.prototype._initCCU3Manager=function(e){this._addManager({ip:"127.0.0.1",type:3}).init(function(h){e&&e(h)})};e.prototype._discover=function(e){this._discovery.discover(e)};
e.prototype._onFindHM=function(e,m){this._logger.log("debug","find ccu:"+e.uuid+"@"+e.ip+" from netif:"+m);this._monitorManager.onFindHomeMatic(e.ip,m,e.uuid)};e.prototype._getManager=function(e){e=x.hub.m.hm._Util.getGatewayHashCode(e);return this._managers[e]};e.prototype._addManager=function(e){var h=x.hub.m.hm._Util.getGatewayHashCode(e);e=new x.hub.m.hm.Manager(e);return this._managers[h]=e};e.prototype.onDeviceEvent=function(e,m){this._logger.log("trace","receive device event:"+JSON.stringify(e));
require("x.hub.eventbus.js");if(m)this._chipManager&&(this._chipManager.checkButtonEvent(e),this._udpEvtProducer.onEvent(e));else for(var f in this._managers)if(m=this._managers[f])try{m.onDeviceEvent(e)}catch(k){console.error(k.stack)}};e.prototype.resetChip=function(e){this._chipManager?this._chipManager.reset(function(){e&&e({})}):e&&e(Error("chip manager not inited"))};e.prototype.initManager=function(e,m){if(e){var f=this._getManager(e);f||(f=this._addManager(e));f.init(function(e){m&&m({error:e})})}else m&&
m({error:Error("gateway invalid")})};e.prototype.learnRFDevice=function(e,m){if(e){var f=this._getManager(e);f?f.learnRFDevice(function(e,f){m&&m({error:e,data:f})}):(f=this._addManager(e),f.init(function(e){e?m&&m({error:e}):setTimeout(function(){f.learnRFDevice(function(e,f){m&&m({error:e,data:f})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDevice(function(e,f){if(e)m&&m({error:e});else{var h=[];f.forEach(function(e){if(e){var f=e.toLegacyAdr();e=e.toLegacyType();h.push({address:f,
type:e})}});m&&m({data:h})}}):m&&m(Error("chip manager not inited"))};e.prototype.learnRFDeviceSN=function(e,m,f){if(e){var h=this._getManager(e);h?h.learnRFDevice(function(e,h){f&&f({error:e,data:h})}):(h=this._addManager(e),h.init(function(e){e?f&&f({error:e}):setTimeout(function(){h.learnRFDevice(function(e,h){f&&f({error:e,data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDeviceSN(m,function(e,h){if(e)f&&f({error:e});else{var k=[];h.forEach(function(e){if(e){var f=e.toLegacyAdr();
e=e.toLegacyType();k.push({address:f,type:e})}});f&&f({data:k})}}):f&&f(Error("chip manager not inited"))};e.prototype.learnIPDevice=function(e,m,f,k){if(e){var h=this._getManager(e);h?h.learnIPDevice(m,f,function(e,f){k&&k({error:e,data:f})}):(h=this._addManager(e),h.init(function(e){e?k&&k({error:e}):setTimeout(function(){h.learnIPDevice(m,f,function(e,f){k&&k({error:e,data:f})})},3E3)}))}else m?f?this._chipManager?this._chipManager.learnIPDevice(m,f,function(e,f){if(e)k&&k({error:e});else{var h=
[];f.forEach(function(e){if(e){var f=e.toLegacyAdr();e=e.toLegacyType();h.push({address:f,type:e})}});k&&k({data:h})}}):k&&k(Error("chip manager not inited")):k&&k({error:Error("key is null")}):k&&k({error:Error("sgtin is null")})};e.prototype.learnIPDeviceQR=function(e,m,f){if(m)if(e){var h=this._getManager(e);h?h.learnIPDeviceQR(m,function(e,h){f&&f({error:e,data:h})}):(h=this._addManager(e),h.init(function(e){e?f&&f({error:e}):setTimeout(function(){h.learnIPDeviceQR(m,function(e,h){f&&f({error:e,
data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnIPDeviceQR(m,function(e,h){if(e)f&&f({error:e});else{var k=[];h.forEach(function(e){if(e){var f=e.toLegacyAdr();e=e.toLegacyType();k.push({address:f,type:e})}});f&&f({data:k})}}):f&&f(Error("chip manager not inited"));else f&&f({error:Error("qrKey is null")})};e.prototype.deleteDevice=function(e,m,f){if(m){var h=m.split(".");3>h.length?f&&f({error:Error("address invalid")}):(m=h[1],h=h[2],e?f&&f({error:Error("not supported yet")}):
this._chipManager?this._chipManager.deleteDevice(m,h,function(e){f&&f({error:e})}):f&&f(Error("chip manager not inited")))}else f&&f({error:Error("address invalid")})};e.prototype.getRFInterfaces=function(e,m){if(e){var f=this._getManager(e);f?f.getRFInterfaces(function(e,f){m&&m({error:e,data:f})}):(f=this._addManager(e),f.init(function(e){e?m&&m({error:e}):setTimeout(function(){f.getRFInterfaces(function(e,f){m&&m({error:e,data:f})})},3E3)}))}else this._chipManager?this._chipManager.getRFInterfaces(function(e,
f){m&&m({error:e,data:f})}):m&&m(Error("chip manager not inited"))};e.prototype.executeCommandLegacy=function(e,m,f,k){e?k&&k({error:Error("not supported yet")}):this._chipManager?m?this.executeCommand({address:m},{value:f},function(e){k&&k({error:e?e.error:null})}):k&&k({error:Error("address invalid")}):k&&k({error:Error("chip manager not inited")})};e.prototype.getAllStatesLegacy=function(e){var h=[];try{this.getAllStates().forEach(function(e){if(e&&e.device&&e.states){var f={type:"HM",adr:e.device.toLegacyAdr(),
state:{}},l;for(l in e.states)f.state[l]=e.states[l].value;h.push(f)}})}catch(f){console.error(f.stack)}e&&e({data:h})};e.prototype.getConfig=function(e,m){e?e.gateway&&"mediola"!=e.gateway.uuid?m&&m({error:Error("not supported yet")}):this._chipManager?this._chipManager.getConfig(e,function(e,h){m&&m({error:e,data:h})}):m&&m({error:Error("chip manager not inited")}):m&&m({error:Error("device is null")})};e.prototype.setConfig=function(e,m,f){e?e.gateway&&"mediola"!=e.gateway.uuid?f&&f({error:Error("not supported yet")}):
this._chipManager?this._chipManager.setConfig(e,m,function(e){f&&f({error:e})}):f&&f({error:Error("chip manager not inited")}):f&&f({error:Error("device is null")})};e.prototype.getMonitorStates=function(e){this._monitorManager.getMonitorStates(function(h,f){e&&e({error:h,data:f})})};e.prototype.getAllDevices=function(e){var h=[];try{this.getAllStates().forEach(function(e){e&&e.device&&e.states&&(e={type:"HM",address:e.device.toLegacyAdr(),data:e.device.toLegacyType(),snr:e.device.getSerial(),_ver:"v5+"},
h.push(e))})}catch(f){console.error(f.stack)}e&&e({data:h})};e.prototype.isWindowOpen=function(){try{for(var e=this.getAllStates(),m=0;m<e.length;m++){var f=e[m];if(f&&f.device&&f.states){var k=f.device.toLegacyType();if("window"==k){if(f.states.state&&"closed"!=f.states.state.value)return!0}else if("contact"==k){if(f.states.state&&"closed"!=f.states.state.value)return!0}else if("ip_contact"==k){if(f.states.state&&"closed"!=f.states.state.value)return!0}else if("ip_window"==k&&f.states.state&&"closed"!=
f.states.state.value)return!0}}}catch(l){return!1}};return e}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.hm.Handler);
