var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,h,m){c instanceof String&&(c=String(c));for(var e=c.length,g=0;g<e;g++){var k=c[g];if(h.call(m,k,g,c))return{i:g,v:k}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,h,m){c!=Array.prototype&&c!=Object.prototype&&(c[h]=m.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,h,m,e){if(h){m=$jscomp.global;c=c.split(".");for(e=0;e<c.length-1;e++){var g=c[e];g in m||(m[g]={});m=m[g]}c=c[c.length-1];e=m[c];h=h(e);h!=e&&null!=h&&$jscomp.defineProperty(m,c,{configurable:!0,writable:!0,value:h})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(h,c){return $jscomp.findInternal(this,h,c).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var c=0;return function(h){return $jscomp.SYMBOL_PREFIX+(h||"")+c++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var h=0;return $jscomp.iteratorPrototype(function(){return h<c.length?{done:!1,value:c[h++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.iteratorFromArray=function(c,h){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var m=0,e={next:function(){if(m<c.length){var g=m++;return{value:h(g,c[g]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6","es3");var util=require("util"),EventEmitter=require("events"),async=require("async"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.hm=x.hub.m.hm||{};x.hub.m.hm.CCU_INIT_STATE=!0;x.hub.m.hm.HM_MODULE=require("xnm.aio.hm.js");
x.hub.m.hm.RFDeviceTypes={"HM-PB-4Dis-WM":0,"ZEL STG RM DWT 10":0,"263 155":0,"HM-PB-4Dis-WM-2":0,ASH550I:1,ASH550:1,"HM-WDS10-TH-O":1,"263 158":1,"HM-WDS20-TH-O":1,"HM-WDS40-TH-I":1,"263 157":1,"IS-WDS-TH-OD-S-R3":1,"HM-WDS40-TH-I-2":1,"HM-LC-Bl1-SM":2,"HM-LC-Bl1-FM":2,"HM-LC-Bl1-PB-FM":2,"ZEL STG RM FEP 230V":2,"263 146":2,"HM-LC-BlX":2,"HM-LC-Bl1-SM-2":2,"HM-LC-Bl1-FM-2":2,"HM-LC-Bl1PBU-FM":2,"263 147":2,"HM-CC-RT-DN":3,"HM-CC-RT-DN-BoM":4,"HM-CC-TC":5,"ZEL STG RM FWT":5,"HM-CC-VD":6,"ZEL STG RM FSA":6,
CENTRAL:7,"HM-RCV-50":7,"HM-OU-CF-Pl":8,"HM-OU-CFM-Pl":9,"HM-OU-CFM-TW":9,"HM-OU-CM-PCB":10,"HM-LC-AO-SM":11,"HM-LC-Dim1L-Pl":11,"HM-LC-Dim1L-Pl-2":11,"HM-LC-Dim1L-CV":11,"263 132":11,"HM-LC-Dim2L-CV":11,"HM-LC-Dim2L-SM":11,"HSS-DX":11,"HM-LC-Dim1L-Pl-3":11,"HM-LC-Dim1L-CV-2":11,"HM-LC-Dim2L-SM-2":11,"HM-LC-Dim1PWM-CV":12,"HM-LC-Dim1PWM-CV-2":12,"HM-LC-Dim1TPBU-FM":13,"HM-LC-Dim1TPBU-FM-2":13,"263 133":13,"HM-LC-Dim1T-Pl":13,"HM-LC-Dim1T-CV":13,"HM-LC-Dim1T-FM":13,"HM-LC-Dim1T-Pl-3":13,"HM-LC-Dim1T-CV-2":13,
"HM-LC-Dim1T-FM-2":13,"HM-LC-Dim2T-SM":13,"HM-LC-Dim2T-SM-2":13,"HM-LC-Dim1T-Pl-2":13,"263 134":13,"HM-LC-Dim1T-DR":13,"HM-LC-Dim1T-FM-LF":13,"OLIGO.smart.iq.HM":11,"HM-Dis-WM55":14,"HM-MOD-EM-8":15,"HM-ES-PMSw1-Pl":16,"HM-ES-PMSw1-Pl-DN-R1":16,"HM-ES-PMSw1-Pl-DN-R2":16,"HM-ES-PMSw1-Pl-DN-R3":16,"HM-ES-PMSw1-Pl-DN-R4":16,"HM-ES-PMSw1-Pl-DN-R5":16,"HM-ES-PMSw1-DR":16,"HM-ES-PMSw1-SM":16,"HM-Dis-TD-T":17,"HM-Sec-Key":18,"HM-Sec-Key-S":18,"HM-Sec-Key-O":18,"HM-Sec-Key-Generic":18,KS550:19,KS888:19,KS550Tech:19,
KS550LC:19,"HM-WDS100-C6-O":19,"HM-WDS100-C6-O-2":19,"HM-OU-LED16":20,"HM-OU-X":20,"HM-PB-2-WM55-2":21,"HM-PB-2-WM55":21,"ZEL STG RM WT 2":21,"263 135":21,"HM-PB-2-FM":21,"HM-PBI-4-FM":21,"ZEL STG RM FST UP4":21,"263 145":21,"HM-PBI-X":21,"HM-RC-4-2":21,"HM-PB-6-WM55":21,"HM-RC-8":21,"HM-RC-4":21,"HM-RC-4-3":21,"HM-RC-4-B":21,"HM-RC-P1":21,"HM-RC-Sec3":21,"HM-RC-Sec3-B":21,"HM-RC-Key3":21,"HM-RC-Key3-B":21,"HM-PB-4-WM":21,"HM-PB-2-WM":21,"HM-RC-2-PBU-FM":21,"RC-H":21,atent:21,"ZEL STG RM HS 4":21,
"HM-RC-X":21,"BRC-H":21,"HM-RC-SB-X":21,"HM-RC-12":21,"HM-RC-12-B":21,"HM-RC-12-SW":21,"HM-RC-Key4-2":22,"HM-RC-Sec4-2":22,"HM-RC-Key4-3":22,"HM-RC-Sec4-3":22,"HM-RC-19":23,"HM-RC-19-B":23,"HM-RC-19-SW":23,"HM-Sen-RD-O":24,"HM-Sec-RHS":25,"HM-Sec-RHS-2":25,"ZEL STG RM FDK":25,"HM-Sec-xx":25,"HM-LC-Sw1-Pl":26,"HM-LC-Sw1-Pl-2":26,"HM-LC-Sw1-SM":26,"HM-LC-Sw2-SM":26,"HM-LC-Sw4-SM":26,"HM-LC-Sw4-PCB":26,"HM-LC-Sw4-WM":26,"HM-LC-Sw1-FM":26,"263 130":26,"HM-LC-Sw2-FM":26,"HM-LC-Sw1-PB-FM":26,"HM-LC-Sw2-PB-FM":26,
"HM-LC-Sw4-DR":26,"HM-LC-Sw2-DR":26,"ZEL STG RM FZS":26,"ZEL STG RM FZS-2":26,"HM-LC-Sw1PBU-FM":26,"HM-LC-Sw2PBU-FM":26,"263 131":26,"HM-MOD-Re-8":26,"HM-LC-Sw1-Ba-PCB":26,"HM-LC-Sw4-Ba-PCB":26,"HM-LC-Sw1-Pl-3":26,"HM-LC-Sw1-SM-2":26,"HM-LC-Sw4-SM-2":26,"HM-LC-Sw4-PCB-2":26,"HM-LC-Sw4-WM-2":26,"HM-LC-Sw1-FM-2":26,"HM-LC-Sw2-FM-2":26,"HM-LC-Sw4-DR-2":26,"HM-LC-Sw2-DR-2":26,"HM-LC-Sw1-Pl-DN-R1":26,"HM-LC-Sw1-Pl-DN-R2":26,"HM-LC-Sw1-Pl-DN-R3":26,"HM-LC-Sw1-Pl-DN-R4":26,"HM-LC-Sw1-Pl-DN-R5":26,"HM-LC-Sw1-DR":26,
"HM-LC-Sw1-Pl-CT-R1":26,"HM-LC-Sw1-Pl-CT-R2":26,"HM-LC-Sw1-Pl-CT-R3":26,"HM-LC-Sw1-Pl-CT-R4":26,"HM-LC-Sw1-Pl-CT-R5":26,"HM-LC-Sw1-PCB":26,"HM-LC-Sw1-Pl-OM54":26,"HM-LC-Sw1-SM-ATmega168":26,"HM-LC-Sw4-SM-ATmega168":26,S550IA:27,"HM-WDS30-T-O":27,"HM-Sec-SC":28,"ZEL STG RM FFK":28,"HM-Sec-SC-2":28,"HM-SCI-3-FM":29,"HM-CC-SCD":30,"263 160":30,"HM-Sec-MDIR-3":31,"HM-Sec-MDIR-2":31,"HM-Sec-MDIR":31,"263 162":31,"HM-Sec-MD":31,"HM-Sec-SD":32,"HM-Sec-SD-Generic":32,"HM-Sec-SD-2":32,"HM-Sec-SD-2-Generic":32,
"HM-Sec-SFA-SM":33,"HM-Sen-MDIR-SM":34,"HM-Sen-MDIR-O":34,"HM-MD":34,"HM-Sen-MDIR-O-2":34,"HM-Sen-MDIR-O-3":34,"HM-Sen-EP":35,"HM-Sen-X":35,"HM-Sen-Wa-Od":36,"HM-SwI-3-FM":37,"ZEL STG RM FSS UP3":37,"263 144":37,"HM-SwI-X":37,"HM-TC-IT-WM-W-EU":38,"HM-Sec-TiS":39,"HM-WDS30-OT2-SM":40,"HM-WDS30-OT2-SM-2":40,"HM-Sec-WDS":41,"HM-Sec-WDS-2":41,"HM-Sec-Win":42,"HM-Sec-Win-Generic":42,WS550:43,WS888:43,WS550Tech:43,WS550LCB:43,WS550LCW:43,"HM-WDC7000":43,"HMW-IO-12-Sw14-DR":44,"HMW-IO-12-Sw7-DR":45,"HMW-IO-12-FM":46,
"HMW-IO-4-FM":46,"HMW-LC-Bl1-DR":47,"HMW-LC-Dim1L-DR":48,"HMW-LC-Sw2-DR":49,"HMW-Sen-SC-12-DR":50,"HMW-Sen-SC-12-FM":50,"HM-CC-VG-1":51,"HM-ES-TX-WM":52,"HM-LC-RGBW-WM":53,"HM-Sec-SD-2-Team":54,"HM-Sen-LI-O":56,"HM-Sec-SCo":28,"HM-Sec-Sir-WM":57,"HM-LC-Ja1PBU-FM":58,"HM-MOD-EM-8Bit":59,"HM-Dis-EP-WM55":60,"HM-Sen-MDIR-WM55":61,"HM-LC-DW-WM":62};
x.hub.m.hm.RFDeviceCatagory=[{type:"button",channelNum:"*",channel:"KEY"},{type:"weather"},{type:"blind",channelNum:"*",channel:"BLIND"},{type:"heater2"},{type:"heater3"},{type:"wallthermo"},{type:"heater"},{type:"vbutton",channelNum:"*",channel:"VIRTUAL_KEY"},{type:"gong2"},{type:"gong"},{type:"gong"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"button",channelNum:"*",channel:"KEY"},{type:"mod_em_8",
channelNum:"*",channel:"KEY"},{type:"powerswitch"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"keymatic"},{type:"weatherstation"},{type:"ou_led16",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"rain"},{type:"window"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"temp"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"contact",channelNum:"*",
channel:"SHUTTER_CONTACT"},{type:"co2"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{type:"smoke"},{type:"siren",channelNum:"*",channel:"ALARMACTUATOR"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{},{type:"capacity"},{type:"switch_interface",channelNum:"*",channel:"SWITCH_INTERFACE"},{type:"wallthermo2"},{type:"tilt",channelNum:"*",channel:"TILT_SENSOR"},{type:"temp2",channel:"WEATHER"},{type:"water",channelNum:"*",channel:"WATERDETECTIONSENSOR"},{},{type:"weather2"},{},
{},{},{},{},{},{},{},{type:"energymeter"},{type:"rgb"},{},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"lux"},{type:"siren2"},{type:"jalousie",channelNum:"*",channel:"JALOUSIE"},{type:"mod_em_8bit"},{type:"button",channelNum:"*",channel:"KEY"},{},{type:"dualwhite"}];
x.hub.m.hm.IPDeviceTypes={"HMIP-PS":0,"HmIP-PCBS":0,"HmIP-PCBS-BAT":0,"HMIP-SWDO":1,"HmIP-SWDO-I":1,"HmIP-SWDM":1,"HmIP-SWDM-B2":1,"Contact AA":1,"HMIP-WTH":2,"HmIP-WTH-2":2,"HmIP-STH":2,"HmIP-STHD":2,"HMIP-eTRV":3,"HMIP-eTRV-2":3,"HmIP-eTRV-2-UK":3,"HmIP-eTRV-B":3,"HmIP-eTRV-B1":3,"HmIP-eTRV-B-UK":3,"HmIP-eTRV-C":3,"HMIP-WRC2":4,"HmIP-SMI":5,"HmIP-SMO":5,"HmIP-SMO-A":5,"HmIP-SRH":6,"HmIP-SWSD":7,"HmIP-PSM":8,"Smart Plug AA":8,"HmIP-PSM-PE":8,"HmIP-PSM-UK":8,"HmIP-PSM-IT":8,"HmIP-PSM-CH":8,"HmIP-BSM":9,
"HmIP-BDT":10,"HmIP-ASIR":11,"HmIP-KRC4":12,"HmIP-KRCA":12,"HmIP-PDT":13,"HmIP-PDT-UK":13,"HmIP-FSM":14,"HmIP-FSM16":14,"HmIP-BROLL":15,"HmIP-FROLL":15,"HmIP-FBL":16,"HmIP-BBL":16,"HmIP-SPI":17,"HmIP-FDT":18,"HmIP-BWTH":19,"HmIP-BWTH24":19,"HmIP-FAL230-C6":20,"HmIP-FAL24-C6":20,"HmIP-FAL230-C10":20,"HmIP-FAL24-C10":20,"HmIP-WRC6":21,"HmIP-SWO-B":22,"HmIP-SWO-PL":23,"HmIP-SWO-PR":27,"HmIP-STHO":24,"HmIP-STHO-A":24,"HmIP-SPDR":25,"HmIP-SMI55":26,"HmIP-RC8":28,"HmIP-MIOB":0,"HmIP-SWD":31,"HmIP-SAM":32,
"HmIP-WGC":33,"HmIP-BSL":34,"HmIP-MOD-TM":35,"HmIP-DBB":36,"HmIP-FCI1":37,"HmIP-SLO":38,"HmIP-BRC2":4};
x.hub.m.hm.IPDeviceCatagory=[{type:"ip_switch"},{type:"ip_contact"},{type:"ip_wallthermo"},{type:"ip_heater"},{type:"ip_button2"},{type:"ip_motion"},{type:"ip_window"},{type:"ip_smoke"},{type:"ip_powerswitch"},{type:"ip_energyactor"},{type:"ip_dimmer"},{type:"ip_siren"},{type:"ip_button4"},{type:"ip_dimmer2"},{type:"ip_energyactor2"},{type:"ip_blind"},{type:"ip_jalousie"},{type:"ip_presence"},{type:"ip_dimmer3"},{type:"ip_wallthermo2"},{type:"ip_floor_heater"},{type:"ip_button6"},{type:"ip_weather"},
{type:"ip_weather2"},{type:"ip_weather3"},{type:"ip_direction"},{type:"ip_motion2"},{type:"ip_weather4"},{type:"ip_button8"},{type:"ip_generic_input"},{type:"ip_analog_output"},{type:"ip_water"},{type:"ip_acce"},{type:"ip_garagedoor"},{type:"ip_bsl"},{type:"ip_tormatic"},{type:"ip_button"},{type:"ip_multi_input_bat"},{type:"ip_lux"}];
x.hub.m.hm.Util={clearHttpOptionForLog:function(c){try{var h=JSON.parse(JSON.stringify(c));h.auth&&(h.auth="xxxxxx:xxxxxx");if(h.headers)for(var m in headers)if(m&&"authorization"==m.toLocaleLowerCase()){var e=headers[m];if(e){var g=e.indexOf(" ");headers[m]=-1==g?"xxxxxx":e.substr(0,g)+" xxxxxx"}}return h}catch(k){return c}}};
x.hub.m.hm.Client=function(){var c=function(h,c,e,g,k){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Client");this.ip=h;this.port=c;this.port||(this.port=2001);this.username=e;this.password=g;this.useHttps=k;this.timeout=2E4;this.xml2js=null};c.prototype._doRequest=function(h,c,e){var g=require("http");this.useHttps&&(g=require("https"));h={host:this.ip,port:this.port,path:"/",method:h,headers:{"User-Agent":"mediola",Connection:"keep-alive"}};this.username&&(h.auth=this.username+":"+(this.password?
this.password:""));c&&(h.headers["Content-Length"]=c.length);var k=e,m=this;this._logger.log("trace","send http request:"+x.hub.m.hm.Util.clearHttpOptionForLog(h));this._logger.log("trace","send http data:"+c);e=g.request(h,function(g){var e="";g.setEncoding("utf-8");g.on("data",function(g){e+=g});g.on("end",function(){m._logger.log("trace","http response status:"+g.statusCode);m._logger.log("trace","http response data:"+e);var l=null;200!=g.statusCode&&(l=Error("http response "+g.statusCode));k&&
k(l,e,g.statusCode)})});e.on("error",function(g){m._logger.log("trace","http request error:"+g.stack);k&&k(g);k=null});e.setTimeout(this.timeout,function(){m._logger.log("trace","http request timeout");k&&k(Error("http timeout"));k=null});c&&e.write(c);e.end()};c.prototype._doXMLRpcRequest=function(h,c,e){var g=require("x.xmlrpc.js");h='<?xml version="1.0" encoding="ISO-8859-1"?><methodCall><methodName>'+h+"</methodName><params>";for(var k=0;k<c.length;k++)h=c[k]&&c[k].type&&void 0!=c[k].value?h+
("<param>"+g.serializeValue(c[k].value,c[k].type)+"</param>"):h+("<param>"+g.serializeValue(c[k])+"</param>");this._doRequest("POST",h+"</params></methodCall>",function(k,l){if(k)e&&e(k);else if(l)try{var h=g.deserializeRsp(l);h.error?e&&e(Error("xml rcp return error:"+h.error.faultString+" @code:"+h.error.faultCode),h.error):e&&e(null,h.params)}catch(n){e&&e(n)}else e&&e(Error("xml rcp response format invalid"))})};c.prototype.convertHmIPKeyBase32ToBase16=function(h){h=h.replace(/-/g,"").toUpperCase();
var c="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),e=new ArrayBuffer(16);e=new Uint8Array(e);for(var g=0,k=h.length-1,p=0,l=e.length-1,q="";0<=k;){for(var n=0;n<c.length;n++)if(c[n]==h.charAt(k)){g|=n<<p;break}p+=5;for(k--;8<p&&0<=l;)e[l]=g&255,g>>=8,p-=8,l--}for(n=0;n<e.length;n++)16>e[n]&&(q+="0"),q+=e[n].toString(16);return q.toUpperCase()};c.prototype._getValue=function(h){var c=null;if(this.xml2js)if(h["boolean"]&&h["boolean"][0])c=parseInt(h["boolean"][0])?!0:!1;else if(h.i4&&h.i4[0])c=parseInt(h.i4[0]);
else if(h.double&&h.double[0])c=parseFloat(h.double[0]);else if(h.array&&h.array[0]&&h.array[0].data&&h.array[0].data[0]&&h.array[0].data[0].value){c=[];h=h.array[0].data[0].value;for(var e in h)c.push(h[e])}else c=h;else if(e=h,h=h.find("value"),0<h.length&&(e=$(h[0])),e&&(c=e.text(),!c&&e.children()&&0<e.children().length))if(h=$(e.children()[0]),"boolean"==h.prop("tagName"))c=parseInt(h.text())?!0:!1;else if("i4"==h.prop("tagName"))c=parseInt(h.text());else if("double"==h.prop("tagName"))c=parseFloat(h.text());
else if("array"==h.prop("tagName"))for(c=[],h=h.find("data value"),e=0;e<h.length;e++){var g=$(h[e]).text();g&&c.push(g)}else XC.debugf("unknown valuetype:"),XC.debugf(h.getXMLString());return c};c.prototype._getStructData=function(h){var c={};if(h.struct&&h.struct[0]&&h.struct[0].member){h=h.struct[0].member;for(var e in h)h[e].name&&h[e].name[0]&&h[e].value&&h[e].value[0]&&(c[h[e].name[0]]=this._getValue(h[e].value[0]))}return c};c.prototype._waitForNewDevices=function(h,c,e){var g=this;this.getDeviceList(function(k){if(0>=
c||Object.keys(k).length>Object.keys(h).length){for(var m in k)h[m]||XC.debugf("new device: "+m);e&&e(k)}else setTimeout(function(){g._waitForNewDevices(h,c-4,e)},4E3)})};c.prototype.init=function(h,c,e){this._doXMLRpcRequest("init",[h,c],function(g){e&&e(g)})};c.prototype.getIP=function(){return this.ip};c.prototype.getPort=function(){return this.port};c.prototype.setPort=function(h){this.port=h};c.prototype.getValue=function(h,c,e,g){h=[h,c];"undefined"!=typeof e&&null!=e&&h.push(e);this._doXMLRpcRequest("getValue",
h,function(e,h){var k=null;!e&&h?k=h[0]:e&&h&&(k=h);g&&g(e,k)})};c.prototype.setValue=function(h,c,e,g){this._doXMLRpcRequest("setValue",[h,c,e],function(e){g&&g(e)})};c.prototype.getParamset=function(h,c,e,g){this._doXMLRpcRequest("getParamset",[h,c,e],function(e,h){var k=null;!e&&h?k=h[0]:e&&h&&(k=h);g&&g(e,k)})};c.prototype.putParamset=function(h,c,e,g){this._doXMLRpcRequest("putParamset",[h,c,e],function(e,h){var k=null;!e&&h?k=h[0]:e&&h&&(k=h);g&&g(e,k)})};c.prototype.listDevices=function(h){this._doXMLRpcRequest("listDevices",
[],function(c,e){var g=[];!c&&e&&(g=e[0]);h&&h(c,g)})};c.prototype.deleteDevice=function(h,c,e){this._doXMLRpcRequest("deleteDevice",[h,c],function(g){e&&e(g)})};c.prototype.setInstallMode=function(h,c,e,g){var k=[];k.push(h);"undefined"!=typeof c&&null!=c&&k.push(c);"undefined"!=typeof e&&null!=e&&k.push(e);this._doXMLRpcRequest("setInstallMode",k,function(e){g&&g(e)})};c.prototype.setInstallModeWithWhitelist=function(h,c,e,g){var k=[];k.push(h);"undefined"!=typeof c&&null!=c&&k.push(c);"undefined"!=
typeof e&&null!=e&&k.push(e);this._doXMLRpcRequest("setInstallModeWithWhitelist",k,function(e){g&&g(e)})};c.prototype.addNewDevice=function(h){var c=this;this.getDeviceList(function(e){c._doRequest("setInstallMode",[!0,30,2],function(g){setTimeout(function(){c._waitForNewDevices(e,30,h)},4E3)})})};c.prototype.addNewDeviceWithSGTN=function(h,c,e){var g=this;this.getDeviceList(function(k){g._doRequest("setInstallModeWithWhitelist",[!0,30,[{ADDRESS:c,KEY_MODE:"LOCAL",KEY:e}]],function(e){setTimeout(function(){g._waitForNewDevices(k,
30,h)},4E3)})})};c.prototype.listBidcosInterfaces=function(h){this._doXMLRpcRequest("listBidcosInterfaces",[],function(c,e){var g=[];!c&&e&&(g=e[0]);h&&h(c,g)})};c.prototype.reportValueUsage=function(h,c,e,g){this._doXMLRpcRequest("reportValueUsage",[h,c,e],function(e,h){var k;!e&&h&&(k=h[0]);g&&g(e,k)})};c.prototype.ping=function(h,c){this._doXMLRpcRequest("ping",[h],function(e){c&&c(e)})};return c}();
x.hub.m.hm.Server=function(){var c=function(h){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Server");this._port=9099;h&&0<h&&(this._port=h);this._server=null;this._servlet={}};c.prototype.getPort=function(){return this._port};c.prototype.stop=function(h){this._server?this._server.close():h&&h()};c.prototype.start=function(h){if(this._server)h&&h();else{var c=h,e=this,g=require("http").createServer(function(g,h){e._logger.log("trace","receive request method:"+g.method);e._logger.log("trace",
"receive request path:"+g.url);e._logger.log("trace","receive request header:"+JSON.stringify(g.headers));var k="";g.on("data",function(g){k+=g.toString()});g.on("end",function(){e._logger.log("trace","receive request body:"+k);"POST"==g.method?e._handleRequest(k,g,h):(e._logger.log("trace","send 404 response"),h.writeHead(404,"Not found"),h.end())})});g.on("error",function(g){e._logger.log("trace","xmlrpc server err:"+g.stack);c&&c(g);c=null;e._server=null});g.listen(this._port,function(){e._logger.log("trace",
"xmlrpc server listening on port:"+e._port);e._server=g;c&&c();c=null})}};c.prototype.registServlet=function(h,c){h&&c&&(this._servlet[h]=c)};c.prototype.unregistServlet=function(h){h&&delete this._servlet[h]};c.prototype._handleRequest=function(h,c,e){var g=c.url,k=require("x.xmlrpc.js"),m=this;try{var l=k.deserializeReq(h);if("system.multicall"==l.methodName)this._handleMultiCall(l.params[0],c,e);else if(this._logger.log("debug","receive method call:"+l.methodName),this._logger.log("debug","params:"+
JSON.stringify(l.params)),"system.listMethods"==l.methodName)this._sendSuccessResponse(["event listDevices newDevices deleteDevices updateDevice replaceDevice readdedDevice".split(" ")],e);else if(this._servlet[g])this._servlet[g](l.methodName,l.params,function(g,k){g?m._sendErrorResponse(g,e):m._sendSuccessResponse([k],e)});else this._sendSuccessResponse([[]],e)}catch(q){this._sendErrorResponse(q,e)}};c.prototype._handleMultiCall=function(h,c,e){c=c.url;this._logger.log("trace","---------------------------------");
this._logger.log("trace","receive system.multicall");for(var g=0;g<h.length;g++){var k=h[g];this._logger.log("trace","receive method call:"+k.methodName);this._logger.log("trace","params:"+JSON.stringify(k.params));if(this._servlet[c])this._servlet[c](k.methodName,k.params)}this._logger.log("trace","---------------------------------");this._sendSuccessResponse([[]],e)};c.prototype._sendSuccessResponse=function(h,c){h=require("x.xmlrpc.js").serializeRsp(null,h);this._logger.log("trace","send xml success response:"+
h);c.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(h)+""});c.write(h);c.end()};c.prototype._sendErrorResponse=function(h,c){var e=require("x.xmlrpc.js"),g=-1;h.errCode&&(g=h.errCode);h=e.serializeRsp({faultCode:g,faultString:h.message});this._logger.log("trace","send xml fault response:"+h);c.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(h)+""});c.write(h);c.end()};return c}();
x.hub.m.hm._Controller=function(){var c=function(g,e,c,l,h,m){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller");this._client=new x.hub.m.hm.Client(g,e,c,l,h);this._initStates=m;this.interface=null;this._devices={};this._status={};this._learnDeviceCbs=[];this._learnDeviceTO=null;this._readValueCbs={}};util.inherits(c,EventEmitter);c.prototype.getIP=function(){return this._client.getIP()};c.prototype.getPort=function(){return this._client.getPort()};c.prototype.setPort=function(g){return this._client.setPort(g)};
c.prototype.getAllBufferedStates=function(){var g={},e;for(e in this._devices){var c=this._devices[e];!c.PARENT&&c.CHILDREN?g[e]={device:{type:c.TYPE,"interface":this.interface,address:c.ADDRESS,channels:{}},states:{}}:c.PARENT&&(g[c.PARENT].device.channels[c.ADDRESS]={type:c.TYPE,address:c.ADDRESS});if(c.CHILDREN)for(var l=0,h=c.CHILDREN.length;l<h;l++){var m=c.CHILDREN[l];if(this._status[m]){g[e].states[m]={};for(var r in this._status[m])g[e].states[m][r]=this._status[m][r]}}}return g};c.prototype.getBufferedState=
function(g){if(!g)return null;var e=g.indexOf(":");-1!=e&&(g=g.substr(0,e));g=this._devices[g];if(!g)return null;var c={};if(g.CHILDREN){var l=this;g.CHILDREN.forEach(function(g){if(l._status[g]){c[g]={};for(var e in l._status[g])c[g][e]=l._status[g][e]}})}return c};c.prototype.getBufferedDevices=function(){return this._getDeviceStructs(this._devices)};c.prototype.getState=function(g,e,c){var k=this.getBufferedState(g);if(k&&k[g]&&k[g][e]){k=k[g][e];var h=k.value;if("undefined"!=typeof h&&null!=h){c&&
c(null,k);return}}this.updateState(g,e,function(g,e){c&&c(g,e)})};c.prototype.updateState=function(g,e,c){var k=this;this.readValue(g,e,function(l,h){l?setTimeout(function(){var l,h=k.getBufferedState(g);h&&h[g]&&h[g][e]&&(l=h[g][e]);c&&c(null,l)},1E3):c&&c(null,{value:h,time:(new Date).getTime()})})};c.prototype.reset=function(g){var e=[];Object.keys(this._devices).forEach(function(g){g&&-1==g.indexOf(":")&&"BidCoS-RF"!=g&&e.push(g)});if(0==e.length)g&&g();else{var c=0,l=this,h=function(k){c++;c<
e.length?l.deleteDevice(e[c],h):g&&g()};this.deleteDevice(e[c],h)}};c.prototype.register=function(g,e,c){if(g){this._logger.log("debug","register:"+e+" to "+g);var k=this;this._client.init(g,e,function(g){k._logger.log("debug","registed:"+e+(g?" err:"+g.message:""));c&&c(g,g?null:e)})}else c&&c(Error("arguments invalid"))};c.prototype.unregister=function(g,e){g?this._client.init(g,"",function(g){e&&e(g)}):e&&e(Error("url invalid"))};c.prototype.getDevices=function(g){this._client.listDevices(function(e,
c){if(e)g&&g(e);else for(e=0;e<c.length;e++);})};c.prototype.learnNewDevice=function(g){var e=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==e){var c=this;this._learnDeviceTO=setTimeout(function(){var g=c._learnDeviceCbs;c._learnDeviceCbs=[];for(var e=0;e<g.length;e++){var k=g[e];k&&k(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,1,function(g){if(g){c._learnDeviceTO&&(clearTimeout(c._learnDeviceTO),c._learnDeviceTO=
null);var e=c._learnDeviceCbs;c._learnDeviceCbs=[];for(var k=0;k<e.length;k++){var l=e[k];l&&l(g)}}})}};c.prototype.learnNewDeviceSN=function(g,e){var k=this._learnDeviceCbs.length;e&&-1==this._learnDeviceCbs.indexOf(e)&&this._learnDeviceCbs.push(e);if(0==k){var c=this;this._learnDeviceTO=setTimeout(function(){var g=c._learnDeviceCbs;c._learnDeviceCbs=[];for(var e=0;e<g.length;e++){var k=g[e];k&&k(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,g,function(g){if(g){c._learnDeviceTO&&
(clearTimeout(c._learnDeviceTO),c._learnDeviceTO=null);var e=c._learnDeviceCbs;c._learnDeviceCbs=[];for(var k=0;k<e.length;k++){var l=e[k];l&&l(g)}}})}};c.prototype.learnNewIPDevice=function(g,e,c){var k=this._learnDeviceCbs.length;c&&-1==this._learnDeviceCbs.indexOf(c)&&this._learnDeviceCbs.push(c);if(0==k){var h=this;this._learnDeviceTO=setTimeout(function(){var g=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var e=0;e<g.length;e++){var k=g[e];k&&k(Error("learn device timeout"))}},6E4);g={ADDRESS:g.replace(/-/g,
"").toUpperCase(),KEY_MODE:"LOCAL",KEY:this._convertHmIPKeyBase32ToBase16(e)};this._client.setInstallModeWithWhitelist(!0,60,[g],function(g){if(g){h._learnDeviceTO&&(clearTimeout(h._learnDeviceTO),h._learnDeviceTO=null);var e=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var k=0;k<e.length;k++){var c=e[k];c&&c(g)}}})}};c.prototype.learnNewIPDeviceQR=function(g,e){var k=this._learnDeviceCbs.length;e&&-1==this._learnDeviceCbs.indexOf(e)&&this._learnDeviceCbs.push(e);if(0==k){var c=this;this._learnDeviceTO=
setTimeout(function(){var g=c._learnDeviceCbs;c._learnDeviceCbs=[];for(var e=0;e<g.length;e++){var k=g[e];k&&k(Error("learn device timeout"))}},3E4);e=g.substr(6,24);g=g.substring(g.length-32,g.length);g={ADDRESS:e.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:g.toUpperCase()};this._client.setInstallModeWithWhitelist(!0,30,[g],function(g){if(g){c._learnDeviceTO&&(clearTimeout(c._learnDeviceTO),c._learnDeviceTO=null);var e=c._learnDeviceCbs;c._learnDeviceCbs=[];for(var k=0;k<e.length;k++){var h=
e[k];h&&h(g)}}})}};c.prototype.deleteDevice=function(g,e){if(g){var k=g.indexOf(":");-1!=k&&(g=g.substr(0,k));this._client.deleteDevice(g,2,e)}else e&&e(Error("address is empty"))};c.prototype.readValue=function(g,e,c){var k=g+"."+e,h=this._readValueCbs[k];h||(h=[],this._readValueCbs[k]=h);var m=h.length;c&&-1==h.indexOf(c)&&h.push(c);if(0==m){var p=this;this._client.getValue(g,e,null,function(c,h){c||p._updateStatusBuffer(g,e,h);var l=p._readValueCbs[k];delete p._readValueCbs[k];l.forEach(function(g){g&&
g(c,h)})})}};c.prototype.writeValue=function(g,e,c,h){var k=this;this._client.setValue(g,e,c,function(l){l||k._updateStatusBuffer(g,e,c.type?c.value:c);h&&h(l)})};c.prototype.getValuesParamset=function(g,e){this._logger.log("trace","getValuesParamset:"+g);var k=this;this._client.getParamset(g,"VALUES",0,function(c,h){if(c)k._logger.log("trace","getValuesParamset error:"+c.message),e&&e(c);else{if(h){c=0;var l=g.indexOf(":");-1!=l&&(c=g.substr(l+1));for(var m in h)h.hasOwnProperty(m)&&(0==c?"INSTALL_MODE"!=
m&&k._updateStatusBuffer(g,m,h[m]):k._updateStatusBuffer(g,m,h[m]))}k._logger.log("trace","getValuesParamset finish:"+JSON.stringify(h));e&&e(null,h)}})};c.prototype.getParamset=function(g,e,c){this._client.getParamset(g,e,0,function(e,g){c&&c(e,g)})};c.prototype.setParamset=function(e,k,c,h){this._client.putParamset(e,k,c,function(e){h&&h(e)})};c.prototype.reportValueUsage=function(e,k,c,h){this._client.reportValueUsage(e,k,c,function(e,g){h&&h(e,g)})};c.prototype.getDevice=function(e){if(!e)return null;
var g=e,c=e.indexOf(":");-1!=c&&(g=e.substr(0,c));if(!this._devices[g])return null;var h=[];e=this._devices[g];h.push(e);if(e.CHILDREN){var m=this;e.CHILDREN.forEach(function(e){e&&m._devices[e]&&h.push(m._devices[e])})}return(e=this._getDeviceStructs(h))?e[g]:null};c.prototype._getDeviceStructs=function(e){if(!e)return null;var g={},c=this;e.forEach(function(e){if(e.ADDRESS&&e.TYPE)if(!e.PARENT&&e.CHILDREN)g[e.ADDRESS]={type:e.TYPE,"interface":c.interface,address:e.ADDRESS,channels:{}};else if(e.PARENT){var k=
g[e.PARENT];k&&(k.channels[e.ADDRESS]={type:e.TYPE,address:e.ADDRESS})}});return g};c.prototype._updateStatusBuffer=function(e,k,c,h){if("CENTRAL"!=e||"PONG"!=k){if("PRESS_SHORT"==k||"PRESS_LONG"==k||"PRESS_CONT"==k||"PRESS_LONG_RELEASE"==k){var g={};h={value:c,time:(new Date).getTime()};var l=!0}else{var m=this._status[e];m||(m={},this._status[e]=m);g=m[k];g||(g={},m[k]=g);h={value:c,time:h?h:(new Date).getTime()};g&&g.time&&h&&h.time&&g.time>h.time?l=!1:(m[k]=h,l=!0)}m=this.getDevice(e);l&&this.emit("event",
{device:m,"interface":this.interface,channel:e,datapoint:k,value:h,changed:g.value!=h.value,oldValue:g});g=e.indexOf(":");-1!=g&&(h=e.substr(0,g),"1"==e.substr(g+1)&&"STATE"==k&&0==c&&m&&m.channels&&m.channels[h+":2"]&&"POWERMETER"==m.channels[h+":2"].type&&(this._updateStatusBuffer(h+":2","POWER",0),this._updateStatusBuffer(h+":2","CURRENT",0)))}};c.prototype._initNewDeviceStates=function(e,k){if(this._initStates){var g=this,c=function(e,k){e.ADDRESS&&e.PARAMSETS&&-1!=e.PARAMSETS.indexOf("VALUES")?
g.getValuesParamset(e.ADDRESS,k):k()},h=0,m=function(){h++;h<e.length?c(e[h],m):k&&k()};c(e[h],m)}else k&&k()};c.prototype._convertHmIPKeyBase32ToBase16=function(e){e=e.replace(/-/g,"").toUpperCase();var g="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),c=new ArrayBuffer(16);c=new Uint8Array(c);for(var h=0,m=e.length-1,n=0,r=c.length-1,v="";0<=m;){for(var u=0;u<g.length;u++)if(g[u]==e.charAt(m)){h|=u<<n;break}n+=5;for(m--;8<n&&0<=r;)c[r]=h&255,h>>=8,n-=8,r--}for(u=0;u<c.length;u++)16>c[u]&&(v+="0"),
v+=c[u].toString(16);return v.toUpperCase()};c.prototype._xmlrpcCall=function(e,k,c){this._logger.log("trace","receive call:"+e);this._logger.log("trace","params:"+JSON.stringify(k));var g=[],h;switch(e){case "newDevices":if(k[1]){this._initNewDeviceStates(k[1],null);for(h=0;h<k[1].length;h++)(e=k[1][h])&&e.ADDRESS&&(this._devices[e.ADDRESS]=e);e=this._getDeviceStructs(k[1]);try{this.emit("newDevices",e)}catch(r){}if(!k[1]||!k[1][0]||"HM-RCV-50"!=k[1][0].TYPE)for(k=this._learnDeviceCbs,this._learnDeviceCbs=
[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<k.length&&this._client.setInstallMode(!1,null,null,null),h=0;h<k.length;h++){var m=k[h];m&&m(null,e)}}break;case "readdedDevice":if(k[1]&&k[1][0])for(h=this.getDevice(k[1][0]),e={},e[k[1][0]]=h,k=this._learnDeviceCbs,this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<k.length&&this._client.setInstallMode(!1,null,null,null),h=0;h<k.length;h++)(m=k[h])&&m(null,
e);break;case "listDevices":if(k[1]){k=[];for(h in this._devices)this._devices.hasOwnProperty(h)&&this._devices[h]&&k.push(this._devices[h]);g.push(k)}break;case "deleteDevices":if(k[1])for(h=0;h<k[1].length;h++)if(e=k[1][h])delete this._devices[e],delete this._status[e];break;case "event":this._logger.log("trace","get event:"+JSON.stringify(k)),this._updateStatusBuffer(k[1],k[2],k[3])}c&&c(null,g)};var h=function(e,k,c,h,m,n){x.hub.m.hm._Controller.call(this,e,k,c,h,m,n);this.interface="BidCos-RF";
this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.RF")};h.prototype=new c;h.prototype.constructor=h;h.prototype.listBidcosInterfaces=function(e){this._client.listBidcosInterfaces(function(g,c){e&&e(g,c)})};h.prototype.ping=function(e,k){this._client.ping(e,function(e){k&&k(e)})};var m=function(e,k,c,h,m,n){x.hub.m.hm._Controller.call(this,e,k,c,h,m,n);this.interface="BidCos-Wired";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.Wired")};util.inherits(m,c);var e=
function(e,k,c,h,m,n){x.hub.m.hm._Controller.call(this,e,k,c,h,m,n);this.interface="HmIP-RF";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IP")};util.inherits(e,c);e.prototype.deleteDevice=function(e,k){var g=e.indexOf(":");-1!=g&&(e=e.substr(0,g));this._client.deleteDevice(e,2,k)};c.getController=function(g,k,c){switch(g){case "BidCos-RF":g=h;break;case "BidCos-Wired":g=m;break;case "HmIP-RF":g=e;break;default:return null}return new g(k.ip,k.port,k.username,k.password,c.useHttps,
c.initStates)};return c}();
x.hub.m.hm.Monitor=function(){var c=function(e,g,k){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.ControllerMonitor");this._type=k;this._monitor=e;this._controller=g;this._xmlrpcServer=null;this._retryWait=1E4;this._retryCount=0;this._retryTO=null;this._state=0;this._err=null};c.prototype.start=function(e,g){0==this._state&&(this._xmlrpcServer=e,this._connect(e));g&&g()};c.prototype.stop=function(e,g){var k=this._state;this._retryTO&&clearTimeout(this._retryTO);this._retryTO=null;
this._state=0;this._err=null;this._retryCount=0;0!=k?this._unregister(e,function(){g&&g()}):g&&g()};c.prototype.getMonitorState=function(){return{state:this._state,error:this._err?this._err.message:null}};c.prototype._connect=function(){this._logger.log("info","start regist "+this._type+" monitor at "+this._controller.getIP()+":"+this._controller.getPort());this._state=1;var e=this;this._register(this._xmlrpcServer,function(g){g?(e._logger.log("warn","regist "+e._type+" monitor at "+e._controller.getIP()+
":"+e._controller.getPort()+" error:"+g.message),e._state=3,e._err=g,e._retryCount++,e._retryTO=setTimeout(function(){e._logger.log("trace","retry timeout for regist "+e._type+" monitor at "+e._controller.getIP()+":"+e._controller.getPort()+" expired");e._connect()},Math.min(6E4,Math.ceil(e._retryCount/10)*e._retryWait))):(e._logger.log("info","regist "+e._type+" monitor at "+e._controller.getIP()+":"+e._controller.getPort()+" success"),e._state=2,e._err=null,e._retryCount=0,e._monitor._onControllerMonitorConnected(e._type))})};
c.prototype._register=function(e,g){var k=this._monitor.localMac.replace(/:/g,""),c="/"+this._monitor.serialNumber;e=e.getPort();this._controller.register("http://"+this._monitor.localIP+":"+(e?e:80)+c,this._monitor.serialNumber+"_"+this._controller.getPort()+"_"+k,g)};c.prototype._unregister=function(e,g){var k="/"+this._monitor.serialNumber;e=e.getPort();this._controller.unregister("http://"+this._monitor.localIP+":"+(e?e:80)+k,g)};var h=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.PinPongHandler");
this._monitor=e;this._pingWait=3E4;this._pingTO=null;this._pingMiss=0};h.prototype.start=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._startPingTO()};h.prototype.stop=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0};h.prototype._startPingTO=function(){var e=this;this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingTO=setTimeout(function(){e._pingMiss++;4>e._pingMiss?(e._ping(),e._startPingTO()):
e._pingFail()},this._pingWait)};h.prototype._ping=function(e){var g=this._monitor._rfController;g?(this._logger.log("trace","send PING"),g.ping(this._monitor.localMac,function(g){e&&e(g)})):e&&e(Error("no rf controller for ping"))};h.prototype._pingFail=function(){this._logger.log("warn","PING Fail");this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._monitor._onPingFail()};h.prototype._onPong=function(){this._pingMiss=0};var m=function(e,g){this.ip=e.ip;this.serialNumber=
e.uuid;this.ccuType=e.type;this.ccuType||(this.ccuType=2);this.localIP=g?g.localIP:null;this.localMac=g?g.localMac:null;this.isChip=g?"chip"==g.localChip:!1;this.isCCU3=g?"ccu3"==g.localChip:!1;this.persistant=g?g.persistant:!1;this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor");e={ip:this.ip,port:null,username:e.username,password:e.password};g={useHttps:!1,initStates:this.isChip?!0:!1};e.port=this.isCCU3?32001:2001;this._rfController=x.hub.m.hm._Controller.getController("BidCos-RF",
e,g);this._rfController.on("event",this._onEvent.bind(this));this._rfController.on("newDevices",this._onNewDevices.bind(this));e.port=this.isCCU3?32010:2010;this._ipController=x.hub.m.hm._Controller.getController("HmIP-RF",e,g);this._ipController.on("event",this._onEvent.bind(this));this._ipController.on("newDevices",this._onNewDevices.bind(this));e.port=this.isCCU3?32E3:2E3;this._wiredController=x.hub.m.hm._Controller.getController("BidCos-Wired",e,g);this._wiredController.on("event",this._onEvent.bind(this));
this._wiredController.on("newDevices",this._onNewDevices.bind(this));this._wiredMonitor=this._ipMonitor=this._rfMonitor=null;this._pingpong=new h(this);this._pingTO=this._manager=this._xmlrpcServer=null;this._pingMiss=0;this._wiredRegisted=this._ipRegisted=this._rfRegisted=!1;this._reconnectTO=null;this._reconnectCount=0};util.inherits(m,EventEmitter);m.prototype.getMonitorState=function(e){var g={chip:this.isChip};if(this._rfMonitor){var k=this._rfMonitor.getMonitorState();g.bidcos=k}this._ipMonitor&&
(k=this._ipMonitor.getMonitorState(),g.hmip=k);this._wiredMonitor&&(k=this._wiredMonitor.getMonitorState(),g.bidcos_wired=k);g.bidcos&&2==g.bidcos.state?this._rfController.listBidcosInterfaces(function(k,c){c&&(g.info=c);e&&e(null,g)}):e&&e(null,g)};m.prototype.getAllBufferedStates=function(){var e={},g,k=this._rfController.getAllBufferedStates();if(k)for(g in k)k.hasOwnProperty(g)&&(e[g]=k[g]);if(k=this._wiredController.getAllBufferedStates())for(g in k)k.hasOwnProperty(g)&&(e[g]=k[g]);if(k=this._ipController.getAllBufferedStates())for(g in k)k.hasOwnProperty(g)&&
(e[g]=k[g]);return e};m.prototype.getBufferedDevice=function(e,g){switch(e){case "BidCos-RF":e=this._rfController;break;case "BidCos-Wired":e=this._wiredController;break;case "HmIP-RF":e=this._ipController;break;default:return null}return e.getDevice(g)};m.prototype.getState=function(e,g){if(!(e&&e.interface&&e.channel&&e.datapoint))return g&&g(Error("argument invalid")),null;switch(e.interface){case "BidCos-RF":var k=this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=
this._ipController;break;default:return null}k.getState(e.channel,e.datapoint,g)};m.prototype.updateState=function(e,g){if(!(e&&e.interface&&e.channel&&e.datapoint))return g&&g(Error("argument invalid")),null;switch(e.interface){case "BidCos-RF":var k=this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;default:return null}k.updateState(e.channel,e.datapoint,g)};m.prototype.init=function(e,g){this._logger.log("info","init monitor ("+
this.ip+")");this._xmlrpcServer=e;this._init(g)};m.prototype._init=function(e){var g=this;this.getSerialNumber(function(k){k?e&&e(k):g.register(g._xmlrpcServer,function(){e&&e()})})};m.prototype.update=function(e,g,k,c){k&&this.serialNumber!=k&&(this.serialNumber=k);var h=this;e&&this.ip!=e||g&&this.localIP!=g?this.unregister(this._xmlrpcServer,function(){h.ip=e;h.localIP=g;h.register(h._xmlrpcServer,c)}):c&&c()};m.prototype.finalize=function(e){this.removeAllListeners();this._manager&&this._manager.deleteMonitor(this.ip);
this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);this.unregister(this._xmlrpcServer,function(){e&&e()})};m.prototype.getSerialNumber=function(e){var g=this;global&&"CCU3"==global.PLATFORM?(this._rfController.setPort(32001),g.getRFInterfaces(function(k,c){k?(g._rfController.setPort(2001),g.getRFInterfaces(function(k,c){k?e&&e():(g.serialNumber=c[0].ADDRESS,e&&e(null,g.serialNumber))})):(g._ipController.setPort(32010),
g._wiredController.setPort(32E3),g.serialNumber=c[0].ADDRESS,e&&e(null,g.serialNumber))})):this.getRFInterfaces(function(k,c){k?e&&e():(g.serialNumber=c[0].ADDRESS,e&&e(null,g.serialNumber))})};m.prototype.getRFInterfaces=function(e){this._rfController.listBidcosInterfaces(function(g,k){e&&e(g,k)})};m.prototype.register=function(e,g){var k=this;e.registServlet("/"+this.serialNumber,function(e,g,c){k._xmlrpcCall(e,g,c)});this._rfMonitor=new c(this,this._rfController,"rf");this._ipMonitor=new c(this,
this._ipController,"ip");this._wiredMonitor=new c(this,this._wiredController,"wired");this._rfMonitor.start(e);this._ipMonitor.start(e);this.isChip||this._wiredMonitor.start(e);g&&g()};m.prototype.unregister=function(e,g){e.unregistServlet("/"+this.serialNumber);this._rfMonitor.stop(e);this._ipMonitor.stop(e);this.isChip||this._wiredMonitor.stop(e);g&&g()};m.prototype._onControllerMonitorConnected=function(e){"rf"==e&&this._pingpong.start()};m.prototype._onPingFail=function(){var e=this;this.unregister(this._xmlrpcServer,
function(){e.register(e._xmlrpcServer,function(){})})};m.prototype._onPong=function(){this._pingpong._onPong()};m.prototype.reset=function(e){var g=this;this._rfController.reset(function(){g._ipController.reset(function(){g._wiredController.reset(function(){e&&e()})})})};m.prototype.learnRF=function(e){this._rfController.learnNewDevice(function(g,k){e&&e(g,k)})};m.prototype.learnRFSN=function(e,g){this._rfController.learnNewDeviceSN(e,function(e,c){g&&g(e,c)})};m.prototype.learnIP=function(e,g,k){this._ipController.learnNewIPDevice(e,
g,function(e,g){k&&k(e,g)})};m.prototype.learnIPQR=function(e,g){this._ipController.learnNewIPDeviceQR(e,function(e,c){g&&g(e,c)})};m.prototype.deleteDevice=function(e,g,k){if(!e||!g)return k&&k(Error("argument invalid")),null;switch(e){case "BidCos-RF":e=this._rfController;break;case "BidCos-Wired":e=this._wiredController;break;case "HmIP-RF":e=this._ipController;break;default:k&&k(Error("no such interface"));return}e.deleteDevice(g,k)};m.prototype.getDevices=function(e){var g=0;this._rfController&&
g++;this._ipController&&g++;this._wiredController&&g++;var k=[],c=function(c){g--;c?e&&e(c):0==g&&e&&e(null,k)},h=this;this._rfController&&this._rfController.getBufferedDevices(function(e,g){e?(c&&c(e),c=null):(k=k.concat(h._parseDevices(g,"BidCos-RF")),c&&c())});this._ipController&&this._ipController.getBufferedDevices(function(e,g){e?(c&&c(e),c=null):(k=k.concat(h._parseDevices(g,"HmIP-RF")),c&&c())});this._wiredController&&this._wiredController.getBufferedDevices(function(e,g){e?(c&&c(e),c=null):
(k=k.concat(h._parseDevices(g,"BidCos-Wired")),c&&c())})};m.prototype.getParamset=function(e,g,c,h){if(e&&g&&c){var k=null;switch(e){case "BidCos-RF":k=this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;default:h&&h(Error("unknow interface"));return}k.getParamset(g,c,function(e,g){h&&h(e,g)})}else h&&h(Error("argument invalid"))};m.prototype.setParamset=function(e,g,c,h,l){if(e&&g&&c&&h){var k=null;switch(e){case "BidCos-RF":k=this._rfController;
break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;default:l&&l(Error("unknow interface"));return}k.setParamset(g,c,h,function(e,g){l&&l(e,g)})}else l&&l(Error("argument invalid"))};m.prototype.readValue=function(e,g,c,h){if(e&&g&&c){var k=null;switch(e){case "BidCos-RF":k=this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;default:h&&h(Error("unknow interface"));return}k.readValue(g,c,
function(e,g){h&&h(e,g)})}else h&&h(Error("argument invalid"))};m.prototype.writeValue=function(e,g,c,h,l){if(e&&g&&c){var k=null;switch(e){case "BidCos-RF":k=this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;default:l&&l(Error("unknow interface"));return}k.writeValue(g,c,h,function(e){l&&l(e)})}else l&&l(Error("argument invalid"))};m.prototype.reportValueUsage=function(e,g,c,h){if(e&&g&&c){var k=null;switch(e){case "BidCos-RF":k=
this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;default:h&&h(Error("unknow interface"));return}k.reportValueUsage(g,c,1,function(e,g){h&&h(e,g)})}else h&&h(Error("argument invalid"))};m.prototype.updateStatusBuffer=function(e,g,c,h,l){if(e&&g&&c){switch(e){case "BidCos-RF":e=this._rfController;break;case "BidCos-Wired":e=this._wiredController;break;case "HmIP-RF":e=this._ipController;break;default:return}e._updateStatusBuffer(g,
c,h,l)}};m.prototype._parseDevices=function(e,g){g||(g="BidCos-RF");var c=new (require("xnm.aio.hm.js").CCU),h={},l;for(l in e)if(e.hasOwnProperty(l)){var m=e[l],n={typename:"DEVICE",hsstype:m.TYPE,address:m.ADDRESS,interface:g,rfAddr:m.RF_ADDRESS,channels:{}};if(m.CHILDREN)for(var r=0,v=m.CHILDREN.length;r<v;r++){var u=m.CHILDREN[r];n.channels[u]={hsstype:e[u].TYPE,address:u}}h[l]=n}return c._parseDevices(h)};m.prototype._xmlrpcCall=function(e,g,c){this._logger.log("trace","receive call:"+e);this._logger.log("trace",
"params:"+JSON.stringify(g));if("event"==e&&"CENTRAL"==g[1]&&"PONG"==g[2])this._onPong(),c&&c(null,[]);else{var h=g[0].split("_");3<=h.length?(h=h[1],-1!=h.indexOf("2001")&&this._rfController?this._rfController._xmlrpcCall(e,g,c):-1!=h.indexOf("2010")&&this._ipController?this._ipController._xmlrpcCall(e,g,c):-1!=h.indexOf("2000")&&this._wiredController?this._wiredController._xmlrpcCall(e,g,c):c&&c(null,[])):c&&c(null,[])}};m.prototype._onNewDevices=function(e){this._logger.log("debug","find new devices");
this._logger.log("debug",JSON.stringify(e));this.emit("new_devices",e)};m.prototype._onEvent=function(e){this._logger.log("trace","receive event:"+JSON.stringify(e));this._logger.log("debug","EVENT:\t"+e.interface+"\t"+e.device.type+"\t"+e.channel+"\t"+e.datapoint+"\t"+e.value.value);e.ip=this.ip;e.serialNumber=this.serialNumber;this.emit("event",e,this)};return m}();
x.hub.m.hm.MonitorManager=function(){var c=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.MonitorManager");this._monitors=[];this._xmlrpcServer=null;this._tmpMonitors={};this._monitorEvtListener=this.onDeviceEvent.bind(this)};c.prototype.init=function(c,m){this._xmlrpcServer=c;m&&m()};c.prototype.startMonitorForIP=function(c,m,e){this.startMonitor({ip:c},{localIP:m},e)};c.prototype.startMonitor=function(c,m,e){if(this._xmlrpcServer)if(c&&c.ip){var g=this.getMonitor(c.ip,c.uuid);
if(g)e&&e();else if(m||(m={}),m.localIP||(m.localIP=x.hub.m.hm._Util.getLocalIP(null,c.ip)),m.localIP){m.localMac||(m.localMac=x.hub.m.hm._Util.getLocalMac(m.localIP));var k=c.ip;this._tmpMonitors[k]||(this._tmpMonitors[k]=[]);var h=this._tmpMonitors[k].length,l=this._tmpMonitors[k];e||(e=function(){});-1==l.indexOf(e)&&l.push(e);if(!(0<h)){var q=this;g=new x.hub.m.hm.Monitor(c,m);g._manager=this;g.init(this._xmlrpcServer,function(e){e||(q._monitors.push(g),g.on("event",q._monitorEvtListener));var c=
q._tmpMonitors[k];delete q._tmpMonitors[k];c.forEach(function(g){g&&g(e)})})}}else e&&e(Error("local ip address invalid"))}else e&&e(Error("gateway invalid"));else e&&e(Error("xml rpc server not started"))};c.prototype.getAllMonitor=function(){return this._monitors};c.prototype.getMonitor=function(c,m){var e=null,g=null;this._monitors.forEach(function(k){k&&k.ip==c&&(e=k);k&&k.serialNumber==m&&(g=k)});return g?g:e};c.prototype.getMonitorStates=function(c){if(0==this._monitors.length)c&&c(null,[]);
else{var h=this,e=0,g=[],k=function(m,l){!m&&l&&(l.ip=h._monitors[e].ip,l.serialNumber=h._monitors[e].serialNumber,g.push(l));e++;e<h._monitors.length?h._monitors[e].getMonitorState(k):c&&c(null,g)};this._monitors[e].getMonitorState(k)}};c.prototype.deleteMonitor=function(c){for(var h=-1,e=0,g=this._monitors.length;e<g;e++){var k=this._monitors[e];if(k&&k.ip==c){h=e;break}}-1!=e&&this._monitors.splice(h,1)};c.prototype.onFindHomeMatic=function(c,m,e){var g=this.getMonitor(null,e),k=this.getMonitor(c);
k?(k.update(c,m,e),g&&g!=k&&(g.finalize(),this.deleteMonitor(g.ip))):(g&&(g.finalize(),this.deleteMonitor(g.ip)),this.startMonitorForIP(c,m))};c.prototype.onDeviceEvent=function(c,m){require("x.hub.m.hm.js").onDeviceEvent(c,m.isChip)};return c}();
x.hub.m.hm._Channel=function(){var c=function(){var e=[];this.map.forEach(function(g){g&&g.dpt&&g.state&&0<g.state.length&&-1==e.indexOf(g.dpt)&&e.push(g.dpt)});return e},h=function(e){var g=null;this.map.forEach(function(c){c&&c.dpt&&c.state&&-1!=c.state.indexOf(e)&&(g=c.dpt)});return g},m=function(e){var g=null;this.map.forEach(function(c){c&&c.dpt&&c.command&&-1!=c.command.indexOf(e)&&(g=c.dpt)});return g};return{"HmIP-RF":{MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},
{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){switch(e){case "UNREACH":return{timeout:g};case "LOW_BAT":return{lowbat:g};case "SABOTAGE":return{sabotage:g}}return null}},MAINTENANCE_BAT_EL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",
state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){switch(e){case "UNREACH":return{timeout:g};case "LOW_BAT":return{lowbat:g};case "SABOTAGE":return{sabotage:g};case "OPERATING_VOLTAGE":return{voltage:parseFloat(g)};case "ERROR_CODE":return{errorCode:parseInt(g)};case "SENSOR_ERROR":return{sensorError:g}}return null}},MAINTENANCE_BAT_CL:{map:[{dpt:"UNREACH",
state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){switch(e){case "UNREACH":return{timeout:g};case "LOW_BAT":return{lowbat:g}}return null}},SWITCH_TRANSMITTER:{map:[{dpt:"STATE",state:["switchTState"],event:["switchTState"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "STATE":c=1==g?{switchTState:"on"}:0==g?{switchTState:"off"}:{switchTState:"?"}}return c}},
SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"STATE",state:["switchState"],event:["switchState"],command:["on","off","toggle"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "STATE":c=1==g?{switchState:"on"}:0==g?{switchState:"off"}:{switchState:"?"}}return c},executeCommand:function(e,g,c,h,l){var k=m.call(this,h);"onFor"==h.substr(0,5)&&(k="STATE");if(k)switch(h){case "on":e.writeValue(g,c,k,!0,l);break;case "off":e.writeValue(g,c,k,!1,l);break;case "toggle":e.getState({interface:g,
channel:c,datapoint:k},function(h,m){h?l&&l(h):m?(h=!0,m.value&&(h=!1),e.writeValue(g,c,k,h,l)):l&&l(Error("get switch current value return invalid"))});break;default:"onFor"==h.substr(0,5)?(h=parseFloat(h.substr(5)),isNaN(h)?l&&l(Error("onFor command invalid")):(k="ON_TIME",e.writeValue(g,c,k,{type:"double",value:h},function(h){h?l&&l(h):(k="STATE",e.writeValue(g,c,k,!0,l))}))):l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+h))}},ENERGIE_METER_TRANSMITTER:{map:[{dpt:"ENERGY_COUNTER",
state:["meterEnergyCounter"],event:["meterEnergyCounter"]},{dpt:"POWER",state:["meterPower"],event:["meterPower"]},{dpt:"CURRENT",state:["meterCurrent"],event:["meterCurrent"]},{dpt:"VOLTAGE",state:["meterVoltage"],event:["meterVoltage"]},{dpt:"FREQUENCY",state:["meterFrequency"],event:["meterFrequency"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){switch(e){case "ENERGY_COUNTER":return{meterEnergyCounter:parseFloat(g).toFixed(2)};case "POWER":return{meterPower:parseFloat(g).toFixed(2)};
case "CURRENT":return{meterCurrent:parseFloat(g).toFixed(2)};case "VOLTAGE":return{meterVoltage:parseFloat(g).toFixed(2)};case "FREQUENCY":return{meterFrequency:parseFloat(g).toFixed(2)}}return null}},DIMMER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["dimmerTLevel"],event:["dimmerTLevel"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "LEVEL":c={dimmerTLevel:Math.round(100*parseFloat(g))};break;case "COLOR":c={dimmerTColor:"off blue green torqoise red purple yellow white".split(" ")[parseInt(g)]}}return c}},
DIMMER_VIRTUAL_RECEIVER:{map:[{dpt:"LEVEL",state:["dimmerLevel"],event:["dimmerLevel"],command:["dimOff","dimUp","dimDown","dimTo","toggleTo"]},{dpt:"COLOR",state:["dimmerColor"],event:["dimmerColor"],command:["colorTo"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "LEVEL":c={dimmerLevel:Math.round(100*parseFloat(g))}}return c},executeCommand:function(e,g,c,h,l){if(h){if("dimOff"==h.substr(0,6))var k="dimOff";else if("dimUp"==h.substr(0,5)){k="dimUp";
var n=h.substr(5)}else if("dimDown"==h.substr(0,7))k="dimDown",n=h.substr(7);else if("dimTo"==h.substr(0,5)){if(k="dimTo",n=h.substr(5),!n){l&&l(Error("dimTo has no value"));return}}else if("toggleTo"==h.substr(0,8)){if(k="toggleTo",n=h.substr(8),!n){l&&l(Error("toggleTo has no value"));return}}else if("colorTo"==h.substr(0,7)&&(k="colorTo",n=h.substr(7),!n)){l&&l(Error("colorTo has no value"));return}var p=m.call(this,k);if(p)switch(k){case "dimOff":e.writeValue(g,c,p,{type:"double",value:0},l);
break;case "dimUp":n||(n=10);n=parseInt(n)/100;e.getState({interface:g,channel:c,datapoint:p},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(n=k.value+n,1<n&&(n=1),e.writeValue(g,c,p,{type:"double",value:n},l))});break;case "dimDown":n||(n=10);n=parseInt(n)/100;e.getState({interface:g,channel:c,datapoint:p},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(n=k.value-n,0>n&&
(n=0),e.writeValue(g,c,p,{type:"double",value:n},l))});break;case "toggleTo":n=parseInt(n)/100;e.getState({interface:g,channel:c,datapoint:p},function(h,k){h?l&&l(h):k?(k.value&&(n=0),e.writeValue(g,c,p,{type:"double",value:n},l)):l&&l(Error("get switch current value return invalid"))});break;case "dimTo":n=parseInt(n)/100;e.writeValue(g,c,p,{type:"double",value:n},l);break;case "colorTo":n=n.toLowerCase();n="off blue green torqoise red purple yellow white".split(" ").indexOf(n);if(-1==n){l&&l(Error("unknown color"));
break}e.writeValue(g,c,p,{type:"double",value:n},l);break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+h))}else l&&l(Error("command in null"))}},MOTIONDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_MOTION",command:["reset"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"MOTION_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:c,
getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "MOTION":c={state:g?"on":"off"};break;case "ILLUMINATION":c={illumination:g};break;case "MOTION_DETECTION_ACTIVE":c={active:g}}return c},executeCommand:function(e,g,c,h,l){if(h){var k=m.call(this,h);if(k)switch(h){case "reset":e.writeValue(g,c,k,!0,l);break;case "activate":e.writeValue(g,c,k,!0,l);break;case "deactivate":e.writeValue(g,c,k,!1,l);break;case "toggleActivate":e.getState({interface:g,channel:c,datapoint:k},function(h,
m){h?l&&l(h):m?(h=!0,m.value&&(h=!1),e.writeValue(g,c,k,h,l)):l&&l(Error("get switch current value return invalid"))});break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+h))}else l&&l(Error("command in null"))}},KEY_TRANRECEIVER:{map:[{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){g=null;switch(e){case "PRESS_SHORT":g={pressShort:!0};break;case "PRESS_LONG":g=
{pressLong:!0}}return g}},ALARM_SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"ACOUSTIC_ALARM_SELECTION",command:["setAudio"]},{dpt:"OPTICAL_ALARM_SELECTION",command:["setVisual"]},{dpt:"DURATION_UNIT",command:["setDuraionUnit"]},{dpt:"DURATION_VALUE",command:["setDuraion"]},{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "STATE":c=1==g?{state:"on"}:0==g?{state:"off"}:{state:"?"}}return c},executeCommand:function(e,g,c,
h,l){if(h){var k=null;if("triggerAlarm"==h.substr(0,12)){k="triggerAlarm";var n=h.substr(12);if(!n){l&&l(Error("triggerAlarm format invalid"));return}}if(m.call(this,k)||"triggerAlarm"==k)switch(k){case "triggerAlarm":var p=n.split(",");if(4>p.length){l&&l(Error("triggerAlarm format invalid"));break}e.writeValue(g,c,"ACOUSTIC_ALARM_SELECTION",{type:"double",value:parseInt(p[0])},function(h,k){h?l&&l(h):e.writeValue(g,c,"OPTICAL_ALARM_SELECTION",{type:"double",value:parseInt(p[1])},function(h,k){h?
l&&l(h):e.writeValue(g,c,"DURATION_VALUE",{type:"double",value:parseInt(p[2])},function(h,k){h?l&&l(h):e.writeValue(g,c,"DURATION_UNIT",{type:"double",value:parseInt(p[3])},l)})})});break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+h))}else l&&l(Error("command in null"))}},HEATING_CLIMATECONTROL_TRANSCEIVER:{map:[{dpt:"SET_POINT_TEMPERATURE",command:["tempTo","tempUp","tempDown"],state:["state"],event:["state"]},{dpt:"HUMIDITY",state:["hum"],event:["hum"]},
{dpt:"CONTROL_MODE",command:["auto","manu"]},{dpt:"FROST_PROTECTION",state:["frost"],event:["frost"]},{dpt:"SET_POINT_MODE",state:["mode"],event:["mode"]},{dpt:"ACTIVE_PROFILE",command:["setProfile"],state:["profile"],event:["profile"]},{dpt:"WINDOW_STATE",command:["winOpen","winClose"],state:["window"],event:["window"]},{dpt:"ACTUAL_TEMPERATURE",state:["temp"],event:["temp"]},{dpt:"BOOST_MODE",command:["boostOn","boostOff"],state:["boost"],event:["boost"]},{dpt:"LEVEL",command:["setValve","valveUp",
"valveDown"],state:["valve"],event:["valve"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c={};switch(e){case "ACTIVE_PROFILE":c.profile=parseInt(g);break;case "ACTUAL_TEMPERATURE":c.temp=parseFloat(g);break;case "BOOST_MODE":c.boost=g;break;case "FROST_PROTECTION":c.frost=g;break;case "HUMIDITY":c.hum=parseInt(g);break;case "SET_POINT_MODE":0==g?c.mode="auto":1==g&&(c.mode="manu");break;case "SET_POINT_TEMPERATURE":c.state=parseFloat(g);break;case "LEVEL":c.valve=Math.round(100*
parseFloat(g));break;case "WINDOW_STATE":switch(g){case 0:c.window="closed";break;case 1:c.window="open"}break;default:return null}return c},executeCommand:function(e,g,c,h,l){if(h){var k=h;if("tempTo"==h.substr(0,6)){k="tempTo";var n=h.substr(6);if(!n){l&&l(Error("tempTo has no value"));return}}else if("tempUp"==h.substr(0,6))k="tempUp",n=h.substr(6);else if("tempDown"==h.substr(0,8))k="tempDown",n=h.substr(8);else if("setProfile"==h.substr(0,10)){if(k="setProfile",n=h.substr(10),!n){l&&l(Error("setProfile has no value"));
return}}else if("setValve"==h.substr(0,8)){if(k="setValve",n=h.substr(8),!n){l&&l(Error("setValve has no value"));return}}else"valveUp"==h.substr(0,7)?(k="valveUp",n=h.substr(7)):"valveDown"==h.substr(0,9)&&(k="valveDown",n=h.substr(9));var p=m.call(this,k);if(p)switch(k){case "tempTo":n=parseFloat(n);if(isNaN(n)){l&&l(Error("tempTo value invalid"));break}30.5<n&&(n=30.5);4.5>n&&(n=4.5);e.writeValue(g,c,p,{type:"double",value:n},l);break;case "tempUp":n||(n=1);n=parseFloat(n);if(isNaN(n)){l&&l(Error("tempUp value invalid"));
break}e.getState({interface:g,channel:c,datapoint:p},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(n=k.value+n,30.5<n&&(n=30.5),e.writeValue(g,c,p,{type:"double",value:n},l))});break;case "tempDown":n||(n=1);n=parseFloat(n);if(isNaN(n)){l&&l(Error("tempDown value invalid"));break}e.getState({interface:g,channel:c,datapoint:p},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):
(n=k.value-n,4.5>n&&(n=4.5),e.writeValue(g,c,p,{type:"double",value:n},l))});break;case "auto":e.writeValue(g,c,p,{type:"double",value:0},l);break;case "manu":e.writeValue(g,c,p,{type:"double",value:1},l);break;case "setProfile":n=parseInt(n);if(isNaN(n)){l&&l(Error("setTemp value invalid"));break}e.writeValue(g,c,p,n,l);break;case "winOpen":e.writeValue(g,c,p,1,l);break;case "winClose":e.writeValue(g,c,p,0,l);break;case "boostOn":e.writeValue(g,c,p,!0,l);break;case "boostOff":e.writeValue(g,c,p,
!1,l);break;case "setValve":n=parseInt(n);if(isNaN(n)){l&&l(Error("setValve value invalid"));break}n/=100;1<n&&(n=1);0>n&&(n=0);e.writeValue(g,c,p,{type:"double",value:n},l);break;case "valveUp":n||(n=10);n=parseInt(n);if(isNaN(n)){l&&l(Error("tempUp value invalid"));break}n/=100;e.getState({interface:g,channel:c,datapoint:p},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(n=k.value+n,1<n&&(n=1),e.writeValue(g,c,p,{type:"double",value:n},
l))});break;case "valveDown":n||(n=10);n=parseInt(n);if(isNaN(n)){l&&l(Error("tempUp value invalid"));break}n/=100;e.getState({interface:g,channel:c,datapoint:p},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(n=k.value-n,0>n&&(n=0),e.writeValue(g,c,p,{type:"double",value:n},l))});break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+h))}else l&&l(Error("command in null"))}},SHUTTER_CONTACT_TRANSCEIVER:{map:[{dpt:"STATE",
state:["state"],event:["state"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "STATE":c={state:0==g?"closed":"open"}}return c}},SMOKE_DETECTOR:{map:[{dpt:"SMOKE_DETECTOR_COMMAND",command:"reservedAlarmOff intrusionAlarmOff intrusionAlarmOn smokeTest commTest commTestRepeated".split(" ")},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["state"],event:["state"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["alarmDetail"],event:["alarmDetail"]},{dpt:"SMOKE_DETECTOR_TEST_RESULT",
state:["testResult"],event:["testResult"]},{dpt:"ERROR_CODE",state:["error"],event:["error"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "SMOKE_DETECTOR_ALARM_STATUS":c={state:0==g?"ok":"smoke"};c.alarmDetail=g;break;case "SMOKE_DETECTOR_TEST_RESULT":switch(g){case 0:c={testResult:"none"};break;case 1:c={testResult:"smoke_ok"};break;case 2:c={testResult:"smoke_nok"};break;case 3:c={testResult:"comm_sent"};break;case 4:c={testResult:"comm_ok"}}break;
case "ERROR_CODE":c={error:g}}return c},executeCommand:function(e,g,c,h,l){if(h){var k=m.call(this,h);if(k)switch(h){case "reservedAlarmOff":case "intrusionAlarmOff":case "intrusionAlarmOn":case "smokeTest":case "commTest":case "commTestRepeated":switch(h){case "reservedAlarmOff":var n=0;break;case "intrusionAlarmOff":n=1;break;case "intrusionAlarmOn":n=2;break;case "smokeTest":n=3;break;case "commTest":n=4;break;case "commTestRepeated":n=5}e.writeValue(g,c,k,n,l);break;default:l&&l(Error("no such command"))}else l&&
l(Error("can not find datapoint for command:"+h))}else l&&l(Error("command in null"))}},ROTARY_HANDLE_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "STATE":switch(g){case 0:c={state:"closed"};break;case 1:c={state:"tilted"};break;case 2:c={state:"open"}}}return c}},SHUTTER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTLevel"],event:["blindTLevel"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,
g){var c=null;switch(e){case "LEVEL":c={blindTLevel:Math.round(100*parseFloat(g))}}return c}},SHUTTER_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindLevel"],event:["blindLevel"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "LEVEL":c={blindLevel:Math.round(100*parseFloat(g))}}return c},executeCommand:function(e,g,c,h,l){if(h){if("moveUp"==h.substr(0,6))var k="moveUp";
else if("moveDown"==h.substr(0,8)){k="moveDown";var n=h.substr(8)}else if("stepUp"==h.substr(0,6))k="stepUp",n=h.substr(6);else if("stepDown"==h.substr(0,8))k="stepDown",n=h.substr(8);else if("moveTo"==h.substr(0,6)){if(k="moveTo",n=h.substr(6),!n){l&&l(Error("moveTo has no value"));return}}else"stop"==h.substr(0,4)&&(k="stop");var p=m.call(this,k);if(p)switch(k){case "moveUp":e.writeValue(g,c,p,{type:"double",value:1},l);break;case "moveDown":e.writeValue(g,c,p,{type:"double",value:0},l);break;case "stop":e.writeValue(g,
c,p,!0,l);break;case "stepUp":n||(n=5);n=parseInt(n)/100;e.getState({interface:g,channel:c,datapoint:p},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(n=k.value+n,1<n&&(n=1),e.writeValue(g,c,p,{type:"double",value:n},l))});break;case "stepDown":n||(n=5);n=parseInt(n)/100;e.getState({interface:g,channel:c,datapoint:p},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(n=k.value-
n,0>n&&(n=0),e.writeValue(g,c,p,{type:"double",value:n},l))});break;case "moveTo":n=parseInt(n)/100;e.writeValue(g,c,p,{type:"double",value:n},l);break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+h))}else l&&l(Error("command in null"))}},BLIND_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTPos"],event:["blindTPos"]},{dpt:"LEVEL_2",state:["lamellaTPos"],event:["lamellaTPos"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;
switch(e){case "LEVEL":c={blindTPos:Math.round(100*parseFloat(g))};break;case "LEVEL_2":c={lamellaTPos:Math.round(100*parseFloat(g))}}return c}},BLIND_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindPos"],event:["blindPos"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]},{dpt:"LEVEL_2",state:["lamellaPos"],event:["lamellaPos"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,
g){var c=null;switch(e){case "LEVEL":c={blindPos:Math.round(100*parseFloat(g))};break;case "LEVEL_2":c={lamellaPos:Math.round(100*parseFloat(g))}}return c},executeCommand:function(e,g,c,h,l){if(h){var k=h;if("lamellaStepUp"==h.substr(0,13)){k="lamellaStepUp";var n=h.substr(13)}else if("lamellaStepDown"==h.substr(0,15))k="lamellaStepDown",n=h.substr(15);else if("lamellaTo"==h.substr(0,9)){if(k="lamellaTo",n=h.substr(9),!n){l&&l(Error("lamellaTo has no value"));return}}else if("stepUp"==h.substr(0,
6))k="stepUp",n=h.substr(6);else if("stepDown"==h.substr(0,8))k="stepDown",n=h.substr(8);else if("moveTo"==h.substr(0,6)){if(k="moveTo",n=h.substr(6),!n){l&&l(Error("moveTo has no value"));return}}else"stop"==h.substr(0,4)&&(k="stop");var p=m.call(this,k);if(p)switch(k){case "moveUp":case "moveDown":e.writeValue(g,c,"LEVEL_2",{type:"double",value:"moveUp"==k?1:0},function(h){h?l&&l(h):e.writeValue(g,c,"LEVEL",{type:"double",value:"moveUp"==k?1:0},function(e){l&&l(e)})});break;case "stop":e.writeValue(g,
c,p,!0,l);break;case "moveTo":n=parseInt(n)/100;e.writeValue(g,c,"LEVEL",{type:"double",value:n},l);break;case "lamellaUp":case "lamellaDown":e.getState({interface:g,channel:c,datapoint:"LEVEL"},function(h,m){h?l&&l(h):e.writeValue(g,c,"LEVEL",{type:"double",value:m.value},function(h){h?l&&l(h):e.writeValue(g,c,"LEVEL_2",{type:"double",value:"lamellaUp"==k?1:0},function(e){l&&l(e)})})});break;case "stepUp":case "stepDown":n||(n=5);n=parseInt(n)/100;e.getState({interface:g,channel:c,datapoint:"LEVEL"},
function(h,m){h?l&&l(h):"undefined"==typeof m||null==m?l&&l(Error("get jalousie current value return invalid")):(n="stepUp"==k?m.value+n:m.value-n,1<n&&(n=1),0>n&&(n=0),e.writeValue(g,c,"LEVEL",{type:"double",value:n},l))});break;case "lamellaStepUp":case "lamellaStepDown":n||(n=5);n=parseInt(n)/100;e.getState({interface:g,channel:c,datapoint:"LEVEL"},function(h,m){if(h)l&&l(h);else if("undefined"==typeof m||null==m)l&&l(Error("get jalousie current value return invalid"));else{var p=m.value;e.getState({interface:g,
channel:c,datapoint:"LEVEL_2"},function(h,m){h?l&&l(h):"undefined"==typeof m||null==m?l&&l(Error("get jalousie current value return invalid")):(n="lamellaStepUp"==k?m.value+n:m.value-n,1<n&&(n=1),0>n&&(n=0),e.writeValue(g,c,"LEVEL_2",{type:"double",value:n},function(h){h?l&&l(h):e.writeValue(g,c,"LEVEL",{type:"double",value:p},l)}))})}});break;case "lamellaTo":n=parseInt(n)/100;e.writeValue(g,c,"LEVEL_2",{type:"double",value:n},l);break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+
h))}else l&&l(Error("command in null"))}},PRESENCEDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_PRESENCE",command:["reset"]},{dpt:"PRESENCE_DETECTION_STATE",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"CURRENT_ILLUMINATION",state:["current_illumination"],event:["current_illumination"]},{dpt:"PRESENCE_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,
g){var c=null;switch(e){case "PRESENCE_DETECTION_STATE":c={state:g?"on":"off"};break;case "ILLUMINATION":c={illumination:g};break;case "CURRENT_ILLUMINATION":c={current_illumination:g};break;case "PRESENCE_DETECTION_ACTIVE":c={active:g}}return c},executeCommand:function(e,g,c,h,l){if(h){var k=m.call(this,h);if(k)switch(h){case "reset":e.writeValue(g,c,k,!0,l);break;case "activate":e.writeValue(g,c,k,!0,l);break;case "deactivate":e.writeValue(g,c,k,!1,l);break;case "toggleActivate":e.getState({interface:g,
channel:c,datapoint:k},function(h,m){h?l&&l(h):m?(h=!0,m.value&&(h=!1),e.writeValue(g,c,k,h,l)):l&&l(Error("get switch current value return invalid"))});break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+h))}else l&&l(Error("command in null"))}},CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER:{map:[{dpt:"EMERGENCY_OPERATION",state:["cl_fd_emergencyOP"],event:["cl_fd_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fd_frostProtection"],event:["cl_fd_frostProtection"]},
{dpt:"STATE",state:["cl_fd_state"],event:["cl_fd_state"]},{dpt:"HUMIDITY_ALARM",state:["cl_fd_humidityAlarm"],event:["cl_fd_humidityAlarm"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "EMERGENCY_OPERATION":c={cl_fd_emergencyOP:g};break;case "FROST_PROTECTION":c={cl_fd_frostProtection:g};break;case "STATE":c=1==g?{cl_fd_state:"on"}:0==g?{cl_fd_state:"off"}:{cl_fd_state:"?"};break;case "HUMIDITY_ALARM":c={cl_fd_humidityAlarm:g}}return c}},CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",
state:["cl_fp_humidityLimiter"],event:["cl_fp_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_fp_emergencyOP"],event:["cl_fp_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fp_frostProtection"],event:["cl_fp_frostProtection"]},{dpt:"STATE",state:["cl_fp_state"],event:["cl_fp_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_fp_dewPointAlarm"],event:["cl_fp_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_fp_externalClock"],event:["cl_fp_externalClock"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,
g){var c=null;switch(e){case "HUMIDITY_LIMITER":c={cl_fp_humidityLimiter:g};break;case "EMERGENCY_OPERATION":c={cl_fp_emergencyOP:g};break;case "FROST_PROTECTION":c={cl_fp_frostProtection:g};break;case "STATE":c=1==g?{cl_fp_state:"on"}:0==g?{cl_fp_state:"off"}:{cl_fp_state:"?"};break;case "DEW_POINT_ALARM":c={cl_fp_dewPointAlarm:g};break;case "EXTERNAL_CLOCK":c={cl_fp_externalClock:g}}return c}},CLIMATECONTROL_FLOOR_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_f_humidityLimiter"],event:["cl_f_humidityLimiter"]},
{dpt:"EMERGENCY_OPERATION",state:["cl_f_emergencyOP"],event:["cl_f_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_f_frostProtection"],event:["cl_f_frostProtection"]},{dpt:"STATE",state:["cl_f_state"],event:["cl_f_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_f_dewPointAlarm"],event:["cl_f_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_f_externalClock"],event:["cl_f_externalClock"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "HUMIDITY_LIMITER":c={cl_f_humidityLimiter:g};
break;case "EMERGENCY_OPERATION":c={cl_f_emergencyOP:g};break;case "FROST_PROTECTION":c={cl_f_frostProtection:g};break;case "STATE":c=1==g?{cl_f_state:"on"}:0==g?{cl_f_state:"off"}:{cl_f_state:"?"};break;case "DEW_POINT_ALARM":c={cl_f_dewPointAlarm:g};break;case "EXTERNAL_CLOCK":c={cl_f_externalClock:g}}return c}},WEATHER_TRANSMIT:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["weatherActualTemp"],event:["weatherActualTemp"]},{dpt:"HUMIDITY",state:["weatherHum"],event:["weatherHum"]},{dpt:"ILLUMINATION",
state:["weatherIllu"],event:["weatherIllu"]},{dpt:"SUNSHINEDURATION",state:["weatherSunD"],event:["weatherSunD"]},{dpt:"SUNSHINEDURATION_OVERFLOW",state:["weatherSunDOF"],event:["weatherSunDOF"]},{dpt:"SUNSHINE_THRESHOLD_OVERRUN",state:["weatherSunTOR"],event:["weatherSunTOR"]},{dpt:"WIND_SPEED",state:["weatherWindS"],event:["weatherWindS"]},{dpt:"WIND_THRESHOLD_OVERRUN",state:["weatherWindTOR"],event:["weatherWindTOR"]},{dpt:"WIND_DIR",state:["weatherWindD"],event:["weatherWindD"]},{dpt:"WIND_DIR_RANGE",
state:["weatherWindDR"],event:["weatherWindDR"]},{dpt:"RAINING",state:["weatherRain"],event:["weatherRain"]},{dpt:"RAIN_COUNTER",state:["weatherRainC"],event:["weatherRainC"]},{dpt:"RAIN_COUNTER_OVERFLOW",state:["weatherRainCOF"],event:["weatherRainCOF"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,g){var c=null;switch(e){case "ACTUAL_TEMPERATURE":c={weatherActualTemp:g};break;case "HUMIDITY":c={weatherHum:g};break;case "ILLUMINATION":c={weatherIllu:g};break;case "SUNSHINEDURATION":c=
{weatherSunD:g};break;case "SUNSHINEDURATION_OVERFLOW":c={weatherSunDOF:g};break;case "SUNSHINE_THRESHOLD_OVERRUN":c={weatherSunTOR:g};break;case "WIND_SPEED":c={weatherWindS:g};break;case "WIND_THRESHOLD_OVERRUN":c={weatherWindTOR:g};break;case "RAINING":c={weatherRain:g};break;case "RAIN_COUNTER":c={weatherRainC:g};break;case "RAIN_COUNTER_OVERFLOW":c={weatherRainCOF:g};break;case "WIND_DIR":c={weatherWindD:g};break;case "WIND_DIR_RANGE":c={weatherWindDR:g}}return c}},CLIMATE_TRANSCEIVER:{map:[{dpt:"ACTUAL_TEMPERATURE",
state:["temperature"],event:["temperature"]},{dpt:"HUMIDITY",state:["humidity"],event:["humidity"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "ACTUAL_TEMPERATURE":g={temperature:c};break;case "HUMIDITY":g={humidity:c}}return g}},PASSAGE_DETECTOR_DIRECTION_TRANSMITTER:{map:[{dpt:"CURRENT_PASSAGE_DIRECTION",state:["current_direction"],event:["current_direction"]},{dpt:"LAST_PASSAGE_DIRECTION",state:["last_direction"],event:["last_direction"]},{dpt:"PASSAGE_COUNTER_OVERFLOW",
state:["passage_counter_overflow"],event:["passage_counter_overflow"]},{dpt:"PASSAGE_COUNTER_VALUE",state:["passage_counter"],event:["passage_counter"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "CURRENT_PASSAGE_DIRECTION":g={current_direction:c};break;case "LAST_PASSAGE_DIRECTION":g={last_direction:c};break;case "PASSAGE_COUNTER_OVERFLOW":g={passage_counter_overflow:c};break;case "PASSAGE_COUNTER_VALUE":g={passage_counter:c}}return g}},GENERIC_INPUT_TRANSMITER:{map:[{dpt:"CHANGE_OVER",
state:["genInputChangeOver"],event:["genInputChangeOver"]},{dpt:"EXTERNAL_CLOCK",state:["genInputExtClock"],event:["genInputExtClock"]},{dpt:"HUMIDITY_LIMITER",state:["genInputHumidityLimiter"],event:["genInputHumidityLimiter"]},{dpt:"STATE",state:["genInputState"],event:["genInputState"]},{dpt:"TACTILE_SWITCH",state:["genInputTactileSwitch"],event:["genInputTactileSwitch"]},{dpt:"TEMPERATURE_LIMITER",state:["genInputTempLimiter"],event:["genInputTempLimiter"]}],getReadableDpts:c,getDptFromState:h,
parseDptState:function(e,c){var g=null;switch(e){case "CHANGE_OVER":g={genInputChangeOver:c};break;case "EXTERNAL_CLOCK":g={genInputExtClock:c};break;case "HUMIDITY_LIMITER":g={genInputHumidityLimiter:c};break;case "STATE":g=1==c?{genInputState:"on"}:0==c?{genInputState:"off"}:{genInputState:"?"};break;case "TACTILE_SWITCH":g={genInputTactileSwitch:c};break;case "TEMPERATURE_LIMITER":g={genInputTempLimiter:c}}return g}},ANALOG_OUTPUT_TRANSCEIVER:{map:[{dpt:"LEVEL",state:["outputLevel"],event:["outputLevel"],
command:["outputOff","outputUp","outputDown","outputTo","toggleTo"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "LEVEL":g={outputLevel:Math.round(100*parseFloat(c))}}return g},executeCommand:function(e,c,h,p,l){if(p){if("outputOff"==p.substr(0,9))var g="outputOff";else if("outputUp"==p.substr(0,8)){g="outputUp";var k=p.substr(8)}else if("outputDown"==p.substr(0,10))g="outputDown",k=p.substr(10);else if("outputTo"==p.substr(0,8)){if(g="outputTo",k=p.substr(8),
!k){l&&l(Error("outputTo has no value"));return}}else if("toggleTo"==p.substr(0,8)){if(g="toggleTo",k=p.substr(8),!k){l&&l(Error("toggleTo has no value"));return}}else isNaN(parseInt(p))||(g="outputTo",k=parseInt(p));var r=m.call(this,g);if(r)switch(g){case "outputOff":e.writeValue(c,h,r,{type:"double",value:0},l);break;case "outputUp":k||(k=10);k=parseInt(k)/100;e.getState({interface:c,channel:h,datapoint:r},function(g,m){g?l&&l(g):"undefined"==typeof m||null==m?l&&l(Error("get dimmer current value return invalid")):
(k=m.value+k,1<k&&(k=1),e.writeValue(c,h,r,{type:"double",value:k},l))});break;case "outputDown":k||(k=10);k=parseInt(k)/100;e.getState({interface:c,channel:h,datapoint:r},function(g,m){g?l&&l(g):"undefined"==typeof m||null==m?l&&l(Error("get dimmer current value return invalid")):(k=m.value-k,0>k&&(k=0),e.writeValue(c,h,r,{type:"double",value:k},l))});break;case "toggleTo":k=parseInt(k)/100;e.getState({interface:c,channel:h,datapoint:r},function(g,m){g?l&&l(g):m?(m.value&&(k=0),e.writeValue(c,h,
r,{type:"double",value:k},l)):l&&l(Error("get switch current value return invalid"))});break;case "outputTo":k=parseInt(k)/100;e.writeValue(c,h,r,{type:"double",value:k},l);break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+p))}else l&&l(Error("command in null"))}},WATER_DETECTION_TRANSMITTER:{map:[{dpt:"ALARMSTATE",state:["alarm"],event:["alarm"]},{dpt:"MOISTURE_DETECTED",state:["moisture"],event:["moisture"]},{dpt:"WATERLEVEL_DETECTED",state:["water"],
event:["water"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "ALARMSTATE":g={alarm:c};break;case "MOISTURE_DETECTED":g={moisture:c};break;case "WATERLEVEL_DETECTED":g={water:c}}return g}},ACCELERATION_TRANSCEIVER:{map:[{dpt:"MOTION",state:["motion"],event:["motion"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "MOTION":g={motion:c}}return g}},DOOR_RECEIVER:{map:[{dpt:"DOOR_STATE",state:["doorState"],event:["doorState"]},
{dpt:"DOOR_COMMAND",command:["open","close","partialOpen","stop"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "DOOR_STATE":c=parseInt(c),g=0==c?{doorState:"closed"}:1==c?{doorState:"open"}:2==c?{doorState:"ventilation"}:{doorState:"unknown"}}return g},executeCommand:function(e,c,h,p,l){if(p){var g=m.call(this,p);if(g)switch(p){case "open":e.writeValue(c,h,g,{type:"double",value:1},l);break;case "stop":e.writeValue(c,h,g,{type:"double",value:2},l);break;
case "close":e.writeValue(c,h,g,{type:"double",value:3},l);break;case "partialOpen":e.writeValue(c,h,g,{type:"double",value:4},l);break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+p))}else l&&l(Error("command in null"))}},SIMPLE_SWITCH_RECEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"],command:["on","off","toggle"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "STATE":g=1==c?{state:"on"}:0==c?{state:"off"}:
{state:"?"}}return g},executeCommand:function(e,c,h,p,l){var g=m.call(this,p);if(g)switch(p){case "on":e.writeValue(c,h,g,!0,l);break;case "off":e.writeValue(c,h,g,!1,l);break;case "toggle":e.getState({interface:c,channel:h,datapoint:g},function(k,m){k?l&&l(k):m?(k=!0,m.value&&(k=!1),e.writeValue(c,h,g,k,l)):l&&l(Error("get switch current value return invalid"))});break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+p))}},MULTI_MODE_INPUT_TRANSMITTER:{map:[{dpt:"STATE",
state:["state"],event:["state"]},{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "STATE":g=1==c?{state:"on"}:0==c?{state:"off"}:{state:"?"};break;case "PRESS_SHORT":g={pressShort:!0};break;case "PRESS_LONG":g={pressLong:!0}}return g}},BRIGHTNESS_TRANSMITTER:{map:[{dpt:"AVERAGE_ILLUMINATION",state:["avgIllu"],event:["avgIllu"]},{dpt:"CURRENT_ILLUMINATION",state:["illu"],event:["illu"]},
{dpt:"HIGHEST_ILLUMINATION",state:["maxIllu"],event:["maxIllu"]},{dpt:"LOWEST_ILLUMINATION",state:["minIllu"],event:["minIllu"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "AVERAGE_ILLUMINATION":g={avgIllu:parseFloat(parseFloat(c).toFixed(2))};break;case "CURRENT_ILLUMINATION":g={illu:parseFloat(parseFloat(c).toFixed(2))};break;case "HIGHEST_ILLUMINATION":g={maxIllu:parseFloat(parseFloat(c).toFixed(2))};break;case "LOWEST_ILLUMINATION":g={minIllu:parseFloat(parseFloat(c).toFixed(2))}}return g}}},
"BidCos-RF":{MAINTENANCE:{device:"maintenance",map:[{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]},{dpt:"UNREACH",state:["timeout"],event:["timeout"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){switch(e){case "LOWBAT":return{lowbat:c};case "UNREACH":return{timeout:c};default:return null}}},KEY:{device:"button",map:[{dpt:"PRESS_SHORT",event:["pressShort"],command:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"],command:["pressLong"]},{dpt:"PRESS_LONG_RELEASE",event:["pressLongRel"]},
{dpt:"PRESS_CONT",event:["pressCont"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){switch(e){case "PRESS_SHORT":return{pressShort:c};case "PRESS_LONG":return{pressLong:c};case "PRESS_CONT":return{pressCont:c};case "PRESS_LONG_RELEASE":return{pressLongRel:c};default:return null}},executeCommand:function(e,c,h,p,l){var g=m.call(this,p);switch(p){case "pressShort":e.writeValue(c,h,g,!0,l);break;case "pressLong":e.writeValue(c,h,g,!0,l);break;default:l&&l(Error("no such command"))}}},
SWITCH_INTERFACE:{device:"switch_interface",map:[{dpt:"PRESS",event:["press"],command:["press"]}],parseDptState:function(e,c){switch(e){case "PRESS":return{press:!0};default:return null}},executeCommand:function(e,c,h,p,l){var g=m.call(this,p);switch(p){case "press":e.writeValue(c,h,g,!0,l);break;default:l&&l(Error("no such command"))}}},SHUTTER_CONTACT:{device:"contact",map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]},{dpt:"LOWBAT",state:["lowbat"],
event:["lowbat"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){switch(e){case "STATE":return{state:c?"open":"closed"};case "ERROR":return{error:1==c?"sabotage":"no_error"};case "LOWBAT":return{lowbat:c};default:return null}}},JALOUSIE:{device:"jalousie",map:[{dpt:"LEVEL",state:["jalState"],event:["jalState"],command:["moveUp","moveDown","stepUp","stepDown","%d"]},{dpt:"STOP",command:["stop"]},{dpt:"LEVEL_SLATS",state:["jalLmlState"],event:["jalLmlState"],command:["lamellaUp","lamellaDown",
"lamellaStepUp","lamellaStepDown","lamellaTo%d"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "LEVEL":c=Math.round(100*parseFloat(c));g={jalState:c};break;case "LEVEL_SLATS":c=Math.round(100*parseFloat(c)),g={jalLmlState:c}}return g},executeCommand:function(e,c,h,p,l){var g=m.call(this,p);switch(p){case "moveUp":e.writeValue(c,h,g,{type:"double",value:1},l);break;case "moveDown":e.writeValue(c,h,g,{type:"double",value:0},l);break;case "stepUp":e.getState({interface:c,
channel:h,datapoint:g},function(k,m){if(k)l&&l(k);else if(m){var n=m.value+.05;1<n&&(n=1);e.writeValue(c,h,g,{type:"double",value:n},function(k){k?l&&l(k):(e.updateStatusBuffer(c,h,g,n,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current jalousie state result invalid"))});break;case "stepDown":e.getState({interface:c,channel:h,datapoint:g},function(k,m){if(k)l&&l(k);else if(m){var n=m.value-.05;0>n&&(n=0);e.writeValue(c,h,g,{type:"double",value:n},function(k){k?l&&l(k):(e.updateStatusBuffer(c,
h,g,n,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current blind state result invalid"))});break;case "stop":e.writeValue(c,h,g,!0,l);break;case "lamellaUp":e.writeValue(c,h,g,{type:"double",value:1},l);break;case "lamellaDown":e.writeValue(c,h,g,{type:"double",value:0},l);break;case "lamellaStepUp":e.getState({interface:c,channel:h,datapoint:g},function(k,m){if(k)l&&l(k);else if(m){var n=m.value+.05;1<n&&(n=1);e.writeValue(c,h,g,{type:"double",value:n},function(k){k?l&&l(k):(e.updateStatusBuffer(c,
h,g,n,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current lamella state result invalid"))});break;case "lamellaStepDown":e.getState({interface:c,channel:h,datapoint:g},function(k,m){if(k)l&&l(k);else if(m){var n=m.value-.05;0>n&&(n=0);e.writeValue(c,h,g,{type:"double",value:n},function(k){k?l&&l(k):(e.updateStatusBuffer(c,h,g,n,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current lamella state result invalid"))});break;default:if("lamellaTo"==p.substr(0,9)){p=p.substr(9);
var k=parseInt(p);k/=100;g="LEVEL_SLATS";e.writeValue(c,h,g,{type:"double",value:k},function(m){m?l&&l(m):(e.updateStatusBuffer(c,h,g,k,(new Date).getTime()+1E3),l&&l())})}else"moveTo"==p.substr(0,6)||p.match(/^[-+]?[0-9]+$/)?("moveTo"==p.substr(0,6)&&(p=p.substr(6)),k=parseInt(p),k/=100,g="LEVEL",e.writeValue(c,h,g,{type:"double",value:k},function(m){m?l&&l(m):(e.updateStatusBuffer(c,h,g,k,(new Date).getTime()+1E3),l&&l())})):l&&l(Error("no such command"))}}},MOD_EM8BIT_TRANSMITTER:{map:[{dpt:"STATE",
state:["state8bit"],event:["state8bit"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g=null;switch(e){case "STATE":c=parseInt(c);g={state8bit:c};break;case "LOWBAT":g={lowbat:c}}return g}},KEYMATIC:{device:"keymatic",map:[{dpt:"STATE",state:["state"],event:["state"],command:["open","close"]},{dpt:"OPEN",command:["openDoor"]},{dpt:"STATE_UNCERTAIN",state:["uncertain"],event:["uncertain"]},{dpt:"ERROR",state:["error"],event:["error"]}],
getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){switch(e){case "STATE":return{state:c?"open":"closed"};case "STATE_UNCERTAIN":return{uncertain:c};case "ERROR":switch(c){case 0:c="no_error";break;case 1:c="cluth_failure";break;case 2:c="motor_aborted"}return{error:c}}return null},executeCommand:function(e,c,h,p,l){var g=m.call(this,p);switch(p){case "open":e.writeValue(c,h,g,!0,l);break;case "close":e.writeValue(c,h,g,!1,l);break;case "openDoor":e.writeValue(c,h,g,!0,l);break;default:l&&
l(Error("no such command"))}}},MOTION_DETECTOR:{device:"motion",map:[{dpt:"BRIGHTNESS",state:["bri"],event:["bri"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g={};switch(e){case "BRIGHTNESS":g.bri=c;break;case "MOTION":g.state=c?"motion":"ok";break;case "ERROR":g.error=c?"sabotage":"no_error";break;default:return null}return g}},DUAL_WHITE_BRIGHTNESS:{device:"dualwhite",map:[{dpt:"DIRECTION",
state:["direction"],event:["direction"]},{dpt:"ERROR_OVERHEAT",state:["error_overheat"],event:["error_overheat"]},{dpt:"ERROR_REDUCED",state:["error_reduced"],event:["error_reduced"]},{dpt:"LEVEL",state:["bri"],event:["bri"],command:["off","dimUp","dimDown","toggle","dimTo%d"]},{dpt:"LEVEL_REAL",state:["bri_real"],event:["bri_real"]},{dpt:"OLD_LEVEL",command:["on"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(e,c){var g={};switch(e){case "DIRECTION":g.direction=c;break;case "ERROR_OVERHEAT":g.error_overheat=
c?!0:!1;break;case "ERROR_REDUCED":g.error_reduced=c?!0:!1;break;case "LEVEL":g.bri=Math.round(100*parseFloat(c));break;case "LEVEL_REAL":g.bri_real=Math.round(100*parseFloat(c));break;default:return null}return g},executeCommand:function(c,g,h,p,l){var e=m.call(this,p);switch(p){case "on":c.writeValue(g,h,e,!0,l);break;case "off":c.writeValue(g,h,e,{type:"double",value:0},l);break;case "dimUp":c.getState({interface:g,channel:h,datapoint:e},function(k,m){if(k)l&&l(k);else if(m){var n=m.value+.05;
1<n&&(n=1);c.writeValue(g,h,e,{type:"double",value:n},function(k){k?l&&l(k):(c.updateStatusBuffer(g,h,e,n,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current jalousie state result invalid"))});break;case "dimDown":c.getState({interface:g,channel:h,datapoint:e},function(k,m){if(k)l&&l(k);else if(m){var n=m.value-.05;0>n&&(n=0);c.writeValue(g,h,e,{type:"double",value:n},function(k){k?l&&l(k):(c.updateStatusBuffer(g,h,e,n,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current blind state result invalid"))});
break;case "toggle":e="LEVEL";c.getState({interface:g,channel:h,datapoint:e},function(k,m){k?l&&l(k):m?0!=m.value?c.writeValue(g,h,e,{type:"double",value:0},l):c.writeValue(g,h,"OLD_LEVEL",!0,l):l&&l(Error("get current dimmer state result invalid"))});break;default:if("dimTo"==p.substr(0,5)){p=p.substr(5);var k=parseInt(p);k/=100;e="LEVEL";c.writeValue(g,h,e,{type:"double",value:k},function(m){m?l&&l(m):(c.updateStatusBuffer(g,h,e,k,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("no such command"))}}},
DUAL_WHITE_COLOR:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["color_direction"],event:["color_direction"]},{dpt:"LEVEL",state:["color"],event:["color"],command:["colorOff","colorUp","colorDown","colorToggle","colorTo%d"]},{dpt:"LEVEL_REAL",state:["color_real"],event:["color_real"]},{dpt:"OLD_LEVEL",command:["colorOn"]}],getReadableDpts:c,getDptFromState:h,parseDptState:function(c,g){var e={};switch(c){case "DIRECTION":e.direction=g;break;case "LEVEL":e.color=Math.round(100*parseFloat(g));break;
case "LEVEL_REAL":e.color_real=Math.round(100*parseFloat(g));break;default:return null}return e},executeCommand:function(c,g,h,p,l){var e=m.call(this,p);switch(p){case "colorOn":c.writeValue(g,h,e,!0,l);break;case "colorOff":c.writeValue(g,h,e,{type:"double",value:0},l);break;case "colorUp":c.getState({interface:g,channel:h,datapoint:e},function(k,m){if(k)l&&l(k);else if(m){var n=m.value+.05;1<n&&(n=1);c.writeValue(g,h,e,{type:"double",value:n},function(k){k?l&&l(k):(c.updateStatusBuffer(g,h,e,n,
(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current jalousie state result invalid"))});break;case "colorDown":c.getState({interface:g,channel:h,datapoint:e},function(k,m){if(k)l&&l(k);else if(m){var n=m.value-.05;0>n&&(n=0);c.writeValue(g,h,e,{type:"double",value:n},function(k){k?l&&l(k):(c.updateStatusBuffer(g,h,e,n,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current blind state result invalid"))});break;case "colorToggle":e="LEVEL";c.getState({interface:g,channel:h,datapoint:e},
function(k,m){k?l&&l(k):m?0!=m.value?c.writeValue(g,h,e,{type:"double",value:0},l):c.writeValue(g,h,"OLD_LEVEL",!0,l):l&&l(Error("get current dimmer state result invalid"))});break;default:if("colorTo"==p.substr(0,7)){p=p.substr(7);var k=parseInt(p);k/=100;e="LEVEL";c.writeValue(g,h,e,{type:"double",value:k},function(m){m?l&&l(m):(c.updateStatusBuffer(g,h,e,k,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("no such command"))}}}}}}();
x.hub.m.hm._Device=function(){var c=function(f,a,b){this.deviceType=f;this.deviceIF=a;this.deviceAdr=b;this.legacyType=null};c.prototype.initStates=function(f,a){var b=this._getReadableDpts();this._initDptStates(f,b,a)};c.prototype._getReadableDpts=function(){return[]};c.prototype._getDptFromRef=function(f){return null};c.prototype._initDptStates=function(f,a,b){if(a&&0!=a.length){var d=0,c=this,e=function(g,h){d++;d==a.length?b&&b():f.readValue(c.deviceIF,a[d].channel,a[d].dpt,e)};f.readValue(this.deviceIF,
a[d].channel,a[d].dpt,e)}else b&&b()};c.prototype.parseDptState=function(f,a,b){return null};c.prototype.toLegacyAdr=function(){return this.deviceType+"."+this.deviceIF+"."+this.deviceAdr};c.prototype.toLegacyType=function(){return this.legacyType};c.prototype.getSerial=function(){var f=this.deviceAdr,a=this.deviceAdr.indexOf(":");-1!=a&&(f=f.substr(0,a));return f};c.prototype.parseChnState=function(f,a){var b={},d;for(d in a){var c=this.parseDptState(f,d,a[d].value);if(c){var e={},g=a[d].time,h;
for(h in c)e[h]={value:c[h],time:g};b=x.hub.m.hm._Util.mergeObj(b,e)}}return b};c.prototype.parseStates=function(f){var a={},b;for(b in f){var d=this.parseChnState(b,f[b]);d&&(a=x.hub.m.hm._Util.mergeObj(a,d))}return a};c.prototype.executeCommand=function(f,a,b){b&&b()};c.prototype.getState=function(f,a,b){switch(a){case "timeout":var d={channel:0,dataPoint:"UNREACH"};break;default:d=this._getDptFromRef(a)}if(d){var c=this;f.getState({interface:this.deviceIF,channel:d.channel,datapoint:d.dataPoint},
function(f,e){f?b&&b(f):e?(f=c.parseDptState(d.channel,d.dataPoint,e.value))?b&&b(null,{value:f[a],time:e.time}):b&&b(null,null):b&&b(null,null)})}else b&&b(Error("no such state"))};c.prototype.isButton=function(){return!1};var h=function(f,a,b){c.call(this,f,a,b);this.channel=0;this.legacyType="maintenance"};util.inherits(h,c);h.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"].MAINTENANCE.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+
":0",dpt:b})});return f};h.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};h.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var c=f.substr(0,d);f=f.substr(d+1);var e=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(c!=e||f!=this.channel)return null;
d={};"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b;return d};var m=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="button"};util.inherits(m,c);m.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};m.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=
0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};m.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var c=f.substr(0,d);f=f.substr(d+1);var e=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(c!=e||0!=f&&f!=this.channel)return null;if(0==f)return d={},"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "PRESS_SHORT":return{pressShort:b};
case "PRESS_LONG":return{pressLong:b};case "PRESS_CONT":return{pressCont:b};case "PRESS_LONG_RELEASE":return{pressLongRel:b};default:return null}};m.prototype.isButton=function(){return!0};m.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(c,e){c&&console.error("button claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(d.deviceIF,b,"PRESS_LONG",function(b,d){b&&
console.error("button claim PRESS_LONG event error:"+b.stack);a&&a()})})};var e=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="button"};util.inherits(e,c);e.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};e.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint=
"LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};e.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var c=f.substr(0,d);f=f.substr(d+1);var e=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(c!=e||0!=f&&f!=this.channel)return null;if(0==f)return d={},"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "PRESS_SHORT":return{pressShort:b};case "PRESS_LONG":return{pressLong:b};
case "PRESS_CONT":return{pressCont:b};case "PRESS_LONG_RELEASE":return{pressLongRel:b};default:return null}};e.prototype.isButton=function(){return!1};e.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(c,e){c&&console.error("button claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(d.deviceIF,b,"PRESS_LONG",function(b,d){b&&console.error("button claim PRESS_LONG event error:"+
b.stack);a&&a()})})};var g=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="switch"};util.inherits(g,c);g.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"}]};g.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&
this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};g.prototype.executeCommand=function(f,a,b){var d=this.deviceAdr;-1==d.indexOf(":")&&this.channel&&(d+=":"+this.channel);var c=this;switch(a){case "on":var e="STATE";
f.writeValue(this.deviceIF,d,e,!0,b);break;case "off":e="STATE";f.writeValue(this.deviceIF,d,e,!1,b);break;case "toggle":e="STATE";f.getState({interface:this.deviceIF,channel:d,datapoint:e},function(a,g){a?b&&b(a):g?(a=!0,g.value&&(a=!1),f.writeValue(c.deviceIF,d,e,a,b)):b&&b(Error("get switch current value return invalid"))});break;default:"onFor"==a.substr(0,5)?(a=parseFloat(a.substr(5)),isNaN(a)?b&&b(Error("onFor command invalid")):(e="ON_TIME",f.writeValue(this.deviceIF,d,e,{type:"double",value:a},
function(a){a?b&&b(a):(e="STATE",f.writeValue(c.deviceIF,d,e,!0,b))}))):b&&b(Error("no such command"))}};g.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var c=f.substr(0,d);f=f.substr(d+1);var e=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(c!=e||0!=f&&f!=this.channel)return null;if(0==f)return d={},"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;var g;switch(a){case "STATE":return 1==b?g="on":
0==b&&(g="off"),{state:g};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};default:return null}};g.prototype.getConfig=function(f,a){var b=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,b,"MASTER",function(d,f){if(d)a&&a(d);else{var c={},e=null;f&&(e={AES_ACTIVE:f.AES_ACTIVE});c[b]=e;a&&a(d,c)}})};g.prototype.setConfig=function(f,a,b){if(a){var d=this.deviceAdr+":"+this.channel;if(a=a[d]){var c={};c.AES_ACTIVE=a.AES_ACTIVE;f.setParamset(this.deviceIF,d,"MASTER",c,function(d){b&&
b(d)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var k=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="dimmer"};util.inherits(k,c);k.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"}]};k.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "levelReal":a.dataPoint="LEVEL_REAL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};k.prototype.executeCommand=function(f,a,b){var d=this.deviceAdr+":"+this.channel,c=this,e=null;switch(a){case "on":var g="OLD_LEVEL";f.writeValue(this.deviceIF,d,g,!0,b);break;case "off":g="LEVEL";f.writeValue(this.deviceIF,
d,g,{type:"double",value:0},b);break;case "dimUp":g="LEVEL";f.getState({interface:this.deviceIF,channel:d,datapoint:g},function(a,e){a?b&&b(a):e?(a=e.value+.05,1<a&&(a=1),f.writeValue(c.deviceIF,d,g,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;case "dimDown":g="LEVEL";f.getState({interface:this.deviceIF,channel:d,datapoint:g},function(a,e){a?b&&b(a):e?(a=e.value-.05,0>a&&(a=0),f.writeValue(c.deviceIF,d,g,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});
break;case "toggle":g="LEVEL";f.getState({interface:this.deviceIF,channel:d,datapoint:g},function(a,e){a?b&&b(a):e?0!=e.value?f.writeValue(c.deviceIF,d,g,{type:"double",value:0},b):f.writeValue(c.deviceIF,d,"OLD_LEVEL",!0,b):b&&b(Error("get current dimmer state result invalid"))});break;default:"toggleTo"==a.substr(0,8)?(e=parseInt(a.substr(8)),isNaN(e)?b&&b(Error("toggleTo command invalid")):(g="LEVEL",e/=100,f.getState({interface:this.deviceIF,channel:d,datapoint:g},function(a,h){a?b&&b(a):h?(a=
e,h.value&&(a=0),f.writeValue(c.deviceIF,d,g,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))}))):"onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)?("onTo"==a.substr(0,4)&&(a=a.substr(4)),e=parseInt(a),e/=100,g="LEVEL",f.writeValue(this.deviceIF,d,g,{type:"double",value:e},b)):b&&b(Error("no such command"))}};k.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var c=f.substr(0,d);f=f.substr(d+1);var e=this.deviceAdr;d=this.deviceAdr.indexOf(":");
-1!=d&&(e=this.deviceAdr.substr(0,d));if(c!=e||0!=f&&f!=this.channel)return null;if(0==f)return d={},"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(b)),{state:a};case "LEVEL_REAL":return a=Math.round(100*parseFloat(b)),{levelReal:a};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};case "DIRECTION":return{direction:b};default:return null}};var p=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="blind"};
util.inherits(p,c);p.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"DIRECTION"}]};p.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=
0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LEVEL";break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;case "direction":a.dataPoint="DIRECTION";break;default:return null}return a};p.prototype.executeCommand=function(f,a,b){var d=this.deviceAdr+":"+this.channel,c=this,e=0;"stepUpFor"==a.substr(0,9)?((e=a.substr(9))||(e=1),e=parseFloat(e),a="stepUpFor"):"stepUp"==a.substr(0,6)?((e=a.substr(6))||(e=5),e=parseInt(e)/100,a="stepUp"):"stepDownFor"==a.substr(0,
11)?((e=a.substr(11))||(e=1),e=parseFloat(e),a="stepDownFor"):"stepDown"==a.substr(0,8)&&((e=a.substr(8))||(e=5),e=parseInt(e)/100,a="stepDown");switch(a){case "stepUp":var g="LEVEL";f.getState({interface:this.deviceIF,channel:d,datapoint:g},function(a,h){if(a)b&&b(a);else if(h){e||(e=.05);var w=h.value+e;1<w&&(w=1);f.writeValue(c.deviceIF,d,g,{type:"double",value:w},function(a){a?b&&b(a):(f.updateStatusBuffer(c.deviceIF,d,g,w,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("get current blind state result invalid"))});
break;case "stepDown":g="LEVEL";f.getState({interface:this.deviceIF,channel:d,datapoint:g},function(a,h){if(a)b&&b(a);else if(h){e||(e=.05);var w=h.value-e;0>w&&(w=0);f.writeValue(c.deviceIF,d,g,{type:"double",value:w},function(a){a?b&&b(a):(f.updateStatusBuffer(c.deviceIF,d,g,w,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("get current blind state result invalid"))});break;case "stepUpFor":g="LEVEL";f.writeValue(this.deviceIF,d,g,{type:"double",value:1},function(a){a?b&&b(a):setTimeout(function(){g=
"STOP";f.writeValue(c.deviceIF,d,g,!0,b)},1E3*e)});break;case "stepDownFor":g="LEVEL";f.writeValue(this.deviceIF,d,g,{type:"double",value:0},function(a){a?b&&b(a):setTimeout(function(){g="STOP";f.writeValue(c.deviceIF,d,g,!0,b)},1E3*e)});break;case "up":g="LEVEL";f.writeValue(this.deviceIF,d,g,{type:"double",value:1},b);break;case "down":g="LEVEL";f.writeValue(this.deviceIF,d,g,{type:"double",value:0},b);break;case "stop":g="STOP";f.writeValue(this.deviceIF,d,g,!0,b);break;default:if("moveTo"==a.substr(0,
6)||a.match(/^[-+]?[0-9]+$/)){"moveTo"==a.substr(0,6)&&(a=a.substr(6));var h=parseInt(a);h/=100;g="LEVEL";f.writeValue(this.deviceIF,d,g,{type:"double",value:h},function(a){a?b&&b(a):(f.updateStatusBuffer(c.deviceIF,d,g,h,(new Date).getTime()+1E3),b&&b())})}else b&&b(Error("no such command"))}};p.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,
d));if(e!=c||0!=f&&f!=this.channel)return null;if(0==f)return d={},"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "LEVEL":return a=Math.round(100*parseFloat(b)),{state:a};case "INHIBIT":return{inhibit:b};case "WORKING":return{working:b};case "DIRECTION":return{direction:b};default:return null}};p.prototype.getConfig=function(f,a){var b=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,b,"MASTER",function(d,f){if(d)a&&a(d);else{var e={},c=null;f&&(c={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,
REFERENCE_RUNNING_TIME_BOTTOM_TOP:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP,REFERENCE_RUNNING_TIME_TOP_BOTTOM:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});e[b]=c;a&&a(d,e)}})};p.prototype.setConfig=function(f,a,b){if(a){var d=this.deviceAdr+":"+this.channel;if(a=a[d]){var e={};e.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM=
{__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM};e.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;f.setParamset(this.deviceIF,d,"MASTER",e,function(d){b&&b(d)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var l=function(f,a,b){g.call(this,f,a,b);this.legacyType="powerswitch";this.powChannel=2};util.inherits(l,g);l.prototype._getReadableDpts=function(){var f=g.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.powChannel,
dpt:"BOOT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"ENERGY_COUNTER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"POWER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"CURRENT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"VOLTAGE"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"FREQUENCY"});return f};l.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";
break;case "state":a.channel+=":1";a.dataPoint="STATE";break;case "inhibit":a.channel+=":1";a.dataPoint="INHIBIT";break;case "working":a.channel+=":1";a.dataPoint="WORKING";break;case "boot":a.channel+=":2";a.dataPoint="BOOT";break;case "energy_counter":a.channel+=":2";a.dataPoint="ENERGY_COUNTER";break;case "power":a.channel+=":2";a.dataPoint="POWER";break;case "current":a.channel+=":2";a.dataPoint="CURRENT";break;case "voltage":a.channel+=":2";a.dataPoint="VOLTAGE";break;case "frequency":a.channel+=
":2";a.dataPoint="FREQUENCY";break;default:return null}return a};l.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);d=f.substr(d+1);return e!=this.deviceAdr?null:0==d?(f={},"UNREACH"==a?f.timeout=b:f["0_"+a.toLowerCase()]=b,f):"1"==d?g.prototype.parseDptState.call(this,f,a,b):"2"==d?(f={},f[a.toLowerCase()]=b,f):null};l.prototype.getConfig=function(f,a){var b=this,d=null;g.prototype.getConfig.call(this,f,function(e,c){e?a&&a(e):(d=c,b._getCh2Config(f,
function(b,f){if(b)a&&a(b);else{for(var e in f)f.hasOwnProperty(e)&&(d[e]=f[e]);a&&a(null,d)}}))})};l.prototype.setConfig=function(f,a,b){if(a){var d=Object.keys(a);if(d&&0!=d.length){var e=this;async.eachSeries(d,function(b,d){var c=b.indexOf(":");-1==c&&d(Error("channel address is null"));c=b.substr(c+1);1==c?g.prototype.setConfig.call(e,f,a,d):2==c?e._setCh2Config(f,a[b],d):d(Error("unknow channel:"+c))},function(d){b&&b(d)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};
l.prototype._getCh2Config=function(f,a){var b=this.deviceAdr+":2";f.getParamset(this.deviceIF,b,"MASTER",function(d,f){if(d)a&&a(d);else{var e={},c=null;f&&(c={AES_ACTIVE:f.AES_ACTIVE});e[b]=c;a&&a(d,e)}})};l.prototype._setCh2Config=function(f,a,b){if(a){var d=this.deviceAdr+":2",e={};e.AES_ACTIVE=a.AES_ACTIVE;f.setParamset(this.deviceIF,d,"MASTER",e,function(d){b&&b(d)})}else b&&b(Error("config data invalid"))};var q=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="weather"};util.inherits(q,
c);q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"}]};q.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";
break;case "hum":a.dataPoint="HUMIDITY";break;default:return null}return a};q.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;if(0==f)return d={},"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "TEMPERATURE":return a=parseFloat(b),{temp:a};case "HUMIDITY":return a=
parseInt(b),{hum:a};default:return null}};var n=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="weather2"};util.inherits(n,q);n.prototype._getReadableDpts=function(){var f=q.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.channel,dpt:"AIR_PRESSURE"});return f};n.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "air":a.dataPoint="AIR_PRESSURE";break;default:return q.prototype._getDptFromRef.call(this,
f)}return a};n.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d),c=f.substr(d+1),g=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(g=this.deviceAdr.substr(0,d));if(e!=g||0!=c&&c!=this.channel)return null;if(0==c)return f={},"UNREACH"==a?f.timeout=b:"LOWBAT"==a?f.lowbat=b:f["0_"+a.toLowerCase()]=b,f;f=q.prototype.parseDptState.call(this,f,a,b);switch(a){case "AIR_PRESSURE":f||(f={}),f.air=parseInt(b)}return f};var r=function(f,a,b){c.call(this,
f,a,b);this.channel=1;this.legacyType="weatherstation"};util.inherits(r,c);r.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAINING"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAIN_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_SPEED"},
{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION_RANGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"SUNSHINEDURATION"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"}]};r.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint=
"TEMPERATURE";break;case "hum":a.dataPoint="HUMIDITY";break;case "rain":a.dataPoint="RAINING";break;case "rainC":a.dataPoint="RAIN_COUNTER";break;case "windS":a.dataPoint="WIND_SPEED";break;case "windD":a.dataPoint="WIND_DIRECTION";break;case "windDR":a.dataPoint="WIND_DIRECTION_RANGE";break;case "sunD":a.dataPoint="SUNSHINEDURATION";break;case "bri":a.dataPoint="BRIGHTNESS";break;default:return null}return a};r.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=
f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "TEMPERATURE":d.temp=parseFloat(b);break;case "HUMIDITY":d.hum=parseInt(b);break;case "RAINING":d.rain=b;break;case "RAIN_COUNTER":d.rainC=parseFloat(b);break;case "WIND_SPEED":d.windS=parseFloat(b);break;case "WIND_DIRECTION":d.windD=
b;break;case "WIND_DIRECTION_RANGE":d.windDR=b;break;case "SUNSHINEDURATION":d.sunD=b;break;case "BRIGHTNESS":d.bri=b;break;default:return null}return d};var v=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="heater"};util.inherits(v,c);v.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"VALVE_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"});return f};v.prototype._getDptFromRef=
function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "error":a.dataPoint="ERROR";break;case "state":a.dataPoint="VALVE_STATE";break;default:return null}return a};v.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d={};if(0==f)return"UNREACH"==
a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;if(f==this.channel){switch(a){case "ERROR":switch(b){case 0:d.error="no_error";break;case 1:d.error="VALVE_DRIVE_BLOCKED";break;case 2:d.error="VALVE_DRIVE_LOOSE";break;case 3:d.error="ADJUSTING_RANGE_TO_SMALL";break;case 4:d.error="lowbat"}break;case "VALVE_STATE":d.state=b}return d}return null};var u=function(f,a,b){c.call(this,f,a,b);this.channel=4;this.legacyType="thermostat"};util.inherits(u,c);u.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"FAULT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"SET_TEMPERATURE"});return f};u.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(f){case "mode":a.dataPoint="CONTROL_MODE";break;case "error":a.dataPoint="FAULT_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "valveLvl":a.dataPoint="VALVE_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";break;case "act_temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};u.prototype.executeCommand=function(f,a,b){var d=this.deviceAdr+":"+this.channel,e=this;switch(a){case "setAuto":var c=
"AUTO_MODE";f.writeValue(this.deviceIF,d,c,!0,function(a){a||f.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",0);b&&b(a)});break;case "setManu":c="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:d,datapoint:c},function(a,g){a?b&&b(a):(c="MANU_MODE",f.writeValue(e.deviceIF,d,c,{type:"double",value:g.value},function(a){a||f.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",1);b&&b(a)}))});break;case "setBoost":c="BOOST_MODE";f.writeValue(this.deviceIF,d,c,!0,function(a){a||f.updateStatusBuffer(e.deviceIF,
d,"CONTROL_MODE",3);b&&b(a)});break;case "tempUp":c="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:d,datapoint:c},function(a,g){a?b&&b(a):g?(a=g.value+.5,30.5<a&&(a=30.5),f.writeValue(e.deviceIF,d,c,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":c="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:d,datapoint:c},function(a,g){a?b&&b(a):g?(a=g.value-.5,4.5>a&&(a=4.5),f.writeValue(e.deviceIF,d,c,{type:"double",value:a},
b)):b&&b(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),c="SET_TEMPERATURE",f.writeValue(this.deviceIF,d,c,{type:"double",value:a},b)):b&&b(Error("no such command"))}};u.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,
d));if(e!=c)return null;d={};if(0==f)return d["0_"+a.toLowerCase()]=b,d;if(f==this.channel){switch(a){case "CONTROL_MODE":switch(b){case 0:d.mode="auto";break;case 1:d.mode="manu";break;case 2:d.mode="party";break;case 3:d.mode="boost"}break;case "FAULT_REPORTING":switch(b){case 0:d.error="no_error";break;case 1:d.error="valve_tight";break;case 2:d.error="ADJUSTING_RANGE_TOO_LARGE";break;case 3:d.error="ADJUSTING_RANGE_TOO_SMALL";break;case 4:d.error="comm_error";break;case 5:d.error="";break;case 6:d.error=
"lowbat";break;case 7:d.error="VALVE_ERROR_POSITION"}break;case "BATTERY_STATE":d.batLvl=b;break;case "VALVE_STATE":d.valveLvl=b;break;case "BOOST_STATE":d.boostTime=b;break;case "ACTUAL_TEMPERATURE":d.act_temp=b;break;case "SET_TEMPERATURE":d.state=b;break;default:return null}return d}return null};var la=function(f,a,b){c.call(this,f,a,b);this.channel=4;this.legacyType="thermostat"};util.inherits(la,u);la.prototype._getReadableDpts=function(){var f=u.prototype._getReadableDpts.callback(this);f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"WINDOW_STATE"});return f};la.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "window":a.dataPoint="WINDOW_STATE";break;default:return u.prototype._getDptFromRef.call(this,f)}return a};la.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d),c=f.substr(d+1),g=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(g=this.deviceAdr.substr(0,d));if(e!=g)return null;d=
{};if(0==c)return d["0_"+a.toLowerCase()]=b,d;if(c==this.channel)switch(a){case "WINDOW_STATE":return d.window=b?"closed":"open",d;default:return u.prototype.parseDptState.call(this,f,a,b)}else return null};var O=function(f,a,b){c.call(this,f,a,b);this.weatherChannel=1;this.thermoChannel=2;this.legacyType="wallthermo"};util.inherits(O,c);O.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":0",dpt:"LOWBAT"});f.push({channel:this.deviceAdr+
":"+this.weatherChannel,dpt:"TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"HUMIDITY"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SETPOINT"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_COMMAND"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_DATA"});return f};O.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";
break;case "lowbat":b.channel=a+":0";b.dataPoint="LOWBAT";break;case "temp":b.channel=a+":1";b.dataPoint="TEMPERATURE";break;case "hum":b.channel=a+":1";b.dataPoint="HUMIDITY";break;case "state":b.channel=a+":2";b.dataPoint="SETPOINT";break;case "adjusting_command":b.channel=a+":2";b.dataPoint="ADJUSTING_COMMAND";break;case "adjusting_data":b.channel=a+":2";b.dataPoint="ADJUSTING_DATA";break;default:return null}return b};O.prototype.executeCommand=function(f,a,b){var d=this.deviceAdr+":"+this.thermoChannel;
switch(a){case "tempUp":var e="SETPOINT";f.getState({interface:this.deviceIF,channel:d,datapoint:e},function(a,c){a?b&&b(a):c?(a=c.value+.5,30<a&&(a=30),f.writeValue(self.deviceIF,d,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":e="SETPOINT";f.getState({interface:this.deviceIF,channel:d,datapoint:e},function(a,c){a?b&&b(a):c?(a=c.value-.5,6>a&&(a=6),f.writeValue(self.deviceIF,d,e,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});
break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),e="SETPOINT",f.writeValue(this.deviceIF,d,e,{type:"double",value:a},b)):b&&b(Error("no such command"))}};O.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);if(e!=this.deviceAdr)return null;e={};if(0==f)return"UNREACH"==a?e.timeout=b:"LOWBAT"==a?e.lowbat=b:e["0_"+a.toLowerCase()]=b,e;if("1"==f){switch(a){case "TEMPERATURE":e.temp=
b;break;case "HUMIDITY":e.hum=b}return e}if("2"==f){switch(a){case "SETPOINT":e.state=b;break;case "ADJUSTING_COMMAND":e.adjusting_command=b;break;case "ADJUSTING_DATA":e.adjusting_data=b}return e}return null};var P=function(f,a,b){c.call(this,f,a,b);this.thermoChannel=2;this.legacyType="wallthermostat"};util.inherits(P,c);P.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,
dpt:"LOWBAT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"COMMUNICATION_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"WINDOW_OPEN_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_HUMIDITY"});
f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SET_TEMPERATURE"});return f};P.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.thermoChannel,dataPoint:null};switch(f){case "mode":a.dataPoint="CONTROL_MODE";break;case "lowbat":a.dataPoint="LOWBAT_REPORTING";break;case "comm":a.dataPoint="COMMUNICATION_REPORTING";break;case "window":a.dataPoint="WINDOW_OPEN_REPORTING";break;case "batLvl":a.dataPoint="BATTERY_STATE";break;case "boostTime":a.dataPoint="BOOST_STATE";
break;case "temp":a.dataPoint="ACTUAL_TEMPERATURE";break;case "hum":a.dataPoint="ACTUAL_HUMIDITY";break;case "state":a.dataPoint="SET_TEMPERATURE";break;default:return null}return a};P.prototype.executeCommand=function(f,a,b){var d=this.deviceAdr+":"+this.thermoChannel,e=this;switch(a){case "setAuto":var c="AUTO_MODE";f.writeValue(this.deviceIF,d,c,!0,function(a){a||f.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",0);b&&b(a)});break;case "setManu":c="SET_TEMPERATURE";f.getState({interface:this.deviceIF,
channel:d,datapoint:c},function(a,g){a?b&&b(a):(c="MANU_MODE",f.writeValue(e.deviceIF,d,c,{type:"double",value:g.value},function(a){a||f.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",1);b&&b(a)}))});break;case "setBoost":c="BOOST_MODE";f.writeValue(this.deviceIF,d,c,!0,function(a){a||f.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",3);b&&b(a)});break;case "tempUp":c="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:d,datapoint:c},function(a,g){a?b&&b(a):g?(a=g.value+.5,30.5<a&&(a=30.5),
f.writeValue(e.deviceIF,d,c,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;case "tempDown":c="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:d,datapoint:c},function(a,g){a?b&&b(a):g?(a=g.value-.5,4.5>a&&(a=4.5),f.writeValue(e.deviceIF,d,c,{type:"double",value:a},b)):b&&b(Error("get current temp state result invalid"))});break;default:"tempTo"==a.substr(0,6)||a.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==a.substr(0,6)&&(a=a.substr(6)),a=parseFloat(a),
c="SET_TEMPERATURE",f.writeValue(this.deviceIF,d,c,{type:"double",value:a},b)):"setWeekProfile"==a.substr(0,14)?(a=parseInt(a.substr(14)),f.setParamset(this.deviceIF,this.deviceAdr,"MASTER",{WEEK_PROGRAM_POINTER:a-1},function(d){b&&b(d)})):b&&b(Error("no such command"))}};P.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);if(e!=this.deviceAdr)return null;e={};if(0==f)return e["0_"+a.toLowerCase()]=b,e;if("2"==f){switch(a){case "CONTROL_MODE":switch(b){case 0:e.mode=
"auto";break;case 1:e.mode="manu";break;case 2:e.mode="party";break;case 3:e.mode="boost"}break;case "LOWBAT_REPORTING":e.lowbat=b;break;case "COMMUNICATION_REPORTING":e.comm=b;break;case "WINDOW_OPEN_REPORTING":e.window=b;break;case "BATTERY_STATE":e.batLvl=b;break;case "BOOST_STATE":e.boostTime=b;break;case "ACTUAL_TEMPERATURE":e.temp=b;break;case "ACTUAL_HUMIDITY":e.hum=b;break;case "SET_TEMPERATURE":e.state=b}return e}return null};var ma=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType=
"contact"};util.inherits(ma,c);ma.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};ma.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint=
"STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};ma.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;if(0==f)return d={},"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "STATE":return{state:b?"open":"closed"};
case "ERROR":return{error:1==b?"sabotage":"no_error"};case "LOWBAT":return{lowbat:b};default:return null}};var Q=function(f,a,b){c.call(this,f,a,b);this.rainChannel=1;this.heatChannel=2;this.legacyType="rain"};util.inherits(Q,c);Q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.rainChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+
":"+this.heatChannel,dpt:"WORKING"}]};Q.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "rain":b.channel=a+":"+this.rainChannel;b.dataPoint="STATE";break;case "heat":b.channel=a+":"+this.heatChannel;b.dataPoint="STATE";break;case "inhibit":b.channel=a+":"+this.heatChannel;b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.heatChannel;b.dataPoint="WORKING";break;default:return null}return b};
Q.prototype.executeCommand=function(f,a,b){var d=this.deviceAdr;-1==d.indexOf(":")&&this.heatChannel&&(d+=":"+this.heatChannel);var e=this;switch(a){case "heaterOn":var c="STATE";f.writeValue(this.deviceIF,d,c,!0,b);break;case "heaterOff":c="STATE";f.writeValue(this.deviceIF,d,c,!1,b);break;case "heaterToggle":c="STATE";f.getState({interface:this.deviceIF,channel:d,datapoint:c},function(a,g){a?b&&b(a):g?(a=!0,g.value&&(a=!1),f.writeValue(e.deviceIF,d,c,a,b)):b&&b(Error("get switch current value return invalid"))});
break;default:b&&b(Error("no such command"))}};Q.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;if(1==f){switch(a){case "STATE":d.rain=1==b?"rain":"dry";break;default:return null}return d}if(2==f){switch(a){case "STATE":d.heat=b?"on":"off";break;case "INHIBIT":d.inhibit=
b;break;case "WORKING":d.working=b;break;default:return null}return d}};var A=function(f,a,b){c.call(this,f,a,b);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong2"};util.inherits(A,c);A.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.chimeChannel,
dpt:"STATE"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"WORKING"}]};A.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "led":b.channel=a+":"+this.ledChannel;b.dataPoint="STATE";break;case "led_inhibit":b.channel=a+":"+this.ledChannel;b.dataPoint="INHIBIT";break;case "led_working":b.channel=a+":"+this.ledChannel;b.dataPoint=
"WORKING";break;case "chime":b.channel=a+":"+this.chimeChannel;b.dataPoint="STATE";break;case "chime_inhibit":b.channel=a+":"+this.chimeChannel;b.dataPoint="INHIBIT";break;case "chime_working":b.channel=a+":"+this.chimeChannel;b.dataPoint="WORKING";break;default:return null}return b};A.prototype.executeCommand=function(f,a,b){switch(a){case "ledOn":a=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,a,"STATE",!0,b);break;case "ledOff":a=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,
a,"STATE",!1,b);break;case "chimeOn":a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"STATE",!0,b);break;case "chimeOff":a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"STATE",!1,b);break;default:b&&b(Error("no such command"))}};A.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=
{};if(0==f)return"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;if(1==f){switch(a){case "STATE":d.led=b?"on":"off";break;case "INHIBIT":d.led_inhibit=b;break;case "WORKING":d.led_working=b;break;default:return null}return d}if(2==f){switch(a){case "STATE":d.chime=b?"on":"off";break;case "INHIBIT":d.chime_inhibit=b;break;case "WORKING":d.chime_working=b;break;default:return null}return d}};var La=function(f,a,b){c.call(this,f,a,b);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong"};
util.inherits(La,A);La.prototype.executeCommand=function(f,a,b){if(0==a.indexOf("vChannel")){var d=a.substr(8);d=parseInt(d);a=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,a,"SUBMIT","0.8,1,5,"+d,b)}else 0==a.indexOf("ledGreen")?((d=a.substr(8))||(d=10),a=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+d+",34",b)):0==a.indexOf("ledRed")?((d=a.substr(6))||(d=10),a=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,a,"SUBMIT","1,10,"+d+
",18",b)):A.prototype.executeCommand.call(this,f,a,b)};var na=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="window"};util.inherits(na,c);na.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};na.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,
dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "error":a.dataPoint="ERROR";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};na.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=
b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "STATE":switch(b){case 0:d.state="closed";break;case 1:d.state="tilted";break;case 2:d.state="open"}break;case "ERROR":switch(b){case 0:d.error="no_error";break;case 1:case 7:d.error="sabotage"}break;case "LOWBAT":d.lowbat=b;break;default:return null}return d};var oa=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="temp"};util.inherits(oa,c);oa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+
":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"}]};oa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "temp":a.dataPoint="TEMPERATURE";break;default:return null}return a};oa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=
this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;if(0==f)return d={},"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "TEMPERATURE":return{temp:parseFloat(b)};default:return null}};var pa=function(f,a,b){c.call(this,f,a,b);this.temp1=1;this.temp2=2;this.tempDiff12=3;this.tempDiff21=4;this.legacyType="temp2"};util.inherits(pa,c);pa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.temp1,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.temp1,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.temp2,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff12,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff21,dpt:"TEMPERATURE"}]};pa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "lowbat":a.channel=
this.temp1;a.dataPoint="LOWBAT";break;case "temp1":a.channel=this.temp1;a.dataPoint="TEMPERATURE";break;case "temp2":a.channel=this.temp2;a.dataPoint="TEMPERATURE";break;case "tempDiff12":a.channel=this.tempDiff12;a.dataPoint="TEMPERATURE";break;case "tempDiff21":a.channel=this.tempDiff21;a.dataPoint="TEMPERATURE";break;default:return null}return a};pa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");
-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "LOWBAT":return{lowbat:b};case "TEMPERATURE":return 1==f?{temp1:parseFloat(b)}:2==f?{temp2:parseFloat(b)}:3==f?{tempDiff12:parseFloat(b)}:4==f?{tempDiff21:parseFloat(b)}:null;default:return null}};var qa=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="co2"};util.inherits(qa,c);qa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};qa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};qa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,
d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "STATE":switch(b){case 0:d.state="normal";break;case 1:d.state="medium";break;case 2:d.state="high"}break;default:return null}return d};var ra=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="motion"};util.inherits(ra,c);ra.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},
{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"},{channel:this.deviceAdr+":"+this.channel,dpt:"MOTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};ra.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "bri":a.dataPoint="BRIGHTNESS";break;case "state":a.dataPoint="MOTION";break;case "error":a.dataPoint="ERROR";
break;default:return null}return a};ra.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "BRIGHTNESS":d.bri=b;break;case "MOTION":d.state=b?"motion":"ok";break;case "ERROR":d.error=b?"sabotage":
"no_error";break;default:return null}return d};var sa=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="smoke"};util.inherits(sa,c);sa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};sa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;
case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;default:return null}return a};sa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "STATE":d.state=
b?"smoke":"ok";break;default:return null}return d};var R=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="siren"};util.inherits(R,c);R.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_BATTERY"},{channel:this.deviceAdr+
":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};R.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "error_power":a.dataPoint="ERROR_POWER";break;case "error_sabotage":a.dataPoint="ERROR_SABOTAGE";break;case "error_battery":a.dataPoint="ERROR_BATTERY";
break;case "inhibit":a.dataPoint="INHIBIT";break;case "working":a.dataPoint="WORKING";break;default:return null}return a};R.prototype.executeCommand=function(f,a,b){var d=this.deviceAdr+":"+this.channel,e=this;switch(a){case "on":var c="STATE";f.writeValue(this.deviceIF,d,c,!0,b);break;case "off":c="STATE";f.writeValue(this.deviceIF,d,c,!1,b);break;case "toggle":c="STATE";f.getState({interface:this.deviceIF,channel:d,datapoint:c},function(a,g){a?b&&b(a):(a=!0,g.value&&(a=!1),f.writeValue(e.deviceIF,
d,c,a,b))});break;default:b&&b(Error("no such command"))}};R.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "STATE":d.state=b?"on":"off";break;case "ERROR_POWER":d.error_power=b?"power_failure":"no_error";break;
case "ERROR_SABOTAGE":d.error_sabotage=b?"sabotage":"no_error";break;case "ERROR_BATTERY":d.error_battery=b?"battery_defect":"no_error";break;case "INHIBIT":d.inhibit=b;break;case "WORKING":d.working=b;break;default:return null}return d};var ta=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="capacity"};util.inherits(ta,c);ta.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+
":"+this.channel,dpt:"FILLING_LEVEL"}]};ta.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="FILLING_LEVEL";break;default:return null}return a};ta.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");
-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "FILLING_LEVEL":d.state=b;break;default:return null}return d};var K=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="switch_interface"};util.inherits(K,c);K.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};K.prototype._getDptFromRef=
function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);a={channel:a,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;default:return null}return a};K.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;
if(0==f)return d={},"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "PRESS":return{press:b};default:return null}};K.prototype.isButton=function(){return!0};K.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);f.reportValueUsage(this.deviceIF,b,"PRESS",function(b,f){b&&console.error("switch interface claim PRESS event error:"+b.stack);a&&a()})};var ua=function(f,a,b){c.call(this,f,a,b);this.channel=
1;this.legacyType="tilt"};util.inherits(ua,c);ua.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};ua.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};
ua.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "STATE":d.state=b?"open":"closed";break;case "LOWBAT":d.lowbat=b;break;default:return null}return d};var va=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType=
"water"};util.inherits(va,c);va.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};va.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};
va.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "STATE":switch(b){case 0:d.state="ok";break;case 1:d.state="moist";break;case 2:d.state="water"}break;case "LOWBAT":d.lowbat=b;break;default:return null}return d};
var wa=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="energymeter"};util.inherits(wa,c);wa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BOOT"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ENERGY_COUNTER"},{channel:this.deviceAdr+
":"+this.channel,dpt:"POWER"}]};wa.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "boot":a.dataPoint="BOOT";break;case "gas_energy":a.dataPoint="GAS_ENERGY_COUNTER";break;case "gas_power":a.dataPoint="GAS_POWER";break;case "energy":a.dataPoint="ENERGY_COUNTER";break;case "power":a.dataPoint="POWER";break;default:return null}return a};
wa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "BOOT":d.boot=b;break;case "GAS_ENERGY_COUNTER":d.gas_energy=b;break;case "GAS_POWER":d.gas_power=b;break;case "ENERGY_COUNTER":d.energy=b;
break;case "POWER":d.power=b;break;default:return null}return d};var L=function(f,a,b){c.call(this,f,a,b);this.dimChannel=1;this.rgbChannel=2;this.autoChannel=3;this.legacyType="rgb"};util.inherits(L,c);L.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.dimChannel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.rgbChannel,dpt:"COLOR"},{channel:this.deviceAdr+":"+this.autoChannel,dpt:"PROGRAM"}]};L.prototype._getDptFromRef=function(f){var a=
this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.channel=a+":"+this.dimChannel;b.dataPoint="LEVEL";break;case "color":b.channel=a+":"+this.rgbChannel;b.dataPoint="COLOR";break;case "program":b.channel=a+":"+this.autoChannel;b.dataPoint="PROGRAM";break;case "inhibit":b.channel=a+":"+this.dimChannel;b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.dimChannel;b.dataPoint="WORKING";break;case "direction":b.channel=
a+":"+this.dimChannel;b.dataPoint="DIRECTION";break;default:return null}return b};L.prototype.executeCommand=function(f,a,b){var d=this;switch(a){case "on":var e=this.deviceAdr+":"+this.dimChannel;var c="OLD_LEVEL";f.writeValue(this.deviceIF,e,c,!0,b);break;case "off":e=this.deviceAdr+":"+this.dimChannel;c="LEVEL";f.writeValue(this.deviceIF,e,c,{type:"double",value:0},b);break;case "white":e=this.deviceAdr+":"+this.rgbChannel;c="COLOR";f.writeValue(this.deviceIF,e,c,200,b);break;case "dimUp":e=this.deviceAdr+
":"+this.dimChannel;c="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:c},function(a,g){a?b&&b(a):g?(a=g.value+.05,1<a&&(a=1),f.writeValue(d.deviceIF,e,c,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});break;case "dimDown":e=this.deviceAdr+":"+this.dimChannel;c="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:c},function(a,g){a?b&&b(a):g?(a=g.value-.05,0>a&&(a=0),f.writeValue(d.deviceIF,e,c,{type:"double",value:a},b)):b&&b(Error("get current dimmer state result invalid"))});
break;default:if("onTo"==a.substr(0,4)||a.match(/^[-+]?[0-9]+$/)){"onTo"==a.substr(0,4)&&(a=a.substr(4));var g=parseInt(a);e=this.deviceAdr+":"+this.dimChannel;c="LEVEL";f.writeValue(this.deviceIF,e,c,{type:"double",value:g/100},b)}else if("setProg"==a.substr(0,7))a=a.substr(7),g=parseInt(a),e=this.deviceAdr+":"+this.autoChannel,c="PROGRAM",f.writeValue(this.deviceIF,e,c,g,b);else if("setRampTime"==a.substr(0,11))a=a.substr(11),g=parseFloat(a),e=this.deviceAdr+":"+this.dimChannel,c="RAMP_TIME",f.writeValue(this.deviceIF,
e,c,{type:"double",value:g},b);else if(a.toLowerCase().match(/^([0-9a-f]{6})$/i)){g=parseInt(a.substr(0,2),16);var h=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);var k=0;g=this._RGBToHSV(g,h,a);k=.1>g[1]?200:Math.round(g[0]/1.8);e=this.deviceAdr+":"+this.rgbChannel;c="COLOR";f.writeValue(this.deviceIF,e,c,k,b)}else b&&b(Error("no such command"))}};L.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;
d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.dimChannel&&f!=this.rgbChannel&&f!=this.autoChannel)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "LEVEL":d.state=100*parseFloat(b);break;case "COLOR":d.color=b;break;case "PROGRAM":d.program=b;break;case "INHIBIT":d.inhibit=b;break;case "WORKING":d.working=b;break;case "DIRECTION":d.direction=b;break;default:return null}return d};L.prototype._RGBToHSV=function(f,
a,b){f/=255;a/=255;b/=255;var d=Math.min(f,Math.min(a,b)),e=Math.max(f,Math.max(a,b));return d==e?[0,0,d]:[60*((f==d?3:b==d?1:5)-(f==d?a-b:b==d?f-a:b-f)/(e-d)),(e-d)/e,e]};var xa=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="lux"};util.inherits(xa,c);xa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LUX"}]};xa.prototype._getDptFromRef=function(f){var a=
{channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":a.channel=0;a.dataPoint="LOWBAT";break;case "timeout":a.channel=0;a.dataPoint="UNREACH";break;case "state":a.dataPoint="LUX";break;default:return null}return a};xa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;d={};if(0==
f)return"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "LUX":d.state=b;break;default:return null}return d};var S=function(f,a,b){c.call(this,f,a,b);this.swChannel1=1;this.swChannel2=2;this.panicChannel=3;this.armingChannel=4;this.legacyType="siren2"};util.inherits(S,c);S.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.swChannel1,dpt:"STATE"},{channel:this.deviceAdr+":"+this.swChannel2,
dpt:"STATE"},{channel:this.deviceAdr+":"+this.panicChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ARMSTATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"LOWBAT"}]};S.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a,dataPoint:null};switch(f){case "timeout":b.channel=
0;b.dataPoint="UNREACH";break;case "switchSensorInState":b.channel=a+":"+this.swChannel1;b.dataPoint="STATE";break;case "switchSensorExState":b.channel=a+":"+this.swChannel2;b.dataPoint="STATE";break;case "switchPanicState":b.channel=a+":"+this.panicChannel;b.dataPoint="STATE";break;case "arming":b.channel=a+":"+this.armingChannel;b.dataPoint="ARMSTATE";break;case "inhibit":b.channel=a+":"+this.armingChannel;b.dataPoint="INHIBIT";break;case "working":b.channel=a+":"+this.armingChannel;b.dataPoint=
"WORKING";break;case "sabotage":b.channel=a+":"+this.armingChannel;b.dataPoint="ERROR_SABOTAGE";break;case "lowbat":b.channel=a+":"+this.armingChannel;b.dataPoint="LOWBAT";break;default:return null}return b};S.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d={};if(0==f)return"UNREACH"==a?d.timeout=b:d["0_"+a.toLowerCase()]=
b,d;if(1==f){switch(a){case "STATE":d.switchSensorInState=b?"on":"off";break;default:return null}return d}if(2==f){switch(a){case "STATE":d.switchSensorExState=b?"on":"off";break;default:return null}return d}if(3==f){switch(a){case "STATE":d.switchPanicState=b?"on":"off";break;default:return null}return d}if(4==f){switch(a){case "ARMSTATE":switch(b){case 0:d.arming="disarmed";break;case 1:d.arming="ex_armed";break;case 2:d.arming="all_armed";break;case 3:d.arming="blocked"}break;case "INHIBIT":d.inhibit=
b;break;case "WORKING":d.working=b;break;case "ERROR_SABOTAGE":switch(b){case 0:d.sabotage="no_error";break;case 1:d.sabotage="ex_armed"}break;case "LOWBAT":d.lowbat=b;break;default:return null}return d}};S.prototype.executeCommand=function(f,a,b){var d=this;switch(a){case "switchSensorInOn":var e="STATE";var c=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,c,e,!0,b);break;case "switchSensorInOff":e="STATE";c=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,c,e,!1,b);break;
case "switchSensorInToggle":e="STATE";c=this.deviceAdr+":"+this.swChannel1;f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,g){a?b&&b(a):(a=!0,g.value&&(a=!1),f.writeValue(d.deviceIF,c,e,a,b))});break;case "switchSensorExOn":e="STATE";c=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,c,e,!0,b);break;case "switchSensorExOff":e="STATE";c=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,c,e,!1,b);break;case "switchSensorExToggle":e="STATE";c=this.deviceAdr+
":"+this.swChannel2;f.getState({interface:this.deviceIF,channel:c,datapoint:e},function(a,g){a?b&&b(a):(a=!0,g.value&&(a=!1),f.writeValue(d.deviceIF,c,e,a,b))});break;case "switchPanicOn":e="STATE";c=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,c,e,!0,b);break;case "switchPanicOff":e="STATE";c=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,c,e,!1,b);break;case "switchPanicToggle":e="STATE";c=this.deviceAdr+":"+this.panicChannel;f.getState({interface:this.deviceIF,
channel:c,datapoint:e},function(a,g){a?b&&b(a):(a=!0,g.value&&(a=!1),f.writeValue(d.deviceIF,c,e,a,b))});break;case "armingDisarm":e="ARMSTATE";c=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,c,e,0,b);break;case "armingIntern":e="ARMSTATE";c=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,c,e,1,b);break;case "armingAll":e="ARMSTATE";c=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,c,e,2,b);break;default:b&&b(Error("no such command"))}};var T=function(f,
a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="jalousie"};util.inherits(T,c);T.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});(b=b.JALOUSIE.getReadableDpts())&&b.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};T.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":b.channel=
a+":0";b.dataPoint="UNREACH";break;default:if(b.channel=a+":"+this.channel,b.dataPoint=d.JALOUSIE.getDptFromState(f),!b.dataPoint)return null}return b};T.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["BidCos-RF"].JALOUSIE.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};T.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,
d));if(e!=c)return null;d=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a)return{timeout:b};d={};d["0_"+a.toLowerCase()]=b;return d}return f==this.channel?d.JALOUSIE.parseDptState(a,b):null};var B=function(f,a,b){c.call(this,f,a,b);this.keyChannel1=1;this.keyChannel2=2;this.em8bitChannel=3;this.legacyType="mod_em_8bit"};util.inherits(B,c);B.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var d=b.KEY.getReadableDpts();
d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b});f.push({channel:a.deviceAdr+":2",dpt:b})});(d=b.MOD_EM8BIT_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};B.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=a+":0";b.dataPoint="UNREACH";break;case "lowbat":b.channel=a+":3";b.dataPoint="LOWBAT";break;case "state8bit":b.channel=a+":3";b.dataPoint=
"STATE";break;default:return null}return b};B.prototype.executeCommand=function(f,a,b){var d=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "ch1pressShort":a=this.deviceAdr+":"+this.keyChannel1;d.KEY.executeCommand(f,this.deviceIF,a,"pressShort",b);break;case "ch1pressLong":a=this.deviceAdr+":"+this.keyChannel1;d.KEY.executeCommand(f,this.deviceIF,a,"pressLong",b);break;case "ch2pressShort":a=this.deviceAdr+":"+this.keyChannel2;d.KEY.executeCommand(f,this.deviceIF,a,"pressShort",b);break;case "ch2pressLong":a=
this.deviceAdr+":"+this.keyChannel2;d.KEY.executeCommand(f,this.deviceIF,a,"pressLong",b);break;default:b&&b(Error("no such command"))}};B.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["BidCos-RF"];d=null;if(0==f){if("UNREACH"==a)return{timeout:b};d={};d["0_"+a.toLowerCase()]=b;return d}if(f==this.keyChannel1){if(a=
e.KEY.parseDptState(a,b))d={},a.pressShort&&(d.ch1pressShort=!0),a.pressLong&&(d.ch1pressLong=!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(d.ch1pressCont=!0),a.pressLongRel&&(d.ch1pressLongRel=!0);return d}if(f==this.keyChannel2){if(a=e.KEY.parseDptState(a,b))d={},a.pressShort&&(d.ch2pressShort=!0),a.pressLong&&(d.ch2pressLong=!0),"undefined"!=typeof a.pressCont&&null!=a.pressCont&&(d.ch2pressCont=!0),a.pressLongRel&&(d.ch2pressLongRel=!0);return d}return f==this.em8bitChannel?e.MOD_EM8BIT_TRANSMITTER.parseDptState(a,
b):null};B.prototype.isButton=function(){return!0};B.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;f.reportValueUsage(this.deviceIF,b+":1","PRESS_SHORT",function(e,c){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);f.reportValueUsage(d.deviceIF,b+":1","PRESS_LONG",function(e,c){e&&console.error("button claim PRESS_LONG event error:"+e.stack);f.reportValueUsage(d.deviceIF,b+":2","PRESS_SHORT",function(e,
c){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);f.reportValueUsage(d.deviceIF,b+":2","PRESS_LONG",function(b,d){a&&a()})})})})};var C=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="mod_em_8"};util.inherits(C,c);C.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"],d=b.KEY.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});(d=b.SWITCH_INTERFACE.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+
":"+a.channel,dpt:b})});(d=b.SHUTTER_CONTACT.getReadableDpts())&&d.forEach(function(b){"ERROR"!=b&&f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};C.prototype._getDptFromRef=function(f){var a={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "state":a.dataPoint="STATE";break;case "lowbat":a.dataPoint="LOWBAT";break;default:return null}return a};C.prototype.executeCommand=function(f,a,b){var d=x.hub.m.hm._Channel["BidCos-RF"],e=this.deviceAdr+":"+this.channel;switch(a){case "pressShort":d.KEY.executeCommand(f,
this.deviceIF,e,"pressShort",b);break;case "pressLong":d.KEY.executeCommand(f,this.deviceIF,e,"pressLong",b);break;case "press":d.SWITCH_INTERFACE.executeCommand(f,this.deviceIF,e,"press",b);break;default:b&&b(Error("no such command"))}};C.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["BidCos-RF"];
e=null;if(f==this.channel){e={};if(f=d.KEY.parseDptState(a,b))f.pressShort&&(e.pressShort=!0),f.pressLong&&(e.pressLong=!0),"undefined"!=typeof f.pressCont&&null!=f.pressCont&&(e.pressCont=!0),f.pressLongRel&&(e.pressCont=!0);(f=d.SWITCH_INTERFACE.parseDptState(a,b))&&f.press&&(e.press=!0);if(f=d.SHUTTER_CONTACT.parseDptState(a,b))f.state&&(e.state=f.state),"undefined"!=typeof f.lowbat&&null!=f.lowbat&&(e.lowbat=f.lowbat)}return e};C.prototype.isButton=function(){return!0};C.prototype.claimEvent=
function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(e,c){e&&console.error("button claim PRESS_SHORT event error:"+e.stack);f.reportValueUsage(d.deviceIF,b,"PRESS_LONG",function(e,c){e&&console.error("button claim PRESS_LONG event error:"+e.stack);f.reportValueUsage(d.deviceIF,b,"PRESS",function(b,d){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);a&&a()})})})};var U=function(f,
a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="keymatic"};util.inherits(U,c);U.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"],d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.KEYMATIC.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};U.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=
a+":0";b.dataPoint="UNREACH";break;case "lowbat":b.channel=a+":0";b.dataPoint="LOWBAT";break;case "state":b.channel=a+":1";b.dataPoint="STATE";break;case "uncertain":b.channel=a+":1";b.dataPoint="STATE_UNCERTAIN";break;case "error":b.channel=a+":1";b.dataPoint="ERROR";break;default:return null}return b};U.prototype.executeCommand=function(f,a,b){var d=x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "open":a=this.deviceAdr+":"+this.channel;d.KEYMATIC.executeCommand(f,this.deviceIF,a,"open",b);break;
case "close":a=this.deviceAdr+":"+this.channel;d.KEYMATIC.executeCommand(f,this.deviceIF,a,"close",b);break;case "openDoor":a=this.deviceAdr+":"+this.channel;d.KEYMATIC.executeCommand(f,this.deviceIF,a,"openDoor",b);break;default:b&&b(Error("no such command"))}};U.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["BidCos-RF"];
if(0==f){if("UNREACH"==a||"LOWBAT"==a)return d.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return f==this.channel?a=d.KEYMATIC.parseDptState(a,b):null};var D=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ou_led16"};util.inherits(D,c);D.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this.channel,dpt:"LED_STATUS"}]};D.prototype._getDptFromRef=function(f){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);
a={channel:a,dataPoint:null};switch(f){case "led":a.dataPoint="LED_STATUS";break;default:return null}return a};D.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c||0!=f&&f!=this.channel)return null;if(0==f)return d={},"UNREACH"==a?d.timeout=b:"LOWBAT"==a?d.lowbat=b:d["0_"+a.toLowerCase()]=b,d;switch(a){case "LED_STATUS":switch(b){case 0:return{led:"off"};
case 1:return{led:"red"};case 2:return{led:"green"};case 3:return{led:"orange"};default:return null}default:return null}};D.prototype.executeCommand=function(f,a,b){var d=this.deviceAdr;-1==d.indexOf(":")&&this.channel&&(d+=":"+this.channel);switch(a){case "pressShort":f.writeValue(this.deviceIF,d,"PRESS_SHORT",!0,b);break;case "ledOff":f.writeValue(this.deviceIF,d,"LED_STATUS",0,b);break;case "ledRed":f.writeValue(this.deviceIF,d,"LED_STATUS",1,b);break;case "ledGreen":f.writeValue(this.deviceIF,
d,"LED_STATUS",2,b);break;case "ledOrange":f.writeValue(this.deviceIF,d,"LED_STATUS",3,b);break;case "ledSleepOff":f.writeValue(this.deviceIF,d,"LED_SLEEP_MODE",0,b);break;case "ledSleepOn":f.writeValue(this.deviceIF,d,"LED_SLEEP_MODE",1,b);break;default:b&&b(Error("no such command"))}};D.prototype.isButton=function(){return!0};D.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);f.reportValueUsage(this.deviceIF,b,"PRESS_SHORT",function(b,
f){b&&console.error("button claim PRESS_SHORT event error:"+b.stack);a&&a()})};var Ma=function(f,a,b){c.call(this,f,a,b);this.channel=3;this.legacyType="hm_dis_ep_wm55"};util.inherits(Ma,c);Ma.prototype.executeCommand=function(f,a,b){if("submit"==a.substr(0,6)){var d=a.substr(6);a=this.deviceAdr+":"+this.channel;f.writeValue(this.deviceIF,a,"SUBMIT",d,b)}else b&&b(Error("no such command"))};var V=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="dualwhite"};util.inherits(V,c);V.prototype._getReadableDpts=
function(){var f=[],a=this,b=x.hub.m.hm._Channel["BidCos-RF"],d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.DUAL_WHITE_BRIGHTNESS.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});(d=b.DUAL_WHITE_COLOR.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b})});return f};V.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},
d=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "bri":case "bri_real":case "error_overheat":case "error_reduced":case "direction":b.channel=a+":1";b.dataPoint=d.DUAL_WHITE_BRIGHTNESS.getDptFromState(f);break;case "color":case "color_real":case "color_direction":b.channel=a+":2";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return b};V.prototype.executeCommand=function(f,a,b){var d=
x.hub.m.hm._Channel["BidCos-RF"];switch(a){case "off":case "on":case "toggle":case "dimUp":case "dimDown":d.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b);break;case "colorOff":case "colorOn":case "colorToggle":case "colorUp":case "colorDown":d.DUAL_WHITE_COLOR.executeCommand(f,this.deviceIF,this.deviceAdr+":2",a,b);break;default:"dimTo"==a.substr(0,5)?d.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b):"colorTo"==a.substr(0,7)?d.DUAL_WHITE_COLOR.executeCommand(f,
this.deviceIF,this.deviceAdr+":2",a,b):b&&b(Error("no such command"))}};V.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==a)return d.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.DUAL_WHITE_BRIGHTNESS.parseDptState(a,b):2==f?
d.DUAL_WHITE_COLOR.parseDptState(a,b):null};var Na=function(f,a,b){g.call(this,f,a,b);this.channel=3;this.legacyType="ip_switch"};util.inherits(Na,g);var ya=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_contact"};util.inherits(ya,c);ya.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.SHUTTER_CONTACT_TRANSCEIVER.getReadableDpts())&&
d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};ya.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":b.channel=a+":1";b.dataPoint=d.SHUTTER_CONTACT_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};ya.prototype.parseDptState=function(f,
a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return d.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.SHUTTER_CONTACT_TRANSCEIVER.parseDptState(a,b):null};var W=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_heater"};util.inherits(W,c);W.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&d.forEach(function(b){"HUMIDITY"!=b&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};W.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},
d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "mode":case "state":case "window":b.channel=a+":1";b.dataPoint=d.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};W.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+
":"+this.channel,a,b)};W.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return d.MAINTENANCE.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}return 1==f?d.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b):e};var X=function(f,a,
b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_powerswitch"};util.inherits(X,c);X.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(d=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+
":6",dpt:b})});return f};X.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "switchState":b.channel=a+":3";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":6";b.dataPoint=
d.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return b};X.prototype.executeCommand=function(f,a,b){var d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var e=this.deviceAdr+":3";d.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"on",b);break;case "off":e=this.deviceAdr+":3";d.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"off",b);break;case "toggle":e=this.deviceAdr+":3";d.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggle",b);break;
default:"onFor"==a.substr(0,5)?(e=this.deviceAdr+":3",d.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,a,b)):b&&b(Error("no such command"))}};X.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a)return d.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=
b;return d}return 3==f?d.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b):6==f?d.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var Y=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_energyactor"};util.inherits(Y,c);Y.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.SWITCH_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+
":3",dpt:b})});(d=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});(d=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":7",dpt:b})});return f};Y.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=
a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "switchState":b.channel=a+":3";b.dataPoint=d.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch4State":b.channel=a+":4";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch5State":b.channel=a+":5";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch6State":b.channel=a+":6";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=
a+":7";b.dataPoint=d.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return b};Y.prototype.executeCommand=function(f,a,b){var d=null,e=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch4on":case "ch5on":case "ch6on":switch(a){case "on":case "ch4on":d=this.deviceAdr+":4";break;case "ch5on":d=this.deviceAdr+":5";break;case "ch6on":d=this.deviceAdr+":6"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"on",b);break;case "off":case "ch4off":case "ch5off":case "ch6off":switch(a){case "off":case "ch4off":d=
this.deviceAdr+":4";break;case "ch5off":d=this.deviceAdr+":5";break;case "ch6off":d=this.deviceAdr+":6"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"off",b);break;case "toggle":case "ch4toggle":case "ch5toggle":case "ch6toggle":switch(a){case "toggle":case "ch4toggle":d=this.deviceAdr+":4";break;case "ch5toggle":d=this.deviceAdr+":5";break;case "ch6toggle":d=this.deviceAdr+":6"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"toggle",b);break;default:b&&b(Error("no such command"))}};
Y.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(3==f){if(a=e.SWITCH_TRANSMITTER.parseDptState(a,b))d={},d.switchState=a.switchTState;return d}if(4==f||5==f||6==f){if(a=e.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,
b))switch(d={},parseInt(f)){case 4:d.ch4State=a.switchState;break;case 5:d.ch5State=a.switchState;break;case 6:d.ch6State=a.switchState}return d}return 7==f?e.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var Z=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_energyactor2"};util.inherits(Z,c);Z.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+
":0",dpt:b})});(d=b.SWITCH_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});(d=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b});f.push({channel:a.deviceAdr+":3",dpt:b});f.push({channel:a.deviceAdr+":4",dpt:b})});(d=b.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":5",dpt:b})});return f};Z.prototype._getDptFromRef=function(f){var a=this.deviceAdr,
b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "switchState":b.channel=a+":1";b.dataPoint=d.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch2State":b.channel=a+":2";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":b.channel=a+":3";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":b.channel=
a+":4";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":b.channel=a+":5";b.dataPoint=d.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return b};Z.prototype.executeCommand=function(f,a,b){var d=null,e=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":case "ch2on":case "ch3on":case "ch4on":switch(a){case "on":case "ch2on":d=this.deviceAdr+":2";
break;case "ch3on":d=this.deviceAdr+":3";break;case "ch4on":d=this.deviceAdr+":4"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"on",b);break;case "off":case "ch2off":case "ch3off":case "ch4off":switch(a){case "off":case "ch2off":d=this.deviceAdr+":2";break;case "ch3off":d=this.deviceAdr+":3";break;case "ch4off":d=this.deviceAdr+":4"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"off",b);break;case "toggle":case "ch2toggle":case "ch3toggle":case "ch4toggle":switch(a){case "toggle":case "ch2toggle":d=
this.deviceAdr+":2";break;case "ch3toggle":d=this.deviceAdr+":3";break;case "ch4toggle":d=this.deviceAdr+":4"}e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"toggle",b);break;default:b&&b(Error("no such command"))}};Z.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==
f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(1==f){if(a=e.SWITCH_TRANSMITTER.parseDptState(a,b))d={},d.switchState=a.switchTState;return d}if(2==f||3==f||4==f){if(a=e.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b))switch(d={},parseInt(f)){case 2:d.ch2State=a.switchState;break;case 3:d.ch3State=a.switchState;break;case 4:d.ch4State=a.switchState}return d}return 5==f?e.ENERGIE_METER_TRANSMITTER.parseDptState(a,b):null};var aa=function(f,a,b){c.call(this,
f,a,b);this.channel=1;this.legacyType="ip_dimmer"};util.inherits(aa,c);aa.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.DIMMER_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(d=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+
":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});return f};aa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":b.channel=a+":3";b.dataPoint=d.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;case "ch5Level":b.channel=a+":5";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":b.channel=a+":6";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return b};aa.prototype.executeCommand=function(f,a,b){var d=null,e=x.hub.m.hm._Channel["HmIP-RF"],c=a;if(-1!=a.indexOf("dimUp")){var g=a.indexOf("dimUp");c=a.substr(0,g+5);var h=a.substr(g+5)}else-1!=a.indexOf("dimDown")?(g=a.indexOf("dimDown"),c=a.substr(0,g+
7),h=a.substr(g+7)):-1!=a.indexOf("dimTo")?(g=a.indexOf("dimTo"),c=a.substr(0,g+5),h=a.substr(g+5)):-1!=a.indexOf("toggleTo")&&(g=a.indexOf("toggleTo"),c=a.substr(0,g+8),h=a.substr(g+8));var k=this;switch(c){case "dimOff":e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","dimOff",function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","dimOff",function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+
":6","dimOff",b)})});break;case "dimUp":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get dimmer current value return invalid")):(h=d.value+h,1<h&&(h=1),h=Math.round(100*h),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","dimTo"+h,function(a,d){a?
b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","dimTo"+h,b)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get dimmer current value return invalid")):(h=d.value-h,0>h&&(h=0),h=Math.round(100*h),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
k.deviceIF,k.deviceAdr+":5","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","dimTo"+h,b)})}))});break;case "dimTo":if(!h){b&&b(Error("dimTo has no value"));break}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+
":6","dimTo"+h,function(a,d){a?b&&b(a,d):(d=h/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL",d,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!h){b&&b(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get dimmer current value return invalid")):(d.value&&(h=0),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,
k.deviceAdr+":4","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","dimTo"+h,b)})}))});break;case "ch4dimOff":case "ch5dimOff":case "ch6dimOff":switch(c){case "ch4dimOff":d=this.deviceAdr+":4";break;case "ch5dimOff":d=this.deviceAdr+":5";break;case "ch6dimOff":d=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
d,"dimOff",b);break;case "ch4dimUp":case "ch5dimUp":case "ch6dimUp":switch(c){case "ch4dimUp":d=this.deviceAdr+":4";break;case "ch5dimUp":d=this.deviceAdr+":5";break;case "ch6dimUp":d=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"dimUp"+h,b);break;case "ch4dimDown":case "ch5dimDown":case "ch6dimDown":switch(c){case "ch4dimDown":d=this.deviceAdr+":4";break;case "ch5dimDown":d=this.deviceAdr+":5";break;case "ch6dimDown":d=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,d,"dimDown"+h,b);break;case "ch4dimTo":case "ch5dimTo":case "ch6dimTo":switch(c){case "ch4dimTo":d=this.deviceAdr+":4";break;case "ch5dimTo":d=this.deviceAdr+":5";break;case "ch6dimTo":d=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"dimTo"+h,b);break;case "ch4toggleTo":case "ch5toggleTo":case "ch6toggleTo":switch(c){case "ch4toggleTo":d=this.deviceAdr+":4";break;case "ch5toggleTo":d=this.deviceAdr+":5";break;case "ch6toggleTo":d=this.deviceAdr+":6"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,d,"toggleTo"+h,b);break;default:b&&b(Error("no such command"))}};aa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(3==f){if(a=e.DIMMER_TRANSMITTER.parseDptState(a,
b))d={},d.dimmerLevel=a.dimmerTLevel;return d}if(4==f||5==f||6==f){if(a=e.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(d={},parseInt(f)){case 4:d.ch4Level=a.dimmerLevel;break;case 5:d.ch5Level=a.dimmerLevel;break;case 6:d.ch6Level=a.dimmerLevel}return d}return null};var ba=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_dimmer2"};util.inherits(ba,c);ba.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE.getReadableDpts();
d&&d.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.DIMMER_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b})});(d=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b});f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b})});return f};ba.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},
d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":b.channel=a+":2";b.dataPoint=d.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":b.channel=a+":3";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch5Level":b.channel=a+":4";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":b.channel=a+":5";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;default:return null}return b};ba.prototype.executeCommand=function(f,a,b){var d=null,e=x.hub.m.hm._Channel["HmIP-RF"],c=a;if(-1!=a.indexOf("dimUp")){var g=a.indexOf("dimUp");c=a.substr(0,g+5);var h=a.substr(g+5)}else-1!=a.indexOf("dimDown")?(g=a.indexOf("dimDown"),c=a.substr(0,g+7),h=a.substr(g+7)):-1!=a.indexOf("dimTo")?(g=a.indexOf("dimTo"),c=a.substr(0,g+5),h=a.substr(g+5)):-1!=a.indexOf("toggleTo")&&(g=a.indexOf("toggleTo"),c=a.substr(0,g+8),h=a.substr(g+8));var k=this;switch(c){case "dimOff":e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":3","dimOff",function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimOff",function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","dimOff",b)})});break;case "dimUp":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get dimmer current value return invalid")):(h=d.value+
h,1<h&&(h=1),h=Math.round(100*h),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":3","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","dimTo"+h,b)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==
typeof d||null==d?b&&b(Error("get dimmer current value return invalid")):(h=d.value-h,0>h&&(h=0),h=Math.round(100*h),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":3","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","dimTo"+h,b)})}))});break;case "dimTo":if(!h){b&&b(Error("dimTo has no value"));break}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":3","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","dimTo"+h,function(a,d){a?b&&b(a,d):(d=h/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":2","LEVEL",d,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!h){b&&b(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get dimmer current value return invalid")):(d.value&&(h=0),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":3","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","dimTo"+h,b)})}))});break;case "ch3dimOff":case "ch4dimOff":case "ch5dimOff":switch(c){case "ch3dimOff":d=
this.deviceAdr+":3";break;case "ch4dimOff":d=this.deviceAdr+":4";break;case "ch5dimOff":d=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"dimOff",b);break;case "ch3dimUp":case "ch4dimUp":case "ch5dimUp":switch(c){case "ch3dimUp":d=this.deviceAdr+":3";break;case "ch4dimUp":d=this.deviceAdr+":4";break;case "ch5dimUp":d=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"dimUp"+h,b);break;case "ch3dimDown":case "ch4dimDown":case "ch5dimDown":switch(c){case "ch3dimDown":d=
this.deviceAdr+":3";break;case "ch4dimDown":d=this.deviceAdr+":4";break;case "ch5dimDown":d=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"dimDown"+h,b);break;case "ch3dimTo":case "ch4dimTo":case "ch5dimTo":switch(c){case "ch3dimTo":d=this.deviceAdr+":3";break;case "ch4dimTo":d=this.deviceAdr+":4";break;case "ch5dimTo":d=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"dimTo"+h,b);break;case "ch3toggleTo":case "ch4toggleTo":case "ch5toggleTo":switch(c){case "ch3toggleTo":d=
this.deviceAdr+":3";break;case "ch4toggleTo":d=this.deviceAdr+":4";break;case "ch5toggleTo":d=this.deviceAdr+":5"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"toggleTo"+h,b);break;default:b&&b(Error("no such command"))}};ba.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=
null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(2==f){if(a=e.DIMMER_TRANSMITTER.parseDptState(a,b))d={},d.dimmerLevel=a.dimmerTLevel;return d}if(3==f||4==f||5==f){if(a=e.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(d={},parseInt(f)){case 3:d.ch3Level=a.dimmerLevel;break;case 4:d.ch4Level=a.dimmerLevel;break;case 5:d.ch5Level=a.dimmerLevel}return d}return null};var ca=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_dimmer3"};util.inherits(ca,c);ca.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.DIMMER_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});(d=b.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b});f.push({channel:a.deviceAdr+":3",dpt:b});
f.push({channel:a.deviceAdr+":4",dpt:b})});return f};ca.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":b.channel=a+":1";b.dataPoint=d.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch2Level":b.channel=a+":2";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;
case "ch3Level":b.channel=a+":3";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return b};ca.prototype.executeCommand=function(f,a,b){var d=null,e=x.hub.m.hm._Channel["HmIP-RF"],c=a;if(-1!=a.indexOf("dimUp")){var g=a.indexOf("dimUp");c=a.substr(0,g+5);var h=a.substr(g+5)}else-1!=a.indexOf("dimDown")?(g=a.indexOf("dimDown"),c=a.substr(0,g+7),h=
a.substr(g+7)):-1!=a.indexOf("dimTo")?(g=a.indexOf("dimTo"),c=a.substr(0,g+5),h=a.substr(g+5)):-1!=a.indexOf("toggleTo")&&(g=a.indexOf("toggleTo"),c=a.substr(0,g+8),h=a.substr(g+8));var k=this;switch(c){case "dimOff":e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":2","dimOff",function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":3","dimOff",function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+
":4","dimOff",b)})});break;case "dimUp":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get dimmer current value return invalid")):(h=d.value+h,1<h&&(h=1),h=Math.round(100*h),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":2","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":3","dimTo"+h,function(a,d){a?
b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimTo"+h,b)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get dimmer current value return invalid")):(h=d.value-h,0>h&&(h=0),h=Math.round(100*h),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":2","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
k.deviceIF,k.deviceAdr+":3","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimTo"+h,b)})}))});break;case "dimTo":if(!h){b&&b(Error("dimTo has no value"));break}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":2","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":3","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+
":4","dimTo"+h,function(a,d){a?b&&b(a,d):(d=h/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":1","LEVEL",d,(new Date).getTime()+1E3),b&&b(a))})})});break;case "toggleTo":if(!h){b&&b(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get dimmer current value return invalid")):(d.value&&(h=0),e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,
k.deviceAdr+":2","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":3","dimTo"+h,function(a,d){a?b&&b(a,d):e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","dimTo"+h,b)})}))});break;case "ch2dimOff":case "ch3dimOff":case "ch4dimOff":switch(c){case "ch2dimOff":d=this.deviceAdr+":2";break;case "ch3dimOff":d=this.deviceAdr+":3";break;case "ch4dimOff":d=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
d,"dimOff",b);break;case "ch2dimUp":case "ch3dimUp":case "ch4dimUp":switch(c){case "ch2dimUp":d=this.deviceAdr+":2";break;case "ch3dimUp":d=this.deviceAdr+":3";break;case "ch4dimUp":d=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"dimUp"+h,b);break;case "ch2dimDown":case "ch3dimDown":case "ch4dimDown":switch(c){case "ch2dimDown":d=this.deviceAdr+":2";break;case "ch3dimDown":d=this.deviceAdr+":3";break;case "ch4dimDown":d=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,d,"dimDown"+h,b);break;case "ch2dimTo":case "ch3dimTo":case "ch4dimTo":switch(c){case "ch2dimTo":d=this.deviceAdr+":2";break;case "ch3dimTo":d=this.deviceAdr+":3";break;case "ch4dimTo":d=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"dimTo"+h,b);break;case "ch2toggleTo":case "ch3toggleTo":case "ch4toggleTo":switch(c){case "ch2toggleTo":d=this.deviceAdr+":2";break;case "ch3toggleTo":d=this.deviceAdr+":3";break;case "ch4toggleTo":d=this.deviceAdr+":4"}e.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,d,"toggleTo"+h,b);break;default:b&&b(Error("no such command"))}};ca.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(1==f){if(a=e.DIMMER_TRANSMITTER.parseDptState(a,
b))d={},d.dimmerLevel=a.dimmerTLevel;return d}if(2==f||3==f||4==f){if(a=e.DIMMER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(d={},parseInt(f)){case 2:d.ch2Level=a.dimmerLevel;break;case 3:d.ch3Level=a.dimmerLevel;break;case 4:d.ch4Level=a.dimmerLevel}return d}return null};var da=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_motion"};util.inherits(da,c);da.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();
d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};da.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":b.channel=
a+":1";b.dataPoint=d.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};da.prototype.executeCommand=function(f,a,b){var d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":d.MOTIONDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b);break;default:b&&b(Error("no such command"))}};da.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=
f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return d.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,b):null};var E=function(f,a,b){c.call(this,f,a,b);this.channel=3;this.legacyType="ip_motion2"};util.inherits(E,c);E.prototype._getReadableDpts=function(){var f=
[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};E.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=
d.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":b.channel=a+":3";b.dataPoint=d.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};E.prototype.executeCommand=function(f,a,b){switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":break;default:b&&b(Error("no such command"))}};E.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=
this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return d.MAINTENANCE_BAT_EL.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}1==f&&(c=d.KEY_TRANRECEIVER.parseDptState(a,b))&&(c.pressShort&&(e={btn1pressShort:!0}),c.pressLong&&(e={btn1pressLong:!0}));2==f&&(c=d.KEY_TRANRECEIVER.parseDptState(a,b))&&(c.pressShort&&(e={btn2pressShort:!0}),c.pressLong&&(e={btn2pressLong:!0}));
return 3==f?d.MOTIONDETECTOR_TRANSCEIVER.parseDptState(a,b):e};E.prototype.isButton=function(){return!0};E.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,e){b&&console.error("button:1 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(d.deviceIF,d.deviceAdr+":1","PRESS_LONG",function(b,e){b&&console.error("button:1 claim PRESS_LONG event error:"+
b.stack);f.reportValueUsage(d.deviceIF,d.deviceAdr+":2","PRESS_SHORT",function(b,e){b&&console.error("button:2 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(d.deviceIF,d.deviceAdr+":2","PRESS_LONG",function(b,d){b&&console.error("button:2 claim PRESS_LONG event error:"+b.stack);a&&a()})})})})};var M=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_button"};util.inherits(M,c);M.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();
b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};M.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};M.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=
this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}f==this.channel&&(a=e.KEY_TRANRECEIVER.parseDptState(a,b))&&(a.pressShort&&(d={pressShort:!0}),a.pressLong&&(d={pressLong:!0}));return d};M.prototype.isButton=function(){return!0};M.prototype.claimEvent=function(f,a){var b=this.deviceAdr;
-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,e){b&&console.error("button:1 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(d.deviceIF,d.deviceAdr+":1","PRESS_LONG",function(b,d){b&&console.error("button:1 claim PRESS_LONG event error:"+b.stack);a&&a()})})};var N=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_button2"};util.inherits(N,c);N.prototype._getReadableDpts=
function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};N.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};N.prototype.parseDptState=function(f,
a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return d.MAINTENANCE_BAT_EL.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}1==f&&(c=d.KEY_TRANRECEIVER.parseDptState(a,b))&&(c.pressShort&&(e={btn1pressShort:!0}),c.pressLong&&(e={btn1pressLong:!0}));2==f&&(c=d.KEY_TRANRECEIVER.parseDptState(a,
b))&&(c.pressShort&&(e={btn2pressShort:!0}),c.pressLong&&(e={btn2pressLong:!0}));return e};N.prototype.isButton=function(){return!0};N.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(b,e){b&&console.error("button:1 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(d.deviceIF,d.deviceAdr+":1","PRESS_LONG",function(b,e){b&&console.error("button:1 claim PRESS_LONG event error:"+
b.stack);f.reportValueUsage(d.deviceIF,d.deviceAdr+":2","PRESS_SHORT",function(b,e){b&&console.error("button:2 claim PRESS_SHORT event error:"+b.stack);f.reportValueUsage(d.deviceIF,d.deviceAdr+":2","PRESS_LONG",function(b,d){b&&console.error("button:2 claim PRESS_LONG event error:"+b.stack);a&&a()})})})})};var F=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_button4"};util.inherits(F,c);F.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();
b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};F.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};F.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=
this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(1==f||2==f||3==f||4==f)if(a=e.KEY_TRANRECEIVER.parseDptState(a,b))d||(d={}),a.pressShort&&(d["btn"+f+"pressShort"]=!0),a.pressLong&&(d["btn"+f+"pressLong"]=!0);return d};F.prototype.isButton=function(){return!0};F.prototype.claimEvent=
function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;this._claimButtonEvent(1,f,function(){d._claimButtonEvent(2,f,function(){d._claimButtonEvent(3,f,function(){d._claimButtonEvent(4,f,function(){a&&a()})})})})};F.prototype._claimButtonEvent=function(f,a,b){var d=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(e,c){e&&console.error("button:"+f+" claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(d.deviceIF,
d.deviceAdr+":"+f,"PRESS_LONG",function(a,d){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var G=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_button6"};util.inherits(G,c);G.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};G.prototype._getDptFromRef=function(f){var a=this.deviceAdr,
b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};G.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==
a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(1==f||2==f||3==f||4==f||5==f||6==f)if(a=e.KEY_TRANRECEIVER.parseDptState(a,b))d||(d={}),a.pressShort&&(d["btn"+f+"pressShort"]=!0),a.pressLong&&(d["btn"+f+"pressLong"]=!0);return d};G.prototype.isButton=function(){return!0};G.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;this._claimButtonEvent(1,f,function(){d._claimButtonEvent(2,
f,function(){d._claimButtonEvent(3,f,function(){d._claimButtonEvent(4,f,function(){d._claimButtonEvent(5,f,function(){d._claimButtonEvent(6,f,function(){a&&a()})})})})})})};G.prototype._claimButtonEvent=function(f,a,b){var d=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(e,c){e&&console.error("button:"+f+" claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(d.deviceIF,d.deviceAdr+":"+f,"PRESS_LONG",function(a,d){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+
a.stack);b&&b()})})};var ea=function(f,a,b){c.call(this,f,a,b);this.channel=3;this.legacyType="ip_siren"};util.inherits(ea,c);ea.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.ALARM_SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});return f};ea.prototype._getDptFromRef=function(f){var a=
this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":b.channel=a+":3";b.dataPoint=d.ALARM_SWITCH_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return b};ea.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].ALARM_SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+
":3",a,b)};ea.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return d.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 3==f?d.ALARM_SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b):null};var y=function(f,
a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_wallthermo"};util.inherits(y,c);y.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&d.forEach(function(b){"LEVEL"!=b&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};y.prototype._getDptFromRef=function(f){var a=this.deviceAdr,
b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":b.channel=a+":1";b.dataPoint=d.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};y.prototype.executeCommand=function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};y.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return d.MAINTENANCE_BAT_EL.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}return 1==f?d.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,
b):e};var za=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_wallthermo2"};util.inherits(za,y);za.prototype._getReadableDpts=function(){var f=y.prototype._getReadableDpts.call(this);f||(f=[]);var a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":8",dpt:b})});(d=b.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":10",dpt:b})});
return f};za.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "valveState":b.channel=a+":10";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "cl_fd_emergencyOP":case "cl_fd_frostProtection":case "cl_fd_state":case "cl_fd_humidityAlarm":b.channel=a+":8";b.dataPoint=d.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getDptFromState(f);break;default:return y.prototype._getDptFromRef.call(this,
f)}return b};za.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(1==f)return e.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(a,b);if(8==f)return e.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.parseDptState(a,
b);10==f&&(d={},a=e.SWITCH_VIRTUAL_RECEIVER.parseDptState(a,b),d.valveState=a?a.switchState:"?");return d};var fa=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_smoke"};util.inherits(fa,c);fa.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.SMOKE_DETECTOR.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+
":1",dpt:b})});return f};fa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":b.channel=a+":1";b.dataPoint=d.SMOKE_DETECTOR.getDptFromState(f);break;default:return null}return b};fa.prototype.executeCommand=
function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].SMOKE_DETECTOR.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,b)};fa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return d.MAINTENANCE.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=
b;return e}return 1==f?d.SMOKE_DETECTOR.parseDptState(a,b):e};var Aa=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_window"};util.inherits(Aa,c);Aa.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.ROTARY_HANDLE_TRANSCEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Aa.prototype._getDptFromRef=
function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":b.channel=a+":1";b.dataPoint=d.ROTARY_HANDLE_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};Aa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;
d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return d.MAINTENANCE_BAT_EL.parseDptState(a,b);e={};e["0_"+a.toLowerCase()]=b;return e}return 1==f?d.ROTARY_HANDLE_TRANSCEIVER.parseDptState(a,b):e};var H=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_blind"};util.inherits(H,c);H.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],
d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.SHUTTER_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(d=b.SHUTTER_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});return f};H.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+
":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "blindLevel":b.channel=a+":3";b.dataPoint=d.SHUTTER_TRANSMITTER.getDptFromState("blindTLevel");break;case "ch4Level":b.channel=a+":4";b.dataPoint=d.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch5Level":b.channel=a+":5";b.dataPoint=d.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch6Level":b.channel=
a+":6";b.dataPoint=d.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;default:return null}return b};H.prototype.executeCommand=function(f,a,b){var d=null,e=x.hub.m.hm._Channel["HmIP-RF"],c=a;if(-1!=a.indexOf("stepUp")){var g=a.indexOf("stepUp");c=a.substr(0,g+6);var h=a.substr(g+6)}else-1!=a.indexOf("stepDown")?(g=a.indexOf("stepDown"),c=a.substr(0,g+8),h=a.substr(g+8)):-1!=a.indexOf("moveTo")?(g=a.indexOf("moveTo"),c=a.substr(0,g+6),h=a.substr(g+6)):-1!=a.indexOf("stop")&&(g=a.indexOf("stop"),
c=a.substr(0,g+4),h=a.substr(g+4));var k=this;switch(c){case "stop":e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","stop",function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","stop",function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","stop",b)})});break;case "moveUp":e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveUp",function(a,d){a?b&&b(a,d):
e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveUp",function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","moveUp",b)})});break;case "moveDown":e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveDown",function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveDown",function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+
":6","moveDown",b)})});break;case "stepUp":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get blind current value return invalid")):(h=d.value+h,1<h&&(h=1),h=Math.round(100*h),e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","moveTo"+h,function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveTo"+h,function(a,
d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","moveTo"+h,function(a,d){a?b&&b(a,d):(d=h/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL",d,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "stepDown":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get blind current value return invalid")):(h=d.value-
h,0>h&&(h=0),h=Math.round(100*h),e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","moveTo"+h,function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveTo"+h,function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","moveTo"+h,function(a,d){a?b&&b(a,d):(d=h/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL",d,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "moveTo":if(!h){b&&
b(Error("moveTo has no value"));break}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveTo"+h,function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveTo"+h,function(a,d){a?b&&b(a,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","moveTo"+h,function(a,d){a?b&&b(a,d):(d=h/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL",d,(new Date).getTime()+1E3),b&&b(a))})})});
break;case "ch4stop":case "ch5stop":case "ch6stop":switch(c){case "ch4stop":d=this.deviceAdr+":4";break;case "ch5stop":d=this.deviceAdr+":5";break;case "ch6stop":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"stop",b);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(c){case "ch4moveUp":d=this.deviceAdr+":4";break;case "ch5moveUp":d=this.deviceAdr+":5";break;case "ch6moveUp":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
d,"moveUp",b);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(c){case "ch4moveDown":d=this.deviceAdr+":4";break;case "ch5moveDown":d=this.deviceAdr+":5";break;case "ch6moveDown":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"moveDown",b);break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(c){case "ch4stepUp":d=this.deviceAdr+":4";break;case "ch5stepUp":d=this.deviceAdr+":5";break;case "ch6stepUp":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,d,"stepUp"+h,b);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(c){case "ch4stepDown":d=this.deviceAdr+":4";break;case "ch5stepDown":d=this.deviceAdr+":5";break;case "ch6stepDown":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"stepDown"+h,b);break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(c){case "ch4moveTo":d=this.deviceAdr+":4";break;case "ch5moveTo":d=this.deviceAdr+":5";break;case "ch6moveTo":d=this.deviceAdr+
":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"moveTo"+h,b);break;default:b&&b(Error("no such command"))}};H.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(3==
f){if(a=e.SHUTTER_TRANSMITTER.parseDptState(a,b))d={},d.blindLevel=a.blindTLevel;return d}if(4==f||5==f||6==f){if(a=e.SHUTTER_VIRTUAL_RECEIVER.parseDptState(a,b))switch(d={},parseInt(f)){case 4:d.ch4Level=a.blindLevel;break;case 5:d.ch5Level=a.blindLevel;break;case 6:d.ch6Level=a.blindLevel}return d}return null};H.prototype.getConfig=function(f,a){var b=this.deviceAdr+":3";f.getParamset(this.deviceIF,b,"MASTER",function(d,f){if(d)a&&a(d);else{var e={},c=null;f&&(c={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});e[b]=c;a&&a(d,e)}})};H.prototype.setConfig=function(f,a,b){if(a){var d=this.deviceAdr+":3";if(a=a[d]){var e={};e.CHANGE_OVER_DELAY=
{__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};e.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE=
{__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};f.setParamset(this.deviceIF,d,"MASTER",e,function(a){b&&b(a)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var I=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_jalousie"};util.inherits(I,c);I.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE.getReadableDpts();d&&d.forEach(function(b){"UNREACH"==b&&f.push({channel:a.deviceAdr+
":0",dpt:b})});(d=b.BLIND_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":3",dpt:b})});(d=b.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":4",dpt:b});f.push({channel:a.deviceAdr+":5",dpt:b});f.push({channel:a.deviceAdr+":6",dpt:b})});return f};I.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":b.channel=
a+":0";b.dataPoint=d.MAINTENANCE.getDptFromState(f);break;case "blindLevel":b.channel=a+":3";b.dataPoint=d.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":b.channel=a+":3";b.dataPoint=d.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;case "ch4blindLevel":b.channel=a+":4";b.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch4lamellaLevel":b.channel=a+":4";b.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch5blindLevel":b.channel=
a+":5";b.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch5lamellaLevel":b.channel=a+":5";b.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch6blindLevel":b.channel=a+":6";b.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch6lamellaLevel":b.channel=a+":6";b.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;default:return null}return b};I.prototype.executeCommand=function(f,a,b){var d=null,e=x.hub.m.hm._Channel["HmIP-RF"],
c=a;if(-1!=a.indexOf("stepUp")){var h=a.indexOf("stepUp");c=a.substr(0,h+6);var g=a.substr(h+6)}else-1!=a.indexOf("stepDown")?(h=a.indexOf("stepDown"),c=a.substr(0,h+8),g=a.substr(h+8)):-1!=a.indexOf("moveTo")?(h=a.indexOf("moveTo"),c=a.substr(0,h+6),g=a.substr(h+6)):-1!=a.indexOf("stop")?(h=a.indexOf("stop"),c=a.substr(0,h+4),g=a.substr(h+4)):-1!=a.indexOf("lamellaStepUp")?(h=a.indexOf("lamellaStepUp"),c=a.substr(0,h+13),g=a.substr(h+13)):-1!=a.indexOf("lamellaStepDown")?(h=a.indexOf("lamellaStepDown"),
c=a.substr(0,h+15),g=a.substr(h+15)):-1!=a.indexOf("lamellaTo")&&(h=a.indexOf("lamellaTo"),c=a.substr(0,h+9),g=a.substr(h+9));var k=this;switch(c){case "stop":case "moveUp":case "moveDown":e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4",c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5",c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6",c,b)})});break;case "lamellaUp":case "lamellaDown":f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get blind current value return invalid")):(g=d.value,g=Math.round(100*g),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4",c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","moveTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5",c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
k.deviceIF,k.deviceAdr+":5","moveTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6",c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","moveTo"+g,function(a,d){b&&b(a,d)})})})})})}))});break;case "stepUp":g=g?parseInt(g)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get blind current value return invalid")):
(g=d.value+g,1<g&&(g=1),g=Math.round(100*g),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","moveTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","moveTo"+g,function(a,d){a?b&&b(a,d):(d=g/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL",d,(new Date).getTime()+1E3),b&&b(a))})})}))});break;
case "stepDown":g=g?parseInt(g)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get blind current value return invalid")):(g=d.value-g,0>g&&(g=0),g=Math.round(100*g),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","moveTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
k.deviceIF,k.deviceAdr+":6","moveTo"+g,function(a,d){a?b&&b(a,d):(d=g/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL",d,(new Date).getTime()+1E3),b&&b(a))})})}))});break;case "moveTo":if(!g){b&&b(Error("moveTo has no value"));break}e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
k.deviceIF,k.deviceAdr+":6","moveTo"+g,function(a,d){a?b&&b(a,d):(d=g/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL",d,(new Date).getTime()+1E3),b&&b(a))})})});break;case "lamellaStepUp":g=g?parseInt(g)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){if(a)b&&b(a);else if("undefined"==typeof d||null==d)b&&b(Error("get blind current value return invalid"));else{var c=d.value;c=Math.round(100*c);f.getState({interface:k.deviceIF,
channel:k.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get lamella current value return invalid")):(g=d.value+g,1<g&&(g=1),g=Math.round(100*g),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","lamellaTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","moveTo"+c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","lamellaTo"+g,
function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveTo"+c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","lamellaTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","moveTo"+c,function(a,d){a?b&&b(a,d):(d=g/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL_2",d,(new Date).getTime()+1E3),b&&b(a))})})})})})}))})}});break;
case "lamellaStepDown":g=g?parseInt(g)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){if(a)b&&b(a);else if("undefined"==typeof d||null==d)b&&b(Error("get blind current value return invalid"));else{var c=d.value;c=Math.round(100*c);f.getState({interface:k.deviceIF,channel:k.deviceAdr+":3",datapoint:"LEVEL_2"},function(a,d){a?b&&b(a):"undefined"==typeof d||null==d?b&&b(Error("get lamella current value return invalid")):(g=d.value-g,0>g&&(g=0),
g=Math.round(100*g),e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","lamellaTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","moveTo"+c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","lamellaTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","moveTo"+c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,
k.deviceAdr+":6","lamellaTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","moveTo"+c,function(a,d){a?b&&b(a,d):(d=g/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL_2",d,(new Date).getTime()+1E3),b&&b(a))})})})})})}))})}});break;case "lamellaTo":if(!g){b&&b(Error("lamellaTo has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(a,d){if(a)b&&b(a);else if("undefined"==
typeof d||null==d)b&&b(Error("get blind current value return invalid"));else{var c=d.value;c=Math.round(100*c);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","lamellaTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":4","moveTo"+c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":5","lamellaTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+
":5","moveTo"+c,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","lamellaTo"+g,function(a,d){a?b&&b(a,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,k.deviceAdr+":6","moveTo"+c,function(a,d){a?b&&b(a,d):(d=g/100,1<d&&(d=1),0>d&&(d=0),f.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL_2",d,(new Date).getTime()+1E3),b&&b(a))})})})})})})}});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(c){case "ch4stop":d=this.deviceAdr+":4";break;
case "ch5stop":d=this.deviceAdr+":5";break;case "ch6stop":d=this.deviceAdr+":6"}e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"stop",b);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(c){case "ch4moveUp":d=this.deviceAdr+":4";break;case "ch5moveUp":d=this.deviceAdr+":5";break;case "ch6moveUp":d=this.deviceAdr+":6"}e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"moveUp",b);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(c){case "ch4moveDown":d=
this.deviceAdr+":4";break;case "ch5moveDown":d=this.deviceAdr+":5";break;case "ch6moveDown":d=this.deviceAdr+":6"}e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"moveDown",b);break;case "ch4lamellaUp":case "ch5lamellaUp":case "ch6lamellaUp":switch(c){case "ch4lamellaUp":d=this.deviceAdr+":4";break;case "ch5lamellaUp":d=this.deviceAdr+":5";break;case "ch6lamellaUp":d=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==
typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var g=c.value;g=Math.round(100*g);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"lamellaUp",function(a,c){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"moveTo"+g,function(a,d){b&&b(a,d)})})}});break;case "ch4lamellaDown":case "ch5lamellaDown":case "ch6lamellaDown":switch(c){case "ch4lamellaDown":d=this.deviceAdr+":4";break;case "ch5lamellaDown":d=this.deviceAdr+":5";break;case "ch6lamellaDown":d=
this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var g=c.value;g=Math.round(100*g);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"lamellaDown",function(a,c){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"moveTo"+g,function(a,d){b&&b(a,d)})})}});break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(c){case "ch4stepUp":d=
this.deviceAdr+":4";break;case "ch5stepUp":d=this.deviceAdr+":5";break;case "ch6stepUp":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"stepUp"+g,b);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(c){case "ch4stepDown":d=this.deviceAdr+":4";break;case "ch5stepDown":d=this.deviceAdr+":5";break;case "ch6stepDown":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"stepDown"+g,b);break;case "ch4lamellaStepUp":case "ch5lamellaStepUp":case "ch6lamellaStepUp":switch(c){case "ch4lamellaStepUp":d=
this.deviceAdr+":4";break;case "ch5lamellaStepUp":d=this.deviceAdr+":5";break;case "ch6lamellaStepUp":d=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var h=c.value;h=Math.round(100*h);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"lamellaStepUp"+g,function(a,c){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"moveTo"+
h,function(a,d){b&&b(a,d)})})}});break;case "ch4lamellaStepDown":case "ch5lamellaStepDown":case "ch6lamellaStepDown":switch(c){case "ch4lamellaStepDown":d=this.deviceAdr+":4";break;case "ch5lamellaStepDown":d=this.deviceAdr+":5";break;case "ch6lamellaStepDown":d=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var h=c.value;h=Math.round(100*
h);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"lamellaStepDown"+g,function(a,c){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"moveTo"+h,function(a,d){b&&b(a,d)})})}});break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(c){case "ch4moveTo":d=this.deviceAdr+":4";break;case "ch5moveTo":d=this.deviceAdr+":5";break;case "ch6moveTo":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,d,"moveTo"+g,b);break;case "ch4lamellaTo":case "ch5lamellaTo":case "ch6lamellaTo":switch(c){case "ch4lamellaTo":d=
this.deviceAdr+":4";break;case "ch5lamellaTo":d=this.deviceAdr+":5";break;case "ch6lamellaTo":d=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(a,c){if(a)b&&b(a);else if("undefined"==typeof c||null==c)b&&b(Error("get blind current value return invalid"));else{var h=c.value;h=Math.round(100*h);e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"lamellaTo"+g,function(a,c){a?b&&b(a):e.BLIND_VIRTUAL_RECEIVER.executeCommand(f,k.deviceIF,d,"moveTo"+h,function(a,
d){b&&b(a,d)})})}});break;default:b&&b(Error("no such command"))}};I.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a)return e.MAINTENANCE.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(3==f){if(b=e.BLIND_TRANSMITTER.parseDptState(a,b))d={},"LEVEL"==
a?d.blindLevel=b.blindTPos:"LEVEL_2"==a&&(d.lamellaLevel=b.lamellaTPos);return d}if(4==f||5==f||6==f){if(b=e.BLIND_VIRTUAL_RECEIVER.parseDptState(a,b))switch(d={},parseInt(f)){case 4:"LEVEL"==a?d.ch4blindLevel=b.blindPos:"LEVEL_2"==a&&(d.ch4lamellaLevel=b.lamellaPos);break;case 5:"LEVEL"==a?d.ch5blindLevel=b.blindPos:"LEVEL_2"==a&&(d.ch5lamellaLevel=b.lamellaPos);break;case 6:"LEVEL"==a?d.ch6blindLevel=b.blindPos:"LEVEL_2"==a&&(d.ch6lamellaLevel=b.lamellaPos)}return d}return null};I.prototype.getConfig=
function(f,a){var b=this.deviceAdr+":3";f.getParamset(this.deviceIF,b,"MASTER",function(d,f){if(d)a&&a(d);else{var e={},c=null;f&&(c={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,
REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});e[b]=c;a&&a(d,e)}})};I.prototype.setConfig=function(f,a,b){if(a){var d=this.deviceAdr+":3";if(a=a[d]){var e={};e.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:a.CHANGE_OVER_DELAY};e.REFERENCE_RUN_COUNTER=a.REFERENCE_RUN_COUNTER;e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE=
{__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};e.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_UNIT};e.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:a.REFERENCE_RUNNING_TIME_SLATS_VALUE};
f.setParamset(this.deviceIF,d,"MASTER",e,function(a){b&&b(a)})}else b&&b(Error("config data not complete"))}else b&&b(Error("config data invalid"))};var ha=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_presence"};util.inherits(ha,c);ha.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.PRESENCEDETECTOR_TRANSCEIVER.getReadableDpts())&&
d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};ha.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "current_illumination":case "active":b.channel=a+":1";b.dataPoint=d.PRESENCEDETECTOR_TRANSCEIVER.getDptFromState(f);break;
default:return null}return b};ha.prototype.executeCommand=function(f,a,b){var d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "reset":case "activate":case "deactivate":case "toggleActivate":d.PRESENCEDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",a,b);break;default:b&&b(Error("no such command"))}};ha.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&
(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"SABOTAGE"==a)return d.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.PRESENCEDETECTOR_TRANSCEIVER.parseDptState(a,b):null};var Ba=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_floor_heater"};util.inherits(Ba,c);Ba.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_TRANSCEIVER.getReadableDpts();
b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};Ba.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_f_humidityLimiter":case "cl_f_emergencyOP":case "cl_f_frostProtection":case "cl_f_state":case "cl_f_dewPointAlarm":case "cl_f_externalClock":b.channel=a+":"+this.channel;b.dataPoint=d.CLIMATECONTROL_FLOOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};
Ba.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?d.CLIMATECONTROL_FLOOR_TRANSCEIVER.parseDptState(a,b):null};var Ca=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_floor_pump_heater"};util.inherits(Ca,c);Ca.prototype._getReadableDpts=function(){var f=
[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};Ca.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_fp_humidityLimiter":case "cl_fp_emergencyOP":case "cl_fp_frostProtection":case "cl_fp_state":case "cl_fp_dewPointAlarm":case "cl_fp_externalClock":b.channel=
a+":"+this.channel;b.dataPoint=d.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};Ca.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?d.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.parseDptState(a,b):null};var Da=function(f,a,b){c.call(this,
f,a,b);this.channel=1;this.legacyType="ip_weather"};util.inherits(Da,c);Da.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_CL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.WEATHER_TRANSMIT.getReadableDpts())&&d.forEach(function(b){-1==b.indexOf("RAIN")&&-1==b.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Da.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b=
{channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=d.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Da.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,
d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return d.MAINTENANCE_BAT_CL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.WEATHER_TRANSMIT.parseDptState(a,b):null};var Ea=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_weather2"};util.inherits(Ea,c);Ea.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_CL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+
":0",dpt:b})});(d=b.WEATHER_TRANSMIT.getReadableDpts())&&d.forEach(function(b){-1==b.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ea.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=d.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;b.dataPoint=
f}return b};Ea.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return d.MAINTENANCE_BAT_CL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.WEATHER_TRANSMIT.parseDptState(a,b):null};var Fa=function(f,a,b){c.call(this,f,a,b);this.channel=
1;this.legacyType="ip_weather3"};util.inherits(Fa,c);Fa.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_CL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.CLIMATE_TRANSCEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Fa.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];
switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=d.CLIMATE_TRANSCEIVER.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Fa.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==
a||"LOW_BAT"==a)return d.MAINTENANCE_BAT_CL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.CLIMATE_TRANSCEIVER.parseDptState(a,b):null};var Ga=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_weather4"};util.inherits(Ga,c);Ga.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_CL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.WEATHER_TRANSMIT.getReadableDpts())&&
d.forEach(function(b){-1==b.indexOf("WIND_DIR")&&f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ga.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:b.channel=a+":1";f=d.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;b.dataPoint=f}return b};Ga.prototype.parseDptState=function(f,
a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return d.MAINTENANCE_BAT_CL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.WEATHER_TRANSMIT.parseDptState(a,b):null};var ia=function(f,a,b){c.call(this,f,a,b);this.channel=2;this.legacyType="ip_direction"};util.inherits(ia,
c);ia.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":2",dpt:b});f.push({channel:a.deviceAdr+":3",dpt:b})});return f};ia.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];
switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "ch2State":b.channel=a+":2";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":b.channel=a+":3";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":b.channel=a+":4";b.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;default:b.channel=a+":2";f=d.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getDptFromState(f);
if(!f)return null;b.dataPoint=f}return b};ia.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(2==f){if(a=e.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,
b))d={},"undefined"!=typeof a.current_direction&&(d.current_passage_r2l=a.current_direction),"undefined"!=typeof a.last_direction&&(d.last_passage_r2l=a.last_direction),"undefined"!=typeof a.passage_counter&&(d.r2l_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&(d.r2l_passage_counter_overflow=a.passage_counter_overflow);return d}if(3==f){if(a=e.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(a,b))d={},"undefined"!=typeof a.current_direction&&(d.current_passage_l2r=
a.current_direction),"undefined"!=typeof a.last_direction&&(d.last_passage_l2r=a.last_direction),"undefined"!=typeof a.passage_counter&&(d.l2r_passage_counter=a.passage_counter),"undefined"!=typeof a.passage_counter_overflow&&(d.l2r_passage_counter_overflow=a.passage_counter_overflow);return d}return null};ia.prototype.parseStates=function(f){var a={},b;for(b in f){var d=this.parseChnState(b,f[b]);d&&(a=x.hub.m.hm._Util.mergeObj(a,d))}a.current_passage_r2l&&a.current_passage_l2r&&(a.current_direction=
a.current_passage_r2l.value?{value:"right_to_left",time:a.current_passage_r2l.time}:{value:"left_to_right",time:a.current_passage_l2r.time});a.last_passage_r2l&&a.last_passage_l2r&&(a.last_direction=a.last_passage_r2l.value?{value:"right_to_left",time:a.last_passage_r2l.time}:{value:"left_to_right",time:a.last_passage_l2r.time});delete a.current_passage_r2l;delete a.current_passage_l2r;delete a.last_passage_r2l;delete a.last_passage_l2r;return a};var J=function(f,a,b){c.call(this,f,a,b);this.channel=
1;this.legacyType="ip_button8"};util.inherits(J,c);J.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};J.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);
break;default:return null}return b};J.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}if(1==f||2==f||3==f||4==f||5==f||6==f||7==f||8==f)if(a=e.KEY_TRANRECEIVER.parseDptState(a,
b))d||(d={}),a.pressShort&&(d["btn"+f+"pressShort"]=!0),a.pressLong&&(d["btn"+f+"pressLong"]=!0);return d};J.prototype.isButton=function(){return!0};J.prototype.claimEvent=function(f,a){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);var d=this;this._claimButtonEvent(1,f,function(){d._claimButtonEvent(2,f,function(){d._claimButtonEvent(3,f,function(){d._claimButtonEvent(4,f,function(){d._claimButtonEvent(5,f,function(){d._claimButtonEvent(6,f,function(){d._claimButtonEvent(7,
f,function(){d._claimButtonEvent(8,f,function(){a&&a()})})})})})})})})};J.prototype._claimButtonEvent=function(f,a,b){var d=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(e,c){e&&console.error("button:"+f+" claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(d.deviceIF,d.deviceAdr+":"+f,"PRESS_LONG",function(a,d){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var Ha=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType=
"ip_generic_input"};util.inherits(Ha,c);Ha.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].GENERIC_INPUT_TRANSMITER.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};Ha.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];b.channel=a+":"+this.channel;f=d.GENERIC_INPUT_TRANSMITER.getDptFromState(f);if(!f)return null;b.dataPoint=
f;return b};Ha.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?d.GENERIC_INPUT_TRANSMITER.parseDptState(a,b):null};var ja=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_analog_output"};util.inherits(ja,c);ja.prototype._getReadableDpts=function(){var f=
[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.getReadableDpts();b&&b.forEach(function(b){f.push({channel:a.deviceAdr+":"+a.channel,dpt:b})});return f};ja.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "outputLevel":b.channel=a+":"+this.channel;b.dataPoint=d.ANALOG_OUTPUT_TRANSCEIVER.getDptFromState("outputLevel");break;default:return null}return b};ja.prototype.executeCommand=
function(f,a,b){x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,a,function(a,f){b&&b(a,f)})};ja.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;f==this.channel&&(e=d.ANALOG_OUTPUT_TRANSCEIVER.parseDptState(a,b));
return e};var Ia=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_water"};util.inherits(Ia,c);Ia.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_CL.getReadableDpts();d&&d.forEach(function(b){f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.WATER_DETECTION_TRANSMITTER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ia.prototype._getDptFromRef=function(f){var a=this.deviceAdr,
b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(f);break;case "alarm":case "moisture":case "water":b.channel=a+":1";b.dataPoint=d.WATER_DETECTION_TRANSMITTER.getDptFromState(f);break;default:return null}return b};Ia.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");
-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a)return d.MAINTENANCE_BAT_CL.parseDptState(a,b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.WATER_DETECTION_TRANSMITTER.parseDptState(a,b):null};var Ja=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_acce"};util.inherits(Ja,c);Ja.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"],d=b.MAINTENANCE_BAT_EL.getReadableDpts();
d&&d.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});(d=b.ACCELERATION_TRANSCEIVER.getReadableDpts())&&d.forEach(function(b){f.push({channel:a.deviceAdr+":1",dpt:b})});return f};Ja.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "volatage":case "errorCode":case "sensorError":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);
break;case "motion":b.channel=a+":1";b.dataPoint=d.ACCELERATION_TRANSCEIVER.getDptFromState(f);break;default:return null}return b};Ja.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;d=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a||"SENSOR_ERROR"==a)return d.MAINTENANCE_BAT_EL.parseDptState(a,
b);d={};d["0_"+a.toLowerCase()]=b;return d}return 1==f?d.ACCELERATION_TRANSCEIVER.parseDptState(a,b):null};var z=function(f,a,b){c.call(this,f,a,b);this.channel=1;this.legacyType="ip_garagedoor"};util.inherits(z,c);z.prototype._getReadableDpts=function(){var f=[],a=this,b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();b&&b.forEach(function(b){"SABOTAGE"!=b&&f.push({channel:a.deviceAdr+":0",dpt:b})});return f};z.prototype._getDptFromRef=function(f){var a=this.deviceAdr,b={channel:a+
":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "voltage":case "errorCode":b.channel=a+":0";b.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return b};z.prototype.executeCommand=function(f,a,b){var d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "on":var e=this.deviceAdr+":3";d.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"onFor0.5",b);break;default:"onFor"==a.substr(0,5)?(e=this.deviceAdr+":3",
d.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,a,b)):b&&b(Error("no such command"))}};z.prototype.parseDptState=function(f,a,b){var d=f.indexOf(":");if(-1==d)return null;var e=f.substr(0,d);f=f.substr(d+1);var c=this.deviceAdr;d=this.deviceAdr.indexOf(":");-1!=d&&(c=this.deviceAdr.substr(0,d));if(e!=c)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==f){if("UNREACH"==a||"LOW_BAT"==a||"OPERATING_VOLTAGE"==a||"ERROR_CODE"==a)return e.MAINTENANCE_BAT_EL.parseDptState(a,b);d={};d["0_"+
a.toLowerCase()]=b;return d}if(1==f){if(a=e.KEY_TRANRECEIVER.parseDptState(a,b))d||(d={}),a.pressShort&&(d.btnPressShort=!0),a.pressLong&&(d.btnPressLong=!0);return d}return null};z.prototype.isButton=function(){return!0};z.prototype.claimEvent=function(f,a){this._claimButtonEvent(1,f,function(){a&&a()})};z.prototype._claimButtonEvent=function(f,a,b){var d=this;a.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(e,c){e&&console.error("button:"+f+" claim PRESS_SHORT event error:"+
e.stack);a.reportValueUsage(d.deviceIF,d.deviceAdr+":"+f,"PRESS_LONG",function(a,d){a&&console.error("button:"+f+" claim PRESS_LONG event error:"+a.stack);b&&b()})})};var Qa=function(){var f=function(a,b,d){c.call(this,a,b,d);this._chMaintenance=0;this._chKeyTransceiver1=1;this._chKeyTransceiver2=2;this._chSwitchTransmitter3=3;this._chSwitchVirtualReceiver4=4;this._chDimmerTransmitter7=7;this._chDimmerVirtualReceiver8=8;this._chDimmerTransmitter11=11;this._chDimmerVirtualReceiver12=12;this._chDimmerWeekProfile=
15;this.legacyType="ip_bsl"};util.inherits(f,c);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this._chSwitchTransmitter3,dpt:"STATE"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"COLOR"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"COLOR"}]};
f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "state":b.channel+=this._chSwitchTransmitter3;b.dataPoint="STATE";break;case "led1Level":b.channel+=this._chDimmerTransmitter7;b.dataPoint="LEVEL";break;case "led1Color":b.channel+=this._chDimmerTransmitter7;b.dataPoint="COLOR";break;case "led2Level":b.channel+=this._chDimmerTransmitter11;b.dataPoint="LEVEL";break;case "led2Color":b.channel+=
this._chDimmerTransmitter11;b.dataPoint="COLOR";break;default:return null}return b};f.prototype.executeCommand=function(a,b,d){var f=x.hub.m.hm._Channel["HmIP-RF"],e=this.getSerial();var c=b;if(-1!=b.indexOf("dimUp")){var g=b.indexOf("dimUp");c=b.substr(0,g+5);g=b.substr(g)}else-1!=b.indexOf("dimDown")?(g=b.indexOf("dimDown"),c=b.substr(0,g+7),g=b.substr(g)):-1!=b.indexOf("dimTo")?(g=b.indexOf("dimTo"),c=b.substr(0,g+5),g=b.substr(g)):-1!=b.indexOf("toggleTo")?(g=b.indexOf("toggleTo"),c=b.substr(0,
g+8),g=b.substr(g)):-1!=b.indexOf("colorTo")&&(g=b.indexOf("colorTo"),c=b.substr(0,g+7),g=b.substr(g));switch(c){case "on":case "off":case "toggle":b=e+":"+this._chSwitchVirtualReceiver4;f.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,c,d);break;case "led1on":case "led1off":case "led1dimUp":case "led1dimDown":case "led1dimTo":case "led1toggleTo":case "led1colorTo":case "led2on":case "led2off":case "led2dimUp":case "led2dimDown":case "led2dimTo":case "led2toggleTo":case "led2colorTo":b=
"led1"==c.substr(0,4)?e+":"+this._chDimmerVirtualReceiver12:e+":"+this._chDimmerVirtualReceiver8;"led1on"==c?g="dimTo100":"led1off"==c?g="dimOff":"led2on"==c?g="dimTo100":"led2off"==c&&(g="dimOff");f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,g,d);break;default:"onFor"==c.substr(0,5)?(b=e+":"+this._chSwitchVirtualReceiver4,f.SWITCH_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,b,c,d)):d&&d(Error("no such command"))}};f.prototype.parseDptState=function(a,b,d){var f=a.indexOf(":");if(-1==
f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;e=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return e.MAINTENANCE.parseDptState(b,d);default:var c={};c["0_"+b.toLowerCase()]=d;return c}case this._chKeyTransceiver1:case this._chKeyTransceiver2:if(d=e.KEY_TRANRECEIVER.parseDptState(b,d))c||(c={}),d.pressShort&&(c["btn"+a+"pressShort"]=!0),d.pressLong&&(c["btn"+a+"pressLong"]=!0);return c;case this._chSwitchTransmitter3:switch(b){case "STATE":if(d=
e.SWITCH_TRANSMITTER.parseDptState(b,d))c={},c.state=d.switchTState;return c;default:return null}case this._chDimmerTransmitter7:if(d=e.DIMMER_TRANSMITTER.parseDptState(b,d))c={},"LEVEL"==b?c.led2Level=d.dimmerTLevel:"COLOR"==b&&(c.led2Color=d.dimmerTColor);return c;case this._chDimmerTransmitter11:if(d=e.DIMMER_TRANSMITTER.parseDptState(b,d))c={},"LEVEL"==b?c.led1Level=d.dimmerTLevel:"COLOR"==b&&(c.led1Color=d.dimmerTColor);return c;default:return null}};f.prototype.isButton=function(){return!0};
f.prototype.claimEvent=function(a,b){var d=this.getSerial(),f=this;a.reportValueUsage(this.deviceIF,d+":"+this._chKeyTransceiver1,"PRESS_SHORT",function(e,c){e&&console.error("button:1 claim PRESS_SHORT event error:"+e.stack);a.reportValueUsage(f.deviceIF,d+":"+f._chKeyTransceiver1,"PRESS_LONG",function(e,c){e&&console.error("button:1 claim PRESS_LONG event error:"+e.stack);a.reportValueUsage(f.deviceIF,d+":"+f._chKeyTransceiver2,"PRESS_SHORT",function(e,c){e&&console.error("button:2 claim PRESS_SHORT event error:"+
e.stack);a.reportValueUsage(f.deviceIF,d+":"+f._chKeyTransceiver2,"PRESS_LONG",function(a,d){a&&console.error("button:2 claim PRESS_LONG event error:"+a.stack);b&&b()})})})})};return f}(),Ra=function(){var f=function(a,b,d){c.call(this,a,b,d);this._chMaintenance=0;this._chDoorReceiver=1;this._chSimpleSwitchReceiver=2;this.legacyType="ip_tormatic"};util.inherits(f,c);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+
":"+this._chDoorReceiver,dpt:"DOOR_STATE"},{channel:this.deviceAdr+":"+this._chSimpleSwitchReceiver,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;b.dataPoint="UNREACH";break;case "doorState":b.channel+=this._chDoorReceiver;b.dataPoint="DOOR_STATE";break;case "lightState":b.channel+=this._chSimpleSwitchReceiver;b.dataPoint="STATE";break;default:return null}return b};f.prototype.executeCommand=
function(a,b,d){var f=x.hub.m.hm._Channel["HmIP-RF"],e=this.getSerial();switch(b){case "open":case "close":case "partialOpen":case "stop":e=e+":"+this._chDoorReceiver;f.DOOR_RECEIVER.executeCommand(a,this.deviceIF,e,b,d);break;case "lightOn":case "lightOff":case "lightToggle":b=b.substr(5).toLowerCase();e=e+":"+this._chSimpleSwitchReceiver;f.SIMPLE_SWITCH_RECEIVER.executeCommand(a,this.deviceIF,e,b,d);break;default:d&&d(Error("no such command"))}};f.prototype.parseDptState=function(a,b,d){var f=a.indexOf(":");
if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;e=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return e.MAINTENANCE.parseDptState(b,d);default:var c={};c["0_"+b.toLowerCase()]=d;return c}case this._chDoorReceiver:return(b=e.DOOR_RECEIVER.parseDptState(b,d))&&(c=b),c;case this._chSimpleSwitchReceiver:if(b=e.SIMPLE_SWITCH_RECEIVER.parseDptState(b,d))c={},c.lightState=b.state;return c;default:return null}};
return f}(),Sa=function(){var f=function(a,b,d){c.call(this,a,b,d);this._chMaintenance=0;this._chBrightness=1;this.legacyType="ip_lux"};util.inherits(f,c);f.prototype._getReadableDpts=function(){var a=[],b=this,d=x.hub.m.hm._Channel["HmIP-RF"],f=d.MAINTENANCE_BAT_EL.getReadableDpts();f&&f.forEach(function(d){"SABOTAGE"!=d&&"ERROR_CODE"!=d&&"SENSOR_ERROR"!=d&&a.push({channel:b.deviceAdr+":0",dpt:d})});(f=d.BRIGHTNESS_TRANSMITTER.getReadableDpts())&&f.forEach(function(d){a.push({channel:b.deviceAdr+
":1",dpt:d})});return a};f.prototype._getDptFromRef=function(a){var b=this.deviceAdr,d={channel:b+":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "volatage":d.channel=b+":0";d.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "illu":case "avgIllu":case "maxIllu":case "minIllu":d.channel=b+":1";d.dataPoint=f.BRIGHTNESS_TRANSMITTER.getDptFromState(a);break;default:return null}return d};f.prototype.parseDptState=function(a,b,d){var f=
a.indexOf(":");if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);var c=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(c=this.deviceAdr.substr(0,f));if(e!=c)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(0==a){if("UNREACH"==b||"LOW_BAT"==b||"OPERATING_VOLTAGE"==b)return f.MAINTENANCE_BAT_EL.parseDptState(b,d);f={};f["0_"+b.toLowerCase()]=d;return f}return 1==a?f.BRIGHTNESS_TRANSMITTER.parseDptState(b,d):null};return f}(),Ka=function(){var f=function(a,b,d){c.call(this,a,b,d);this.channel=
1;this._chMaintenance=0;this._chSwitchVirtualReceiver1=2;this._chSwitchVirtualReceiver2=3;this._chSwitchVirtualReceiver3=4;this._chSwitchWeekProfile=5;this.legacyType="ip_switch"};util.inherits(f,c);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(a){var b={channel:this.getSerial()+":",dataPoint:null};switch(a){case "timeout":b.channel+=this._chMaintenance;
b.dataPoint="UNREACH";break;case "state":b.channel+=this.channel;b.dataPoint="STATE";break;default:return null}return b};f.prototype.executeCommand=function(a,b,d){var f=this.getSerial(),e=this;switch(b){case "on":var c="STATE";var g=f+":"+this._chSwitchVirtualReceiver1;a.writeValue(this.deviceIF,g,c,!0,d);break;case "off":c="STATE";g=f+":"+this._chSwitchVirtualReceiver1;a.writeValue(this.deviceIF,g,c,!1,d);break;case "toggle":c="STATE";g=f+":"+this.channel;a.getState({interface:this.deviceIF,channel:g,
datapoint:c},function(b,h){b?d&&d(b):h?(b=!0,h.value&&(b=!1),c="STATE",g=f+":"+e._chSwitchVirtualReceiver1,a.writeValue(e.deviceIF,g,c,b,d)):d&&d(Error("get switch current value return invalid"))});break;default:"onFor"==b.substr(0,5)?(b=parseFloat(b.substr(5)),isNaN(b)?d&&d(Error("onFor command invalid")):(c="ON_TIME",g=f+":"+e._chSwitchVirtualReceiver1,a.writeValue(this.deviceIF,g,c,{type:"double",value:b},function(b){b?d&&d(b):(c="STATE",g=f+":"+e._chSwitchVirtualReceiver1,a.writeValue(e.deviceIF,
g,c,!0,d))}))):d&&d(Error("no such command"))}};f.prototype.parseDptState=function(a,b,d){var f=a.indexOf(":");if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return{timeout:d};default:return e={},e["0_"+b.toLowerCase()]=d,e}case this.channel:switch(b){case "STATE":return{state:1==d?"on":"off"};default:return null}default:return null}};return f}(),Oa=function(){var f=function(a,b,
d){c.call(this,a,b,d);this.channel=1;this._chMaintenance=0;this._chDimmerVirtualReceiver1=2;this._chDimmerVirtualReceiver2=3;this._chDimmerVirtualReceiver3=4;this._chDimmerWeekProfile=13;this.legacyType="ip_dimmer"};util.inherits(f,c);f.prototype._getReadableDpts=function(){var a=[],b=this,d=x.hub.m.hm._Channel["HmIP-RF"],f=d.MAINTENANCE.getReadableDpts();f&&f.forEach(function(d){"UNREACH"==d&&a.push({channel:b.deviceAdr+":"+b._chMaintenance,dpt:d})});(f=d.DIMMER_TRANSMITTER.getReadableDpts())&&f.forEach(function(d){a.push({channel:b.deviceAdr+
":"+b.channel,dpt:d})});(f=d.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(d){a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver1,dpt:d});a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver2,dpt:d});a.push({channel:b.deviceAdr+":"+b._chDimmerVirtualReceiver3,dpt:d})});return a};f.prototype._getDptFromRef=function(a){var b=this.getSerail(),d={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":d.channel=b+":"+this._chMaintenance;d.dataPoint=
f.MAINTENANCE.getDptFromState(a);break;case "dimmerLevel":d.channel=b+":"+this.channel;d.dataPoint=f.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;default:return null}return d};f.prototype.executeCommand=function(a,b,d){var f=x.hub.m.hm._Channel["HmIP-RF"],e=b;if(-1!=b.indexOf("dimUp")){var c=b.indexOf("dimUp");e=b.substr(0,c+5);var g=b.substr(c+5)}else-1!=b.indexOf("dimDown")?(c=b.indexOf("dimDown"),e=b.substr(0,c+7),g=b.substr(c+7)):-1!=b.indexOf("dimTo")?(c=b.indexOf("dimTo"),e=b.substr(0,
c+5),g=b.substr(c+5)):-1!=b.indexOf("toggleTo")&&(c=b.indexOf("toggleTo"),e=b.substr(0,c+8),g=b.substr(c+8));var h=this.getSerial(),k=this;switch(e){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,h+":"+this._chDimmerVirtualReceiver1,"dimOff",d);break;case "dimUp":g=g?parseInt(g)/100:.1;a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,e){b?d&&d(b):"undefined"==typeof e||null==e?d&&d(Error("get dimmer current value return invalid")):
(g=e.value+g,1<g&&(g=1),g=Math.round(100*g),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,k.deviceIF,h+":"+k._chDimmerVirtualReceiver1,"dimTo"+g,d))});break;case "dimDown":g=g?parseInt(g)/100:.1;a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,e){b?d&&d(b):"undefined"==typeof e||null==e?d&&d(Error("get dimmer current value return invalid")):(g=e.value-g,0>g&&(g=0),g=Math.round(100*g),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,k.deviceIF,h+":"+k._chDimmerVirtualReceiver1,
"dimTo"+g,d))});break;case "dimTo":if(!g){d&&d(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,h+":"+k._chDimmerVirtualReceiver1,"dimTo"+g,channel);break;case "toggleTo":if(!g){d&&d(Error("toggle has no value"));break}a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,e){b?d&&d(b):"undefined"==typeof e||null==e?d&&d(Error("get dimmer current value return invalid")):(e.value&&(g=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(a,
k.deviceIF,h+":"+k._chDimmerVirtualReceiver1,"dimTo"+g,d))});break;default:d&&d(Error("no such command"))}};f.prototype.parseDptState=function(a,b,d){var f=a.indexOf(":");if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];e=null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return f.MAINTENANCE.parseDptState(b,d);default:return e={},e["0_"+b.toLowerCase()]=d,e}case this.channel:if(b=f.DIMMER_TRANSMITTER.parseDptState(b,
d))e={},e.dimmerLevel=b.dimmerTLevel;return e}return null};return f}(),Pa=function(){var f=function(a,b,d){c.call(this,a,b,d);this.channel=1;this._chMaintenance=0;this._chBlindVirtualReceiver1=2;this._chBlindVirtualReceiver2=3;this._chBlindVirtualReceiver3=4;this._chBlindWeekProfile=5;this.legacyType="ip_jalousie"};util.inherits(f,c);f.prototype._getReadableDpts=function(){var a=[],b=this,d=x.hub.m.hm._Channel["HmIP-RF"],f=d.MAINTENANCE.getReadableDpts();f&&f.forEach(function(d){"UNREACH"==d&&a.push({channel:b.deviceAdr+
":"+b._chMaintenance,dpt:d})});(f=d.BLIND_TRANSMITTER.getReadableDpts())&&f.forEach(function(d){a.push({channel:b.deviceAdr+":"+b.channel,dpt:d})});(f=d.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(d){a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver1,dpt:d});a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver2,dpt:d});a.push({channel:b.deviceAdr+":"+b._chBlindVirtualReceiver3,dpt:d})});return a};f.prototype._getDptFromRef=function(a){var b=this.getSerial(),d={channel:null,
dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":d.channel=b+":"+this._chMaintenance;d.dataPoint=f.MAINTENANCE.getDptFromState(a);break;case "blindLevel":d.channel=b+":"+this.channel;d.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":d.channel=b+":"+this.channel;d.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;default:return null}return d};f.prototype.executeCommand=function(a,b,d){var f=x.hub.m.hm._Channel["HmIP-RF"],
e=b;if(-1!=b.indexOf("stepUp")){var c=b.indexOf("stepUp");e=b.substr(0,c+6);var g=b.substr(c+6)}else-1!=b.indexOf("stepDown")?(c=b.indexOf("stepDown"),e=b.substr(0,c+8),g=b.substr(c+8)):-1!=b.indexOf("moveTo")?(c=b.indexOf("moveTo"),e=b.substr(0,c+6),g=b.substr(c+6)):-1!=b.indexOf("stop")?(c=b.indexOf("stop"),e=b.substr(0,c+4),g=b.substr(c+4)):-1!=b.indexOf("lamellaStepUp")?(c=b.indexOf("lamellaStepUp"),e=b.substr(0,c+13),g=b.substr(c+13)):-1!=b.indexOf("lamellaStepDown")?(c=b.indexOf("lamellaStepDown"),
e=b.substr(0,c+15),g=b.substr(c+15)):-1!=b.indexOf("lamellaTo")&&(c=b.indexOf("lamellaTo"),e=b.substr(0,c+9),g=b.substr(c+9));var h=this.getSerial(),k=this;switch(e){case "stop":case "moveUp":case "moveDown":f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,h+":"+this._chBlindVirtualReceiver1,e,d);break;case "lamellaUp":case "lamellaDown":a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,c){b?d&&d(b):"undefined"==typeof c||null==c?d&&d(Error("get blind current value return invalid")):
f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,h+":"+this._chBlindVirtualReceiver1,"lamellaTo"+(e=100),function(b){b?d&&d(b):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,k.deviceIF,h+":"+k._chBlindVirtualReceiver1,"moveTo"+Math.round(100*c.value),d)})});break;case "stepUp":case "stepDown":g=g?parseInt(g)/100:.05;a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,c){b?d&&d(b):"undefined"==typeof c||null==c?d&&d(Error("get blind current value return invalid")):
(g="stepUp"==e?c.value+g:c.value-g,1<g&&(g=1),0>g&&(g=0),g=Math.round(100*g),f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,k.deviceIF,h+":"+k._chBlindVirtualReceiver1,"moveTo"+g,d))});break;case "moveTo":if(!g){d&&d(Error("moveTo has no value"));break}f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,h+":"+this._chBlindVirtualReceiver1,"moveTo"+g,d);break;case "lamellaStepUp":case "lamellaStepDown":g=g?parseInt(g)/100:.05;a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},
function(b,c){if(b)d&&d(b);else if("undefined"==typeof c||null==c)d&&d(Error("get blind current value return invalid"));else{var l=c.value;l=Math.round(100*l);a.getState({interface:k.deviceIF,channel:h+":"+k.channel,datapoint:"LEVEL_2"},function(b,c){b?d&&d(b):"undefined"==typeof c||null==c?d&&d(Error("get lamella current value return invalid")):(g="lamellaStepUp"==e?c.value+g:c.value-g,1<g&&(g=1),0>g&&(g=0),g=Math.round(100*g),f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,k.deviceIF,h+":"+k._chBlindVirtualReceiver1,
"lamellaTo"+g,function(b,e){b?d&&d(b,e):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,k.deviceIF,h+":"+k._chBlindVirtualReceiver1,"moveTo"+l,d)}))})}});break;case "lamellaTo":if(!g){d&&d(Error("lamellaTo has no value"));break}a.getState({interface:this.deviceIF,channel:h+":"+this.channel,datapoint:"LEVEL"},function(b,e){if(b)d&&d(b);else if("undefined"==typeof e||null==e)d&&d(Error("get blind current value return invalid"));else{var c=e.value;c=Math.round(100*c);f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,
k.deviceIF,h+":"+k._chBlindVirtualReceiver1,"lamellaTo"+g,function(b){b?d&&d(b):f.BLIND_VIRTUAL_RECEIVER.executeCommand(a,k.deviceIF,h+":"+k._chBlindVirtualReceiver1,"moveTo"+c,d)})}});break;default:d&&d(Error("no such command"))}};f.prototype.parseDptState=function(a,b,d){var f=a.indexOf(":");if(-1==f)return null;var e=a.substr(0,f);a=a.substr(f+1);f=this.getSerial();if(e!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];e=null;switch(parseInt(a)){case this._chMaintenance:switch(b){case "UNREACH":return f.MAINTENANCE.parseDptState(b,
d);default:return e={},e["0_"+b.toLowerCase()]=d,e}case this.channel:if(d=f.BLIND_TRANSMITTER.parseDptState(b,d))e={},"LEVEL"==b?e.blindLevel=d.blindTPos:"LEVEL_2"==b&&(e.lamellaLevel=d.lamellaTPos);return e}return null};f.prototype.getConfig=function(a,b){var d=this.getSerial()+":"+this.channel;a.getParamset(this.deviceIF,d,"MASTER",function(a,f){if(a)b&&b(a);else{var e={},c=null;f&&(c={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});e[d]=c;b&&b(a,e)}})};f.prototype.setConfig=function(a,b,d){if(b){var f=
this.getSerial()+":"+this.channel;if(b=b[f]){var e={};e.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};e.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};e.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_UNIT};e.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_VALUE};a.setParamset(this.deviceIF,f,"MASTER",e,function(b){d&&d(b)})}else d&&d(Error("config data not complete"))}else d&&d(Error("config data invalid"))};return f}(),
ka=function(){var f=function(b,a,f){c.call(this,b,a,f);this.channel=1;this._chMaintenance=0;this.legacyType="ip_multi_input"};util.inherits(f,c);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(b){var a={channel:this.getSerial()+":",dataPoint:null};switch(b){case "timeout":a.channel+=this._chMaintenance;a.dataPoint="UNREACH";break;case "state":a.channel+=
this.channel;a.dataPoint="STATE";break;default:return null}return a};f.prototype.parseDptState=function(b,a,f){var d=b.indexOf(":");if(-1==d)return null;var e=b.substr(0,d);b=b.substr(d+1);d=this.getSerial();if(e!=d)return null;e=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(b)){case this._chMaintenance:switch(a){case "UNREACH":return{timeout:f};default:return e={},e["0_"+a.toLowerCase()]=f,e}case this.channel:switch(a){case "STATE":return{state:1==f?"on":"off"};case "PRESS_SHORT":case "PRESS_LONG":return e.KEY_TRANRECEIVER.parseDptState(a,
f);default:return null}default:return null}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(b,a){this._claimButtonEvent(this.channel,b,function(){a&&a()})};f.prototype._claimButtonEvent=function(b,a,f){var d=this.getSerial()+":"+b,e=this;a.reportValueUsage(this.deviceIF,d,"PRESS_SHORT",function(c,g){c&&console.error("button:"+b+" claim PRESS_SHORT event error:"+c.stack);a.reportValueUsage(e.deviceIF,d,"PRESS_LONG",function(a,d){a&&console.error("button:"+b+" claim PRESS_LONG event error:"+
a.stack);f&&f()})})};var a=function(b,a,e){f.call(this,b,a,e);this.legacyType="ip_multi_input_bat"};util.inherits(a,f);a.prototype._getReadableDpts=function(){for(var a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts,d=x.hub.m.hm._Channel["HmIP-RF"].MULTI_MODE_INPUT_TRANSMITTER.getReadableDpts,f=[],e=0;e<a.length;e++)f.push({channel:this.deviceAdr+":"+this._chMaintenance,dpt:a[e]});for(e=0;e<d.length;e++)f.push({channel:this.deviceAdr+":"+this.channel,dpt:d[e]});return f};a.prototype._getDptFromRef=
function(a){var b={channel:this.getSerial()+":",dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "voltage":case "errorCode":b.channel+=this._chMaintenance;b.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "state":b.channel+=this.channel;b.dataPoint=f.MULTI_MODE_INPUT_TRANSMITTER.getDptFromState(a);break;default:return null}return b};a.prototype.parseDptState=function(a,d,f){var b=a.indexOf(":");if(-1==b)return null;var e=a.substr(0,b);a=a.substr(b+
1);b=this.getSerial();if(e!=b)return null;e=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(a)){case this._chMaintenance:switch(d){case "UNREACH":case "LOW_BAT":case "OPERATING_VOLTAGE":case "ERROR_CODE":return e.MAINTENANCE_BAT_EL.parseDptState(d,f);default:return e={},e["0_"+d.toLowerCase()]=f,e}case this.channel:switch(d){case "STATE":case "PRESS_SHORT":case "PRESS_LONG":return e.MULTI_MODE_INPUT_TRANSMITTER.parseDptState(d,f);default:return null}default:return null}};f.resolve=function(b,d){if("HmIP-FCI"==
b.substr(0,8)){var f=parseInt(b.substr(8));var e=a}else"HmIPW-DRI"==b.substr(0,9)&&(f=parseInt(b.substr(9)),e=ka);return this._resolveIPMultiInput(b,d,f,e)};f._resolveIPMultiInput=function(a,d,f,e){var b,c=[];for(b=0;b<f;b++){var g=new e(a,d.interface,d.address+":"+(b+1));g._chMaintenance=0;g.channel=b+1;c.push(g)}return c};return f}(),t={};t.CLASS_MAP={maintenance:h,button:m,vbutton:e,switch:g,dimmer:k,blind:p,powerswitch:l,weather:q,heater:v,heater2:u,heater3:la,wallthermo:O,wallthermo2:P,contact:ma,
weatherstation:r,rain:Q,gong2:A,gong:La,window:na,temp:oa,co2:qa,motion:ra,smoke:sa,siren:R,capacity:ta,switch_interface:K,tilt:ua,temp2:pa,water:va,weather2:n,energymeter:wa,rgb:L,lux:xa,siren2:S,jalousie:T,mod_em_8bit:B,mod_em_8:C,keymatic:U,ou_led16:D,hm_dis_ep_wm55:Ma,dualwhite:V};t.CLASS_MAP_IP={ip_switch:Na,ip_contact:ya,ip_heater:W,ip_powerswitch:X,ip_energyactor:Y,ip_dimmer:aa,ip_motion:da,ip_motion2:E,ip_button2:N,ip_siren:ea,ip_wallthermo:y,ip_smoke:fa,ip_window:Aa,ip_button4:F,ip_dimmer2:ba,
ip_energyactor2:Z,ip_blind:H,ip_jalousie:I,ip_presence:ha,ip_dimmer3:ca,ip_wallthermo2:za,ip_floor_heater:Ba,ip_floor_pump_heater:Ca,ip_button6:G,ip_weather:Da,ip_weather2:Ea,ip_weather3:Fa,ip_weather4:Ga,ip_direction:ia,ip_button8:J,ip_generic_input:Ha,ip_analog_output:ja,ip_water:Ia,ip_acce:Ja,ip_garagedoor:z,ip_bsl:Qa,ip_tormatic:Ra,ip_button:M,ip_lux:Sa};t.parseJson=function(f){if(!(f&&f.type&&f.interface&&f.address))return null;switch(f.interface){case "BidCos-RF":f=this._parseRFDeviceJson(f);
break;case "HmIP-RF":f=this._parseIPDeviceJson(f);break;default:return null}return f};t._parseRFDeviceJson=function(f){var a=x.hub.m.hm.RFDeviceTypes[f.type];if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.RFDeviceCatagory[a];if(!a||!a.type)return null;var b=this.CLASS_MAP[a.type];if(!b)return null;a=null;var d=f.address.indexOf(":");-1!=d&&(a=f.address.substr(d+1));"HM-Dis-EP-WM55"==f.type&&3==a&&(b=this.CLASS_MAP.hm_dis_ep_wm55);f=new b(f.type,f.interface,f.address);a&&(f.channel=parseInt(a));
return f};t._parseIPDeviceJson=function(f){if("HmIPW"==f.type.substr(0,5))return this._parseIPW(f);if("HmIP-MIOB"==f.type)return t._parse_HMIP_MIOB(f);var a=null,b=f.address.indexOf(":");-1!=b&&(a=f.address.substr(b+1));switch(f.type){case "HmIP-WHS2":return this._parseTSwitch(f,a,9)}a=t._getIPMetaIndex(f.type);if("undefined"==typeof a||null==a)return null;a=x.hub.m.hm.IPDeviceCatagory[a];if(!a||!a.type)return null;var d=this.CLASS_MAP_IP[a.type];if(!d)return null;a=null;b=f.address.indexOf(":");
-1!=b&&(a=f.address.substr(b+1));f=new d(f.type,f.interface,f.address);a&&(f.channel=parseInt(a));return f};t._parseIPW=function(f){var a=null;var b=f.address.indexOf(":");-1!=b&&(a=f.address.substr(b+1));return"HmIPW-DRS"==f.type.substr(0,9)?(b=parseInt(f.type.substr(9)),f=new Ka(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chSwitchVirtualReceiver1=f.channel+1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=4*b+1,
f):"HmIPW-DRD"==f.type.substr(0,9)?(b=parseInt(f.type.substr(9)),f=new Oa(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chDimmerVirtualReceiver1=f.channel+1,f._chDimmerVirtualReceiver2=f.channel+2,f._chDimmerVirtualReceiver3=f.channel+3,f._chDimmerWeekProfile=4*b+1,f):"HmIPW-DRBL"==f.type.substr(0,10)?(b=parseInt(f.type.substr(10)),f=new Pa(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chBlindVirtualReceiver1=f.channel+1,f._chBlindVirtualReceiver2=
f.channel+2,f._chBlindVirtualReceiver3=f.channel+3,f._chBlindWeekProfile=4*b+1,f):"HmIPW-DRI"==f.type.substr(0,9)?(parseInt(f.type.substr(9)),f=new ka(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f):"HmIPW-FIO"==f.type.substr(0,9)?(b=parseInt(f.type.substr(9)),a=parseInt(a),a<=b?(f=new ka(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a)):(f=new Ka(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(a),f._chSwitchVirtualReceiver1=f.channel+
1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=b+4*b+1),f):null};t._parse_HMIP_MIOB=function(f){var a=f.address,b=null,d=f.address.indexOf(":");-1!=d&&(a=f.address.substr(0,d),b=f.address.substr(d+1));d=null;0==b?d=this.CLASS_MAP.maintenance:3==b||7==b?d=this.CLASS_MAP_IP.ip_switch:9==b||10==b?d=this.CLASS_MAP_IP.ip_generic_input:11==b&&(d=this.CLASS_MAP_IP.ip_analog_output);return d?(f=new d(f.type,f.interface,a),f.channel=b,f):null};t._parseTSwitch=
function(f,a,b){f=new Ka(f.type,f.interface,f.address);f._chMaintenance=0;f.channel=parseInt(a);f._chSwitchVirtualReceiver1=f.channel+1;f._chSwitchVirtualReceiver2=f.channel+2;f._chSwitchVirtualReceiver3=f.channel+3;f._chSwitchWeekProfile=b;return f};t.resolve=function(f){if(!f||!f.type||!f.interface)return null;switch(f.interface){case "BidCos-RF":f=this._resolveRFFromType(f.type,f);break;case "HmIP-RF":f=this._resolveIPFromType(f.type,f);break;default:return null}return f?Array.isArray(f)?f:[f]:
null};t._resolveRFFromType=function(f,a){if("HM-MOD-EM-8"==f)return this._resolve_HM_MOD_EM_8(f,a);if("HM-OU-LED16"==f)return this._resolve_HM_OU_LED16(f,a);if("HM-Dis-EP-WM55"==f)return this._resolve_HM_Dis_EP_WM55(f,a);var b=x.hub.m.hm.RFDeviceTypes[f];if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.RFDeviceCatagory[b];if(!b||!b.type)return this._resolveRFFromTypeGeneral(f,a);var d=[];if(a.channels)for(var e in a.channels){var c=a.channels[e];c.type==b.channel&&d.push(c)}var g=this.CLASS_MAP[b.type];
if(!g)return null;if("*"==b.channelNum){var h=[];d.forEach(function(b){var e=new g(f,a.interface,a.address),c=b.address.indexOf(":");1<d.length&&(e.deviceAdr=b.address);e.channel=b.address.substr(c+1);h.push(e)});return h}e=new g(f,a.interface,a.address);"undefined"!=typeof b.channelNum&&null!=b.channelNum&&(e.channel=b.channelNum);return e};t._resolveIPFromType=function(f,a){if("HmIPW"==f.substr(0,5))return this._resolveIPW(f,a);if(0==f.indexOf("HmIP-FAL"))return t._resolve_HMIP_FAL_X(f,a);if(0==
f.indexOf("HmIP-MIOB"))return t._resolve_HMIP_MIOB(f,a);switch(f){case "HmIP-WHS2":return this._resolveIPMultiSwitch(f,a,2);case "HmIP-FCI1":return ka.resolve(f,a)}var b=this._getIPMetaIndex(f);if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.IPDeviceCatagory[b];if(!b||!b.type)return null;var d=[];if(a.channels)for(var e in a.channels){var c=a.channels[e];c.type==b.channel&&d.push(c)}var g=this.CLASS_MAP_IP[b.type];if(!g)return null;if("*"==b.channelNum){var h=[];d.forEach(function(b){var e=
new g(f,a.interface,a.address),c=b.address.indexOf(":");1<d.length&&(e.deviceAdr=b.address);e.channel=b.address.substr(c+1);h.push(e)});return h}e=new g(f,a.interface,a.address);"undefined"!=typeof b.channelNum&&null!=b.channelNum&&(e.channel=b.channelNum);return e};t._resolveIPW=function(f,a){var b,d=[];if("HmIPW-DRS"==f.substr(0,9)){var e=parseInt(f.substr(9));d=this._resolveIPMultiSwitch(f,a,e)}else if("HmIPW-DRD"==f.substr(0,9))for(e=parseInt(f.substr(9)),b=0;b<e;b++){var c=new Oa(f,a.interface,
a.address+":"+(4*b+1));c._chMaintenance=0;c.channel=4*b+1;c._chDimmerVirtualReceiver1=c.channel+1;c._chDimmerVirtualReceiver2=c.channel+2;c._chDimmerVirtualReceiver3=c.channel+3;c._chDimmerWeekProfile=4*e+1;d.push(c)}else if("HmIPW-DRBL"==f.substr(0,10))for(e=parseInt(f.substr(10)),b=0;b<e;b++)c=new Pa(f,a.interface,a.address+":"+(4*b+1)),c._chMaintenance=0,c.channel=4*b+1,c._chBlindVirtualReceiver1=c.channel+1,c._chBlindVirtualReceiver2=c.channel+2,c._chBlindVirtualReceiver3=c.channel+3,c._chBlindWeekProfile=
4*e+1,d.push(c);else if("HmIPW-DRI"==f.substr(0,9))for(e=parseInt(f.substr(9)),b=0;b<e;b++)c=new ka(f,a.interface,a.address+":"+(b+1)),c._chMaintenance=0,c.channel=b+1,d.push(c);else if("HmIPW-FIO"==f.substr(0,9))for(e=parseInt(f.substr(9)),b=0;b<e;b++)c=new ka(f,a.interface,a.address+":"+(b+1)),c._chMaintenance=0,c.channel=b+1,d.push(c),c=new Ka(f,a.interface,a.address+":"+(4*b+e+1)),c._chMaintenance=0,c.channel=4*b+e+1,c._chSwitchVirtualReceiver1=c.channel+1,c._chSwitchVirtualReceiver2=c.channel+
2,c._chSwitchVirtualReceiver3=c.channel+3,c._chSwitchWeekProfile=e+4*e+1,d.push(c);return d};t._resolveIPMultiSwitch=function(f,a,b){var d,e=[];for(d=0;d<b;d++){var c=new Ka(f,a.interface,a.address+":"+(4*d+1));c._chMaintenance=0;c.channel=4*d+1;c._chSwitchVirtualReceiver1=c.channel+1;c._chSwitchVirtualReceiver2=c.channel+2;c._chSwitchVirtualReceiver3=c.channel+3;c._chSwitchWeekProfile=4*b+1;e.push(c)}return e};t._resolveRFFromTypeGeneral=function(f,a){var b=[];if(!a||!a.channels)return null;var d=
a.channels,e;for(e in d){var c=d[e];if(c&&c.type&&x.hub.m.hm._Channel["BidCos-RF"][c.type]&&(c=x.hub.m.hm._Channel["BidCos-RF"][c.type].device)&&(c=this.CLASS_MAP[c])){c=new c(f,a.interface,e);var g=e.indexOf(":");c.channel=e.substr(g+1);b.push(c)}}return b};t._resolve_HM_MOD_EM_8=function(f,a){var b=[];if(!a||!a.channels)return null;var d=a.channels,e;for(e in d){d=e.indexOf(":");d=e.substr(d+1);var c=new (0==d?this.CLASS_MAP.maintenance:this.CLASS_MAP.mod_em_8)(f,a.interface,e);c.channel=d;b.push(c)}return b};
t._resolve_HM_OU_LED16=function(f,a){var b=[];if(!a||!a.channels)return null;var d=a.channels,e;for(e in d){d=e.indexOf(":");d=e.substr(d+1);var c=new (0==d?this.CLASS_MAP.maintenance:this.CLASS_MAP.ou_led16)(f,a.interface,e);c.channel=d;b.push(c)}return b};t._resolve_HM_Dis_EP_WM55=function(f,a){var b=[];if(!a||!a.channels)return null;var d=a.channels,e;for(e in d){d=e.indexOf(":");d=e.substr(d+1);var c=null;0==d?c=this.CLASS_MAP.maintenance:1==d||2==d?c=this.CLASS_MAP.button:3==d&&(c=this.CLASS_MAP.hm_dis_ep_wm55);
c&&(c=new c(f,a.interface,e),c.channel=d,b.push(c))}return b};t._resolve_HMIP_FAL_X=function(f,a){var b=[];if(!a||!a.channels)return null;var d=a.channels,e;for(e in d){var c=d[e],g=e.indexOf(":");g=e.substr(g+1);if(0==g)var h=this.CLASS_MAP.maintenance;else"CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER"==c.type?h=this.CLASS_MAP_IP.ip_floor_pump_heater:"CLIMATECONTROL_FLOOR_TRANSCEIVER"==c.type&&(h=this.CLASS_MAP_IP.ip_floor_heater);h&&(c=new h(f,a.interface,e),c.channel=g,b.push(c))}return b};t._resolve_HMIP_MIOB=
function(f,a){var b=[];if(!a||!a.channels)return null;var d=a.channels,e;for(e in d){d=e.indexOf(":");d=e.substr(d+1);var c=null;0==d?c=this.CLASS_MAP.maintenance:3==d||7==d?c=this.CLASS_MAP_IP.ip_switch:9==d||10==d?c=this.CLASS_MAP_IP.ip_generic_input:11==d&&(c=this.CLASS_MAP_IP.ip_analog_output);c&&(c=new c(f,a.interface,e),c.channel=d,b.push(c))}return b};t._getIPMetaIndex=function(f){for(var a in x.hub.m.hm.IPDeviceTypes)if(x.hub.m.hm.IPDeviceTypes.hasOwnProperty(a)&&a.toUpperCase()==f.toUpperCase())return x.hub.m.hm.IPDeviceTypes[a];
return null};return t}();
x.hub.m.hm.Manager=function(){var c=function(c){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager");this._gateway=c;this._devices={};this._meta={}};c.prototype.init=function(c){x.hub.m.hm._Util.isIP(this._gateway.ip)?(this._logger.log("info","start connect monitor to "+this._gateway.ip),this._startMonitor(c)):c&&c()};c.prototype.onDeviceEvent=function(c){this._logger.log("trace","receive device event:"+JSON.stringify({device:c.device?c.device.type:null,address:c.device?c.device.address:
null,channel:c.channel,datapoint:c.datapoint,value:c.value?c.value.value:null,ip:c.ip}));var h=function(e,c){var g=null;if(!c||0==c.length)return null;c.forEach(function(c){c&&c.key==e&&(g=c)});return g};if(!c||!c.device)return null;var e=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!e)return null;var g=c.device;g.hsstype=g.type;if(g.channels)for(var k in g.channels)if(g.channels.hasOwnProperty(k)){var p=g.channels[k];p.hsstype=p.type}g=e._parseDevice(g);if(!g||0==g.length)return null;var l;
1==g.length?l=g[0]:g.forEach(function(e){if(e.address==c.channel)l=e;else if(0==c.channel.indexOf(e.address)){var g=c.channel.split(":")[1];if(e.channels)for(var h in e.channels)if(e.channels[h].address==g){l=e;break}}});if(!l)return null;g=x.hub.m.hm._Util.getDeviceHashCode(l);var q=e.resolveState(l,c,c.oldValue.value);e=e.resolveState(l,c,c.value.value);if(!e)return null;this._logger.log("trace","event to device state");this._logger.log("trace","device:"+JSON.stringify(l));this._logger.log("trace",
"state:"+JSON.stringify(e));var n=[];Array.isArray(e)?e.forEach(function(e){var c=h(e.key,q);n.push({device:l,gateway:this._gateway,data:{key:e.key,value:e.value,changed:c?e.value!=c.value:!0,oldValue:c?c.value:void 0}})}.bind(this)):n.push({device:l,gateway:this._gateway,data:{key:e.key,value:e.value,changed:e.value!=q.value,oldValue:q.value}});this._generateEvent(g,n)};c.prototype._generateEvent=function(c,m){var e=require("x.hub.eventbus.js");if((c=this._meta[c])&&0<c.length)for(var g=0;g<c.length;g++){var h=
c[g];if(h)for(var p=0;p<m.length;p++){var l=m[p];l&&l.data&&(l.data.key==h.statusKey||"*"==l.data.key)&&e.emit("status",{module:"hm",device:l.device,gateway:l.gateway,data:l.data},h)}}};c.prototype.addStateDevice=function(c,m,e){if(c){c=JSON.parse(JSON.stringify(c));var g=x.hub.m.hm._Util.getDeviceHashCode(c);this._devices[g]||(delete c.gateway,this._devices[g]=c);this._meta[g]||(this._meta[g]=[]);e&&this._meta[g].push(e);m&&m()}else m&&m(Error("device json invalid"))};c.prototype.removeStateDevice=
function(c,m,e){if(!c)m&&m(Error("device json invalid"));else if(e){c=JSON.parse(JSON.stringify(c));c=x.hub.m.hm._Util.getDeviceHashCode(c);var g=this._meta[c];if(g){for(var h=-1,p=0;p<g.length;p++){var l=g[p];if(l&&"taskman"==l.src&&"taskman"==e.src&&l.taskID==e.taskID&&l.statusKey==e.statusKey){h=p;break}}0<=h&&g.splice(h,1);0==g.length&&(delete this._devices[c],delete this._meta[c])}m&&m()}};c.prototype.getAllStates=function(){var c=[],m;for(m in this._devices)if(this._devices.hasOwnProperty(m)){var e=
this._devices[m];e&&e.device&&(e=this.getStates(e.device))&&c.push(e)}return c};c.prototype.getStates=function(c){if(!c)return null;c=JSON.parse(JSON.stringify(c));var h=x.hub.m.hm._Util.getDeviceHashCode(c),e=this._devices[h];e||this.addStateDevice(c);var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!g)return null;var k={};e=this._devices[h];for(var p in e.states)h=g.getBufferedState(e.states[p]),k[p]=this._resolveRawState(c,p,h);return{device:c,gateway:this._gateway,
states:k}};c.prototype.updateStates=function(c,m){if(c){c=JSON.parse(JSON.stringify(c));var e=x.hub.m.hm._Util.getDeviceHashCode(c),g=this._devices[e];g||this.addStateDevice(c);g=this._devices[e];this._updateStates(c,g.states,m)}else m&&m(Error("device json is null"))};c.prototype.getState=function(c,m,e){if(!c||!m)return e&&e(Error("argument invalid")),null;if("SysVar"==c.type||"CUxD"==c["interface"])x.hub.m.hm.HM_MODULE.doStatus("var",this._gateway,c,{value:m},function(c,g){c?e&&e(c):g?(c={value:g.status,
time:(new Date).getTime()},e&&e(null,c)):e&&e(Error("get sys var status return null"))});else{c=JSON.parse(JSON.stringify(c));var g=x.hub.m.hm._Util.getDeviceHashCode(c);this._devices[g]||this.addStateDevice(c);g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!g)return e&&e(Error("no monitor for gateway")),null;var h=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!h)return e&&e(Error("gateway json invalid")),null;var p=h.resolveDatapointInfo(c,m);
if(!p)return e&&e(Error("device json or state ref invalid")),null;g.getState(p,function(g,k){if(g)e&&e(g);else if(k){g=h.resolveState(c,p,k.value);var l;g?Array.isArray(g)?g.forEach(function(e){e&&e.key==m&&(l={value:e.value,time:k.time})}):l={value:g.value,time:k.time}:l={value:g,time:k.time};e&&e(null,l)}else e&&e(null,null)})}};c.prototype.executeCommand=function(c,m,e){var g=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!g)return e&&e(Error("gateway json invalid")),null;g.executeCommandCreator(c,
m,e)};c.prototype.updateState=function(c,m,e){if(!c||!m)return e&&e(Error("argument invalid")),null;c=JSON.parse(JSON.stringify(c));var g=x.hub.m.hm._Util.getDeviceHashCode(c);this._devices[g]||this.addStateDevice(c);g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!g)return e&&e(Error("no monitor for gateway")),null;var h=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!h)return e&&e(Error("gateway json invalid")),null;var p=h.resolveDatapointInfo(c,
m);if(!p)return e&&e(Error("device json or state ref invalid")),null;g.updateState(p,function(g,k){if(g)e&&e(g);else{g=h.resolveState(c,p,k);var l;g?Array.isArray(g)?g.forEach(function(e){e&&e.key==m&&(l={value:e.value})}):l={value:g.value}:l={value:g};e&&e(null,l)}})};c.prototype._startMonitor=function(c){require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,{persistant:!0},c)};c.prototype._updateStates=function(c,m,e){var g=this;require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,
{persistant:!0},function(h){h?e&&e(h):g._getStateByScript(c,m,e)})};c.prototype._resolveDetailDpt=function(c){var h=require("xnm.aio.hm.js").devicemanager,e=h.applyUIFilter(c,{catagory:"status",elems:"*"}),g=e?e.status:null;h=(e=h.applyUIFilter(c,{catagory:"command",elems:"*"}))?e.command:null;e={states:{},commands:{}};if(g&&0<=g.length)for(var k=0;k<g.length;k++){var p=g[k],l=this._resolveDatapointRef(c,p.ref.value,!1);l&&(e.states[p.ref.value]=l)}if(h&&0<=h.length)for(k=0;k<h.length;k++)g=h[k],
(l=this._resolveDatapointRef(c,g.ref.value,!0))&&(e.commands[g.ref.value]=l);return e};c.prototype.learnRFDevice=function(c){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnRF(function(e,g){if(e)c&&c(e);else{e=[];var h=new x.hub.m.hm.HM_MODULE.CCU,m;for(m in g){var l=g[m];l.hsstype=l.type;if(l.channels)for(m in l.channels)l.channels[m].hsstype=l.channels[m].type;(l=h._parseDevice(l))&&(e=e.concat(l))}c&&c(null,e)}}):c&&c(Error("monitor not started"))};
c.prototype.learnIPDevice=function(c,m,e){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);g?g.learnIP(c,m,function(c,g){if(c)e&&e(c);else{c=[];var h=new x.hub.m.hm.HM_MODULE.CCU,k;for(k in g){var m=g[k];m.hsstype=m.type;if(m.channels)for(k in m.channels)m.channels[k].hsstype=m.channels[k].type;(m=h._parseDevice(m))&&(c=c.concat(m))}e&&e(null,c)}}):e&&e(Error("monitor not started"))};c.prototype.learnIPDeviceQR=function(c,m){var e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,
this._gateway.uuid);e?e.learnIPQR(c,function(e,c){if(e)m&&m(e);else{e=[];var g=new x.hub.m.hm.HM_MODULE.CCU,h;for(h in c){var k=c[h];k.hsstype=k.type;if(k.channels)for(h in k.channels)k.channels[h].hsstype=k.channels[h].type;(k=g._parseDevice(k))&&(e=e.concat(k))}m&&m(null,e)}}):m&&m(Error("monitor not started"))};c.prototype.deleteDevice=function(c,m,e){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);g?g.deleteDevice(c,m,e):e&&e(Error("monitor not started"))};
c.prototype.getRFInterfaces=function(c){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.getRFInterfaces(c):c&&c(Error("monitor not started"))};return c}();x.hub.m.hm.ChipManager=function(c){x.hub.m.hm.Manager.call(this,c);this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager.ChipManager")};util.inherits(x.hub.m.hm.ChipManager,x.hub.m.hm.Manager);
x.hub.m.hm.ChipManager.prototype.init=function(c){if(x.hub.m.hm._Util.isIP(this._gateway.ip)){this._logger.log("info","start connect monitor to "+this._gateway.ip);var h=this,m=require("x.hub.m.hm.js")._monitorManager;m.startMonitor(this._gateway,{localChip:"chip",persistant:!0},function(e){var g=m.getMonitor(h._gateway.ip,h._gateway.uuid);if(g)g.on("new_devices",h._onNewDevices.bind(h));c&&c(e)},!0,!0)}else c&&c()};
x.hub.m.hm.ChipManager.prototype.reset=function(c){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return c&&c(Error("no chip monitor")),null;h.reset(c)};
x.hub.m.hm.ChipManager.prototype.executeCommand=function(c,h,m){if(c&&c.address&&h)if(c=c.address.split("."),3>c.length)m&&m({error:Error("address invalid")});else{var e={type:c[0],interface:c[1],address:c[2]};c=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!c)return m&&m(Error("no chip monitor")),null;(e=x.hub.m.hm._Device.parseJson(e))?e.executeCommand(c,h.value,m):m&&m(Error("unknow device"))}else m&&m(Error("argument invalid"))};
x.hub.m.hm.ChipManager.prototype.getState=function(c,h,m){if(!c||!c.address||!h)return m&&m(Error("argument invalid")),null;c=c.address.split(".");if(3>c.length)m&&m(Error("address invalid"));else{var e={type:c[0],interface:c[1],address:c[2]};c=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!c)return m&&m(Error("no chip monitor")),null;(e=x.hub.m.hm._Device.parseJson(e))?e.getState(c,h.value,m):m&&m(Error("unknow device"))}};
x.hub.m.hm.ChipManager.prototype.getBufferedStateLegacy=function(c,h){if(!c)return null;c=x.hub.m.hm._Device.resolve(c);if(!c||0==c.length)return null;var m;1==c.length?m=c[0]:c.forEach(function(e){e.deviceAdr==h&&(m=e)});if(!m)return null;var e;if(c=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid)){c=c.getAllBufferedStates();var g=m.deviceAdr,k=g.indexOf(":");-1!=k&&(g=g.substr(0,k));c[g]&&c[g].states&&(e=m.parseStates(c[g].states))}if(!e)return null;c={type:"HM",
adr:m.toLegacyAdr(),state:{}};for(var p in e)c.state[p]=e[p].value;return c};
x.hub.m.hm.ChipManager.prototype.checkButtonEvent=function(c){if(!c||!c.device||!c.datapoint||0!=c.datapoint.indexOf("PRESS"))return null;var h=x.hub.m.hm._Device.resolve(c.device);if(!h||0==h.length)return null;var m;1==h.length?m=h[0]:h.forEach(function(e){e.deviceAdr==c.channel&&(m=e)});if(!m)return null;h=m.parseDptState(c.channel,c.datapoint,c.value.value);if(!h)return null;var e={type:"HM",adr:m.deviceType+"."+m.deviceIF+"."+m.deviceAdr,state:{},_ver:"v5+"},g=Object.keys(h);e.state[g[0]]=h[g[0]];
require("x.hub.eventbus.js").emit("gatewayevent",e,{address:"HM"},"BTN")};
x.hub.m.hm.ChipManager.prototype.onDeviceEvent=function(c){if(!c||!c.device)return null;var h=x.hub.m.hm._Device.resolve(c.device);if(!h||0==h.length)return null;var m;1==h.length?m=h[0]:h.forEach(function(e){e.deviceAdr==c.channel&&(m=e)});if(!m)return null;h=m.parseDptState(c.channel,c.datapoint,c.oldValue.value);var e=m.parseDptState(c.channel,c.datapoint,c.value.value);if(!e)return null;var g={sys:"aio",type:"HM",address:m.deviceType+"."+m.deviceIF+"."+m.deviceAdr},k=this._gateway,p={key:null,
value:null,changed:c.changed,oldValue:null},l=Object.keys(e);p.key=l[0];p.value=e[l[0]];p.oldValue=h?h[l[0]]:void 0;this._logger.log("debug","EVENT:\t"+g.address+"\t"+p.key+"\t"+p.value);return{device:g,gateway:k,data:p}};
x.hub.m.hm.ChipManager.prototype.learnRFDevice=function(c){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnRF(function(h,e){if(h)c&&c(h);else{var g=[],k;for(k in e){var m=x.hub.m.hm._Device.resolve(e[k]);m&&(g=g.concat(m))}c&&c(h,g)}}):c&&c(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnRFDeviceSN=function(c,h){var m=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);m?m.learnRFSN(c,function(e,c){if(e)h&&h(e);else{var g=[],m;for(m in c){var l=x.hub.m.hm._Device.resolve(c[m]);l&&(g=g.concat(l))}h&&h(e,g)}}):h&&h(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDevice=function(c,h,m){var e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);e?e.learnIP(c,h,function(e,c){if(e)m&&m(e);else{var g=[],h;for(h in c){var k=x.hub.m.hm._Device.resolve(c[h]);k&&(g=g.concat(k))}m&&m(e,g)}}):m&&m(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDeviceQR=function(c,h){var m=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);m?m.learnIPQR(c,function(e,c){if(e)h&&h(e);else{var g=[],m;for(m in c){var l=x.hub.m.hm._Device.resolve(c[m]);l&&(g=g.concat(l))}h&&h(e,g)}}):h&&h(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.getAllBufferedStates=function(){var c=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!c)return[];c=c.getAllBufferedStates();var h=[],m;for(m in c){var e=c[m],g=x.hub.m.hm._Device.resolve(e.device);if(g)for(var k=0,p=g.length;k<p;k++){var l=g[k],q=l.parseStates(e.states);h.push({device:l,states:q})}}return h};
x.hub.m.hm.ChipManager.prototype.getConfig=function(c,h){if(c&&c.address)if(c=c.address.split("."),3>c.length)h&&h({error:Error("address invalid")});else{var m={type:c[0],interface:c[1],address:c[2]};c=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!c)return h&&h(Error("no chip monitor")),null;(m=x.hub.m.hm._Device.parseJson(m))?m.getConfig(c,h):h&&h(Error("unknow device"))}else h&&h(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype.setConfig=function(c,h,m){if(c&&c.address)if(c=c.address.split("."),3>c.length)m&&m({error:Error("address invalid")});else{var e={type:c[0],interface:c[1],address:c[2]};c=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!c)return m&&m(Error("no chip monitor")),null;(e=x.hub.m.hm._Device.parseJson(e))?e.setConfig(c,h,m):m&&m(Error("unknow device"))}else m&&m(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype._onNewDevices=function(c){var h=[],m;for(m in c)if(c.hasOwnProperty(m)){var e=x.hub.m.hm._Device.resolve(c[m]).filter(function(e){return e&&e.isButton()});h=h.concat(e)}var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(g&&0<h.length){var k=0,p=function(){k++;k<h.length&&h[k].claimEvent(g,p)};h[k].claimEvent(g,p)}};
x.hub.m.hm.CCU2Discovery=function(){var c=function(c){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.CCU2Discovery");this._autoDiscoverTO=null;var h=this;this._hmHandlerCB=function(e,c){h._logger.log("debug","find ccu:"+e.uuid+"@"+e.ip+" from netif:"+c);h._searchCB&&h._searchCB(e,c);if(e.ip){var g=!1;h._searchTmpHMs.forEach(function(c){c.ip==e.ip&&(g=!0)});g||h._searchTmpHMs.push(e)}};this._searchCB=c;this._searchRunning=!1;this._searchTmpHMs=[];this._searchTmpCBs=[]};c.prototype.discover=
function(c){c&&-1==this._searchTmpCBs.indexOf(c)&&this._searchTmpCBs.push(c);if(!this._searchRunning){this._searchRunning=!0;this._searchTmpHMs=[];this._autoDiscoverTO&&(clearTimeout(this._autoDiscoverTO),this._autoDiscoverTO=null);require("xnm.aio.hm.js").discoverCCUs(this._hmHandlerCB);var h=this;setTimeout(function(){h._searchRunning=!1;h._autoDiscoverTO=setTimeout(function(){h.discover()},3E4);h._searchTmpCBs.forEach(function(e){e&&e(h._searchTmpHMs)});h._searchTmpCBs=[]},3E3)}};return c}();
x.hub.m.hm._Util={isDeviceJsonValid:function(c){return c&&c.type&&c.address&&c.interface},isGatewayJsonValid:function(c){return c&&c.ip},getDeviceHashCode:function(c){if(!c)return-1;var h=0;h=(h<<5)-h+this._getStringHashCode(c.type);h=(h<<5)-h+this._getStringHashCode(c.address);return h=(h<<5)-h+this._getStringHashCode(c.interface)},getGatewayHashCode:function(c){if(!c)return-1;var h=80;c.port&&((h=parseInt(c.port))||(h=80));var m=0;m=(m<<5)-m+this._getStringHashCode(c.ip);m=(m<<5)-m+h;m=(m<<5)-m+
this._getStringHashCode(c.uuid);m=(m<<5)-m+this._getStringHashCode(c.username);return m=(m<<5)-m+this._getStringHashCode(c.password)},getLocalIP:function(c,h){var m=function(e){return e?(e=e.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))?(+e[1]<<24)+(+e[2]<<16)+(+e[3]<<8)+ +e[4]:-1:-1};if("127.0.0.1"==h||"localhost"==h)return"127.0.0.1";var e=require("os").networkInterfaces(),g;for(g in e)if(e.hasOwnProperty(g))for(var k=e[g],p=0;p<k.length;p++){var l=k[p];if(l&&"IPv4"==l.family&&l.address){if(c==g||!c&&
!h)return l.address;if(!c&&l.netmask&&h){var q=m(l.netmask),n=m(l.address),r=m(h);if((n&q)==(r&q))return l.address}}}return null},getLocalMac:function(c){var h=require("os").networkInterfaces(),m;for(m in h)if(h.hasOwnProperty(m))for(var e=h[m],g=0;g<e.length;g++){var k=e[g];if(k&&"IPv4"==k.family&&k.address&&k.mac&&c==k.address)return k.mac}return"00:00:00:00:00:00"},isIP:function(c){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(c)},
mergeObj:function(c,h){var m={},e;for(e in c)c.hasOwnProperty(e)&&(m[e]=c[e]);for(e in h)h.hasOwnProperty(e)&&(m[e]=h[e]);return m},_getStringHashCode:function(c){var h=0,m;if("undefined"==typeof c||null==c)return-1;if(0===c.length)return h;var e=0;for(m=c.length;e<m;e++){var g=c.charCodeAt(e);h=(h<<5)-h+g}return h}};
x.hub.m.hm.UdpEventProducer=function(){var c=function(){this._pool={}};c.prototype.EVENT_TO=200;c.prototype.addSTAEvent=function(c){if(c&&c.adr){var h=(new Date).getTime(),e=c.adr,g=this._pool[e];g&&g.timeout&&clearTimeout(g.timeout);var k=this;g=setTimeout(function(){var c=k._pool[e];if(c&&c.states){var g=require("x.hub.eventbus.js");g.emit("gatewayevent",c.states,{address:"HM"},"STA");g.emit("udpevent",c.states,"STA")}},this.EVENT_TO);this._pool[e]={states:c,timestamp:h,timeout:g}}};return c}();
x.hub.m.hm.Handler=function(){var c=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Handler");var c=this;this._udpEvtProducer=new x.hub.m.hm.UdpEventProducer;this._discoveryCB=function(h,e){c._onFindHM(h,e)};this._monitorManager=this._discovery=null;this._managers={};this._chipManager=this._xmlrpcServer=null};util.inherits(c,EventEmitter);c.prototype.CCU=x.hub.m.hm.CCU;c.prototype.XMLRPCClient=x.hub.m.hm.Client;c.prototype.init=function(c){var h=this;if(localStorage){var e=!0;
"false"==localStorage.getItem("x.hub.m.hm.CCU_INIT_STATE")&&(e=!1);x.hub.m.hm.CCU_INIT_STATE=e}require("x.hub.eventbus.js").on("x.hub.m.hm.CCU_INIT_STATE",function(e){var c=!0;"false"==e&&(c=!1);x.hub.m.hm.CCU_INIT_STATE=c});this._discovery=new x.hub.m.hm.CCU2Discovery(this._discoveryCB);this._monitorManager=new x.hub.m.hm.MonitorManager;this._xmlrpcServer=new x.hub.m.hm.Server(global.HM_LOCAL_PORT);this._xmlrpcServer.start(function(e){e?(h._logger.log("warn","start homematic local server error with port:"+
h._xmlrpcServer.getPort()),h._logger.log("warn",e.stack),c&&c({error:e})):h._monitorManager.init(h._xmlrpcServer,function(e){e?c&&c({error:e}):global&&global.HM_CHIP?h._initChipManager(function(e){c&&c({error:e})}):c&&c({})})})};c.prototype.getSystems=function(){return["hm"]};c.prototype.addStateDevice=function(c,m,e){if(c)if(c.gateway&&"mediola"!=c.gateway.uuid)if(c.gateway.ip&&x.hub.m.hm._Util.isIP(c.gateway.ip))if(x.hub.m.hm._Util.isIP(c.gateway.ip)){var g=this._getManager(c.gateway);g?g.addStateDevice(c,
function(e){m&&m({error:e})},e):(g=this._addManager(c.gateway),g.init(function(e){}),g.addStateDevice(c,function(e){m&&m({error:e})},e))}else this._logger.log("warn","ccu has ip:"+c.gateway.ip," , may not receive event from it."),m&&m({error:Error("gateway ip is url")});else m&&m({error:Error("gateway ip format invalid")});else m&&m();else m&&m({error:Error("device json format invalid")})};c.prototype.removeStateDevice=function(c,m,e){if(c)if(c.gateway&&"mediola"!=c.gateway.uuid)if(c.gateway.ip&&
x.hub.m.hm._Util.isIP(c.gateway.ip))if(x.hub.m.hm._Util.isIP(c.gateway.ip)){var g=this._getManager(c.gateway);g?g.removeStateDevice(c,function(e){m&&m({error:e})},e):m&&m({})}else this._logger.log("warn","ccu has ip:"+c.gateway.ip," , may not receive event from it."),m&&m({error:Error("gateway ip is url")});else m&&m({error:Error("gateway ip format invalid")});else m&&m();else m&&m({error:Error("device json format invalid")})};c.prototype.getAllStates=function(){return this._chipManager?this._chipManager.getAllBufferedStates():
[]};c.prototype.getStates=function(c){if(!(c&&x.hub.m.hm._Util.isDeviceJsonValid(c)&&c.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(c.gateway)))return null;var h=this._getManager(c.gateway);if(h)return h.getStates(c);h=this._addManager(c.gateway);h.init();return null};c.prototype.getState=function(c,m,e){if(!c)return e&&e({error:Error("device is null")}),null;if(!c.gateway||"mediola"==c.gateway.uuid){if(!this._chipManager){e&&e({error:Error("chip manager not inited")});return}return this._chipManager.getState(c,
{value:m},function(c,h){e&&e({error:c,data:h})})}if(!x.hub.m.hm._Util.isDeviceJsonValid(c)||!c.gateway||!x.hub.m.hm._Util.isGatewayJsonValid(c.gateway))return e&&e({error:Error("device json invalid")}),null;x.hub.m.hm.HM_MODULE.doStatus("xhub",c.gateway,c,{value:m},function(c,h){c?e&&e({error:c}):h?e&&e({data:{value:h.status}}):e&&e({error:Error("do status failed")})})};c.prototype.executeCommand=function(c,m,e){c?m?c.gateway&&"mediola"!=c.gateway.uuid?c.gateway?x.hub.m.hm.HM_MODULE.doCommand(c.gateway,
c,m,function(c){c?e&&e({error:c}):e&&e({})}):e&&e({error:Error("gateway is null")}):this._chipManager?this._chipManager.executeCommand(c,m,function(c){e&&e({error:c})}):e&&e({error:Error("chip manager not inited")}):e&&e({error:Error("command invalid")}):e&&e({error:Error("device is null")})};c.prototype.updateStates=function(c,m){if(c&&x.hub.m.hm._Util.isDeviceJsonValid(c)&&c.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(c.gateway)){var e=this._getManager(c.gateway);e?e.updateStates(c,function(c,
e){m&&m({error:c,data:e})}):(e=this._addManager(c.gateway),e.init(function(g){g?m&&m({error:g}):e.updateStates(c,function(c,e){m&&m({error:c,data:e})})}))}else m&&m({error:Error("device json format invalid")})};c.prototype.checkDeviceMatch=function(c,m){if(!(m&&m.device&&c&&c.device))return!1;if(m.gateway&&"mediola"!=m.gateway.uuid)return m=x.hub.m.hm._Util.getDeviceHashCode(m.device),c=x.hub.m.hm._Util.getDeviceHashCode(c.device),m==c;var e=c.device.address;c.device.interface&&c.device.type&&(e=
c.device.type+"."+c.device.interface+"."+c.device.address);return e!=m.device.address?!1:!0};c.prototype._initChipManager=function(c){var h="127.0.0.1";global&&global.HM_CHIP&&(h=global.HM_CHIP);this._chipManager=new x.hub.m.hm.ChipManager({ip:h,username:global.HM_CHIP_USERNAME,password:global.HM_CHIP_PASSWORD,uuid:"mediola"});this._chipManager.init(c)};c.prototype._initCCU3Manager=function(c){this._addManager({ip:"127.0.0.1",type:3}).init(function(h){c&&c(h)})};c.prototype._discover=function(c){this._discovery.discover(c)};
c.prototype._onFindHM=function(c,m){this._logger.log("debug","find ccu:"+c.uuid+"@"+c.ip+" from netif:"+m);this._monitorManager.onFindHomeMatic(c.ip,m,c.uuid)};c.prototype._getManager=function(c){c=x.hub.m.hm._Util.getGatewayHashCode(c);return this._managers[c]};c.prototype._addManager=function(c){var h=x.hub.m.hm._Util.getGatewayHashCode(c);c=new x.hub.m.hm.Manager(c);return this._managers[h]=c};c.prototype.onDeviceEvent=function(c,m){this._logger.log("trace","receive device event:"+JSON.stringify(c));
require("x.hub.eventbus.js");if(m)this._chipManager&&(this._chipManager.checkButtonEvent(c),c=this._chipManager.getBufferedStateLegacy(c.device,c.channel))&&(c._ver="v5+",this._udpEvtProducer.addSTAEvent(c));else for(var e in this._managers)if(m=this._managers[e])try{m.onDeviceEvent(c)}catch(g){console.error(g)}};c.prototype.resetChip=function(c){this._chipManager?this._chipManager.reset(function(){c&&c({})}):c&&c(Error("chip manager not inited"))};c.prototype.initManager=function(c,m){if(c){var e=
this._getManager(c);e||(e=this._addManager(c));e.init(function(c){m&&m({error:c})})}else m&&m({error:Error("gateway invalid")})};c.prototype.learnRFDevice=function(c,m){if(c){var e=this._getManager(c);e?e.learnRFDevice(function(c,e){m&&m({error:c,data:e})}):(e=this._addManager(c),e.init(function(c){c?m&&m({error:c}):setTimeout(function(){e.learnRFDevice(function(c,e){m&&m({error:c,data:e})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDevice(function(c,e){if(c)m&&m({error:c});else{var g=
[];e.forEach(function(c){if(c){var e=c.toLegacyAdr();c=c.toLegacyType();g.push({address:e,type:c})}});m&&m({data:g})}}):m&&m(Error("chip manager not inited"))};c.prototype.learnRFDeviceSN=function(c,m,e){if(c){var g=this._getManager(c);g?g.learnRFDevice(function(c,g){e&&e({error:c,data:g})}):(g=this._addManager(c),g.init(function(c){c?e&&e({error:c}):setTimeout(function(){g.learnRFDevice(function(c,g){e&&e({error:c,data:g})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDeviceSN(m,function(c,
g){if(c)e&&e({error:c});else{var h=[];g.forEach(function(c){if(c){var e=c.toLegacyAdr();c=c.toLegacyType();h.push({address:e,type:c})}});e&&e({data:h})}}):e&&e(Error("chip manager not inited"))};c.prototype.learnIPDevice=function(c,m,e,g){if(c){var h=this._getManager(c);h?h.learnIPDevice(m,e,function(c,e){g&&g({error:c,data:e})}):(h=this._addManager(c),h.init(function(c){c?g&&g({error:c}):setTimeout(function(){h.learnIPDevice(m,e,function(c,e){g&&g({error:c,data:e})})},3E3)}))}else m?e?this._chipManager?
this._chipManager.learnIPDevice(m,e,function(c,e){if(c)g&&g({error:c});else{var h=[];e.forEach(function(c){if(c){var e=c.toLegacyAdr();c=c.toLegacyType();h.push({address:e,type:c})}});g&&g({data:h})}}):g&&g(Error("chip manager not inited")):g&&g({error:Error("key is null")}):g&&g({error:Error("sgtin is null")})};c.prototype.learnIPDeviceQR=function(c,m,e){if(m)if(c){var g=this._getManager(c);g?g.learnIPDeviceQR(m,function(c,g){e&&e({error:c,data:g})}):(g=this._addManager(c),g.init(function(c){c?e&&
e({error:c}):setTimeout(function(){g.learnIPDeviceQR(m,function(c,g){e&&e({error:c,data:g})})},3E3)}))}else this._chipManager?this._chipManager.learnIPDeviceQR(m,function(c,g){if(c)e&&e({error:c});else{var h=[];g.forEach(function(c){if(c){var e=c.toLegacyAdr();c=c.toLegacyType();h.push({address:e,type:c})}});e&&e({data:h})}}):e&&e(Error("chip manager not inited"));else e&&e({error:Error("qrKey is null")})};c.prototype.deleteDevice=function(c,m,e){if(m){var g=m.split(".");3>g.length?e&&e({error:Error("address invalid")}):
(m=g[1],g=g[2],c?e&&e({error:Error("not supported yet")}):this._chipManager?this._chipManager.deleteDevice(m,g,function(c){e&&e({error:c})}):e&&e(Error("chip manager not inited")))}else e&&e({error:Error("address invalid")})};c.prototype.getRFInterfaces=function(c,m){if(c){var e=this._getManager(c);e?e.getRFInterfaces(function(c,e){m&&m({error:c,data:e})}):(e=this._addManager(c),e.init(function(c){c?m&&m({error:c}):setTimeout(function(){e.getRFInterfaces(function(c,e){m&&m({error:c,data:e})})},3E3)}))}else this._chipManager?
this._chipManager.getRFInterfaces(function(c,e){m&&m({error:c,data:e})}):m&&m(Error("chip manager not inited"))};c.prototype.executeCommandLegacy=function(c,m,e,g){c?g&&g({error:Error("not supported yet")}):this._chipManager?m?this.executeCommand({address:m},{value:e},function(c){g&&g({error:c?c.error:null})}):g&&g({error:Error("address invalid")}):g&&g({error:Error("chip manager not inited")})};c.prototype.getAllStatesLegacy=function(c){var h=[];try{this.getAllStates().forEach(function(c){if(c&&
c.device&&c.states){var e={type:"HM",adr:c.device.toLegacyAdr(),state:{}},k;for(k in c.states)e.state[k]=c.states[k].value;h.push(e)}})}catch(e){console.error(e.stack)}c&&c({data:h})};c.prototype.getConfig=function(c,m){c?c.gateway&&"mediola"!=c.gateway.uuid?m&&m({error:Error("not supported yet")}):this._chipManager?this._chipManager.getConfig(c,function(c,g){m&&m({error:c,data:g})}):m&&m({error:Error("chip manager not inited")}):m&&m({error:Error("device is null")})};c.prototype.setConfig=function(c,
m,e){c?c.gateway&&"mediola"!=c.gateway.uuid?e&&e({error:Error("not supported yet")}):this._chipManager?this._chipManager.setConfig(c,m,function(c){e&&e({error:c})}):e&&e({error:Error("chip manager not inited")}):e&&e({error:Error("device is null")})};c.prototype.getMonitorStates=function(c){this._monitorManager.getMonitorStates(function(h,e){c&&c({error:h,data:e})})};c.prototype.getAllDevices=function(c){var h=[];try{this.getAllStates().forEach(function(c){c&&c.device&&c.states&&(c={type:"HM",address:c.device.toLegacyAdr(),
data:c.device.toLegacyType(),snr:c.device.getSerial(),_ver:"v5+"},h.push(c))})}catch(e){console.error(e.stack)}c&&c({data:h})};c.prototype.isWindowOpen=function(){try{for(var c=this.getAllStates(),m=0;m<c.length;m++){var e=c[m];if(e&&e.device&&e.states){var g=e.device.toLegacyType();if("window"==g){if(e.states.state&&"closed"!=e.states.state.value)return!0}else if("contact"==g){if(e.states.state&&"closed"!=e.states.state.value)return!0}else if("ip_contact"==g){if(e.states.state&&"closed"!=e.states.state.value)return!0}else if("ip_window"==
g&&e.states.state&&"closed"!=e.states.state.value)return!0}}}catch(k){return!1}};return c}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.hm.Handler);
