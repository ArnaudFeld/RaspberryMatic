var util=require("util"),EventEmitter=require("events"),async=require("async");require("x.logger.js").setLevel("info","x.hub.m.hm");var x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.hm=x.hub.m.hm||{};x.hub.m.hm.CCU_INIT_STATE=!0;x.hub.m.hm.HM_MODULE=require("xnm.aio.hm.js");
x.hub.m.hm.RFDeviceTypes={"HM-PB-4Dis-WM":0,"ZEL STG RM DWT 10":0,"263 155":0,"HM-PB-4Dis-WM-2":0,ASH550I:1,ASH550:1,"HM-WDS10-TH-O":1,"263 158":1,"HM-WDS20-TH-O":1,"HM-WDS40-TH-I":1,"263 157":1,"IS-WDS-TH-OD-S-R3":1,"HM-WDS40-TH-I-2":1,"HM-LC-Bl1-SM":2,"HM-LC-Bl1-FM":2,"HM-LC-Bl1-PB-FM":2,"ZEL STG RM FEP 230V":2,"263 146":2,"HM-LC-BlX":2,"HM-LC-Bl1-SM-2":2,"HM-LC-Bl1-FM-2":2,"HM-LC-Bl1PBU-FM":2,"263 147":2,"HM-CC-RT-DN":3,"HM-CC-RT-DN-BoM":4,"HM-CC-TC":5,"ZEL STG RM FWT":5,"HM-CC-VD":6,"ZEL STG RM FSA":6,
CENTRAL:7,"HM-RCV-50":7,"HM-OU-CF-Pl":8,"HM-OU-CFM-Pl":9,"HM-OU-CFM-TW":9,"HM-OU-CM-PCB":10,"HM-LC-AO-SM":11,"HM-LC-Dim1L-Pl":11,"HM-LC-Dim1L-Pl-2":11,"HM-LC-Dim1L-CV":11,"263 132":11,"HM-LC-Dim2L-CV":11,"HM-LC-Dim2L-SM":11,"HSS-DX":11,"HM-LC-Dim1L-Pl-3":11,"HM-LC-Dim1L-CV-2":11,"HM-LC-Dim2L-SM-2":11,"HM-LC-Dim1PWM-CV":12,"HM-LC-Dim1PWM-CV-2":12,"HM-LC-Dim1TPBU-FM":13,"HM-LC-Dim1TPBU-FM-2":13,"263 133":13,"HM-LC-Dim1T-Pl":13,"HM-LC-Dim1T-CV":13,"HM-LC-Dim1T-FM":13,"HM-LC-Dim1T-Pl-3":13,"HM-LC-Dim1T-CV-2":13,
"HM-LC-Dim1T-FM-2":13,"HM-LC-Dim2T-SM":13,"HM-LC-Dim2T-SM-2":13,"HM-LC-Dim1T-Pl-2":13,"263 134":13,"HM-LC-Dim1T-DR":13,"HM-LC-Dim1T-FM-LF":13,"OLIGO.smart.iq.HM":11,"HM-Dis-WM55":14,"HM-MOD-EM-8":15,"HM-ES-PMSw1-Pl":16,"HM-ES-PMSw1-Pl-DN-R1":16,"HM-ES-PMSw1-Pl-DN-R2":16,"HM-ES-PMSw1-Pl-DN-R3":16,"HM-ES-PMSw1-Pl-DN-R4":16,"HM-ES-PMSw1-Pl-DN-R5":16,"HM-ES-PMSw1-DR":16,"HM-ES-PMSw1-SM":16,"HM-Dis-TD-T":17,"HM-Sec-Key":18,"HM-Sec-Key-S":18,"HM-Sec-Key-O":18,"HM-Sec-Key-Generic":18,KS550:19,KS888:19,KS550Tech:19,
KS550LC:19,"HM-WDS100-C6-O":19,"HM-WDS100-C6-O-2":19,"HM-OU-LED16":20,"HM-OU-X":20,"HM-PB-2-WM55-2":21,"HM-PB-2-WM55":21,"ZEL STG RM WT 2":21,"263 135":21,"HM-PB-2-FM":21,"HM-PBI-4-FM":21,"ZEL STG RM FST UP4":21,"263 145":21,"HM-PBI-X":21,"HM-RC-4-2":21,"HM-PB-6-WM55":21,"HM-RC-8":21,"HM-RC-4":21,"HM-RC-4-3":21,"HM-RC-4-B":21,"HM-RC-P1":21,"HM-RC-Sec3":21,"HM-RC-Sec3-B":21,"HM-RC-Key3":21,"HM-RC-Key3-B":21,"HM-PB-4-WM":21,"HM-PB-2-WM":21,"HM-RC-2-PBU-FM":21,"RC-H":21,atent:21,"ZEL STG RM HS 4":21,
"HM-RC-X":21,"BRC-H":21,"HM-RC-SB-X":21,"HM-RC-12":21,"HM-RC-12-B":21,"HM-RC-12-SW":21,"HM-RC-Key4-2":22,"HM-RC-Sec4-2":22,"HM-RC-Key4-3":22,"HM-RC-Sec4-3":22,"HM-RC-19":23,"HM-RC-19-B":23,"HM-RC-19-SW":23,"HM-Sen-RD-O":24,"HM-Sec-RHS":25,"HM-Sec-RHS-2":25,"ZEL STG RM FDK":25,"HM-Sec-xx":25,"HM-LC-Sw1-Pl":26,"HM-LC-Sw1-Pl-2":26,"HM-LC-Sw1-SM":26,"HM-LC-Sw2-SM":26,"HM-LC-Sw4-SM":26,"HM-LC-Sw4-PCB":26,"HM-LC-Sw4-WM":26,"HM-LC-Sw1-FM":26,"263 130":26,"HM-LC-Sw2-FM":26,"HM-LC-Sw1-PB-FM":26,"HM-LC-Sw2-PB-FM":26,
"HM-LC-Sw4-DR":26,"HM-LC-Sw2-DR":26,"ZEL STG RM FZS":26,"ZEL STG RM FZS-2":26,"HM-LC-Sw1PBU-FM":26,"HM-LC-Sw2PBU-FM":26,"263 131":26,"HM-MOD-Re-8":26,"HM-LC-Sw1-Ba-PCB":26,"HM-LC-Sw4-Ba-PCB":26,"HM-LC-Sw1-Pl-3":26,"HM-LC-Sw1-SM-2":26,"HM-LC-Sw4-SM-2":26,"HM-LC-Sw4-PCB-2":26,"HM-LC-Sw4-WM-2":26,"HM-LC-Sw1-FM-2":26,"HM-LC-Sw2-FM-2":26,"HM-LC-Sw4-DR-2":26,"HM-LC-Sw2-DR-2":26,"HM-LC-Sw1-Pl-DN-R1":26,"HM-LC-Sw1-Pl-DN-R2":26,"HM-LC-Sw1-Pl-DN-R3":26,"HM-LC-Sw1-Pl-DN-R4":26,"HM-LC-Sw1-Pl-DN-R5":26,"HM-LC-Sw1-DR":26,
"HM-LC-Sw1-Pl-CT-R1":26,"HM-LC-Sw1-Pl-CT-R2":26,"HM-LC-Sw1-Pl-CT-R3":26,"HM-LC-Sw1-Pl-CT-R4":26,"HM-LC-Sw1-Pl-CT-R5":26,"HM-LC-Sw1-PCB":26,"HM-LC-Sw1-Pl-OM54":26,"HM-LC-Sw1-SM-ATmega168":26,"HM-LC-Sw4-SM-ATmega168":26,S550IA:27,"HM-WDS30-T-O":27,"HM-Sec-SC":28,"ZEL STG RM FFK":28,"HM-Sec-SC-2":28,"HM-SCI-3-FM":29,"HM-CC-SCD":30,"263 160":30,"HM-Sec-MDIR-3":31,"HM-Sec-MDIR-2":31,"HM-Sec-MDIR":31,"263 162":31,"HM-Sec-MD":31,"HM-Sec-SD":32,"HM-Sec-SD-Generic":32,"HM-Sec-SD-2":32,"HM-Sec-SD-2-Generic":32,
"HM-Sec-SFA-SM":33,"HM-Sen-MDIR-SM":34,"HM-Sen-MDIR-O":34,"HM-MD":34,"HM-Sen-MDIR-O-2":34,"HM-Sen-MDIR-O-3":34,"HM-Sen-EP":35,"HM-Sen-X":35,"HM-Sen-Wa-Od":36,"HM-SwI-3-FM":37,"ZEL STG RM FSS UP3":37,"263 144":37,"HM-SwI-X":37,"HM-TC-IT-WM-W-EU":38,"HM-Sec-TiS":39,"HM-WDS30-OT2-SM":40,"HM-WDS30-OT2-SM-2":40,"HM-Sec-WDS":41,"HM-Sec-WDS-2":41,"HM-Sec-Win":42,"HM-Sec-Win-Generic":42,WS550:43,WS888:43,WS550Tech:43,WS550LCB:43,WS550LCW:43,"HM-WDC7000":43,"HMW-IO-12-Sw14-DR":44,"HMW-IO-12-Sw7-DR":45,"HMW-IO-12-FM":46,
"HMW-IO-4-FM":46,"HMW-LC-Bl1-DR":47,"HMW-LC-Dim1L-DR":48,"HMW-LC-Sw2-DR":49,"HMW-Sen-SC-12-DR":50,"HMW-Sen-SC-12-FM":50,"HM-CC-VG-1":51,"HM-ES-TX-WM":52,"HM-LC-RGBW-WM":53,"HM-Sec-SD-2-Team":54,"HM-Sen-LI-O":56,"HM-Sec-SCo":28,"HM-Sec-Sir-WM":57,"HM-LC-Ja1PBU-FM":58,"HM-MOD-EM-8Bit":59,"HM-Dis-EP-WM55":60,"HM-Sen-MDIR-WM55":61,"HM-LC-DW-WM":62};
x.hub.m.hm.RFDeviceCatagory=[{type:"button",channelNum:"*",channel:"KEY"},{type:"weather"},{type:"blind",channelNum:"*",channel:"BLIND"},{type:"heater2"},{type:"heater3"},{type:"wallthermo"},{type:"heater"},{type:"vbutton",channelNum:"*",channel:"VIRTUAL_KEY"},{type:"gong"},{type:"gong2"},{type:"gong2"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"button",channelNum:"*",channel:"KEY"},{type:"mod_em_8",
channelNum:"*",channel:"KEY"},{type:"powerswitch"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"keymatic"},{type:"weatherstation"},{type:"ou_led16",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"rain"},{type:"window"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"temp"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"contact",channelNum:"*",
channel:"SHUTTER_CONTACT"},{type:"co2"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{type:"smoke"},{type:"siren",channelNum:"*",channel:"ALARMACTUATOR"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{},{type:"capacity"},{type:"switch_interface",channelNum:"*",channel:"SWITCH_INTERFACE"},{type:"wallthermo2"},{type:"tilt",channelNum:"*",channel:"TILT_SENSOR"},{type:"temp2",channel:"WEATHER"},{type:"water",channelNum:"*",channel:"WATERDETECTIONSENSOR"},{},{type:"weather2"},{},
{},{},{},{},{},{},{},{type:"energymeter"},{type:"rgb"},{},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"lux"},{type:"siren2"},{type:"jalousie",channelNum:"*",channel:"JALOUSIE"},{type:"mod_em_8bit"},{type:"button",channelNum:"*",channel:"KEY"},{},{type:"dualwhite"}];
x.hub.m.hm.IPDeviceTypes={"HMIP-PS":0,"HmIP-PCBS":0,"HmIP-PCBS-BAT":0,"HMIP-SWDO":1,"HmIP-SWDO-I":1,"Contact AA":1,"HMIP-WTH":2,"HmIP-WTH-2":2,"HmIP-STH":2,"HmIP-STHD":2,"HMIP-eTRV":3,"HMIP-eTRV-2":3,"HmIP-eTRV-2-UK":3,"HMIP-WRC2":4,"HmIP-SMI":5,"HmIP-SMO":5,"HmIP-SMO-A":5,"HmIP-SRH":6,"HmIP-SWSD":7,"HmIP-PSM":8,"Smart Plug AA":8,"HmIP-PSM-PE":8,"HmIP-PSM-UK":8,"HmIP-PSM-IT":8,"HmIP-PSM-CH":8,"HmIP-BSM":9,"HmIP-BDT":10,"HmIP-ASIR":11,"HmIP-KRC4":12,"HmIP-KRCA":12,"HmIP-PDT":13,"HmIP-PDT-UK":13,"HmIP-FSM":14,
"HmIP-FSM16":14,"HmIP-BROLL":15,"HmIP-FROLL":15,"HmIP-FBL":16,"HmIP-BBL":16,"HmIP-SPI":17,"HmIP-FDT":18,"HmIP-BWTH":19,"HmIP-BWTH24":19,"HmIP-FAL230-C6":20,"HmIP-FAL24-C6":20,"HmIP-FAL230-C10":20,"HmIP-FAL24-C10":20,"HmIP-WRC6":21,"HmIP-SWO-B":22,"HmIP-SWO-PL":23,"HmIP-SWO-PR":27,"HmIP-STHO":24,"HmIP-STHO-A":24,"HmIP-SPDR":25,"HmIP-SMI55":26,"HmIP-RC8":28,"HmIP-MIOB":0,"HmIP-SWD":31};
x.hub.m.hm.IPDeviceCatagory=[{type:"ip_switch"},{type:"ip_contact"},{type:"ip_wallthermo"},{type:"ip_heater"},{type:"ip_button2"},{type:"ip_motion"},{type:"ip_window"},{type:"ip_smoke"},{type:"ip_powerswitch"},{type:"ip_energyactor"},{type:"ip_dimmer"},{type:"ip_siren"},{type:"ip_button4"},{type:"ip_dimmer2"},{type:"ip_energyactor2"},{type:"ip_blind"},{type:"ip_jalousie"},{type:"ip_presence"},{type:"ip_dimmer3"},{type:"ip_wallthermo2"},{type:"ip_floor_heater"},{type:"ip_button6"},{type:"ip_weather"},
{type:"ip_weather2"},{type:"ip_weather3"},{type:"ip_direction"},{type:"ip_motion2"},{type:"ip_weather4"},{type:"ip_button8"},{type:"ip_generic_input"},{type:"ip_analog_output"},{type:"ip_water"}];
x.hub.m.hm.Client=function(){var k=function(e,h,a,f,q){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Client");this.ip=e;this.port=h;this.port||(this.port=2001);this.username=a;this.password=f;this.useHttps=q;this.timeout=2E4;this.xml2js=null};k.prototype._doRequest=function(e,h,a){var f=require("http");this.useHttps&&(f=require("https"));e={host:this.ip,port:this.port,path:"/",method:e,headers:{"User-Agent":"mediola",Connection:"keep-alive"}};this.username&&(e.auth=this.username+":"+(this.password?
this.password:""));h&&(e.headers["Content-Length"]=h.length);var q=a,p=this;this._logger.log("trace","send http request:"+JSON.stringify(e));this._logger.log("trace","send http data:"+h);a=f.request(e,function(a){var f="";a.setEncoding("utf-8");a.on("data",function(a){f+=a});a.on("end",function(){p._logger.log("trace","http response status:"+a.statusCode);p._logger.log("trace","http response data:"+f);var e=null;200!=a.statusCode&&(e=Error("http response "+a.statusCode));q&&q(e,f,a.statusCode)})});
a.on("error",function(a){p._logger.log("trace","http request error:"+a.stack);q&&q(a);q=null});a.setTimeout(this.timeout,function(){p._logger.log("trace","http request timeout");q&&q(Error("http timeout"));q=null});h&&a.write(h);a.end()};k.prototype._doXMLRpcRequest=function(e,h,a){var f=require("x.xmlrpc.js");e='<?xml version="1.0" encoding="ISO-8859-1"?><methodCall><methodName>'+e+"</methodName><params>";for(var q=0;q<h.length;q++)e=h[q]&&h[q].type&&void 0!=h[q].value?e+("<param>"+f.serializeValue(h[q].value,
h[q].type)+"</param>"):e+("<param>"+f.serializeValue(h[q])+"</param>");e+="</params></methodCall>";this._doRequest("POST",e,function(q,l){if(q)a&&a(q);else if(l)try{var e=f.deserializeRsp(l);e.error?a&&a(Error("xml rcp return error:"+e.error.faultString+" @code:"+e.error.faultCode),e.error):a&&a(null,e.params)}catch(h){a&&a(h)}else a&&a(Error("xml rcp response format invalid"))})};k.prototype.convertHmIPKeyBase32ToBase16=function(e){e=e.replace(/-/g,"").toUpperCase();for(var h="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),
a=new ArrayBuffer(16),a=new Uint8Array(a),f=0,q=e.length-1,p=0,l=a.length-1,k="";0<=q;){for(var m=0;m<h.length;m++)if(h[m]==e.charAt(q)){f|=m<<p;break}p+=5;for(q--;8<p&&0<=l;)a[l]=f&255,f>>=8,p-=8,l--}for(m=0;m<a.length;m++)16>a[m]&&(k+="0"),k+=a[m].toString(16);return k.toUpperCase()};k.prototype._getValue=function(e){var h=null;if(this.xml2js)if(e["boolean"]&&e["boolean"][0])h=parseInt(e["boolean"][0])?!0:!1;else if(e.i4&&e.i4[0])h=parseInt(e.i4[0]);else if(e.double&&e.double[0])h=parseFloat(e.double[0]);
else if(e.array&&e.array[0]&&e.array[0].data&&e.array[0].data[0]&&e.array[0].data[0].value){h=[];e=e.array[0].data[0].value;for(var a in e)h.push(e[a])}else h=e;else if(a=e,e=e.find("value"),0<e.length&&(a=$(e[0])),a&&(h=a.text(),!h&&a.children()&&0<a.children().length))if(e=$(a.children()[0]),"boolean"==e.prop("tagName"))h=parseInt(e.text())?!0:!1;else if("i4"==e.prop("tagName"))h=parseInt(e.text());else if("double"==e.prop("tagName"))h=parseFloat(e.text());else if("array"==e.prop("tagName"))for(h=
[],e=e.find("data value"),a=0;a<e.length;a++){var f=$(e[a]).text();f&&h.push(f)}else XC.debugf("unknown valuetype:"),XC.debugf(e.getXMLString());return h};k.prototype._getStructData=function(e){var h={};if(e.struct&&e.struct[0]&&e.struct[0].member){e=e.struct[0].member;for(var a in e)e[a].name&&e[a].name[0]&&e[a].value&&e[a].value[0]&&(h[e[a].name[0]]=this._getValue(e[a].value[0]))}return h};k.prototype._waitForNewDevices=function(e,h,a){var f=this;this.getDeviceList(function(q){if(0>=h||Object.keys(q).length>
Object.keys(e).length){for(var p in q)e[p]||XC.debugf("new device: "+p);a&&a(q)}else setTimeout(function(){f._waitForNewDevices(e,h-4,a)},4E3)})};k.prototype.init=function(e,h,a){this._doXMLRpcRequest("init",[e,h],function(f){a&&a(f)})};k.prototype.getIP=function(){return this.ip};k.prototype.getPort=function(){return this.port};k.prototype.setPort=function(e){this.port=e};k.prototype.getValue=function(e,h,a,f){e=[e,h];"undefined"!=typeof a&&null!=a&&e.push(a);this._doXMLRpcRequest("getValue",e,function(a,
e){var l=null;!a&&e?l=e[0]:a&&e&&(l=e);f&&f(a,l)})};k.prototype.setValue=function(e,h,a,f){this._doXMLRpcRequest("setValue",[e,h,a],function(a){f&&f(a)})};k.prototype.getParamset=function(e,h,a,f){this._doXMLRpcRequest("getParamset",[e,h,a],function(a,e){var l=null;!a&&e?l=e[0]:a&&e&&(l=e);f&&f(a,l)})};k.prototype.putParamset=function(e,h,a,f){this._doXMLRpcRequest("putParamset",[e,h,a],function(a,e){var l=null;!a&&e?l=e[0]:a&&e&&(l=e);f&&f(a,l)})};k.prototype.listDevices=function(e){this._doXMLRpcRequest("listDevices",
[],function(h,a){var f=[];!h&&a&&(f=a[0]);e&&e(h,f)})};k.prototype.deleteDevice=function(e,h,a){this._doXMLRpcRequest("deleteDevice",[e,h],function(f){a&&a(f)})};k.prototype.setInstallMode=function(e,h,a,f){var q=[];q.push(e);"undefined"!=typeof h&&null!=h&&q.push(h);"undefined"!=typeof a&&null!=a&&q.push(a);this._doXMLRpcRequest("setInstallMode",q,function(a){f&&f(a)})};k.prototype.setInstallModeWithWhitelist=function(e,h,a,f){var q=[];q.push(e);"undefined"!=typeof h&&null!=h&&q.push(h);"undefined"!=
typeof a&&null!=a&&q.push(a);this._doXMLRpcRequest("setInstallModeWithWhitelist",q,function(a){f&&f(a)})};k.prototype.addNewDevice=function(e){var h=this;this.getDeviceList(function(a){h._doRequest("setInstallMode",[!0,30,2],function(f){setTimeout(function(){h._waitForNewDevices(a,30,e)},4E3)})})};k.prototype.addNewDeviceWithSGTN=function(e,h,a){var f=this;this.getDeviceList(function(q){f._doRequest("setInstallModeWithWhitelist",[!0,30,[{ADDRESS:h,KEY_MODE:"LOCAL",KEY:a}]],function(a){setTimeout(function(){f._waitForNewDevices(q,
30,e)},4E3)})})};k.prototype.listBidcosInterfaces=function(e){this._doXMLRpcRequest("listBidcosInterfaces",[],function(h,a){var f=[];!h&&a&&(f=a[0]);e&&e(h,f)})};k.prototype.reportValueUsage=function(e,h,a,f){this._doXMLRpcRequest("reportValueUsage",[e,h,a],function(a,e){var l;!a&&e&&(l=e[0]);f&&f(a,l)})};k.prototype.ping=function(e,h){this._doXMLRpcRequest("ping",[e],function(a){h&&h(a)})};return k}();
x.hub.m.hm.Server=function(){var k=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Server");this._port=9099;e&&0<e&&(this._port=e);this._server=null;this._servlet={}};k.prototype.getPort=function(){return this._port};k.prototype.stop=function(e){this._server?this._server.close():e&&e()};k.prototype.start=function(e){if(this._server)e&&e();else{var h=e,a=this,f=require("http").createServer(function(f,e){a._logger.log("trace","receive request method:"+f.method);a._logger.log("trace",
"receive request path:"+f.url);a._logger.log("trace","receive request header:"+JSON.stringify(f.headers));var l="";f.on("data",function(a){l+=a.toString()});f.on("end",function(){a._logger.log("trace","receive request body:"+l);"POST"==f.method?a._handleRequest(l,f,e):(a._logger.log("trace","send 404 response"),e.writeHead(404,"Not found"),e.end())})});f.on("error",function(f){a._logger.log("trace","xmlrpc server err:"+f.stack);h&&h(f);h=null;a._server=null});f.listen(this._port,function(){a._logger.log("trace",
"xmlrpc server listening on port:"+a._port);a._server=f;h&&h();h=null})}};k.prototype.registServlet=function(e,h){e&&h&&(this._servlet[e]=h)};k.prototype.unregistServlet=function(e){e&&delete this._servlet[e]};k.prototype._handleRequest=function(e,h,a){var f=h.url,q=require("x.xmlrpc.js"),p=this;try{var l=q.deserializeReq(e);if("system.multicall"==l.methodName)this._handleMultiCall(l.params[0],h,a);else if(this._logger.log("debug","receive method call:"+l.methodName),this._logger.log("debug","params:"+
JSON.stringify(l.params)),"system.listMethods"==l.methodName)this._sendSuccessResponse(["event listDevices newDevices deleteDevices updateDevice replaceDevice readdedDevice".split(" ")],a);else if(this._servlet[f])this._servlet[f](l.methodName,l.params,function(f,q){f?p._sendErrorResponse(f,a):p._sendSuccessResponse([q],a)});else this._sendSuccessResponse([[]],a)}catch(k){this._sendErrorResponse(k,a)}};k.prototype._handleMultiCall=function(e,h,a){h=h.url;this._logger.log("trace","---------------------------------");
this._logger.log("trace","receive system.multicall");for(var f=0;f<e.length;f++){var q=e[f];this._logger.log("trace","receive method call:"+q.methodName);this._logger.log("trace","params:"+JSON.stringify(q.params));if(this._servlet[h])this._servlet[h](q.methodName,q.params)}this._logger.log("trace","---------------------------------");this._sendSuccessResponse([[]],a)};k.prototype._sendSuccessResponse=function(e,h){var a=require("x.xmlrpc.js").serializeRsp(null,e);this._logger.log("trace","send xml success response:"+
a);h.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(a)+""});h.write(a);h.end()};k.prototype._sendErrorResponse=function(e,h){var a=require("x.xmlrpc.js"),f=-1;e.errCode&&(f=e.errCode);a=a.serializeRsp({faultCode:f,faultString:e.message});this._logger.log("trace","send xml fault response:"+a);h.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(a)+""});h.write(a);h.end()};return k}();
x.hub.m.hm._Controller=function(){var k=function(a,f,l,e,h,k){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller");this._client=new x.hub.m.hm.Client(a,f,l,e,h);this._initStates=k;this.interface=null;this._devices={};this._status={};this._learnDeviceCbs=[];this._learnDeviceTO=null;this._readValueCbs={}};util.inherits(k,EventEmitter);k.prototype.getIP=function(){return this._client.getIP()};k.prototype.getPort=function(){return this._client.getPort()};k.prototype.setPort=function(a){return this._client.setPort(a)};
k.prototype.getAllBufferedStates=function(){var a={},f;for(f in this._devices){var l=this._devices[f];!l.PARENT&&l.CHILDREN?a[f]={device:{type:l.TYPE,"interface":this.interface,address:l.ADDRESS,channels:{}},states:{}}:l.PARENT&&(a[l.PARENT].device.channels[l.ADDRESS]={type:l.TYPE,address:l.ADDRESS});if(l.CHILDREN)for(var e=0,h=l.CHILDREN.length;e<h;e++){var k=l.CHILDREN[e];if(this._status[k]){a[f].states[k]={};for(var t in this._status[k])a[f].states[k][t]=this._status[k][t]}}}return a};k.prototype.getBufferedState=
function(a){if(!a)return null;var f=a.indexOf(":");-1!=f&&(a=a.substr(0,f));a=this._devices[a];if(!a)return null;var l={};if(a.CHILDREN){var e=this;a.CHILDREN.forEach(function(a){if(e._status[a]){l[a]={};for(var f in e._status[a])l[a][f]=e._status[a][f]}})}return l};k.prototype.getBufferedDevices=function(){return this._getDeviceStructs(this._devices)};k.prototype.getState=function(a,f,l){var e=this.getBufferedState(a);if(e&&e[a]&&e[a][f]){var e=e[a][f],h=e.value;if("undefined"!=typeof h&&null!=h){l&&
l(null,e);return}}this.updateState(a,f,function(a,f){l&&l(a,f)})};k.prototype.updateState=function(a,f,l){var e=this;this.readValue(a,f,function(h,k){h?setTimeout(function(){var h,k=e.getBufferedState(a);k&&k[a]&&k[a][f]&&(h=k[a][f]);l&&l(null,h)},1E3):l&&l(null,{value:k,time:(new Date).getTime()})})};k.prototype.reset=function(a){var f=[];Object.keys(this._devices).forEach(function(a){a&&-1==a.indexOf(":")&&"BidCoS-RF"!=a&&f.push(a)});if(0==f.length)a&&a();else{var l=0,e=this,h=function(k){l++;l<
f.length?e.deleteDevice(f[l],h):a&&a()};this.deleteDevice(f[l],h)}};k.prototype.register=function(a,f,l){if(a){this._logger.log("debug","register:"+f+" to "+a);var e=this;this._client.init(a,f,function(a){e._logger.log("debug","registed:"+f+(a?" err:"+a.message:""));l&&l(a,a?null:f)})}else l&&l(Error("arguments invalid"))};k.prototype.unregister=function(a,f){a?this._client.init(a,"",function(a){f&&f(a)}):f&&f(Error("url invalid"))};k.prototype.getDevices=function(a){this._client.listDevices(function(f,
l){if(f)a&&a(f);else for(var e=0;e<l.length;e++);})};k.prototype.learnNewDevice=function(a){var f=this._learnDeviceCbs.length;a&&-1==this._learnDeviceCbs.indexOf(a)&&this._learnDeviceCbs.push(a);if(0==f){var l=this;this._learnDeviceTO=setTimeout(function(){var a=l._learnDeviceCbs;l._learnDeviceCbs=[];for(var f=0;f<a.length;f++){var q=a[f];q&&q(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,1,function(a){if(a){l._learnDeviceTO&&(clearTimeout(l._learnDeviceTO),l._learnDeviceTO=
null);var f=l._learnDeviceCbs;l._learnDeviceCbs=[];for(var q=0;q<f.length;q++){var e=f[q];e&&e(a)}}})}};k.prototype.learnNewDeviceSN=function(a,f){var l=this._learnDeviceCbs.length;f&&-1==this._learnDeviceCbs.indexOf(f)&&this._learnDeviceCbs.push(f);if(0==l){var e=this;this._learnDeviceTO=setTimeout(function(){var a=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var f=0;f<a.length;f++){var q=a[f];q&&q(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,a,function(a){if(a){e._learnDeviceTO&&
(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=null);var f=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var q=0;q<f.length;q++){var l=f[q];l&&l(a)}}})}};k.prototype.learnNewIPDevice=function(a,f,l){var e=this._learnDeviceCbs.length;l&&-1==this._learnDeviceCbs.indexOf(l)&&this._learnDeviceCbs.push(l);if(0==e){var h=this;this._learnDeviceTO=setTimeout(function(){var a=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var f=0;f<a.length;f++){var q=a[f];q&&q(Error("learn device timeout"))}},6E4);a={ADDRESS:a.replace(/-/g,
"").toUpperCase(),KEY_MODE:"LOCAL",KEY:this._convertHmIPKeyBase32ToBase16(f)};this._client.setInstallModeWithWhitelist(!0,60,[a],function(a){if(a){h._learnDeviceTO&&(clearTimeout(h._learnDeviceTO),h._learnDeviceTO=null);var f=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var q=0;q<f.length;q++){var l=f[q];l&&l(a)}}})}};k.prototype.learnNewIPDeviceQR=function(a,f){var l=this._learnDeviceCbs.length;f&&-1==this._learnDeviceCbs.indexOf(f)&&this._learnDeviceCbs.push(f);if(0==l){var e=this;this._learnDeviceTO=
setTimeout(function(){var a=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var f=0;f<a.length;f++){var q=a[f];q&&q(Error("learn device timeout"))}},3E4);var l=a.substr(6,24),h=a.substring(a.length-32,a.length),l={ADDRESS:l.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:h.toUpperCase()};this._client.setInstallModeWithWhitelist(!0,30,[l],function(a){if(a){e._learnDeviceTO&&(clearTimeout(e._learnDeviceTO),e._learnDeviceTO=null);var f=e._learnDeviceCbs;e._learnDeviceCbs=[];for(var q=0;q<f.length;q++){var l=
f[q];l&&l(a)}}})}};k.prototype.deleteDevice=function(a,f){if(a){var l=a.indexOf(":");-1!=l&&(a=a.substr(0,l));this._client.deleteDevice(a,2,f)}else f&&f(Error("address is empty"))};k.prototype.readValue=function(a,f,l){var e=a+"."+f,h=this._readValueCbs[e];h||(h=[],this._readValueCbs[e]=h);var k=h.length;l&&-1==h.indexOf(l)&&h.push(l);if(0==k){var t=this;this._client.getValue(a,f,null,function(l,h){l||t._updateStatusBuffer(a,f,h);var k=t._readValueCbs[e];delete t._readValueCbs[e];k.forEach(function(a){a&&
a(l,h)})})}};k.prototype.writeValue=function(a,f,l,e){var h=this;this._client.setValue(a,f,l,function(k){k||h._updateStatusBuffer(a,f,l.type?l.value:l);e&&e(k)})};k.prototype.getValuesParamset=function(a,f){this._logger.log("trace","getValuesParamset:"+a);var l=this;this._client.getParamset(a,"VALUES",0,function(e,h){if(e)l._logger.log("trace","getValuesParamset error:"+e.message),f&&f(e);else{if(h){var k=0,t=a.indexOf(":");-1!=t&&(k=a.substr(t+1));for(var u in h)h.hasOwnProperty(u)&&(0==k?"INSTALL_MODE"!=
u&&l._updateStatusBuffer(a,u,h[u]):l._updateStatusBuffer(a,u,h[u]))}l._logger.log("trace","getValuesParamset finish:"+JSON.stringify(h));f&&f(null,h)}})};k.prototype.getParamset=function(a,f,l){this._client.getParamset(a,f,0,function(a,f){l&&l(a,f)})};k.prototype.setParamset=function(a,f,l,e){this._client.putParamset(a,f,l,function(a){e&&e(a)})};k.prototype.reportValueUsage=function(a,f,l,e){this._client.reportValueUsage(a,f,l,function(a,f){e&&e(a,f)})};k.prototype.getDevice=function(a){if(!a)return null;
var f=a,l=a.indexOf(":");-1!=l&&(f=a.substr(0,l));if(!this._devices[f])return null;var e=[];a=this._devices[f];e.push(a);if(a.CHILDREN){var h=this;a.CHILDREN.forEach(function(a){a&&h._devices[a]&&e.push(h._devices[a])})}return(a=this._getDeviceStructs(e))?a[f]:null};k.prototype._getDeviceStructs=function(a){if(!a)return null;var f={},l=this;a.forEach(function(a){if(a.ADDRESS&&a.TYPE)if(!a.PARENT&&a.CHILDREN)f[a.ADDRESS]={type:a.TYPE,"interface":l.interface,address:a.ADDRESS,channels:{}};else if(a.PARENT){var q=
f[a.PARENT];q&&(q.channels[a.ADDRESS]={type:a.TYPE,address:a.ADDRESS})}});return f};k.prototype._updateStatusBuffer=function(a,f,l,e){if("CENTRAL"!=a||"PONG"!=f){var h,k,t=!1;"PRESS_SHORT"==f||"PRESS_LONG"==f||"PRESS_CONT"==f||"PRESS_LONG_RELEASE"==f?(h={},k={value:l,time:(new Date).getTime()},t=!0):(t=this._status[a],t||(t={},this._status[a]=t),h=t[f],h||(h={},t[f]=h),k={value:l,time:e?e:(new Date).getTime()},h&&h.time&&k&&k.time&&h.time>k.time?t=!1:(t[f]=k,t=!0));e=this.getDevice(a);t&&this.emit("event",
{device:e,"interface":this.interface,channel:a,datapoint:f,value:k,changed:h.value!=k.value,oldValue:h});h=a.indexOf(":");-1!=h&&(k=a.substr(0,h),"1"==a.substr(h+1)&&"STATE"==f&&0==l&&e&&e.channels&&e.channels[k+":2"]&&"POWERMETER"==e.channels[k+":2"].type&&(this._updateStatusBuffer(k+":2","POWER",0),this._updateStatusBuffer(k+":2","CURRENT",0)))}};k.prototype._initNewDeviceStates=function(a,f){if(this._initStates){var e=this,h=function(a,f){a.ADDRESS&&a.PARAMSETS&&-1!=a.PARAMSETS.indexOf("VALUES")?
e.getValuesParamset(a.ADDRESS,f):f()},k=0,r=function(){k++;k<a.length?h(a[k],r):f&&f()};h(a[k],r)}else f&&f()};k.prototype._convertHmIPKeyBase32ToBase16=function(a){a=a.replace(/-/g,"").toUpperCase();for(var f="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),e=new ArrayBuffer(16),e=new Uint8Array(e),h=0,k=a.length-1,r=0,t=e.length-1,u="";0<=k;){for(var w=0;w<f.length;w++)if(f[w]==a.charAt(k)){h|=w<<r;break}r+=5;for(k--;8<r&&0<=t;)e[t]=h&255,h>>=8,r-=8,t--}for(w=0;w<e.length;w++)16>e[w]&&(u+="0"),u+=e[w].toString(16);
return u.toUpperCase()};k.prototype._xmlrpcCall=function(a,f,e){this._logger.log("trace","receive call:"+a);this._logger.log("trace","params:"+JSON.stringify(f));var h=[],k=0;switch(a){case "newDevices":if(f[1]){this._initNewDeviceStates(f[1],null);for(k=0;k<f[1].length;k++){var r=f[1][k];r&&r.ADDRESS&&(this._devices[r.ADDRESS]=r)}r=this._getDeviceStructs(f[1]);try{this.emit("newDevices",r)}catch(t){}if(!f[1]||!f[1][0]||"HM-RCV-50"!=f[1][0].TYPE)for(f=this._learnDeviceCbs,this._learnDeviceCbs=[],
this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<f.length&&this._client.setInstallMode(!1,null,null,null),k=0;k<f.length;k++)(a=f[k])&&a(null,r)}break;case "readdedDevice":if(f[1]&&f[1][0])for(k=this.getDevice(f[1][0]),r={},r[f[1][0]]=k,f=this._learnDeviceCbs,this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<f.length&&this._client.setInstallMode(!1,null,null,null),k=0;k<f.length;k++)(a=f[k])&&a(null,r);break;
case "listDevices":if(f[1]){k=[];for(r in this._devices)this._devices.hasOwnProperty(r)&&this._devices[r]&&k.push(this._devices[r]);h.push(k)}break;case "deleteDevices":if(f[1])for(k=0;k<f[1].length;k++)if(r=f[1][k])delete this._devices[r],delete this._status[r];break;case "event":this._logger.log("trace","get event:"+JSON.stringify(f)),this._updateStatusBuffer(f[1],f[2],f[3])}e&&e(null,h)};var e=function(a,f,e,h,k,r){x.hub.m.hm._Controller.call(this,a,f,e,h,k,r);this.interface="BidCos-RF";this._logger=
require("x.logger.js").getLogger("x.hub.m.hm.Controller.RF")};e.prototype=new k;e.prototype.constructor=e;e.prototype.listBidcosInterfaces=function(a){this._client.listBidcosInterfaces(function(f,e){a&&a(f,e)})};e.prototype.ping=function(a,f){this._client.ping(a,function(a){f&&f(a)})};var h=function(a,f,e,h,k,r){x.hub.m.hm._Controller.call(this,a,f,e,h,k,r);this.interface="BidCos-Wired";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.Wired")};util.inherits(h,k);var a=function(a,
f,e,h,k,r){x.hub.m.hm._Controller.call(this,a,f,e,h,k,r);this.interface="HmIP-RF";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IP")};util.inherits(a,k);a.prototype.deleteDevice=function(a,f){var e=a.indexOf(":");-1!=e&&(a=a.substr(0,e));this._client.deleteDevice(a,2,f)};var f=function(a,f,e,h,k,r){x.hub.m.hm._Controller.call(this,a,f,e,h,k,r);this.interface="HmIP-Wired";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IPW")};util.inherits(f,k);f.prototype.deleteDevice=
function(a,f){var e=a.indexOf(":");-1!=e&&(a=a.substr(0,e));this._client.deleteDevice(a,2,f)};k.getController=function(q,k,l){var n=null;switch(q){case "BidCos-RF":n=e;break;case "BidCos-Wired":n=h;break;case "HmIP-RF":n=a;break;case "HmIP-Wired":n=f;break;default:return null}return new n(k.ip,k.port,k.username,k.password,l.useHttps,l.initStates)};return k}();
x.hub.m.hm.Monitor=function(){var k=function(a,f,e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.ControllerMonitor");this._type=e;this._monitor=a;this._controller=f;this._xmlrpcServer=null;this._retryWait=1E4;this._retryCount=0;this._retryTO=null;this._state=0;this._err=null};k.prototype.start=function(a,f){0==this._state&&(this._xmlrpcServer=a,this._connect(a));f&&f()};k.prototype.stop=function(a,f){var e=this._state;this._retryTO&&clearTimeout(this._retryTO);this._retryTO=null;
this._state=0;this._err=null;this._retryCount=0;0!=e?this._unregister(a,function(){f&&f()}):f&&f()};k.prototype.getMonitorState=function(){return{state:this._state,error:this._err?this._err.message:null}};k.prototype._connect=function(){this._logger.log("info","start regist "+this._type+" monitor at "+this._controller.getIP()+":"+this._controller.getPort());this._state=1;var a=this;this._register(this._xmlrpcServer,function(f){f?(a._logger.log("warn","regist "+a._type+" monitor at "+a._controller.getIP()+
":"+a._controller.getPort()+" error:"+f.message),a._state=3,a._err=f,a._retryCount++,a._retryTO=setTimeout(function(){a._logger.log("trace","retry timeout for regist "+a._type+" monitor at "+a._controller.getIP()+":"+a._controller.getPort()+" expired");a._connect()},Math.min(6E4,Math.ceil(a._retryCount/10)*a._retryWait))):(a._logger.log("info","regist "+a._type+" monitor at "+a._controller.getIP()+":"+a._controller.getPort()+" success"),a._state=2,a._err=null,a._retryCount=0,a._monitor._onControllerMonitorConnected(a._type))})};
k.prototype._register=function(a,f){var e=this._monitor.localMac.replace(/:/g,""),h="/"+this._monitor.serialNumber,l=a.getPort();this._controller.register("http://"+this._monitor.localIP+":"+(l?l:80)+h,this._monitor.serialNumber+"_"+this._controller.getPort()+"_"+e,f)};k.prototype._unregister=function(a,f){var e="/"+this._monitor.serialNumber,h=a.getPort();this._controller.unregister("http://"+this._monitor.localIP+":"+(h?h:80)+e,f)};var e=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.PinPongHandler");
this._monitor=a;this._pingWait=3E4;this._pingTO=null;this._pingMiss=0};e.prototype.start=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._startPingTO()};e.prototype.stop=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0};e.prototype._startPingTO=function(){var a=this;this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingTO=setTimeout(function(){a._pingMiss++;4>a._pingMiss?(a._ping(),a._startPingTO()):
a._pingFail()},this._pingWait)};e.prototype._ping=function(a){var f=this._monitor._rfController;f?(this._logger.log("trace","send PING"),f.ping(this._monitor.localMac,function(f){a&&a(f)})):a&&a(Error("no rf controller for ping"))};e.prototype._pingFail=function(){this._logger.log("warn","PING Fail");this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._monitor._onPingFail()};e.prototype._onPong=function(){this._pingMiss=0};var h=function(a,f){this.ip=a.ip;this.serialNumber=
a.uuid;this.ccuType=a.type;this.ccuType||(this.ccuType=2);this.localIP=f?f.localIP:null;this.localMac=f?f.localMac:null;this.isChip=f?"chip"==f.localChip:!1;this.isCCU3=f?"ccu3"==f.localChip:!1;this.persistant=f?f.persistant:!1;this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor");var q={ip:this.ip,port:null,username:a.username,password:a.password},h={useHttps:!1,initStates:this.isChip?!0:!1};q.port=this.isCCU3?32001:2001;this._rfController=x.hub.m.hm._Controller.getController("BidCos-RF",
q,h);this._rfController.on("event",this._onEvent.bind(this));this._rfController.on("newDevices",this._onNewDevices.bind(this));q.port=this.isCCU3?32010:2010;this._ipController=x.hub.m.hm._Controller.getController("HmIP-RF",q,h);this._ipController.on("event",this._onEvent.bind(this));this._ipController.on("newDevices",this._onNewDevices.bind(this));q.port=this.isCCU3?32E3:2E3;this._wiredController=x.hub.m.hm._Controller.getController("BidCos-Wired",q,h);this._wiredController.on("event",this._onEvent.bind(this));
this._wiredController.on("newDevices",this._onNewDevices.bind(this));q.port=this.isCCU3?32011:2011;this._hmipWiredController=x.hub.m.hm._Controller.getController("HmIP-Wired",q,h);this._hmipWiredController.on("event",this._onEvent.bind(this));this._hmipWiredController.on("newDevices",this._onNewDevices.bind(this));this._hmipWiredMonitor=this._wiredMonitor=this._ipMonitor=this._rfMonitor=null;this._pingpong=new e(this);this._pingTO=this._manager=this._xmlrpcServer=null;this._pingMiss=0;this._wiredRegisted=
this._ipRegisted=this._rfRegisted=!1;this._reconnectTO=null;this._reconnectCount=0};util.inherits(h,EventEmitter);h.prototype.getMonitorState=function(a){var f={chip:this.isChip};if(this._rfMonitor){var e=this._rfMonitor.getMonitorState();f.bidcos=e}this._ipMonitor&&(e=this._ipMonitor.getMonitorState(),f.hmip=e);this._wiredMonitor&&(e=this._wiredMonitor.getMonitorState(),f.bidcos_wired=e);this._hmipWiredMonitor&&(e=this._hmipWiredMonitor.getMonitorState(),f.hmip_wired=e);f.bidcos&&2==f.bidcos.state?
this._rfController.listBidcosInterfaces(function(e,q){q&&(f.info=q);a&&a(null,f)}):a&&a(null,f)};h.prototype.getAllBufferedStates=function(){var a={},f,e=this._rfController.getAllBufferedStates();if(e)for(f in e)e.hasOwnProperty(f)&&(a[f]=e[f]);if(e=this._wiredController.getAllBufferedStates())for(f in e)e.hasOwnProperty(f)&&(a[f]=e[f]);if(e=this._ipController.getAllBufferedStates())for(f in e)e.hasOwnProperty(f)&&(a[f]=e[f]);if(e=this._hmipWiredController.getAllBufferedStates())for(f in e)e.hasOwnProperty(f)&&
(a[f]=e[f]);return a};h.prototype.getBufferedDevice=function(a,f){var e=null;switch(a){case "BidCos-RF":e=this._rfController;break;case "BidCos-Wired":e=this._wiredController;break;case "HmIP-RF":e=this._ipController;break;case "HmIP-Wired":e=this._hmipWiredController;break;default:return null}return e.getDevice(f)};h.prototype.getState=function(a,f){if(!(a&&a.interface&&a.channel&&a.datapoint))return f&&f(Error("argument invalid")),null;var e=null;switch(a.interface){case "BidCos-RF":e=this._rfController;
break;case "BidCos-Wired":e=this._wiredController;break;case "HmIP-RF":e=this._ipController;break;case "HmIP-Wired":e=this._hmipWiredController;break;default:return null}e.getState(a.channel,a.datapoint,f)};h.prototype.updateState=function(a,f){if(!(a&&a.interface&&a.channel&&a.datapoint))return f&&f(Error("argument invalid")),null;var e=null;switch(a.interface){case "BidCos-RF":e=this._rfController;break;case "BidCos-Wired":e=this._wiredController;break;case "HmIP-RF":e=this._ipController;break;
case "HmIP-Wired":e=this._hmipWiredController;break;default:return null}e.updateState(a.channel,a.datapoint,f)};h.prototype.init=function(a,f){this._logger.log("info","init monitor ("+this.ip+")");this._xmlrpcServer=a;this._init(f)};h.prototype._init=function(a){var f=this;this.getSerialNumber(function(e){e?a&&a(e):f.register(f._xmlrpcServer,function(){a&&a()})})};h.prototype.update=function(a,f,e,h){e&&this.serialNumber!=e&&(this.serialNumber=e);var l=this;a&&this.ip!=a||f&&this.localIP!=f?this.unregister(this._xmlrpcServer,
function(){l.ip=a;l.localIP=f;l.register(l._xmlrpcServer,h)}):h&&h()};h.prototype.finalize=function(a){this.removeAllListeners();this._manager&&this._manager.deleteMonitor(this.ip);this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);this.unregister(this._xmlrpcServer,function(){a&&a()})};h.prototype.getSerialNumber=function(a){var f=this;global&&"CCU3"==global.PLATFORM?(this._rfController.setPort(32001),f.getRFInterfaces(function(e,
h){e?(f._rfController.setPort(2001),f.getRFInterfaces(function(e,q){e?a&&a():(f.serialNumber=q[0].ADDRESS,a&&a(null,f.serialNumber))})):(f._ipController.setPort(32010),f._wiredController.setPort(32E3),f._hmipWiredController.setPort(32011),f.serialNumber=h[0].ADDRESS,a&&a(null,f.serialNumber))})):this.getRFInterfaces(function(e,h){e?a&&a():(f.serialNumber=h[0].ADDRESS,a&&a(null,f.serialNumber))})};h.prototype.getRFInterfaces=function(a){this._rfController.listBidcosInterfaces(function(f,e){a&&a(f,
e)})};h.prototype.register=function(a,f){var e=this;a.registServlet("/"+this.serialNumber,function(a,f,h){e._xmlrpcCall(a,f,h)});this._rfMonitor=new k(this,this._rfController,"rf");this._ipMonitor=new k(this,this._ipController,"ip");this._wiredMonitor=new k(this,this._wiredController,"wired");this._hmipWiredMonitor=new k(this,this._hmipWiredController,"ipwired");this._rfMonitor.start(a);this._ipMonitor.start(a);this.isChip||(this._wiredMonitor.start(a),3==this.ccuType&&this._hmipWiredMonitor.start(a));
f&&f()};h.prototype.unregister=function(a,f){a.unregistServlet("/"+this.serialNumber);this._rfMonitor.stop(a);this._ipMonitor.stop(a);this.isChip||(this._wiredMonitor.stop(a),3==this.ccuType&&this._hmipWiredMonitor.stop(a));f&&f()};h.prototype._onControllerMonitorConnected=function(a){"rf"==a&&this._pingpong.start()};h.prototype._onPingFail=function(){var a=this;this.unregister(this._xmlrpcServer,function(){a.register(a._xmlrpcServer,function(){})})};h.prototype._onPong=function(){this._pingpong._onPong()};
h.prototype.reset=function(a){var f=this;this._rfController.reset(function(){f._ipController.reset(function(){f._wiredController.reset(function(){f._hmipWiredController.reset(function(){a&&a()})})})})};h.prototype.learnRF=function(a){this._rfController.learnNewDevice(function(f,e){a&&a(f,e)})};h.prototype.learnRFSN=function(a,f){this._rfController.learnNewDeviceSN(a,function(a,e){f&&f(a,e)})};h.prototype.learnIP=function(a,f,e){this._ipController.learnNewIPDevice(a,f,function(a,f){e&&e(a,f)})};h.prototype.learnIPQR=
function(a,f){this._ipController.learnNewIPDeviceQR(a,function(a,e){f&&f(a,e)})};h.prototype.deleteDevice=function(a,f,e){if(!a||!f)return e&&e(Error("argument invalid")),null;var h=null;switch(a){case "BidCos-RF":h=this._rfController;break;case "BidCos-Wired":h=this._wiredController;break;case "HmIP-RF":h=this._ipController;break;case "HmIP-Wired":h=this._hmipWiredController;break;default:e&&e(Error("no such interface"));return}h.deleteDevice(f,e)};h.prototype.getDevices=function(a){var f=0;this._rfController&&
f++;this._ipController&&f++;this._wiredController&&f++;this._hmipWiredController&&f++;var e=[],h=function(h){f--;h?a&&a(h):0==f&&a&&a(null,e)},l=this;this._rfController&&this._rfController.getBufferedDevices(function(a,f){a?(h&&h(a),h=null):(e=e.concat(l._parseDevices(f,"BidCos-RF")),h&&h())});this._ipController&&this._ipController.getBufferedDevices(function(a,f){a?(h&&h(a),h=null):(e=e.concat(l._parseDevices(f,"HmIP-RF")),h&&h())});this._wiredController&&this._wiredController.getBufferedDevices(function(a,
f){a?(h&&h(a),h=null):(e=e.concat(l._parseDevices(f,"BidCos-Wired")),h&&h())});this._hmipWiredController&&this._hmipWiredController.getBufferedDevices(function(a,f){a?(h&&h(a),h=null):(e=e.concat(l._parseDevices(f,"HmIP-Wired")),h&&h())})};h.prototype.getParamset=function(a,f,e,h){if(a&&f&&e){var l=null;switch(a){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;case "HmIP-Wired":l=this._hmipWiredController;break;
default:h&&h(Error("unknow interface"));return}l.getParamset(f,e,function(a,f){h&&h(a,f)})}else h&&h(Error("argument invalid"))};h.prototype.setParamset=function(a,f,e,h,l){if(a&&f&&e&&h){var k=null;switch(a){case "BidCos-RF":k=this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;case "HmIP-Wired":k=this._hmipWiredController;break;default:l&&l(Error("unknow interface"));return}k.setParamset(f,e,h,function(a,f){l&&l(a,f)})}else l&&l(Error("argument invalid"))};
h.prototype.readValue=function(a,f,e,h){if(a&&f&&e){var l=null;switch(a){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;case "HmIP-Wired":l=this._hmipWiredController;break;default:h&&h(Error("unknow interface"));return}l.readValue(f,e,function(a,f){h&&h(a,f)})}else h&&h(Error("argument invalid"))};h.prototype.writeValue=function(a,f,e,h,l){if(a&&f&&e){var k=null;switch(a){case "BidCos-RF":k=this._rfController;
break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;case "HmIP-Wired":k=this._hmipWiredController;break;default:l&&l(Error("unknow interface"));return}k.writeValue(f,e,h,function(a){l&&l(a)})}else l&&l(Error("argument invalid"))};h.prototype.reportValueUsage=function(a,f,e,h){if(a&&f&&e){var l=null;switch(a){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;case "HmIP-Wired":l=
this._hmipWiredController;break;default:h&&h(Error("unknow interface"));return}l.reportValueUsage(f,e,1,function(a,f){h&&h(a,f)})}else h&&h(Error("argument invalid"))};h.prototype.updateStatusBuffer=function(a,f,e,h,l){if(a&&f&&e){var k=null;switch(a){case "BidCos-RF":k=this._rfController;break;case "BidCos-Wired":k=this._wiredController;break;case "HmIP-RF":k=this._ipController;break;case "HmIP-Wired":k=this._hmipWiredController;break;default:return}k._updateStatusBuffer(f,e,h,l)}};h.prototype._parseDevices=
function(a,f){f||(f="BidCos-RF");var e=new (require("xnm.aio.hm.js").CCU),h={},l;for(l in a)if(a.hasOwnProperty(l)){var k=a[l],m={typename:"DEVICE",hsstype:k.TYPE,address:k.ADDRESS,interface:f,rfAddr:k.RF_ADDRESS,channels:{}};if(k.CHILDREN)for(var r=0,t=k.CHILDREN.length;r<t;r++){var u=k.CHILDREN[r];m.channels[u]={hsstype:a[u].TYPE,address:u}}h[l]=m}return e._parseDevices(h)};h.prototype._xmlrpcCall=function(a,f,e){this._logger.log("trace","receive call:"+a);this._logger.log("trace","params:"+JSON.stringify(f));
if("event"==a&&"CENTRAL"==f[1]&&"PONG"==f[2])this._onPong(),e&&e(null,[]);else{var h=f[0].split("_");3<=h.length?(h=h[1],-1!=h.indexOf("2001")&&this._rfController?this._rfController._xmlrpcCall(a,f,e):-1!=h.indexOf("2010")&&this._ipController?this._ipController._xmlrpcCall(a,f,e):-1!=h.indexOf("2000")&&this._wiredController?this._wiredController._xmlrpcCall(a,f,e):-1!=h.indexOf("2011")&&this._hmipWiredController?this._hmipWiredController._xmlrpcCall(a,f,e):e&&e(null,[])):e&&e(null,[])}};h.prototype._onNewDevices=
function(a){this._logger.log("debug","find new devices");this._logger.log("debug",JSON.stringify(a));this.emit("new_devices",a)};h.prototype._onEvent=function(a){this._logger.log("trace","receive event:"+JSON.stringify(a));this._logger.log("debug","EVENT:\t"+a.interface+"\t"+a.device.type+"\t"+a.channel+"\t"+a.datapoint+"\t"+a.value.value);a.ip=this.ip;a.serialNumber=this.serialNumber;this.emit("event",a,this)};return h}();
x.hub.m.hm.MonitorManager=function(){var k=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.MonitorManager");this._monitors=[];this._xmlrpcServer=null;this._tmpMonitors={};this._monitorEvtListener=this.onDeviceEvent.bind(this)};k.prototype.init=function(e,h){this._xmlrpcServer=e;h&&h()};k.prototype.startMonitorForIP=function(e,h,a){this.startMonitor({ip:e},{localIP:h},a)};k.prototype.startMonitor=function(e,h,a){if(this._xmlrpcServer)if(e&&e.ip){var f=this.getMonitor(e.ip,e.uuid);
if(f)a&&a();else if(h||(h={}),h.localIP||(h.localIP=x.hub.m.hm._Util.getLocalIP(null,e.ip)),h.localIP){h.localMac||(h.localMac=x.hub.m.hm._Util.getLocalMac(h.localIP));var k=e.ip;this._tmpMonitors[k]||(this._tmpMonitors[k]=[]);var p=this._tmpMonitors[k].length,l=this._tmpMonitors[k];a||(a=function(){});-1==l.indexOf(a)&&l.push(a);if(!(0<p)){var n=this,f=new x.hub.m.hm.Monitor(e,h);f._manager=this;f.init(this._xmlrpcServer,function(a){a||(n._monitors.push(f),f.on("event",n._monitorEvtListener));var e=
n._tmpMonitors[k];delete n._tmpMonitors[k];e.forEach(function(f){f&&f(a)})})}}else a&&a(Error("local ip address invalid"))}else a&&a(Error("gateway invalid"));else a&&a(Error("xml rpc server not started"))};k.prototype.getAllMonitor=function(){return this._monitors};k.prototype.getMonitor=function(e,h){var a=null,f=null;this._monitors.forEach(function(k){k&&k.ip==e&&(a=k);k&&k.serialNumber==h&&(f=k)});return f?f:a};k.prototype.getMonitorStates=function(e){if(0==this._monitors.length)e&&e(null,[]);
else{var h=this,a=0,f=[],k=function(p,l){!p&&l&&(l.ip=h._monitors[a].ip,l.serialNumber=h._monitors[a].serialNumber,f.push(l));a++;a<h._monitors.length?h._monitors[a].getMonitorState(k):e&&e(null,f)};this._monitors[a].getMonitorState(k)}};k.prototype.deleteMonitor=function(e){for(var h=-1,a=0,f=this._monitors.length;a<f;a++){var k=this._monitors[a];if(k&&k.ip==e){h=a;break}}-1!=a&&this._monitors.splice(h,1)};k.prototype.onFindHomeMatic=function(e,h,a){var f=this.getMonitor(null,a),k=this.getMonitor(e);
k?(k.update(e,h,a),f&&f!=k&&(f.finalize(),this.deleteMonitor(f.ip))):(f&&(f.finalize(),this.deleteMonitor(f.ip)),this.startMonitorForIP(e,h))};k.prototype.onDeviceEvent=function(e,h){require("x.hub.m.hm.js").onDeviceEvent(e,h.isChip)};return k}();
x.hub.m.hm._Channel=function(){var k=function(){var a=[];this.map.forEach(function(f){f&&f.dpt&&f.state&&0<f.state.length&&-1==a.indexOf(f.dpt)&&a.push(f.dpt)});return a},e=function(a){var f=null;this.map.forEach(function(e){e&&e.dpt&&e.state&&-1!=e.state.indexOf(a)&&(f=e.dpt)});return f},h=function(a){var f=null;this.map.forEach(function(e){e&&e.dpt&&e.command&&-1!=e.command.indexOf(a)&&(f=e.dpt)});return f};return{"HmIP-RF":{MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},
{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){switch(a){case "UNREACH":return{timeout:f};case "LOW_BAT":return{lowbat:f};case "SABOTAGE":return{sabotage:f}}return null}},MAINTENANCE_BAT_EL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:k,getDptFromState:e,
parseDptState:function(a,f){switch(a){case "UNREACH":return{timeout:f};case "LOW_BAT":return{lowbat:f};case "SABOTAGE":return{sabotage:f}}return null}},MAINTENANCE_BAT_CL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){switch(a){case "UNREACH":return{timeout:f};case "LOW_BAT":return{lowbat:f}}return null}},SWITCH_TRANSMITTER:{map:[{dpt:"STATE",state:["switchTState"],event:["switchTState"]}],
getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "STATE":e=1==f?{switchTState:"on"}:0==f?{switchTState:"false"}:{switchTState:"?"}}return e}},SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"STATE",state:["switchState"],event:["switchState"],command:["on","off","toggle"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "STATE":e=1==f?{switchState:"on"}:0==f?{switchState:"off"}:{switchState:"?"}}return e},executeCommand:function(a,
f,e,k,l){var n=h.call(this,k);"onFor"==k.substr(0,5)&&(n="STATE");if(n)switch(k){case "on":a.writeValue(f,e,n,!0,l);break;case "off":a.writeValue(f,e,n,!1,l);break;case "toggle":a.getState({interface:f,channel:e,datapoint:n},function(h,k){if(h)l&&l(h);else if(k){var p=!0;k.value&&(p=!1);a.writeValue(f,e,n,p,l)}else l&&l(Error("get switch current value return invalid"))});break;default:if("onFor"==k.substr(0,5)){k=parseFloat(k.substr(5));if(isNaN(k)){l&&l(Error("onFor command invalid"));break}n="ON_TIME";
a.writeValue(f,e,n,{type:"double",value:k},function(h){h?l&&l(h):(n="STATE",a.writeValue(f,e,n,!0,l))});break}l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+k))}},ENERGIE_METER_TRANSMITTER:{map:[{dpt:"ENERGY_COUNTER",state:["meterEnergyCounter"],event:["meterEnergyCounter"]},{dpt:"POWER",state:["meterPower"],event:["meterPower"]},{dpt:"CURRENT",state:["meterCurrent"],event:["meterCurrent"]},{dpt:"VOLTAGE",state:["meterVoltage"],event:["meterVoltage"]},{dpt:"FREQUENCY",
state:["meterFrequency"],event:["meterFrequency"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){switch(a){case "ENERGY_COUNTER":return{meterEnergyCounter:parseFloat(f).toFixed(2)};case "POWER":return{meterPower:parseFloat(f).toFixed(2)};case "CURRENT":return{meterCurrent:parseFloat(f).toFixed(2)};case "VOLTAGE":return{meterVoltage:parseFloat(f).toFixed(2)};case "FREQUENCY":return{meterFrequency:parseFloat(f).toFixed(2)}}return null}},DIMMER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["dimmerTLevel"],
event:["dimmerTLevel"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "LEVEL":e={dimmerTLevel:Math.round(100*parseFloat(f))}}return e}},DIMMER_VIRTUAL_RECEIVER:{map:[{dpt:"LEVEL",state:["dimmerLevel"],event:["dimmerLevel"],command:["dimOff","dimUp","dimDown","dimTo","toggleTo"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "LEVEL":e={dimmerLevel:Math.round(100*parseFloat(f))}}return e},executeCommand:function(a,
f,e,k,l){if(k){var n,m;if("dimOff"==k.substr(0,6))n="dimOff";else if("dimUp"==k.substr(0,5))n="dimUp",m=k.substr(5);else if("dimDown"==k.substr(0,7))n="dimDown",m=k.substr(7);else if("dimTo"==k.substr(0,5)){if(n="dimTo",m=k.substr(5),!m){l&&l(Error("dimTo has no value"));return}}else if("toggleTo"==k.substr(0,8)&&(n="toggleTo",m=k.substr(8),!m)){l&&l(Error("toggleTo has no value"));return}var r=h.call(this,n);if(r)switch(n){case "dimOff":a.writeValue(f,e,r,{type:"double",value:0},l);break;case "dimUp":m||
(m=10);m=parseInt(m)/100;a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(m=k.value+m,1<m&&(m=1),a.writeValue(f,e,r,{type:"double",value:m},l))});break;case "dimDown":m||(m=10);m=parseInt(m)/100;a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(m=k.value-m,0>m&&(m=0),a.writeValue(f,e,
r,{type:"double",value:m},l))});break;case "toggleTo":m=parseInt(m)/100;a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):k?(k.value&&(m=0),a.writeValue(f,e,r,{type:"double",value:m},l)):l&&l(Error("get switch current value return invalid"))});break;case "dimTo":m=parseInt(m)/100;a.writeValue(f,e,r,{type:"double",value:m},l);break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+k))}else l&&l(Error("command in null"))}},MOTIONDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_MOTION",
command:["reset"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"MOTION_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "MOTION":e={state:f?"on":"off"};break;case "ILLUMINATION":e={illumination:f};break;case "MOTION_DETECTION_ACTIVE":e={active:f}}return e},executeCommand:function(a,
f,e,k,l){if(k){var n=h.call(this,k);if(n)switch(k){case "reset":a.writeValue(f,e,n,!0,l);break;case "activate":a.writeValue(f,e,n,!0,l);break;case "deactivate":a.writeValue(f,e,n,!1,l);break;case "toggleActivate":a.getState({interface:f,channel:e,datapoint:n},function(h,k){if(h)l&&l(h);else if(k){var p=!0;k.value&&(p=!1);a.writeValue(f,e,n,p,l)}else l&&l(Error("get switch current value return invalid"))});break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+
k))}else l&&l(Error("command in null"))}},KEY_TRANRECEIVER:{map:[{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "PRESS_SHORT":e={pressShort:!0};break;case "PRESS_LONG":e={pressLong:!0}}return e}},ALARM_SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"ACOUSTIC_ALARM_SELECTION",command:["setAudio"]},{dpt:"OPTICAL_ALARM_SELECTION",command:["setVisual"]},{dpt:"DURATION_UNIT",command:["setDuraionUnit"]},
{dpt:"DURATION_VALUE",command:["setDuraion"]},{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "STATE":e=1==f?{state:"on"}:0==f?{state:"off"}:{state:"?"}}return e},executeCommand:function(a,f,e,k,l){if(k){var n=null,m;if("triggerAlarm"==k.substr(0,12)&&(n="triggerAlarm",m=k.substr(12),!m)){l&&l(Error("triggerAlarm format invalid"));return}if(h.call(this,n)||"triggerAlarm"==n)switch(n){case "triggerAlarm":var r=
m.split(",");if(4>r.length){l&&l(Error("triggerAlarm format invalid"));break}a.writeValue(f,e,"ACOUSTIC_ALARM_SELECTION",{type:"double",value:parseInt(r[0])},function(h,k){h?l&&l(h):a.writeValue(f,e,"OPTICAL_ALARM_SELECTION",{type:"double",value:parseInt(r[1])},function(h,k){h?l&&l(h):a.writeValue(f,e,"DURATION_VALUE",{type:"double",value:parseInt(r[2])},function(h,k){h?l&&l(h):a.writeValue(f,e,"DURATION_UNIT",{type:"double",value:parseInt(r[3])},l)})})});break;default:l&&l(Error("no such command"))}else l&&
l(Error("can not find datapoint for command:"+k))}else l&&l(Error("command in null"))}},HEATING_CLIMATECONTROL_TRANSCEIVER:{map:[{dpt:"SET_POINT_TEMPERATURE",command:["tempTo","tempUp","tempDown"],state:["state"],event:["state"]},{dpt:"HUMIDITY",state:["hum"],event:["hum"]},{dpt:"CONTROL_MODE",command:["auto","manu"]},{dpt:"FROST_PROTECTION",state:["frost"],event:["frost"]},{dpt:"SET_POINT_MODE",state:["mode"],event:["mode"]},{dpt:"ACTIVE_PROFILE",command:["setProfile"],state:["profile"],event:["profile"]},
{dpt:"WINDOW_STATE",command:["winOpen","winClose"],state:["window"],event:["window"]},{dpt:"ACTUAL_TEMPERATURE",state:["temp"],event:["temp"]},{dpt:"BOOST_MODE",command:["boostOn","boostOff"],state:["boost"],event:["boost"]},{dpt:"LEVEL",command:["setValve","valveUp","valveDown"],state:["valve"],event:["valve"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e={};switch(a){case "ACTIVE_PROFILE":e.profile=parseInt(f);break;case "ACTUAL_TEMPERATURE":e.temp=parseFloat(f);break;
case "BOOST_MODE":e.boost=f;break;case "FROST_PROTECTION":e.frost=f;break;case "HUMIDITY":e.hum=parseInt(f);break;case "SET_POINT_MODE":0==f?e.mode="auto":1==f&&(e.mode="manu");break;case "SET_POINT_TEMPERATURE":e.state=parseFloat(f);break;case "LEVEL":e.valve=Math.round(100*parseFloat(f));break;case "WINDOW_STATE":switch(f){case 0:e.window="closed";break;case 1:e.window="open"}break;default:return null}return e},executeCommand:function(a,f,e,k,l){if(k){var n=k,m;if("tempTo"==k.substr(0,6)){if(n=
"tempTo",m=k.substr(6),!m){l&&l(Error("tempTo has no value"));return}}else if("tempUp"==k.substr(0,6))n="tempUp",m=k.substr(6);else if("tempDown"==k.substr(0,8))n="tempDown",m=k.substr(8);else if("setProfile"==k.substr(0,10)){if(n="setProfile",m=k.substr(10),!m){l&&l(Error("setProfile has no value"));return}}else if("setValve"==k.substr(0,8)){if(n="setValve",m=k.substr(8),!m){l&&l(Error("setValve has no value"));return}}else"valveUp"==k.substr(0,7)?(n="valveUp",m=k.substr(7)):"valveDown"==k.substr(0,
9)&&(n="valveDown",m=k.substr(9));var r=h.call(this,n);if(r)switch(n){case "tempTo":m=parseFloat(m);if(isNaN(m)){l&&l(Error("tempTo value invalid"));break}30.5<m&&(m=30.5);4.5>m&&(m=4.5);a.writeValue(f,e,r,{type:"double",value:m},l);break;case "tempUp":m||(m=1);m=parseFloat(m);if(isNaN(m)){l&&l(Error("tempUp value invalid"));break}a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(m=k.value+
m,30.5<m&&(m=30.5),a.writeValue(f,e,r,{type:"double",value:m},l))});break;case "tempDown":m||(m=1);m=parseFloat(m);if(isNaN(m)){l&&l(Error("tempDown value invalid"));break}a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(m=k.value-m,4.5>m&&(m=4.5),a.writeValue(f,e,r,{type:"double",value:m},l))});break;case "auto":a.writeValue(f,e,r,{type:"double",value:0},l);break;case "manu":a.writeValue(f,
e,r,{type:"double",value:1},l);break;case "setProfile":m=parseInt(m);if(isNaN(m)){l&&l(Error("setTemp value invalid"));break}a.writeValue(f,e,r,m,l);break;case "winOpen":a.writeValue(f,e,r,1,l);break;case "winClose":a.writeValue(f,e,r,0,l);break;case "boostOn":a.writeValue(f,e,r,!0,l);break;case "boostOff":a.writeValue(f,e,r,!1,l);break;case "setValve":m=parseInt(m);if(isNaN(m)){l&&l(Error("setValve value invalid"));break}m/=100;1<m&&(m=1);0>m&&(m=0);a.writeValue(f,e,r,{type:"double",value:m},l);
break;case "valveUp":m||(m=10);m=parseInt(m);if(isNaN(m)){l&&l(Error("tempUp value invalid"));break}m/=100;a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(m=k.value+m,1<m&&(m=1),a.writeValue(f,e,r,{type:"double",value:m},l))});break;case "valveDown":m||(m=10);m=parseInt(m);if(isNaN(m)){l&&l(Error("tempUp value invalid"));break}m/=100;a.getState({interface:f,channel:e,datapoint:r},function(h,
k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(m=k.value-m,0>m&&(m=0),a.writeValue(f,e,r,{type:"double",value:m},l))});break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+k))}else l&&l(Error("command in null"))}},SHUTTER_CONTACT_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "STATE":e={state:0==
f?"closed":"open"}}return e}},SMOKE_DETECTOR:{map:[{dpt:"SMOKE_DETECTOR_COMMAND",command:"reservedAlarmOff intrusionAlarmOff intrusionAlarmOn smokeTest commTest commTestRepeated".split(" ")},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["state"],event:["state"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["alarmDetail"],event:["alarmDetail"]},{dpt:"SMOKE_DETECTOR_TEST_RESULT",state:["testResult"],event:["testResult"]},{dpt:"ERROR_CODE",state:["error"],event:["error"]}],getReadableDpts:k,getDptFromState:e,
parseDptState:function(a,f){var e=null;switch(a){case "SMOKE_DETECTOR_ALARM_STATUS":e={state:0==f?"ok":"smoke"};e.alarmDetail=f;break;case "SMOKE_DETECTOR_TEST_RESULT":switch(f){case 0:e={testResult:"none"};break;case 1:e={testResult:"smoke_ok"};break;case 2:e={testResult:"smoke_nok"};break;case 3:e={testResult:"comm_sent"};break;case 4:e={testResult:"comm_ok"}}break;case "ERROR_CODE":e={error:f}}return e},executeCommand:function(a,f,e,k,l){if(k){var n=h.call(this,k);if(n){var m;switch(k){case "reservedAlarmOff":case "intrusionAlarmOff":case "intrusionAlarmOn":case "smokeTest":case "commTest":case "commTestRepeated":switch(k){case "reservedAlarmOff":m=
0;break;case "intrusionAlarmOff":m=1;break;case "intrusionAlarmOn":m=2;break;case "smokeTest":m=3;break;case "commTest":m=4;break;case "commTestRepeated":m=5}a.writeValue(f,e,n,m,l);break;default:l&&l(Error("no such command"))}}else l&&l(Error("can not find datapoint for command:"+k))}else l&&l(Error("command in null"))}},ROTARY_HANDLE_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "STATE":switch(f){case 0:e=
{state:"closed"};break;case 1:e={state:"tilted"};break;case 2:e={state:"open"}}}return e}},SHUTTER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTLevel"],event:["blindTLevel"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "LEVEL":e={blindTLevel:Math.round(100*parseFloat(f))}}return e}},SHUTTER_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindLevel"],event:["blindLevel"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]}],
getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "LEVEL":e={blindLevel:Math.round(100*parseFloat(f))}}return e},executeCommand:function(a,f,e,k,l){if(k){var n,m;if("moveUp"==k.substr(0,6))n="moveUp";else if("moveDown"==k.substr(0,8))n="moveDown",m=k.substr(8);else if("stepUp"==k.substr(0,6))n="stepUp",m=k.substr(6);else if("stepDown"==k.substr(0,8))n="stepDown",m=k.substr(8);else if("moveTo"==k.substr(0,6)){if(n="moveTo",m=k.substr(6),!m){l&&l(Error("moveTo has no value"));
return}}else"stop"==k.substr(0,4)&&(n="stop");var r=h.call(this,n);if(r)switch(n){case "moveUp":a.writeValue(f,e,r,{type:"double",value:1},l);break;case "moveDown":a.writeValue(f,e,r,{type:"double",value:0},l);break;case "stop":a.writeValue(f,e,r,!0,l);break;case "stepUp":m||(m=5);m=parseInt(m)/100;a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(m=k.value+m,1<m&&(m=1),a.writeValue(f,e,r,{type:"double",
value:m},l))});break;case "stepDown":m||(m=5);m=parseInt(m)/100;a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(m=k.value-m,0>m&&(m=0),a.writeValue(f,e,r,{type:"double",value:m},l))});break;case "moveTo":m=parseInt(m)/100;a.writeValue(f,e,r,{type:"double",value:m},l);break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+k))}else l&&l(Error("command in null"))}},
BLIND_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTPos"],event:["blindTPos"]},{dpt:"LEVEL_2",state:["lamellaTPos"],event:["lamellaTPos"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "LEVEL":e={blindTPos:Math.round(100*parseFloat(f))};break;case "LEVEL_2":e={lamellaTPos:Math.round(100*parseFloat(f))}}return e}},BLIND_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindPos"],event:["blindPos"],command:["moveUp","moveDown","stepUp",
"stepDown","moveTo"]},{dpt:"LEVEL_2",state:["lamellaPos"],event:["lamellaPos"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "LEVEL":e={blindPos:Math.round(100*parseFloat(f))};break;case "LEVEL_2":e={lamellaPos:Math.round(100*parseFloat(f))}}return e},executeCommand:function(a,f,e,k,l){if(k){var n,m;n=k;if("lamellaStepUp"==k.substr(0,13))n="lamellaStepUp",m=k.substr(13);
else if("lamellaStepDown"==k.substr(0,15))n="lamellaStepDown",m=k.substr(15);else if("lamellaTo"==k.substr(0,9)){if(n="lamellaTo",m=k.substr(9),!m){l&&l(Error("lamellaTo has no value"));return}}else if("stepUp"==k.substr(0,6))n="stepUp",m=k.substr(6);else if("stepDown"==k.substr(0,8))n="stepDown",m=k.substr(8);else if("moveTo"==k.substr(0,6)){if(n="moveTo",m=k.substr(6),!m){l&&l(Error("moveTo has no value"));return}}else"stop"==k.substr(0,4)&&(n="stop");var r=h.call(this,n);if(r)switch(n){case "moveUp":case "lamellaUp":a.writeValue(f,
e,r,{type:"double",value:1},l);break;case "moveDown":case "lamellaDown":a.writeValue(f,e,r,{type:"double",value:0},l);break;case "stop":a.writeValue(f,e,r,!0,l);break;case "stepUp":case "lamellaStepUp":m||(m=5);m=parseInt(m)/100;a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get jalousie current value return invalid")):(m=k.value+m,1<m&&(m=1),a.writeValue(f,e,r,{type:"double",value:m},l))});break;case "stepDown":case "lamellaStepDown":m||
(m=5);m=parseInt(m)/100;a.getState({interface:f,channel:e,datapoint:r},function(h,k){h?l&&l(h):"undefined"==typeof k||null==k?l&&l(Error("get dimmer current value return invalid")):(m=k.value-m,0>m&&(m=0),a.writeValue(f,e,r,{type:"double",value:m},l))});break;case "moveTo":case "lamellaTo":m=parseInt(m)/100;a.writeValue(f,e,r,{type:"double",value:m},l);break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+k))}else l&&l(Error("command in null"))}},PRESENCEDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_PRESENCE",
command:["reset"]},{dpt:"PRESENCE_DETECTION_STATE",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"CURRENT_ILLUMINATION",state:["current_illumination"],event:["current_illumination"]},{dpt:"PRESENCE_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "PRESENCE_DETECTION_STATE":e={state:f?"on":"off"};
break;case "ILLUMINATION":e={illumination:f};break;case "CURRENT_ILLUMINATION":e={current_illumination:f};break;case "PRESENCE_DETECTION_ACTIVE":e={active:f}}return e},executeCommand:function(a,f,e,k,l){if(k){var n=h.call(this,k);if(n)switch(k){case "reset":a.writeValue(f,e,n,!0,l);break;case "activate":a.writeValue(f,e,n,!0,l);break;case "deactivate":a.writeValue(f,e,n,!1,l);break;case "toggleActivate":a.getState({interface:f,channel:e,datapoint:n},function(h,k){if(h)l&&l(h);else if(k){var p=!0;
k.value&&(p=!1);a.writeValue(f,e,n,p,l)}else l&&l(Error("get switch current value return invalid"))});break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+k))}else l&&l(Error("command in null"))}},CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER:{map:[{dpt:"EMERGENCY_OPERATION",state:["cl_fd_emergencyOP"],event:["cl_fd_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fd_frostProtection"],event:["cl_fd_frostProtection"]},{dpt:"STATE",state:["cl_fd_state"],event:["cl_fd_state"]},
{dpt:"HUMIDITY_ALARM",state:["cl_fd_humidityAlarm"],event:["cl_fd_humidityAlarm"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "EMERGENCY_OPERATION":e={cl_fd_emergencyOP:f};break;case "FROST_PROTECTION":e={cl_fd_frostProtection:f};break;case "STATE":e=1==f?{cl_fd_state:"on"}:0==f?{cl_fd_state:"off"}:{cl_fd_state:"?"};break;case "HUMIDITY_ALARM":e={cl_fd_humidityAlarm:f}}return e}},CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_fp_humidityLimiter"],
event:["cl_fp_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_fp_emergencyOP"],event:["cl_fp_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fp_frostProtection"],event:["cl_fp_frostProtection"]},{dpt:"STATE",state:["cl_fp_state"],event:["cl_fp_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_fp_dewPointAlarm"],event:["cl_fp_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_fp_externalClock"],event:["cl_fp_externalClock"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=
null;switch(a){case "HUMIDITY_LIMITER":e={cl_fp_humidityLimiter:f};break;case "EMERGENCY_OPERATION":e={cl_fp_emergencyOP:f};break;case "FROST_PROTECTION":e={cl_fp_frostProtection:f};break;case "STATE":e=1==f?{cl_fp_state:"on"}:0==f?{cl_fp_state:"off"}:{cl_fp_state:"?"};break;case "DEW_POINT_ALARM":e={cl_fp_dewPointAlarm:f};break;case "EXTERNAL_CLOCK":e={cl_fp_externalClock:f}}return e}},CLIMATECONTROL_FLOOR_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_f_humidityLimiter"],event:["cl_f_humidityLimiter"]},
{dpt:"EMERGENCY_OPERATION",state:["cl_f_emergencyOP"],event:["cl_f_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_f_frostProtection"],event:["cl_f_frostProtection"]},{dpt:"STATE",state:["cl_f_state"],event:["cl_f_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_f_dewPointAlarm"],event:["cl_f_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_f_externalClock"],event:["cl_f_externalClock"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "HUMIDITY_LIMITER":e={cl_f_humidityLimiter:f};
break;case "EMERGENCY_OPERATION":e={cl_f_emergencyOP:f};break;case "FROST_PROTECTION":e={cl_f_frostProtection:f};break;case "STATE":e=1==f?{cl_f_state:"on"}:0==f?{cl_f_state:"off"}:{cl_f_state:"?"};break;case "DEW_POINT_ALARM":e={cl_f_dewPointAlarm:f};break;case "EXTERNAL_CLOCK":e={cl_f_externalClock:f}}return e}},WEATHER_TRANSMIT:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["weatherActualTemp"],event:["weatherActualTemp"]},{dpt:"HUMIDITY",state:["weatherHum"],event:["weatherHum"]},{dpt:"ILLUMINATION",
state:["weatherIllu"],event:["weatherIllu"]},{dpt:"SUNSHINEDURATION",state:["weatherSunD"],event:["weatherSunD"]},{dpt:"SUNSHINEDURATION_OVERFLOW",state:["weatherSunDOF"],event:["weatherSunDOF"]},{dpt:"SUNSHINE_THRESHOLD_OVERRUN",state:["weatherSunTOR"],event:["weatherSunTOR"]},{dpt:"WIND_SPEED",state:["weatherWindS"],event:["weatherWindS"]},{dpt:"WIND_THRESHOLD_OVERRUN",state:["weatherWindTOR"],event:["weatherWindTOR"]},{dpt:"WIND_DIR",state:["weatherWindD"],event:["weatherWindD"]},{dpt:"WIND_DIR_RANGE",
state:["weatherWindDR"],event:["weatherWindDR"]},{dpt:"RAINING",state:["weatherRain"],event:["weatherRain"]},{dpt:"RAIN_COUNTER",state:["weatherRainC"],event:["weatherRainC"]},{dpt:"RAIN_COUNTER_OVERFLOW",state:["weatherRainCOF"],event:["weatherRainCOF"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "ACTUAL_TEMPERATURE":e={weatherActualTemp:f};break;case "HUMIDITY":e={weatherHum:f};break;case "ILLUMINATION":e={weatherIllu:f};break;case "SUNSHINEDURATION":e=
{weatherSunD:f};break;case "SUNSHINEDURATION_OVERFLOW":e={weatherSunDOF:f};break;case "SUNSHINE_THRESHOLD_OVERRUN":e={weatherSunTOR:f};break;case "WIND_SPEED":e={weatherWindS:f};break;case "WIND_THRESHOLD_OVERRUN":e={weatherWindTOR:f};break;case "RAINING":e={weatherRain:f};break;case "RAIN_COUNTER":e={weatherRainC:f};break;case "RAIN_COUNTER_OVERFLOW":e={weatherRainCOF:f};break;case "WIND_DIR":e={weatherWindD:f};break;case "WIND_DIR_RANGE":e={weatherWindDR:f}}return e}},CLIMATE_TRANSCEIVER:{map:[{dpt:"ACTUAL_TEMPERATURE",
state:["temperature"],event:["temperature"]},{dpt:"HUMIDITY",state:["humidity"],event:["humidity"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "ACTUAL_TEMPERATURE":e={temperature:f};break;case "HUMIDITY":e={humidity:f}}return e}},PASSAGE_DETECTOR_DIRECTION_TRANSMITTER:{map:[{dpt:"CURRENT_PASSAGE_DIRECTION",state:["current_direction"],event:["current_direction"]},{dpt:"LAST_PASSAGE_DIRECTION",state:["last_direction"],event:["last_direction"]},{dpt:"PASSAGE_COUNTER_OVERFLOW",
state:["passage_counter_overflow"],event:["passage_counter_overflow"]},{dpt:"PASSAGE_COUNTER_VALUE",state:["passage_counter"],event:["passage_counter"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,f){var e=null;switch(a){case "CURRENT_PASSAGE_DIRECTION":e={current_direction:f};break;case "LAST_PASSAGE_DIRECTION":e={last_direction:f};break;case "PASSAGE_COUNTER_OVERFLOW":e={passage_counter_overflow:f};break;case "PASSAGE_COUNTER_VALUE":e={passage_counter:f}}return e}},GENERIC_INPUT_TRANSMITER:{map:[{dpt:"CHANGE_OVER",
state:["genInputChangeOver"],event:["genInputChangeOver"]},{dpt:"EXTERNAL_CLOCK",state:["genInputExtClock"],event:["genInputExtClock"]},{dpt:"HUMIDITY_LIMITER",state:["genInputHumidityLimiter"],event:["genInputHumidityLimiter"]},{dpt:"STATE",state:["genInputState"],event:["genInputState"]},{dpt:"TACTILE_SWITCH",state:["genInputTactileSwitch"],event:["genInputTactileSwitch"]},{dpt:"TEMPERATURE_LIMITER",state:["genInputTempLimiter"],event:["genInputTempLimiter"]}],getReadableDpts:k,getDptFromState:e,
parseDptState:function(a,e){var h=null;switch(a){case "CHANGE_OVER":h={genInputChangeOver:e};break;case "EXTERNAL_CLOCK":h={genInputExtClock:e};break;case "HUMIDITY_LIMITER":h={genInputHumidityLimiter:e};break;case "STATE":h=1==e?{genInputState:"on"}:0==e?{genInputState:"off"}:{genInputState:"?"};break;case "TACTILE_SWITCH":h={genInputTactileSwitch:e};break;case "TEMPERATURE_LIMITER":h={genInputTempLimiter:e}}return h}},ANALOG_OUTPUT_TRANSCEIVER:{map:[{dpt:"LEVEL",state:["outputLevel"],event:["outputLevel"],
command:["outputOff","outputUp","outputDown","outputTo","toggleTo"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){var h=null;switch(a){case "LEVEL":h={outputLevel:Math.round(100*parseFloat(e))}}return h},executeCommand:function(a,e,k,p,l){if(p){var n,m;if("outputOff"==p.substr(0,9))n="outputOff";else if("outputUp"==p.substr(0,8))n="outputUp",m=p.substr(8);else if("outputDown"==p.substr(0,10))n="outputDown",m=p.substr(10);else if("outputTo"==p.substr(0,8)){if(n="outputTo",m=p.substr(8),
!m){l&&l(Error("outputTo has no value"));return}}else if("toggleTo"==p.substr(0,8)){if(n="toggleTo",m=p.substr(8),!m){l&&l(Error("toggleTo has no value"));return}}else isNaN(parseInt(p))||(n="outputTo",m=parseInt(p));var r=h.call(this,n);if(r)switch(n){case "outputOff":a.writeValue(e,k,r,{type:"double",value:0},l);break;case "outputUp":m||(m=10);m=parseInt(m)/100;a.getState({interface:e,channel:k,datapoint:r},function(h,n){h?l&&l(h):"undefined"==typeof n||null==n?l&&l(Error("get dimmer current value return invalid")):
(m=n.value+m,1<m&&(m=1),a.writeValue(e,k,r,{type:"double",value:m},l))});break;case "outputDown":m||(m=10);m=parseInt(m)/100;a.getState({interface:e,channel:k,datapoint:r},function(h,n){h?l&&l(h):"undefined"==typeof n||null==n?l&&l(Error("get dimmer current value return invalid")):(m=n.value-m,0>m&&(m=0),a.writeValue(e,k,r,{type:"double",value:m},l))});break;case "toggleTo":m=parseInt(m)/100;a.getState({interface:e,channel:k,datapoint:r},function(h,n){h?l&&l(h):n?(n.value&&(m=0),a.writeValue(e,k,
r,{type:"double",value:m},l)):l&&l(Error("get switch current value return invalid"))});break;case "outputTo":m=parseInt(m)/100;a.writeValue(e,k,r,{type:"double",value:m},l);break;default:l&&l(Error("no such command"))}else l&&l(Error("can not find datapoint for command:"+p))}else l&&l(Error("command in null"))}},WATER_DETECTION_TRANSMITTER:{map:[{dpt:"ALARMSTATE",state:["alarm"],event:["alarm"]},{dpt:"MOISTURE_DETECTED",state:["moisture"],event:["moisture"]},{dpt:"WATERLEVEL_DETECTED",state:["water"],
event:["water"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){var h=null;switch(a){case "ALARMSTATE":h={alarm:e};break;case "MOISTURE_DETECTED":h={moisture:e};break;case "WATERLEVEL_DETECTED":h={water:e}}return h}}},"BidCos-RF":{MAINTENANCE:{device:"maintenance",map:[{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]},{dpt:"UNREACH",state:["timeout"],event:["timeout"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){switch(a){case "LOWBAT":return{lowbat:e};case "UNREACH":return{timeout:e};
default:return null}}},KEY:{device:"button",map:[{dpt:"PRESS_SHORT",event:["pressShort"],command:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"],command:["pressLong"]},{dpt:"PRESS_LONG_RELEASE",event:["pressLongRel"]},{dpt:"PRESS_CONT",event:["pressCont"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){switch(a){case "PRESS_SHORT":return{pressShort:e};case "PRESS_LONG":return{pressLong:e};case "PRESS_CONT":return{pressCont:e};case "PRESS_LONG_RELEASE":return{pressLongRel:e};
default:return null}},executeCommand:function(a,e,k,p,l){var n=h.call(this,p);switch(p){case "pressShort":a.writeValue(e,k,n,!0,l);break;case "pressLong":a.writeValue(e,k,n,!0,l);break;default:l&&l(Error("no such command"))}}},SWITCH_INTERFACE:{device:"switch_interface",map:[{dpt:"PRESS",event:["press"],command:["press"]}],parseDptState:function(a,e){switch(a){case "PRESS":return{press:!0};default:return null}},executeCommand:function(a,e,k,p,l){var n=h.call(this,p);switch(p){case "press":a.writeValue(e,
k,n,!0,l);break;default:l&&l(Error("no such command"))}}},SHUTTER_CONTACT:{device:"contact",map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){switch(a){case "STATE":return{state:e?"open":"closed"};case "ERROR":return{error:1==e?"sabotage":"no_error"};case "LOWBAT":return{lowbat:e};default:return null}}},JALOUSIE:{device:"jalousie",map:[{dpt:"LEVEL",
state:["jalState"],event:["jalState"],command:["moveUp","moveDown","stepUp","stepDown","%d"]},{dpt:"STOP",command:["stop"]},{dpt:"LEVEL_SLATS",state:["jalLmlState"],event:["jalLmlState"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo%d"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){var h=null;switch(a){case "LEVEL":e=Math.round(100*parseFloat(e));h={jalState:e};break;case "LEVEL_SLATS":e=Math.round(100*parseFloat(e)),h={jalLmlState:e}}return h},
executeCommand:function(a,e,k,p,l){var n=h.call(this,p);switch(p){case "moveUp":a.writeValue(e,k,n,{type:"double",value:1},l);break;case "moveDown":a.writeValue(e,k,n,{type:"double",value:0},l);break;case "stepUp":a.getState({interface:e,channel:k,datapoint:n},function(h,m){if(h)l&&l(h);else if(m){var p=m.value+.05;1<p&&(p=1);a.writeValue(e,k,n,{type:"double",value:p},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,p,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current jalousie state result invalid"))});
break;case "stepDown":a.getState({interface:e,channel:k,datapoint:n},function(h,m){if(h)l&&l(h);else if(m){var p=m.value-.05;0>p&&(p=0);a.writeValue(e,k,n,{type:"double",value:p},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,p,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current blind state result invalid"))});break;case "stop":a.writeValue(e,k,n,!0,l);break;case "lamellaUp":a.writeValue(e,k,n,{type:"double",value:1},l);break;case "lamellaDown":a.writeValue(e,k,n,{type:"double",value:0},
l);break;case "lamellaStepUp":a.getState({interface:e,channel:k,datapoint:n},function(h,m){if(h)l&&l(h);else if(m){var p=m.value+.05;1<p&&(p=1);a.writeValue(e,k,n,{type:"double",value:p},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,p,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current lamella state result invalid"))});break;case "lamellaStepDown":a.getState({interface:e,channel:k,datapoint:n},function(h,m){if(h)l&&l(h);else if(m){var p=m.value-.05;0>p&&(p=0);a.writeValue(e,k,n,{type:"double",
value:p},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,p,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current lamella state result invalid"))});break;default:var m;"lamellaTo"==p.substr(0,9)?(p=p.substr(9),m=parseInt(p),m/=100,n="LEVEL_SLATS",a.writeValue(e,k,n,{type:"double",value:m},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,m,(new Date).getTime()+1E3),l&&l())})):"moveTo"==p.substr(0,6)||p.match(/^[-+]?[0-9]+$/)?("moveTo"==p.substr(0,6)&&(p=p.substr(6)),m=parseInt(p),m/=100,
n="LEVEL",a.writeValue(e,k,n,{type:"double",value:m},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,m,(new Date).getTime()+1E3),l&&l())})):l&&l(Error("no such command"))}}},MOD_EM8BIT_TRANSMITTER:{map:[{dpt:"STATE",state:["state8bit"],event:["state8bit"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){var h=null;switch(a){case "STATE":e=parseInt(e);h={state8bit:e};break;case "LOWBAT":h={lowbat:e}}return h}},KEYMATIC:{device:"keymatic",
map:[{dpt:"STATE",state:["state"],event:["state"],command:["open","close"]},{dpt:"OPEN",command:["openDoor"]},{dpt:"STATE_UNCERTAIN",state:["uncertain"],event:["uncertain"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){switch(a){case "STATE":return{state:e?"open":"closed"};case "STATE_UNCERTAIN":return{uncertain:e};case "ERROR":switch(e){case 0:e="no_error";break;case 1:e="cluth_failure";break;case 2:e="motor_aborted"}return{error:e}}return null},
executeCommand:function(a,e,k,p,l){var n=h.call(this,p);switch(p){case "open":a.writeValue(e,k,n,!0,l);break;case "close":a.writeValue(e,k,n,!1,l);break;case "openDoor":a.writeValue(e,k,n,!0,l);break;default:l&&l(Error("no such command"))}}},MOTION_DETECTOR:{device:"motion",map:[{dpt:"BRIGHTNESS",state:["bri"],event:["bri"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){var h={};switch(a){case "BRIGHTNESS":h.bri=
e;break;case "MOTION":h.state=e?"motion":"ok";break;case "ERROR":h.error=e?"sabotage":"no_error";break;default:return null}return h}},DUAL_WHITE_BRIGHTNESS:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["direction"],event:["direction"]},{dpt:"ERROR_OVERHEAT",state:["error_overheat"],event:["error_overheat"]},{dpt:"ERROR_REDUCED",state:["error_reduced"],event:["error_reduced"]},{dpt:"LEVEL",state:["bri"],event:["bri"],command:["off","dimUp","dimDown","toggle","dimTo%d"]},{dpt:"LEVEL_REAL",state:["bri_real"],
event:["bri_real"]},{dpt:"OLD_LEVEL",command:["on"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){var h={};switch(a){case "DIRECTION":h.direction=e;break;case "ERROR_OVERHEAT":h.error_overheat=e?!0:!1;break;case "ERROR_REDUCED":h.error_reduced=e?!0:!1;break;case "LEVEL":h.bri=Math.round(100*parseFloat(e));break;case "LEVEL_REAL":h.bri_real=Math.round(100*parseFloat(e));break;default:return null}return h},executeCommand:function(a,e,k,p,l){var n=h.call(this,p);switch(p){case "on":a.writeValue(e,
k,n,!0,l);break;case "off":a.writeValue(e,k,n,{type:"double",value:0},l);break;case "dimUp":a.getState({interface:e,channel:k,datapoint:n},function(h,m){if(h)l&&l(h);else if(m){var p=m.value+.05;1<p&&(p=1);a.writeValue(e,k,n,{type:"double",value:p},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,p,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current jalousie state result invalid"))});break;case "dimDown":a.getState({interface:e,channel:k,datapoint:n},function(h,m){if(h)l&&l(h);else if(m){var p=
m.value-.05;0>p&&(p=0);a.writeValue(e,k,n,{type:"double",value:p},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,p,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current blind state result invalid"))});break;case "toggle":n="LEVEL";a.getState({interface:e,channel:k,datapoint:n},function(h,m){h?l&&l(h):m?0!=m.value?a.writeValue(e,k,n,{type:"double",value:0},l):a.writeValue(e,k,"OLD_LEVEL",!0,l):l&&l(Error("get current dimmer state result invalid"))});break;default:var m;"dimTo"==p.substr(0,
5)?(p=p.substr(5),m=parseInt(p),m/=100,n="LEVEL",a.writeValue(e,k,n,{type:"double",value:m},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,m,(new Date).getTime()+1E3),l&&l())})):l&&l(Error("no such command"))}}},DUAL_WHITE_COLOR:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["color_direction"],event:["color_direction"]},{dpt:"LEVEL",state:["color"],event:["color"],command:["colorOff","colorUp","colorDown","colorToggle","colorTo%d"]},{dpt:"LEVEL_REAL",state:["color_real"],event:["color_real"]},
{dpt:"OLD_LEVEL",command:["colorOn"]}],getReadableDpts:k,getDptFromState:e,parseDptState:function(a,e){var h={};switch(a){case "DIRECTION":h.direction=e;break;case "LEVEL":h.color=Math.round(100*parseFloat(e));break;case "LEVEL_REAL":h.color_real=Math.round(100*parseFloat(e));break;default:return null}return h},executeCommand:function(a,e,k,p,l){var n=h.call(this,p);switch(p){case "colorOn":a.writeValue(e,k,n,!0,l);break;case "colorOff":a.writeValue(e,k,n,{type:"double",value:0},l);break;case "colorUp":a.getState({interface:e,
channel:k,datapoint:n},function(h,m){if(h)l&&l(h);else if(m){var p=m.value+.05;1<p&&(p=1);a.writeValue(e,k,n,{type:"double",value:p},function(h){h?l&&l(h):(a.updateStatusBuffer(e,k,n,p,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current jalousie state result invalid"))});break;case "colorDown":a.getState({interface:e,channel:k,datapoint:n},function(h,m){if(h)l&&l(h);else if(m){var p=m.value-.05;0>p&&(p=0);a.writeValue(e,k,n,{type:"double",value:p},function(h){h?l&&l(h):(a.updateStatusBuffer(e,
k,n,p,(new Date).getTime()+1E3),l&&l())})}else l&&l(Error("get current blind state result invalid"))});break;case "colorToggle":n="LEVEL";a.getState({interface:e,channel:k,datapoint:n},function(h,m){h?l&&l(h):m?0!=m.value?a.writeValue(e,k,n,{type:"double",value:0},l):a.writeValue(e,k,"OLD_LEVEL",!0,l):l&&l(Error("get current dimmer state result invalid"))});break;default:var m;"colorTo"==p.substr(0,7)?(p=p.substr(7),m=parseInt(p),m/=100,n="LEVEL",a.writeValue(e,k,n,{type:"double",value:m},function(h){h?
l&&l(h):(a.updateStatusBuffer(e,k,n,m,(new Date).getTime()+1E3),l&&l())})):l&&l(Error("no such command"))}}}}}}();
x.hub.m.hm._Device=function(){var k=function(g,b,c){this.deviceType=g;this.deviceIF=b;this.deviceAdr=c;this.legacyType=null};k.prototype.initStates=function(g,b){var c=this._getReadableDpts();this._initDptStates(g,c,b)};k.prototype._getReadableDpts=function(){return[]};k.prototype._getDptFromRef=function(g){return null};k.prototype._initDptStates=function(g,b,c){if(b&&0!=b.length){var d=0,a=this,e=function(f,h){d++;d==b.length?c&&c():g.readValue(a.deviceIF,b[d].channel,b[d].dpt,e)};g.readValue(this.deviceIF,
b[d].channel,b[d].dpt,e)}else c&&c()};k.prototype.parseDptState=function(g,b,c){return null};k.prototype.toLegacyAdr=function(){return this.deviceType+"."+this.deviceIF+"."+this.deviceAdr};k.prototype.toLegacyType=function(){return this.legacyType};k.prototype.getSerial=function(){var g=this.deviceAdr,b=this.deviceAdr.indexOf(":");-1!=b&&(g=g.substr(0,b));return g};k.prototype.parseChnState=function(g,b){var c={},d;for(d in b){var a=this.parseDptState(g,d,b[d].value);if(a){var e={},f=b[d].time,h;
for(h in a)e[h]={value:a[h],time:f};c=x.hub.m.hm._Util.mergeObj(c,e)}}return c};k.prototype.parseStates=function(g){var b={},c;for(c in g){var d=this.parseChnState(c,g[c]);d&&(b=x.hub.m.hm._Util.mergeObj(b,d))}return b};k.prototype.executeCommand=function(g,b,c){c&&c()};k.prototype.getState=function(g,b,c){var d;switch(b){case "timeout":d={channel:0,dataPoint:"UNREACH"};break;default:d=this._getDptFromRef(b)}if(d){var a=this;g.getState({interface:this.deviceIF,channel:d.channel,datapoint:d.dataPoint},
function(g,e){if(g)c&&c(g);else if(e){var f=a.parseDptState(d.channel,d.dataPoint,e.value);f?c&&c(null,{value:f[b],time:e.time}):c&&c(null,null)}else c&&c(null,null)})}else c&&c(Error("no such state"))};k.prototype.isButton=function(){return!1};var e=function(g,b,c){k.call(this,g,b,c);this.channel=0;this.legacyType="maintenance"};util.inherits(e,k);e.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"].MAINTENANCE.getReadableDpts();c&&c.forEach(function(c){g.push({channel:b.deviceAdr+
":0",dpt:c})});return g};e.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;default:return null}return b};e.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||g!=this.channel)return null;
d={};"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c;return d};var h=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="button"};util.inherits(h,k);h.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};h.prototype._getDptFromRef=function(g){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(g){case "lowbat":b.channel=
0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;default:return null}return b};h.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d={},"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "PRESS_SHORT":return{pressShort:c};
case "PRESS_LONG":return{pressLong:c};case "PRESS_CONT":return{pressCont:c};case "PRESS_LONG_RELEASE":return{pressLongRel:c};default:return null}};h.prototype.isButton=function(){return!0};h.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var d=this;g.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(a,e){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);g.reportValueUsage(d.deviceIF,c,"PRESS_LONG",function(c,d){c&&
console.error("button claim PRESS_LONG event error:"+c.stack);b&&b()})})};var a=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="button"};util.inherits(a,k);a.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};a.prototype._getDptFromRef=function(g){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint=
"LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;default:return null}return b};a.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d={},"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "PRESS_SHORT":return{pressShort:c};case "PRESS_LONG":return{pressLong:c};
case "PRESS_CONT":return{pressCont:c};case "PRESS_LONG_RELEASE":return{pressLongRel:c};default:return null}};a.prototype.isButton=function(){return!1};a.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var d=this;g.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(a,e){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);g.reportValueUsage(d.deviceIF,c,"PRESS_LONG",function(c,d){c&&console.error("button claim PRESS_LONG event error:"+
c.stack);b&&b()})})};var f=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="switch"};util.inherits(f,k);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"}]};f.prototype._getDptFromRef=function(g){var b=this.deviceAdr;-1==b.indexOf(":")&&
this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "inhibit":b.dataPoint="INHIBIT";break;case "working":b.dataPoint="WORKING";break;default:return null}return b};f.prototype.executeCommand=function(g,b,c){var d=this.deviceAdr;-1==d.indexOf(":")&&this.channel&&(d+=":"+this.channel);var a,e=this;switch(b){case "on":a="STATE";
g.writeValue(this.deviceIF,d,a,!0,c);break;case "off":a="STATE";g.writeValue(this.deviceIF,d,a,!1,c);break;case "toggle":a="STATE";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else if(f){var h=!0;f.value&&(h=!1);g.writeValue(e.deviceIF,d,a,h,c)}else c&&c(Error("get switch current value return invalid"))});break;default:if("onFor"==b.substr(0,5)){b=parseFloat(b.substr(5));if(isNaN(b)){c&&c(Error("onFor command invalid"));break}a="ON_TIME";g.writeValue(this.deviceIF,
d,a,{type:"double",value:b},function(b){b?c&&c(b):(a="STATE",g.writeValue(e.deviceIF,d,a,!0,c))});break}c&&c(Error("no such command"))}};f.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d={},"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;var f;switch(b){case "STATE":return 1==
c?f="on":0==c&&(f="off"),{state:f};case "INHIBIT":return{inhibit:c};case "WORKING":return{working:c};default:return null}};f.prototype.getConfig=function(g,b){var c=this.deviceAdr+":"+this.channel;g.getParamset(this.deviceIF,c,"MASTER",function(d,g){if(d)b&&b(d);else{var a={},e=null;g&&(e={AES_ACTIVE:g.AES_ACTIVE});a[c]=e;b&&b(d,a)}})};f.prototype.setConfig=function(g,b,c){if(b){var d=this.deviceAdr+":"+this.channel;if(b=b[d]){var a={};a.AES_ACTIVE=b.AES_ACTIVE;g.setParamset(this.deviceIF,d,"MASTER",
a,function(d){c&&c(d)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};var q=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="dimmer"};util.inherits(q,k);q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"}]};q.prototype._getDptFromRef=function(g){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};
switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="LEVEL";break;case "levelReal":b.dataPoint="LEVEL_REAL";break;case "inhibit":b.dataPoint="INHIBIT";break;case "working":b.dataPoint="WORKING";break;case "direction":b.dataPoint="DIRECTION";break;default:return null}return b};q.prototype.executeCommand=function(g,b,c){var d=this.deviceAdr+":"+this.channel,a,e=this,f=null;switch(b){case "on":a="OLD_LEVEL";g.writeValue(this.deviceIF,d,a,!0,c);break;case "off":a=
"LEVEL";g.writeValue(this.deviceIF,d,a,{type:"double",value:0},c);break;case "dimUp":a="LEVEL";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else if(f){var h=f.value+.05;1<h&&(h=1);g.writeValue(e.deviceIF,d,a,{type:"double",value:h},c)}else c&&c(Error("get current dimmer state result invalid"))});break;case "dimDown":a="LEVEL";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else if(f){var h=f.value-.05;0>h&&(h=0);g.writeValue(e.deviceIF,
d,a,{type:"double",value:h},c)}else c&&c(Error("get current dimmer state result invalid"))});break;case "toggle":a="LEVEL";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){b?c&&c(b):f?0!=f.value?g.writeValue(e.deviceIF,d,a,{type:"double",value:0},c):g.writeValue(e.deviceIF,d,"OLD_LEVEL",!0,c):c&&c(Error("get current dimmer state result invalid"))});break;default:if("toggleTo"==b.substr(0,8)){f=parseInt(b.substr(8));if(isNaN(f)){c&&c(Error("toggleTo command invalid"));break}a=
"LEVEL";f/=100;g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,h){if(b)c&&c(b);else if(h){var k=f;h.value&&(k=0);g.writeValue(e.deviceIF,d,a,{type:"double",value:k},c)}else c&&c(Error("get current dimmer state result invalid"))})}else"onTo"==b.substr(0,4)||b.match(/^[-+]?[0-9]+$/)?("onTo"==b.substr(0,4)&&(b=b.substr(4)),f=parseInt(b),f/=100,a="LEVEL",g.writeValue(this.deviceIF,d,a,{type:"double",value:f},c)):c&&c(Error("no such command"))}};q.prototype.parseDptState=function(g,
b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d={},"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "LEVEL":return b=Math.round(100*parseFloat(c)),{state:b};case "LEVEL_REAL":return b=Math.round(100*parseFloat(c)),{levelReal:b};case "INHIBIT":return{inhibit:c};case "WORKING":return{working:c};case "DIRECTION":return{direction:c};
default:return null}};var p=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="blind"};util.inherits(p,k);p.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"DIRECTION"}]};p.prototype._getDptFromRef=function(g){var b=this.deviceAdr;-1==
b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="LEVEL";break;case "inhibit":b.dataPoint="INHIBIT";break;case "working":b.dataPoint="WORKING";break;case "direction":b.dataPoint="DIRECTION";break;default:return null}return b};p.prototype.executeCommand=function(g,b,c){var d=this.deviceAdr+":"+this.channel,a,e=this,f=0;"stepUpFor"==b.substr(0,9)?((f=b.substr(9))||(f=1),f=parseFloat(f),
b="stepUpFor"):"stepUp"==b.substr(0,6)?((f=b.substr(6))||(f=5),f=parseInt(f)/100,b="stepUp"):"stepDownFor"==b.substr(0,11)?((f=b.substr(11))||(f=1),f=parseFloat(f),b="stepDownFor"):"stepDown"==b.substr(0,8)&&((f=b.substr(8))||(f=5),f=parseInt(f)/100,b="stepDown");switch(b){case "stepUp":a="LEVEL";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,h){if(b)c&&c(b);else if(h){f||(f=.05);var k=h.value+f;1<k&&(k=1);g.writeValue(e.deviceIF,d,a,{type:"double",value:k},function(b){b?c&&
c(b):(g.updateStatusBuffer(e.deviceIF,d,a,k,(new Date).getTime()+1E3),c&&c())})}else c&&c(Error("get current blind state result invalid"))});break;case "stepDown":a="LEVEL";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,h){if(b)c&&c(b);else if(h){f||(f=.05);var k=h.value-f;0>k&&(k=0);g.writeValue(e.deviceIF,d,a,{type:"double",value:k},function(b){b?c&&c(b):(g.updateStatusBuffer(e.deviceIF,d,a,k,(new Date).getTime()+1E3),c&&c())})}else c&&c(Error("get current blind state result invalid"))});
break;case "stepUpFor":a="LEVEL";g.writeValue(this.deviceIF,d,a,{type:"double",value:1},function(b){b?c&&c(b):setTimeout(function(){a="STOP";g.writeValue(e.deviceIF,d,a,!0,c)},1E3*f)});break;case "stepDownFor":a="LEVEL";g.writeValue(this.deviceIF,d,a,{type:"double",value:0},function(b){b?c&&c(b):setTimeout(function(){a="STOP";g.writeValue(e.deviceIF,d,a,!0,c)},1E3*f)});break;case "up":a="LEVEL";g.writeValue(this.deviceIF,d,a,{type:"double",value:1},c);break;case "down":a="LEVEL";g.writeValue(this.deviceIF,
d,a,{type:"double",value:0},c);break;case "stop":a="STOP";g.writeValue(this.deviceIF,d,a,!0,c);break;default:if("moveTo"==b.substr(0,6)||b.match(/^[-+]?[0-9]+$/)){"moveTo"==b.substr(0,6)&&(b=b.substr(6));var h=parseInt(b),h=h/100;a="LEVEL";g.writeValue(this.deviceIF,d,a,{type:"double",value:h},function(b){b?c&&c(b):(g.updateStatusBuffer(e.deviceIF,d,a,h,(new Date).getTime()+1E3),c&&c())})}else c&&c(Error("no such command"))}};p.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;
var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d={},"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "LEVEL":return b=Math.round(100*parseFloat(c)),{state:b};case "INHIBIT":return{inhibit:c};case "WORKING":return{working:c};case "DIRECTION":return{direction:c};default:return null}};p.prototype.getConfig=function(g,b){var c=this.deviceAdr+":"+this.channel;
g.getParamset(this.deviceIF,c,"MASTER",function(d,g){if(d)b&&b(d);else{var a={},e=null;g&&(e={CHANGE_OVER_DELAY:g.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP:g.REFERENCE_RUNNING_TIME_BOTTOM_TOP,REFERENCE_RUNNING_TIME_TOP_BOTTOM:g.REFERENCE_RUNNING_TIME_TOP_BOTTOM,REFERENCE_RUN_COUNTER:g.REFERENCE_RUN_COUNTER});a[c]=e;b&&b(d,a)}})};p.prototype.setConfig=function(g,b,c){if(b){var d=this.deviceAdr+":"+this.channel;if(b=b[d]){var a={};a.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};
a.REFERENCE_RUNNING_TIME_BOTTOM_TOP={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP};a.REFERENCE_RUNNING_TIME_TOP_BOTTOM={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM};a.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;g.setParamset(this.deviceIF,d,"MASTER",a,function(b){c&&c(b)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};var l=function(g,b,c){f.call(this,g,b,c);this.legacyType="powerswitch";this.powChannel=
2};util.inherits(l,f);l.prototype._getReadableDpts=function(){var g=f.prototype._getReadableDpts.call(this);g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"BOOT"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"ENERGY_COUNTER"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"POWER"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"CURRENT"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"VOLTAGE"});g.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"FREQUENCY"});
return g};l.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.channel+=":1";b.dataPoint="STATE";break;case "inhibit":b.channel+=":1";b.dataPoint="INHIBIT";break;case "working":b.channel+=":1";b.dataPoint="WORKING";break;case "boot":b.channel+=":2";b.dataPoint="BOOT";break;case "energy_counter":b.channel+=":2";b.dataPoint="ENERGY_COUNTER";break;case "power":b.channel+=":2";b.dataPoint="POWER";
break;case "current":b.channel+=":2";b.dataPoint="CURRENT";break;case "voltage":b.channel+=":2";b.dataPoint="VOLTAGE";break;case "frequency":b.channel+=":2";b.dataPoint="FREQUENCY";break;default:return null}return b};l.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d),d=g.substr(d+1);return a!=this.deviceAdr?null:0==d?(g={},"UNREACH"==b?g.timeout=c:g["0_"+b.toLowerCase()]=c,g):"1"==d?f.prototype.parseDptState.call(this,g,b,c):"2"==d?(g={},g[b.toLowerCase()]=
c,g):null};l.prototype.getConfig=function(g,b){var c=this,d=null;f.prototype.getConfig.call(this,g,function(a,e){a?b&&b(a):(d=e,c._getCh2Config(g,function(c,g){if(c)b&&b(c);else{for(var a in g)g.hasOwnProperty(a)&&(d[a]=g[a]);b&&b(null,d)}}))})};l.prototype.setConfig=function(g,b,c){if(b){var d=Object.keys(b);if(d&&0!=d.length){var a=this;async.eachSeries(d,function(c,d){var e=c.indexOf(":");-1==e&&d(Error("channel address is null"));e=c.substr(e+1);1==e?f.prototype.setConfig.call(a,g,b,d):2==e?a._setCh2Config(g,
b[c],d):d(Error("unknow channel:"+e))},function(b){c&&c(b)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};l.prototype._getCh2Config=function(g,b){var c=this.deviceAdr+":2";g.getParamset(this.deviceIF,c,"MASTER",function(d,g){if(d)b&&b(d);else{var a={},e=null;g&&(e={AES_ACTIVE:g.AES_ACTIVE});a[c]=e;b&&b(d,a)}})};l.prototype._setCh2Config=function(g,b,c){if(b){var d=this.deviceAdr+":2",a={};a.AES_ACTIVE=b.AES_ACTIVE;g.setParamset(this.deviceIF,d,"MASTER",a,function(b){c&&
c(b)})}else c&&c(Error("config data invalid"))};var n=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="weather"};util.inherits(n,k);n.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"}]};n.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "temp":b.dataPoint="TEMPERATURE";break;case "hum":b.dataPoint="HUMIDITY";break;default:return null}return b};n.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d=
{},"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "TEMPERATURE":return b=parseFloat(c),{temp:b};case "HUMIDITY":return b=parseInt(c),{hum:b};default:return null}};var m=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="weather2"};util.inherits(m,n);m.prototype._getReadableDpts=function(){var g=n.prototype._getReadableDpts.call(this);g.push({channel:this.deviceAdr+":"+this.channel,dpt:"AIR_PRESSURE"});return g};m.prototype._getDptFromRef=
function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "air":b.dataPoint="AIR_PRESSURE";break;default:return n.prototype._getDptFromRef.call(this,g)}return b};m.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d),e=g.substr(d+1),f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(a!=f||0!=e&&e!=this.channel)return null;if(0==e)return g={},"UNREACH"==b?g.timeout=c:"LOWBAT"==b?g.lowbat=
c:g["0_"+b.toLowerCase()]=c,g;g=n.prototype.parseDptState.call(this,g,b,c);switch(b){case "AIR_PRESSURE":g||(g={}),g.air=parseInt(c)}return g};var r=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="weatherstation"};util.inherits(r,k);r.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"},
{channel:this.deviceAdr+":"+this.channel,dpt:"RAINING"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAIN_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_SPEED"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION_RANGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"SUNSHINEDURATION"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"}]};r.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+
":"+this.channel,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "temp":b.dataPoint="TEMPERATURE";break;case "hum":b.dataPoint="HUMIDITY";break;case "rain":b.dataPoint="RAINING";break;case "rainC":b.dataPoint="RAIN_COUNTER";break;case "windS":b.dataPoint="WIND_SPEED";break;case "windD":b.dataPoint="WIND_DIRECTION";break;case "windDR":b.dataPoint="WIND_DIRECTION_RANGE";break;case "sunD":b.dataPoint="SUNSHINEDURATION";
break;case "bri":b.dataPoint="BRIGHTNESS";break;default:return null}return b};r.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "TEMPERATURE":d.temp=parseFloat(c);break;case "HUMIDITY":d.hum=
parseInt(c);break;case "RAINING":d.rain=c;break;case "RAIN_COUNTER":d.rainC=parseFloat(c);break;case "WIND_SPEED":d.windS=parseFloat(c);break;case "WIND_DIRECTION":d.windD=c;break;case "WIND_DIRECTION_RANGE":d.windDR=c;break;case "SUNSHINEDURATION":d.sunD=c;break;case "BRIGHTNESS":d.bri=c;break;default:return null}return d};var t=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="heater"};util.inherits(t,k);t.prototype._getReadableDpts=function(){var g=[];g.push({channel:this.deviceAdr+
":0",dpt:"UNREACH"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"VALVE_STATE"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"});return g};t.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "error":b.dataPoint="ERROR";break;case "state":b.dataPoint="VALVE_STATE";break;default:return null}return b};t.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");
if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;if(g==this.channel){switch(b){case "ERROR":switch(c){case 0:d.error="no_error";break;case 1:d.error="VALVE_DRIVE_BLOCKED";break;case 2:d.error="VALVE_DRIVE_LOOSE";break;case 3:d.error="ADJUSTING_RANGE_TO_SMALL";break;case 4:d.error="lowbat"}break;case "VALVE_STATE":d.state=
c}return d}return null};var u=function(g,b,c){k.call(this,g,b,c);this.channel=4;this.legacyType="thermostat"};util.inherits(u,k);u.prototype._getReadableDpts=function(){var g=[];g.push({channel:this.deviceAdr+":"+this.channel,dpt:"CONTROL_MODE"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"FAULT_REPORTING"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"BATTERY_STATE"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"BOOST_STATE"});g.push({channel:this.deviceAdr+":"+this.channel,
dpt:"ACTUAL_TEMPERATURE"});g.push({channel:this.deviceAdr+":"+this.channel,dpt:"SET_TEMPERATURE"});return g};u.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "mode":b.dataPoint="CONTROL_MODE";break;case "error":b.dataPoint="FAULT_REPORTING";break;case "batLvl":b.dataPoint="BATTERY_STATE";break;case "valveLvl":b.dataPoint="VALVE_STATE";break;case "boostTime":b.dataPoint="BOOST_STATE";break;case "act_temp":b.dataPoint="ACTUAL_TEMPERATURE";
break;case "state":b.dataPoint="SET_TEMPERATURE";break;default:return null}return b};u.prototype.executeCommand=function(g,b,c){var d=this.deviceAdr+":"+this.channel,a,e=this;switch(b){case "setAuto":a="AUTO_MODE";g.writeValue(this.deviceIF,d,a,!0,function(b){b||g.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",0);c&&c(b)});break;case "setManu":a="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){b?c&&c(b):(a="MANU_MODE",g.writeValue(e.deviceIF,d,a,{type:"double",
value:f.value},function(b){b||g.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",1);c&&c(b)}))});break;case "setBoost":a="BOOST_MODE";g.writeValue(this.deviceIF,d,a,!0,function(b){b||g.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",3);c&&c(b)});break;case "tempUp":a="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else if(f){var h=f.value+.5;30.5<h&&(h=30.5);g.writeValue(e.deviceIF,d,a,{type:"double",value:h},c)}else c&&c(Error("get current temp state result invalid"))});
break;case "tempDown":a="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else if(f){var h=f.value-.5;4.5>h&&(h=4.5);g.writeValue(e.deviceIF,d,a,{type:"double",value:h},c)}else c&&c(Error("get current temp state result invalid"))});break;default:"tempTo"==b.substr(0,6)||b.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==b.substr(0,6)&&(b=b.substr(6)),b=parseFloat(b),a="SET_TEMPERATURE",g.writeValue(this.deviceIF,d,a,{type:"double",value:b},c)):c&&c(Error("no such command"))}};
u.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d={};if(0==g)return d["0_"+b.toLowerCase()]=c,d;if(g==this.channel){switch(b){case "CONTROL_MODE":switch(c){case 0:d.mode="auto";break;case 1:d.mode="manu";break;case 2:d.mode="party";break;case 3:d.mode="boost"}break;case "FAULT_REPORTING":switch(c){case 0:d.error="no_error";
break;case 1:d.error="valve_tight";break;case 2:d.error="ADJUSTING_RANGE_TOO_LARGE";break;case 3:d.error="ADJUSTING_RANGE_TOO_SMALL";break;case 4:d.error="comm_error";break;case 5:d.error="";break;case 6:d.error="lowbat";break;case 7:d.error="VALVE_ERROR_POSITION"}break;case "BATTERY_STATE":d.batLvl=c;break;case "VALVE_STATE":d.valveLvl=c;break;case "BOOST_STATE":d.boostTime=c;break;case "ACTUAL_TEMPERATURE":d.act_temp=c;break;case "SET_TEMPERATURE":d.state=c;break;default:return null}return d}return null};
var w=function(g,b,c){k.call(this,g,b,c);this.channel=4;this.legacyType="thermostat"};util.inherits(w,u);w.prototype._getReadableDpts=function(){var g=u.prototype._getReadableDpts.callback(this);g.push({channel:this.deviceAdr+":"+this.channel,dpt:"WINDOW_STATE"});return g};w.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "window":b.dataPoint="WINDOW_STATE";break;default:return u.prototype._getDptFromRef.call(this,g)}return b};w.prototype.parseDptState=
function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d),e=g.substr(d+1),f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(a!=f)return null;d={};if(0==e)return d["0_"+b.toLowerCase()]=c,d;if(e==this.channel)switch(b){case "WINDOW_STATE":return d.window=c?"closed":"open",d;default:return u.prototype.parseDptState.call(this,g,b,c)}else return null};var M=function(g,b,c){k.call(this,g,b,c);this.weatherChannel=1;this.thermoChannel=2;this.legacyType=
"wallthermo"};util.inherits(M,k);M.prototype._getReadableDpts=function(){var g=[];g.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});g.push({channel:this.deviceAdr+":0",dpt:"LOWBAT"});g.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"TEMPERATURE"});g.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"HUMIDITY"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SETPOINT"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_COMMAND"});g.push({channel:this.deviceAdr+
":"+this.thermoChannel,dpt:"ADJUSTING_DATA"});return g};M.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(g){case "timeout":c.channel=b+":0";c.dataPoint="UNREACH";break;case "lowbat":c.channel=b+":0";c.dataPoint="LOWBAT";break;case "temp":c.channel=b+":1";c.dataPoint="TEMPERATURE";break;case "hum":c.channel=b+":1";c.dataPoint="HUMIDITY";break;case "state":c.channel=b+":2";c.dataPoint="SETPOINT";break;case "adjusting_command":c.channel=b+":2";c.dataPoint=
"ADJUSTING_COMMAND";break;case "adjusting_data":c.channel=b+":2";c.dataPoint="ADJUSTING_DATA";break;default:return null}return c};M.prototype.executeCommand=function(g,b,c){var d=this.deviceAdr+":"+this.thermoChannel,a;switch(b){case "tempUp":a="SETPOINT";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,e){if(b)c&&c(b);else if(e){var f=e.value+.5;30<f&&(f=30);g.writeValue(self.deviceIF,d,a,{type:"double",value:f},c)}else c&&c(Error("get current temp state result invalid"))});
break;case "tempDown":a="SETPOINT";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,e){if(b)c&&c(b);else if(e){var f=e.value-.5;6>f&&(f=6);g.writeValue(self.deviceIF,d,a,{type:"double",value:f},c)}else c&&c(Error("get current temp state result invalid"))});break;default:"tempTo"==b.substr(0,6)||b.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==b.substr(0,6)&&(b=b.substr(6)),b=parseFloat(b),a="SETPOINT",g.writeValue(this.deviceIF,d,a,{type:"double",value:b},c)):c&&c(Error("no such command"))}};
M.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);if(a!=this.deviceAdr)return null;a={};if(0==g)return"UNREACH"==b?a.timeout=c:"LOWBAT"==b?a.lowbat=c:a["0_"+b.toLowerCase()]=c,a;if("1"==g){switch(b){case "TEMPERATURE":a.temp=c;break;case "HUMIDITY":a.hum=c}return a}if("2"==g){switch(b){case "SETPOINT":a.state=c;break;case "ADJUSTING_COMMAND":a.adjusting_command=c;break;case "ADJUSTING_DATA":a.adjusting_data=c}return a}return null};
var N=function(g,b,c){k.call(this,g,b,c);this.thermoChannel=2;this.legacyType="wallthermostat"};util.inherits(N,k);N.prototype._getReadableDpts=function(){var g=[];g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"CONTROL_MODE"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"LOWBAT_REPORTING"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"COMMUNICATION_REPORTING"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"WINDOW_OPEN_REPORTING"});g.push({channel:this.deviceAdr+
":"+this.thermoChannel,dpt:"BATTERY_STATE"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BOOST_STATE"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_TEMPERATURE"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_HUMIDITY"});g.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SET_TEMPERATURE"});return g};N.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.thermoChannel,dataPoint:null};switch(g){case "mode":b.dataPoint=
"CONTROL_MODE";break;case "lowbat":b.dataPoint="LOWBAT_REPORTING";break;case "comm":b.dataPoint="COMMUNICATION_REPORTING";break;case "window":b.dataPoint="WINDOW_OPEN_REPORTING";break;case "batLvl":b.dataPoint="BATTERY_STATE";break;case "boostTime":b.dataPoint="BOOST_STATE";break;case "temp":b.dataPoint="ACTUAL_TEMPERATURE";break;case "hum":b.dataPoint="ACTUAL_HUMIDITY";break;case "state":b.dataPoint="SET_TEMPERATURE";break;default:return null}return b};N.prototype.executeCommand=function(g,b,c){var d=
this.deviceAdr+":"+this.thermoChannel,a,e=this;switch(b){case "setAuto":a="AUTO_MODE";g.writeValue(this.deviceIF,d,a,!0,function(b){b||g.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",0);c&&c(b)});break;case "setManu":a="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){b?c&&c(b):(a="MANU_MODE",g.writeValue(e.deviceIF,d,a,{type:"double",value:f.value},function(b){b||g.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",1);c&&c(b)}))});break;case "setBoost":a="BOOST_MODE";
g.writeValue(this.deviceIF,d,a,!0,function(b){b||g.updateStatusBuffer(e.deviceIF,d,"CONTROL_MODE",3);c&&c(b)});break;case "tempUp":a="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else if(f){var h=f.value+.5;30.5<h&&(h=30.5);g.writeValue(e.deviceIF,d,a,{type:"double",value:h},c)}else c&&c(Error("get current temp state result invalid"))});break;case "tempDown":a="SET_TEMPERATURE";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,
f){if(b)c&&c(b);else if(f){var h=f.value-.5;4.5>h&&(h=4.5);g.writeValue(e.deviceIF,d,a,{type:"double",value:h},c)}else c&&c(Error("get current temp state result invalid"))});break;default:"tempTo"==b.substr(0,6)||b.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==b.substr(0,6)&&(b=b.substr(6)),b=parseFloat(b),a="SET_TEMPERATURE",g.writeValue(this.deviceIF,d,a,{type:"double",value:b},c)):"setWeekProfile"==b.substr(0,14)?(b=parseInt(b.substr(14)),--b,g.setParamset(this.deviceIF,this.deviceAdr,"MASTER",{WEEK_PROGRAM_POINTER:b},
function(b){c&&c(b)})):c&&c(Error("no such command"))}};N.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);if(a!=this.deviceAdr)return null;a={};if(0==g)return a["0_"+b.toLowerCase()]=c,a;if("2"==g){switch(b){case "CONTROL_MODE":switch(c){case 0:a.mode="auto";break;case 1:a.mode="manu";break;case 2:a.mode="party";break;case 3:a.mode="boost"}break;case "LOWBAT_REPORTING":a.lowbat=c;break;case "COMMUNICATION_REPORTING":a.comm=c;break;
case "WINDOW_OPEN_REPORTING":a.window=c;break;case "BATTERY_STATE":a.batLvl=c;break;case "BOOST_STATE":a.boostTime=c;break;case "ACTUAL_TEMPERATURE":a.temp=c;break;case "ACTUAL_HUMIDITY":a.hum=c;break;case "SET_TEMPERATURE":a.state=c}return a}return null};var ha=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="contact"};util.inherits(ha,k);ha.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},
{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};ha.prototype._getDptFromRef=function(g){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "error":b.dataPoint="ERROR";break;case "lowbat":b.dataPoint="LOWBAT";break;default:return null}return b};ha.prototype.parseDptState=function(g,
b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d={},"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "STATE":return{state:c?"open":"closed"};case "ERROR":return{error:1==c?"sabotage":"no_error"};case "LOWBAT":return{lowbat:c};default:return null}};var O=function(g,b,c){k.call(this,g,b,c);this.rainChannel=
1;this.heatChannel=2;this.legacyType="rain"};util.inherits(O,k);O.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.rainChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"WORKING"}]};O.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(g){case "timeout":c.channel=
0;c.dataPoint="UNREACH";break;case "rain":c.channel=b+":"+this.rainChannel;c.dataPoint="STATE";break;case "heat":c.channel=b+":"+this.heatChannel;c.dataPoint="STATE";break;case "inhibit":c.channel=b+":"+this.heatChannel;c.dataPoint="INHIBIT";break;case "working":c.channel=b+":"+this.heatChannel;c.dataPoint="WORKING";break;default:return null}return c};O.prototype.executeCommand=function(g,b,c){var d=this.deviceAdr;-1==d.indexOf(":")&&this.heatChannel&&(d+=":"+this.heatChannel);var a,e=this;switch(b){case "heaterOn":a=
"STATE";g.writeValue(this.deviceIF,d,a,!0,c);break;case "heaterOff":a="STATE";g.writeValue(this.deviceIF,d,a,!1,c);break;case "heaterToggle":a="STATE";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else if(f){var h=!0;f.value&&(h=!1);g.writeValue(e.deviceIF,d,a,h,c)}else c&&c(Error("get switch current value return invalid"))});break;default:c&&c(Error("no such command"))}};O.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=
g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;if(1==g){switch(b){case "STATE":d.rain=1==c?"rain":"dry";break;default:return null}return d}if(2==g){switch(b){case "STATE":d.heat=c?"on":"off";break;case "INHIBIT":d.inhibit=c;break;case "WORKING":d.working=c;break;default:return null}return d}};var z=function(g,b,c){k.call(this,g,b,c);this.ledChannel=
1;this.chimeChannel=2;this.legacyType="gong2"};util.inherits(z,k);z.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"WORKING"}]};
z.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(g){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "led":c.channel=b+":"+this.ledChannel;c.dataPoint="STATE";break;case "led_inhibit":c.channel=b+":"+this.ledChannel;c.dataPoint="INHIBIT";break;case "led_working":c.channel=b+":"+this.ledChannel;c.dataPoint="WORKING";break;case "chime":c.channel=b+":"+this.chimeChannel;c.dataPoint="STATE";break;case "chime_inhibit":c.channel=b+":"+this.chimeChannel;
c.dataPoint="INHIBIT";break;case "chime_working":c.channel=b+":"+this.chimeChannel;c.dataPoint="WORKING";break;default:return null}return c};z.prototype.executeCommand=function(g,b,c){switch(b){case "ledOn":b=this.deviceAdr+":"+this.ledChannel;g.writeValue(this.deviceIF,b,"STATE",!0,c);break;case "ledOff":b=this.deviceAdr+":"+this.ledChannel;g.writeValue(this.deviceIF,b,"STATE",!1,c);break;case "chimeOn":b=this.deviceAdr+":"+this.chimeChannel;g.writeValue(this.deviceIF,b,"STATE",!0,c);break;case "chimeOff":b=
this.deviceAdr+":"+this.chimeChannel;g.writeValue(this.deviceIF,b,"STATE",!1,c);break;default:c&&c(Error("no such command"))}};z.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;if(1==g){switch(b){case "STATE":d.led=c?"on":"off";break;case "INHIBIT":d.led_inhibit=
c;break;case "WORKING":d.led_working=c;break;default:return null}return d}if(2==g){switch(b){case "STATE":d.chime=c?"on":"off";break;case "INHIBIT":d.chime_inhibit=c;break;case "WORKING":d.chime_working=c;break;default:return null}return d}};var Ea=function(g,b,c){k.call(this,g,b,c);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong"};util.inherits(Ea,z);Ea.prototype.executeCommand=function(g,b,c){var d;0==b.indexOf("vChannel")?(d=b.substr(8),d=parseInt(d),b=this.deviceAdr+":"+this.chimeChannel,
g.writeValue(this.deviceIF,b,"SUBMIT","0.8,1,5,"+d,c)):0==b.indexOf("ledGreen")?((d=b.substr(8))||(d=10),b=this.deviceAdr+":"+this.ledChannel,g.writeValue(this.deviceIF,b,"SUBMIT","1,10,"+d+",34",c)):0==b.indexOf("ledRed")?((d=b.substr(6))||(d=10),b=this.deviceAdr+":"+this.ledChannel,g.writeValue(this.deviceIF,b,"SUBMIT","1,10,"+d+",18",c)):z.prototype.executeCommand.call(this,g,b,c)};var ia=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="window"};util.inherits(ia,k);ia.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};ia.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "error":b.dataPoint="ERROR";break;case "lowbat":b.dataPoint="LOWBAT";
break;default:return null}return b};ia.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "STATE":switch(c){case 0:d.state="closed";break;case 1:d.state="tilted";break;case 2:d.state="open"}break;case "ERROR":switch(c){case 0:d.error="no_error";
break;case 1:case 7:d.error="sabotage"}break;case "LOWBAT":d.lowbat=c;break;default:return null}return d};var ja=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="temp"};util.inherits(ja,k);ja.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"}]};ja.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "temp":b.dataPoint="TEMPERATURE";break;default:return null}return b};ja.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d={},"UNREACH"==b?d.timeout=c:"LOWBAT"==b?
d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "TEMPERATURE":return{temp:parseFloat(c)};default:return null}};var ka=function(g,b,c){k.call(this,g,b,c);this.temp1=1;this.temp2=2;this.tempDiff12=3;this.tempDiff21=4;this.legacyType="temp2"};util.inherits(ka,k);ka.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.temp1,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.temp1,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.temp2,
dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff12,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff21,dpt:"TEMPERATURE"}]};ka.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "lowbat":b.channel=this.temp1;b.dataPoint="LOWBAT";break;case "temp1":b.channel=this.temp1;b.dataPoint="TEMPERATURE";break;case "temp2":b.channel=this.temp2;b.dataPoint="TEMPERATURE";
break;case "tempDiff12":b.channel=this.tempDiff12;b.dataPoint="TEMPERATURE";break;case "tempDiff21":b.channel=this.tempDiff21;b.dataPoint="TEMPERATURE";break;default:return null}return b};ka.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "LOWBAT":return{lowbat:c};
case "TEMPERATURE":return 1==g?{temp1:parseFloat(c)}:2==g?{temp2:parseFloat(c)}:3==g?{tempDiff12:parseFloat(c)}:4==g?{tempDiff21:parseFloat(c)}:null;default:return null}};var la=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="co2"};util.inherits(la,k);la.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};la.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,
dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;default:return null}return b};la.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "STATE":switch(c){case 0:d.state=
"normal";break;case 1:d.state="medium";break;case 2:d.state="high"}break;default:return null}return d};var ma=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="motion"};util.inherits(ma,k);ma.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"},{channel:this.deviceAdr+":"+this.channel,dpt:"MOTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};
ma.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "bri":b.dataPoint="BRIGHTNESS";break;case "state":b.dataPoint="MOTION";break;case "error":b.dataPoint="ERROR";break;default:return null}return b};ma.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,
d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "BRIGHTNESS":d.bri=c;break;case "MOTION":d.state=c?"motion":"ok";break;case "ERROR":d.error=c?"sabotage":"no_error";break;default:return null}return d};var na=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="smoke"};util.inherits(na,k);na.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};na.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;default:return null}return b};na.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");
if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "STATE":d.state=c?"smoke":"ok";break;default:return null}return d};var P=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="siren"};util.inherits(P,k);P.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_BATTERY"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};P.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+
this.channel,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "error_power":b.dataPoint="ERROR_POWER";break;case "error_sabotage":b.dataPoint="ERROR_SABOTAGE";break;case "error_battery":b.dataPoint="ERROR_BATTERY";break;case "inhibit":b.dataPoint="INHIBIT";break;case "working":b.dataPoint="WORKING";break;default:return null}return b};P.prototype.executeCommand=function(g,b,c){var d=this.deviceAdr+":"+this.channel,a,e=this;
switch(b){case "on":a="STATE";g.writeValue(this.deviceIF,d,a,!0,c);break;case "off":a="STATE";g.writeValue(this.deviceIF,d,a,!1,c);break;case "toggle":a="STATE";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else{var h=!0;f.value&&(h=!1);g.writeValue(e.deviceIF,d,a,h,c)}});break;default:c&&c(Error("no such command"))}};P.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,
d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "STATE":d.state=c?"on":"off";break;case "ERROR_POWER":d.error_power=c?"power_failure":"no_error";break;case "ERROR_SABOTAGE":d.error_sabotage=c?"sabotage":"no_error";break;case "ERROR_BATTERY":d.error_battery=c?"battery_defect":"no_error";break;case "INHIBIT":d.inhibit=c;break;case "WORKING":d.working=
c;break;default:return null}return d};var oa=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="capacity"};util.inherits(oa,k);oa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"FILLING_LEVEL"}]};oa.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";
break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="FILLING_LEVEL";break;default:return null}return b};oa.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "FILLING_LEVEL":d.state=
c;break;default:return null}return d};var J=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="switch_interface"};util.inherits(J,k);J.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};J.prototype._getDptFromRef=function(g){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=
0;b.dataPoint="UNREACH";break;default:return null}return b};J.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d={},"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "PRESS":return{press:c};default:return null}};J.prototype.isButton=function(){return!0};
J.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);g.reportValueUsage(this.deviceIF,c,"PRESS",function(c,g){c&&console.error("switch interface claim PRESS event error:"+c.stack);b&&b()})};var pa=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="tilt"};util.inherits(pa,k);pa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+
":"+this.channel,dpt:"LOWBAT"}]};pa.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "lowbat":b.dataPoint="LOWBAT";break;default:return null}return b};pa.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,
d));if(a!=e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "STATE":d.state=c?"closed":"open";break;case "LOWBAT":d.lowbat=c;break;default:return null}return d};var qa=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="water"};util.inherits(qa,k);qa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+
":"+this.channel,dpt:"LOWBAT"}]};qa.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "lowbat":b.dataPoint="LOWBAT";break;default:return null}return b};qa.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,
d));if(a!=e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "STATE":switch(c){case 0:d.state="ok";break;case 1:d.state="moist";break;case 2:d.state="water"}break;case "LOWBAT":d.lowbat=c;break;default:return null}return d};var ra=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="energymeter"};util.inherits(ra,k);ra.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+
":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BOOT"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"POWER"}]};ra.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=
0;b.dataPoint="UNREACH";break;case "boot":b.dataPoint="BOOT";break;case "gas_energy":b.dataPoint="GAS_ENERGY_COUNTER";break;case "gas_power":b.dataPoint="GAS_POWER";break;case "energy":b.dataPoint="ENERGY_COUNTER";break;case "power":b.dataPoint="POWER";break;default:return null}return b};ra.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=
e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "BOOT":d.boot=c;break;case "GAS_ENERGY_COUNTER":d.gas_energy=c;break;case "GAS_POWER":d.gas_power=c;break;case "ENERGY_COUNTER":d.energy=c;break;case "POWER":d.power=c;break;default:return null}return d};var K=function(g,b,c){k.call(this,g,b,c);this.dimChannel=1;this.rgbChannel=2;this.autoChannel=3;this.legacyType="rgb"};util.inherits(K,k);K.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.dimChannel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.rgbChannel,dpt:"COLOR"},{channel:this.deviceAdr+":"+this.autoChannel,dpt:"PROGRAM"}]};K.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(g){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.channel=b+":"+this.dimChannel;c.dataPoint="LEVEL";break;case "color":c.channel=b+":"+this.rgbChannel;
c.dataPoint="COLOR";break;case "program":c.channel=b+":"+this.autoChannel;c.dataPoint="PROGRAM";break;case "inhibit":c.channel=b+":"+this.dimChannel;c.dataPoint="INHIBIT";break;case "working":c.channel=b+":"+this.dimChannel;c.dataPoint="WORKING";break;case "direction":c.channel=b+":"+this.dimChannel;c.dataPoint="DIRECTION";break;default:return null}return c};K.prototype.executeCommand=function(g,b,c){var d,a,e=this;switch(b){case "on":d=this.deviceAdr+":"+this.dimChannel;a="OLD_LEVEL";g.writeValue(this.deviceIF,
d,a,!0,c);break;case "off":d=this.deviceAdr+":"+this.dimChannel;a="LEVEL";g.writeValue(this.deviceIF,d,a,{type:"double",value:0},c);break;case "white":d=this.deviceAdr+":"+this.rgbChannel;a="COLOR";g.writeValue(this.deviceIF,d,a,200,c);break;case "dimUp":d=this.deviceAdr+":"+this.dimChannel;a="LEVEL";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else if(f){var h=f.value+.05;1<h&&(h=1);g.writeValue(e.deviceIF,d,a,{type:"double",value:h},c)}else c&&c(Error("get current dimmer state result invalid"))});
break;case "dimDown":d=this.deviceAdr+":"+this.dimChannel;a="LEVEL";g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else if(f){var h=f.value-.05;0>h&&(h=0);g.writeValue(e.deviceIF,d,a,{type:"double",value:h},c)}else c&&c(Error("get current dimmer state result invalid"))});break;default:if("onTo"==b.substr(0,4)||b.match(/^[-+]?[0-9]+$/)){"onTo"==b.substr(0,4)&&(b=b.substr(4));var f=parseInt(b);d=this.deviceAdr+":"+this.dimChannel;a="LEVEL";g.writeValue(this.deviceIF,
d,a,{type:"double",value:f/100},c)}else if("setProg"==b.substr(0,7))b=b.substr(7),f=parseInt(b),d=this.deviceAdr+":"+this.autoChannel,a="PROGRAM",g.writeValue(this.deviceIF,d,a,f,c);else if("setRampTime"==b.substr(0,11))b=b.substr(11),f=parseFloat(b),d=this.deviceAdr+":"+this.dimChannel,a="RAMP_TIME",g.writeValue(this.deviceIF,d,a,{type:"double",value:f},c);else if(b.toLowerCase().match(/^([0-9a-f]{6})$/i)){var f=parseInt(b.substr(0,2),16),h=parseInt(b.substr(2,2),16);b=parseInt(b.substr(4,2),16);
var k=0,f=this._RGBToHSV(f,h,b),k=.1>f[1]?200:Math.round(f[0]/1.8);d=this.deviceAdr+":"+this.rgbChannel;a="COLOR";g.writeValue(this.deviceIF,d,a,k,c)}else c&&c(Error("no such command"))}};K.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.dimChannel&&g!=this.rgbChannel&&g!=this.autoChannel)return null;d={};if(0==g)return"UNREACH"==
b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "LEVEL":d.state=100*parseFloat(c);break;case "COLOR":d.color=c;break;case "PROGRAM":d.program=c;break;case "INHIBIT":d.inhibit=c;break;case "WORKING":d.working=c;break;case "DIRECTION":d.direction=c;break;default:return null}return d};K.prototype._RGBToHSV=function(g,b,c){g/=255;b/=255;c/=255;var d=Math.min(g,Math.min(b,c)),a=Math.max(g,Math.max(b,c));return d==a?[0,0,d]:[60*((g==d?3:c==d?1:5)-(g==d?b-c:c==d?g-b:c-g)/(a-d)),(a-d)/a,a]};var sa=
function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="lux"};util.inherits(sa,k);sa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LUX"}]};sa.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;
case "state":b.dataPoint="LUX";break;default:return null}return b};sa.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "LUX":d.state=c;break;default:return null}return d};var Q=function(g,b,
c){k.call(this,g,b,c);this.swChannel1=1;this.swChannel2=2;this.panicChannel=3;this.armingChannel=4;this.legacyType="siren2"};util.inherits(Q,k);Q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.swChannel1,dpt:"STATE"},{channel:this.deviceAdr+":"+this.swChannel2,dpt:"STATE"},{channel:this.deviceAdr+":"+this.panicChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ARMSTATE"},{channel:this.deviceAdr+":"+this.armingChannel,
dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"LOWBAT"}]};Q.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(g){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "switchSensorInState":c.channel=b+":"+this.swChannel1;c.dataPoint="STATE";break;case "switchSensorExState":c.channel=b+":"+this.swChannel2;
c.dataPoint="STATE";break;case "switchPanicState":c.channel=b+":"+this.panicChannel;c.dataPoint="STATE";break;case "arming":c.channel=b+":"+this.armingChannel;c.dataPoint="ARMSTATE";break;case "inhibit":c.channel=b+":"+this.armingChannel;c.dataPoint="INHIBIT";break;case "working":c.channel=b+":"+this.armingChannel;c.dataPoint="WORKING";break;case "sabotage":c.channel=b+":"+this.armingChannel;c.dataPoint="ERROR_SABOTAGE";break;case "lowbat":c.channel=b+":"+this.armingChannel;c.dataPoint="LOWBAT";break;
default:return null}return c};Q.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d={};if(0==g)return"UNREACH"==b?d.timeout=c:d["0_"+b.toLowerCase()]=c,d;if(1==g){switch(b){case "STATE":d.switchSensorInState=c?"on":"off";break;default:return null}return d}if(2==g){switch(b){case "STATE":d.switchSensorExState=c?"on":"off";break;
default:return null}return d}if(3==g){switch(b){case "STATE":d.switchPanicState=c?"on":"off";break;default:return null}return d}if(4==g){switch(b){case "ARMSTATE":switch(c){case 0:d.arming="disarmed";break;case 1:d.arming="ex_armed";break;case 2:d.arming="all_armed";break;case 3:d.arming="blocked"}break;case "INHIBIT":d.inhibit=c;break;case "WORKING":d.working=c;break;case "ERROR_SABOTAGE":switch(c){case 0:d.sabotage="no_error";break;case 1:d.sabotage="ex_armed"}break;case "LOWBAT":d.lowbat=c;break;
default:return null}return d}};Q.prototype.executeCommand=function(g,b,c){var d,a,e=this;switch(b){case "switchSensorInOn":a="STATE";d=this.deviceAdr+":"+this.swChannel1;g.writeValue(this.deviceIF,d,a,!0,c);break;case "switchSensorInOff":a="STATE";d=this.deviceAdr+":"+this.swChannel1;g.writeValue(this.deviceIF,d,a,!1,c);break;case "switchSensorInToggle":a="STATE";d=this.deviceAdr+":"+this.swChannel1;g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else{var h=!0;
f.value&&(h=!1);g.writeValue(e.deviceIF,d,a,h,c)}});break;case "switchSensorExOn":a="STATE";d=this.deviceAdr+":"+this.swChannel2;g.writeValue(this.deviceIF,d,a,!0,c);break;case "switchSensorExOff":a="STATE";d=this.deviceAdr+":"+this.swChannel2;g.writeValue(this.deviceIF,d,a,!1,c);break;case "switchSensorExToggle":a="STATE";d=this.deviceAdr+":"+this.swChannel2;g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else{var h=!0;f.value&&(h=!1);g.writeValue(e.deviceIF,
d,a,h,c)}});break;case "switchPanicOn":a="STATE";d=this.deviceAdr+":"+this.panicChannel;g.writeValue(this.deviceIF,d,a,!0,c);break;case "switchPanicOff":a="STATE";d=this.deviceAdr+":"+this.panicChannel;g.writeValue(this.deviceIF,d,a,!1,c);break;case "switchPanicToggle":a="STATE";d=this.deviceAdr+":"+this.panicChannel;g.getState({interface:this.deviceIF,channel:d,datapoint:a},function(b,f){if(b)c&&c(b);else{var h=!0;f.value&&(h=!1);g.writeValue(e.deviceIF,d,a,h,c)}});break;case "armingDisarm":a="ARMSTATE";
d=this.deviceAdr+":"+this.armingChannel;g.writeValue(this.deviceIF,d,a,0,c);break;case "armingIntern":a="ARMSTATE";d=this.deviceAdr+":"+this.armingChannel;g.writeValue(this.deviceIF,d,a,1,c);break;case "armingAll":a="ARMSTATE";d=this.deviceAdr+":"+this.armingChannel;g.writeValue(this.deviceIF,d,a,2,c);break;default:c&&c(Error("no such command"))}};var R=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="jalousie"};util.inherits(R,k);R.prototype._getReadableDpts=function(){var g=[],
b=this,c=x.hub.m.hm._Channel["BidCos-RF"];g.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});(c=c.JALOUSIE.getReadableDpts())&&c.forEach(function(c){g.push({channel:b.deviceAdr+":3",dpt:c})});return g};R.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["BidCos-RF"];switch(g){case "timeout":c.channel=b+":0";c.dataPoint="UNREACH";break;default:if(c.channel=b+":"+this.channel,c.dataPoint=d.JALOUSIE.getDptFromState(g),!c.dataPoint)return null}return c};
R.prototype.executeCommand=function(g,b,c){x.hub.m.hm._Channel["BidCos-RF"].JALOUSIE.executeCommand(g,this.deviceIF,this.deviceAdr+":"+this.channel,b,c)};R.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["BidCos-RF"];a=null;if(0==g){if("UNREACH"==b)return{timeout:c};a={};a["0_"+b.toLowerCase()]=c;return a}return g==
this.channel?d.JALOUSIE.parseDptState(b,c):null};var A=function(g,b,c){k.call(this,g,b,c);this.keyChannel1=1;this.keyChannel2=2;this.em8bitChannel=3;this.legacyType="mod_em_8bit"};util.inherits(A,k);A.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"];g.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var d=c.KEY.getReadableDpts();d&&d.forEach(function(c){g.push({channel:b.deviceAdr+":1",dpt:c});g.push({channel:b.deviceAdr+":2",dpt:c})});(d=c.MOD_EM8BIT_TRANSMITTER.getReadableDpts())&&
d.forEach(function(c){g.push({channel:b.deviceAdr+":3",dpt:c})});return g};A.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null};switch(g){case "timeout":c.channel=b+":0";c.dataPoint="UNREACH";break;case "lowbat":c.channel=b+":3";c.dataPoint="LOWBAT";break;case "state8bit":c.channel=b+":3";c.dataPoint="STATE";break;default:return null}return c};A.prototype.executeCommand=function(g,b,c){var d=x.hub.m.hm._Channel["BidCos-RF"];switch(b){case "ch1pressShort":b=
this.deviceAdr+":"+this.keyChannel1;d.KEY.executeCommand(g,this.deviceIF,b,"pressShort",c);break;case "ch1pressLong":b=this.deviceAdr+":"+this.keyChannel1;d.KEY.executeCommand(g,this.deviceIF,b,"pressLong",c);break;case "ch2pressShort":b=this.deviceAdr+":"+this.keyChannel2;d.KEY.executeCommand(g,this.deviceIF,b,"pressShort",c);break;case "ch2pressLong":b=this.deviceAdr+":"+this.keyChannel2;d.KEY.executeCommand(g,this.deviceIF,b,"pressLong",c);break;default:c&&c(Error("no such command"))}};A.prototype.parseDptState=
function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;a=x.hub.m.hm._Channel["BidCos-RF"];d=null;if(0==g){if("UNREACH"==b)return{timeout:c};d={};d["0_"+b.toLowerCase()]=c;return d}if(g==this.keyChannel1){if(b=a.KEY.parseDptState(b,c))d={},b.pressShort&&(d.ch1pressShort=!0),b.pressLong&&(d.ch1pressLong=!0),"undefined"!=typeof b.pressCont&&null!=b.pressCont&&
(d.ch1pressCont=!0),b.pressLongRel&&(d.ch1pressLongRel=!0);return d}if(g==this.keyChannel2){if(b=a.KEY.parseDptState(b,c))d={},b.pressShort&&(d.ch2pressShort=!0),b.pressLong&&(d.ch2pressLong=!0),"undefined"!=typeof b.pressCont&&null!=b.pressCont&&(d.ch2pressCont=!0),b.pressLongRel&&(d.ch2pressLongRel=!0);return d}return g==this.em8bitChannel?a.MOD_EM8BIT_TRANSMITTER.parseDptState(b,c):null};A.prototype.isButton=function(){return!0};A.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==c.indexOf(":")&&
this.channel&&(c+=":"+this.channel);var d=this;g.reportValueUsage(this.deviceIF,c+":1","PRESS_SHORT",function(a,e){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);g.reportValueUsage(d.deviceIF,c+":1","PRESS_LONG",function(a,e){a&&console.error("button claim PRESS_LONG event error:"+a.stack);g.reportValueUsage(d.deviceIF,c+":2","PRESS_SHORT",function(a,e){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);g.reportValueUsage(d.deviceIF,c+":2","PRESS_LONG",function(c,
d){b&&b()})})})})};var B=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="mod_em_8"};util.inherits(B,k);B.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"],d=c.KEY.getReadableDpts();d&&d.forEach(function(c){g.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(d=c.SWITCH_INTERFACE.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(d=c.SHUTTER_CONTACT.getReadableDpts())&&d.forEach(function(c){"ERROR"!=
c&&g.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});return g};B.prototype._getDptFromRef=function(g){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(g){case "state":b.dataPoint="STATE";break;case "lowbat":b.dataPoint="LOWBAT";break;default:return null}return b};B.prototype.executeCommand=function(g,b,c){var d=x.hub.m.hm._Channel["BidCos-RF"],a=this.deviceAdr+":"+this.channel;switch(b){case "pressShort":d.KEY.executeCommand(g,this.deviceIF,a,"pressShort",c);break;case "pressLong":d.KEY.executeCommand(g,
this.deviceIF,a,"pressLong",c);break;case "press":d.SWITCH_INTERFACE.executeCommand(g,this.deviceIF,a,"press",c);break;default:c&&c(Error("no such command"))}};B.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["BidCos-RF"];a=null;if(g==this.channel){a={};if(g=d.KEY.parseDptState(b,c))g.pressShort&&(a.pressShort=
!0),g.pressLong&&(a.pressLong=!0),"undefined"!=typeof g.pressCont&&null!=g.pressCont&&(a.pressCont=!0),g.pressLongRel&&(a.pressCont=!0);(g=d.SWITCH_INTERFACE.parseDptState(b,c))&&g.press&&(a.press=!0);if(g=d.SHUTTER_CONTACT.parseDptState(b,c))g.state&&(a.state=g.state),"undefined"!=typeof g.lowbat&&null!=g.lowbat&&(a.lowbat=g.lowbat)}return a};B.prototype.isButton=function(){return!0};B.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);
var d=this;g.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(a,e){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);g.reportValueUsage(d.deviceIF,c,"PRESS_LONG",function(a,e){a&&console.error("button claim PRESS_LONG event error:"+a.stack);g.reportValueUsage(d.deviceIF,c,"PRESS",function(c,d){c&&console.error("button claim PRESS_SHORT event error:"+c.stack);b&&b()})})})};var S=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="keymatic"};util.inherits(S,k);
S.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"],d=c.MAINTENANCE.getReadableDpts();d&&d.forEach(function(c){g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.KEYMATIC.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":1",dpt:c})});return g};S.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null};switch(g){case "timeout":c.channel=b+":0";c.dataPoint="UNREACH";break;case "lowbat":c.channel=
b+":0";c.dataPoint="LOWBAT";break;case "state":c.channel=b+":1";c.dataPoint="STATE";break;case "uncertain":c.channel=b+":1";c.dataPoint="STATE_UNCERTAIN";break;case "error":c.channel=b+":1";c.dataPoint="ERROR";break;default:return null}return c};S.prototype.executeCommand=function(g,b,c){var d=x.hub.m.hm._Channel["BidCos-RF"];switch(b){case "open":b=this.deviceAdr+":"+this.channel;d.KEYMATIC.executeCommand(g,this.deviceIF,b,"open",c);break;case "close":b=this.deviceAdr+":"+this.channel;d.KEYMATIC.executeCommand(g,
this.deviceIF,b,"close",c);break;case "openDoor":b=this.deviceAdr+":"+this.channel;d.KEYMATIC.executeCommand(g,this.deviceIF,b,"openDoor",c);break;default:c&&c(Error("no such command"))}};S.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["BidCos-RF"];a=null;if(0==g){if("UNREACH"==b||"LOWBAT"==b)return d.MAINTENANCE.parseDptState(b,
c);a={};a["0_"+b.toLowerCase()]=c;return a}return g==this.channel?b=d.KEYMATIC.parseDptState(b,c):null};var C=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ou_led16"};util.inherits(C,k);C.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this.channel,dpt:"LED_STATUS"}]};C.prototype._getDptFromRef=function(g){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(g){case "led":b.dataPoint="LED_STATUS";
break;default:return null}return b};C.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e||0!=g&&g!=this.channel)return null;if(0==g)return d={},"UNREACH"==b?d.timeout=c:"LOWBAT"==b?d.lowbat=c:d["0_"+b.toLowerCase()]=c,d;switch(b){case "LED_STATUS":switch(c){case 0:return{led:"off"};case 1:return{led:"red"};case 2:return{led:"green"};case 3:return{led:"orange"};
default:return null}default:return null}};C.prototype.executeCommand=function(g,b,c){var d=this.deviceAdr;-1==d.indexOf(":")&&this.channel&&(d+=":"+this.channel);switch(b){case "pressShort":g.writeValue(this.deviceIF,d,"PRESS_SHORT",!0,c);break;case "ledOff":g.writeValue(this.deviceIF,d,"LED_STATUS",0,c);break;case "ledRed":g.writeValue(this.deviceIF,d,"LED_STATUS",1,c);break;case "ledGreen":g.writeValue(this.deviceIF,d,"LED_STATUS",2,c);break;case "ledOrange":g.writeValue(this.deviceIF,d,"LED_STATUS",
3,c);break;case "ledSleepOff":g.writeValue(this.deviceIF,d,"LED_SLEEP_MODE",0,c);break;case "ledSleepOn":g.writeValue(this.deviceIF,d,"LED_SLEEP_MODE",1,c);break;default:c&&c(Error("no such command"))}};C.prototype.isButton=function(){return!0};C.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);g.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(c,g){c&&console.error("button claim PRESS_SHORT event error:"+c.stack);b&&b()})};var Fa=
function(g,b,c){k.call(this,g,b,c);this.channel=3;this.legacyType="hm_dis_ep_wm55"};util.inherits(Fa,k);Fa.prototype.executeCommand=function(g,b,c){if("submit"==b.substr(0,6)){var d=b.substr(6);b=this.deviceAdr+":"+this.channel;g.writeValue(this.deviceIF,b,"SUBMIT",d,c)}else c&&c(Error("no such command"))};var T=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="dualwhite"};util.inherits(T,k);T.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"],
d=c.MAINTENANCE.getReadableDpts();d&&d.forEach(function(c){"UNREACH"==c&&g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.DUAL_WHITE_BRIGHTNESS.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":1",dpt:c})});(d=c.DUAL_WHITE_COLOR.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":2",dpt:c})});return g};T.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["BidCos-RF"];switch(g){case "timeout":c.channel=
b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(g);break;case "bri":case "bri_real":case "error_overheat":case "error_reduced":case "direction":c.channel=b+":1";c.dataPoint=d.DUAL_WHITE_BRIGHTNESS.getDptFromState(g);break;case "color":case "color_real":case "color_direction":c.channel=b+":2";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState(g);break;default:return null}return c};T.prototype.executeCommand=function(g,b,c){var d=x.hub.m.hm._Channel["BidCos-RF"];switch(b){case "off":case "on":case "toggle":case "dimUp":case "dimDown":d.DUAL_WHITE_BRIGHTNESS.executeCommand(g,
this.deviceIF,this.deviceAdr+":1",b,c);break;case "colorOff":case "colorOn":case "colorToggle":case "colorUp":case "colorDown":d.DUAL_WHITE_COLOR.executeCommand(g,this.deviceIF,this.deviceAdr+":2",b,c);break;default:"dimTo"==b.substr(0,5)?d.DUAL_WHITE_BRIGHTNESS.executeCommand(g,this.deviceIF,this.deviceAdr+":1",b,c):"colorTo"==b.substr(0,7)?d.DUAL_WHITE_COLOR.executeCommand(g,this.deviceIF,this.deviceAdr+":2",b,c):c&&c(Error("no such command"))}};T.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");
if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["BidCos-RF"];a=null;if(0==g){if("UNREACH"==b)return d.MAINTENANCE.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 1==g?d.DUAL_WHITE_BRIGHTNESS.parseDptState(b,c):2==g?d.DUAL_WHITE_COLOR.parseDptState(b,c):null};var Ga=function(g,b,c){f.call(this,g,b,c);this.channel=3;this.legacyType="ip_switch"};
util.inherits(Ga,f);var ta=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_contact"};util.inherits(ta,k);ta.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(c){g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.SHUTTER_CONTACT_TRANSCEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":1",dpt:c})});return g};ta.prototype._getDptFromRef=function(g){var b=this.deviceAdr,
c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "sabotage":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":c.channel=b+":1";c.dataPoint=d.SHUTTER_CONTACT_TRANSCEIVER.getDptFromState(g);break;default:return null}return c};ta.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");
-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==g){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==b)return d.MAINTENANCE_BAT_EL.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 1==g?d.SHUTTER_CONTACT_TRANSCEIVER.parseDptState(b,c):null};var U=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_heater"};util.inherits(U,k);U.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=
c.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(c){"SABOTAGE"!=c&&g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&d.forEach(function(c){"HUMIDITY"!=c&&g.push({channel:b.deviceAdr+":1",dpt:c})});return g};U.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(g);
break;case "profile":case "temp":case "boost":case "frost":case "mode":case "state":case "window":c.channel=b+":1";c.dataPoint=d.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(g);break;default:return null}return c};U.prototype.executeCommand=function(g,b,c){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":"+this.channel,b,c)};U.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);
g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==g){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 1==g?d.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(b,c):a};var V=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_powerswitch"};util.inherits(V,k);V.prototype._getReadableDpts=function(){var g=
[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE.getReadableDpts();d&&d.forEach(function(c){"UNREACH"==c&&g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":3",dpt:c})});(d=c.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":6",dpt:c})});return g};V.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},
d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":c.channel=b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(g);break;case "switchState":c.channel=b+":3";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":c.channel=b+":6";c.dataPoint=d.ENERGIE_METER_TRANSMITTER.getDptFromState(g);break;default:return null}return c};V.prototype.executeCommand=function(g,b,c){var d=
null,a=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "on":d=this.deviceAdr+":3";a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"on",c);break;case "off":d=this.deviceAdr+":3";a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"off",c);break;case "toggle":d=this.deviceAdr+":3";a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"toggle",c);break;default:if("onFor"==b.substr(0,5)){d=this.deviceAdr+":3";a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,b,c);break}c&&
c(Error("no such command"))}};V.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==g){if("UNREACH"==b)return d.MAINTENANCE.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 3==g?d.SWITCH_VIRTUAL_RECEIVER.parseDptState(b,c):6==g?d.ENERGIE_METER_TRANSMITTER.parseDptState(b,
c):null};var W=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_energyactor"};util.inherits(W,k);W.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE.getReadableDpts();d&&d.forEach(function(c){"UNREACH"==c&&g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.SWITCH_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":3",dpt:c})});(d=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+
":4",dpt:c});g.push({channel:b.deviceAdr+":5",dpt:c});g.push({channel:b.deviceAdr+":6",dpt:c})});(d=c.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":7",dpt:c})});return g};W.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":c.channel=b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(g);break;case "switchState":c.channel=b+":3";c.dataPoint=
d.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch4State":c.channel=b+":4";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch5State":c.channel=b+":5";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch6State":c.channel=b+":6";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":c.channel=b+
":7";c.dataPoint=d.ENERGIE_METER_TRANSMITTER.getDptFromState(g);break;default:return null}return c};W.prototype.executeCommand=function(g,b,c){var d=null,a=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "on":case "ch4on":case "ch5on":case "ch6on":switch(b){case "on":case "ch4on":d=this.deviceAdr+":4";break;case "ch5on":d=this.deviceAdr+":5";break;case "ch6on":d=this.deviceAdr+":6"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"on",c);break;case "off":case "ch4off":case "ch5off":case "ch6off":switch(b){case "off":case "ch4off":d=
this.deviceAdr+":4";break;case "ch5off":d=this.deviceAdr+":5";break;case "ch6off":d=this.deviceAdr+":6"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"off",c);break;case "toggle":case "ch4toggle":case "ch5toggle":case "ch6toggle":switch(b){case "toggle":case "ch4toggle":d=this.deviceAdr+":4";break;case "ch5toggle":d=this.deviceAdr+":5";break;case "ch6toggle":d=this.deviceAdr+":6"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"toggle",c);break;default:c&&c(Error("no such command"))}};
W.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;a=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==g){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(3==g){if(b=a.SWITCH_TRANSMITTER.parseDptState(b,c))d={},d.switchState=b.switchTState;return d}if(4==g||5==g||6==g){if(b=a.SWITCH_VIRTUAL_RECEIVER.parseDptState(b,
c))switch(d={},parseInt(g)){case 4:d.ch4State=b.switchState;break;case 5:d.ch5State=b.switchState;break;case 6:d.ch6State=b.switchState}return d}return 7==g?a.ENERGIE_METER_TRANSMITTER.parseDptState(b,c):null};var X=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_energyactor2"};util.inherits(X,k);X.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE.getReadableDpts();d&&d.forEach(function(c){"UNREACH"==c&&g.push({channel:b.deviceAdr+
":0",dpt:c})});(d=c.SWITCH_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":1",dpt:c})});(d=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":2",dpt:c});g.push({channel:b.deviceAdr+":3",dpt:c});g.push({channel:b.deviceAdr+":4",dpt:c})});(d=c.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":5",dpt:c})});return g};X.prototype._getDptFromRef=function(g){var b=this.deviceAdr,
c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":c.channel=b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(g);break;case "switchState":c.channel=b+":1";c.dataPoint=d.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch2State":c.channel=b+":2";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":c.channel=b+":3";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":c.channel=
b+":4";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":c.channel=b+":5";c.dataPoint=d.ENERGIE_METER_TRANSMITTER.getDptFromState(g);break;default:return null}return c};X.prototype.executeCommand=function(g,b,c){var d=null,a=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "on":case "ch2on":case "ch3on":case "ch4on":switch(b){case "on":case "ch2on":d=this.deviceAdr+":2";
break;case "ch3on":d=this.deviceAdr+":3";break;case "ch4on":d=this.deviceAdr+":4"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"on",c);break;case "off":case "ch2off":case "ch3off":case "ch4off":switch(b){case "off":case "ch2off":d=this.deviceAdr+":2";break;case "ch3off":d=this.deviceAdr+":3";break;case "ch4off":d=this.deviceAdr+":4"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"off",c);break;case "toggle":case "ch2toggle":case "ch3toggle":case "ch4toggle":switch(b){case "toggle":case "ch2toggle":d=
this.deviceAdr+":2";break;case "ch3toggle":d=this.deviceAdr+":3";break;case "ch4toggle":d=this.deviceAdr+":4"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"toggle",c);break;default:c&&c(Error("no such command"))}};X.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;a=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==
g){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(1==g){if(b=a.SWITCH_TRANSMITTER.parseDptState(b,c))d={},d.switchState=b.switchTState;return d}if(2==g||3==g||4==g){if(b=a.SWITCH_VIRTUAL_RECEIVER.parseDptState(b,c))switch(d={},parseInt(g)){case 2:d.ch2State=b.switchState;break;case 3:d.ch3State=b.switchState;break;case 4:d.ch4State=b.switchState}return d}return 5==g?a.ENERGIE_METER_TRANSMITTER.parseDptState(b,c):null};var Y=function(g,b,c){k.call(this,
g,b,c);this.channel=1;this.legacyType="ip_dimmer"};util.inherits(Y,k);Y.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE.getReadableDpts();d&&d.forEach(function(c){"UNREACH"==c&&g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.DIMMER_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":3",dpt:c})});(d=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":4",dpt:c});g.push({channel:b.deviceAdr+
":5",dpt:c});g.push({channel:b.deviceAdr+":6",dpt:c})});return g};Y.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":c.channel=b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(g);break;case "dimmerLevel":c.channel=b+":3";c.dataPoint=d.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":c.channel=b+":4";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;case "ch5Level":c.channel=b+":5";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":c.channel=b+":6";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return c};Y.prototype.executeCommand=function(g,b,c){var d=null,a=x.hub.m.hm._Channel["HmIP-RF"],e=b,f,h;-1!=b.indexOf("dimUp")?(h=b.indexOf("dimUp"),e=b.substr(0,h+5),f=b.substr(h+5)):-1!=b.indexOf("dimDown")?(h=b.indexOf("dimDown"),e=b.substr(0,h+7),f=b.substr(h+
7)):-1!=b.indexOf("dimTo")?(h=b.indexOf("dimTo"),e=b.substr(0,h+5),f=b.substr(h+5)):-1!=b.indexOf("toggleTo")&&(h=b.indexOf("toggleTo"),e=b.substr(0,h+8),f=b.substr(h+8));var k=this;switch(e){case "dimOff":a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":4","dimOff",function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":5","dimOff",function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":6","dimOff",
c)})});break;case "dimUp":f=f?parseInt(f)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get dimmer current value return invalid")):(f=d.value+f,1<f&&(f=1),f=Math.round(100*f),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":5","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
k.deviceIF,k.deviceAdr+":6","dimTo"+f,c)})}))});break;case "dimDown":f=f?parseInt(f)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get dimmer current value return invalid")):(f=d.value-f,0>f&&(f=0),f=Math.round(100*f),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+
":5","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":6","dimTo"+f,c)})}))});break;case "dimTo":if(!f){c&&c(Error("dimTo has no value"));break}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":4","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":5","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":6","dimTo"+f,function(b,
d){if(b)c&&c(b,d);else{var a=f/100;1<a&&(a=1);0>a&&(a=0);g.updateStatusBuffer(k.deviceIF,k.deviceAdr+":3","LEVEL",a,(new Date).getTime()+1E3);c&&c(b)}})})});break;case "toggleTo":if(!f){c&&c(Error("toggle has no value"));break}g.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get dimmer current value return invalid")):(d.value&&(f=0),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+
":4","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":5","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":6","dimTo"+f,c)})}))});break;case "ch4dimOff":case "ch5dimOff":case "ch6dimOff":switch(e){case "ch4dimOff":d=this.deviceAdr+":4";break;case "ch5dimOff":d=this.deviceAdr+":5";break;case "ch6dimOff":d=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimOff",
c);break;case "ch4dimUp":case "ch5dimUp":case "ch6dimUp":switch(e){case "ch4dimUp":d=this.deviceAdr+":4";break;case "ch5dimUp":d=this.deviceAdr+":5";break;case "ch6dimUp":d=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimUp"+f,c);break;case "ch4dimDown":case "ch5dimDown":case "ch6dimDown":switch(e){case "ch4dimDown":d=this.deviceAdr+":4";break;case "ch5dimDown":d=this.deviceAdr+":5";break;case "ch6dimDown":d=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,d,"dimDown"+f,c);break;case "ch4dimTo":case "ch5dimTo":case "ch6dimTo":switch(e){case "ch4dimTo":d=this.deviceAdr+":4";break;case "ch5dimTo":d=this.deviceAdr+":5";break;case "ch6dimTo":d=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimTo"+f,c);break;case "ch4toggleTo":case "ch5toggleTo":case "ch6toggleTo":switch(e){case "ch4toggleTo":d=this.deviceAdr+":4";break;case "ch5toggleTo":d=this.deviceAdr+":5";break;case "ch6toggleTo":d=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,d,"toggleTo"+f,c);break;default:c&&c(Error("no such command"))}};Y.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;a=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==g){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(3==g){if(b=a.DIMMER_TRANSMITTER.parseDptState(b,
c))d={},d.dimmerLevel=b.dimmerTLevel;return d}if(4==g||5==g||6==g){if(b=a.DIMMER_VIRTUAL_RECEIVER.parseDptState(b,c))switch(d={},parseInt(g)){case 4:d.ch4Level=b.dimmerLevel;break;case 5:d.ch5Level=b.dimmerLevel;break;case 6:d.ch6Level=b.dimmerLevel}return d}return null};var Z=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_dimmer2"};util.inherits(Z,k);Z.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE.getReadableDpts();d&&
d.forEach(function(c){"UNREACH"==c&&g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.DIMMER_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":2",dpt:c})});(d=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":3",dpt:c});g.push({channel:b.deviceAdr+":4",dpt:c});g.push({channel:b.deviceAdr+":5",dpt:c})});return g};Z.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=
x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":c.channel=b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(g);break;case "dimmerLevel":c.channel=b+":2";c.dataPoint=d.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":c.channel=b+":3";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch5Level":c.channel=b+":4";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":c.channel=b+":5";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;default:return null}return c};Z.prototype.executeCommand=function(g,b,c){var d=null,a=x.hub.m.hm._Channel["HmIP-RF"],e=b,f,h;-1!=b.indexOf("dimUp")?(h=b.indexOf("dimUp"),e=b.substr(0,h+5),f=b.substr(h+5)):-1!=b.indexOf("dimDown")?(h=b.indexOf("dimDown"),e=b.substr(0,h+7),f=b.substr(h+7)):-1!=b.indexOf("dimTo")?(h=b.indexOf("dimTo"),e=b.substr(0,h+5),f=b.substr(h+5)):-1!=b.indexOf("toggleTo")&&(h=b.indexOf("toggleTo"),e=b.substr(0,h+8),f=b.substr(h+8));var k=this;switch(e){case "dimOff":a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,this.deviceAdr+":3","dimOff",function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimOff",function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":5","dimOff",c)})});break;case "dimUp":f=f?parseInt(f)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get dimmer current value return invalid")):(f=d.value+
f,1<f&&(f=1),f=Math.round(100*f),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":3","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":5","dimTo"+f,c)})}))});break;case "dimDown":f=f?parseInt(f)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==
typeof d||null==d?c&&c(Error("get dimmer current value return invalid")):(f=d.value-f,0>f&&(f=0),f=Math.round(100*f),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":3","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":5","dimTo"+f,c)})}))});break;case "dimTo":if(!f){c&&c(Error("dimTo has no value"));break}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,this.deviceAdr+":3","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":5","dimTo"+f,function(b,d){if(b)c&&c(b,d);else{var a=f/100;1<a&&(a=1);0>a&&(a=0);g.updateStatusBuffer(k.deviceIF,k.deviceAdr+":2","LEVEL",a,(new Date).getTime()+1E3);c&&c(b)}})})});break;case "toggleTo":if(!f){c&&c(Error("toggle has no value"));break}g.getState({interface:this.deviceIF,
channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get dimmer current value return invalid")):(d.value&&(f=0),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":3","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":5","dimTo"+f,c)})}))});break;case "ch3dimOff":case "ch4dimOff":case "ch5dimOff":switch(e){case "ch3dimOff":d=
this.deviceAdr+":3";break;case "ch4dimOff":d=this.deviceAdr+":4";break;case "ch5dimOff":d=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimOff",c);break;case "ch3dimUp":case "ch4dimUp":case "ch5dimUp":switch(e){case "ch3dimUp":d=this.deviceAdr+":3";break;case "ch4dimUp":d=this.deviceAdr+":4";break;case "ch5dimUp":d=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimUp"+f,c);break;case "ch3dimDown":case "ch4dimDown":case "ch5dimDown":switch(e){case "ch3dimDown":d=
this.deviceAdr+":3";break;case "ch4dimDown":d=this.deviceAdr+":4";break;case "ch5dimDown":d=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimDown"+f,c);break;case "ch3dimTo":case "ch4dimTo":case "ch5dimTo":switch(e){case "ch3dimTo":d=this.deviceAdr+":3";break;case "ch4dimTo":d=this.deviceAdr+":4";break;case "ch5dimTo":d=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimTo"+f,c);break;case "ch3toggleTo":case "ch4toggleTo":case "ch5toggleTo":switch(e){case "ch3toggleTo":d=
this.deviceAdr+":3";break;case "ch4toggleTo":d=this.deviceAdr+":4";break;case "ch5toggleTo":d=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"toggleTo"+f,c);break;default:c&&c(Error("no such command"))}};Z.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;a=x.hub.m.hm._Channel["HmIP-RF"];d=null;
if(0==g){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(2==g){if(b=a.DIMMER_TRANSMITTER.parseDptState(b,c))d={},d.dimmerLevel=b.dimmerTLevel;return d}if(3==g||4==g||5==g){if(b=a.DIMMER_VIRTUAL_RECEIVER.parseDptState(b,c))switch(d={},parseInt(g)){case 3:d.ch3Level=b.dimmerLevel;break;case 4:d.ch4Level=b.dimmerLevel;break;case 5:d.ch5Level=b.dimmerLevel}return d}return null};var aa=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType=
"ip_dimmer3"};util.inherits(aa,k);aa.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE.getReadableDpts();d&&d.forEach(function(c){"UNREACH"==c&&g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.DIMMER_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":1",dpt:c})});(d=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":2",dpt:c});g.push({channel:b.deviceAdr+":3",dpt:c});
g.push({channel:b.deviceAdr+":4",dpt:c})});return g};aa.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":c.channel=b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(g);break;case "dimmerLevel":c.channel=b+":1";c.dataPoint=d.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch2Level":c.channel=b+":2";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;
case "ch3Level":c.channel=b+":3";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch4Level":c.channel=b+":4";c.dataPoint=d.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return c};aa.prototype.executeCommand=function(g,b,c){var d=null,a=x.hub.m.hm._Channel["HmIP-RF"],e=b,f,h;-1!=b.indexOf("dimUp")?(h=b.indexOf("dimUp"),e=b.substr(0,h+5),f=b.substr(h+5)):-1!=b.indexOf("dimDown")?(h=b.indexOf("dimDown"),e=b.substr(0,h+7),f=b.substr(h+
7)):-1!=b.indexOf("dimTo")?(h=b.indexOf("dimTo"),e=b.substr(0,h+5),f=b.substr(h+5)):-1!=b.indexOf("toggleTo")&&(h=b.indexOf("toggleTo"),e=b.substr(0,h+8),f=b.substr(h+8));var k=this;switch(e){case "dimOff":a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":2","dimOff",function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":3","dimOff",function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimOff",
c)})});break;case "dimUp":f=f?parseInt(f)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get dimmer current value return invalid")):(f=d.value+f,1<f&&(f=1),f=Math.round(100*f),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":2","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":3","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
k.deviceIF,k.deviceAdr+":4","dimTo"+f,c)})}))});break;case "dimDown":f=f?parseInt(f)/100:.1;g.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get dimmer current value return invalid")):(f=d.value-f,0>f&&(f=0),f=Math.round(100*f),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":2","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+
":3","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimTo"+f,c)})}))});break;case "dimTo":if(!f){c&&c(Error("dimTo has no value"));break}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":2","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":3","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimTo"+f,function(b,
d){if(b)c&&c(b,d);else{var a=f/100;1<a&&(a=1);0>a&&(a=0);g.updateStatusBuffer(k.deviceIF,k.deviceAdr+":1","LEVEL",a,(new Date).getTime()+1E3);c&&c(b)}})})});break;case "toggleTo":if(!f){c&&c(Error("toggle has no value"));break}g.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get dimmer current value return invalid")):(d.value&&(f=0),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+
":2","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":3","dimTo"+f,function(b,d){b?c&&c(b,d):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,k.deviceIF,k.deviceAdr+":4","dimTo"+f,c)})}))});break;case "ch2dimOff":case "ch3dimOff":case "ch4dimOff":switch(e){case "ch2dimOff":d=this.deviceAdr+":2";break;case "ch3dimOff":d=this.deviceAdr+":3";break;case "ch4dimOff":d=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimOff",
c);break;case "ch2dimUp":case "ch3dimUp":case "ch4dimUp":switch(e){case "ch2dimUp":d=this.deviceAdr+":2";break;case "ch3dimUp":d=this.deviceAdr+":3";break;case "ch4dimUp":d=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimUp"+f,c);break;case "ch2dimDown":case "ch3dimDown":case "ch4dimDown":switch(e){case "ch2dimDown":d=this.deviceAdr+":2";break;case "ch3dimDown":d=this.deviceAdr+":3";break;case "ch4dimDown":d=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,d,"dimDown"+f,c);break;case "ch2dimTo":case "ch3dimTo":case "ch4dimTo":switch(e){case "ch2dimTo":d=this.deviceAdr+":2";break;case "ch3dimTo":d=this.deviceAdr+":3";break;case "ch4dimTo":d=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,d,"dimTo"+f,c);break;case "ch2toggleTo":case "ch3toggleTo":case "ch4toggleTo":switch(e){case "ch2toggleTo":d=this.deviceAdr+":2";break;case "ch3toggleTo":d=this.deviceAdr+":3";break;case "ch4toggleTo":d=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(g,
this.deviceIF,d,"toggleTo"+f,c);break;default:c&&c(Error("no such command"))}};aa.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;a=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==g){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(1==g){if(b=a.DIMMER_TRANSMITTER.parseDptState(b,
c))d={},d.dimmerLevel=b.dimmerTLevel;return d}if(2==g||3==g||4==g){if(b=a.DIMMER_VIRTUAL_RECEIVER.parseDptState(b,c))switch(d={},parseInt(g)){case 2:d.ch2Level=b.dimmerLevel;break;case 3:d.ch3Level=b.dimmerLevel;break;case 4:d.ch4Level=b.dimmerLevel}return d}return null};var ba=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_motion"};util.inherits(ba,k);ba.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_EL.getReadableDpts();
d&&d.forEach(function(c){g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":1",dpt:c})});return g};ba.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "sabotage":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":case "illumination":case "active":c.channel=
b+":1";c.dataPoint=d.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(g);break;default:return null}return c};ba.prototype.executeCommand=function(g,b,c){var d=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "reset":case "activate":case "deactivate":case "toggleActivate":d.MOTIONDETECTOR_TRANSCEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":1",b,c);break;default:c&&c(Error("no such command"))}};ba.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=
g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==g){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==b)return d.MAINTENANCE_BAT_EL.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 1==g?d.MOTIONDETECTOR_TRANSCEIVER.parseDptState(b,c):null};var D=function(g,b,c){k.call(this,g,b,c);this.channel=3;this.legacyType="ip_motion2"};util.inherits(D,k);D.prototype._getReadableDpts=
function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(c){"SABOTAGE"!=c&&g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":3",dpt:c})});return g};D.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":c.channel=b+
":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":case "illumination":case "active":c.channel=b+":3";c.dataPoint=d.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(g);break;default:return null}return c};D.prototype.executeCommand=function(g,b,c){switch(b){case "reset":case "activate":case "deactivate":case "toggleActivate":break;default:c&&c(Error("no such command"))}};D.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+
1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==g){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE_BAT_EL.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}1==g&&(e=d.KEY_TRANRECEIVER.parseDptState(b,c))&&(e.pressShort&&(a={btn1pressShort:!0}),e.pressLong&&(a={btn1pressLong:!0}));2==g&&(e=d.KEY_TRANRECEIVER.parseDptState(b,c))&&(e.pressShort&&(a={btn2pressShort:!0}),e.pressLong&&
(a={btn2pressLong:!0}));return 3==g?d.MOTIONDETECTOR_TRANSCEIVER.parseDptState(b,c):a};D.prototype.isButton=function(){return!0};D.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var d=this;g.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(c,a){c&&console.error("button:1 claim PRESS_SHORT event error:"+c.stack);g.reportValueUsage(d.deviceIF,d.deviceAdr+":1","PRESS_LONG",function(c,a){c&&console.error("button:1 claim PRESS_LONG event error:"+
c.stack);g.reportValueUsage(d.deviceIF,d.deviceAdr+":2","PRESS_SHORT",function(c,a){c&&console.error("button:2 claim PRESS_SHORT event error:"+c.stack);g.reportValueUsage(d.deviceIF,d.deviceAdr+":2","PRESS_LONG",function(c,d){c&&console.error("button:2 claim PRESS_LONG event error:"+c.stack);b&&b()})})})})};var L=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_button2"};util.inherits(L,k);L.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();
c&&c.forEach(function(c){"SABOTAGE"!=c&&g.push({channel:b.deviceAdr+":0",dpt:c})});return g};L.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(g);break;default:return null}return c};L.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=
this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==g){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE_BAT_EL.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}1==g&&(e=d.KEY_TRANRECEIVER.parseDptState(b,c))&&(e.pressShort&&(a={btn1pressShort:!0}),e.pressLong&&(a={btn1pressLong:!0}));2==g&&(e=d.KEY_TRANRECEIVER.parseDptState(b,c))&&(e.pressShort&&(a={btn2pressShort:!0}),e.pressLong&&(a={btn2pressLong:!0}));
return a};L.prototype.isButton=function(){return!0};L.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var d=this;g.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(c,a){c&&console.error("button:1 claim PRESS_SHORT event error:"+c.stack);g.reportValueUsage(d.deviceIF,d.deviceAdr+":1","PRESS_LONG",function(c,a){c&&console.error("button:1 claim PRESS_LONG event error:"+c.stack);g.reportValueUsage(d.deviceIF,d.deviceAdr+
":2","PRESS_SHORT",function(c,a){c&&console.error("button:2 claim PRESS_SHORT event error:"+c.stack);g.reportValueUsage(d.deviceIF,d.deviceAdr+":2","PRESS_LONG",function(c,d){c&&console.error("button:2 claim PRESS_LONG event error:"+c.stack);b&&b()})})})})};var E=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_button4"};util.inherits(E,k);E.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=
c&&g.push({channel:b.deviceAdr+":0",dpt:c})});return g};E.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(g);break;default:return null}return c};E.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");
-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;a=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==g){if("UNREACH"==b||"LOW_BAT"==b)return a.MAINTENANCE_BAT_EL.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(1==g||2==g||3==g||4==g)if(b=a.KEY_TRANRECEIVER.parseDptState(b,c))d||(d={}),b.pressShort&&(d["btn"+g+"pressShort"]=!0),b.pressLong&&(d["btn"+g+"pressLong"]=!0);return d};E.prototype.isButton=function(){return!0};E.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==
c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var d=this;this._claimButtonEvent(1,g,function(){d._claimButtonEvent(2,g,function(){d._claimButtonEvent(3,g,function(){d._claimButtonEvent(4,g,function(){b&&b()})})})})};E.prototype._claimButtonEvent=function(g,b,c){var d=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+g,"PRESS_SHORT",function(a,e){a&&console.error("button:"+g+" claim PRESS_SHORT event error:"+a.stack);b.reportValueUsage(d.deviceIF,d.deviceAdr+":"+g,"PRESS_LONG",function(b,
d){b&&console.error("button:"+g+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};var F=function(g,b,c){k.call(this,g,b,c);this.channel=1;this.legacyType="ip_button6"};util.inherits(F,k);F.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&g.push({channel:b.deviceAdr+":0",dpt:c})});return g};F.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},
d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(g);break;default:return null}return c};F.prototype.parseDptState=function(g,b,c){var d=g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;a=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==g){if("UNREACH"==b||"LOW_BAT"==b)return a.MAINTENANCE_BAT_EL.parseDptState(b,
c);d={};d["0_"+b.toLowerCase()]=c;return d}if(1==g||2==g||3==g||4==g||5==g||6==g)if(b=a.KEY_TRANRECEIVER.parseDptState(b,c))d||(d={}),b.pressShort&&(d["btn"+g+"pressShort"]=!0),b.pressLong&&(d["btn"+g+"pressLong"]=!0);return d};F.prototype.isButton=function(){return!0};F.prototype.claimEvent=function(g,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var d=this;this._claimButtonEvent(1,g,function(){d._claimButtonEvent(2,g,function(){d._claimButtonEvent(3,g,function(){d._claimButtonEvent(4,
g,function(){d._claimButtonEvent(5,g,function(){d._claimButtonEvent(6,g,function(){b&&b()})})})})})})};F.prototype._claimButtonEvent=function(g,b,c){var d=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+g,"PRESS_SHORT",function(a,e){a&&console.error("button:"+g+" claim PRESS_SHORT event error:"+a.stack);b.reportValueUsage(d.deviceIF,d.deviceAdr+":"+g,"PRESS_LONG",function(b,d){b&&console.error("button:"+g+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};var ca=function(g,b,c){k.call(this,
g,b,c);this.channel=3;this.legacyType="ip_siren"};util.inherits(ca,k);ca.prototype._getReadableDpts=function(){var g=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(c){g.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.ALARM_SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){g.push({channel:b.deviceAdr+":3",dpt:c})});return g};ca.prototype._getDptFromRef=function(g){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},
d=x.hub.m.hm._Channel["HmIP-RF"];switch(g){case "timeout":case "lowbat":case "sabotage":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(g);break;case "state":c.channel=b+":3";c.dataPoint=d.ALARM_SWITCH_VIRTUAL_RECEIVER.getDptFromState(g);break;default:return null}return c};ca.prototype.executeCommand=function(g,b,c){x.hub.m.hm._Channel["HmIP-RF"].ALARM_SWITCH_VIRTUAL_RECEIVER.executeCommand(g,this.deviceIF,this.deviceAdr+":3",b,c)};ca.prototype.parseDptState=function(g,b,c){var d=
g.indexOf(":");if(-1==d)return null;var a=g.substr(0,d);g=g.substr(d+1);var e=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(e=this.deviceAdr.substr(0,d));if(a!=e)return null;d=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==g){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==b)return d.MAINTENANCE_BAT_EL.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 3==g?d.ALARM_SWITCH_VIRTUAL_RECEIVER.parseDptState(b,c):null};var y=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType=
"ip_wallthermo"};util.inherits(y,k);y.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(c){"SABOTAGE"!=c&&a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&d.forEach(function(c){"LEVEL"!=c&&a.push({channel:b.deviceAdr+":1",dpt:c})});return a};y.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},
d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":c.channel=b+":1";c.dataPoint=d.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(a);break;default:return null}return c};y.prototype.executeCommand=function(a,b,c){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(a,this.deviceIF,
this.deviceAdr+":"+this.channel,b,c)};y.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==a?d.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(b,c):
e};var ua=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_wallthermo2"};util.inherits(ua,y);ua.prototype._getReadableDpts=function(){var a=y.prototype._getReadableDpts.call(this);a||(a=[]);var b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getReadableDpts();d&&d.forEach(function(c){a.push({channel:b.deviceAdr+":8",dpt:c})});(d=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":10",dpt:c})});return a};
ua.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "valveState":c.channel=b+":10";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "cl_fd_emergencyOP":case "cl_fd_frostProtection":case "cl_fd_state":case "cl_fd_humidityAlarm":c.channel=b+":8";c.dataPoint=d.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getDptFromState(a);break;default:return y.prototype._getDptFromRef.call(this,
a)}return c};ua.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(1==a)return e.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(b,c);if(8==a)return e.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.parseDptState(b,
c);10==a&&(d={},b=e.SWITCH_VIRTUAL_RECEIVER.parseDptState(b,c),d.valveState=b?b.switchState:"?");return d};var da=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_smoke"};util.inherits(da,k);da.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE.getReadableDpts();d&&d.forEach(function(c){"SABOTAGE"!=c&&a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.SMOKE_DETECTOR.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+
":1",dpt:c})});return a};da.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(a);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":c.channel=b+":1";c.dataPoint=d.SMOKE_DETECTOR.getDptFromState(a);break;default:return null}return c};da.prototype.executeCommand=
function(a,b,c){x.hub.m.hm._Channel["HmIP-RF"].SMOKE_DETECTOR.executeCommand(a,this.deviceIF,this.deviceAdr+":"+this.channel,b,c)};da.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=
c;return e}return 1==a?d.SMOKE_DETECTOR.parseDptState(b,c):e};var va=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_window"};util.inherits(va,k);va.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(c){a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.ROTARY_HANDLE_TRANSCEIVER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":1",dpt:c})});return a};va.prototype._getDptFromRef=
function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "sabotage":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "state":c.channel=b+":1";c.dataPoint=d.ROTARY_HANDLE_TRANSCEIVER.getDptFromState(a);break;default:return null}return c};va.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,
d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==b)return d.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==a?d.ROTARY_HANDLE_TRANSCEIVER.parseDptState(b,c):e};var G=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_blind"};util.inherits(G,k);G.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],
d=c.MAINTENANCE.getReadableDpts();d&&d.forEach(function(c){"UNREACH"==c&&a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.SHUTTER_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":3",dpt:c})});(d=c.SHUTTER_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":4",dpt:c});a.push({channel:b.deviceAdr+":5",dpt:c});a.push({channel:b.deviceAdr+":6",dpt:c})});return a};G.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+
":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":c.channel=b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(a);break;case "blindLevel":c.channel=b+":3";c.dataPoint=d.SHUTTER_TRANSMITTER.getDptFromState("blindTLevel");break;case "ch4Level":c.channel=b+":4";c.dataPoint=d.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch5Level":c.channel=b+":5";c.dataPoint=d.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch6Level":c.channel=
b+":6";c.dataPoint=d.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;default:return null}return c};G.prototype.executeCommand=function(a,b,c){var d=null,e=x.hub.m.hm._Channel["HmIP-RF"],f=b,h,k;-1!=b.indexOf("stepUp")?(k=b.indexOf("stepUp"),f=b.substr(0,k+6),h=b.substr(k+6)):-1!=b.indexOf("stepDown")?(k=b.indexOf("stepDown"),f=b.substr(0,k+8),h=b.substr(k+8)):-1!=b.indexOf("moveTo")?(k=b.indexOf("moveTo"),f=b.substr(0,k+6),h=b.substr(k+6)):-1!=b.indexOf("stop")&&(k=b.indexOf("stop"),
f=b.substr(0,k+4),h=b.substr(k+4));var l=this;switch(f){case "stop":e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,this.deviceAdr+":4","stop",function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","stop",function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","stop",c)})});break;case "moveUp":e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,this.deviceAdr+":4","moveUp",function(b,d){b?c&&c(b,d):
e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveUp",function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveUp",c)})});break;case "moveDown":e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,this.deviceAdr+":4","moveDown",function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveDown",function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+
":6","moveDown",c)})});break;case "stepUp":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get blind current value return invalid")):(h=d.value+h,1<h&&(h=1),h=Math.round(100*h),e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,
d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,d){if(b)c&&c(b,d);else{var e=h/100;1<e&&(e=1);0>e&&(e=0);a.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3);c&&c(b)}})})}))});break;case "stepDown":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get blind current value return invalid")):
(h=d.value-h,0>h&&(h=0),h=Math.round(100*h),e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,d){if(b)c&&c(b,d);else{var e=h/100;1<e&&(e=1);0>e&&(e=0);a.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3);c&&
c(b)}})})}))});break;case "moveTo":if(!h){c&&c(Error("moveTo has no value"));break}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,this.deviceAdr+":4","moveTo"+h,function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,d){b?c&&c(b,d):e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,d){if(b)c&&c(b,d);else{var e=h/100;1<e&&(e=1);0>e&&(e=0);a.updateStatusBuffer(l.deviceIF,l.deviceAdr+
":3","LEVEL",e,(new Date).getTime()+1E3);c&&c(b)}})})});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(f){case "ch4stop":d=this.deviceAdr+":4";break;case "ch5stop":d=this.deviceAdr+":5";break;case "ch6stop":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"stop",c);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(f){case "ch4moveUp":d=this.deviceAdr+":4";break;case "ch5moveUp":d=this.deviceAdr+":5";break;case "ch6moveUp":d=this.deviceAdr+
":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"moveUp",c);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(f){case "ch4moveDown":d=this.deviceAdr+":4";break;case "ch5moveDown":d=this.deviceAdr+":5";break;case "ch6moveDown":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"moveDown",c);break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(f){case "ch4stepUp":d=this.deviceAdr+":4";break;case "ch5stepUp":d=this.deviceAdr+
":5";break;case "ch6stepUp":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"stepUp"+h,c);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(f){case "ch4stepDown":d=this.deviceAdr+":4";break;case "ch5stepDown":d=this.deviceAdr+":5";break;case "ch6stepDown":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"stepDown"+h,c);break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(f){case "ch4moveTo":d=this.deviceAdr+
":4";break;case "ch5moveTo":d=this.deviceAdr+":5";break;case "ch6moveTo":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"moveTo"+h,c);break;default:c&&c(Error("no such command"))}};G.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==a){if("UNREACH"==
b)return e.MAINTENANCE.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(3==a){if(b=e.SHUTTER_TRANSMITTER.parseDptState(b,c))d={},d.blindLevel=b.blindTLevel;return d}if(4==a||5==a||6==a){if(b=e.SHUTTER_VIRTUAL_RECEIVER.parseDptState(b,c))switch(d={},parseInt(a)){case 4:d.ch4Level=b.blindLevel;break;case 5:d.ch5Level=b.blindLevel;break;case 6:d.ch6Level=b.blindLevel}return d}return null};G.prototype.getConfig=function(a,b){var c=this.deviceAdr+":3";a.getParamset(this.deviceIF,c,"MASTER",
function(d,a){if(d)b&&b(d);else{var g={},e=null;a&&(e={CHANGE_OVER_DELAY:a.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUN_COUNTER:a.REFERENCE_RUN_COUNTER});g[c]=e;b&&b(d,g)}})};G.prototype.setConfig=
function(a,b,c){if(b){var d=this.deviceAdr+":3";if(b=b[d]){var e={};e.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};e.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};a.setParamset(this.deviceIF,d,"MASTER",e,function(b){c&&c(b)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};var H=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_jalousie"};util.inherits(H,k);H.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE.getReadableDpts();d&&
d.forEach(function(c){"UNREACH"==c&&a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.BLIND_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":3",dpt:c})});(d=c.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":4",dpt:c});a.push({channel:b.deviceAdr+":5",dpt:c});a.push({channel:b.deviceAdr+":6",dpt:c})});return a};H.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];
switch(a){case "timeout":c.channel=b+":0";c.dataPoint=d.MAINTENANCE.getDptFromState(a);break;case "blindLevel":c.channel=b+":3";c.dataPoint=d.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":c.channel=b+":3";c.dataPoint=d.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;case "ch4blindLevel":c.channel=b+":4";c.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch4lamellaLevel":c.channel=b+":4";c.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");
break;case "ch5blindLevel":c.channel=b+":5";c.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch5lamellaLevel":c.channel=b+":5";c.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch6blindLevel":c.channel=b+":6";c.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch6lamellaLevel":c.channel=b+":6";c.dataPoint=d.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;default:return null}return c};H.prototype.executeCommand=
function(a,b,c){var d=null,e=x.hub.m.hm._Channel["HmIP-RF"],f=b,h,k;-1!=b.indexOf("stepUp")?(k=b.indexOf("stepUp"),f=b.substr(0,k+6),h=b.substr(k+6)):-1!=b.indexOf("stepDown")?(k=b.indexOf("stepDown"),f=b.substr(0,k+8),h=b.substr(k+8)):-1!=b.indexOf("moveTo")?(k=b.indexOf("moveTo"),f=b.substr(0,k+6),h=b.substr(k+6)):-1!=b.indexOf("stop")?(k=b.indexOf("stop"),f=b.substr(0,k+4),h=b.substr(k+4)):-1!=b.indexOf("lamellaStepUp")?(k=b.indexOf("lamellaStepUp"),f=b.substr(0,k+13),h=b.substr(k+13)):-1!=b.indexOf("lamellaStepDown")?
(k=b.indexOf("lamellaStepDown"),f=b.substr(0,k+15),h=b.substr(k+15)):-1!=b.indexOf("lamellaTo")&&(k=b.indexOf("lamellaTo"),f=b.substr(0,k+9),h=b.substr(k+9));var l=this;switch(f){case "stop":case "moveUp":case "moveDown":e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,this.deviceAdr+":4",f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5",f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6",f,c)})});
break;case "lamellaUp":case "lamellaDown":a.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get blind current value return invalid")):(h=d.value,h=Math.round(100*h),e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4",f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,
l.deviceIF,l.deviceAdr+":5",f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6",f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,a){c&&c(b,a)})})})})})}))});break;case "stepUp":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},
function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get blind current value return invalid")):(h=d.value+h,1<h&&(h=1),h=Math.round(100*h),e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,d){if(b)c&&c(b,d);else{var e=h/100;1<e&&(e=
1);0>e&&(e=0);a.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3);c&&c(b)}})})}))});break;case "stepDown":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get blind current value return invalid")):(h=d.value-h,0>h&&(h=0),h=Math.round(100*h),e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(b,d){b?c&&c(b,
d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,d){if(b)c&&c(b,d);else{var e=h/100;1<e&&(e=1);0>e&&(e=0);a.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3);c&&c(b)}})})}))});break;case "moveTo":if(!h){c&&c(Error("moveTo has no value"));break}e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,this.deviceAdr+
":4","moveTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,d){if(b)c&&c(b,d);else{var e=h/100;1<e&&(e=1);0>e&&(e=0);a.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3);c&&c(b)}})})});break;case "lamellaStepUp":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:this.deviceAdr+
":3",datapoint:"LEVEL"},function(b,d){if(b)c&&c(b);else if("undefined"==typeof d||null==d)c&&c(Error("get blind current value return invalid"));else{var f=d.value,f=Math.round(100*f);a.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get lamella current value return invalid")):(h=d.value+h,1<h&&(h=1),h=Math.round(100*h),e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,
function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","moveTo"+f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,
l.deviceIF,l.deviceAdr+":6","moveTo"+f,function(b,d){if(b)c&&c(b,d);else{var e=h/100;1<e&&(e=1);0>e&&(e=0);a.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",e,(new Date).getTime()+1E3);c&&c(b)}})})})})})}))})}});break;case "lamellaStepDown":h=h?parseInt(h)/100:.05;a.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,d){if(b)c&&c(b);else if("undefined"==typeof d||null==d)c&&c(Error("get blind current value return invalid"));else{var f=d.value,f=Math.round(100*
f);a.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(b,d){b?c&&c(b):"undefined"==typeof d||null==d?c&&c(Error("get lamella current value return invalid")):(h=d.value-h,0>h&&(h=0),h=Math.round(100*h),e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","moveTo"+f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,
l.deviceAdr+":5","lamellaTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveTo"+f,function(b,d){if(b)c&&c(b,d);else{var e=h/100;1<e&&(e=1);0>e&&(e=0);a.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",e,(new Date).getTime()+
1E3);c&&c(b)}})})})})})}))})}});break;case "lamellaTo":if(!h){c&&c(Error("lamellaTo has no value"));break}a.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,d){if(b)c&&c(b);else if("undefined"==typeof d||null==d)c&&c(Error("get blind current value return invalid"));else{var f=d.value,f=Math.round(100*f);e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,
l.deviceAdr+":4","moveTo"+f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":5","moveTo"+f,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(b,d){b?c&&c(b,d):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,l.deviceAdr+":6","moveTo"+f,function(b,d){if(b)c&&c(b,d);else{var e=
h/100;1<e&&(e=1);0>e&&(e=0);a.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",e,(new Date).getTime()+1E3);c&&c(b)}})})})})})})}});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(f){case "ch4stop":d=this.deviceAdr+":4";break;case "ch5stop":d=this.deviceAdr+":5";break;case "ch6stop":d=this.deviceAdr+":6"}e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"stop",c);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(f){case "ch4moveUp":d=this.deviceAdr+":4";break;
case "ch5moveUp":d=this.deviceAdr+":5";break;case "ch6moveUp":d=this.deviceAdr+":6"}e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"moveUp",c);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(f){case "ch4moveDown":d=this.deviceAdr+":4";break;case "ch5moveDown":d=this.deviceAdr+":5";break;case "ch6moveDown":d=this.deviceAdr+":6"}e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"moveDown",c);break;case "ch4lamellaUp":case "ch5lamellaUp":case "ch6lamellaUp":switch(f){case "ch4lamellaUp":d=
this.deviceAdr+":4";break;case "ch5lamellaUp":d=this.deviceAdr+":5";break;case "ch6lamellaUp":d=this.deviceAdr+":6"}a.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(b,f){if(b)c&&c(b);else if("undefined"==typeof f||null==f)c&&c(Error("get blind current value return invalid"));else{var h=f.value,h=Math.round(100*h);e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,d,"lamellaUp",function(b,f){b?c&&c(b):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,d,"moveTo"+h,function(b,
d){c&&c(b,d)})})}});break;case "ch4lamellaDown":case "ch5lamellaDown":case "ch6lamellaDown":switch(f){case "ch4lamellaDown":d=this.deviceAdr+":4";break;case "ch5lamellaDown":d=this.deviceAdr+":5";break;case "ch6lamellaDown":d=this.deviceAdr+":6"}a.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(b,f){if(b)c&&c(b);else if("undefined"==typeof f||null==f)c&&c(Error("get blind current value return invalid"));else{var h=f.value,h=Math.round(100*h);e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,
l.deviceIF,d,"lamellaDown",function(b,f){b?c&&c(b):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,d,"moveTo"+h,function(b,d){c&&c(b,d)})})}});break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(f){case "ch4stepUp":d=this.deviceAdr+":4";break;case "ch5stepUp":d=this.deviceAdr+":5";break;case "ch6stepUp":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"stepUp"+h,c);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(f){case "ch4stepDown":d=
this.deviceAdr+":4";break;case "ch5stepDown":d=this.deviceAdr+":5";break;case "ch6stepDown":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"stepDown"+h,c);break;case "ch4lamellaStepUp":case "ch5lamellaStepUp":case "ch6lamellaStepUp":switch(f){case "ch4lamellaStepUp":d=this.deviceAdr+":4";break;case "ch5lamellaStepUp":d=this.deviceAdr+":5";break;case "ch6lamellaStepUp":d=this.deviceAdr+":6"}a.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(b,
f){if(b)c&&c(b);else if("undefined"==typeof f||null==f)c&&c(Error("get blind current value return invalid"));else{var k=f.value,k=Math.round(100*k);e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,d,"lamellaStepUp"+h,function(b,f){b?c&&c(b):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,d,"moveTo"+k,function(b,d){c&&c(b,d)})})}});break;case "ch4lamellaStepDown":case "ch5lamellaStepDown":case "ch6lamellaStepDown":switch(f){case "ch4lamellaStepDown":d=this.deviceAdr+":4";break;case "ch5lamellaStepDown":d=
this.deviceAdr+":5";break;case "ch6lamellaStepDown":d=this.deviceAdr+":6"}a.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(b,f){if(b)c&&c(b);else if("undefined"==typeof f||null==f)c&&c(Error("get blind current value return invalid"));else{var k=f.value,k=Math.round(100*k);e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,d,"lamellaStepDown"+h,function(b,f){b?c&&c(b):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,d,"moveTo"+k,function(b,d){c&&c(b,d)})})}});break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(f){case "ch4moveTo":d=
this.deviceAdr+":4";break;case "ch5moveTo":d=this.deviceAdr+":5";break;case "ch6moveTo":d=this.deviceAdr+":6"}e.SHUTTER_VIRTUAL_RECEIVER.executeCommand(a,this.deviceIF,d,"moveTo"+h,c);break;case "ch4lamellaTo":case "ch5lamellaTo":case "ch6lamellaTo":switch(f){case "ch4lamellaTo":d=this.deviceAdr+":4";break;case "ch5lamellaTo":d=this.deviceAdr+":5";break;case "ch6lamellaTo":d=this.deviceAdr+":6"}a.getState({interface:this.deviceIF,channel:d,datapoint:"LEVEL"},function(b,f){if(b)c&&c(b);else if("undefined"==
typeof f||null==f)c&&c(Error("get blind current value return invalid"));else{var k=f.value,k=Math.round(100*k);e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,d,"lamellaTo"+h,function(b,f){b?c&&c(b):e.BLIND_VIRTUAL_RECEIVER.executeCommand(a,l.deviceIF,d,"moveTo"+k,function(b,d){c&&c(b,d)})})}});break;default:c&&c(Error("no such command"))}};H.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");
-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==a){if("UNREACH"==b)return e.MAINTENANCE.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(3==a){if(c=e.BLIND_TRANSMITTER.parseDptState(b,c))d={},"LEVEL"==b?d.blindLevel=c.blindTPos:"LEVEL_2"==b&&(d.lamellaLevel=c.lamellaTPos);return d}if(4==a||5==a||6==a){if(c=e.BLIND_VIRTUAL_RECEIVER.parseDptState(b,c))switch(d={},parseInt(a)){case 4:"LEVEL"==b?d.ch4blindLevel=c.blindPos:"LEVEL_2"==
b&&(d.ch4lamellaLevel=c.lamellaPos);break;case 5:"LEVEL"==b?d.ch5blindLevel=c.blindPos:"LEVEL_2"==b&&(d.ch5lamellaLevel=c.lamellaPos);break;case 6:"LEVEL"==b?d.ch6blindLevel=c.blindPos:"LEVEL_2"==b&&(d.ch6lamellaLevel=c.lamellaPos)}return d}return null};H.prototype.getConfig=function(a,b){var c=this.deviceAdr+":3";a.getParamset(this.deviceIF,c,"MASTER",function(d,a){if(d)b&&b(d);else{var e={},g=null;a&&(g={CHANGE_OVER_DELAY:a.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:a.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:a.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:a.REFERENCE_RUN_COUNTER});e[c]=g;b&&b(d,e)}})};H.prototype.setConfig=function(a,b,c){if(b){var d=
this.deviceAdr+":3";if(b=b[d]){var e={};e.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};e.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};e.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
e.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};e.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_UNIT};e.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_VALUE};a.setParamset(this.deviceIF,d,"MASTER",e,function(b){c&&c(b)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};var ea=function(a,
b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_presence"};util.inherits(ea,k);ea.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(c){a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.PRESENCEDETECTOR_TRANSCEIVER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":1",dpt:c})});return a};ea.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,
dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":case "sabotage":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "state":case "illumination":case "current_illumination":case "active":c.channel=b+":1";c.dataPoint=d.PRESENCEDETECTOR_TRANSCEIVER.getDptFromState(a);break;default:return null}return c};ea.prototype.executeCommand=function(a,b,c){var d=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "reset":case "activate":case "deactivate":case "toggleActivate":d.PRESENCEDETECTOR_TRANSCEIVER.executeCommand(a,
this.deviceIF,this.deviceAdr+":1",b,c);break;default:c&&c(Error("no such command"))}};ea.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==b)return d.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==
a?d.PRESENCEDETECTOR_TRANSCEIVER.parseDptState(b,c):null};var wa=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_floor_heater"};util.inherits(wa,k);wa.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_TRANSCEIVER.getReadableDpts();c&&c.forEach(function(c){a.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});return a};wa.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},
d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "cl_f_humidityLimiter":case "cl_f_emergencyOP":case "cl_f_frostProtection":case "cl_f_state":case "cl_f_dewPointAlarm":case "cl_f_externalClock":c.channel=b+":"+this.channel;c.dataPoint=d.CLIMATECONTROL_FLOOR_TRANSCEIVER.getDptFromState(a);break;default:return null}return c};wa.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&
(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];return a==this.channel?d.CLIMATECONTROL_FLOOR_TRANSCEIVER.parseDptState(b,c):null};var xa=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_floor_pump_heater"};util.inherits(xa,k);xa.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getReadableDpts();c&&c.forEach(function(c){a.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});
return a};xa.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "cl_fp_humidityLimiter":case "cl_fp_emergencyOP":case "cl_fp_frostProtection":case "cl_fp_state":case "cl_fp_dewPointAlarm":case "cl_fp_externalClock":c.channel=b+":"+this.channel;c.dataPoint=d.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getDptFromState(a);break;default:return null}return c};xa.prototype.parseDptState=function(a,b,c){var d=
a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];return a==this.channel?d.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.parseDptState(b,c):null};var ya=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_weather"};util.inherits(ya,k);ya.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=
c.MAINTENANCE_BAT_CL.getReadableDpts();d&&d.forEach(function(c){a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.WEATHER_TRANSMIT.getReadableDpts())&&d.forEach(function(c){-1==c.indexOf("RAIN")&&-1==c.indexOf("WIND_DIR")&&a.push({channel:b.deviceAdr+":1",dpt:c})});return a};ya.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(a);
break;default:c.channel=b+":1";a=d.WEATHER_TRANSMIT.getDptFromState(a);if(!a)return null;c.dataPoint=a}return c};ya.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE_BAT_CL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==
a?d.WEATHER_TRANSMIT.parseDptState(b,c):null};var za=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_weather2"};util.inherits(za,k);za.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_CL.getReadableDpts();d&&d.forEach(function(c){a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.WEATHER_TRANSMIT.getReadableDpts())&&d.forEach(function(c){-1==c.indexOf("WIND_DIR")&&a.push({channel:b.deviceAdr+":1",dpt:c})});return a};za.prototype._getDptFromRef=
function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(a);break;default:c.channel=b+":1";a=d.WEATHER_TRANSMIT.getDptFromState(a);if(!a)return null;c.dataPoint=a}return c};za.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");
-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE_BAT_CL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==a?d.WEATHER_TRANSMIT.parseDptState(b,c):null};var Aa=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_weather3"};util.inherits(Aa,k);Aa.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_CL.getReadableDpts();
d&&d.forEach(function(c){a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.CLIMATE_TRANSCEIVER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":1",dpt:c})});return a};Aa.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(a);break;default:c.channel=b+":1";a=d.CLIMATE_TRANSCEIVER.getDptFromState(a);
if(!a)return null;c.dataPoint=a}return c};Aa.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE_BAT_CL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==a?d.CLIMATE_TRANSCEIVER.parseDptState(b,c):null};var Ba=
function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_weather4"};util.inherits(Ba,k);Ba.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_CL.getReadableDpts();d&&d.forEach(function(c){a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.WEATHER_TRANSMIT.getReadableDpts())&&d.forEach(function(c){-1==c.indexOf("WIND_DIR")&&a.push({channel:b.deviceAdr+":1",dpt:c})});return a};Ba.prototype._getDptFromRef=function(a){var b=this.deviceAdr,
c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(a);break;default:c.channel=b+":1";a=d.WEATHER_TRANSMIT.getDptFromState(a);if(!a)return null;c.dataPoint=a}return c};Ba.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,
d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE_BAT_CL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==a?d.WEATHER_TRANSMIT.parseDptState(b,c):null};var fa=function(a,b,c){k.call(this,a,b,c);this.channel=2;this.legacyType="ip_direction"};util.inherits(fa,k);fa.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_EL.getReadableDpts();d&&d.forEach(function(c){a.push({channel:b.deviceAdr+
":0",dpt:c})});(d=c.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":2",dpt:c});a.push({channel:b.deviceAdr+":3",dpt:c})});return a};fa.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(a);break;case "ch2State":c.channel=b+":2";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch3State":c.channel=b+":3";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":c.channel=b+":4";c.dataPoint=d.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;default:c.channel=b+":2";a=d.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getDptFromState(a);if(!a)return null;c.dataPoint=a}return c};fa.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");
-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(2==a){if(b=e.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(b,c))d={},"undefined"!=typeof b.current_direction&&(d.current_passage_r2l=b.current_direction),"undefined"!=typeof b.last_direction&&(d.last_passage_r2l=b.last_direction),"undefined"!=typeof b.passage_counter&&
(d.r2l_passage_counter=b.passage_counter),"undefined"!=typeof b.passage_counter_overflow&&(d.r2l_passage_counter_overflow=b.passage_counter_overflow);return d}if(3==a){if(b=e.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(b,c))d={},"undefined"!=typeof b.current_direction&&(d.current_passage_l2r=b.current_direction),"undefined"!=typeof b.last_direction&&(d.last_passage_l2r=b.last_direction),"undefined"!=typeof b.passage_counter&&(d.l2r_passage_counter=b.passage_counter),"undefined"!=typeof b.passage_counter_overflow&&
(d.l2r_passage_counter_overflow=b.passage_counter_overflow);return d}return null};fa.prototype.parseStates=function(a){var b={},c;for(c in a){var d=this.parseChnState(c,a[c]);d&&(b=x.hub.m.hm._Util.mergeObj(b,d))}b.current_passage_r2l&&b.current_passage_l2r&&(b.current_direction=b.current_passage_r2l.value?{value:"right_to_left",time:b.current_passage_r2l.time}:{value:"left_to_right",time:b.current_passage_l2r.time});b.last_passage_r2l&&b.last_passage_l2r&&(b.last_direction=b.last_passage_r2l.value?
{value:"right_to_left",time:b.last_passage_r2l.time}:{value:"left_to_right",time:b.last_passage_l2r.time});delete b.current_passage_r2l;delete b.current_passage_l2r;delete b.last_passage_r2l;delete b.last_passage_l2r;return b};var I=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_button8"};util.inherits(I,k);I.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&a.push({channel:b.deviceAdr+
":0",dpt:c})});return a};I.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_EL.getDptFromState(a);break;default:return null}return c};I.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,
d));if(e!=f)return null;e=x.hub.m.hm._Channel["HmIP-RF"];d=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);d={};d["0_"+b.toLowerCase()]=c;return d}if(1==a||2==a||3==a||4==a||5==a||6==a||7==a||8==a)if(b=e.KEY_TRANRECEIVER.parseDptState(b,c))d||(d={}),b.pressShort&&(d["btn"+a+"pressShort"]=!0),b.pressLong&&(d["btn"+a+"pressLong"]=!0);return d};I.prototype.isButton=function(){return!0};I.prototype.claimEvent=function(a,b){var c=this.deviceAdr;-1==c.indexOf(":")&&
this.channel&&(c+=":"+this.channel);var d=this;this._claimButtonEvent(1,a,function(){d._claimButtonEvent(2,a,function(){d._claimButtonEvent(3,a,function(){d._claimButtonEvent(4,a,function(){d._claimButtonEvent(5,a,function(){d._claimButtonEvent(6,a,function(){d._claimButtonEvent(7,a,function(){d._claimButtonEvent(8,a,function(){b&&b()})})})})})})})})};I.prototype._claimButtonEvent=function(a,b,c){var d=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+a,"PRESS_SHORT",function(e,f){e&&console.error("button:"+
a+" claim PRESS_SHORT event error:"+e.stack);b.reportValueUsage(d.deviceIF,d.deviceAdr+":"+a,"PRESS_LONG",function(b,d){b&&console.error("button:"+a+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};var Ca=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_generic_input"};util.inherits(Ca,k);Ca.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].GENERIC_INPUT_TRANSMITER.getReadableDpts();c&&c.forEach(function(c){a.push({channel:b.deviceAdr+
":"+b.channel,dpt:c})});return a};Ca.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){default:c.channel=b+":"+this.channel;a=d.GENERIC_INPUT_TRANSMITER.getDptFromState(a);if(!a)return null;c.dataPoint=a}return c};Ca.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,
d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];return a==this.channel?d.GENERIC_INPUT_TRANSMITER.parseDptState(b,c):null};var ga=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_analog_output"};util.inherits(ga,k);ga.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.getReadableDpts();c&&c.forEach(function(c){a.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});return a};ga.prototype._getDptFromRef=function(a){var b=
this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "outputLevel":c.channel=b+":"+this.channel;c.dataPoint=d.ANALOG_OUTPUT_TRANSCEIVER.getDptFromState("outputLevel");break;default:return null}return c};ga.prototype.executeCommand=function(a,b,c){x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.executeCommand(a,this.deviceIF,this.deviceAdr+":"+this.channel,b,function(b,a){c&&c(b,a)})};ga.prototype.parseDptState=function(a,b,c){var d=
a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;a==this.channel&&(e=d.ANALOG_OUTPUT_TRANSCEIVER.parseDptState(b,c));return e};var Da=function(a,b,c){k.call(this,a,b,c);this.channel=1;this.legacyType="ip_water"};util.inherits(Da,k);Da.prototype._getReadableDpts=function(){var a=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],d=c.MAINTENANCE_BAT_CL.getReadableDpts();
d&&d.forEach(function(c){a.push({channel:b.deviceAdr+":0",dpt:c})});(d=c.WATER_DETECTION_TRANSMITTER.getReadableDpts())&&d.forEach(function(c){a.push({channel:b.deviceAdr+":1",dpt:c})});return a};Da.prototype._getDptFromRef=function(a){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},d=x.hub.m.hm._Channel["HmIP-RF"];switch(a){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=d.MAINTENANCE_BAT_CL.getDptFromState(a);break;case "alarm":case "moisture":case "water":c.channel=
b+":1";c.dataPoint=d.WATER_DETECTION_TRANSMITTER.getDptFromState(a);break;default:return null}return c};Da.prototype.parseDptState=function(a,b,c){var d=a.indexOf(":");if(-1==d)return null;var e=a.substr(0,d);a=a.substr(d+1);var f=this.deviceAdr,d=this.deviceAdr.indexOf(":");-1!=d&&(f=this.deviceAdr.substr(0,d));if(e!=f)return null;d=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==a){if("UNREACH"==b||"LOW_BAT"==b)return d.MAINTENANCE_BAT_CL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==
a?d.WATER_DETECTION_TRANSMITTER.parseDptState(b,c):null};var v={};v.CLASS_MAP={maintenance:e,button:h,vbutton:a,switch:f,dimmer:q,blind:p,powerswitch:l,weather:n,heater:t,heater2:u,heater3:w,wallthermo:M,wallthermo2:N,contact:ha,weatherstation:r,rain:O,gong:z,gong2:Ea,window:ia,temp:ja,co2:la,motion:ma,smoke:na,siren:P,capacity:oa,switch_interface:J,tilt:pa,temp2:ka,water:qa,weather2:m,energymeter:ra,rgb:K,lux:sa,siren2:Q,jalousie:R,mod_em_8bit:A,mod_em_8:B,keymatic:S,ou_led16:C,hm_dis_ep_wm55:Fa,
dualwhite:T};v.CLASS_MAP_IP={ip_switch:Ga,ip_contact:ta,ip_heater:U,ip_powerswitch:V,ip_energyactor:W,ip_dimmer:Y,ip_motion:ba,ip_motion2:D,ip_button2:L,ip_siren:ca,ip_wallthermo:y,ip_smoke:da,ip_window:va,ip_button4:E,ip_dimmer2:Z,ip_energyactor2:X,ip_blind:G,ip_jalousie:H,ip_presence:ea,ip_dimmer3:aa,ip_wallthermo2:ua,ip_floor_heater:wa,ip_floor_pump_heater:xa,ip_button6:F,ip_weather:ya,ip_weather2:za,ip_weather3:Aa,ip_weather4:Ba,ip_direction:fa,ip_button8:I,ip_generic_input:Ca,ip_analog_output:ga,
ip_water:Da};v.parseJson=function(a){if(!(a&&a.type&&a.interface&&a.address))return null;switch(a.interface){case "BidCos-RF":a=this._parseRFDeviceJson(a);break;case "HmIP-RF":a=this._parseIPDeviceJson(a);break;default:return null}return a};v._parseRFDeviceJson=function(a){var b=x.hub.m.hm.RFDeviceTypes[a.type];if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.RFDeviceCatagory[b];if(!b||!b.type)return null;var c=this.CLASS_MAP[b.type];if(!c)return null;var b=null,d=a.address.indexOf(":");
-1!=d&&(b=a.address.substr(d+1));"HM-Dis-EP-WM55"==a.type&&3==b&&(c=this.CLASS_MAP.hm_dis_ep_wm55);a=new c(a.type,a.interface,a.address);b&&(a.channel=parseInt(b));return a};v._parseIPDeviceJson=function(a){if("HmIP-MIOB"==a.type)return v._parse_HMIP_MIOB(a);var b=v._getIPMetaIndex(a.type);if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.IPDeviceCatagory[b];if(!b||!b.type)return null;var c=this.CLASS_MAP_IP[b.type];if(!c)return null;var b=null,d=a.address.indexOf(":");-1!=d&&(b=a.address.substr(d+
1));a=new c(a.type,a.interface,a.address);b&&(a.channel=parseInt(b));return a};v._parse_HMIP_MIOB=function(a){var b=a.address,c=null,d=a.address.indexOf(":");-1!=d&&(b=a.address.substr(0,d),c=a.address.substr(d+1));d=null;0==c?d=this.CLASS_MAP.maintenance:3==c||7==c?d=this.CLASS_MAP_IP.ip_switch:9==c||10==c?d=this.CLASS_MAP_IP.ip_generic_input:11==c&&(d=this.CLASS_MAP_IP.ip_analog_output);return d?(a=new d(a.type,a.interface,b),a.channel=c,a):null};v.resolve=function(a){if(!a||!a.type||!a.interface)return null;
switch(a.interface){case "BidCos-RF":a=this._resolveRFFromType(a.type,a);break;case "HmIP-RF":a=this._resolveIPFromType(a.type,a);break;default:return null}return a?Array.isArray(a)?a:[a]:null};v._resolveRFFromType=function(a,b){if("HM-MOD-EM-8"==a)return this._resolve_HM_MOD_EM_8(a,b);if("HM-OU-LED16"==a)return this._resolve_HM_OU_LED16(a,b);if("HM-Dis-EP-WM55"==a)return this._resolve_HM_Dis_EP_WM55(a,b);var c=x.hub.m.hm.RFDeviceTypes[a];if("undefined"==typeof c||null==c)return null;c=x.hub.m.hm.RFDeviceCatagory[c];
if(!c||!c.type)return this._resolveRFFromTypeGeneral(a,b);var d=[];if(b.channels)for(var e in b.channels){var f=b.channels[e];f.type==c.channel&&d.push(f)}var h=this.CLASS_MAP[c.type];if(!h)return null;if("*"==c.channelNum){var k=[];d.forEach(function(c){var e=new h(a,b.interface,b.address),f=c.address.indexOf(":");1<d.length&&(e.deviceAdr=c.address);e.channel=c.address.substr(f+1);k.push(e)});return k}e=new h(a,b.interface,b.address);"undefined"!=typeof c.channelNum&&null!=c.channelNum&&(e.channel=
c.channelNum);return e};v._resolveIPFromType=function(a,b){if(0==a.indexOf("HmIP-FAL"))return v._resolve_HMIP_FAL_X(a,b);if(0==a.indexOf("HmIP-MIOB"))return v._resolve_HMIP_MIOB(a,b);var c=this._getIPMetaIndex(a);if("undefined"==typeof c||null==c)return null;c=x.hub.m.hm.IPDeviceCatagory[c];if(!c||!c.type)return null;var d=[];if(b.channels)for(var e in b.channels){var f=b.channels[e];f.type==c.channel&&d.push(f)}var h=this.CLASS_MAP_IP[c.type];if(!h)return null;if("*"==c.channelNum){var k=[];d.forEach(function(c){var e=
new h(a,b.interface,b.address),f=c.address.indexOf(":");1<d.length&&(e.deviceAdr=c.address);e.channel=c.address.substr(f+1);k.push(e)});return k}e=new h(a,b.interface,b.address);"undefined"!=typeof c.channelNum&&null!=c.channelNum&&(e.channel=c.channelNum);return e};v._resolveRFFromTypeGeneral=function(a,b){var c=[];if(!b||!b.channels)return null;var d=b.channels,e;for(e in d){var f=d[e];if(f&&f.type&&x.hub.m.hm._Channel["BidCos-RF"][f.type]&&(f=x.hub.m.hm._Channel["BidCos-RF"][f.type].device)&&(f=
this.CLASS_MAP[f])){var f=new f(a,b.interface,e),h=e.indexOf(":");f.channel=e.substr(h+1);c.push(f)}}return c};v._resolve_HM_MOD_EM_8=function(a,b){var c=[];if(!b||!b.channels)return null;var d=b.channels,e;for(e in d){var d=e.indexOf(":"),d=e.substr(d+1),f=new (0==d?this.CLASS_MAP.maintenance:this.CLASS_MAP.mod_em_8)(a,b.interface,e);f.channel=d;c.push(f)}return c};v._resolve_HM_OU_LED16=function(a,b){var c=[];if(!b||!b.channels)return null;var d=b.channels,e;for(e in d){var d=e.indexOf(":"),d=e.substr(d+
1),f=new (0==d?this.CLASS_MAP.maintenance:this.CLASS_MAP.ou_led16)(a,b.interface,e);f.channel=d;c.push(f)}return c};v._resolve_HM_Dis_EP_WM55=function(a,b){var c=[];if(!b||!b.channels)return null;var d=b.channels,e;for(e in d){var d=e.indexOf(":"),d=e.substr(d+1),f=null;0==d?f=this.CLASS_MAP.maintenance:1==d||2==d?f=this.CLASS_MAP.button:3==d&&(f=this.CLASS_MAP.hm_dis_ep_wm55);f&&(f=new f(a,b.interface,e),f.channel=d,c.push(f))}return c};v._resolve_HMIP_FAL_X=function(a,b){var c=[];if(!b||!b.channels)return null;
var d=b.channels,e;for(e in d){var f=d[e],h=e.indexOf(":"),h=e.substr(h+1),k;0==h?k=this.CLASS_MAP.maintenance:"CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER"==f.type?k=this.CLASS_MAP_IP.ip_floor_pump_heater:"CLIMATECONTROL_FLOOR_TRANSCEIVER"==f.type&&(k=this.CLASS_MAP_IP.ip_floor_heater);k&&(f=new k(a,b.interface,e),f.channel=h,c.push(f))}return c};v._resolve_HMIP_MIOB=function(a,b){var c=[];if(!b||!b.channels)return null;var d=b.channels,e;for(e in d){var d=e.indexOf(":"),d=e.substr(d+1),f=null;0==d?f=
this.CLASS_MAP.maintenance:3==d||7==d?f=this.CLASS_MAP_IP.ip_switch:9==d||10==d?f=this.CLASS_MAP_IP.ip_generic_input:11==d&&(f=this.CLASS_MAP_IP.ip_analog_output);f&&(f=new f(a,b.interface,e),f.channel=d,c.push(f))}return c};v._getIPMetaIndex=function(a){for(var b in x.hub.m.hm.IPDeviceTypes)if(x.hub.m.hm.IPDeviceTypes.hasOwnProperty(b)&&b.toUpperCase()==a.toUpperCase())return x.hub.m.hm.IPDeviceTypes[b];return null};return v}();
x.hub.m.hm.Manager=function(){var k=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager");this._gateway=e;this._devices={};this._meta={}};k.prototype.init=function(e){x.hub.m.hm._Util.isIP(this._gateway.ip)?(this._logger.log("info","start connect monitor to "+this._gateway.ip),this._startMonitor(e)):e&&e()};k.prototype.onDeviceEvent=function(e){var h=function(a,e){var f=null;if(!e||0==e.length)return null;e.forEach(function(e){e&&e.key==a&&(f=e)});return f};if(!e||!e.device)return null;
var a=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!a)return null;var f=e.device;f.hsstype=f.type;if(f.channels)for(var k in f.channels)if(f.channels.hasOwnProperty(k)){var p=f.channels[k];p.hsstype=p.type}f=a._parseDevice(f);if(!f||0==f.length)return null;var l;1==f.length?l=f[0]:f.forEach(function(a){if("HmIP-Wired"==e.interface&&"HmIP-Wired"==a.interface){if(0==e.channel.indexOf(a.address)){var f=e.channel.split(":")[1];if(a.channels)for(var h in a.channels)if(a.channels[h].address==f){l=
a;break}}}else a.address==e.channel&&(l=a)});if(!l)return null;var f=x.hub.m.hm._Util.getDeviceHashCode(l),n=a.resolveState(l,e,e.oldValue.value),a=a.resolveState(l,e,e.value.value);if(!a)return null;var m=[];Array.isArray(a)?a.forEach(function(a){var e=h(a.key,n);m.push({device:l,gateway:this._gateway,data:{key:a.key,value:a.value,changed:e?a.value!=e.value:!0,oldValue:e?e.value:void 0}})}.bind(this)):m.push({device:l,gateway:this._gateway,data:{key:a.key,value:a.value,changed:a.value!=n.value,oldValue:n.value}});
this._generateEvent(f,m)};k.prototype._generateEvent=function(e,h){var a=require("x.hub.eventbus.js"),f=this._meta[e];if(f&&0<f.length)for(var k=0;k<f.length;k++){var p=f[k];if(p)for(var l=0;l<h.length;l++){var n=h[l];n&&n.data&&(n.data.key==p.statusKey||"*"==n.data.key)&&a.emit("status",{module:"hm",device:n.device,gateway:n.gateway,data:n.data},p)}}};k.prototype.addStateDevice=function(e,h,a){if(e){e=JSON.parse(JSON.stringify(e));var f=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[f]||(delete e.gateway,
this._devices[f]=e);this._meta[f]||(this._meta[f]=[]);a&&this._meta[f].push(a);h&&h()}else h&&h(Error("device json invalid"))};k.prototype.removeStateDevice=function(e,h,a){if(!e)h&&h(Error("device json invalid"));else if(a){e=JSON.parse(JSON.stringify(e));e=x.hub.m.hm._Util.getDeviceHashCode(e);var f=this._meta[e];if(f){for(var k=-1,p=0;p<f.length;p++){var l=f[p];if(l&&"taskman"==l.src&&"taskman"==a.src&&l.taskID==a.taskID&&l.statusKey==a.statusKey){k=p;break}}0<=k&&f.splice(k,1);0==f.length&&(delete this._devices[e],
delete this._meta[e])}h&&h()}};k.prototype.getAllStates=function(){var e=[],h;for(h in this._devices)if(this._devices.hasOwnProperty(h)){var a=this._devices[h];a&&a.device&&(a=this.getStates(a.device))&&e.push(a)}return e};k.prototype.getStates=function(e){if(!e)return null;e=JSON.parse(JSON.stringify(e));var h=x.hub.m.hm._Util.getDeviceHashCode(e),a=this._devices[h];a||this.addStateDevice(e);var f=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!f)return null;
var k={},a=this._devices[h],p;for(p in a.states)h=f.getBufferedState(a.states[p]),k[p]=this._resolveRawState(e,p,h);return{device:e,gateway:this._gateway,states:k}};k.prototype.updateStates=function(e,h){if(e){e=JSON.parse(JSON.stringify(e));var a=x.hub.m.hm._Util.getDeviceHashCode(e),f=this._devices[a];f||this.addStateDevice(e);f=this._devices[a];this._updateStates(e,f.states,h)}else h&&h(Error("device json is null"))};k.prototype.getState=function(e,h,a){if(!e||!h)return a&&a(Error("argument invalid")),
null;if("SysVar"==e.type||"CUxD"==e["interface"])x.hub.m.hm.HM_MODULE.doStatus("var",this._gateway,e,{value:h},function(e,f){if(e)a&&a(e);else if(f){var h={value:f.status,time:(new Date).getTime()};a&&a(null,h)}else a&&a(Error("get sys var status return null"))});else{e=JSON.parse(JSON.stringify(e));var f=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[f]||this.addStateDevice(e);f=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!f)return a&&a(Error("no monitor for gateway")),
null;var k=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!k)return a&&a(Error("gateway json invalid")),null;var p=k.resolveDatapointInfo(e,h);if(!p)return a&&a(Error("device json or state ref invalid")),null;f.getState(p,function(f,n){if(f)a&&a(f);else if(n){var m=k.resolveState(e,p,n.value),r;m?Array.isArray(m)?m.forEach(function(a){a&&a.key==h&&(r={value:a.value,time:n.time})}):r={value:m.value,time:n.time}:r={value:m,time:n.time};a&&a(null,r)}else a&&a(null,null)})}};k.prototype.executeCommand=
function(e,h,a){var f=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!f)return a&&a(Error("gateway json invalid")),null;f.executeCommandCreator(e,h,a)};k.prototype.updateState=function(e,h,a){if(!e||!h)return a&&a(Error("argument invalid")),null;e=JSON.parse(JSON.stringify(e));var f=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[f]||this.addStateDevice(e);f=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!f)return a&&a(Error("no monitor for gateway")),
null;var k=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!k)return a&&a(Error("gateway json invalid")),null;var p=k.resolveDatapointInfo(e,h);if(!p)return a&&a(Error("device json or state ref invalid")),null;f.updateState(p,function(f,n){if(f)a&&a(f);else{var m=k.resolveState(e,p,n),r;m?Array.isArray(m)?m.forEach(function(a){a&&a.key==h&&(r={value:a.value})}):r={value:m.value}:r={value:m};a&&a(null,r)}})};k.prototype._startMonitor=function(e){require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,
{persistant:!0},e)};k.prototype._updateStates=function(e,h,a){var f=this;require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,{persistant:!0},function(k){k?a&&a(k):f._getStateByScript(e,h,a)})};k.prototype._resolveDetailDpt=function(e){var h=require("xnm.aio.hm.js").devicemanager,a=h.applyUIFilter(e,{catagory:"status",elems:"*"}),f=a?a.status:null,h=(a=h.applyUIFilter(e,{catagory:"command",elems:"*"}))?a.command:null,a={states:{},commands:{}};if(f&&0<=f.length)for(var k=0;k<f.length;k++){var p=
f[k],l=this._resolveDatapointRef(e,p.ref.value,!1);l&&(a.states[p.ref.value]=l)}if(h&&0<=h.length)for(k=0;k<h.length;k++)f=h[k],(l=this._resolveDatapointRef(e,f.ref.value,!0))&&(a.commands[f.ref.value]=l);return a};k.prototype.learnRFDevice=function(e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnRF(function(a,f){if(a)e&&e(a);else{var h=[],k=new x.hub.m.hm.HM_MODULE.CCU,l;for(l in f){var n=f[l];n.hsstype=n.type;if(n.channels)for(l in n.channels)n.channels[l].hsstype=
n.channels[l].type;(n=k._parseDevice(n))&&(h=h.concat(n))}e&&e(null,h)}}):e&&e(Error("monitor not started"))};k.prototype.learnIPDevice=function(e,h,a){var f=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);f?f.learnIP(e,h,function(e,f){if(e)a&&a(e);else{var h=[],k=new x.hub.m.hm.HM_MODULE.CCU,m;for(m in f){var r=f[m];r.hsstype=r.type;if(r.channels)for(m in r.channels)r.channels[m].hsstype=r.channels[m].type;(r=k._parseDevice(r))&&(h=h.concat(r))}a&&a(null,
h)}}):a&&a(Error("monitor not started"))};k.prototype.learnIPDeviceQR=function(e,h){var a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);a?a.learnIPQR(e,function(a,e){if(a)h&&h(a);else{var k=[],l=new x.hub.m.hm.HM_MODULE.CCU,n;for(n in e){var m=e[n];m.hsstype=m.type;if(m.channels)for(n in m.channels)m.channels[n].hsstype=m.channels[n].type;(m=l._parseDevice(m))&&(k=k.concat(m))}h&&h(null,k)}}):h&&h(Error("monitor not started"))};k.prototype.deleteDevice=function(e,
h,a){var f=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);f?f.deleteDevice(e,h,a):a&&a(Error("monitor not started"))};k.prototype.getRFInterfaces=function(e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.getRFInterfaces(e):e&&e(Error("monitor not started"))};return k}();x.hub.m.hm.ChipManager=function(k){x.hub.m.hm.Manager.call(this,k);this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager.ChipManager")};
util.inherits(x.hub.m.hm.ChipManager,x.hub.m.hm.Manager);x.hub.m.hm.ChipManager.prototype.init=function(k){if(x.hub.m.hm._Util.isIP(this._gateway.ip)){this._logger.log("info","start connect monitor to "+this._gateway.ip);var e=this,h=require("x.hub.m.hm.js")._monitorManager;h.startMonitor(this._gateway,{localChip:"chip",persistant:!0},function(a){var f=h.getMonitor(e._gateway.ip,e._gateway.uuid);if(f)f.on("new_devices",e._onNewDevices.bind(e));k&&k(a)},!0,!0)}else k&&k()};
x.hub.m.hm.ChipManager.prototype.reset=function(k){var e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!e)return k&&k(Error("no chip monitor")),null;e.reset(k)};
x.hub.m.hm.ChipManager.prototype.executeCommand=function(k,e,h){if(k&&k.address&&e)if(k=k.address.split("."),3>k.length)h&&h({error:Error("address invalid")});else{var a={type:k[0],interface:k[1],address:k[2]};k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return h&&h(Error("no chip monitor")),null;(a=x.hub.m.hm._Device.parseJson(a))?a.executeCommand(k,e.value,h):h&&h(Error("unknow device"))}else h&&h(Error("argument invalid"))};
x.hub.m.hm.ChipManager.prototype.getState=function(k,e,h){if(!k||!k.address||!e)return h&&h(Error("argument invalid")),null;k=k.address.split(".");if(3>k.length)h&&h(Error("address invalid"));else{var a={type:k[0],interface:k[1],address:k[2]};k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return h&&h(Error("no chip monitor")),null;(a=x.hub.m.hm._Device.parseJson(a))?a.getState(k,e.value,h):h&&h(Error("unknow device"))}};
x.hub.m.hm.ChipManager.prototype.getBufferedStateLegacy=function(k,e){if(!k)return null;var h=x.hub.m.hm._Device.resolve(k);if(!h||0==h.length)return null;var a;1==h.length?a=h[0]:h.forEach(function(f){f.deviceAdr==e&&(a=f)});if(!a)return null;var f;if(h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid)){var h=h.getAllBufferedStates(),q=a.deviceAdr,p=q.indexOf(":");-1!=p&&(q=q.substr(0,p));h[q]&&h[q].states&&(f=a.parseStates(h[q].states))}if(!f)return null;var h=
{type:"HM",adr:a.toLegacyAdr(),state:{}},l;for(l in f)h.state[l]=f[l].value;return h};
x.hub.m.hm.ChipManager.prototype.checkButtonEvent=function(k){if(!k||!k.device||!k.datapoint||0!=k.datapoint.indexOf("PRESS"))return null;var e=x.hub.m.hm._Device.resolve(k.device);if(!e||0==e.length)return null;var h;1==e.length?h=e[0]:e.forEach(function(a){a.deviceAdr==k.channel&&(h=a)});if(!h)return null;e=h.parseDptState(k.channel,k.datapoint,k.value.value);if(!e)return null;var a={type:"HM",adr:h.deviceType+"."+h.deviceIF+"."+h.deviceAdr,state:{},_ver:"v5+"},f=Object.keys(e);a.state[f[0]]=e[f[0]];
require("x.hub.eventbus.js").emit("gatewayevent",a,{address:"HM"},"BTN")};
x.hub.m.hm.ChipManager.prototype.onDeviceEvent=function(k){if(!k||!k.device)return null;var e=x.hub.m.hm._Device.resolve(k.device);if(!e||0==e.length)return null;var h;1==e.length?h=e[0]:e.forEach(function(a){a.deviceAdr==k.channel&&(h=a)});if(!h)return null;var a,e=h.parseDptState(k.channel,k.datapoint,k.oldValue.value);a=h.parseDptState(k.channel,k.datapoint,k.value.value);if(!a)return null;var f={sys:"aio",type:"HM",address:h.deviceType+"."+h.deviceIF+"."+h.deviceAdr},q=this._gateway,p={key:null,
value:null,changed:k.changed,oldValue:null},l=Object.keys(a);p.key=l[0];p.value=a[l[0]];p.oldValue=e?e[l[0]]:void 0;this._logger.log("debug","EVENT:\t"+f.address+"\t"+p.key+"\t"+p.value);return{device:f,gateway:q,data:p}};
x.hub.m.hm.ChipManager.prototype.learnRFDevice=function(k){var e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);e?e.learnRF(function(e,a){if(e)k&&k(e);else{var f=[],q;for(q in a){var p=x.hub.m.hm._Device.resolve(a[q]);p&&(f=f.concat(p))}k&&k(e,f)}}):k&&k(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnRFDeviceSN=function(k,e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnRFSN(k,function(a,f){if(a)e&&e(a);else{var h=[],k;for(k in f){var l=x.hub.m.hm._Device.resolve(f[k]);l&&(h=h.concat(l))}e&&e(a,h)}}):e&&e(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDevice=function(k,e,h){var a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);a?a.learnIP(k,e,function(a,e){if(a)h&&h(a);else{var k=[],l;for(l in e){var n=x.hub.m.hm._Device.resolve(e[l]);n&&(k=k.concat(n))}h&&h(a,k)}}):h&&h(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDeviceQR=function(k,e){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnIPQR(k,function(a,f){if(a)e&&e(a);else{var h=[],k;for(k in f){var l=x.hub.m.hm._Device.resolve(f[k]);l&&(h=h.concat(l))}e&&e(a,h)}}):e&&e(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.getAllBufferedStates=function(){var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return[];var k=k.getAllBufferedStates(),e=[],h;for(h in k){var a=k[h],f=x.hub.m.hm._Device.resolve(a.device);if(f)for(var q=0,p=f.length;q<p;q++){var l=f[q],n=l.parseStates(a.states);e.push({device:l,states:n})}}return e};
x.hub.m.hm.ChipManager.prototype.getConfig=function(k,e){if(k&&k.address){var h=k.address.split(".");if(3>h.length)e&&e({error:Error("address invalid")});else{var a={type:h[0],interface:h[1],address:h[2]},h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return e&&e(Error("no chip monitor")),null;(a=x.hub.m.hm._Device.parseJson(a))?a.getConfig(h,e):e&&e(Error("unknow device"))}}else e&&e(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype.setConfig=function(k,e,h){if(k&&k.address)if(k=k.address.split("."),3>k.length)h&&h({error:Error("address invalid")});else{var a={type:k[0],interface:k[1],address:k[2]};k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return h&&h(Error("no chip monitor")),null;(a=x.hub.m.hm._Device.parseJson(a))?a.setConfig(k,e,h):h&&h(Error("unknow device"))}else h&&h(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype._onNewDevices=function(k){var e=[],h;for(h in k)if(k.hasOwnProperty(h))var a=x.hub.m.hm._Device.resolve(k[h]).filter(function(a){return a&&a.isButton()}),e=e.concat(a);var f=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(f&&0<e.length){var q=0,p=function(){q++;q<e.length&&e[q].claimEvent(f,p)};e[q].claimEvent(f,p)}};
x.hub.m.hm.CCU2Discovery=function(){var k=function(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.CCU2Discovery");this._autoDiscoverTO=null;var h=this;this._hmHandlerCB=function(a,e){h._logger.log("debug","find ccu:"+a.uuid+"@"+a.ip+" from netif:"+e);h._searchCB&&h._searchCB(a,e);if(a.ip){var k=!1;h._searchTmpHMs.forEach(function(e){e.ip==a.ip&&(k=!0)});k||h._searchTmpHMs.push(a)}};this._searchCB=e;this._searchRunning=!1;this._searchTmpHMs=[];this._searchTmpCBs=[]};k.prototype.discover=
function(e){e&&-1==this._searchTmpCBs.indexOf(e)&&this._searchTmpCBs.push(e);if(!this._searchRunning){this._searchRunning=!0;this._searchTmpHMs=[];this._autoDiscoverTO&&(clearTimeout(this._autoDiscoverTO),this._autoDiscoverTO=null);require("xnm.aio.hm.js").discoverCCUs(this._hmHandlerCB);var h=this;setTimeout(function(){h._searchRunning=!1;h._autoDiscoverTO=setTimeout(function(){h.discover()},3E4);h._searchTmpCBs.forEach(function(a){a&&a(h._searchTmpHMs)});h._searchTmpCBs=[]},3E3)}};return k}();
x.hub.m.hm._Util={isDeviceJsonValid:function(k){return k&&k.type&&k.address&&k.interface},isGatewayJsonValid:function(k){return k&&k.ip},getDeviceHashCode:function(k){if(!k)return-1;var e=0,e=(e<<5)-e+this._getStringHashCode(k.type),e=(e<<5)-e+this._getStringHashCode(k.address);return e=(e<<5)-e+this._getStringHashCode(k.interface)},getGatewayHashCode:function(k){if(!k)return-1;var e=80;k.port&&((e=parseInt(k.port))||(e=80));var h=0,h=(h<<5)-h+this._getStringHashCode(k.ip),h=(h<<5)-h+e,h=(h<<5)-h+
this._getStringHashCode(k.uuid),h=(h<<5)-h+this._getStringHashCode(k.username);return h=(h<<5)-h+this._getStringHashCode(k.password)},getLocalIP:function(k,e){var h=function(a){return a?(a=a.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))?(+a[1]<<24)+(+a[2]<<16)+(+a[3]<<8)+ +a[4]:-1:-1};if("127.0.0.1"==e||"localhost"==e)return"127.0.0.1";var a=require("os").networkInterfaces(),f;for(f in a)if(a.hasOwnProperty(f))for(var q=a[f],p=0;p<q.length;p++){var l=q[p];if(l&&"IPv4"==l.family&&l.address){if(k==f||!k&&
!e)return l.address;if(!k&&l.netmask&&e){var n=h(l.netmask),m=h(l.address),r=h(e);if((m&n)==(r&n))return l.address}}}return null},getLocalMac:function(k){var e=require("os").networkInterfaces(),h;for(h in e)if(e.hasOwnProperty(h))for(var a=e[h],f=0;f<a.length;f++){var q=a[f];if(q&&"IPv4"==q.family&&q.address&&q.mac&&k==q.address)return q.mac}return"00:00:00:00:00:00"},isIP:function(k){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(k)},
mergeObj:function(k,e){var h={},a;for(a in k)k.hasOwnProperty(a)&&(h[a]=k[a]);for(a in e)e.hasOwnProperty(a)&&(h[a]=e[a]);return h},_getStringHashCode:function(k){var e=0,h,a,f;if("undefined"==typeof k||null==k)return-1;if(0===k.length)return e;h=0;for(f=k.length;h<f;h++)a=k.charCodeAt(h),e=(e<<5)-e+a;return e}};
x.hub.m.hm.UdpEventProducer=function(){var k=function(){this._pool={}};k.prototype.EVENT_TO=200;k.prototype.addSTAEvent=function(e){if(e&&e.adr){var h=(new Date).getTime(),a=e.adr,f=this._pool[a];f&&f.timeout&&clearTimeout(f.timeout);var k=this,f=setTimeout(function(){var e=k._pool[a];if(e&&e.states){var f=require("x.hub.eventbus.js");f.emit("gatewayevent",e.states,{address:"HM"},"STA");f.emit("udpevent",e.states,"STA")}},this.EVENT_TO);this._pool[a]={states:e,timestamp:h,timeout:f}}};return k}();
x.hub.m.hm.Handler=function(){var k=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Handler");var e=this;this._udpEvtProducer=new x.hub.m.hm.UdpEventProducer;this._discoveryCB=function(h,a){e._onFindHM(h,a)};this._monitorManager=this._discovery=null;this._managers={};this._chipManager=this._xmlrpcServer=null};util.inherits(k,EventEmitter);k.prototype.CCU=x.hub.m.hm.CCU;k.prototype.XMLRPCClient=x.hub.m.hm.Client;k.prototype.init=function(e){var h=this;if(localStorage){var a=!0;
"false"==localStorage.getItem("x.hub.m.hm.CCU_INIT_STATE")&&(a=!1);x.hub.m.hm.CCU_INIT_STATE=a}require("x.hub.eventbus.js").on("x.hub.m.hm.CCU_INIT_STATE",function(a){var e=!0;"false"==a&&(e=!1);x.hub.m.hm.CCU_INIT_STATE=e});this._discovery=new x.hub.m.hm.CCU2Discovery(this._discoveryCB);this._monitorManager=new x.hub.m.hm.MonitorManager;this._xmlrpcServer=new x.hub.m.hm.Server(global.HM_LOCAL_PORT);this._xmlrpcServer.start(function(a){a?(h._logger.log("warn","start homematic local server error with port:"+
h._xmlrpcServer.getPort()),h._logger.log("warn",a.stack),e&&e({error:a})):h._monitorManager.init(h._xmlrpcServer,function(a){a?e&&e({error:a}):global&&global.HM_CHIP?h._initChipManager(function(a){e&&e({error:a})}):e&&e({})})})};k.prototype.getSystems=function(){return["hm"]};k.prototype.addStateDevice=function(e,h,a){if(e)if(e.gateway&&"mediola"!=e.gateway.uuid)if(e.gateway.ip&&x.hub.m.hm._Util.isIP(e.gateway.ip))if(x.hub.m.hm._Util.isIP(e.gateway.ip)){var f=this._getManager(e.gateway);f?f.addStateDevice(e,
function(a){h&&h({error:a})},a):(f=this._addManager(e.gateway),f.init(function(a){}),f.addStateDevice(e,function(a){h&&h({error:a})},a))}else this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),h&&h({error:Error("gateway ip is url")});else h&&h({error:Error("gateway ip format invalid")});else h&&h();else h&&h({error:Error("device json format invalid")})};k.prototype.removeStateDevice=function(e,h,a){if(e)if(e.gateway&&"mediola"!=e.gateway.uuid)if(e.gateway.ip&&
x.hub.m.hm._Util.isIP(e.gateway.ip))if(x.hub.m.hm._Util.isIP(e.gateway.ip)){var f=this._getManager(e.gateway);f?f.removeStateDevice(e,function(a){h&&h({error:a})},a):h&&h({})}else this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),h&&h({error:Error("gateway ip is url")});else h&&h({error:Error("gateway ip format invalid")});else h&&h();else h&&h({error:Error("device json format invalid")})};k.prototype.getAllStates=function(){return this._chipManager?this._chipManager.getAllBufferedStates():
[]};k.prototype.getStates=function(e){if(!(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)))return null;var h=this._getManager(e.gateway);if(h)return h.getStates(e);h=this._addManager(e.gateway);h.init();return null};k.prototype.getState=function(e,h,a){if(!e)return a&&a({error:Error("device is null")}),null;if(!e.gateway||"mediola"==e.gateway.uuid){if(!this._chipManager){a&&a({error:Error("chip manager not inited")});return}return this._chipManager.getState(e,
{value:h},function(e,h){a&&a({error:e,data:h})})}if(!x.hub.m.hm._Util.isDeviceJsonValid(e)||!e.gateway||!x.hub.m.hm._Util.isGatewayJsonValid(e.gateway))return a&&a({error:Error("device json invalid")}),null;x.hub.m.hm.HM_MODULE.doStatus("xhub",e.gateway,e,{value:h},function(e,h){e?a&&a({error:e}):h?a&&a({data:{value:h.status}}):a&&a({error:Error("do status failed")})})};k.prototype.executeCommand=function(e,h,a){e?h?e.gateway&&"mediola"!=e.gateway.uuid?e.gateway?x.hub.m.hm.HM_MODULE.doCommand(e.gateway,
e,h,function(e){e?a&&a({error:e}):a&&a({})}):a&&a({error:Error("gateway is null")}):this._chipManager?this._chipManager.executeCommand(e,h,function(e){a&&a({error:e})}):a&&a({error:Error("chip manager not inited")}):a&&a({error:Error("command invalid")}):a&&a({error:Error("device is null")})};k.prototype.updateStates=function(e,h){if(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)){var a=this._getManager(e.gateway);a?a.updateStates(e,function(a,
e){h&&h({error:a,data:e})}):(a=this._addManager(e.gateway),a.init(function(f){f?h&&h({error:f}):a.updateStates(e,function(a,e){h&&h({error:a,data:e})})}))}else h&&h({error:Error("device json format invalid")})};k.prototype.checkDeviceMatch=function(e,h){if(!(h&&h.device&&e&&e.device))return!1;if(h.gateway&&"mediola"!=h.gateway.uuid){var a=x.hub.m.hm._Util.getDeviceHashCode(h.device),f=x.hub.m.hm._Util.getDeviceHashCode(e.device);return a==f}a=e.device.address;e.device.interface&&e.device.type&&(a=
e.device.type+"."+e.device.interface+"."+e.device.address);return a!=h.device.address?!1:!0};k.prototype._initChipManager=function(e){var h="127.0.0.1";global&&global.HM_CHIP&&(h=global.HM_CHIP);this._chipManager=new x.hub.m.hm.ChipManager({ip:h,username:global.HM_CHIP_USERNAME,password:global.HM_CHIP_PASSWORD,uuid:"mediola"});this._chipManager.init(e)};k.prototype._initCCU3Manager=function(e){this._addManager({ip:"127.0.0.1",type:3}).init(function(h){e&&e(h)})};k.prototype._discover=function(e){this._discovery.discover(e)};
k.prototype._onFindHM=function(e,h){this._logger.log("debug","find ccu:"+e.uuid+"@"+e.ip+" from netif:"+h);this._monitorManager.onFindHomeMatic(e.ip,h,e.uuid)};k.prototype._getManager=function(e){e=x.hub.m.hm._Util.getGatewayHashCode(e);return this._managers[e]};k.prototype._addManager=function(e){var h=x.hub.m.hm._Util.getGatewayHashCode(e);e=new x.hub.m.hm.Manager(e);return this._managers[h]=e};k.prototype.onDeviceEvent=function(e,h){this._logger.log("trace","receive device event:"+JSON.stringify(e));
require("x.hub.eventbus.js");if(h){if(this._chipManager){this._chipManager.checkButtonEvent(e);var a=this._chipManager.getBufferedStateLegacy(e.device,e.channel);a&&(a._ver="v5+",this._udpEvtProducer.addSTAEvent(a))}}else for(a in this._managers){var f=this._managers[a];if(f)f.onDeviceEvent(e)}};k.prototype.resetChip=function(e){this._chipManager?this._chipManager.reset(function(){e&&e({})}):e&&e(Error("chip manager not inited"))};k.prototype.initManager=function(e,h){if(e){var a=this._getManager(e);
a||(a=this._addManager(e));a.init(function(a){h&&h({error:a})})}else h&&h({error:Error("gateway invalid")})};k.prototype.learnRFDevice=function(e,h){if(e){var a=this._getManager(e);a?a.learnRFDevice(function(a,e){h&&h({error:a,data:e})}):(a=this._addManager(e),a.init(function(e){e?h&&h({error:e}):setTimeout(function(){a.learnRFDevice(function(a,e){h&&h({error:a,data:e})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDevice(function(a,e){if(a)h&&h({error:a});else{var k=[];e.forEach(function(a){if(a){var e=
a.toLegacyAdr();a=a.toLegacyType();k.push({address:e,type:a})}});h&&h({data:k})}}):h&&h(Error("chip manager not inited"))};k.prototype.learnRFDeviceSN=function(e,h,a){if(e){var f=this._getManager(e);f?f.learnRFDevice(function(e,f){a&&a({error:e,data:f})}):(f=this._addManager(e),f.init(function(e){e?a&&a({error:e}):setTimeout(function(){f.learnRFDevice(function(e,f){a&&a({error:e,data:f})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDeviceSN(h,function(e,f){if(e)a&&a({error:e});else{var h=
[];f.forEach(function(a){if(a){var e=a.toLegacyAdr();a=a.toLegacyType();h.push({address:e,type:a})}});a&&a({data:h})}}):a&&a(Error("chip manager not inited"))};k.prototype.learnIPDevice=function(e,h,a,f){if(e){var k=this._getManager(e);k?k.learnIPDevice(h,a,function(a,e){f&&f({error:a,data:e})}):(k=this._addManager(e),k.init(function(e){e?f&&f({error:e}):setTimeout(function(){k.learnIPDevice(h,a,function(a,e){f&&f({error:a,data:e})})},3E3)}))}else h?a?this._chipManager?this._chipManager.learnIPDevice(h,
a,function(a,e){if(a)f&&f({error:a});else{var h=[];e.forEach(function(a){if(a){var e=a.toLegacyAdr();a=a.toLegacyType();h.push({address:e,type:a})}});f&&f({data:h})}}):f&&f(Error("chip manager not inited")):f&&f({error:Error("key is null")}):f&&f({error:Error("sgtin is null")})};k.prototype.learnIPDeviceQR=function(e,h,a){if(h)if(e){var f=this._getManager(e);f?f.learnIPDeviceQR(h,function(e,f){a&&a({error:e,data:f})}):(f=this._addManager(e),f.init(function(e){e?a&&a({error:e}):setTimeout(function(){f.learnIPDeviceQR(h,
function(e,f){a&&a({error:e,data:f})})},3E3)}))}else this._chipManager?this._chipManager.learnIPDeviceQR(h,function(e,f){if(e)a&&a({error:e});else{var h=[];f.forEach(function(a){if(a){var e=a.toLegacyAdr();a=a.toLegacyType();h.push({address:e,type:a})}});a&&a({data:h})}}):a&&a(Error("chip manager not inited"));else a&&a({error:Error("qrKey is null")})};k.prototype.deleteDevice=function(e,h,a){if(h){var f=h.split(".");3>f.length?a&&a({error:Error("address invalid")}):(h=f[1],f=f[2],e?a&&a({error:Error("not supported yet")}):
this._chipManager?this._chipManager.deleteDevice(h,f,function(e){a&&a({error:e})}):a&&a(Error("chip manager not inited")))}else a&&a({error:Error("address invalid")})};k.prototype.getRFInterfaces=function(e,h){if(e){var a=this._getManager(e);a?a.getRFInterfaces(function(a,e){h&&h({error:a,data:e})}):(a=this._addManager(e),a.init(function(e){e?h&&h({error:e}):setTimeout(function(){a.getRFInterfaces(function(a,e){h&&h({error:a,data:e})})},3E3)}))}else this._chipManager?this._chipManager.getRFInterfaces(function(a,
e){h&&h({error:a,data:e})}):h&&h(Error("chip manager not inited"))};k.prototype.executeCommandLegacy=function(e,h,a,f){e?f&&f({error:Error("not supported yet")}):this._chipManager?h?this.executeCommand({address:h},{value:a},function(a){f&&f({error:a?a.error:null})}):f&&f({error:Error("address invalid")}):f&&f({error:Error("chip manager not inited")})};k.prototype.getAllStatesLegacy=function(e){var h=[];try{this.getAllStates().forEach(function(a){if(a&&a.device&&a.states){var e={type:"HM",adr:a.device.toLegacyAdr(),
state:{}},k;for(k in a.states)e.state[k]=a.states[k].value;h.push(e)}})}catch(a){console.error(a.stack)}e&&e({data:h})};k.prototype.getConfig=function(e,h){e?e.gateway&&"mediola"!=e.gateway.uuid?h&&h({error:Error("not supported yet")}):this._chipManager?this._chipManager.getConfig(e,function(a,e){h&&h({error:a,data:e})}):h&&h({error:Error("chip manager not inited")}):h&&h({error:Error("device is null")})};k.prototype.setConfig=function(e,h,a){e?e.gateway&&"mediola"!=e.gateway.uuid?a&&a({error:Error("not supported yet")}):
this._chipManager?this._chipManager.setConfig(e,h,function(e){a&&a({error:e})}):a&&a({error:Error("chip manager not inited")}):a&&a({error:Error("device is null")})};k.prototype.getMonitorStates=function(e){this._monitorManager.getMonitorStates(function(h,a){e&&e({error:h,data:a})})};k.prototype.getAllDevices=function(e){var h=[];try{this.getAllStates().forEach(function(a){a&&a.device&&a.states&&(a={type:"HM",address:a.device.toLegacyAdr(),data:a.device.toLegacyType(),snr:a.device.getSerial(),_ver:"v5+"},
h.push(a))})}catch(a){console.error(a.stack)}e&&e({data:h})};k.prototype.isWindowOpen=function(){try{for(var e=this.getAllStates(),h=0;h<e.length;h++){var a=e[h];if(a&&a.device&&a.states){var f=a.device.toLegacyType();if("window"==f){if(a.states.state&&"closed"!=a.states.state.value)return!0}else if("contact"==f){if(a.states.state&&"closed"!=a.states.state.value)return!0}else if("ip_contact"==f){if(a.states.state&&"closed"!=a.states.state.value)return!0}else if("ip_window"==f&&a.states.state&&"closed"!=
a.states.state.value)return!0}}}catch(k){return!1}};return k}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.hm.Handler);
