var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,h,m){a instanceof String&&(a=String(a));for(var g=a.length,k=0;k<g;k++){var l=a[k];if(h.call(m,l,k,a))return{i:k,v:l}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,h,m){a!=Array.prototype&&a!=Object.prototype&&(a[h]=m.value)};$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var h=0;h<a.length;++h){var m=a[h];if(m&&m.Math==Math)return m}return globalThis};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,h,m,g){if(h){m=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var k=a[g];k in m||(m[k]={});m=m[k]}a=a[a.length-1];g=m[a];h=h(g);h!=g&&null!=h&&$jscomp.defineProperty(m,a,{configurable:!0,writable:!0,value:h})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(h,a){return $jscomp.findInternal(this,h,a).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(a){var h=0;return function(){return h<a.length?{done:!1,value:a[h++]}:{done:!0}}};
$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,h){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(m){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(m||"")+"_"+h++,m)}var h=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,h){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var m=0,g={next:function(){if(m<a.length){var k=m++;return{value:h(k,a[k]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(h){return h})}},"es6","es3");
var util=require("util"),EventEmitter=require("events"),async=require("async"),x=x||{};x.hub=x.hub||{};x.hub.m=x.hub.m||{};x.hub.m.hm=x.hub.m.hm||{};x.hub.m.hm.CCU_INIT_STATE=!0;x.hub.m.hm.HM_MODULE=require("xnm.aio.hm.js");
x.hub.m.hm.RFDeviceTypes={"HM-PB-4Dis-WM":0,"ZEL STG RM DWT 10":0,"263 155":0,"HM-PB-4Dis-WM-2":0,ASH550I:1,ASH550:1,"HM-WDS10-TH-O":1,"263 158":1,"HM-WDS20-TH-O":1,"HM-WDS40-TH-I":1,"263 157":1,"IS-WDS-TH-OD-S-R3":1,"HM-WDS40-TH-I-2":1,"HM-LC-Bl1-SM":2,"HM-LC-Bl1-FM":2,"HM-LC-Bl1-PB-FM":2,"ZEL STG RM FEP 230V":2,"263 146":2,"HM-LC-BlX":2,"HM-LC-Bl1-SM-2":2,"HM-LC-Bl1-FM-2":2,"HM-LC-Bl1PBU-FM":2,"263 147":2,"HM-CC-RT-DN":3,"HM-CC-RT-DN-BoM":4,"HM-CC-TC":5,"ZEL STG RM FWT":5,"HM-CC-VD":6,"ZEL STG RM FSA":6,
CENTRAL:7,"HM-RCV-50":7,"HM-OU-CF-Pl":8,"HM-OU-CFM-Pl":9,"HM-OU-CFM-TW":9,"HM-OU-CM-PCB":10,"HM-LC-AO-SM":11,"HM-LC-Dim1L-Pl":11,"HM-LC-Dim1L-Pl-2":11,"HM-LC-Dim1L-CV":11,"263 132":11,"HM-LC-Dim2L-CV":11,"HM-LC-Dim2L-SM":11,"HSS-DX":11,"HM-LC-Dim1L-Pl-3":11,"HM-LC-Dim1L-CV-2":11,"HM-LC-Dim2L-SM-2":11,"HM-LC-Dim1PWM-CV":12,"HM-LC-Dim1PWM-CV-2":12,"HM-LC-Dim1TPBU-FM":13,"HM-LC-Dim1TPBU-FM-2":13,"263 133":13,"HM-LC-Dim1T-Pl":13,"HM-LC-Dim1T-CV":13,"HM-LC-Dim1T-FM":13,"HM-LC-Dim1T-Pl-3":13,"HM-LC-Dim1T-CV-2":13,
"HM-LC-Dim1T-FM-2":13,"HM-LC-Dim2T-SM":13,"HM-LC-Dim2T-SM-2":13,"HM-LC-Dim1T-Pl-2":13,"263 134":13,"HM-LC-Dim1T-DR":13,"HM-LC-Dim1T-FM-LF":13,"OLIGO.smart.iq.HM":11,"HM-Dis-WM55":14,"HM-MOD-EM-8":15,"HM-ES-PMSw1-Pl":16,"HM-ES-PMSw1-Pl-DN-R1":16,"HM-ES-PMSw1-Pl-DN-R2":16,"HM-ES-PMSw1-Pl-DN-R3":16,"HM-ES-PMSw1-Pl-DN-R4":16,"HM-ES-PMSw1-Pl-DN-R5":16,"HM-ES-PMSw1-DR":16,"HM-ES-PMSw1-SM":16,"HM-Dis-TD-T":17,"HM-Sec-Key":18,"HM-Sec-Key-S":18,"HM-Sec-Key-O":18,"HM-Sec-Key-Generic":18,KS550:19,KS888:19,KS550Tech:19,
KS550LC:19,"HM-WDS100-C6-O":19,"HM-WDS100-C6-O-2":19,"HM-OU-LED16":20,"HM-OU-X":20,"HM-PB-2-WM55-2":21,"HM-PB-2-WM55":21,"ZEL STG RM WT 2":21,"263 135":21,"HM-PB-2-FM":21,"HM-PBI-4-FM":21,"ZEL STG RM FST UP4":21,"263 145":21,"HM-PBI-X":21,"HM-RC-4-2":21,"HM-PB-6-WM55":21,"HM-RC-8":21,"HM-RC-4":21,"HM-RC-4-3":21,"HM-RC-4-B":21,"HM-RC-P1":21,"HM-RC-Sec3":21,"HM-RC-Sec3-B":21,"HM-RC-Key3":21,"HM-RC-Key3-B":21,"HM-PB-4-WM":21,"HM-PB-2-WM":21,"HM-RC-2-PBU-FM":21,"RC-H":21,atent:21,"ZEL STG RM HS 4":21,
"HM-RC-X":21,"BRC-H":21,"HM-RC-SB-X":21,"HM-RC-12":21,"HM-RC-12-B":21,"HM-RC-12-SW":21,"HM-RC-Key4-2":22,"HM-RC-Sec4-2":22,"HM-RC-Key4-3":22,"HM-RC-Sec4-3":22,"HM-RC-19":23,"HM-RC-19-B":23,"HM-RC-19-SW":23,"HM-Sen-RD-O":24,"HM-Sec-RHS":25,"HM-Sec-RHS-2":25,"ZEL STG RM FDK":25,"HM-Sec-xx":25,"HM-LC-Sw1-Pl":26,"HM-LC-Sw1-Pl-2":26,"HM-LC-Sw1-SM":26,"HM-LC-Sw2-SM":26,"HM-LC-Sw4-SM":26,"HM-LC-Sw4-PCB":26,"HM-LC-Sw4-WM":26,"HM-LC-Sw1-FM":26,"263 130":26,"HM-LC-Sw2-FM":26,"HM-LC-Sw1-PB-FM":26,"HM-LC-Sw2-PB-FM":26,
"HM-LC-Sw4-DR":26,"HM-LC-Sw2-DR":26,"ZEL STG RM FZS":26,"ZEL STG RM FZS-2":26,"HM-LC-Sw1PBU-FM":26,"HM-LC-Sw2PBU-FM":26,"263 131":26,"HM-MOD-Re-8":26,"HM-LC-Sw1-Ba-PCB":26,"HM-LC-Sw4-Ba-PCB":26,"HM-LC-Sw1-Pl-3":26,"HM-LC-Sw1-SM-2":26,"HM-LC-Sw4-SM-2":26,"HM-LC-Sw4-PCB-2":26,"HM-LC-Sw4-WM-2":26,"HM-LC-Sw1-FM-2":26,"HM-LC-Sw2-FM-2":26,"HM-LC-Sw4-DR-2":26,"HM-LC-Sw2-DR-2":26,"HM-LC-Sw1-Pl-DN-R1":26,"HM-LC-Sw1-Pl-DN-R2":26,"HM-LC-Sw1-Pl-DN-R3":26,"HM-LC-Sw1-Pl-DN-R4":26,"HM-LC-Sw1-Pl-DN-R5":26,"HM-LC-Sw1-DR":26,
"HM-LC-Sw1-Pl-CT-R1":26,"HM-LC-Sw1-Pl-CT-R2":26,"HM-LC-Sw1-Pl-CT-R3":26,"HM-LC-Sw1-Pl-CT-R4":26,"HM-LC-Sw1-Pl-CT-R5":26,"HM-LC-Sw1-PCB":26,"HM-LC-Sw1-Pl-OM54":26,"HM-LC-Sw1-SM-ATmega168":26,"HM-LC-Sw4-SM-ATmega168":26,S550IA:27,"HM-WDS30-T-O":27,"HM-Sec-SC":28,"ZEL STG RM FFK":28,"HM-Sec-SC-2":28,"HM-SCI-3-FM":29,"HM-CC-SCD":30,"263 160":30,"HM-Sec-MDIR-3":31,"HM-Sec-MDIR-2":31,"HM-Sec-MDIR":31,"263 162":31,"HM-Sec-MD":31,"HM-Sec-SD":32,"HM-Sec-SD-Generic":32,"HM-Sec-SD-2":32,"HM-Sec-SD-2-Generic":32,
"HM-Sec-SFA-SM":33,"HM-Sen-MDIR-SM":34,"HM-Sen-MDIR-O":34,"HM-MD":34,"HM-Sen-MDIR-O-2":34,"HM-Sen-MDIR-O-3":34,"HM-Sen-EP":35,"HM-Sen-X":35,"HM-Sen-Wa-Od":36,"HM-SwI-3-FM":37,"ZEL STG RM FSS UP3":37,"263 144":37,"HM-SwI-X":37,"HM-TC-IT-WM-W-EU":38,"HM-Sec-TiS":39,"HM-WDS30-OT2-SM":40,"HM-WDS30-OT2-SM-2":40,"HM-Sec-WDS":41,"HM-Sec-WDS-2":41,"HM-Sec-Win":42,"HM-Sec-Win-Generic":42,WS550:43,WS888:43,WS550Tech:43,WS550LCB:43,WS550LCW:43,"HM-WDC7000":43,"HMW-IO-12-Sw14-DR":44,"HMW-IO-12-Sw7-DR":45,"HMW-IO-12-FM":46,
"HMW-IO-4-FM":46,"HMW-LC-Bl1-DR":47,"HMW-LC-Dim1L-DR":48,"HMW-LC-Sw2-DR":49,"HMW-Sen-SC-12-DR":50,"HMW-Sen-SC-12-FM":50,"HM-CC-VG-1":51,"HM-ES-TX-WM":52,"HM-LC-RGBW-WM":53,"HM-Sec-SD-2-Team":54,"HM-Sen-LI-O":56,"HM-Sec-SCo":28,"HM-Sec-Sir-WM":57,"HM-LC-Ja1PBU-FM":58,"HM-MOD-EM-8Bit":59,"HM-Dis-EP-WM55":60,"HM-Sen-MDIR-WM55":61,"HM-LC-DW-WM":62};
x.hub.m.hm.RFDeviceCatagory=[{type:"button",channelNum:"*",channel:"KEY"},{type:"weather"},{type:"blind",channelNum:"*",channel:"BLIND"},{type:"heater2"},{type:"heater3"},{type:"wallthermo"},{type:"heater"},{type:"vbutton",channelNum:"*",channel:"VIRTUAL_KEY"},{type:"gong2"},{type:"gong"},{type:"gong"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"button",channelNum:"*",channel:"KEY"},{type:"mod_em_8",
channelNum:"*",channel:"KEY"},{type:"powerswitch"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"keymatic"},{type:"weatherstation"},{type:"ou_led16",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"rain"},{type:"window"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"temp"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"contact",channelNum:"*",
channel:"SHUTTER_CONTACT"},{type:"co2"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{type:"smoke"},{type:"siren",channelNum:"*",channel:"ALARMACTUATOR"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{},{type:"capacity"},{type:"switch_interface",channelNum:"*",channel:"SWITCH_INTERFACE"},{type:"wallthermo2"},{type:"tilt",channelNum:"*",channel:"TILT_SENSOR"},{type:"temp2",channel:"WEATHER"},{type:"water",channelNum:"*",channel:"WATERDETECTIONSENSOR"},{},{type:"weather2"},{},
{},{},{},{},{},{},{},{type:"energymeter"},{type:"rgb"},{},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"lux"},{type:"siren2"},{type:"jalousie",channelNum:"*",channel:"JALOUSIE"},{type:"mod_em_8bit"},{type:"button",channelNum:"*",channel:"KEY"},{},{type:"dualwhite"}];
x.hub.m.hm.IPDeviceTypes={"HMIP-PS":0,"HmIP-PCBS":0,"HmIP-PCBS-BAT":0,"HMIP-SWDO":1,"HmIP-SWDO-I":1,"HmIP-SWDM":1,"HmIP-SWDM-B2":1,"Contact AA":1,"HMIP-WTH":2,"HmIP-WTH-2":2,"HmIP-STH":2,"HmIP-STHD":2,"HMIP-eTRV":3,"HMIP-eTRV-2":3,"HmIP-eTRV-2-UK":3,"HmIP-eTRV-B":3,"HmIP-eTRV-B1":3,"HmIP-eTRV-B-UK":3,"HmIP-eTRV-C":3,"HMIP-WRC2":4,"HmIP-SMI":5,"HmIP-SMO":5,"HmIP-SMO-A":5,"HmIP-SRH":6,"HmIP-SWSD":7,"HmIP-PSM":8,"Smart Plug AA":8,"HmIP-PSM-PE":8,"HmIP-PSM-UK":8,"HmIP-PSM-IT":8,"HmIP-PSM-CH":8,"HmIP-BSM":9,
"HmIP-BDT":10,"HmIP-ASIR":11,"HmIP-KRC4":12,"HmIP-KRCA":12,"HmIP-PDT":13,"HmIP-PDT-UK":13,"HmIP-FSM":14,"HmIP-FSM16":14,"HmIP-BROLL":15,"HmIP-FROLL":15,"HmIP-FBL":16,"HmIP-BBL":16,"HmIP-SPI":17,"HmIP-FDT":18,"HmIP-BWTH":19,"HmIP-BWTH24":19,"HmIP-FAL230-C6":20,"HmIP-FAL24-C6":20,"HmIP-FAL230-C10":20,"HmIP-FAL24-C10":20,"HmIP-WRC6":21,"HmIP-SWO-B":22,"HmIP-SWO-PL":23,"HmIP-SWO-PR":27,"HmIP-STHO":24,"HmIP-STHO-A":24,"HmIP-SPDR":25,"HmIP-SMI55":26,"HmIP-RC8":28,"HmIP-MIOB":0,"HmIP-SWD":31,"HmIP-SAM":32,
"HmIP-WGC":33,"HmIP-BSL":34,"HmIP-MOD-TM":35,"HmIP-DBB":36,"HmIP-FCI1":37,"HmIP-FCI6":37,"HmIP-SLO":38,"HmIP-BRC2":4,"HmIP-PMFS":39,"HmIP-MOD-RC8":37,"HmIP-MOD-OC8":1};
x.hub.m.hm.IPDeviceCatagory=[{type:"ip_switch"},{type:"ip_contact"},{type:"ip_wallthermo"},{type:"ip_heater"},{type:"ip_button2"},{type:"ip_motion"},{type:"ip_window"},{type:"ip_smoke"},{type:"ip_powerswitch"},{type:"ip_energyactor"},{type:"ip_dimmer"},{type:"ip_siren"},{type:"ip_button4"},{type:"ip_dimmer2"},{type:"ip_energyactor2"},{type:"ip_blind"},{type:"ip_jalousie"},{type:"ip_presence"},{type:"ip_dimmer3"},{type:"ip_wallthermo2"},{type:"ip_floor_heater"},{type:"ip_button6"},{type:"ip_weather"},
{type:"ip_weather2"},{type:"ip_weather3"},{type:"ip_direction"},{type:"ip_motion2"},{type:"ip_weather4"},{type:"ip_button8"},{type:"ip_generic_input"},{type:"ip_analog_output"},{type:"ip_water"},{type:"ip_acce"},{type:"ip_garagedoor"},{type:"ip_bsl"},{type:"ip_tormatic"},{type:"ip_button"},{type:"ip_multi_input_bat"},{type:"ip_lux"},{type:"ip_pmfs"}];
x.hub.m.hm.Util={clearHttpOptionForLog:function(a){try{var h=JSON.parse(JSON.stringify(a));h.auth&&(h.auth="xxxxxx:xxxxxx");if(h.headers)for(var m in headers)if(m&&"authorization"==m.toLocaleLowerCase()){var g=headers[m];if(g){var k=g.indexOf(" ");headers[m]=-1==k?"xxxxxx":g.substr(0,k)+" xxxxxx"}}return h}catch(l){return a}}};
x.hub.m.hm.Client=function(){var a=function(h,a,g,k,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Client");this.ip=h;this.port=a;this.port||(this.port=2001);this.username=g;this.password=k;this.useHttps=l;this.timeout=2E4;this.xml2js=null};a.prototype._doRequest=function(h,a,g){var k=require("http");this.useHttps&&(k=require("https"));h={host:this.ip,port:this.port,path:"/",method:h,headers:{"User-Agent":"mediola",Connection:"keep-alive"}};this.username&&(h.auth=this.username+":"+(this.password?
this.password:""));a&&(h.headers["Content-Length"]=a.length);var l=g,m=this;this._logger.log("trace","send http request:"+x.hub.m.hm.Util.clearHttpOptionForLog(h));this._logger.log("trace","send http data:"+a);g=k.request(h,function(k){var g="";k.setEncoding("utf-8");k.on("data",function(k){g+=k});k.on("end",function(){m._logger.log("trace","http response status:"+k.statusCode);m._logger.log("trace","http response data:"+g);var n=null;200!=k.statusCode&&(n=Error("http response "+k.statusCode));l&&
l(n,g,k.statusCode)})});g.on("error",function(k){m._logger.log("trace","http request error:"+k.stack);l&&l(k);l=null});g.setTimeout(this.timeout,function(){m._logger.log("trace","http request timeout");l&&l(Error("http timeout"));l=null});a&&g.write(a);g.end()};a.prototype._doXMLRpcRequest=function(h,a,g){var k=require("x.xmlrpc.js");h='<?xml version="1.0" encoding="ISO-8859-1"?><methodCall><methodName>'+h+"</methodName><params>";for(var l=0;l<a.length;l++)h=a[l]&&a[l].type&&void 0!=a[l].value?h+
("<param>"+k.serializeValue(a[l].value,a[l].type)+"</param>"):h+("<param>"+k.serializeValue(a[l])+"</param>");this._doRequest("POST",h+"</params></methodCall>",function(l,n){if(l)g&&g(l);else if(n)try{var h=k.deserializeRsp(n);h.error?g&&g(Error("xml rcp return error:"+h.error.faultString+" @code:"+h.error.faultCode),h.error):g&&g(null,h.params)}catch(p){g&&g(p)}else g&&g(Error("xml rcp response format invalid"))})};a.prototype.convertHmIPKeyBase32ToBase16=function(h){h=h.replace(/-/g,"").toUpperCase();
var a="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),g=new ArrayBuffer(16);g=new Uint8Array(g);for(var k=0,l=h.length-1,q=0,n=g.length-1,r="";0<=l;){for(var p=0;p<a.length;p++)if(a[p]==h.charAt(l)){k|=p<<q;break}q+=5;for(l--;8<q&&0<=n;)g[n]=k&255,k>>=8,q-=8,n--}for(p=0;p<g.length;p++)16>g[p]&&(r+="0"),r+=g[p].toString(16);return r.toUpperCase()};a.prototype._getValue=function(h){var a=null;if(this.xml2js)if(h["boolean"]&&h["boolean"][0])a=parseInt(h["boolean"][0])?!0:!1;else if(h.i4&&h.i4[0])a=parseInt(h.i4[0]);
else if(h.double&&h.double[0])a=parseFloat(h.double[0]);else if(h.array&&h.array[0]&&h.array[0].data&&h.array[0].data[0]&&h.array[0].data[0].value){a=[];h=h.array[0].data[0].value;for(var g in h)a.push(h[g])}else a=h;else if(g=h,h=h.find("value"),0<h.length&&(g=$(h[0])),g&&(a=g.text(),!a&&g.children()&&0<g.children().length))if(h=$(g.children()[0]),"boolean"==h.prop("tagName"))a=parseInt(h.text())?!0:!1;else if("i4"==h.prop("tagName"))a=parseInt(h.text());else if("double"==h.prop("tagName"))a=parseFloat(h.text());
else if("array"==h.prop("tagName"))for(a=[],h=h.find("data value"),g=0;g<h.length;g++){var k=$(h[g]).text();k&&a.push(k)}else XC.debugf("unknown valuetype:"),XC.debugf(h.getXMLString());return a};a.prototype._getStructData=function(h){var a={};if(h.struct&&h.struct[0]&&h.struct[0].member){h=h.struct[0].member;for(var g in h)h[g].name&&h[g].name[0]&&h[g].value&&h[g].value[0]&&(a[h[g].name[0]]=this._getValue(h[g].value[0]))}return a};a.prototype._waitForNewDevices=function(h,a,g){var k=this;this.getDeviceList(function(l){if(0>=
a||Object.keys(l).length>Object.keys(h).length){for(var m in l)h[m]||XC.debugf("new device: "+m);g&&g(l)}else setTimeout(function(){k._waitForNewDevices(h,a-4,g)},4E3)})};a.prototype.init=function(h,a,g){this._doXMLRpcRequest("init",[h,a],function(k){g&&g(k)})};a.prototype.getIP=function(){return this.ip};a.prototype.getPort=function(){return this.port};a.prototype.setPort=function(h){this.port=h};a.prototype.getValue=function(h,a,g,k){h=[h,a];"undefined"!=typeof g&&null!=g&&h.push(g);this._doXMLRpcRequest("getValue",
h,function(g,h){var l=null;!g&&h?l=h[0]:g&&h&&(l=h);k&&k(g,l)})};a.prototype.setValue=function(h,a,g,k){this._doXMLRpcRequest("setValue",[h,a,g],function(g){k&&k(g)})};a.prototype.getParamset=function(h,a,g,k){this._doXMLRpcRequest("getParamset",[h,a,g],function(g,h){var l=null;!g&&h?l=h[0]:g&&h&&(l=h);k&&k(g,l)})};a.prototype.putParamset=function(h,a,g,k){this._doXMLRpcRequest("putParamset",[h,a,g],function(g,h){var l=null;!g&&h?l=h[0]:g&&h&&(l=h);k&&k(g,l)})};a.prototype.listDevices=function(h){this._doXMLRpcRequest("listDevices",
[],function(a,g){var k=[];!a&&g&&(k=g[0]);h&&h(a,k)})};a.prototype.deleteDevice=function(h,a,g){this._doXMLRpcRequest("deleteDevice",[h,a],function(k){g&&g(k)})};a.prototype.setInstallMode=function(h,a,g,k){var l=[];l.push(h);"undefined"!=typeof a&&null!=a&&l.push(a);"undefined"!=typeof g&&null!=g&&l.push(g);this._doXMLRpcRequest("setInstallMode",l,function(g){k&&k(g)})};a.prototype.setInstallModeWithWhitelist=function(h,a,g,k){var l=[];l.push(h);"undefined"!=typeof a&&null!=a&&l.push(a);"undefined"!=
typeof g&&null!=g&&l.push(g);this._doXMLRpcRequest("setInstallModeWithWhitelist",l,function(g){k&&k(g)})};a.prototype.addNewDevice=function(h){var a=this;this.getDeviceList(function(g){a._doRequest("setInstallMode",[!0,30,2],function(k){setTimeout(function(){a._waitForNewDevices(g,30,h)},4E3)})})};a.prototype.addNewDeviceWithSGTN=function(h,a,g){var k=this;this.getDeviceList(function(l){k._doRequest("setInstallModeWithWhitelist",[!0,30,[{ADDRESS:a,KEY_MODE:"LOCAL",KEY:g}]],function(g){setTimeout(function(){k._waitForNewDevices(l,
30,h)},4E3)})})};a.prototype.listBidcosInterfaces=function(h){this._doXMLRpcRequest("listBidcosInterfaces",[],function(a,g){var k=[];!a&&g&&(k=g[0]);h&&h(a,k)})};a.prototype.reportValueUsage=function(h,a,g,k){this._doXMLRpcRequest("reportValueUsage",[h,a,g],function(g,h){var l;!g&&h&&(l=h[0]);k&&k(g,l)})};a.prototype.ping=function(h,a){this._doXMLRpcRequest("ping",[h],function(g){a&&a(g)})};return a}();
x.hub.m.hm.Server=function(){var a=function(h){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Server");this._port=9099;h&&0<h&&(this._port=h);this._server=null;this._servlet={}};a.prototype.getPort=function(){return this._port};a.prototype.stop=function(h){this._server?this._server.close():h&&h()};a.prototype.start=function(h){if(this._server)h&&h();else{var a=h,g=this,k=require("http").createServer(function(k,h){g._logger.log("trace","receive request method:"+k.method);g._logger.log("trace",
"receive request path:"+k.url);g._logger.log("trace","receive request header:"+JSON.stringify(k.headers));var l="";k.on("data",function(k){l+=k.toString()});k.on("end",function(){g._logger.log("trace","receive request body:"+l);"POST"==k.method?g._handleRequest(l,k,h):(g._logger.log("trace","send 404 response"),h.writeHead(404,"Not found"),h.end())})});k.on("error",function(k){g._logger.log("trace","xmlrpc server err:"+k.stack);a&&a(k);a=null;g._server=null});k.listen(this._port,function(){g._logger.log("trace",
"xmlrpc server listening on port:"+g._port);g._server=k;a&&a();a=null})}};a.prototype.registServlet=function(h,a){h&&a&&(this._servlet[h]=a)};a.prototype.unregistServlet=function(h){h&&delete this._servlet[h]};a.prototype._handleRequest=function(h,a,g){var k=a.url,l=require("x.xmlrpc.js"),m=this;try{var n=l.deserializeReq(h);if("system.multicall"==n.methodName)this._handleMultiCall(n.params[0],a,g);else if(this._logger.log("debug","receive method call:"+n.methodName),this._logger.log("debug","params:"+
JSON.stringify(n.params)),"system.listMethods"==n.methodName)this._sendSuccessResponse(["event listDevices newDevices deleteDevices updateDevice replaceDevice readdedDevice".split(" ")],g);else if(this._servlet[k])this._servlet[k](n.methodName,n.params,function(k,l){k?m._sendErrorResponse(k,g):m._sendSuccessResponse([l],g)});else this._sendSuccessResponse([[]],g)}catch(r){this._sendErrorResponse(r,g)}};a.prototype._handleMultiCall=function(h,a,g){a=a.url;this._logger.log("trace","---------------------------------");
this._logger.log("trace","receive system.multicall");for(var k=0;k<h.length;k++){var l=h[k];this._logger.log("trace","receive method call:"+l.methodName);this._logger.log("trace","params:"+JSON.stringify(l.params));if(this._servlet[a])this._servlet[a](l.methodName,l.params)}this._logger.log("trace","---------------------------------");this._sendSuccessResponse([[]],g)};a.prototype._sendSuccessResponse=function(h,a){h=require("x.xmlrpc.js").serializeRsp(null,h);this._logger.log("trace","send xml success response:"+
h);a.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(h)+""});a.write(h);a.end()};a.prototype._sendErrorResponse=function(h,a){var g=require("x.xmlrpc.js"),k=-1;h.errCode&&(k=h.errCode);h=g.serializeRsp({faultCode:k,faultString:h.message});this._logger.log("trace","send xml fault response:"+h);a.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(h)+""});a.write(h);a.end()};return a}();
x.hub.m.hm._Controller=function(){var a=function(k,g,a,n,h,m){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller");this._client=new x.hub.m.hm.Client(k,g,a,n,h);this._initStates=m;this.interface=null;this._devices={};this._status={};this._learnDeviceCbs=[];this._learnDeviceTO=null;this._readValueCbs={}};util.inherits(a,EventEmitter);a.prototype.getIP=function(){return this._client.getIP()};a.prototype.getPort=function(){return this._client.getPort()};a.prototype.setPort=function(k){return this._client.setPort(k)};
a.prototype.getAllBufferedStates=function(){var k={},g;for(g in this._devices){var a=this._devices[g];!a.PARENT&&a.CHILDREN?k[g]={device:{type:a.TYPE,"interface":this.interface,address:a.ADDRESS,channels:{}},states:{}}:a.PARENT&&(k[a.PARENT].device.channels[a.ADDRESS]={type:a.TYPE,address:a.ADDRESS});if(a.CHILDREN)for(var n=0,h=a.CHILDREN.length;n<h;n++){var m=a.CHILDREN[n];if(this._status[m]){k[g].states[m]={};for(var t in this._status[m])k[g].states[m][t]=this._status[m][t]}}}return k};a.prototype.getBufferedState=
function(k){if(!k)return null;var g=k.indexOf(":");-1!=g&&(k=k.substr(0,g));k=this._devices[k];if(!k)return null;var a={};if(k.CHILDREN){var n=this;k.CHILDREN.forEach(function(k){if(n._status[k]){a[k]={};for(var g in n._status[k])a[k][g]=n._status[k][g]}})}return a};a.prototype.getBufferedDevices=function(){return this._getDeviceStructs(this._devices)};a.prototype.getState=function(k,g,a){var l=this.getBufferedState(k);if(l&&l[k]&&l[k][g]){l=l[k][g];var h=l.value;if("undefined"!=typeof h&&null!=h){a&&
a(null,l);return}}this.updateState(k,g,function(k,g){a&&a(k,g)})};a.prototype.updateState=function(k,g,a){var l=this;this.readValue(k,g,function(n,h){n?setTimeout(function(){var n,h=l.getBufferedState(k);h&&h[k]&&h[k][g]&&(n=h[k][g]);a&&a(null,n)},1E3):a&&a(null,{value:h,time:(new Date).getTime()})})};a.prototype.reset=function(k){var g=[];Object.keys(this._devices).forEach(function(k){k&&-1==k.indexOf(":")&&"BidCoS-RF"!=k&&g.push(k)});if(0==g.length)k&&k();else{var a=0,n=this,h=function(l){a++;a<
g.length?n.deleteDevice(g[a],h):k&&k()};this.deleteDevice(g[a],h)}};a.prototype.register=function(k,g,a){if(k){this._logger.log("debug","register:"+g+" to "+k);var l=this;this._client.init(k,g,function(k){l._logger.log("debug","registed:"+g+(k?" err:"+k.message:""));a&&a(k,k?null:g)})}else a&&a(Error("arguments invalid"))};a.prototype.unregister=function(k,g){k?this._client.init(k,"",function(k){g&&g(k)}):g&&g(Error("url invalid"))};a.prototype.getDevices=function(k){this._client.listDevices(function(g,
a){if(g)k&&k(g);else for(g=0;g<a.length;g++);})};a.prototype.learnNewDevice=function(k){var g=this._learnDeviceCbs.length;k&&-1==this._learnDeviceCbs.indexOf(k)&&this._learnDeviceCbs.push(k);if(0==g){var a=this;this._learnDeviceTO=setTimeout(function(){var k=a._learnDeviceCbs;a._learnDeviceCbs=[];for(var g=0;g<k.length;g++){var l=k[g];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,1,function(k){if(k){a._learnDeviceTO&&(clearTimeout(a._learnDeviceTO),a._learnDeviceTO=
null);var g=a._learnDeviceCbs;a._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var n=g[l];n&&n(k)}}})}};a.prototype.learnNewDeviceSN=function(k,g){var l=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==l){var a=this;this._learnDeviceTO=setTimeout(function(){var k=a._learnDeviceCbs;a._learnDeviceCbs=[];for(var g=0;g<k.length;g++){var l=k[g];l&&l(Error("learn device timeout"))}},3E4);this._client.setInstallMode(!0,30,k,function(k){if(k){a._learnDeviceTO&&
(clearTimeout(a._learnDeviceTO),a._learnDeviceTO=null);var g=a._learnDeviceCbs;a._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var h=g[l];h&&h(k)}}})}};a.prototype.learnNewIPDevice=function(k,g,a){var l=this._learnDeviceCbs.length;a&&-1==this._learnDeviceCbs.indexOf(a)&&this._learnDeviceCbs.push(a);if(0==l){var h=this;this._learnDeviceTO=setTimeout(function(){var k=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var g=0;g<k.length;g++){var l=k[g];l&&l(Error("learn device timeout"))}},6E4);k={ADDRESS:k.replace(/-/g,
"").toUpperCase(),KEY_MODE:"LOCAL",KEY:this._convertHmIPKeyBase32ToBase16(g)};this._client.setInstallModeWithWhitelist(!0,60,[k],function(k){if(k){h._learnDeviceTO&&(clearTimeout(h._learnDeviceTO),h._learnDeviceTO=null);var g=h._learnDeviceCbs;h._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var a=g[l];a&&a(k)}}})}};a.prototype.learnNewIPDeviceQR=function(k,g){var l=this._learnDeviceCbs.length;g&&-1==this._learnDeviceCbs.indexOf(g)&&this._learnDeviceCbs.push(g);if(0==l){var a=this;this._learnDeviceTO=
setTimeout(function(){var k=a._learnDeviceCbs;a._learnDeviceCbs=[];for(var g=0;g<k.length;g++){var l=k[g];l&&l(Error("learn device timeout"))}},3E4);g=k.substr(6,24);k=k.substring(k.length-32,k.length);k={ADDRESS:g.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:k.toUpperCase()};this._client.setInstallModeWithWhitelist(!0,30,[k],function(k){if(k){a._learnDeviceTO&&(clearTimeout(a._learnDeviceTO),a._learnDeviceTO=null);var g=a._learnDeviceCbs;a._learnDeviceCbs=[];for(var l=0;l<g.length;l++){var h=
g[l];h&&h(k)}}})}};a.prototype.deleteDevice=function(k,g){if(k){var l=k.indexOf(":");-1!=l&&(k=k.substr(0,l));this._client.deleteDevice(k,2,g)}else g&&g(Error("address is empty"))};a.prototype.readValue=function(k,g,a){var l=k+"."+g,h=this._readValueCbs[l];h||(h=[],this._readValueCbs[l]=h);var m=h.length;a&&-1==h.indexOf(a)&&h.push(a);if(0==m){var q=this;this._client.getValue(k,g,null,function(a,h){a||q._updateStatusBuffer(k,g,h);var n=q._readValueCbs[l];delete q._readValueCbs[l];n.forEach(function(k){k&&
k(a,h)})})}};a.prototype.writeValue=function(k,g,a,h){var l=this;this._client.setValue(k,g,a,function(n){n||l._updateStatusBuffer(k,g,a.type?a.value:a);h&&h(n)})};a.prototype.getValuesParamset=function(k,g){this._logger.log("trace","getValuesParamset:"+k);var l=this;this._client.getParamset(k,"VALUES",0,function(a,h){if(a)l._logger.log("trace","getValuesParamset error:"+a.message),g&&g(a);else{if(h){a=0;var n=k.indexOf(":");-1!=n&&(a=k.substr(n+1));for(var m in h)h.hasOwnProperty(m)&&(0==a?"INSTALL_MODE"!=
m&&l._updateStatusBuffer(k,m,h[m]):l._updateStatusBuffer(k,m,h[m]))}l._logger.log("trace","getValuesParamset finish:"+JSON.stringify(h));g&&g(null,h)}})};a.prototype.getParamset=function(k,g,a){this._client.getParamset(k,g,0,function(g,k){a&&a(g,k)})};a.prototype.setParamset=function(g,l,a,h){this._client.putParamset(g,l,a,function(g){h&&h(g)})};a.prototype.reportValueUsage=function(g,l,a,h){this._client.reportValueUsage(g,l,a,function(g,k){h&&h(g,k)})};a.prototype.getDevice=function(g){if(!g)return null;
var k=g,a=g.indexOf(":");-1!=a&&(k=g.substr(0,a));if(!this._devices[k])return null;var h=[];g=this._devices[k];h.push(g);if(g.CHILDREN){var m=this;g.CHILDREN.forEach(function(g){g&&m._devices[g]&&h.push(m._devices[g])})}return(g=this._getDeviceStructs(h))?g[k]:null};a.prototype._getDeviceStructs=function(g){if(!g)return null;var k={},a=this;g.forEach(function(g){if(g.ADDRESS&&g.TYPE)if(!g.PARENT&&g.CHILDREN)k[g.ADDRESS]={type:g.TYPE,"interface":a.interface,address:g.ADDRESS,channels:{}};else if(g.PARENT){var l=
k[g.PARENT];l&&(l.channels[g.ADDRESS]={type:g.TYPE,address:g.ADDRESS})}});return k};a.prototype._updateStatusBuffer=function(g,l,a,h){if("CENTRAL"!=g||"PONG"!=l){if("PRESS_SHORT"==l||"PRESS_LONG"==l||"PRESS_CONT"==l||"PRESS_LONG_RELEASE"==l){var k={};h={value:a,time:(new Date).getTime()};var n=!0}else{var m=this._status[g];m||(m={},this._status[g]=m);k=m[l];k||(k={},m[l]=k);h={value:a,time:h?h:(new Date).getTime()};k&&k.time&&h&&h.time&&k.time>h.time?n=!1:(m[l]=h,n=!0)}m=this.getDevice(g);n&&this.emit("event",
{device:m,"interface":this.interface,channel:g,datapoint:l,value:h,changed:k.value!=h.value,oldValue:k});k=g.indexOf(":");-1!=k&&(h=g.substr(0,k),"1"==g.substr(k+1)&&"STATE"==l&&0==a&&m&&m.channels&&m.channels[h+":2"]&&"POWERMETER"==m.channels[h+":2"].type&&(this._updateStatusBuffer(h+":2","POWER",0),this._updateStatusBuffer(h+":2","CURRENT",0)))}};a.prototype._initNewDeviceStates=function(g,l){if(this._initStates){var k=this,a=function(g,l){g.ADDRESS&&g.PARAMSETS&&-1!=g.PARAMSETS.indexOf("VALUES")?
k.getValuesParamset(g.ADDRESS,l):l()},h=0,m=function(){h++;h<g.length?a(g[h],m):l&&l()};a(g[h],m)}else l&&l()};a.prototype._convertHmIPKeyBase32ToBase16=function(g){g=g.replace(/-/g,"").toUpperCase();var k="0123456789ABCEFGHJKLMNPQRSTUWXYZ".split(""),a=new ArrayBuffer(16);a=new Uint8Array(a);for(var h=0,m=g.length-1,p=0,t=a.length-1,w="";0<=m;){for(var v=0;v<k.length;v++)if(k[v]==g.charAt(m)){h|=v<<p;break}p+=5;for(m--;8<p&&0<=t;)a[t]=h&255,h>>=8,p-=8,t--}for(v=0;v<a.length;v++)16>a[v]&&(w+="0"),
w+=a[v].toString(16);return w.toUpperCase()};a.prototype._xmlrpcCall=function(g,l,a){this._logger.log("trace","receive call:"+g);this._logger.log("trace","params:"+JSON.stringify(l));var k=[],h;switch(g){case "newDevices":if(l[1]){this._initNewDeviceStates(l[1],null);for(h=0;h<l[1].length;h++)(g=l[1][h])&&g.ADDRESS&&(this._devices[g.ADDRESS]=g);g=this._getDeviceStructs(l[1]);try{this.emit("newDevices",g)}catch(t){}if(!l[1]||!l[1][0]||"HM-RCV-50"!=l[1][0].TYPE)for(l=this._learnDeviceCbs,this._learnDeviceCbs=
[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),h=0;h<l.length;h++){var m=l[h];m&&m(null,g)}}break;case "readdedDevice":if(l[1]&&l[1][0])for(h=this.getDevice(l[1][0]),g={},g[l[1][0]]=h,l=this._learnDeviceCbs,this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),0<l.length&&this._client.setInstallMode(!1,null,null,null),h=0;h<l.length;h++)(m=l[h])&&m(null,
g);break;case "listDevices":if(l[1]){l=[];for(h in this._devices)this._devices.hasOwnProperty(h)&&this._devices[h]&&l.push(this._devices[h]);k.push(l)}break;case "deleteDevices":if(l[1])for(h=0;h<l[1].length;h++)if(g=l[1][h])delete this._devices[g],delete this._status[g];break;case "event":this._logger.log("trace","get event:"+JSON.stringify(l)),this._updateStatusBuffer(l[1],l[2],l[3])}a&&a(null,k)};var h=function(g,l,a,h,m,p){x.hub.m.hm._Controller.call(this,g,l,a,h,m,p);this.interface="BidCos-RF";
this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.RF")};h.prototype=new a;h.prototype.constructor=h;h.prototype.listBidcosInterfaces=function(g){this._client.listBidcosInterfaces(function(k,a){g&&g(k,a)})};h.prototype.ping=function(g,l){this._client.ping(g,function(g){l&&l(g)})};var m=function(g,l,a,h,m,p){x.hub.m.hm._Controller.call(this,g,l,a,h,m,p);this.interface="BidCos-Wired";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.Wired")};util.inherits(m,a);var g=
function(g,l,a,h,m,p){x.hub.m.hm._Controller.call(this,g,l,a,h,m,p);this.interface="HmIP-RF";this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IP")};util.inherits(g,a);g.prototype.deleteDevice=function(g,l){var k=g.indexOf(":");-1!=k&&(g=g.substr(0,k));this._client.deleteDevice(g,2,l)};a.getController=function(k,l,a){switch(k){case "BidCos-RF":k=h;break;case "BidCos-Wired":k=m;break;case "HmIP-RF":k=g;break;default:return null}return new k(l.ip,l.port,l.username,l.password,a.useHttps,
a.initStates)};return a}();
x.hub.m.hm.Monitor=function(){var a=function(g,k,l){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.ControllerMonitor");this._type=l;this._monitor=g;this._controller=k;this._xmlrpcServer=null;this._retryWait=1E4;this._retryCount=0;this._retryTO=null;this._state=0;this._err=null};a.prototype.start=function(g,k){0==this._state&&(this._xmlrpcServer=g,this._connect(g));k&&k()};a.prototype.stop=function(g,k){var l=this._state;this._retryTO&&clearTimeout(this._retryTO);this._retryTO=null;
this._state=0;this._err=null;this._retryCount=0;0!=l?this._unregister(g,function(){k&&k()}):k&&k()};a.prototype.getMonitorState=function(){return{state:this._state,error:this._err?this._err.message:null}};a.prototype._connect=function(){this._logger.log("info","start regist "+this._type+" monitor at "+this._controller.getIP()+":"+this._controller.getPort());this._state=1;var g=this;this._register(this._xmlrpcServer,function(k){k?(g._logger.log("warn","regist "+g._type+" monitor at "+g._controller.getIP()+
":"+g._controller.getPort()+" error:"+k.message),g._state=3,g._err=k,g._retryCount++,g._retryTO=setTimeout(function(){g._logger.log("trace","retry timeout for regist "+g._type+" monitor at "+g._controller.getIP()+":"+g._controller.getPort()+" expired");g._connect()},Math.min(6E4,Math.ceil(g._retryCount/10)*g._retryWait))):(g._logger.log("info","regist "+g._type+" monitor at "+g._controller.getIP()+":"+g._controller.getPort()+" success"),g._state=2,g._err=null,g._retryCount=0,g._monitor._onControllerMonitorConnected(g._type))})};
a.prototype._register=function(g,k){var l=this._monitor.localMac.replace(/:/g,""),a="/"+this._monitor.serialNumber;g=g.getPort();this._controller.register("http://"+this._monitor.localIP+":"+(g?g:80)+a,this._monitor.serialNumber+"_"+this._controller.getPort()+"_"+l,k)};a.prototype._unregister=function(g,k){var l="/"+this._monitor.serialNumber;g=g.getPort();this._controller.unregister("http://"+this._monitor.localIP+":"+(g?g:80)+l,k)};var h=function(g){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.PinPongHandler");
this._monitor=g;this._pingWait=3E4;this._pingTO=null;this._pingMiss=0};h.prototype.start=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._startPingTO()};h.prototype.stop=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0};h.prototype._startPingTO=function(){var g=this;this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingTO=setTimeout(function(){g._pingMiss++;4>g._pingMiss?(g._ping(),g._startPingTO()):
g._pingFail()},this._pingWait)};h.prototype._ping=function(g){var k=this._monitor._rfController;k?(this._logger.log("trace","send PING"),k.ping(this._monitor.localMac,function(k){g&&g(k)})):g&&g(Error("no rf controller for ping"))};h.prototype._pingFail=function(){this._logger.log("warn","PING Fail");this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._pingMiss=0;this._monitor._onPingFail()};h.prototype._onPong=function(){this._pingMiss=0};var m=function(g,k){this.ip=g.ip;this.serialNumber=
g.uuid;this.ccuType=g.type;this.ccuType||(this.ccuType=2);this.localIP=k?k.localIP:null;this.localMac=k?k.localMac:null;this.isChip=k?"chip"==k.localChip:!1;this.isCCU3=k?"ccu3"==k.localChip:!1;this.persistant=k?k.persistant:!1;this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor");g={ip:this.ip,port:null,username:g.username,password:g.password};k={useHttps:!1,initStates:this.isChip?!0:!1};g.port=this.isCCU3?32001:2001;this._rfController=x.hub.m.hm._Controller.getController("BidCos-RF",
g,k);this._rfController.on("event",this._onEvent.bind(this));this._rfController.on("newDevices",this._onNewDevices.bind(this));g.port=this.isCCU3?32010:2010;this._ipController=x.hub.m.hm._Controller.getController("HmIP-RF",g,k);this._ipController.on("event",this._onEvent.bind(this));this._ipController.on("newDevices",this._onNewDevices.bind(this));g.port=this.isCCU3?32E3:2E3;this._wiredController=x.hub.m.hm._Controller.getController("BidCos-Wired",g,k);this._wiredController.on("event",this._onEvent.bind(this));
this._wiredController.on("newDevices",this._onNewDevices.bind(this));this._wiredMonitor=this._ipMonitor=this._rfMonitor=null;this._pingpong=new h(this);this._pingTO=this._manager=this._xmlrpcServer=null;this._pingMiss=0;this._wiredRegisted=this._ipRegisted=this._rfRegisted=!1;this._reconnectTO=null;this._reconnectCount=0};util.inherits(m,EventEmitter);m.prototype.getMonitorState=function(g){var k={chip:this.isChip};if(this._rfMonitor){var l=this._rfMonitor.getMonitorState();k.bidcos=l}this._ipMonitor&&
(l=this._ipMonitor.getMonitorState(),k.hmip=l);this._wiredMonitor&&(l=this._wiredMonitor.getMonitorState(),k.bidcos_wired=l);k.bidcos&&2==k.bidcos.state?this._rfController.listBidcosInterfaces(function(l,a){a&&(k.info=a);g&&g(null,k)}):g&&g(null,k)};m.prototype.getAllBufferedStates=function(){var g={},k,l=this._rfController.getAllBufferedStates();if(l)for(k in l)l.hasOwnProperty(k)&&(g[k]=l[k]);if(l=this._wiredController.getAllBufferedStates())for(k in l)l.hasOwnProperty(k)&&(g[k]=l[k]);if(l=this._ipController.getAllBufferedStates())for(k in l)l.hasOwnProperty(k)&&
(g[k]=l[k]);return g};m.prototype.getBufferedDevice=function(g,k){switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:return null}return g.getDevice(k)};m.prototype.getState=function(g,k){if(!(g&&g.interface&&g.channel&&g.datapoint))return k&&k(Error("argument invalid")),null;switch(g.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=
this._ipController;break;default:return null}l.getState(g.channel,g.datapoint,k)};m.prototype.updateState=function(g,k){if(!(g&&g.interface&&g.channel&&g.datapoint))return k&&k(Error("argument invalid")),null;switch(g.interface){case "BidCos-RF":var l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:return null}l.updateState(g.channel,g.datapoint,k)};m.prototype.init=function(g,k){this._logger.log("info","init monitor ("+
this.ip+")");this._xmlrpcServer=g;this._init(k)};m.prototype._init=function(g){var k=this;this.getSerialNumber(function(l){l?g&&g(l):k.register(k._xmlrpcServer,function(){g&&g()})})};m.prototype.update=function(g,k,l,a){l&&this.serialNumber!=l&&(this.serialNumber=l);var h=this;g&&this.ip!=g||k&&this.localIP!=k?this.unregister(this._xmlrpcServer,function(){h.ip=g;h.localIP=k;h.register(h._xmlrpcServer,a)}):a&&a()};m.prototype.finalize=function(g){this.removeAllListeners();this._manager&&this._manager.deleteMonitor(this.ip);
this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null);this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);this.unregister(this._xmlrpcServer,function(){g&&g()})};m.prototype.getSerialNumber=function(g){var k=this;global&&"CCU3"==global.PLATFORM?(this._rfController.setPort(32001),k.getRFInterfaces(function(l,a){l?(k._rfController.setPort(2001),k.getRFInterfaces(function(l,a){l?g&&g():(k.serialNumber=a[0].ADDRESS,g&&g(null,k.serialNumber))})):(k._ipController.setPort(32010),
k._wiredController.setPort(32E3),k.serialNumber=a[0].ADDRESS,g&&g(null,k.serialNumber))})):this.getRFInterfaces(function(l,a){l?g&&g():(k.serialNumber=a[0].ADDRESS,g&&g(null,k.serialNumber))})};m.prototype.getRFInterfaces=function(g){this._rfController.listBidcosInterfaces(function(k,l){g&&g(k,l)})};m.prototype.register=function(g,k){var l=this;g.registServlet("/"+this.serialNumber,function(g,k,a){l._xmlrpcCall(g,k,a)});this._rfMonitor=new a(this,this._rfController,"rf");this._ipMonitor=new a(this,
this._ipController,"ip");this._wiredMonitor=new a(this,this._wiredController,"wired");this._rfMonitor.start(g);this._ipMonitor.start(g);this.isChip||this._wiredMonitor.start(g);k&&k()};m.prototype.unregister=function(g,k){g.unregistServlet("/"+this.serialNumber);this._rfMonitor.stop(g);this._ipMonitor.stop(g);this.isChip||this._wiredMonitor.stop(g);k&&k()};m.prototype._onControllerMonitorConnected=function(g){"rf"==g&&this._pingpong.start()};m.prototype._onPingFail=function(){var g=this;this.unregister(this._xmlrpcServer,
function(){g.register(g._xmlrpcServer,function(){})})};m.prototype._onPong=function(){this._pingpong._onPong()};m.prototype.reset=function(g){var k=this;this._rfController.reset(function(){k._ipController.reset(function(){k._wiredController.reset(function(){g&&g()})})})};m.prototype.learnRF=function(g){this._rfController.learnNewDevice(function(k,l){g&&g(k,l)})};m.prototype.learnRFSN=function(g,k){this._rfController.learnNewDeviceSN(g,function(g,a){k&&k(g,a)})};m.prototype.learnIP=function(g,k,l){this._ipController.learnNewIPDevice(g,
k,function(g,k){l&&l(g,k)})};m.prototype.learnIPQR=function(g,k){this._ipController.learnNewIPDeviceQR(g,function(g,a){k&&k(g,a)})};m.prototype.deleteDevice=function(g,k,a){if(!g||!k)return a&&a(Error("argument invalid")),null;switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:a&&a(Error("no such interface"));return}g.deleteDevice(k,a)};m.prototype.getDevices=function(g){var k=0;this._rfController&&
k++;this._ipController&&k++;this._wiredController&&k++;var a=[],h=function(l){k--;l?g&&g(l):0==k&&g&&g(null,a)},n=this;this._rfController&&this._rfController.getBufferedDevices(function(g,k){g?(h&&h(g),h=null):(a=a.concat(n._parseDevices(k,"BidCos-RF")),h&&h())});this._ipController&&this._ipController.getBufferedDevices(function(g,k){g?(h&&h(g),h=null):(a=a.concat(n._parseDevices(k,"HmIP-RF")),h&&h())});this._wiredController&&this._wiredController.getBufferedDevices(function(g,k){g?(h&&h(g),h=null):
(a=a.concat(n._parseDevices(k,"BidCos-Wired")),h&&h())})};m.prototype.getParamset=function(g,k,a,h){if(g&&k&&a){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:h&&h(Error("unknow interface"));return}l.getParamset(k,a,function(g,k){h&&h(g,k)})}else h&&h(Error("argument invalid"))};m.prototype.setParamset=function(g,k,a,h,n){if(g&&k&&a&&h){var l=null;switch(g){case "BidCos-RF":l=this._rfController;
break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:n&&n(Error("unknow interface"));return}l.setParamset(k,a,h,function(g,k){n&&n(g,k)})}else n&&n(Error("argument invalid"))};m.prototype.readValue=function(g,k,a,h){if(g&&k&&a){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:h&&h(Error("unknow interface"));return}l.readValue(k,a,
function(g,k){h&&h(g,k)})}else h&&h(Error("argument invalid"))};m.prototype.writeValue=function(g,k,a,h,n){if(g&&k&&a){var l=null;switch(g){case "BidCos-RF":l=this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:n&&n(Error("unknow interface"));return}l.writeValue(k,a,h,function(g){n&&n(g)})}else n&&n(Error("argument invalid"))};m.prototype.reportValueUsage=function(g,k,a,h){if(g&&k&&a){var l=null;switch(g){case "BidCos-RF":l=
this._rfController;break;case "BidCos-Wired":l=this._wiredController;break;case "HmIP-RF":l=this._ipController;break;default:h&&h(Error("unknow interface"));return}l.reportValueUsage(k,a,1,function(g,k){h&&h(g,k)})}else h&&h(Error("argument invalid"))};m.prototype.updateStatusBuffer=function(g,k,a,h,n){if(g&&k&&a){switch(g){case "BidCos-RF":g=this._rfController;break;case "BidCos-Wired":g=this._wiredController;break;case "HmIP-RF":g=this._ipController;break;default:return}g._updateStatusBuffer(k,
a,h,n)}};m.prototype._parseDevices=function(g,k){k||(k="BidCos-RF");var a=new (require("xnm.aio.hm.js").CCU),h={},n;for(n in g)if(g.hasOwnProperty(n)){var m=g[n],p={typename:"DEVICE",hsstype:m.TYPE,address:m.ADDRESS,interface:k,rfAddr:m.RF_ADDRESS,channels:{}};if(m.CHILDREN)for(var t=0,w=m.CHILDREN.length;t<w;t++){var v=m.CHILDREN[t];p.channels[v]={hsstype:g[v].TYPE,address:v}}h[n]=p}return a._parseDevices(h)};m.prototype._xmlrpcCall=function(g,k,a){this._logger.log("trace","receive call:"+g);this._logger.log("trace",
"params:"+JSON.stringify(k));if("event"==g&&"CENTRAL"==k[1]&&"PONG"==k[2])this._onPong(),a&&a(null,[]);else{var h=k[0].split("_");3<=h.length?(h=h[1],-1!=h.indexOf("2001")&&this._rfController?this._rfController._xmlrpcCall(g,k,a):-1!=h.indexOf("2010")&&this._ipController?this._ipController._xmlrpcCall(g,k,a):-1!=h.indexOf("2000")&&this._wiredController?this._wiredController._xmlrpcCall(g,k,a):a&&a(null,[])):a&&a(null,[])}};m.prototype._onNewDevices=function(g){this._logger.log("debug","find new devices");
this._logger.log("debug",JSON.stringify(g));this.emit("new_devices",g)};m.prototype._onEvent=function(g){this._logger.log("trace","receive event:"+JSON.stringify(g));this._logger.log("debug","EVENT:\t"+g.interface+"\t"+g.device.type+"\t"+g.channel+"\t"+g.datapoint+"\t"+g.value.value);g.ip=this.ip;g.serialNumber=this.serialNumber;this.emit("event",g,this)};return m}();
x.hub.m.hm.MonitorManager=function(){var a=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.MonitorManager");this._monitors=[];this._xmlrpcServer=null;this._tmpMonitors={};this._monitorEvtListener=this.onDeviceEvent.bind(this)};a.prototype.init=function(a,m){this._xmlrpcServer=a;m&&m()};a.prototype.startMonitorForIP=function(a,m,g){this.startMonitor({ip:a},{localIP:m},g)};a.prototype.startMonitor=function(a,m,g){if(this._xmlrpcServer)if(a&&a.ip){var k=this.getMonitor(a.ip,a.uuid);
if(k)g&&g();else if(m||(m={}),m.localIP||(m.localIP=x.hub.m.hm._Util.getLocalIP(null,a.ip)),m.localIP){m.localMac||(m.localMac=x.hub.m.hm._Util.getLocalMac(m.localIP));var h=a.ip;this._tmpMonitors[h]||(this._tmpMonitors[h]=[]);var q=this._tmpMonitors[h].length,n=this._tmpMonitors[h];g||(g=function(){});-1==n.indexOf(g)&&n.push(g);if(!(0<q)){var r=this;k=new x.hub.m.hm.Monitor(a,m);k._manager=this;k.init(this._xmlrpcServer,function(g){g||(r._monitors.push(k),k.on("event",r._monitorEvtListener));var a=
r._tmpMonitors[h];delete r._tmpMonitors[h];a.forEach(function(k){k&&k(g)})})}}else g&&g(Error("local ip address invalid"))}else g&&g(Error("gateway invalid"));else g&&g(Error("xml rpc server not started"))};a.prototype.getAllMonitor=function(){return this._monitors};a.prototype.getMonitor=function(a,m){var g=null,k=null;this._monitors.forEach(function(h){h&&h.ip==a&&(g=h);h&&h.serialNumber==m&&(k=h)});return k?k:g};a.prototype.getMonitorStates=function(a){if(0==this._monitors.length)a&&a(null,[]);
else{var h=this,g=0,k=[],l=function(m,n){!m&&n&&(n.ip=h._monitors[g].ip,n.serialNumber=h._monitors[g].serialNumber,k.push(n));g++;g<h._monitors.length?h._monitors[g].getMonitorState(l):a&&a(null,k)};this._monitors[g].getMonitorState(l)}};a.prototype.deleteMonitor=function(a){for(var h=-1,g=0,k=this._monitors.length;g<k;g++){var l=this._monitors[g];if(l&&l.ip==a){h=g;break}}-1!=g&&this._monitors.splice(h,1)};a.prototype.onFindHomeMatic=function(a,m,g){var k=this.getMonitor(null,g),h=this.getMonitor(a);
h?(h.update(a,m,g),k&&k!=h&&(k.finalize(),this.deleteMonitor(k.ip))):(k&&(k.finalize(),this.deleteMonitor(k.ip)),this.startMonitorForIP(a,m))};a.prototype.onDeviceEvent=function(a,m){require("x.hub.m.hm.js").onDeviceEvent(a,m.isChip)};return a}();
x.hub.m.hm._Channel=function(){var a=function(){var g=[];this.map.forEach(function(k){k&&k.dpt&&k.state&&0<k.state.length&&-1==g.indexOf(k.dpt)&&g.push(k.dpt)});return g},h=function(g){var k=null;this.map.forEach(function(a){a&&a.dpt&&a.state&&-1!=a.state.indexOf(g)&&(k=a.dpt)});return k},m=function(g){var k=null;this.map.forEach(function(a){a&&a.dpt&&a.command&&-1!=a.command.indexOf(g)&&(k=a.dpt)});return k};return{"HmIP-RF":{T_MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},
{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]},{dpt:"ACTUAL_TEMPERATURE",state:["maintainTemp"],event:["maintainTemp"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){switch(g){case "UNREACH":return{timeout:k};case "LOW_BAT":return{lowbat:k};
case "SABOTAGE":return{sabotage:k};case "OPERATING_VOLTAGE":return{voltage:parseFloat(k)};case "ERROR_CODE":return{errorCode:parseInt(k)};case "ACTUAL_TEMPERATURE":return{maintainTemp:parseFloat(k)}}return null}},MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){switch(g){case "UNREACH":return{timeout:k};case "LOW_BAT":return{lowbat:k};
case "SABOTAGE":return{sabotage:k}}return null}},MAINTENANCE_BAT_EL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){switch(g){case "UNREACH":return{timeout:k};
case "LOW_BAT":return{lowbat:k};case "SABOTAGE":return{sabotage:k};case "OPERATING_VOLTAGE":return{voltage:parseFloat(k)};case "ERROR_CODE":return{errorCode:parseInt(k)};case "SENSOR_ERROR":return{sensorError:k}}return null}},MAINTENANCE_BAT_CL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"ERROR_NON_FLAT_POSITIONING",state:["sabotage"],event:["sabotage"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){switch(g){case "UNREACH":return{timeout:k};
case "LOW_BAT":return{lowbat:k};case "ERROR_NON_FLAT_POSITIONING":return{sabotage:k}}return null}},SWITCH_TRANSMITTER:{map:[{dpt:"STATE",state:["switchTState"],event:["switchTState"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "STATE":a=1==k?{switchTState:"on"}:0==k?{switchTState:"off"}:{switchTState:"?"}}return a}},SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"STATE",state:["switchState"],event:["switchState"],command:["on","off","toggle"]}],getReadableDpts:a,
getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "STATE":a=1==k?{switchState:"on"}:0==k?{switchState:"off"}:{switchState:"?"}}return a},executeCommand:function(g,k,a,h,n){var l=m.call(this,h);"onFor"==h.substr(0,5)&&(l="STATE");if(l)switch(h){case "on":g.writeValue(k,a,l,!0,n);break;case "off":g.writeValue(k,a,l,!1,n);break;case "toggle":g.getState({interface:k,channel:a,datapoint:l},function(h,m){h?n&&n(h):m?(h=!0,m.value&&(h=!1),g.writeValue(k,a,l,h,n)):n&&n(Error("get switch current value return invalid"))});
break;default:"onFor"==h.substr(0,5)?(h=parseFloat(h.substr(5)),isNaN(h)?n&&n(Error("onFor command invalid")):(l="ON_TIME",g.writeValue(k,a,l,{type:"double",value:h},function(h){h?n&&n(h):(l="STATE",g.writeValue(k,a,l,!0,n))}))):n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}},ENERGIE_METER_TRANSMITTER:{map:[{dpt:"ENERGY_COUNTER",state:["meterEnergyCounter"],event:["meterEnergyCounter"]},{dpt:"POWER",state:["meterPower"],event:["meterPower"]},{dpt:"CURRENT",
state:["meterCurrent"],event:["meterCurrent"]},{dpt:"VOLTAGE",state:["meterVoltage"],event:["meterVoltage"]},{dpt:"FREQUENCY",state:["meterFrequency"],event:["meterFrequency"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){switch(g){case "ENERGY_COUNTER":return{meterEnergyCounter:parseFloat(k).toFixed(2)};case "POWER":return{meterPower:parseFloat(k).toFixed(2)};case "CURRENT":return{meterCurrent:parseFloat(k).toFixed(2)};case "VOLTAGE":return{meterVoltage:parseFloat(k).toFixed(2)};
case "FREQUENCY":return{meterFrequency:parseFloat(k).toFixed(2)}}return null}},DIMMER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["dimmerTLevel"],event:["dimmerTLevel"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "LEVEL":a={dimmerTLevel:Math.round(100*parseFloat(k))};break;case "COLOR":a={dimmerTColor:"off blue green torqoise red purple yellow white".split(" ")[parseInt(k)]}}return a}},DIMMER_VIRTUAL_RECEIVER:{map:[{dpt:"LEVEL",state:["dimmerLevel"],event:["dimmerLevel"],
command:["dimOff","dimUp","dimDown","dimTo","toggleTo"]},{dpt:"COLOR",state:["dimmerColor"],event:["dimmerColor"],command:["colorTo"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "LEVEL":a={dimmerLevel:Math.round(100*parseFloat(k))}}return a},executeCommand:function(g,k,a,h,n){if(h){if("dimOff"==h.substr(0,6))var l="dimOff";else if("dimUp"==h.substr(0,5)){l="dimUp";var p=h.substr(5)}else if("dimDown"==h.substr(0,7))l="dimDown",p=h.substr(7);else if("dimTo"==
h.substr(0,5)){if(l="dimTo",p=h.substr(5),!p){n&&n(Error("dimTo has no value"));return}}else if("toggleTo"==h.substr(0,8)){if(l="toggleTo",p=h.substr(8),!p){n&&n(Error("toggleTo has no value"));return}}else if("colorTo"==h.substr(0,7)&&(l="colorTo",p=h.substr(7),!p)){n&&n(Error("colorTo has no value"));return}var q=m.call(this,l);if(q)switch(l){case "dimOff":g.writeValue(k,a,q,{type:"double",value:0},n);break;case "dimUp":p||(p=10);p=parseInt(p)/100;g.getState({interface:k,channel:a,datapoint:q},
function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(k,a,q,{type:"double",value:p},n))});break;case "dimDown":p||(p=10);p=parseInt(p)/100;g.getState({interface:k,channel:a,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(k,a,q,{type:"double",value:p},n))});break;case "toggleTo":p=parseInt(p)/100;
g.getState({interface:k,channel:a,datapoint:q},function(h,l){h?n&&n(h):l?(l.value&&(p=0),g.writeValue(k,a,q,{type:"double",value:p},n)):n&&n(Error("get switch current value return invalid"))});break;case "dimTo":p=parseInt(p)/100;g.writeValue(k,a,q,{type:"double",value:p},n);break;case "colorTo":p=p.toLowerCase();p="off blue green torqoise red purple yellow white".split(" ").indexOf(p);if(-1==p){n&&n(Error("unknown color"));break}g.writeValue(k,a,q,{type:"double",value:p},n);break;default:n&&n(Error("no such command"))}else n&&
n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},MOTIONDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_MOTION",command:["reset"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"MOTION_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "MOTION":a={state:k?
"on":"off"};break;case "ILLUMINATION":a={illumination:k};break;case "MOTION_DETECTION_ACTIVE":a={active:k}}return a},executeCommand:function(g,k,a,h,n){if(h){var l=m.call(this,h);if(l)switch(h){case "reset":g.writeValue(k,a,l,!0,n);break;case "activate":g.writeValue(k,a,l,!0,n);break;case "deactivate":g.writeValue(k,a,l,!1,n);break;case "toggleActivate":g.getState({interface:k,channel:a,datapoint:l},function(h,m){h?n&&n(h):m?(h=!0,m.value&&(h=!1),g.writeValue(k,a,l,h,n)):n&&n(Error("get switch current value return invalid"))});
break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},KEY_TRANRECEIVER:{map:[{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){k=null;switch(g){case "PRESS_SHORT":k={pressShort:!0};break;case "PRESS_LONG":k={pressLong:!0}}return k}},ALARM_SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"ACOUSTIC_ALARM_SELECTION",command:["setAudio"]},
{dpt:"OPTICAL_ALARM_SELECTION",command:["setVisual"]},{dpt:"DURATION_UNIT",command:["setDuraionUnit"]},{dpt:"DURATION_VALUE",command:["setDuraion"]},{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "STATE":a=1==k?{state:"on"}:0==k?{state:"off"}:{state:"?"}}return a},executeCommand:function(g,k,a,h,n){if(h){var l=null;if("triggerAlarm"==h.substr(0,12)){l="triggerAlarm";var p=h.substr(12);if(!p){n&&n(Error("triggerAlarm format invalid"));
return}}if(m.call(this,l)||"triggerAlarm"==l)switch(l){case "triggerAlarm":var q=p.split(",");if(4>q.length){n&&n(Error("triggerAlarm format invalid"));break}g.writeValue(k,a,"ACOUSTIC_ALARM_SELECTION",{type:"double",value:parseInt(q[0])},function(h,l){h?n&&n(h):g.writeValue(k,a,"OPTICAL_ALARM_SELECTION",{type:"double",value:parseInt(q[1])},function(h,l){h?n&&n(h):g.writeValue(k,a,"DURATION_VALUE",{type:"double",value:parseInt(q[2])},function(h,l){h?n&&n(h):g.writeValue(k,a,"DURATION_UNIT",{type:"double",
value:parseInt(q[3])},n)})})});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},HEATING_CLIMATECONTROL_TRANSCEIVER:{map:[{dpt:"SET_POINT_TEMPERATURE",command:["tempTo","tempUp","tempDown"],state:["state"],event:["state"]},{dpt:"HUMIDITY",state:["hum"],event:["hum"]},{dpt:"CONTROL_MODE",command:["auto","manu"]},{dpt:"FROST_PROTECTION",state:["frost"],event:["frost"]},{dpt:"SET_POINT_MODE",state:["mode"],event:["mode"]},
{dpt:"ACTIVE_PROFILE",command:["setProfile"],state:["profile"],event:["profile"]},{dpt:"WINDOW_STATE",command:["winOpen","winClose"],state:["window"],event:["window"]},{dpt:"ACTUAL_TEMPERATURE",state:["temp"],event:["temp"]},{dpt:"BOOST_MODE",command:["boostOn","boostOff"],state:["boost"],event:["boost"]},{dpt:"LEVEL",command:["setValve","valveUp","valveDown"],state:["valve"],event:["valve"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a={};switch(g){case "ACTIVE_PROFILE":a.profile=
parseInt(k);break;case "ACTUAL_TEMPERATURE":a.temp=parseFloat(k);break;case "BOOST_MODE":a.boost=k;break;case "FROST_PROTECTION":a.frost=k;break;case "HUMIDITY":a.hum=parseInt(k);break;case "SET_POINT_MODE":0==k?a.mode="auto":1==k&&(a.mode="manu");break;case "SET_POINT_TEMPERATURE":a.state=parseFloat(k);break;case "LEVEL":a.valve=Math.round(100*parseFloat(k));break;case "WINDOW_STATE":switch(k){case 0:a.window="closed";break;case 1:a.window="open"}break;default:return null}return a},executeCommand:function(g,
k,a,h,n){if(h){var l=h;if("tempTo"==h.substr(0,6)){l="tempTo";var p=h.substr(6);if(!p){n&&n(Error("tempTo has no value"));return}}else if("tempUp"==h.substr(0,6))l="tempUp",p=h.substr(6);else if("tempDown"==h.substr(0,8))l="tempDown",p=h.substr(8);else if("setProfile"==h.substr(0,10)){if(l="setProfile",p=h.substr(10),!p){n&&n(Error("setProfile has no value"));return}}else if("setValve"==h.substr(0,8)){if(l="setValve",p=h.substr(8),!p){n&&n(Error("setValve has no value"));return}}else"valveUp"==h.substr(0,
7)?(l="valveUp",p=h.substr(7)):"valveDown"==h.substr(0,9)&&(l="valveDown",p=h.substr(9));var q=m.call(this,l);if(q)switch(l){case "tempTo":p=parseFloat(p);if(isNaN(p)){n&&n(Error("tempTo value invalid"));break}30.5<p&&(p=30.5);4.5>p&&(p=4.5);g.writeValue(k,a,q,{type:"double",value:p},n);break;case "tempUp":p||(p=1);p=parseFloat(p);if(isNaN(p)){n&&n(Error("tempUp value invalid"));break}g.getState({interface:k,channel:a,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):
(p=l.value+p,30.5<p&&(p=30.5),g.writeValue(k,a,q,{type:"double",value:p},n))});break;case "tempDown":p||(p=1);p=parseFloat(p);if(isNaN(p)){n&&n(Error("tempDown value invalid"));break}g.getState({interface:k,channel:a,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,4.5>p&&(p=4.5),g.writeValue(k,a,q,{type:"double",value:p},n))});break;case "auto":g.writeValue(k,a,q,{type:"double",value:0},n);break;case "manu":g.writeValue(k,
a,q,{type:"double",value:1},n);break;case "setProfile":p=parseInt(p);if(isNaN(p)){n&&n(Error("setTemp value invalid"));break}g.writeValue(k,a,q,p,n);break;case "winOpen":g.writeValue(k,a,q,1,n);break;case "winClose":g.writeValue(k,a,q,0,n);break;case "boostOn":g.writeValue(k,a,q,!0,n);break;case "boostOff":g.writeValue(k,a,q,!1,n);break;case "setValve":p=parseInt(p);if(isNaN(p)){n&&n(Error("setValve value invalid"));break}p/=100;1<p&&(p=1);0>p&&(p=0);g.writeValue(k,a,q,{type:"double",value:p},n);
break;case "valveUp":p||(p=10);p=parseInt(p);if(isNaN(p)){n&&n(Error("tempUp value invalid"));break}p/=100;g.getState({interface:k,channel:a,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(k,a,q,{type:"double",value:p},n))});break;case "valveDown":p||(p=10);p=parseInt(p);if(isNaN(p)){n&&n(Error("tempUp value invalid"));break}p/=100;g.getState({interface:k,channel:a,datapoint:q},function(h,
l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(k,a,q,{type:"double",value:p},n))});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},SHUTTER_CONTACT_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "STATE":a={state:0==
k?"closed":"open"}}return a}},SMOKE_DETECTOR:{map:[{dpt:"SMOKE_DETECTOR_COMMAND",command:"reservedAlarmOff intrusionAlarmOff intrusionAlarmOn smokeTest commTest commTestRepeated".split(" ")},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["state"],event:["state"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["alarmDetail"],event:["alarmDetail"]},{dpt:"SMOKE_DETECTOR_TEST_RESULT",state:["testResult"],event:["testResult"]},{dpt:"ERROR_CODE",state:["error"],event:["error"]}],getReadableDpts:a,getDptFromState:h,
parseDptState:function(g,k){var a=null;switch(g){case "SMOKE_DETECTOR_ALARM_STATUS":a={state:0==k?"ok":"smoke"};a.alarmDetail=k;break;case "SMOKE_DETECTOR_TEST_RESULT":switch(k){case 0:a={testResult:"none"};break;case 1:a={testResult:"smoke_ok"};break;case 2:a={testResult:"smoke_nok"};break;case 3:a={testResult:"comm_sent"};break;case 4:a={testResult:"comm_ok"}}break;case "ERROR_CODE":a={error:k}}return a},executeCommand:function(g,k,a,h,n){if(h){var l=m.call(this,h);if(l)switch(h){case "reservedAlarmOff":case "intrusionAlarmOff":case "intrusionAlarmOn":case "smokeTest":case "commTest":case "commTestRepeated":switch(h){case "reservedAlarmOff":var p=
0;break;case "intrusionAlarmOff":p=1;break;case "intrusionAlarmOn":p=2;break;case "smokeTest":p=3;break;case "commTest":p=4;break;case "commTestRepeated":p=5}g.writeValue(k,a,l,p,n);break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},ROTARY_HANDLE_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "STATE":switch(k){case 0:a=
{state:"closed"};break;case 1:a={state:"tilted"};break;case 2:a={state:"open"}}}return a}},SHUTTER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTLevel"],event:["blindTLevel"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "LEVEL":a={blindTLevel:Math.round(100*parseFloat(k))}}return a}},SHUTTER_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindLevel"],event:["blindLevel"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]}],
getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "LEVEL":a={blindLevel:Math.round(100*parseFloat(k))}}return a},executeCommand:function(g,k,a,h,n){if(h){if("moveUp"==h.substr(0,6))var l="moveUp";else if("moveDown"==h.substr(0,8)){l="moveDown";var p=h.substr(8)}else if("stepUp"==h.substr(0,6))l="stepUp",p=h.substr(6);else if("stepDown"==h.substr(0,8))l="stepDown",p=h.substr(8);else if("moveTo"==h.substr(0,6)){if(l="moveTo",p=h.substr(6),!p){n&&n(Error("moveTo has no value"));
return}}else"stop"==h.substr(0,4)&&(l="stop");var q=m.call(this,l);if(q)switch(l){case "moveUp":g.writeValue(k,a,q,{type:"double",value:1},n);break;case "moveDown":g.writeValue(k,a,q,{type:"double",value:0},n);break;case "stop":g.writeValue(k,a,q,!0,n);break;case "stepUp":p||(p=5);p=parseInt(p)/100;g.getState({interface:k,channel:a,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value+p,1<p&&(p=1),g.writeValue(k,a,q,{type:"double",
value:p},n))});break;case "stepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:k,channel:a,datapoint:q},function(h,l){h?n&&n(h):"undefined"==typeof l||null==l?n&&n(Error("get dimmer current value return invalid")):(p=l.value-p,0>p&&(p=0),g.writeValue(k,a,q,{type:"double",value:p},n))});break;case "moveTo":p=parseInt(p)/100;g.writeValue(k,a,q,{type:"double",value:p},n);break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},
BLIND_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTPos"],event:["blindTPos"]},{dpt:"LEVEL_2",state:["lamellaTPos"],event:["lamellaTPos"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "LEVEL":a={blindTPos:Math.round(100*parseFloat(k))};break;case "LEVEL_2":a={lamellaTPos:Math.round(100*parseFloat(k))}}return a}},BLIND_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindPos"],event:["blindPos"],command:["moveUp","moveDown","stepUp",
"stepDown","moveTo"]},{dpt:"LEVEL_2",state:["lamellaPos"],event:["lamellaPos"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "LEVEL":a={blindPos:Math.round(100*parseFloat(k))};break;case "LEVEL_2":a={lamellaPos:Math.round(100*parseFloat(k))}}return a},executeCommand:function(g,k,a,h,n){if(h){var l=h;if("lamellaStepUp"==h.substr(0,13)){l="lamellaStepUp";var p=h.substr(13)}else if("lamellaStepDown"==
h.substr(0,15))l="lamellaStepDown",p=h.substr(15);else if("lamellaTo"==h.substr(0,9)){if(l="lamellaTo",p=h.substr(9),!p){n&&n(Error("lamellaTo has no value"));return}}else if("stepUp"==h.substr(0,6))l="stepUp",p=h.substr(6);else if("stepDown"==h.substr(0,8))l="stepDown",p=h.substr(8);else if("moveTo"==h.substr(0,6)){if(l="moveTo",p=h.substr(6),!p){n&&n(Error("moveTo has no value"));return}}else"stop"==h.substr(0,4)&&(l="stop");var q=m.call(this,l);if(q)switch(l){case "moveUp":case "moveDown":g.writeValue(k,
a,"LEVEL_2",{type:"double",value:"moveUp"==l?1:0},function(h){h?n&&n(h):g.writeValue(k,a,"LEVEL",{type:"double",value:"moveUp"==l?1:0},function(g){n&&n(g)})});break;case "stop":g.writeValue(k,a,q,!0,n);break;case "moveTo":p=parseInt(p)/100;g.writeValue(k,a,"LEVEL",{type:"double",value:p},n);break;case "lamellaUp":case "lamellaDown":g.getState({interface:k,channel:a,datapoint:"LEVEL"},function(h,m){h?n&&n(h):g.writeValue(k,a,"LEVEL",{type:"double",value:m.value},function(h){h?n&&n(h):g.writeValue(k,
a,"LEVEL_2",{type:"double",value:"lamellaUp"==l?1:0},function(g){n&&n(g)})})});break;case "stepUp":case "stepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:k,channel:a,datapoint:"LEVEL"},function(h,m){h?n&&n(h):"undefined"==typeof m||null==m?n&&n(Error("get jalousie current value return invalid")):(p="stepUp"==l?m.value+p:m.value-p,1<p&&(p=1),0>p&&(p=0),g.writeValue(k,a,"LEVEL",{type:"double",value:p},n))});break;case "lamellaStepUp":case "lamellaStepDown":p||(p=5);p=parseInt(p)/100;g.getState({interface:k,
channel:a,datapoint:"LEVEL"},function(h,m){if(h)n&&n(h);else if("undefined"==typeof m||null==m)n&&n(Error("get jalousie current value return invalid"));else{var q=m.value;g.getState({interface:k,channel:a,datapoint:"LEVEL_2"},function(h,m){h?n&&n(h):"undefined"==typeof m||null==m?n&&n(Error("get jalousie current value return invalid")):(p="lamellaStepUp"==l?m.value+p:m.value-p,1<p&&(p=1),0>p&&(p=0),g.writeValue(k,a,"LEVEL_2",{type:"double",value:p},function(h){h?n&&n(h):g.writeValue(k,a,"LEVEL",{type:"double",
value:q},n)}))})}});break;case "lamellaTo":p=parseInt(p)/100;g.writeValue(k,a,"LEVEL_2",{type:"double",value:p},n);break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},PRESENCEDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_PRESENCE",command:["reset"]},{dpt:"PRESENCE_DETECTION_STATE",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"CURRENT_ILLUMINATION",state:["current_illumination"],
event:["current_illumination"]},{dpt:"PRESENCE_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "PRESENCE_DETECTION_STATE":a={state:k?"on":"off"};break;case "ILLUMINATION":a={illumination:k};break;case "CURRENT_ILLUMINATION":a={current_illumination:k};break;case "PRESENCE_DETECTION_ACTIVE":a={active:k}}return a},executeCommand:function(g,k,a,h,n){if(h){var l=
m.call(this,h);if(l)switch(h){case "reset":g.writeValue(k,a,l,!0,n);break;case "activate":g.writeValue(k,a,l,!0,n);break;case "deactivate":g.writeValue(k,a,l,!1,n);break;case "toggleActivate":g.getState({interface:k,channel:a,datapoint:l},function(h,m){h?n&&n(h):m?(h=!0,m.value&&(h=!1),g.writeValue(k,a,l,h,n)):n&&n(Error("get switch current value return invalid"))});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+h))}else n&&n(Error("command in null"))}},
CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER:{map:[{dpt:"EMERGENCY_OPERATION",state:["cl_fd_emergencyOP"],event:["cl_fd_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fd_frostProtection"],event:["cl_fd_frostProtection"]},{dpt:"STATE",state:["cl_fd_state"],event:["cl_fd_state"]},{dpt:"HUMIDITY_ALARM",state:["cl_fd_humidityAlarm"],event:["cl_fd_humidityAlarm"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "EMERGENCY_OPERATION":a={cl_fd_emergencyOP:k};break;
case "FROST_PROTECTION":a={cl_fd_frostProtection:k};break;case "STATE":a=1==k?{cl_fd_state:"on"}:0==k?{cl_fd_state:"off"}:{cl_fd_state:"?"};break;case "HUMIDITY_ALARM":a={cl_fd_humidityAlarm:k}}return a}},CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_fp_humidityLimiter"],event:["cl_fp_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_fp_emergencyOP"],event:["cl_fp_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fp_frostProtection"],event:["cl_fp_frostProtection"]},
{dpt:"STATE",state:["cl_fp_state"],event:["cl_fp_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_fp_dewPointAlarm"],event:["cl_fp_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_fp_externalClock"],event:["cl_fp_externalClock"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "HUMIDITY_LIMITER":a={cl_fp_humidityLimiter:k};break;case "EMERGENCY_OPERATION":a={cl_fp_emergencyOP:k};break;case "FROST_PROTECTION":a={cl_fp_frostProtection:k};break;case "STATE":a=1==
k?{cl_fp_state:"on"}:0==k?{cl_fp_state:"off"}:{cl_fp_state:"?"};break;case "DEW_POINT_ALARM":a={cl_fp_dewPointAlarm:k};break;case "EXTERNAL_CLOCK":a={cl_fp_externalClock:k}}return a}},CLIMATECONTROL_FLOOR_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_f_humidityLimiter"],event:["cl_f_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_f_emergencyOP"],event:["cl_f_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_f_frostProtection"],event:["cl_f_frostProtection"]},{dpt:"STATE",state:["cl_f_state"],
event:["cl_f_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_f_dewPointAlarm"],event:["cl_f_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_f_externalClock"],event:["cl_f_externalClock"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "HUMIDITY_LIMITER":a={cl_f_humidityLimiter:k};break;case "EMERGENCY_OPERATION":a={cl_f_emergencyOP:k};break;case "FROST_PROTECTION":a={cl_f_frostProtection:k};break;case "STATE":a=1==k?{cl_f_state:"on"}:0==k?{cl_f_state:"off"}:
{cl_f_state:"?"};break;case "DEW_POINT_ALARM":a={cl_f_dewPointAlarm:k};break;case "EXTERNAL_CLOCK":a={cl_f_externalClock:k}}return a}},WEATHER_TRANSMIT:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["weatherActualTemp"],event:["weatherActualTemp"]},{dpt:"HUMIDITY",state:["weatherHum"],event:["weatherHum"]},{dpt:"ILLUMINATION",state:["weatherIllu"],event:["weatherIllu"]},{dpt:"SUNSHINEDURATION",state:["weatherSunD"],event:["weatherSunD"]},{dpt:"SUNSHINEDURATION_OVERFLOW",state:["weatherSunDOF"],event:["weatherSunDOF"]},
{dpt:"SUNSHINE_THRESHOLD_OVERRUN",state:["weatherSunTOR"],event:["weatherSunTOR"]},{dpt:"WIND_SPEED",state:["weatherWindS"],event:["weatherWindS"]},{dpt:"WIND_THRESHOLD_OVERRUN",state:["weatherWindTOR"],event:["weatherWindTOR"]},{dpt:"WIND_DIR",state:["weatherWindD"],event:["weatherWindD"]},{dpt:"WIND_DIR_RANGE",state:["weatherWindDR"],event:["weatherWindDR"]},{dpt:"RAINING",state:["weatherRain"],event:["weatherRain"]},{dpt:"RAIN_COUNTER",state:["weatherRainC"],event:["weatherRainC"]},{dpt:"RAIN_COUNTER_OVERFLOW",
state:["weatherRainCOF"],event:["weatherRainCOF"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "ACTUAL_TEMPERATURE":a={weatherActualTemp:k};break;case "HUMIDITY":a={weatherHum:k};break;case "ILLUMINATION":a={weatherIllu:k};break;case "SUNSHINEDURATION":a={weatherSunD:k};break;case "SUNSHINEDURATION_OVERFLOW":a={weatherSunDOF:k};break;case "SUNSHINE_THRESHOLD_OVERRUN":a={weatherSunTOR:k};break;case "WIND_SPEED":a={weatherWindS:k};break;case "WIND_THRESHOLD_OVERRUN":a=
{weatherWindTOR:k};break;case "RAINING":a={weatherRain:k};break;case "RAIN_COUNTER":a={weatherRainC:k};break;case "RAIN_COUNTER_OVERFLOW":a={weatherRainCOF:k};break;case "WIND_DIR":a={weatherWindD:k};break;case "WIND_DIR_RANGE":a={weatherWindDR:k}}return a}},CLIMATE_TRANSCEIVER:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["temperature"],event:["temperature"]},{dpt:"HUMIDITY",state:["humidity"],event:["humidity"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,k){var a=null;switch(g){case "ACTUAL_TEMPERATURE":a=
{temperature:k};break;case "HUMIDITY":a={humidity:k}}return a}},PASSAGE_DETECTOR_DIRECTION_TRANSMITTER:{map:[{dpt:"CURRENT_PASSAGE_DIRECTION",state:["current_direction"],event:["current_direction"]},{dpt:"LAST_PASSAGE_DIRECTION",state:["last_direction"],event:["last_direction"]},{dpt:"PASSAGE_COUNTER_OVERFLOW",state:["passage_counter_overflow"],event:["passage_counter_overflow"]},{dpt:"PASSAGE_COUNTER_VALUE",state:["passage_counter"],event:["passage_counter"]}],getReadableDpts:a,getDptFromState:h,
parseDptState:function(g,k){var a=null;switch(g){case "CURRENT_PASSAGE_DIRECTION":a={current_direction:k};break;case "LAST_PASSAGE_DIRECTION":a={last_direction:k};break;case "PASSAGE_COUNTER_OVERFLOW":a={passage_counter_overflow:k};break;case "PASSAGE_COUNTER_VALUE":a={passage_counter:k}}return a}},GENERIC_INPUT_TRANSMITER:{map:[{dpt:"CHANGE_OVER",state:["genInputChangeOver"],event:["genInputChangeOver"]},{dpt:"EXTERNAL_CLOCK",state:["genInputExtClock"],event:["genInputExtClock"]},{dpt:"HUMIDITY_LIMITER",
state:["genInputHumidityLimiter"],event:["genInputHumidityLimiter"]},{dpt:"STATE",state:["genInputState"],event:["genInputState"]},{dpt:"TACTILE_SWITCH",state:["genInputTactileSwitch"],event:["genInputTactileSwitch"]},{dpt:"TEMPERATURE_LIMITER",state:["genInputTempLimiter"],event:["genInputTempLimiter"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k=null;switch(g){case "CHANGE_OVER":k={genInputChangeOver:a};break;case "EXTERNAL_CLOCK":k={genInputExtClock:a};break;case "HUMIDITY_LIMITER":k=
{genInputHumidityLimiter:a};break;case "STATE":k=1==a?{genInputState:"on"}:0==a?{genInputState:"off"}:{genInputState:"?"};break;case "TACTILE_SWITCH":k={genInputTactileSwitch:a};break;case "TEMPERATURE_LIMITER":k={genInputTempLimiter:a}}return k}},ANALOG_OUTPUT_TRANSCEIVER:{map:[{dpt:"LEVEL",state:["outputLevel"],event:["outputLevel"],command:["outputOff","outputUp","outputDown","outputTo","toggleTo"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k=null;switch(g){case "LEVEL":k=
{outputLevel:Math.round(100*parseFloat(a))}}return k},executeCommand:function(g,a,h,q,n){if(q){if("outputOff"==q.substr(0,9))var k="outputOff";else if("outputUp"==q.substr(0,8)){k="outputUp";var l=q.substr(8)}else if("outputDown"==q.substr(0,10))k="outputDown",l=q.substr(10);else if("outputTo"==q.substr(0,8)){if(k="outputTo",l=q.substr(8),!l){n&&n(Error("outputTo has no value"));return}}else if("toggleTo"==q.substr(0,8)){if(k="toggleTo",l=q.substr(8),!l){n&&n(Error("toggleTo has no value"));return}}else isNaN(parseInt(q))||
(k="outputTo",l=parseInt(q));var t=m.call(this,k);if(t)switch(k){case "outputOff":g.writeValue(a,h,t,{type:"double",value:0},n);break;case "outputUp":l||(l=10);l=parseInt(l)/100;g.getState({interface:a,channel:h,datapoint:t},function(k,m){k?n&&n(k):"undefined"==typeof m||null==m?n&&n(Error("get dimmer current value return invalid")):(l=m.value+l,1<l&&(l=1),g.writeValue(a,h,t,{type:"double",value:l},n))});break;case "outputDown":l||(l=10);l=parseInt(l)/100;g.getState({interface:a,channel:h,datapoint:t},
function(k,m){k?n&&n(k):"undefined"==typeof m||null==m?n&&n(Error("get dimmer current value return invalid")):(l=m.value-l,0>l&&(l=0),g.writeValue(a,h,t,{type:"double",value:l},n))});break;case "toggleTo":l=parseInt(l)/100;g.getState({interface:a,channel:h,datapoint:t},function(k,m){k?n&&n(k):m?(m.value&&(l=0),g.writeValue(a,h,t,{type:"double",value:l},n)):n&&n(Error("get switch current value return invalid"))});break;case "outputTo":l=parseInt(l)/100;g.writeValue(a,h,t,{type:"double",value:l},n);
break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+q))}else n&&n(Error("command in null"))}},WATER_DETECTION_TRANSMITTER:{map:[{dpt:"ALARMSTATE",state:["alarm"],event:["alarm"]},{dpt:"MOISTURE_DETECTED",state:["moisture"],event:["moisture"]},{dpt:"WATERLEVEL_DETECTED",state:["water"],event:["water"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k=null;switch(g){case "ALARMSTATE":k={alarm:a};break;case "MOISTURE_DETECTED":k={moisture:a};
break;case "WATERLEVEL_DETECTED":k={water:a}}return k}},ACCELERATION_TRANSCEIVER:{map:[{dpt:"MOTION",state:["motion"],event:["motion"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k=null;switch(g){case "MOTION":k={motion:a}}return k}},DOOR_RECEIVER:{map:[{dpt:"DOOR_STATE",state:["doorState"],event:["doorState"]},{dpt:"DOOR_COMMAND",command:["open","close","partialOpen","stop"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k=null;switch(g){case "DOOR_STATE":a=
parseInt(a),k=0==a?{doorState:"closed"}:1==a?{doorState:"open"}:2==a?{doorState:"ventilation"}:{doorState:"unknown"}}return k},executeCommand:function(g,a,h,q,n){if(q){var k=m.call(this,q);if(k)switch(q){case "open":g.writeValue(a,h,k,{type:"double",value:1},n);break;case "stop":g.writeValue(a,h,k,{type:"double",value:2},n);break;case "close":g.writeValue(a,h,k,{type:"double",value:3},n);break;case "partialOpen":g.writeValue(a,h,k,{type:"double",value:4},n);break;default:n&&n(Error("no such command"))}else n&&
n(Error("can not find datapoint for command:"+q))}else n&&n(Error("command in null"))}},SIMPLE_SWITCH_RECEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"],command:["on","off","toggle"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k=null;switch(g){case "STATE":k=1==a?{state:"on"}:0==a?{state:"off"}:{state:"?"}}return k},executeCommand:function(g,a,h,q,n){var k=m.call(this,q);if(k)switch(q){case "on":g.writeValue(a,h,k,!0,n);break;case "off":g.writeValue(a,h,k,!1,n);
break;case "toggle":g.getState({interface:a,channel:h,datapoint:k},function(l,m){l?n&&n(l):m?(l=!0,m.value&&(l=!1),g.writeValue(a,h,k,l,n)):n&&n(Error("get switch current value return invalid"))});break;default:n&&n(Error("no such command"))}else n&&n(Error("can not find datapoint for command:"+q))}},MULTI_MODE_INPUT_TRANSMITTER:{map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,
a){var k=null;switch(g){case "STATE":k=1==a?{state:"on"}:0==a?{state:"off"}:{state:"?"};break;case "PRESS_SHORT":k={pressShort:!0};break;case "PRESS_LONG":k={pressLong:!0}}return k}},BRIGHTNESS_TRANSMITTER:{map:[{dpt:"AVERAGE_ILLUMINATION",state:["avgIllu"],event:["avgIllu"]},{dpt:"CURRENT_ILLUMINATION",state:["illu"],event:["illu"]},{dpt:"HIGHEST_ILLUMINATION",state:["maxIllu"],event:["maxIllu"]},{dpt:"LOWEST_ILLUMINATION",state:["minIllu"],event:["minIllu"]}],getReadableDpts:a,getDptFromState:h,
parseDptState:function(g,a){var k=null;switch(g){case "AVERAGE_ILLUMINATION":k={avgIllu:parseFloat(parseFloat(a).toFixed(2))};break;case "CURRENT_ILLUMINATION":k={illu:parseFloat(parseFloat(a).toFixed(2))};break;case "HIGHEST_ILLUMINATION":k={maxIllu:parseFloat(parseFloat(a).toFixed(2))};break;case "LOWEST_ILLUMINATION":k={minIllu:parseFloat(parseFloat(a).toFixed(2))}}return k}},POWER_MAINS_TRANSMITTER:{map:[{dpt:"POWER_MAINS_FAILURE",state:["powerMainsFailure"],event:["powerMainsFailure"]}],getReadableDpts:a,
getDptFromState:h,parseDptState:function(g,a){var k=null;switch(g){case "POWER_MAINS_FAILURE":k={powerMainsFailure:a}}return k}}},"BidCos-RF":{MAINTENANCE:{device:"maintenance",map:[{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]},{dpt:"UNREACH",state:["timeout"],event:["timeout"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){switch(g){case "LOWBAT":return{lowbat:a};case "UNREACH":return{timeout:a};default:return null}}},KEY:{device:"button",map:[{dpt:"PRESS_SHORT",event:["pressShort"],
command:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"],command:["pressLong"]},{dpt:"PRESS_LONG_RELEASE",event:["pressLongRel"]},{dpt:"PRESS_CONT",event:["pressCont"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){switch(g){case "PRESS_SHORT":return{pressShort:a};case "PRESS_LONG":return{pressLong:a};case "PRESS_CONT":return{pressCont:a};case "PRESS_LONG_RELEASE":return{pressLongRel:a};default:return null}},executeCommand:function(g,a,h,q,n){var k=m.call(this,q);switch(q){case "pressShort":g.writeValue(a,
h,k,!0,n);break;case "pressLong":g.writeValue(a,h,k,!0,n);break;default:n&&n(Error("no such command"))}}},SWITCH_INTERFACE:{device:"switch_interface",map:[{dpt:"PRESS",event:["press"],command:["press"]}],parseDptState:function(g,a){switch(g){case "PRESS":return{press:!0};default:return null}},executeCommand:function(g,a,h,q,n){var k=m.call(this,q);switch(q){case "press":g.writeValue(a,h,k,!0,n);break;default:n&&n(Error("no such command"))}}},SHUTTER_CONTACT:{device:"contact",map:[{dpt:"STATE",state:["state"],
event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){switch(g){case "STATE":return{state:a?"open":"closed"};case "ERROR":return{error:1==a?"sabotage":"no_error"};case "LOWBAT":return{lowbat:a};default:return null}}},JALOUSIE:{device:"jalousie",map:[{dpt:"LEVEL",state:["jalState"],event:["jalState"],command:["moveUp","moveDown","stepUp","stepDown","%d"]},{dpt:"STOP",command:["stop"]},
{dpt:"LEVEL_SLATS",state:["jalLmlState"],event:["jalLmlState"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo%d"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k=null;switch(g){case "LEVEL":a=Math.round(100*parseFloat(a));k={jalState:a};break;case "LEVEL_SLATS":a=Math.round(100*parseFloat(a)),k={jalLmlState:a}}return k},executeCommand:function(g,a,h,q,n){var k=m.call(this,q);switch(q){case "moveUp":g.writeValue(a,h,k,{type:"double",value:1},
n);break;case "moveDown":g.writeValue(a,h,k,{type:"double",value:0},n);break;case "stepUp":g.getState({interface:a,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);g.writeValue(a,h,k,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(a,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current jalousie state result invalid"))});break;case "stepDown":g.getState({interface:a,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=
m.value-.05;0>p&&(p=0);g.writeValue(a,h,k,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(a,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current blind state result invalid"))});break;case "stop":g.writeValue(a,h,k,!0,n);break;case "lamellaUp":g.writeValue(a,h,k,{type:"double",value:1},n);break;case "lamellaDown":g.writeValue(a,h,k,{type:"double",value:0},n);break;case "lamellaStepUp":g.getState({interface:a,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=
m.value+.05;1<p&&(p=1);g.writeValue(a,h,k,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(a,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current lamella state result invalid"))});break;case "lamellaStepDown":g.getState({interface:a,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);g.writeValue(a,h,k,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(a,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current lamella state result invalid"))});
break;default:if("lamellaTo"==q.substr(0,9)){q=q.substr(9);var l=parseInt(q);l/=100;k="LEVEL_SLATS";g.writeValue(a,h,k,{type:"double",value:l},function(m){m?n&&n(m):(g.updateStatusBuffer(a,h,k,l,(new Date).getTime()+1E3),n&&n())})}else"moveTo"==q.substr(0,6)||q.match(/^[-+]?[0-9]+$/)?("moveTo"==q.substr(0,6)&&(q=q.substr(6)),l=parseInt(q),l/=100,k="LEVEL",g.writeValue(a,h,k,{type:"double",value:l},function(m){m?n&&n(m):(g.updateStatusBuffer(a,h,k,l,(new Date).getTime()+1E3),n&&n())})):n&&n(Error("no such command"))}}},
MOD_EM8BIT_TRANSMITTER:{map:[{dpt:"STATE",state:["state8bit"],event:["state8bit"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k=null;switch(g){case "STATE":a=parseInt(a);k={state8bit:a};break;case "LOWBAT":k={lowbat:a}}return k}},KEYMATIC:{device:"keymatic",map:[{dpt:"STATE",state:["state"],event:["state"],command:["open","close"]},{dpt:"OPEN",command:["openDoor"]},{dpt:"STATE_UNCERTAIN",state:["uncertain"],event:["uncertain"]},
{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){switch(g){case "STATE":return{state:a?"open":"closed"};case "STATE_UNCERTAIN":return{uncertain:a};case "ERROR":switch(a){case 0:a="no_error";break;case 1:a="cluth_failure";break;case 2:a="motor_aborted"}return{error:a}}return null},executeCommand:function(g,a,h,q,n){var k=m.call(this,q);switch(q){case "open":g.writeValue(a,h,k,!0,n);break;case "close":g.writeValue(a,h,k,!1,n);break;case "openDoor":g.writeValue(a,
h,k,!0,n);break;default:n&&n(Error("no such command"))}}},MOTION_DETECTOR:{device:"motion",map:[{dpt:"BRIGHTNESS",state:["bri"],event:["bri"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k={};switch(g){case "BRIGHTNESS":k.bri=a;break;case "MOTION":k.state=a?"motion":"ok";break;case "ERROR":k.error=a?"sabotage":"no_error";break;default:return null}return k}},DUAL_WHITE_BRIGHTNESS:{device:"dualwhite",
map:[{dpt:"DIRECTION",state:["direction"],event:["direction"]},{dpt:"ERROR_OVERHEAT",state:["error_overheat"],event:["error_overheat"]},{dpt:"ERROR_REDUCED",state:["error_reduced"],event:["error_reduced"]},{dpt:"LEVEL",state:["bri"],event:["bri"],command:["off","dimUp","dimDown","toggle","dimTo%d"]},{dpt:"LEVEL_REAL",state:["bri_real"],event:["bri_real"]},{dpt:"OLD_LEVEL",command:["on"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(g,a){var k={};switch(g){case "DIRECTION":k.direction=
a;break;case "ERROR_OVERHEAT":k.error_overheat=a?!0:!1;break;case "ERROR_REDUCED":k.error_reduced=a?!0:!1;break;case "LEVEL":k.bri=Math.round(100*parseFloat(a));break;case "LEVEL_REAL":k.bri_real=Math.round(100*parseFloat(a));break;default:return null}return k},executeCommand:function(g,a,h,q,n){var k=m.call(this,q);switch(q){case "on":g.writeValue(a,h,k,!0,n);break;case "off":g.writeValue(a,h,k,{type:"double",value:0},n);break;case "dimUp":g.getState({interface:a,channel:h,datapoint:k},function(l,
m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);g.writeValue(a,h,k,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(a,h,k,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current jalousie state result invalid"))});break;case "dimDown":g.getState({interface:a,channel:h,datapoint:k},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);g.writeValue(a,h,k,{type:"double",value:p},function(l){l?n&&n(l):(g.updateStatusBuffer(a,h,k,p,(new Date).getTime()+
1E3),n&&n())})}else n&&n(Error("get current blind state result invalid"))});break;case "toggle":k="LEVEL";g.getState({interface:a,channel:h,datapoint:k},function(l,m){l?n&&n(l):m?0!=m.value?g.writeValue(a,h,k,{type:"double",value:0},n):g.writeValue(a,h,"OLD_LEVEL",!0,n):n&&n(Error("get current dimmer state result invalid"))});break;default:if("dimTo"==q.substr(0,5)){q=q.substr(5);var l=parseInt(q);l/=100;k="LEVEL";g.writeValue(a,h,k,{type:"double",value:l},function(m){m?n&&n(m):(g.updateStatusBuffer(a,
h,k,l,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("no such command"))}}},DUAL_WHITE_COLOR:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["color_direction"],event:["color_direction"]},{dpt:"LEVEL",state:["color"],event:["color"],command:["colorOff","colorUp","colorDown","colorToggle","colorTo%d"]},{dpt:"LEVEL_REAL",state:["color_real"],event:["color_real"]},{dpt:"OLD_LEVEL",command:["colorOn"]}],getReadableDpts:a,getDptFromState:h,parseDptState:function(a,k){var g={};switch(a){case "DIRECTION":g.direction=
k;break;case "LEVEL":g.color=Math.round(100*parseFloat(k));break;case "LEVEL_REAL":g.color_real=Math.round(100*parseFloat(k));break;default:return null}return g},executeCommand:function(a,k,h,q,n){var g=m.call(this,q);switch(q){case "colorOn":a.writeValue(k,h,g,!0,n);break;case "colorOff":a.writeValue(k,h,g,{type:"double",value:0},n);break;case "colorUp":a.getState({interface:k,channel:h,datapoint:g},function(l,m){if(l)n&&n(l);else if(m){var p=m.value+.05;1<p&&(p=1);a.writeValue(k,h,g,{type:"double",
value:p},function(l){l?n&&n(l):(a.updateStatusBuffer(k,h,g,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current jalousie state result invalid"))});break;case "colorDown":a.getState({interface:k,channel:h,datapoint:g},function(l,m){if(l)n&&n(l);else if(m){var p=m.value-.05;0>p&&(p=0);a.writeValue(k,h,g,{type:"double",value:p},function(l){l?n&&n(l):(a.updateStatusBuffer(k,h,g,p,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("get current blind state result invalid"))});break;case "colorToggle":g=
"LEVEL";a.getState({interface:k,channel:h,datapoint:g},function(l,m){l?n&&n(l):m?0!=m.value?a.writeValue(k,h,g,{type:"double",value:0},n):a.writeValue(k,h,"OLD_LEVEL",!0,n):n&&n(Error("get current dimmer state result invalid"))});break;default:if("colorTo"==q.substr(0,7)){q=q.substr(7);var l=parseInt(q);l/=100;g="LEVEL";a.writeValue(k,h,g,{type:"double",value:l},function(m){m?n&&n(m):(a.updateStatusBuffer(k,h,g,l,(new Date).getTime()+1E3),n&&n())})}else n&&n(Error("no such command"))}}}}}}();
x.hub.m.hm._Device=function(){var a=function(f,b,c){this.deviceType=f;this.deviceIF=b;this.deviceAdr=c;this.legacyType=null};a.prototype.initStates=function(f,b){var c=this._getReadableDpts();this._initDptStates(f,c,b)};a.prototype._getReadableDpts=function(){return[]};a.prototype._getDptFromRef=function(f){return null};a.prototype._initDptStates=function(f,b,c){if(b&&0!=b.length){var e=0,a=this,g=function(k,h){e++;e==b.length?c&&c():f.readValue(a.deviceIF,b[e].channel,b[e].dpt,g)};f.readValue(this.deviceIF,
b[e].channel,b[e].dpt,g)}else c&&c()};a.prototype.parseDptState=function(f,b,c){return null};a.prototype.toLegacyAdr=function(){return this.deviceType+"."+this.deviceIF+"."+this.deviceAdr};a.prototype.toLegacyType=function(){return this.legacyType};a.prototype.getSerial=function(){var f=this.deviceAdr,b=this.deviceAdr.indexOf(":");-1!=b&&(f=f.substr(0,b));return f};a.prototype.parseChnState=function(f,b){var c={},e;for(e in b){var a=this.parseDptState(f,e,b[e].value);if(a){var g={},k=b[e].time,h;
for(h in a)g[h]={value:a[h],time:k};c=x.hub.m.hm._Util.mergeObj(c,g)}}return c};a.prototype.parseStates=function(f){var b={},c;for(c in f){var e=this.parseChnState(c,f[c]);e&&(b=x.hub.m.hm._Util.mergeObj(b,e))}return b};a.prototype.executeCommand=function(f,b,c){c&&c()};a.prototype.getState=function(f,b,c){switch(b){case "timeout":var e={channel:0,dataPoint:"UNREACH"};break;default:e=this._getDptFromRef(b)}if(e){var a=this;f.getState({interface:this.deviceIF,channel:e.channel,datapoint:e.dataPoint},
function(f,g){f?c&&c(f):g?(f=a.parseDptState(e.channel,e.dataPoint,g.value))?c&&c(null,{value:f[b],time:g.time}):c&&c(null,null):c&&c(null,null)})}else c&&c(Error("no such state"))};a.prototype.isButton=function(){return!1};var h=function(f,b,c){a.call(this,f,b,c);this.channel=0;this.legacyType="maintenance"};util.inherits(h,a);h.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"].MAINTENANCE.getReadableDpts();c&&c.forEach(function(c){f.push({channel:b.deviceAdr+
":0",dpt:c})});return f};h.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;default:return null}return b};h.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||f!=this.channel)return null;
e={};"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c;return e};var m=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="button"};util.inherits(m,a);m.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};m.prototype._getDptFromRef=function(f){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(f){case "lowbat":b.channel=
0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;default:return null}return b};m.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "PRESS_SHORT":return{pressShort:c};
case "PRESS_LONG":return{pressLong:c};case "PRESS_CONT":return{pressCont:c};case "PRESS_LONG_RELEASE":return{pressLongRel:c};default:return null}};m.prototype.isButton=function(){return!0};m.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(a,g){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);f.reportValueUsage(e.deviceIF,c,"PRESS_LONG",function(c,e){c&&
console.error("button claim PRESS_LONG event error:"+c.stack);b&&b()})})};var g=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="button"};util.inherits(g,a);g.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};g.prototype._getDptFromRef=function(f){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint=
"LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;default:return null}return b};g.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "PRESS_SHORT":return{pressShort:c};case "PRESS_LONG":return{pressLong:c};
case "PRESS_CONT":return{pressCont:c};case "PRESS_LONG_RELEASE":return{pressLongRel:c};default:return null}};g.prototype.isButton=function(){return!1};g.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(a,g){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);f.reportValueUsage(e.deviceIF,c,"PRESS_LONG",function(c,e){c&&console.error("button claim PRESS_LONG event error:"+
c.stack);b&&b()})})};var k=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="switch"};util.inherits(k,a);k.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"}]};k.prototype._getDptFromRef=function(f){var b=this.deviceAdr;-1==b.indexOf(":")&&
this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "inhibit":b.dataPoint="INHIBIT";break;case "working":b.dataPoint="WORKING";break;default:return null}return b};k.prototype.executeCommand=function(f,b,c){var e=this.deviceAdr;-1==e.indexOf(":")&&this.channel&&(e+=":"+this.channel);var a=this;switch(b){case "on":var g="STATE";
f.writeValue(this.deviceIF,e,g,!0,c);break;case "off":g="STATE";f.writeValue(this.deviceIF,e,g,!1,c);break;case "toggle":g="STATE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(b,k){b?c&&c(b):k?(b=!0,k.value&&(b=!1),f.writeValue(a.deviceIF,e,g,b,c)):c&&c(Error("get switch current value return invalid"))});break;default:"onFor"==b.substr(0,5)?(b=parseFloat(b.substr(5)),isNaN(b)?c&&c(Error("onFor command invalid")):(g="ON_TIME",f.writeValue(this.deviceIF,e,g,{type:"double",value:b},
function(b){b?c&&c(b):(g="STATE",f.writeValue(a.deviceIF,e,g,!0,c))}))):c&&c(Error("no such command"))}};k.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;var k;switch(b){case "STATE":return 1==c?k="on":
0==c&&(k="off"),{state:k};case "INHIBIT":return{inhibit:c};case "WORKING":return{working:c};default:return null}};k.prototype.getConfig=function(f,b){var c=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)b&&b(e);else{var a={},g=null;f&&(g={AES_ACTIVE:f.AES_ACTIVE});a[c]=g;b&&b(e,a)}})};k.prototype.setConfig=function(f,b,c){if(b){var e=this.deviceAdr+":"+this.channel;if(b=b[e]){var a={};a.AES_ACTIVE=b.AES_ACTIVE;f.setParamset(this.deviceIF,e,"MASTER",a,function(e){c&&
c(e)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};var l=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="dimmer"};util.inherits(l,a);l.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"}]};l.prototype._getDptFromRef=function(f){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(f){case "timeout":b.channel=
0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="LEVEL";break;case "levelReal":b.dataPoint="LEVEL_REAL";break;case "inhibit":b.dataPoint="INHIBIT";break;case "working":b.dataPoint="WORKING";break;case "direction":b.dataPoint="DIRECTION";break;default:return null}return b};l.prototype.executeCommand=function(f,b,c){var e=this.deviceAdr+":"+this.channel,a=this,g=null;switch(b){case "on":var k="OLD_LEVEL";f.writeValue(this.deviceIF,e,k,!0,c);break;case "off":k="LEVEL";f.writeValue(this.deviceIF,
e,k,{type:"double",value:0},c);break;case "dimUp":k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(b,g){b?c&&c(b):g?(b=g.value+.05,1<b&&(b=1),f.writeValue(a.deviceIF,e,k,{type:"double",value:b},c)):c&&c(Error("get current dimmer state result invalid"))});break;case "dimDown":k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(b,g){b?c&&c(b):g?(b=g.value-.05,0>b&&(b=0),f.writeValue(a.deviceIF,e,k,{type:"double",value:b},c)):c&&c(Error("get current dimmer state result invalid"))});
break;case "toggle":k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(b,g){b?c&&c(b):g?0!=g.value?f.writeValue(a.deviceIF,e,k,{type:"double",value:0},c):f.writeValue(a.deviceIF,e,"OLD_LEVEL",!0,c):c&&c(Error("get current dimmer state result invalid"))});break;default:"toggleTo"==b.substr(0,8)?(g=parseInt(b.substr(8)),isNaN(g)?c&&c(Error("toggleTo command invalid")):(k="LEVEL",g/=100,f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(b,h){b?c&&c(b):h?(b=
g,h.value&&(b=0),f.writeValue(a.deviceIF,e,k,{type:"double",value:b},c)):c&&c(Error("get current dimmer state result invalid"))}))):"onTo"==b.substr(0,4)||b.match(/^[-+]?[0-9]+$/)?("onTo"==b.substr(0,4)&&(b=b.substr(4)),g=parseInt(b),g/=100,k="LEVEL",f.writeValue(this.deviceIF,e,k,{type:"double",value:g},c)):c&&c(Error("no such command"))}};l.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");
-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "LEVEL":return b=Math.round(100*parseFloat(c)),{state:b};case "LEVEL_REAL":return b=Math.round(100*parseFloat(c)),{levelReal:b};case "INHIBIT":return{inhibit:c};case "WORKING":return{working:c};case "DIRECTION":return{direction:c};default:return null}};var q=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="blind"};
util.inherits(q,a);q.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"DIRECTION"}]};q.prototype._getDptFromRef=function(f){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(f){case "timeout":b.channel=
0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="LEVEL";break;case "inhibit":b.dataPoint="INHIBIT";break;case "working":b.dataPoint="WORKING";break;case "direction":b.dataPoint="DIRECTION";break;default:return null}return b};q.prototype.executeCommand=function(f,b,c){var e=this.deviceAdr+":"+this.channel,g=this,a=0;"stepUpFor"==b.substr(0,9)?((a=b.substr(9))||(a=1),a=parseFloat(a),b="stepUpFor"):"stepUp"==b.substr(0,6)?((a=b.substr(6))||(a=5),a=parseInt(a)/100,b="stepUp"):"stepDownFor"==b.substr(0,
11)?((a=b.substr(11))||(a=1),a=parseFloat(a),b="stepDownFor"):"stepDown"==b.substr(0,8)&&((a=b.substr(8))||(a=5),a=parseInt(a)/100,b="stepDown");switch(b){case "stepUp":var k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(b,h){if(b)c&&c(b);else if(h){a||(a=.05);var A=h.value+a;1<A&&(A=1);f.writeValue(g.deviceIF,e,k,{type:"double",value:A},function(b){b?c&&c(b):(f.updateStatusBuffer(g.deviceIF,e,k,A,(new Date).getTime()+1E3),c&&c())})}else c&&c(Error("get current blind state result invalid"))});
break;case "stepDown":k="LEVEL";f.getState({interface:this.deviceIF,channel:e,datapoint:k},function(b,h){if(b)c&&c(b);else if(h){a||(a=.05);var A=h.value-a;0>A&&(A=0);f.writeValue(g.deviceIF,e,k,{type:"double",value:A},function(b){b?c&&c(b):(f.updateStatusBuffer(g.deviceIF,e,k,A,(new Date).getTime()+1E3),c&&c())})}else c&&c(Error("get current blind state result invalid"))});break;case "stepUpFor":k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:1},function(b){b?c&&c(b):setTimeout(function(){k=
"STOP";f.writeValue(g.deviceIF,e,k,!0,c)},1E3*a)});break;case "stepDownFor":k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:0},function(b){b?c&&c(b):setTimeout(function(){k="STOP";f.writeValue(g.deviceIF,e,k,!0,c)},1E3*a)});break;case "up":k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:1},c);break;case "down":k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:0},c);break;case "stop":k="STOP";f.writeValue(this.deviceIF,e,k,!0,c);break;default:if("moveTo"==b.substr(0,
6)||b.match(/^[-+]?[0-9]+$/)){"moveTo"==b.substr(0,6)&&(b=b.substr(6));var h=parseInt(b);h/=100;k="LEVEL";f.writeValue(this.deviceIF,e,k,{type:"double",value:h},function(b){b?c&&c(b):(f.updateStatusBuffer(g.deviceIF,e,k,h,(new Date).getTime()+1E3),c&&c())})}else c&&c(Error("no such command"))}};q.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "LEVEL":return b=Math.round(100*parseFloat(c)),{state:b};case "INHIBIT":return{inhibit:c};case "WORKING":return{working:c};case "DIRECTION":return{direction:c};default:return null}};q.prototype.getConfig=function(f,b){var c=this.deviceAdr+":"+this.channel;f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)b&&b(e);else{var a={},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,
REFERENCE_RUNNING_TIME_BOTTOM_TOP:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP,REFERENCE_RUNNING_TIME_TOP_BOTTOM:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});a[c]=g;b&&b(e,a)}})};q.prototype.setConfig=function(f,b,c){if(b){var e=this.deviceAdr+":"+this.channel;if(b=b[e]){var a={};a.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};a.REFERENCE_RUNNING_TIME_BOTTOM_TOP={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP};a.REFERENCE_RUNNING_TIME_TOP_BOTTOM=
{__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM};a.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;f.setParamset(this.deviceIF,e,"MASTER",a,function(e){c&&c(e)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};var n=function(f,b,c){k.call(this,f,b,c);this.legacyType="powerswitch";this.powChannel=2};util.inherits(n,k);n.prototype._getReadableDpts=function(){var f=k.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.powChannel,
dpt:"BOOT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"ENERGY_COUNTER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"POWER"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"CURRENT"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"VOLTAGE"});f.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"FREQUENCY"});return f};n.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";
break;case "state":b.channel+=":1";b.dataPoint="STATE";break;case "inhibit":b.channel+=":1";b.dataPoint="INHIBIT";break;case "working":b.channel+=":1";b.dataPoint="WORKING";break;case "boot":b.channel+=":2";b.dataPoint="BOOT";break;case "energy_counter":b.channel+=":2";b.dataPoint="ENERGY_COUNTER";break;case "power":b.channel+=":2";b.dataPoint="POWER";break;case "current":b.channel+=":2";b.dataPoint="CURRENT";break;case "voltage":b.channel+=":2";b.dataPoint="VOLTAGE";break;case "frequency":b.channel+=
":2";b.dataPoint="FREQUENCY";break;default:return null}return b};n.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);e=f.substr(e+1);return a!=this.deviceAdr?null:0==e?(f={},"UNREACH"==b?f.timeout=c:f["0_"+b.toLowerCase()]=c,f):"1"==e?k.prototype.parseDptState.call(this,f,b,c):"2"==e?(f={},f[b.toLowerCase()]=c,f):null};n.prototype.getConfig=function(f,b){var c=this,e=null;k.prototype.getConfig.call(this,f,function(a,g){a?b&&b(a):(e=g,c._getCh2Config(f,
function(c,f){if(c)b&&b(c);else{for(var a in f)f.hasOwnProperty(a)&&(e[a]=f[a]);b&&b(null,e)}}))})};n.prototype.setConfig=function(f,b,c){if(b){var e=Object.keys(b);if(e&&0!=e.length){var a=this;async.eachSeries(e,function(c,e){var g=c.indexOf(":");-1==g&&e(Error("channel address is null"));g=c.substr(g+1);1==g?k.prototype.setConfig.call(a,f,b,e):2==g?a._setCh2Config(f,b[c],e):e(Error("unknow channel:"+g))},function(e){c&&c(e)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};
n.prototype._getCh2Config=function(f,b){var c=this.deviceAdr+":2";f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)b&&b(e);else{var a={},g=null;f&&(g={AES_ACTIVE:f.AES_ACTIVE});a[c]=g;b&&b(e,a)}})};n.prototype._setCh2Config=function(f,b,c){if(b){var e=this.deviceAdr+":2",a={};a.AES_ACTIVE=b.AES_ACTIVE;f.setParamset(this.deviceIF,e,"MASTER",a,function(e){c&&c(e)})}else c&&c(Error("config data invalid"))};var r=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="weather"};util.inherits(r,
a);r.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"}]};r.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "temp":b.dataPoint="TEMPERATURE";
break;case "hum":b.dataPoint="HUMIDITY";break;default:return null}return b};r.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "TEMPERATURE":return b=parseFloat(c),{temp:b};case "HUMIDITY":return b=
parseInt(c),{hum:b};default:return null}};var p=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="weather2"};util.inherits(p,r);p.prototype._getReadableDpts=function(){var f=r.prototype._getReadableDpts.call(this);f.push({channel:this.deviceAdr+":"+this.channel,dpt:"AIR_PRESSURE"});return f};p.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "air":b.dataPoint="AIR_PRESSURE";break;default:return r.prototype._getDptFromRef.call(this,
f)}return b};p.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e),g=f.substr(e+1),k=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(k=this.deviceAdr.substr(0,e));if(a!=k||0!=g&&g!=this.channel)return null;if(0==g)return f={},"UNREACH"==b?f.timeout=c:"LOWBAT"==b?f.lowbat=c:f["0_"+b.toLowerCase()]=c,f;f=r.prototype.parseDptState.call(this,f,b,c);switch(b){case "AIR_PRESSURE":f||(f={}),f.air=parseInt(c)}return f};var t=function(f,b,c){a.call(this,
f,b,c);this.channel=1;this.legacyType="weatherstation"};util.inherits(t,a);t.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAINING"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAIN_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_SPEED"},
{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION_RANGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"SUNSHINEDURATION"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"}]};t.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "temp":b.dataPoint=
"TEMPERATURE";break;case "hum":b.dataPoint="HUMIDITY";break;case "rain":b.dataPoint="RAINING";break;case "rainC":b.dataPoint="RAIN_COUNTER";break;case "windS":b.dataPoint="WIND_SPEED";break;case "windD":b.dataPoint="WIND_DIRECTION";break;case "windDR":b.dataPoint="WIND_DIRECTION_RANGE";break;case "sunD":b.dataPoint="SUNSHINEDURATION";break;case "bri":b.dataPoint="BRIGHTNESS";break;default:return null}return b};t.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=
f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "TEMPERATURE":e.temp=parseFloat(c);break;case "HUMIDITY":e.hum=parseInt(c);break;case "RAINING":e.rain=c;break;case "RAIN_COUNTER":e.rainC=parseFloat(c);break;case "WIND_SPEED":e.windS=parseFloat(c);break;case "WIND_DIRECTION":e.windD=
c;break;case "WIND_DIRECTION_RANGE":e.windDR=c;break;case "SUNSHINEDURATION":e.sunD=c;break;case "BRIGHTNESS":e.bri=c;break;default:return null}return e};var w=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="heater"};util.inherits(w,a);w.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"VALVE_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"});return f};w.prototype._getDptFromRef=
function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "error":b.dataPoint="ERROR";break;case "state":b.dataPoint="VALVE_STATE";break;default:return null}return b};w.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e={};if(0==f)return"UNREACH"==
b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;if(f==this.channel){switch(b){case "ERROR":switch(c){case 0:e.error="no_error";break;case 1:e.error="VALVE_DRIVE_BLOCKED";break;case 2:e.error="VALVE_DRIVE_LOOSE";break;case 3:e.error="ADJUSTING_RANGE_TO_SMALL";break;case 4:e.error="lowbat"}break;case "VALVE_STATE":e.state=c}return e}return null};var v=function(f,b,c){a.call(this,f,b,c);this.channel=4;this.legacyType="thermostat"};util.inherits(v,a);v.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"FAULT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.channel,dpt:"SET_TEMPERATURE"});return f};v.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(f){case "mode":b.dataPoint="CONTROL_MODE";break;case "error":b.dataPoint="FAULT_REPORTING";break;case "batLvl":b.dataPoint="BATTERY_STATE";break;case "valveLvl":b.dataPoint="VALVE_STATE";break;case "boostTime":b.dataPoint="BOOST_STATE";break;case "act_temp":b.dataPoint="ACTUAL_TEMPERATURE";break;case "state":b.dataPoint="SET_TEMPERATURE";break;default:return null}return b};v.prototype.executeCommand=function(f,b,c){var e=this.deviceAdr+":"+this.channel,a=this;switch(b){case "setAuto":var g=
"AUTO_MODE";f.writeValue(this.deviceIF,e,g,!0,function(b){b||f.updateStatusBuffer(a.deviceIF,e,"CONTROL_MODE",0);c&&c(b)});break;case "setManu":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(b,k){b?c&&c(b):(g="MANU_MODE",f.writeValue(a.deviceIF,e,g,{type:"double",value:k.value},function(b){b||f.updateStatusBuffer(a.deviceIF,e,"CONTROL_MODE",1);c&&c(b)}))});break;case "setBoost":g="BOOST_MODE";f.writeValue(this.deviceIF,e,g,!0,function(b){b||f.updateStatusBuffer(a.deviceIF,
e,"CONTROL_MODE",3);c&&c(b)});break;case "tempUp":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(b,k){b?c&&c(b):k?(b=k.value+.5,30.5<b&&(b=30.5),f.writeValue(a.deviceIF,e,g,{type:"double",value:b},c)):c&&c(Error("get current temp state result invalid"))});break;case "tempDown":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(b,k){b?c&&c(b):k?(b=k.value-.5,4.5>b&&(b=4.5),f.writeValue(a.deviceIF,e,g,{type:"double",value:b},
c)):c&&c(Error("get current temp state result invalid"))});break;default:"tempTo"==b.substr(0,6)||b.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==b.substr(0,6)&&(b=b.substr(6)),b=parseFloat(b),g="SET_TEMPERATURE",f.writeValue(this.deviceIF,e,g,{type:"double",value:b},c)):c&&c(Error("no such command"))}};v.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(a!=g)return null;e={};if(0==f)return e["0_"+b.toLowerCase()]=c,e;if(f==this.channel){switch(b){case "CONTROL_MODE":switch(c){case 0:e.mode="auto";break;case 1:e.mode="manu";break;case 2:e.mode="party";break;case 3:e.mode="boost"}break;case "FAULT_REPORTING":switch(c){case 0:e.error="no_error";break;case 1:e.error="valve_tight";break;case 2:e.error="ADJUSTING_RANGE_TOO_LARGE";break;case 3:e.error="ADJUSTING_RANGE_TOO_SMALL";break;case 4:e.error="comm_error";break;case 5:e.error="";break;case 6:e.error=
"lowbat";break;case 7:e.error="VALVE_ERROR_POSITION"}break;case "BATTERY_STATE":e.batLvl=c;break;case "VALVE_STATE":e.valveLvl=c;break;case "BOOST_STATE":e.boostTime=c;break;case "ACTUAL_TEMPERATURE":e.act_temp=c;break;case "SET_TEMPERATURE":e.state=c;break;default:return null}return e}return null};var na=function(f,b,c){a.call(this,f,b,c);this.channel=4;this.legacyType="thermostat"};util.inherits(na,v);na.prototype._getReadableDpts=function(){var f=v.prototype._getReadableDpts.callback(this);f.push({channel:this.deviceAdr+
":"+this.channel,dpt:"WINDOW_STATE"});return f};na.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "window":b.dataPoint="WINDOW_STATE";break;default:return v.prototype._getDptFromRef.call(this,f)}return b};na.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e),g=f.substr(e+1),k=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(k=this.deviceAdr.substr(0,e));if(a!=k)return null;e=
{};if(0==g)return e["0_"+b.toLowerCase()]=c,e;if(g==this.channel)switch(b){case "WINDOW_STATE":return e.window=c?"closed":"open",e;default:return v.prototype.parseDptState.call(this,f,b,c)}else return null};var R=function(f,b,c){a.call(this,f,b,c);this.weatherChannel=1;this.thermoChannel=2;this.legacyType="wallthermo"};util.inherits(R,a);R.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});f.push({channel:this.deviceAdr+":0",dpt:"LOWBAT"});f.push({channel:this.deviceAdr+
":"+this.weatherChannel,dpt:"TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"HUMIDITY"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SETPOINT"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_COMMAND"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_DATA"});return f};R.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(f){case "timeout":c.channel=b+":0";c.dataPoint="UNREACH";
break;case "lowbat":c.channel=b+":0";c.dataPoint="LOWBAT";break;case "temp":c.channel=b+":1";c.dataPoint="TEMPERATURE";break;case "hum":c.channel=b+":1";c.dataPoint="HUMIDITY";break;case "state":c.channel=b+":2";c.dataPoint="SETPOINT";break;case "adjusting_command":c.channel=b+":2";c.dataPoint="ADJUSTING_COMMAND";break;case "adjusting_data":c.channel=b+":2";c.dataPoint="ADJUSTING_DATA";break;default:return null}return c};R.prototype.executeCommand=function(f,b,c){var e=this.deviceAdr+":"+this.thermoChannel;
switch(b){case "tempUp":var a="SETPOINT";f.getState({interface:this.deviceIF,channel:e,datapoint:a},function(b,g){b?c&&c(b):g?(b=g.value+.5,30<b&&(b=30),f.writeValue(self.deviceIF,e,a,{type:"double",value:b},c)):c&&c(Error("get current temp state result invalid"))});break;case "tempDown":a="SETPOINT";f.getState({interface:this.deviceIF,channel:e,datapoint:a},function(b,g){b?c&&c(b):g?(b=g.value-.5,6>b&&(b=6),f.writeValue(self.deviceIF,e,a,{type:"double",value:b},c)):c&&c(Error("get current temp state result invalid"))});
break;default:"tempTo"==b.substr(0,6)||b.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==b.substr(0,6)&&(b=b.substr(6)),b=parseFloat(b),a="SETPOINT",f.writeValue(this.deviceIF,e,a,{type:"double",value:b},c)):c&&c(Error("no such command"))}};R.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);if(a!=this.deviceAdr)return null;a={};if(0==f)return"UNREACH"==b?a.timeout=c:"LOWBAT"==b?a.lowbat=c:a["0_"+b.toLowerCase()]=c,a;if("1"==f){switch(b){case "TEMPERATURE":a.temp=
c;break;case "HUMIDITY":a.hum=c}return a}if("2"==f){switch(b){case "SETPOINT":a.state=c;break;case "ADJUSTING_COMMAND":a.adjusting_command=c;break;case "ADJUSTING_DATA":a.adjusting_data=c}return a}return null};var S=function(f,b,c){a.call(this,f,b,c);this.thermoChannel=2;this.legacyType="wallthermostat"};util.inherits(S,a);S.prototype._getReadableDpts=function(){var f=[];f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"CONTROL_MODE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,
dpt:"LOWBAT_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"COMMUNICATION_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"WINDOW_OPEN_REPORTING"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BATTERY_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BOOST_STATE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_TEMPERATURE"});f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_HUMIDITY"});
f.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SET_TEMPERATURE"});return f};S.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.thermoChannel,dataPoint:null};switch(f){case "mode":b.dataPoint="CONTROL_MODE";break;case "lowbat":b.dataPoint="LOWBAT_REPORTING";break;case "comm":b.dataPoint="COMMUNICATION_REPORTING";break;case "window":b.dataPoint="WINDOW_OPEN_REPORTING";break;case "batLvl":b.dataPoint="BATTERY_STATE";break;case "boostTime":b.dataPoint="BOOST_STATE";
break;case "temp":b.dataPoint="ACTUAL_TEMPERATURE";break;case "hum":b.dataPoint="ACTUAL_HUMIDITY";break;case "state":b.dataPoint="SET_TEMPERATURE";break;default:return null}return b};S.prototype.executeCommand=function(f,b,c){var e=this.deviceAdr+":"+this.thermoChannel,a=this;switch(b){case "setAuto":var g="AUTO_MODE";f.writeValue(this.deviceIF,e,g,!0,function(b){b||f.updateStatusBuffer(a.deviceIF,e,"CONTROL_MODE",0);c&&c(b)});break;case "setManu":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,
channel:e,datapoint:g},function(b,k){b?c&&c(b):(g="MANU_MODE",f.writeValue(a.deviceIF,e,g,{type:"double",value:k.value},function(b){b||f.updateStatusBuffer(a.deviceIF,e,"CONTROL_MODE",1);c&&c(b)}))});break;case "setBoost":g="BOOST_MODE";f.writeValue(this.deviceIF,e,g,!0,function(b){b||f.updateStatusBuffer(a.deviceIF,e,"CONTROL_MODE",3);c&&c(b)});break;case "tempUp":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(b,k){b?c&&c(b):k?(b=k.value+.5,30.5<b&&(b=30.5),
f.writeValue(a.deviceIF,e,g,{type:"double",value:b},c)):c&&c(Error("get current temp state result invalid"))});break;case "tempDown":g="SET_TEMPERATURE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(b,k){b?c&&c(b):k?(b=k.value-.5,4.5>b&&(b=4.5),f.writeValue(a.deviceIF,e,g,{type:"double",value:b},c)):c&&c(Error("get current temp state result invalid"))});break;default:"tempTo"==b.substr(0,6)||b.match(/^[-+]?[0-9]*\.?[0-9]+$/)?("tempTo"==b.substr(0,6)&&(b=b.substr(6)),b=parseFloat(b),
g="SET_TEMPERATURE",f.writeValue(this.deviceIF,e,g,{type:"double",value:b},c)):"setWeekProfile"==b.substr(0,14)?(b=parseInt(b.substr(14)),f.setParamset(this.deviceIF,this.deviceAdr,"MASTER",{WEEK_PROGRAM_POINTER:b-1},function(b){c&&c(b)})):c&&c(Error("no such command"))}};S.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);if(a!=this.deviceAdr)return null;a={};if(0==f)return a["0_"+b.toLowerCase()]=c,a;if("2"==f){switch(b){case "CONTROL_MODE":switch(c){case 0:a.mode=
"auto";break;case 1:a.mode="manu";break;case 2:a.mode="party";break;case 3:a.mode="boost"}break;case "LOWBAT_REPORTING":a.lowbat=c;break;case "COMMUNICATION_REPORTING":a.comm=c;break;case "WINDOW_OPEN_REPORTING":a.window=c;break;case "BATTERY_STATE":a.batLvl=c;break;case "BOOST_STATE":a.boostTime=c;break;case "ACTUAL_TEMPERATURE":a.temp=c;break;case "ACTUAL_HUMIDITY":a.hum=c;break;case "SET_TEMPERATURE":a.state=c}return a}return null};var oa=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType=
"contact"};util.inherits(oa,a);oa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};oa.prototype._getDptFromRef=function(f){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint=
"STATE";break;case "error":b.dataPoint="ERROR";break;case "lowbat":b.dataPoint="LOWBAT";break;default:return null}return b};oa.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "STATE":return{state:c?"open":"closed"};
case "ERROR":return{error:1==c?"sabotage":"no_error"};case "LOWBAT":return{lowbat:c};default:return null}};var T=function(f,b,c){a.call(this,f,b,c);this.rainChannel=1;this.heatChannel=2;this.legacyType="rain"};util.inherits(T,a);T.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.rainChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+
":"+this.heatChannel,dpt:"WORKING"}]};T.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(f){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "rain":c.channel=b+":"+this.rainChannel;c.dataPoint="STATE";break;case "heat":c.channel=b+":"+this.heatChannel;c.dataPoint="STATE";break;case "inhibit":c.channel=b+":"+this.heatChannel;c.dataPoint="INHIBIT";break;case "working":c.channel=b+":"+this.heatChannel;c.dataPoint="WORKING";break;default:return null}return c};
T.prototype.executeCommand=function(f,b,c){var e=this.deviceAdr;-1==e.indexOf(":")&&this.heatChannel&&(e+=":"+this.heatChannel);var a=this;switch(b){case "heaterOn":var g="STATE";f.writeValue(this.deviceIF,e,g,!0,c);break;case "heaterOff":g="STATE";f.writeValue(this.deviceIF,e,g,!1,c);break;case "heaterToggle":g="STATE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(b,k){b?c&&c(b):k?(b=!0,k.value&&(b=!1),f.writeValue(a.deviceIF,e,g,b,c)):c&&c(Error("get switch current value return invalid"))});
break;default:c&&c(Error("no such command"))}};T.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;if(1==f){switch(b){case "STATE":e.rain=1==c?"rain":"dry";break;default:return null}return e}if(2==f){switch(b){case "STATE":e.heat=c?"on":"off";break;case "INHIBIT":e.inhibit=
c;break;case "WORKING":e.working=c;break;default:return null}return e}};var D=function(f,b,c){a.call(this,f,b,c);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong2"};util.inherits(D,a);D.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.chimeChannel,
dpt:"STATE"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"WORKING"}]};D.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(f){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "led":c.channel=b+":"+this.ledChannel;c.dataPoint="STATE";break;case "led_inhibit":c.channel=b+":"+this.ledChannel;c.dataPoint="INHIBIT";break;case "led_working":c.channel=b+":"+this.ledChannel;c.dataPoint=
"WORKING";break;case "chime":c.channel=b+":"+this.chimeChannel;c.dataPoint="STATE";break;case "chime_inhibit":c.channel=b+":"+this.chimeChannel;c.dataPoint="INHIBIT";break;case "chime_working":c.channel=b+":"+this.chimeChannel;c.dataPoint="WORKING";break;default:return null}return c};D.prototype.executeCommand=function(f,b,c){switch(b){case "ledOn":b=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,b,"STATE",!0,c);break;case "ledOff":b=this.deviceAdr+":"+this.ledChannel;f.writeValue(this.deviceIF,
b,"STATE",!1,c);break;case "chimeOn":b=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,b,"STATE",!0,c);break;case "chimeOff":b=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,b,"STATE",!1,c);break;default:c&&c(Error("no such command"))}};D.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=
{};if(0==f)return"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;if(1==f){switch(b){case "STATE":e.led=c?"on":"off";break;case "INHIBIT":e.led_inhibit=c;break;case "WORKING":e.led_working=c;break;default:return null}return e}if(2==f){switch(b){case "STATE":e.chime=c?"on":"off";break;case "INHIBIT":e.chime_inhibit=c;break;case "WORKING":e.chime_working=c;break;default:return null}return e}};var Ma=function(f,b,c){a.call(this,f,b,c);this.ledChannel=1;this.chimeChannel=2;this.legacyType="gong"};
util.inherits(Ma,D);Ma.prototype.executeCommand=function(f,b,c){if(0==b.indexOf("vChannel")){var e=b.substr(8);e=parseInt(e);b=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,b,"SUBMIT","0.8,1,5,"+e,c)}else if(0==b.indexOf("setChime")){var a=b.substr(8);parseInt(e);b=this.deviceAdr+":"+this.chimeChannel;f.writeValue(this.deviceIF,b,"SUBMIT",a,c)}else 0==b.indexOf("ledGreen")?((e=b.substr(8))||(e=10),b=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,b,"SUBMIT","1,10,"+
e+",34",c)):0==b.indexOf("ledRed")?((e=b.substr(6))||(e=10),b=this.deviceAdr+":"+this.ledChannel,f.writeValue(this.deviceIF,b,"SUBMIT","1,10,"+e+",18",c)):D.prototype.executeCommand.call(this,f,b,c)};var pa=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="window"};util.inherits(pa,a);pa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"},
{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};pa.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "error":b.dataPoint="ERROR";break;case "lowbat":b.dataPoint="LOWBAT";break;default:return null}return b};pa.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=
this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "STATE":switch(c){case 0:e.state="closed";break;case 1:e.state="tilted";break;case 2:e.state="open"}break;case "ERROR":switch(c){case 0:e.error="no_error";break;case 1:case 7:e.error="sabotage"}break;case "LOWBAT":e.lowbat=c;break;default:return null}return e};var qa=function(f,b,c){a.call(this,f,b,c);this.channel=
1;this.legacyType="temp"};util.inherits(qa,a);qa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"}]};qa.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "temp":b.dataPoint="TEMPERATURE";
break;default:return null}return b};qa.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "TEMPERATURE":return{temp:parseFloat(c)};default:return null}};var ra=function(f,b,c){a.call(this,f,b,
c);this.temp1=1;this.temp2=2;this.tempDiff12=3;this.tempDiff21=4;this.legacyType="temp2"};util.inherits(ra,a);ra.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.temp1,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.temp1,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.temp2,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff12,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff21,dpt:"TEMPERATURE"}]};ra.prototype._getDptFromRef=
function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "lowbat":b.channel=this.temp1;b.dataPoint="LOWBAT";break;case "temp1":b.channel=this.temp1;b.dataPoint="TEMPERATURE";break;case "temp2":b.channel=this.temp2;b.dataPoint="TEMPERATURE";break;case "tempDiff12":b.channel=this.tempDiff12;b.dataPoint="TEMPERATURE";break;case "tempDiff21":b.channel=this.tempDiff21;b.dataPoint="TEMPERATURE";break;default:return null}return b};
ra.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "LOWBAT":return{lowbat:c};case "TEMPERATURE":return 1==f?{temp1:parseFloat(c)}:2==f?{temp2:parseFloat(c)}:3==f?{tempDiff12:parseFloat(c)}:4==f?{tempDiff21:parseFloat(c)}:null;default:return null}};
var sa=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="co2"};util.inherits(sa,a);sa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};sa.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;default:return null}return b};sa.prototype.parseDptState=
function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "STATE":switch(c){case 0:e.state="normal";break;case 1:e.state="medium";break;case 2:e.state="high"}break;default:return null}return e};var ta=function(f,b,c){a.call(this,f,b,c);this.channel=
1;this.legacyType="motion"};util.inherits(ta,a);ta.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"},{channel:this.deviceAdr+":"+this.channel,dpt:"MOTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}]};ta.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint=
"LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "bri":b.dataPoint="BRIGHTNESS";break;case "state":b.dataPoint="MOTION";break;case "error":b.dataPoint="ERROR";break;default:return null}return b};ta.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==
b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "BRIGHTNESS":e.bri=c;break;case "MOTION":e.state=c?"motion":"ok";break;case "ERROR":e.error=c?"sabotage":"no_error";break;default:return null}return e};var ua=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="smoke"};util.inherits(ua,a);ua.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,
dpt:"STATE"}]};ua.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;default:return null}return b};ua.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "STATE":e.state=c?"smoke":"ok";break;default:return null}return e};var U=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="siren"};util.inherits(U,a);U.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,
dpt:"ERROR_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_BATTERY"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};U.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint=
"STATE";break;case "error_power":b.dataPoint="ERROR_POWER";break;case "error_sabotage":b.dataPoint="ERROR_SABOTAGE";break;case "error_battery":b.dataPoint="ERROR_BATTERY";break;case "inhibit":b.dataPoint="INHIBIT";break;case "working":b.dataPoint="WORKING";break;default:return null}return b};U.prototype.executeCommand=function(f,b,c){var e=this.deviceAdr+":"+this.channel,a=this;switch(b){case "on":var g="STATE";f.writeValue(this.deviceIF,e,g,!0,c);break;case "off":g="STATE";f.writeValue(this.deviceIF,
e,g,!1,c);break;case "toggle":g="STATE";f.getState({interface:this.deviceIF,channel:e,datapoint:g},function(b,k){b?c&&c(b):(b=!0,k.value&&(b=!1),f.writeValue(a.deviceIF,e,g,b,c))});break;default:c&&c(Error("no such command"))}};U.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==
b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "STATE":e.state=c?"on":"off";break;case "ERROR_POWER":e.error_power=c?"power_failure":"no_error";break;case "ERROR_SABOTAGE":e.error_sabotage=c?"sabotage":"no_error";break;case "ERROR_BATTERY":e.error_battery=c?"battery_defect":"no_error";break;case "INHIBIT":e.inhibit=c;break;case "WORKING":e.working=c;break;default:return null}return e};var va=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="capacity"};util.inherits(va,a);
va.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"FILLING_LEVEL"}]};va.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="FILLING_LEVEL";break;default:return null}return b};va.prototype.parseDptState=
function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "FILLING_LEVEL":e.state=c;break;default:return null}return e};var L=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="switch_interface"};util.inherits(L,
a);L.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}]};L.prototype._getDptFromRef=function(f){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;default:return null}return b};L.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==
e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "PRESS":return{press:c};default:return null}};L.prototype.isButton=function(){return!0};L.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);f.reportValueUsage(this.deviceIF,
c,"PRESS",function(c,f){c&&console.error("switch interface claim PRESS event error:"+c.stack);b&&b()})};var wa=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="tilt"};util.inherits(wa,a);wa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};wa.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};
switch(f){case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "lowbat":b.dataPoint="LOWBAT";break;default:return null}return b};wa.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "STATE":e.state=
c?"open":"closed";break;case "LOWBAT":e.lowbat=c;break;default:return null}return e};var xa=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="water"};util.inherits(xa,a);xa.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}]};xa.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "timeout":b.channel=
0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="STATE";break;case "lowbat":b.dataPoint="LOWBAT";break;default:return null}return b};xa.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "STATE":switch(c){case 0:e.state=
"ok";break;case 1:e.state="moist";break;case 2:e.state="water"}break;case "LOWBAT":e.lowbat=c;break;default:return null}return e};var ya=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="energymeter"};util.inherits(ya,a);ya.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BOOT"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_ENERGY_COUNTER"},{channel:this.deviceAdr+
":"+this.channel,dpt:"GAS_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"POWER"}]};ya.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "boot":b.dataPoint="BOOT";break;case "gas_energy":b.dataPoint="GAS_ENERGY_COUNTER";break;case "gas_power":b.dataPoint="GAS_POWER";
break;case "energy":b.dataPoint="ENERGY_COUNTER";break;case "power":b.dataPoint="POWER";break;default:return null}return b};ya.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "BOOT":e.boot=
c;break;case "GAS_ENERGY_COUNTER":e.gas_energy=c;break;case "GAS_POWER":e.gas_power=c;break;case "ENERGY_COUNTER":e.energy=c;break;case "POWER":e.power=c;break;default:return null}return e};var M=function(f,b,c){a.call(this,f,b,c);this.dimChannel=1;this.rgbChannel=2;this.autoChannel=3;this.legacyType="rgb"};util.inherits(M,a);M.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.dimChannel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+
this.rgbChannel,dpt:"COLOR"},{channel:this.deviceAdr+":"+this.autoChannel,dpt:"PROGRAM"}]};M.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(f){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "state":c.channel=b+":"+this.dimChannel;c.dataPoint="LEVEL";break;case "color":c.channel=b+":"+this.rgbChannel;c.dataPoint="COLOR";break;case "program":c.channel=b+":"+this.autoChannel;c.dataPoint="PROGRAM";break;case "inhibit":c.channel=b+":"+this.dimChannel;
c.dataPoint="INHIBIT";break;case "working":c.channel=b+":"+this.dimChannel;c.dataPoint="WORKING";break;case "direction":c.channel=b+":"+this.dimChannel;c.dataPoint="DIRECTION";break;default:return null}return c};M.prototype.executeCommand=function(f,b,c){var e=this;switch(b){case "on":var a=this.deviceAdr+":"+this.dimChannel;var g="OLD_LEVEL";f.writeValue(this.deviceIF,a,g,!0,c);break;case "off":a=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.writeValue(this.deviceIF,a,g,{type:"double",value:0},
c);break;case "white":a=this.deviceAdr+":"+this.rgbChannel;g="COLOR";f.writeValue(this.deviceIF,a,g,200,c);break;case "dimUp":a=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.getState({interface:this.deviceIF,channel:a,datapoint:g},function(b,k){b?c&&c(b):k?(b=k.value+.05,1<b&&(b=1),f.writeValue(e.deviceIF,a,g,{type:"double",value:b},c)):c&&c(Error("get current dimmer state result invalid"))});break;case "dimDown":a=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.getState({interface:this.deviceIF,
channel:a,datapoint:g},function(b,k){b?c&&c(b):k?(b=k.value-.05,0>b&&(b=0),f.writeValue(e.deviceIF,a,g,{type:"double",value:b},c)):c&&c(Error("get current dimmer state result invalid"))});break;default:if("onTo"==b.substr(0,4)||b.match(/^[-+]?[0-9]+$/)){"onTo"==b.substr(0,4)&&(b=b.substr(4));var k=parseInt(b);a=this.deviceAdr+":"+this.dimChannel;g="LEVEL";f.writeValue(this.deviceIF,a,g,{type:"double",value:k/100},c)}else if("setProg"==b.substr(0,7))b=b.substr(7),k=parseInt(b),a=this.deviceAdr+":"+
this.autoChannel,g="PROGRAM",f.writeValue(this.deviceIF,a,g,k,c);else if("setRampTime"==b.substr(0,11))b=b.substr(11),k=parseFloat(b),a=this.deviceAdr+":"+this.dimChannel,g="RAMP_TIME",f.writeValue(this.deviceIF,a,g,{type:"double",value:k},c);else if(b.toLowerCase().match(/^([0-9a-f]{6})$/i)){k=parseInt(b.substr(0,2),16);var h=parseInt(b.substr(2,2),16);b=parseInt(b.substr(4,2),16);var l=0;k=this._RGBToHSV(k,h,b);l=.1>k[1]?200:Math.round(k[0]/1.8);a=this.deviceAdr+":"+this.rgbChannel;g="COLOR";f.writeValue(this.deviceIF,
a,g,l,c)}else c&&c(Error("no such command"))}};M.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.dimChannel&&f!=this.rgbChannel&&f!=this.autoChannel)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "LEVEL":e.state=100*parseFloat(c);break;case "COLOR":e.color=c;break;case "PROGRAM":e.program=
c;break;case "INHIBIT":e.inhibit=c;break;case "WORKING":e.working=c;break;case "DIRECTION":e.direction=c;break;default:return null}return e};M.prototype._RGBToHSV=function(f,b,c){f/=255;b/=255;c/=255;var e=Math.min(f,Math.min(b,c)),a=Math.max(f,Math.max(b,c));return e==a?[0,0,e]:[60*((f==e?3:c==e?1:5)-(f==e?b-c:c==e?f-b:c-f)/(a-e)),(a-e)/a,a]};var za=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="lux"};util.inherits(za,a);za.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LUX"}]};za.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "lowbat":b.channel=0;b.dataPoint="LOWBAT";break;case "timeout":b.channel=0;b.dataPoint="UNREACH";break;case "state":b.dataPoint="LUX";break;default:return null}return b};za.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,
e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "LUX":e.state=c;break;default:return null}return e};var V=function(f,b,c){a.call(this,f,b,c);this.swChannel1=1;this.swChannel2=2;this.panicChannel=3;this.armingChannel=4;this.legacyType="siren2"};util.inherits(V,a);V.prototype._getReadableDpts=
function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.swChannel1,dpt:"STATE"},{channel:this.deviceAdr+":"+this.swChannel2,dpt:"STATE"},{channel:this.deviceAdr+":"+this.panicChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ARMSTATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+
":"+this.armingChannel,dpt:"LOWBAT"}]};V.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b,dataPoint:null};switch(f){case "timeout":c.channel=0;c.dataPoint="UNREACH";break;case "switchSensorInState":c.channel=b+":"+this.swChannel1;c.dataPoint="STATE";break;case "switchSensorExState":c.channel=b+":"+this.swChannel2;c.dataPoint="STATE";break;case "switchPanicState":c.channel=b+":"+this.panicChannel;c.dataPoint="STATE";break;case "arming":c.channel=b+":"+this.armingChannel;c.dataPoint=
"ARMSTATE";break;case "inhibit":c.channel=b+":"+this.armingChannel;c.dataPoint="INHIBIT";break;case "working":c.channel=b+":"+this.armingChannel;c.dataPoint="WORKING";break;case "sabotage":c.channel=b+":"+this.armingChannel;c.dataPoint="ERROR_SABOTAGE";break;case "lowbat":c.channel=b+":"+this.armingChannel;c.dataPoint="LOWBAT";break;default:return null}return c};V.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;
e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e={};if(0==f)return"UNREACH"==b?e.timeout=c:e["0_"+b.toLowerCase()]=c,e;if(1==f){switch(b){case "STATE":e.switchSensorInState=c?"on":"off";break;default:return null}return e}if(2==f){switch(b){case "STATE":e.switchSensorExState=c?"on":"off";break;default:return null}return e}if(3==f){switch(b){case "STATE":e.switchPanicState=c?"on":"off";break;default:return null}return e}if(4==f){switch(b){case "ARMSTATE":switch(c){case 0:e.arming=
"disarmed";break;case 1:e.arming="ex_armed";break;case 2:e.arming="all_armed";break;case 3:e.arming="blocked"}break;case "INHIBIT":e.inhibit=c;break;case "WORKING":e.working=c;break;case "ERROR_SABOTAGE":switch(c){case 0:e.sabotage="no_error";break;case 1:e.sabotage="ex_armed"}break;case "LOWBAT":e.lowbat=c;break;default:return null}return e}};V.prototype.executeCommand=function(f,b,c){var e=this;switch(b){case "switchSensorInOn":var a="STATE";var g=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,
g,a,!0,c);break;case "switchSensorInOff":a="STATE";g=this.deviceAdr+":"+this.swChannel1;f.writeValue(this.deviceIF,g,a,!1,c);break;case "switchSensorInToggle":a="STATE";g=this.deviceAdr+":"+this.swChannel1;f.getState({interface:this.deviceIF,channel:g,datapoint:a},function(b,k){b?c&&c(b):(b=!0,k.value&&(b=!1),f.writeValue(e.deviceIF,g,a,b,c))});break;case "switchSensorExOn":a="STATE";g=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,g,a,!0,c);break;case "switchSensorExOff":a="STATE";
g=this.deviceAdr+":"+this.swChannel2;f.writeValue(this.deviceIF,g,a,!1,c);break;case "switchSensorExToggle":a="STATE";g=this.deviceAdr+":"+this.swChannel2;f.getState({interface:this.deviceIF,channel:g,datapoint:a},function(b,k){b?c&&c(b):(b=!0,k.value&&(b=!1),f.writeValue(e.deviceIF,g,a,b,c))});break;case "switchPanicOn":a="STATE";g=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,g,a,!0,c);break;case "switchPanicOff":a="STATE";g=this.deviceAdr+":"+this.panicChannel;f.writeValue(this.deviceIF,
g,a,!1,c);break;case "switchPanicToggle":a="STATE";g=this.deviceAdr+":"+this.panicChannel;f.getState({interface:this.deviceIF,channel:g,datapoint:a},function(b,k){b?c&&c(b):(b=!0,k.value&&(b=!1),f.writeValue(e.deviceIF,g,a,b,c))});break;case "armingDisarm":a="ARMSTATE";g=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,g,a,0,c);break;case "armingIntern":a="ARMSTATE";g=this.deviceAdr+":"+this.armingChannel;f.writeValue(this.deviceIF,g,a,1,c);break;case "armingAll":a="ARMSTATE";g=this.deviceAdr+
":"+this.armingChannel;f.writeValue(this.deviceIF,g,a,2,c);break;default:c&&c(Error("no such command"))}};var W=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="jalousie"};util.inherits(W,a);W.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});(c=c.JALOUSIE.getReadableDpts())&&c.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c})});return f};W.prototype._getDptFromRef=function(f){var b=
this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":c.channel=b+":0";c.dataPoint="UNREACH";break;default:if(c.channel=b+":"+this.channel,c.dataPoint=e.JALOUSIE.getDptFromState(f),!c.dataPoint)return null}return c};W.prototype.executeCommand=function(f,b,c){x.hub.m.hm._Channel["BidCos-RF"].JALOUSIE.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,b,c)};W.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==
e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==b)return{timeout:c};e={};e["0_"+b.toLowerCase()]=c;return e}return f==this.channel?e.JALOUSIE.parseDptState(b,c):null};var E=function(f,b,c){a.call(this,f,b,c);this.keyChannel1=1;this.keyChannel2=2;this.em8bitChannel=3;this.legacyType="mod_em_8bit"};util.inherits(E,a);E.prototype._getReadableDpts=
function(){var f=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"];f.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var e=c.KEY.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c});f.push({channel:b.deviceAdr+":2",dpt:c})});(e=c.MOD_EM8BIT_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c})});return f};E.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null};switch(f){case "timeout":c.channel=
b+":0";c.dataPoint="UNREACH";break;case "lowbat":c.channel=b+":3";c.dataPoint="LOWBAT";break;case "state8bit":c.channel=b+":3";c.dataPoint="STATE";break;default:return null}return c};E.prototype.executeCommand=function(f,b,c){var e=x.hub.m.hm._Channel["BidCos-RF"];switch(b){case "ch1pressShort":b=this.deviceAdr+":"+this.keyChannel1;e.KEY.executeCommand(f,this.deviceIF,b,"pressShort",c);break;case "ch1pressLong":b=this.deviceAdr+":"+this.keyChannel1;e.KEY.executeCommand(f,this.deviceIF,b,"pressLong",
c);break;case "ch2pressShort":b=this.deviceAdr+":"+this.keyChannel2;e.KEY.executeCommand(f,this.deviceIF,b,"pressShort",c);break;case "ch2pressLong":b=this.deviceAdr+":"+this.keyChannel2;e.KEY.executeCommand(f,this.deviceIF,b,"pressLong",c);break;default:c&&c(Error("no such command"))}};E.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=
g)return null;a=x.hub.m.hm._Channel["BidCos-RF"];e=null;if(0==f){if("UNREACH"==b)return{timeout:c};e={};e["0_"+b.toLowerCase()]=c;return e}if(f==this.keyChannel1){if(b=a.KEY.parseDptState(b,c))e={},b.pressShort&&(e.ch1pressShort=!0),b.pressLong&&(e.ch1pressLong=!0),"undefined"!=typeof b.pressCont&&null!=b.pressCont&&(e.ch1pressCont=!0),b.pressLongRel&&(e.ch1pressLongRel=!0);return e}if(f==this.keyChannel2){if(b=a.KEY.parseDptState(b,c))e={},b.pressShort&&(e.ch2pressShort=!0),b.pressLong&&(e.ch2pressLong=
!0),"undefined"!=typeof b.pressCont&&null!=b.pressCont&&(e.ch2pressCont=!0),b.pressLongRel&&(e.ch2pressLongRel=!0);return e}return f==this.em8bitChannel?a.MOD_EM8BIT_TRANSMITTER.parseDptState(b,c):null};E.prototype.isButton=function(){return!0};E.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,c+":1","PRESS_SHORT",function(a,g){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);
f.reportValueUsage(e.deviceIF,c+":1","PRESS_LONG",function(a,g){a&&console.error("button claim PRESS_LONG event error:"+a.stack);f.reportValueUsage(e.deviceIF,c+":2","PRESS_SHORT",function(a,g){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);f.reportValueUsage(e.deviceIF,c+":2","PRESS_LONG",function(c,e){b&&b()})})})})};var F=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="mod_em_8"};util.inherits(F,a);F.prototype._getReadableDpts=function(){var f=[],b=this,c=
x.hub.m.hm._Channel["BidCos-RF"],e=c.KEY.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(e=c.SWITCH_INTERFACE.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});(e=c.SHUTTER_CONTACT.getReadableDpts())&&e.forEach(function(c){"ERROR"!=c&&f.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});return f};F.prototype._getDptFromRef=function(f){var b={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(f){case "state":b.dataPoint=
"STATE";break;case "lowbat":b.dataPoint="LOWBAT";break;default:return null}return b};F.prototype.executeCommand=function(f,b,c){var e=x.hub.m.hm._Channel["BidCos-RF"],a=this.deviceAdr+":"+this.channel;switch(b){case "pressShort":e.KEY.executeCommand(f,this.deviceIF,a,"pressShort",c);break;case "pressLong":e.KEY.executeCommand(f,this.deviceIF,a,"pressLong",c);break;case "press":e.SWITCH_INTERFACE.executeCommand(f,this.deviceIF,a,"press",c);break;default:c&&c(Error("no such command"))}};F.prototype.parseDptState=
function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["BidCos-RF"];a=null;if(f==this.channel){a={};if(f=e.KEY.parseDptState(b,c))f.pressShort&&(a.pressShort=!0),f.pressLong&&(a.pressLong=!0),"undefined"!=typeof f.pressCont&&null!=f.pressCont&&(a.pressCont=!0),f.pressLongRel&&(a.pressCont=!0);(f=e.SWITCH_INTERFACE.parseDptState(b,
c))&&f.press&&(a.press=!0);if(f=e.SHUTTER_CONTACT.parseDptState(b,c))f.state&&(a.state=f.state),"undefined"!=typeof f.lowbat&&null!=f.lowbat&&(a.lowbat=f.lowbat)}return a};F.prototype.isButton=function(){return!0};F.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(a,g){a&&console.error("button claim PRESS_SHORT event error:"+a.stack);f.reportValueUsage(e.deviceIF,c,"PRESS_LONG",
function(a,g){a&&console.error("button claim PRESS_LONG event error:"+a.stack);f.reportValueUsage(e.deviceIF,c,"PRESS",function(c,e){c&&console.error("button claim PRESS_SHORT event error:"+c.stack);b&&b()})})})};var X=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="keymatic"};util.inherits(X,a);X.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});
(e=c.KEYMATIC.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});return f};X.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null};switch(f){case "timeout":c.channel=b+":0";c.dataPoint="UNREACH";break;case "lowbat":c.channel=b+":0";c.dataPoint="LOWBAT";break;case "state":c.channel=b+":1";c.dataPoint="STATE";break;case "uncertain":c.channel=b+":1";c.dataPoint="STATE_UNCERTAIN";break;case "error":c.channel=b+":1";c.dataPoint=
"ERROR";break;default:return null}return c};X.prototype.executeCommand=function(f,b,c){var e=x.hub.m.hm._Channel["BidCos-RF"];switch(b){case "open":b=this.deviceAdr+":"+this.channel;e.KEYMATIC.executeCommand(f,this.deviceIF,b,"open",c);break;case "close":b=this.deviceAdr+":"+this.channel;e.KEYMATIC.executeCommand(f,this.deviceIF,b,"close",c);break;case "openDoor":b=this.deviceAdr+":"+this.channel;e.KEYMATIC.executeCommand(f,this.deviceIF,b,"openDoor",c);break;default:c&&c(Error("no such command"))}};
X.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==b||"LOWBAT"==b)return e.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return f==this.channel?b=e.KEYMATIC.parseDptState(b,c):null};var G=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType=
"ou_led16"};util.inherits(G,a);G.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this.channel,dpt:"LED_STATUS"}]};G.prototype._getDptFromRef=function(f){var b=this.deviceAdr;-1==b.indexOf(":")&&this.channel&&(b+=":"+this.channel);b={channel:b,dataPoint:null};switch(f){case "led":b.dataPoint="LED_STATUS";break;default:return null}return b};G.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;
e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g||0!=f&&f!=this.channel)return null;if(0==f)return e={},"UNREACH"==b?e.timeout=c:"LOWBAT"==b?e.lowbat=c:e["0_"+b.toLowerCase()]=c,e;switch(b){case "LED_STATUS":switch(c){case 0:return{led:"off"};case 1:return{led:"red"};case 2:return{led:"green"};case 3:return{led:"orange"};default:return null}default:return null}};G.prototype.executeCommand=function(f,b,c){var e=this.deviceAdr;-1==e.indexOf(":")&&this.channel&&(e+=":"+this.channel);
switch(b){case "pressShort":f.writeValue(this.deviceIF,e,"PRESS_SHORT",!0,c);break;case "ledOff":f.writeValue(this.deviceIF,e,"LED_STATUS",0,c);break;case "ledRed":f.writeValue(this.deviceIF,e,"LED_STATUS",1,c);break;case "ledGreen":f.writeValue(this.deviceIF,e,"LED_STATUS",2,c);break;case "ledOrange":f.writeValue(this.deviceIF,e,"LED_STATUS",3,c);break;case "ledSleepOff":f.writeValue(this.deviceIF,e,"LED_SLEEP_MODE",0,c);break;case "ledSleepOn":f.writeValue(this.deviceIF,e,"LED_SLEEP_MODE",1,c);
break;default:c&&c(Error("no such command"))}};G.prototype.isButton=function(){return!0};G.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);f.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(c,f){c&&console.error("button claim PRESS_SHORT event error:"+c.stack);b&&b()})};var Na=function(f,b,c){a.call(this,f,b,c);this.channel=3;this.legacyType="hm_dis_ep_wm55"};util.inherits(Na,a);Na.prototype.executeCommand=function(f,b,c){if("submit"==
b.substr(0,6)){var e=b.substr(6);b=this.deviceAdr+":"+this.channel;f.writeValue(this.deviceIF,b,"SUBMIT",e,c)}else c&&c(Error("no such command"))};var Y=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="dualwhite"};util.inherits(Y,a);Y.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["BidCos-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.DUAL_WHITE_BRIGHTNESS.getReadableDpts())&&
e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});(e=c.DUAL_WHITE_COLOR.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":2",dpt:c})});return f};Y.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["BidCos-RF"];switch(f){case "timeout":c.channel=b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "bri":case "bri_real":case "error_overheat":case "error_reduced":case "direction":c.channel=
b+":1";c.dataPoint=e.DUAL_WHITE_BRIGHTNESS.getDptFromState(f);break;case "color":case "color_real":case "color_direction":c.channel=b+":2";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return c};Y.prototype.executeCommand=function(f,b,c){var e=x.hub.m.hm._Channel["BidCos-RF"];switch(b){case "off":case "on":case "toggle":case "dimUp":case "dimDown":e.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",b,c);break;case "colorOff":case "colorOn":case "colorToggle":case "colorUp":case "colorDown":e.DUAL_WHITE_COLOR.executeCommand(f,
this.deviceIF,this.deviceAdr+":2",b,c);break;default:"dimTo"==b.substr(0,5)?e.DUAL_WHITE_BRIGHTNESS.executeCommand(f,this.deviceIF,this.deviceAdr+":1",b,c):"colorTo"==b.substr(0,7)?e.DUAL_WHITE_COLOR.executeCommand(f,this.deviceIF,this.deviceAdr+":2",b,c):c&&c(Error("no such command"))}};Y.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=
g)return null;e=x.hub.m.hm._Channel["BidCos-RF"];if(0==f){if("UNREACH"==b)return e.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==f?e.DUAL_WHITE_BRIGHTNESS.parseDptState(b,c):2==f?e.DUAL_WHITE_COLOR.parseDptState(b,c):null};var Oa=function(f,b,c){k.call(this,f,b,c);this.channel=3;this.legacyType="ip_switch"};util.inherits(Oa,k);var Aa=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_contact"};util.inherits(Aa,a);Aa.prototype._getReadableDpts=
function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.SHUTTER_CONTACT_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});return f};Aa.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=
b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":c.channel=b+":1";c.dataPoint=e.SHUTTER_CONTACT_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};Aa.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==
b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==f?e.SHUTTER_CONTACT_TRANSCEIVER.parseDptState(b,c):null};var Z=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_heater"};util.inherits(Z,a);Z.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&
e.forEach(function(c){"HUMIDITY"!=c&&f.push({channel:b.deviceAdr+":1",dpt:c})});return f};Z.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "mode":case "state":case "window":c.channel=b+":1";c.dataPoint=e.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);
break;default:return null}return c};Z.prototype.executeCommand=function(f,b,c){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,b,c)};Z.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==f){if("UNREACH"==
b||"LOW_BAT"==b)return e.MAINTENANCE.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 1==f?e.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(b,c):a};var aa=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_powerswitch"};util.inherits(aa,a);aa.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&
e.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c})});(e=c.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":6",dpt:c})});return f};aa.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "switchState":c.channel=b+":3";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":c.channel=b+":6";c.dataPoint=e.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return c};aa.prototype.executeCommand=function(f,b,c){var e=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "on":var a=this.deviceAdr+":3";e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,a,"on",c);break;case "off":a=this.deviceAdr+":3";e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
a,"off",c);break;case "toggle":a=this.deviceAdr+":3";e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,a,"toggle",c);break;default:"onFor"==b.substr(0,5)?(a=this.deviceAdr+":3",e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,a,b,c)):c&&c(Error("no such command"))}};aa.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;
e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b)return e.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 3==f?e.SWITCH_VIRTUAL_RECEIVER.parseDptState(b,c):6==f?e.ENERGIE_METER_TRANSMITTER.parseDptState(b,c):null};var ba=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_energyactor"};util.inherits(ba,a);ba.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==
c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.SWITCH_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c})});(e=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":4",dpt:c});f.push({channel:b.deviceAdr+":5",dpt:c});f.push({channel:b.deviceAdr+":6",dpt:c})});(e=c.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":7",dpt:c})});return f};ba.prototype._getDptFromRef=
function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "switchState":c.channel=b+":3";c.dataPoint=e.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case "ch4State":c.channel=b+":4";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch5State":c.channel=b+":5";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch6State":c.channel=b+":6";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":c.channel=b+":7";c.dataPoint=e.ENERGIE_METER_TRANSMITTER.getDptFromState(f);break;default:return null}return c};ba.prototype.executeCommand=function(f,b,c){var e=null,a=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "on":case "ch4on":case "ch5on":case "ch6on":switch(b){case "on":case "ch4on":e=
this.deviceAdr+":4";break;case "ch5on":e=this.deviceAdr+":5";break;case "ch6on":e=this.deviceAdr+":6"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"on",c);break;case "off":case "ch4off":case "ch5off":case "ch6off":switch(b){case "off":case "ch4off":e=this.deviceAdr+":4";break;case "ch5off":e=this.deviceAdr+":5";break;case "ch6off":e=this.deviceAdr+":6"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"off",c);break;case "toggle":case "ch4toggle":case "ch5toggle":case "ch6toggle":switch(b){case "toggle":case "ch4toggle":e=
this.deviceAdr+":4";break;case "ch5toggle":e=this.deviceAdr+":5";break;case "ch6toggle":e=this.deviceAdr+":6"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggle",c);break;default:c&&c(Error("no such command"))}};ba.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==
f){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(3==f){if(b=a.SWITCH_TRANSMITTER.parseDptState(b,c))e={},e.switchState=b.switchTState;return e}if(4==f||5==f||6==f){if(b=a.SWITCH_VIRTUAL_RECEIVER.parseDptState(b,c))switch(e={},parseInt(f)){case 4:e.ch4State=b.switchState;break;case 5:e.ch5State=b.switchState;break;case 6:e.ch6State=b.switchState}return e}return 7==f?a.ENERGIE_METER_TRANSMITTER.parseDptState(b,c):null};var ca=function(f,b,c){a.call(this,
f,b,c);this.channel=1;this.legacyType="ip_energyactor2"};util.inherits(ca,a);ca.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.SWITCH_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});(e=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":2",dpt:c});
f.push({channel:b.deviceAdr+":3",dpt:c});f.push({channel:b.deviceAdr+":4",dpt:c})});(e=c.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":5",dpt:c})});return f};ca.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "switchState":c.channel=b+":1";c.dataPoint=e.SWITCH_TRANSMITTER.getDptFromState("switchTState");
break;case "ch2State":c.channel=b+":2";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch3State":c.channel=b+":3";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":c.channel=b+":4";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "meterVoltage":case "meterEnergyCounter":case "meterFrequency":case "meterPower":case "meterCurrent":c.channel=b+":5";c.dataPoint=e.ENERGIE_METER_TRANSMITTER.getDptFromState(f);
break;default:return null}return c};ca.prototype.executeCommand=function(f,b,c){var e=null,a=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "on":case "ch2on":case "ch3on":case "ch4on":switch(b){case "on":case "ch2on":e=this.deviceAdr+":2";break;case "ch3on":e=this.deviceAdr+":3";break;case "ch4on":e=this.deviceAdr+":4"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"on",c);break;case "off":case "ch2off":case "ch3off":case "ch4off":switch(b){case "off":case "ch2off":e=this.deviceAdr+":2";
break;case "ch3off":e=this.deviceAdr+":3";break;case "ch4off":e=this.deviceAdr+":4"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"off",c);break;case "toggle":case "ch2toggle":case "ch3toggle":case "ch4toggle":switch(b){case "toggle":case "ch2toggle":e=this.deviceAdr+":2";break;case "ch3toggle":e=this.deviceAdr+":3";break;case "ch4toggle":e=this.deviceAdr+":4"}a.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggle",c);break;default:c&&c(Error("no such command"))}};ca.prototype.parseDptState=
function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(1==f){if(b=a.SWITCH_TRANSMITTER.parseDptState(b,c))e={},e.switchState=b.switchTState;return e}if(2==f||3==f||4==f){if(b=a.SWITCH_VIRTUAL_RECEIVER.parseDptState(b,
c))switch(e={},parseInt(f)){case 2:e.ch2State=b.switchState;break;case 3:e.ch3State=b.switchState;break;case 4:e.ch4State=b.switchState}return e}return 5==f?a.ENERGIE_METER_TRANSMITTER.parseDptState(b,c):null};var da=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_dimmer"};util.inherits(da,a);da.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:b.deviceAdr+
":0",dpt:c})});(e=c.DIMMER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c})});(e=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":4",dpt:c});f.push({channel:b.deviceAdr+":5",dpt:c});f.push({channel:b.deviceAdr+":6",dpt:c})});return f};da.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=
b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":c.channel=b+":3";c.dataPoint=e.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":c.channel=b+":4";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch5Level":c.channel=b+":5";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":c.channel=b+":6";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return c};
da.prototype.executeCommand=function(f,b,c){var e=null,a=x.hub.m.hm._Channel["HmIP-RF"],g=b;if(-1!=b.indexOf("dimUp")){var k=b.indexOf("dimUp");g=b.substr(0,k+5);var h=b.substr(k+5)}else-1!=b.indexOf("dimDown")?(k=b.indexOf("dimDown"),g=b.substr(0,k+7),h=b.substr(k+7)):-1!=b.indexOf("dimTo")?(k=b.indexOf("dimTo"),g=b.substr(0,k+5),h=b.substr(k+5)):-1!=b.indexOf("toggleTo")&&(k=b.indexOf("toggleTo"),g=b.substr(0,k+8),h=b.substr(k+8));var l=this;switch(g){case "dimOff":a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","dimOff",function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimOff",function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimOff",c)})});break;case "dimUp":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value+
h,1<h&&(h=1),h=Math.round(100*h),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+h,c)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==
typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+h,c)})}))});break;case "dimTo":if(!h){c&&c(Error("dimTo has no value"));break}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+h,function(b,e){b?c&&c(b,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(b))})})});break;case "toggleTo":if(!h){c&&c(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(e.value&&(h=0),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","dimTo"+h,c)})}))});break;case "ch4dimOff":case "ch5dimOff":case "ch6dimOff":switch(g){case "ch4dimOff":e=
this.deviceAdr+":4";break;case "ch5dimOff":e=this.deviceAdr+":5";break;case "ch6dimOff":e=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimOff",c);break;case "ch4dimUp":case "ch5dimUp":case "ch6dimUp":switch(g){case "ch4dimUp":e=this.deviceAdr+":4";break;case "ch5dimUp":e=this.deviceAdr+":5";break;case "ch6dimUp":e=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimUp"+h,c);break;case "ch4dimDown":case "ch5dimDown":case "ch6dimDown":switch(g){case "ch4dimDown":e=
this.deviceAdr+":4";break;case "ch5dimDown":e=this.deviceAdr+":5";break;case "ch6dimDown":e=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimDown"+h,c);break;case "ch4dimTo":case "ch5dimTo":case "ch6dimTo":switch(g){case "ch4dimTo":e=this.deviceAdr+":4";break;case "ch5dimTo":e=this.deviceAdr+":5";break;case "ch6dimTo":e=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimTo"+h,c);break;case "ch4toggleTo":case "ch5toggleTo":case "ch6toggleTo":switch(g){case "ch4toggleTo":e=
this.deviceAdr+":4";break;case "ch5toggleTo":e=this.deviceAdr+":5";break;case "ch6toggleTo":e=this.deviceAdr+":6"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggleTo"+h,c);break;default:c&&c(Error("no such command"))}};da.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=
null;if(0==f){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(3==f){if(b=a.DIMMER_TRANSMITTER.parseDptState(b,c))e={},e.dimmerLevel=b.dimmerTLevel;return e}if(4==f||5==f||6==f){if(b=a.DIMMER_VIRTUAL_RECEIVER.parseDptState(b,c))switch(e={},parseInt(f)){case 4:e.ch4Level=b.dimmerLevel;break;case 5:e.ch5Level=b.dimmerLevel;break;case 6:e.ch6Level=b.dimmerLevel}return e}return null};var ea=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType=
"ip_dimmer2"};util.inherits(ea,a);ea.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.DIMMER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":2",dpt:c})});(e=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c});f.push({channel:b.deviceAdr+":4",dpt:c});
f.push({channel:b.deviceAdr+":5",dpt:c})});return f};ea.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":c.channel=b+":2";c.dataPoint=e.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch4Level":c.channel=b+":3";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;
case "ch5Level":c.channel=b+":4";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch6Level":c.channel=b+":5";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null}return c};ea.prototype.executeCommand=function(f,b,c){var e=null,a=x.hub.m.hm._Channel["HmIP-RF"],g=b;if(-1!=b.indexOf("dimUp")){var k=b.indexOf("dimUp");g=b.substr(0,k+5);var h=b.substr(k+5)}else-1!=b.indexOf("dimDown")?(k=b.indexOf("dimDown"),g=b.substr(0,k+7),h=
b.substr(k+7)):-1!=b.indexOf("dimTo")?(k=b.indexOf("dimTo"),g=b.substr(0,k+5),h=b.substr(k+5)):-1!=b.indexOf("toggleTo")&&(k=b.indexOf("toggleTo"),g=b.substr(0,k+8),h=b.substr(k+8));var l=this;switch(g){case "dimOff":a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3","dimOff",function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimOff",function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":5","dimOff",c)})});break;case "dimUp":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value+h,1<h&&(h=1),h=Math.round(100*h),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(b,e){b?
c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,c)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,c)})}))});break;case "dimTo":if(!h){c&&c(Error("dimTo has no value"));break}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":5","dimTo"+h,function(b,e){b?c&&c(b,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":2","LEVEL",e,(new Date).getTime()+1E3),c&&c(b))})})});break;case "toggleTo":if(!h){c&&c(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(e.value&&(h=0),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":3","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","dimTo"+h,c)})}))});break;case "ch3dimOff":case "ch4dimOff":case "ch5dimOff":switch(g){case "ch3dimOff":e=this.deviceAdr+":3";break;case "ch4dimOff":e=this.deviceAdr+":4";break;case "ch5dimOff":e=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,
e,"dimOff",c);break;case "ch3dimUp":case "ch4dimUp":case "ch5dimUp":switch(g){case "ch3dimUp":e=this.deviceAdr+":3";break;case "ch4dimUp":e=this.deviceAdr+":4";break;case "ch5dimUp":e=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimUp"+h,c);break;case "ch3dimDown":case "ch4dimDown":case "ch5dimDown":switch(g){case "ch3dimDown":e=this.deviceAdr+":3";break;case "ch4dimDown":e=this.deviceAdr+":4";break;case "ch5dimDown":e=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,e,"dimDown"+h,c);break;case "ch3dimTo":case "ch4dimTo":case "ch5dimTo":switch(g){case "ch3dimTo":e=this.deviceAdr+":3";break;case "ch4dimTo":e=this.deviceAdr+":4";break;case "ch5dimTo":e=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimTo"+h,c);break;case "ch3toggleTo":case "ch4toggleTo":case "ch5toggleTo":switch(g){case "ch3toggleTo":e=this.deviceAdr+":3";break;case "ch4toggleTo":e=this.deviceAdr+":4";break;case "ch5toggleTo":e=this.deviceAdr+":5"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,e,"toggleTo"+h,c);break;default:c&&c(Error("no such command"))}};ea.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(2==f){if(b=a.DIMMER_TRANSMITTER.parseDptState(b,
c))e={},e.dimmerLevel=b.dimmerTLevel;return e}if(3==f||4==f||5==f){if(b=a.DIMMER_VIRTUAL_RECEIVER.parseDptState(b,c))switch(e={},parseInt(f)){case 3:e.ch3Level=b.dimmerLevel;break;case 4:e.ch4Level=b.dimmerLevel;break;case 5:e.ch5Level=b.dimmerLevel}return e}return null};var fa=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_dimmer3"};util.inherits(fa,a);fa.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();
e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.DIMMER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});(e=c.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":2",dpt:c});f.push({channel:b.deviceAdr+":3",dpt:c});f.push({channel:b.deviceAdr+":4",dpt:c})});return f};fa.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},
e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "dimmerLevel":c.channel=b+":1";c.dataPoint=e.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case "ch2Level":c.channel=b+":2";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch3Level":c.channel=b+":3";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case "ch4Level":c.channel=b+":4";c.dataPoint=e.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");
break;default:return null}return c};fa.prototype.executeCommand=function(f,b,c){var e=null,a=x.hub.m.hm._Channel["HmIP-RF"],g=b;if(-1!=b.indexOf("dimUp")){var k=b.indexOf("dimUp");g=b.substr(0,k+5);var h=b.substr(k+5)}else-1!=b.indexOf("dimDown")?(k=b.indexOf("dimDown"),g=b.substr(0,k+7),h=b.substr(k+7)):-1!=b.indexOf("dimTo")?(k=b.indexOf("dimTo"),g=b.substr(0,k+5),h=b.substr(k+5)):-1!=b.indexOf("toggleTo")&&(k=b.indexOf("toggleTo"),g=b.substr(0,k+8),h=b.substr(k+8));var l=this;switch(g){case "dimOff":a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":2","dimOff",function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimOff",function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimOff",c)})});break;case "dimUp":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value+
h,1<h&&(h=1),h=Math.round(100*h),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,c)})}))});break;case "dimDown":h=h?parseInt(h)/100:.1;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==
typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,c)})}))});break;case "dimTo":if(!h){c&&c(Error("dimTo has no value"));break}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":2","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,function(b,e){b?c&&c(b,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":1","LEVEL",e,(new Date).getTime()+1E3),c&&c(b))})})});break;case "toggleTo":if(!h){c&&c(Error("toggle has no value"));break}f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get dimmer current value return invalid")):(e.value&&(h=0),a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":2","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":3","dimTo"+h,function(b,e){b?c&&c(b,e):a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","dimTo"+h,c)})}))});break;case "ch2dimOff":case "ch3dimOff":case "ch4dimOff":switch(g){case "ch2dimOff":e=
this.deviceAdr+":2";break;case "ch3dimOff":e=this.deviceAdr+":3";break;case "ch4dimOff":e=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimOff",c);break;case "ch2dimUp":case "ch3dimUp":case "ch4dimUp":switch(g){case "ch2dimUp":e=this.deviceAdr+":2";break;case "ch3dimUp":e=this.deviceAdr+":3";break;case "ch4dimUp":e=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimUp"+h,c);break;case "ch2dimDown":case "ch3dimDown":case "ch4dimDown":switch(g){case "ch2dimDown":e=
this.deviceAdr+":2";break;case "ch3dimDown":e=this.deviceAdr+":3";break;case "ch4dimDown":e=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimDown"+h,c);break;case "ch2dimTo":case "ch3dimTo":case "ch4dimTo":switch(g){case "ch2dimTo":e=this.deviceAdr+":2";break;case "ch3dimTo":e=this.deviceAdr+":3";break;case "ch4dimTo":e=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"dimTo"+h,c);break;case "ch2toggleTo":case "ch3toggleTo":case "ch4toggleTo":switch(g){case "ch2toggleTo":e=
this.deviceAdr+":2";break;case "ch3toggleTo":e=this.deviceAdr+":3";break;case "ch4toggleTo":e=this.deviceAdr+":4"}a.DIMMER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"toggleTo"+h,c);break;default:c&&c(Error("no such command"))}};fa.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=
null;if(0==f){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(1==f){if(b=a.DIMMER_TRANSMITTER.parseDptState(b,c))e={},e.dimmerLevel=b.dimmerTLevel;return e}if(2==f||3==f||4==f){if(b=a.DIMMER_VIRTUAL_RECEIVER.parseDptState(b,c))switch(e={},parseInt(f)){case 2:e.ch2Level=b.dimmerLevel;break;case 3:e.ch3Level=b.dimmerLevel;break;case 4:e.ch4Level=b.dimmerLevel}return e}return null};var ha=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType=
"ip_motion"};util.inherits(ha,a);ha.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});return f};ha.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=
b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":c.channel=b+":1";c.dataPoint=e.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};ha.prototype.executeCommand=function(f,b,c){var e=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "reset":case "activate":case "deactivate":case "toggleActivate":e.MOTIONDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",b,c);break;default:c&&c(Error("no such command"))}};
ha.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==f?e.MOTIONDETECTOR_TRANSCEIVER.parseDptState(b,c):null};var H=function(f,b,c){a.call(this,
f,b,c);this.channel=3;this.legacyType="ip_motion2"};util.inherits(H,a);H.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c})});return f};H.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,
dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "active":c.channel=b+":3";c.dataPoint=e.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};H.prototype.executeCommand=function(f,b,c){switch(b){case "reset":case "activate":case "deactivate":case "toggleActivate":break;default:c&&c(Error("no such command"))}};H.prototype.parseDptState=
function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}1==f&&(g=e.KEY_TRANRECEIVER.parseDptState(b,c))&&(g.pressShort&&(a={btn1pressShort:!0}),g.pressLong&&(a={btn1pressLong:!0}));2==f&&(g=
e.KEY_TRANRECEIVER.parseDptState(b,c))&&(g.pressShort&&(a={btn2pressShort:!0}),g.pressLong&&(a={btn2pressLong:!0}));return 3==f?e.MOTIONDETECTOR_TRANSCEIVER.parseDptState(b,c):a};H.prototype.isButton=function(){return!0};H.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(c,a){c&&console.error("button:1 claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(e.deviceIF,
e.deviceAdr+":1","PRESS_LONG",function(c,a){c&&console.error("button:1 claim PRESS_LONG event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":2","PRESS_SHORT",function(c,a){c&&console.error("button:2 claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":2","PRESS_LONG",function(c,e){c&&console.error("button:2 claim PRESS_LONG event error:"+c.stack);b&&b()})})})})};var N=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_button"};util.inherits(N,
a);N.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});return f};N.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};
N.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return a.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}f==this.channel&&(b=a.KEY_TRANRECEIVER.parseDptState(b,c))&&(b.pressShort&&(e={pressShort:!0}),b.pressLong&&
(e={pressLong:!0}));return e};N.prototype.isButton=function(){return!0};N.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(c,a){c&&console.error("button:1 claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":1","PRESS_LONG",function(c,e){c&&console.error("button:1 claim PRESS_LONG event error:"+c.stack);b&&b()})})};var O=
function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_button2"};util.inherits(O,a);O.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});return f};O.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=
b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};O.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}1==f&&(g=e.KEY_TRANRECEIVER.parseDptState(b,
c))&&(g.pressShort&&(a={btn1pressShort:!0}),g.pressLong&&(a={btn1pressLong:!0}));2==f&&(g=e.KEY_TRANRECEIVER.parseDptState(b,c))&&(g.pressShort&&(a={btn2pressShort:!0}),g.pressLong&&(a={btn2pressLong:!0}));return a};O.prototype.isButton=function(){return!0};O.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;f.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(c,a){c&&console.error("button:1 claim PRESS_SHORT event error:"+
c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":1","PRESS_LONG",function(c,a){c&&console.error("button:1 claim PRESS_LONG event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":2","PRESS_SHORT",function(c,a){c&&console.error("button:2 claim PRESS_SHORT event error:"+c.stack);f.reportValueUsage(e.deviceIF,e.deviceAdr+":2","PRESS_LONG",function(c,e){c&&console.error("button:2 claim PRESS_LONG event error:"+c.stack);b&&b()})})})})};var I=function(f,b,c){a.call(this,f,b,c);this.channel=
1;this.legacyType="ip_button4"};util.inherits(I,a);I.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});return f};I.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);
break;default:return null}return c};I.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return a.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(1==f||2==f||3==f||4==f)if(b=a.KEY_TRANRECEIVER.parseDptState(b,c))e||
(e={}),b.pressShort&&(e["btn"+f+"pressShort"]=!0),b.pressLong&&(e["btn"+f+"pressLong"]=!0);return e};I.prototype.isButton=function(){return!0};I.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){e._claimButtonEvent(3,f,function(){e._claimButtonEvent(4,f,function(){b&&b()})})})})};I.prototype._claimButtonEvent=function(f,b,c){var e=this;b.reportValueUsage(this.deviceIF,
this.deviceAdr+":"+f,"PRESS_SHORT",function(a,g){a&&console.error("button:"+f+" claim PRESS_SHORT event error:"+a.stack);b.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(b,e){b&&console.error("button:"+f+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};var J=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_button6"};util.inherits(J,a);J.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();
c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});return f};J.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};J.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=
this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return a.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(1==f||2==f||3==f||4==f||5==f||6==f)if(b=a.KEY_TRANRECEIVER.parseDptState(b,c))e||(e={}),b.pressShort&&(e["btn"+f+"pressShort"]=!0),b.pressLong&&(e["btn"+f+"pressLong"]=!0);return e};J.prototype.isButton=function(){return!0};J.prototype.claimEvent=
function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){e._claimButtonEvent(3,f,function(){e._claimButtonEvent(4,f,function(){e._claimButtonEvent(5,f,function(){e._claimButtonEvent(6,f,function(){b&&b()})})})})})})};J.prototype._claimButtonEvent=function(f,b,c){var e=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(a,g){a&&console.error("button:"+
f+" claim PRESS_SHORT event error:"+a.stack);b.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(b,e){b&&console.error("button:"+f+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};var ia=function(f,b,c){a.call(this,f,b,c);this.channel=3;this.legacyType="ip_siren"};util.inherits(ia,a);ia.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});
(e=c.ALARM_SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c})});return f};ia.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":c.channel=b+":3";c.dataPoint=e.ALARM_SWITCH_VIRTUAL_RECEIVER.getDptFromState(f);break;default:return null}return c};
ia.prototype.executeCommand=function(f,b,c){x.hub.m.hm._Channel["HmIP-RF"].ALARM_SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":3",b,c)};ia.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,
c);e={};e["0_"+b.toLowerCase()]=c;return e}return 3==f?e.ALARM_SWITCH_VIRTUAL_RECEIVER.parseDptState(b,c):null};var B=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_wallthermo"};util.inherits(B,a);B.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){"LEVEL"!=
c&&f.push({channel:b.deviceAdr+":1",dpt:c})});return f};B.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":c.channel=b+":1";c.dataPoint=e.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(f);break;
default:return null}return c};B.prototype.executeCommand=function(f,b,c){x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,b,c)};B.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==f){if("UNREACH"==b||
"LOW_BAT"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 1==f?e.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(b,c):a};var Ba=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_wallthermo2"};util.inherits(Ba,B);Ba.prototype._getReadableDpts=function(){var f=B.prototype._getReadableDpts.call(this);f||(f=[]);var b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+
":8",dpt:c})});(e=c.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":10",dpt:c})});return f};Ba.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "valveState":c.channel=b+":10";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "cl_fd_emergencyOP":case "cl_fd_frostProtection":case "cl_fd_state":case "cl_fd_humidityAlarm":c.channel=
b+":8";c.dataPoint=e.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getDptFromState(f);break;default:return B.prototype._getDptFromRef.call(this,f)}return c};Ba.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return a.MAINTENANCE_BAT_EL.parseDptState(b,
c);e={};e["0_"+b.toLowerCase()]=c;return e}if(1==f)return a.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(b,c);if(8==f)return a.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.parseDptState(b,c);10==f&&(e={},b=a.SWITCH_VIRTUAL_RECEIVER.parseDptState(b,c),e.valveState=b?b.switchState:"?");return e};var ja=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_smoke"};util.inherits(ja,a);ja.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();
e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.SMOKE_DETECTOR.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});return f};ja.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "profile":case "temp":case "boost":case "frost":case "hum":case "mode":case "state":case "window":c.channel=
b+":1";c.dataPoint=e.SMOKE_DETECTOR.getDptFromState(f);break;default:return null}return c};ja.prototype.executeCommand=function(f,b,c){x.hub.m.hm._Channel["HmIP-RF"].SMOKE_DETECTOR.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,b,c)};ja.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];
a=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 1==f?e.SMOKE_DETECTOR.parseDptState(b,c):a};var Ca=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_window"};util.inherits(Ca,a);Ca.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.ROTARY_HANDLE_TRANSCEIVER.getReadableDpts())&&
e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});return f};Ca.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":c.channel=b+":1";c.dataPoint=e.ROTARY_HANDLE_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};Ca.prototype.parseDptState=function(f,
b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];a=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);a={};a["0_"+b.toLowerCase()]=c;return a}return 1==f?e.ROTARY_HANDLE_TRANSCEIVER.parseDptState(b,c):a};var y=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType=
"ip_blind"};util.inherits(y,a);y.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.SHUTTER_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c})});(e=c.SHUTTER_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":4",dpt:c});f.push({channel:b.deviceAdr+":5",dpt:c});f.push({channel:b.deviceAdr+
":6",dpt:c})});return f};y.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "blindLevel":c.channel=b+":3";c.dataPoint=e.SHUTTER_TRANSMITTER.getDptFromState("blindTLevel");break;case "ch4Level":c.channel=b+":4";c.dataPoint=e.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch5Level":c.channel=b+":5";
c.dataPoint=e.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case "ch6Level":c.channel=b+":6";c.dataPoint=e.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;default:return null}return c};y.prototype.executeCommand=function(f,b,c){var e=null,a=x.hub.m.hm._Channel["HmIP-RF"],g=b;if(-1!=b.indexOf("stepUp")){var h=b.indexOf("stepUp");g=b.substr(0,h+6);var k=b.substr(h+6)}else-1!=b.indexOf("stepDown")?(h=b.indexOf("stepDown"),g=b.substr(0,h+8),k=b.substr(h+8)):-1!=b.indexOf("moveTo")?
(h=b.indexOf("moveTo"),g=b.substr(0,h+6),k=b.substr(h+6)):-1!=b.indexOf("stop")&&(h=b.indexOf("stop"),g=b.substr(0,h+4),k=b.substr(h+4));var l=this;switch(g){case "stop":a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","stop",function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","stop",function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","stop",c)})});break;case "moveUp":a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","moveUp",function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo0",function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",c)})});break;case "moveDown":a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveDown",function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo0",function(b,e){b?
c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",c)})});break;case "stepUp":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(k=e.value+k,1<k&&(k=1),k=Math.round(100*k),a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5","moveTo0",function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",function(b,e){b?c&&c(b,e):(e=k/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(b))})})}))});break;case "stepDown":k=k?parseInt(k)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):
(k=e.value-k,0>k&&(k=0),k=Math.round(100*k),a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+k,function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo0",function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",function(b,e){b?c&&c(b,e):(e=k/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(b))})})}))});
break;case "moveTo":if(!k){c&&c(Error("moveTo has no value"));break}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4","moveTo"+k,function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo0",function(b,e){b?c&&c(b,e):a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo0",function(b,e){b?c&&c(b,e):(e=k/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+
1E3),c&&c(b))})})});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(g){case "ch4stop":e=this.deviceAdr+":4";break;case "ch5stop":e=this.deviceAdr+":5";break;case "ch6stop":e=this.deviceAdr+":6"}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stop",c);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(g){case "ch4moveUp":e=this.deviceAdr+":4";break;case "ch5moveUp":e=this.deviceAdr+":5";break;case "ch6moveUp":e=this.deviceAdr+":6"}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,e,"moveUp",c);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(g){case "ch4moveDown":e=this.deviceAdr+":4";break;case "ch5moveDown":e=this.deviceAdr+":5";break;case "ch6moveDown":e=this.deviceAdr+":6"}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveDown",c);break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(g){case "ch4stepUp":e=this.deviceAdr+":4";break;case "ch5stepUp":e=this.deviceAdr+":5";break;case "ch6stepUp":e=this.deviceAdr+
":6"}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stepUp"+k,c);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(g){case "ch4stepDown":e=this.deviceAdr+":4";break;case "ch5stepDown":e=this.deviceAdr+":5";break;case "ch6stepDown":e=this.deviceAdr+":6"}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stepDown"+k,c);break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(g){case "ch4moveTo":e=this.deviceAdr+":4";break;case "ch5moveTo":e=this.deviceAdr+
":5";break;case "ch6moveTo":e=this.deviceAdr+":6"}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveTo"+k,c);break;default:c&&c(Error("no such command"))}};y.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,
c);e={};e["0_"+b.toLowerCase()]=c;return e}if(3==f){if(b=a.SHUTTER_TRANSMITTER.parseDptState(b,c))e={},e.blindLevel=b.blindTLevel;return e}if(4==f||5==f||6==f){if(b=a.SHUTTER_VIRTUAL_RECEIVER.parseDptState(b,c))switch(e={},parseInt(f)){case 4:e.ch4Level=b.blindLevel;break;case 5:e.ch5Level=b.blindLevel;break;case 6:e.ch6Level=b.blindLevel}return e}return null};y.prototype.getConfig=function(f,b){var c=this.deviceAdr+":3";f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)b&&b(e);else{var a=
{},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});a[c]=g;b&&b(e,a)}})};y.prototype.setConfig=function(f,b,c){if(b){var e=this.deviceAdr+
":3";if(b=b[e]){var a={};a.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};a.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};f.setParamset(this.deviceIF,e,"MASTER",a,function(b){c&&c(b)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};y.prototype.isButton=function(){return!0};y.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){b&&
b()})})};y.prototype._claimButtonEvent=function(f,b,c){var e=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(a,g){a&&console.error("button:"+f+" claim PRESS_SHORT event error:"+a.stack);b.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(b,e){b&&console.error("button:"+f+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};var z=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_jalousie"};util.inherits(z,a);z.prototype._getReadableDpts=
function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE.getReadableDpts();e&&e.forEach(function(c){"UNREACH"==c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.BLIND_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":3",dpt:c})});(e=c.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":4",dpt:c});f.push({channel:b.deviceAdr+":5",dpt:c});f.push({channel:b.deviceAdr+":6",dpt:c})});return f};z.prototype._getDptFromRef=
function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":c.channel=b+":0";c.dataPoint=e.MAINTENANCE.getDptFromState(f);break;case "blindLevel":c.channel=b+":3";c.dataPoint=e.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":c.channel=b+":3";c.dataPoint=e.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;case "ch4blindLevel":c.channel=b+":4";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");
break;case "ch4lamellaLevel":c.channel=b+":4";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch5blindLevel":c.channel=b+":5";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch5lamellaLevel":c.channel=b+":5";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case "ch6blindLevel":c.channel=b+":6";c.dataPoint=e.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case "ch6lamellaLevel":c.channel=b+":6";c.dataPoint=
e.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;default:return null}return c};z.prototype.executeCommand=function(f,b,c){var e=null,a=x.hub.m.hm._Channel["HmIP-RF"],g=b;if(-1!=b.indexOf("stepUp")){var k=b.indexOf("stepUp");g=b.substr(0,k+6);var h=b.substr(k+6)}else-1!=b.indexOf("stepDown")?(k=b.indexOf("stepDown"),g=b.substr(0,k+8),h=b.substr(k+8)):-1!=b.indexOf("moveTo")?(k=b.indexOf("moveTo"),g=b.substr(0,k+6),h=b.substr(k+6)):-1!=b.indexOf("stop")?(k=b.indexOf("stop"),g=b.substr(0,
k+4),h=b.substr(k+4)):-1!=b.indexOf("lamellaStepUp")?(k=b.indexOf("lamellaStepUp"),g=b.substr(0,k+13),h=b.substr(k+13)):-1!=b.indexOf("lamellaStepDown")?(k=b.indexOf("lamellaStepDown"),g=b.substr(0,k+15),h=b.substr(k+15)):-1!=b.indexOf("lamellaTo")&&(k=b.indexOf("lamellaTo"),g=b.substr(0,k+9),h=b.substr(k+9));var l=this;switch(g){case "stop":case "moveUp":case "moveDown":a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":4",g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":5",g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6",g,c)})});break;case "lamellaUp":case "lamellaDown":f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(h=e.value,h=Math.round(100*h),a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4",g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5",g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6",g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,e){c&&c(b,e)})})})})})}))});break;case "stepUp":h=
h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(h=e.value+h,1<h&&(h=1),h=Math.round(100*h),a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,e){b?c&&c(b,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(b))})})}))});break;case "stepDown":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get blind current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":4","moveTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,e){b?c&&c(b,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(b))})})}))});break;case "moveTo":if(!h){c&&c(Error("moveTo has no value"));break}a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
this.deviceIF,this.deviceAdr+":4","moveTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+h,function(b,e){b?c&&c(b,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL",e,(new Date).getTime()+1E3),c&&c(b))})})});break;case "lamellaStepUp":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,
channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){if(b)c&&c(b);else if("undefined"==typeof e||null==e)c&&c(Error("get blind current value return invalid"));else{var g=e.value;g=Math.round(100*g);f.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get lamella current value return invalid")):(h=e.value+h,1<h&&(h=1),h=Math.round(100*h),a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+
":4","lamellaTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,l.deviceAdr+":6","moveTo"+g,function(b,e){b?c&&c(b,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",e,(new Date).getTime()+1E3),c&&c(b))})})})})})}))})}});break;case "lamellaStepDown":h=h?parseInt(h)/100:.05;f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){if(b)c&&c(b);else if("undefined"==typeof e||null==e)c&&c(Error("get blind current value return invalid"));else{var g=e.value;g=Math.round(100*
g);f.getState({interface:l.deviceIF,channel:l.deviceAdr+":3",datapoint:"LEVEL_2"},function(b,e){b?c&&c(b):"undefined"==typeof e||null==e?c&&c(Error("get lamella current value return invalid")):(h=e.value-h,0>h&&(h=0),h=Math.round(100*h),a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","moveTo"+g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":5","lamellaTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+g,function(b,e){b?c&&c(b,e):(e=h/100,1<e&&(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",e,(new Date).getTime()+1E3),c&&
c(b))})})})})})}))})}});break;case "lamellaTo":if(!h){c&&c(Error("lamellaTo has no value"));break}f.getState({interface:this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(b,e){if(b)c&&c(b);else if("undefined"==typeof e||null==e)c&&c(Error("get blind current value return invalid"));else{var g=e.value;g=Math.round(100*g);a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":4","lamellaTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,
l.deviceAdr+":4","moveTo"+g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","lamellaTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":5","moveTo"+g,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","lamellaTo"+h,function(b,e){b?c&&c(b,e):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,l.deviceAdr+":6","moveTo"+g,function(b,e){b?c&&c(b,e):(e=h/100,1<e&&
(e=1),0>e&&(e=0),f.updateStatusBuffer(l.deviceIF,l.deviceAdr+":3","LEVEL_2",e,(new Date).getTime()+1E3),c&&c(b))})})})})})})}});break;case "ch4stop":case "ch5stop":case "ch6stop":switch(g){case "ch4stop":e=this.deviceAdr+":4";break;case "ch5stop":e=this.deviceAdr+":5";break;case "ch6stop":e=this.deviceAdr+":6"}a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stop",c);break;case "ch4moveUp":case "ch5moveUp":case "ch6moveUp":switch(g){case "ch4moveUp":e=this.deviceAdr+":4";break;case "ch5moveUp":e=
this.deviceAdr+":5";break;case "ch6moveUp":e=this.deviceAdr+":6"}a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveUp",c);break;case "ch4moveDown":case "ch5moveDown":case "ch6moveDown":switch(g){case "ch4moveDown":e=this.deviceAdr+":4";break;case "ch5moveDown":e=this.deviceAdr+":5";break;case "ch6moveDown":e=this.deviceAdr+":6"}a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveDown",c);break;case "ch4lamellaUp":case "ch5lamellaUp":case "ch6lamellaUp":switch(g){case "ch4lamellaUp":e=
this.deviceAdr+":4";break;case "ch5lamellaUp":e=this.deviceAdr+":5";break;case "ch6lamellaUp":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(b,g){if(b)c&&c(b);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var h=g.value;h=Math.round(100*h);a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"lamellaUp",function(b,g){b?c&&c(b):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+h,function(b,
e){c&&c(b,e)})})}});break;case "ch4lamellaDown":case "ch5lamellaDown":case "ch6lamellaDown":switch(g){case "ch4lamellaDown":e=this.deviceAdr+":4";break;case "ch5lamellaDown":e=this.deviceAdr+":5";break;case "ch6lamellaDown":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(b,g){if(b)c&&c(b);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var h=g.value;h=Math.round(100*h);a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,
l.deviceIF,e,"lamellaDown",function(b,g){b?c&&c(b):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+h,function(b,e){c&&c(b,e)})})}});break;case "ch4stepUp":case "ch5stepUp":case "ch6stepUp":switch(g){case "ch4stepUp":e=this.deviceAdr+":4";break;case "ch5stepUp":e=this.deviceAdr+":5";break;case "ch6stepUp":e=this.deviceAdr+":6"}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stepUp"+h,c);break;case "ch4stepDown":case "ch5stepDown":case "ch6stepDown":switch(g){case "ch4stepDown":e=
this.deviceAdr+":4";break;case "ch5stepDown":e=this.deviceAdr+":5";break;case "ch6stepDown":e=this.deviceAdr+":6"}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"stepDown"+h,c);break;case "ch4lamellaStepUp":case "ch5lamellaStepUp":case "ch6lamellaStepUp":switch(g){case "ch4lamellaStepUp":e=this.deviceAdr+":4";break;case "ch5lamellaStepUp":e=this.deviceAdr+":5";break;case "ch6lamellaStepUp":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(b,
g){if(b)c&&c(b);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var k=g.value;k=Math.round(100*k);a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"lamellaStepUp"+h,function(b,g){b?c&&c(b):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+k,function(b,e){c&&c(b,e)})})}});break;case "ch4lamellaStepDown":case "ch5lamellaStepDown":case "ch6lamellaStepDown":switch(g){case "ch4lamellaStepDown":e=this.deviceAdr+":4";break;case "ch5lamellaStepDown":e=
this.deviceAdr+":5";break;case "ch6lamellaStepDown":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(b,g){if(b)c&&c(b);else if("undefined"==typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var k=g.value;k=Math.round(100*k);a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"lamellaStepDown"+h,function(b,g){b?c&&c(b):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+k,function(b,e){c&&c(b,e)})})}});break;case "ch4moveTo":case "ch5moveTo":case "ch6moveTo":switch(g){case "ch4moveTo":e=
this.deviceAdr+":4";break;case "ch5moveTo":e=this.deviceAdr+":5";break;case "ch6moveTo":e=this.deviceAdr+":6"}a.SHUTTER_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,e,"moveTo"+h,c);break;case "ch4lamellaTo":case "ch5lamellaTo":case "ch6lamellaTo":switch(g){case "ch4lamellaTo":e=this.deviceAdr+":4";break;case "ch5lamellaTo":e=this.deviceAdr+":5";break;case "ch6lamellaTo":e=this.deviceAdr+":6"}f.getState({interface:this.deviceIF,channel:e,datapoint:"LEVEL"},function(b,g){if(b)c&&c(b);else if("undefined"==
typeof g||null==g)c&&c(Error("get blind current value return invalid"));else{var k=g.value;k=Math.round(100*k);a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"lamellaTo"+h,function(b,g){b?c&&c(b):a.BLIND_VIRTUAL_RECEIVER.executeCommand(f,l.deviceIF,e,"moveTo"+k,function(b,e){c&&c(b,e)})})}});break;default:c&&c(Error("no such command"))}};z.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");
-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b)return a.MAINTENANCE.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(3==f){if(c=a.BLIND_TRANSMITTER.parseDptState(b,c))e={},"LEVEL"==b?e.blindLevel=c.blindTPos:"LEVEL_2"==b&&(e.lamellaLevel=c.lamellaTPos);return e}if(4==f||5==f||6==f){if(c=a.BLIND_VIRTUAL_RECEIVER.parseDptState(b,c))switch(e={},parseInt(f)){case 4:"LEVEL"==b?e.ch4blindLevel=c.blindPos:"LEVEL_2"==
b&&(e.ch4lamellaLevel=c.lamellaPos);break;case 5:"LEVEL"==b?e.ch5blindLevel=c.blindPos:"LEVEL_2"==b&&(e.ch5lamellaLevel=c.lamellaPos);break;case 6:"LEVEL"==b?e.ch6blindLevel=c.blindPos:"LEVEL_2"==b&&(e.ch6lamellaLevel=c.lamellaPos)}return e}return null};z.prototype.getConfig=function(f,b){var c=this.deviceAdr+":3";f.getParamset(this.deviceIF,c,"MASTER",function(e,f){if(e)b&&b(e);else{var a={},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});a[c]=g;b&&b(e,a)}})};z.prototype.setConfig=function(f,b,c){if(b){var e=
this.deviceAdr+":3";if(b=b[e]){var a={};a.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:b.CHANGE_OVER_DELAY};a.REFERENCE_RUN_COUNTER=b.REFERENCE_RUN_COUNTER;a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};a.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_UNIT};a.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:b.REFERENCE_RUNNING_TIME_SLATS_VALUE};f.setParamset(this.deviceIF,e,"MASTER",a,function(b){c&&c(b)})}else c&&c(Error("config data not complete"))}else c&&c(Error("config data invalid"))};z.prototype.isButton=
function(){return!0};z.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){b&&b()})})};z.prototype._claimButtonEvent=function(f,b,c){var e=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(a,g){a&&console.error("button:"+f+" claim PRESS_SHORT event error:"+a.stack);b.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",
function(b,e){b&&console.error("button:"+f+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};var ka=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_presence"};util.inherits(ka,a);ka.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.PRESENCEDETECTOR_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+
":1",dpt:c})});return f};ka.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "sabotage":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "state":case "illumination":case "current_illumination":case "active":c.channel=b+":1";c.dataPoint=e.PRESENCEDETECTOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};ka.prototype.executeCommand=
function(f,b,c){var e=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "reset":case "activate":case "deactivate":case "toggleActivate":e.PRESENCEDETECTOR_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":1",b,c);break;default:c&&c(Error("no such command"))}};ka.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];
if(0==f){if("UNREACH"==b||"LOW_BAT"==b||"SABOTAGE"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==f?e.PRESENCEDETECTOR_TRANSCEIVER.parseDptState(b,c):null};var Da=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_floor_heater"};util.inherits(Da,a);Da.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_TRANSCEIVER.getReadableDpts();c&&c.forEach(function(c){f.push({channel:b.deviceAdr+
":"+b.channel,dpt:c})});return f};Da.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_f_humidityLimiter":case "cl_f_emergencyOP":case "cl_f_frostProtection":case "cl_f_state":case "cl_f_dewPointAlarm":case "cl_f_externalClock":c.channel=b+":"+this.channel;c.dataPoint=e.CLIMATECONTROL_FLOOR_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};Da.prototype.parseDptState=function(f,
b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?e.CLIMATECONTROL_FLOOR_TRANSCEIVER.parseDptState(b,c):null};var Ea=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_floor_pump_heater"};util.inherits(Ea,a);Ea.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getReadableDpts();
c&&c.forEach(function(c){f.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});return f};Ea.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "cl_fp_humidityLimiter":case "cl_fp_emergencyOP":case "cl_fp_frostProtection":case "cl_fp_state":case "cl_fp_dewPointAlarm":case "cl_fp_externalClock":c.channel=b+":"+this.channel;c.dataPoint=e.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};
Ea.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?e.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.parseDptState(b,c):null};var Fa=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_weather"};util.inherits(Fa,a);Fa.prototype._getReadableDpts=function(){var f=
[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_CL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.WEATHER_TRANSMIT.getReadableDpts())&&e.forEach(function(c){-1==c.indexOf("RAIN")&&-1==c.indexOf("WIND_DIR")&&f.push({channel:b.deviceAdr+":1",dpt:c})});return f};Fa.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=
b+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:c.channel=b+":1";f=e.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};Fa.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE_BAT_CL.parseDptState(b,
c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==f?e.WEATHER_TRANSMIT.parseDptState(b,c):null};var Ga=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_weather2"};util.inherits(Ga,a);Ga.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_CL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.WEATHER_TRANSMIT.getReadableDpts())&&e.forEach(function(c){-1==c.indexOf("WIND_DIR")&&f.push({channel:b.deviceAdr+
":1",dpt:c})});return f};Ga.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:c.channel=b+":1";f=e.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};Ga.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+
1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE_BAT_CL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==f?e.WEATHER_TRANSMIT.parseDptState(b,c):null};var Ha=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_weather3"};util.inherits(Ha,a);Ha.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],
e=c.MAINTENANCE_BAT_CL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.CLIMATE_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});return f};Ha.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:c.channel=
b+":1";f=e.CLIMATE_TRANSCEIVER.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};Ha.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE_BAT_CL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==f?e.CLIMATE_TRANSCEIVER.parseDptState(b,
c):null};var Ia=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_weather4"};util.inherits(Ia,a);Ia.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_CL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.WEATHER_TRANSMIT.getReadableDpts())&&e.forEach(function(c){-1==c.indexOf("WIND_DIR")&&f.push({channel:b.deviceAdr+":1",dpt:c})});return f};Ia.prototype._getDptFromRef=function(f){var b=
this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;default:c.channel=b+":1";f=e.WEATHER_TRANSMIT.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};Ia.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return e.MAINTENANCE_BAT_CL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==f?e.WEATHER_TRANSMIT.parseDptState(b,c):null};var la=function(f,b,c){a.call(this,f,b,c);this.channel=2;this.legacyType="ip_direction"};util.inherits(la,a);la.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){f.push({channel:b.deviceAdr+
":0",dpt:c})});(e=c.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":2",dpt:c});f.push({channel:b.deviceAdr+":3",dpt:c})});return f};la.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "ch2State":c.channel=b+":2";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");
break;case "ch3State":c.channel=b+":3";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case "ch4State":c.channel=b+":4";c.dataPoint=e.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;default:c.channel=b+":2";f=e.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getDptFromState(f);if(!f)return null;c.dataPoint=f}return c};la.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");
-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return a.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(2==f){if(b=a.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(b,c))e={},"undefined"!=typeof b.current_direction&&(e.current_passage_r2l=b.current_direction),"undefined"!=typeof b.last_direction&&(e.last_passage_r2l=b.last_direction),"undefined"!=typeof b.passage_counter&&
(e.r2l_passage_counter=b.passage_counter),"undefined"!=typeof b.passage_counter_overflow&&(e.r2l_passage_counter_overflow=b.passage_counter_overflow);return e}if(3==f){if(b=a.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(b,c))e={},"undefined"!=typeof b.current_direction&&(e.current_passage_l2r=b.current_direction),"undefined"!=typeof b.last_direction&&(e.last_passage_l2r=b.last_direction),"undefined"!=typeof b.passage_counter&&(e.l2r_passage_counter=b.passage_counter),"undefined"!=typeof b.passage_counter_overflow&&
(e.l2r_passage_counter_overflow=b.passage_counter_overflow);return e}return null};la.prototype.parseStates=function(f){var b={},c;for(c in f){var e=this.parseChnState(c,f[c]);e&&(b=x.hub.m.hm._Util.mergeObj(b,e))}b.current_passage_r2l&&b.current_passage_l2r&&(b.current_direction=b.current_passage_r2l.value?{value:"right_to_left",time:b.current_passage_r2l.time}:{value:"left_to_right",time:b.current_passage_l2r.time});b.last_passage_r2l&&b.last_passage_l2r&&(b.last_direction=b.last_passage_r2l.value?
{value:"right_to_left",time:b.last_passage_r2l.time}:{value:"left_to_right",time:b.last_passage_l2r.time});delete b.current_passage_r2l;delete b.current_passage_l2r;delete b.last_passage_r2l;delete b.last_passage_l2r;return b};var K=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_button8"};util.inherits(K,a);K.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+
":0",dpt:c})});return f};K.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};K.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,
e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b)return a.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(1==f||2==f||3==f||4==f||5==f||6==f||7==f||8==f)if(b=a.KEY_TRANRECEIVER.parseDptState(b,c))e||(e={}),b.pressShort&&(e["btn"+f+"pressShort"]=!0),b.pressLong&&(e["btn"+f+"pressLong"]=!0);return e};K.prototype.isButton=function(){return!0};K.prototype.claimEvent=function(f,b){var c=this.deviceAdr;-1==c.indexOf(":")&&
this.channel&&(c+=":"+this.channel);var e=this;this._claimButtonEvent(1,f,function(){e._claimButtonEvent(2,f,function(){e._claimButtonEvent(3,f,function(){e._claimButtonEvent(4,f,function(){e._claimButtonEvent(5,f,function(){e._claimButtonEvent(6,f,function(){e._claimButtonEvent(7,f,function(){e._claimButtonEvent(8,f,function(){b&&b()})})})})})})})})};K.prototype._claimButtonEvent=function(f,b,c){var e=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(a,g){a&&console.error("button:"+
f+" claim PRESS_SHORT event error:"+a.stack);b.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(b,e){b&&console.error("button:"+f+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};var Ja=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_generic_input"};util.inherits(Ja,a);Ja.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].GENERIC_INPUT_TRANSMITER.getReadableDpts();c&&c.forEach(function(c){f.push({channel:b.deviceAdr+
":"+b.channel,dpt:c})});return f};Ja.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];c.channel=b+":"+this.channel;f=e.GENERIC_INPUT_TRANSMITER.getDptFromState(f);if(!f)return null;c.dataPoint=f;return c};Ja.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));
if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];return f==this.channel?e.GENERIC_INPUT_TRANSMITER.parseDptState(b,c):null};var ma=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_analog_output"};util.inherits(ma,a);ma.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.getReadableDpts();c&&c.forEach(function(c){f.push({channel:b.deviceAdr+":"+b.channel,dpt:c})});return f};ma.prototype._getDptFromRef=function(f){var b=
this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "outputLevel":c.channel=b+":"+this.channel;c.dataPoint=e.ANALOG_OUTPUT_TRANSCEIVER.getDptFromState("outputLevel");break;default:return null}return c};ma.prototype.executeCommand=function(f,b,c){x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.executeCommand(f,this.deviceIF,this.deviceAdr+":"+this.channel,b,function(b,f){c&&c(b,f)})};ma.prototype.parseDptState=function(f,b,c){var e=
f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];a=null;f==this.channel&&(a=e.ANALOG_OUTPUT_TRANSCEIVER.parseDptState(b,c));return a};var Ka=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_water"};util.inherits(Ka,a);Ka.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_CL.getReadableDpts();
e&&e.forEach(function(c){f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.WATER_DETECTION_TRANSMITTER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",dpt:c})});return f};Ka.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_CL.getDptFromState(f);break;case "alarm":case "moisture":case "water":c.channel=
b+":1";c.dataPoint=e.WATER_DETECTION_TRANSMITTER.getDptFromState(f);break;default:return null}return c};Ka.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b||"LOW_BAT"==b||"ERROR_NON_FLAT_POSITIONING"==b)return e.MAINTENANCE_BAT_CL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=
c;return e}return 1==f?e.WATER_DETECTION_TRANSMITTER.parseDptState(b,c):null};var La=function(f,b,c){a.call(this,f,b,c);this.channel=1;this.legacyType="ip_acce"};util.inherits(La,a);La.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"],e=c.MAINTENANCE_BAT_EL.getReadableDpts();e&&e.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});(e=c.ACCELERATION_TRANSCEIVER.getReadableDpts())&&e.forEach(function(c){f.push({channel:b.deviceAdr+":1",
dpt:c})});return f};La.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "volatage":case "errorCode":case "sensorError":c.channel=b+":0";c.dataPoint=e.MAINTENANCE_BAT_EL.getDptFromState(f);break;case "motion":c.channel=b+":1";c.dataPoint=e.ACCELERATION_TRANSCEIVER.getDptFromState(f);break;default:return null}return c};La.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");
if(-1==e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;e=x.hub.m.hm._Channel["HmIP-RF"];if(0==f){if("UNREACH"==b||"LOW_BAT"==b||"OPERATING_VOLTAGE"==b||"ERROR_CODE"==b||"SENSOR_ERROR"==b)return e.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}return 1==f?e.ACCELERATION_TRANSCEIVER.parseDptState(b,c):null};var C=function(f,b,c){a.call(this,f,b,c);this.channel=
1;this.legacyType="ip_garagedoor"};util.inherits(C,a);C.prototype._getReadableDpts=function(){var f=[],b=this,c=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();c&&c.forEach(function(c){"SABOTAGE"!=c&&f.push({channel:b.deviceAdr+":0",dpt:c})});return f};C.prototype._getDptFromRef=function(f){var b=this.deviceAdr,c={channel:b+":"+this.channel,dataPoint:null},e=x.hub.m.hm._Channel["HmIP-RF"];switch(f){case "timeout":case "lowbat":case "voltage":case "errorCode":c.channel=b+":0";c.dataPoint=
e.MAINTENANCE_BAT_EL.getDptFromState(f);break;default:return null}return c};C.prototype.executeCommand=function(f,b,c){var e=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "on":var a=this.deviceAdr+":3";e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,a,"onFor0.5",c);break;default:"onFor"==b.substr(0,5)?(a=this.deviceAdr+":3",e.SWITCH_VIRTUAL_RECEIVER.executeCommand(f,this.deviceIF,a,b,c)):c&&c(Error("no such command"))}};C.prototype.parseDptState=function(f,b,c){var e=f.indexOf(":");if(-1==
e)return null;var a=f.substr(0,e);f=f.substr(e+1);var g=this.deviceAdr;e=this.deviceAdr.indexOf(":");-1!=e&&(g=this.deviceAdr.substr(0,e));if(a!=g)return null;a=x.hub.m.hm._Channel["HmIP-RF"];e=null;if(0==f){if("UNREACH"==b||"LOW_BAT"==b||"OPERATING_VOLTAGE"==b||"ERROR_CODE"==b)return a.MAINTENANCE_BAT_EL.parseDptState(b,c);e={};e["0_"+b.toLowerCase()]=c;return e}if(1==f){if(b=a.KEY_TRANRECEIVER.parseDptState(b,c))e||(e={}),b.pressShort&&(e.btnPressShort=!0),b.pressLong&&(e.btnPressLong=!0);return e}return null};
C.prototype.isButton=function(){return!0};C.prototype.claimEvent=function(f,b){this._claimButtonEvent(1,f,function(){b&&b()})};C.prototype._claimButtonEvent=function(f,b,c){var e=this;b.reportValueUsage(this.deviceIF,this.deviceAdr+":"+f,"PRESS_SHORT",function(a,g){a&&console.error("button:"+f+" claim PRESS_SHORT event error:"+a.stack);b.reportValueUsage(e.deviceIF,e.deviceAdr+":"+f,"PRESS_LONG",function(b,e){b&&console.error("button:"+f+" claim PRESS_LONG event error:"+b.stack);c&&c()})})};var Sa=
function(){var f=function(b,c,e){a.call(this,b,c,e);this._chMaintenance=0;this._chKeyTransceiver1=1;this._chKeyTransceiver2=2;this._chSwitchTransmitter3=3;this._chSwitchVirtualReceiver4=4;this._chDimmerTransmitter7=7;this._chDimmerVirtualReceiver8=8;this._chDimmerTransmitter11=11;this._chDimmerVirtualReceiver12=12;this._chDimmerWeekProfile=15;this.legacyType="ip_bsl"};util.inherits(f,a);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+
":"+this._chSwitchTransmitter3,dpt:"STATE"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"COLOR"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"COLOR"}]};f.prototype._getDptFromRef=function(b){var c={channel:this.getSerial()+":",dataPoint:null};switch(b){case "timeout":c.channel+=this._chMaintenance;c.dataPoint="UNREACH";break;case "state":c.channel+=
this._chSwitchTransmitter3;c.dataPoint="STATE";break;case "led1Level":c.channel+=this._chDimmerTransmitter7;c.dataPoint="LEVEL";break;case "led1Color":c.channel+=this._chDimmerTransmitter7;c.dataPoint="COLOR";break;case "led2Level":c.channel+=this._chDimmerTransmitter11;c.dataPoint="LEVEL";break;case "led2Color":c.channel+=this._chDimmerTransmitter11;c.dataPoint="COLOR";break;default:return null}return c};f.prototype.executeCommand=function(b,c,e){var f=x.hub.m.hm._Channel["HmIP-RF"],a=this.getSerial();
var g=c;if(-1!=c.indexOf("dimUp")){var h=c.indexOf("dimUp");g=c.substr(0,h+5);h=c.substr(h)}else-1!=c.indexOf("dimDown")?(h=c.indexOf("dimDown"),g=c.substr(0,h+7),h=c.substr(h)):-1!=c.indexOf("dimTo")?(h=c.indexOf("dimTo"),g=c.substr(0,h+5),h=c.substr(h)):-1!=c.indexOf("toggleTo")?(h=c.indexOf("toggleTo"),g=c.substr(0,h+8),h=c.substr(h)):-1!=c.indexOf("colorTo")&&(h=c.indexOf("colorTo"),g=c.substr(0,h+7),h=c.substr(h));switch(g){case "on":case "off":case "toggle":c=a+":"+this._chSwitchVirtualReceiver4;
f.SWITCH_VIRTUAL_RECEIVER.executeCommand(b,this.deviceIF,c,g,e);break;case "led1on":case "led1off":case "led1dimUp":case "led1dimDown":case "led1dimTo":case "led1toggleTo":case "led1colorTo":case "led2on":case "led2off":case "led2dimUp":case "led2dimDown":case "led2dimTo":case "led2toggleTo":case "led2colorTo":c="led1"==g.substr(0,4)?a+":"+this._chDimmerVirtualReceiver12:a+":"+this._chDimmerVirtualReceiver8;"led1on"==g?h="dimTo100":"led1off"==g?h="dimOff":"led2on"==g?h="dimTo100":"led2off"==g&&(h=
"dimOff");f.DIMMER_VIRTUAL_RECEIVER.executeCommand(b,this.deviceIF,c,h,e);break;default:"onFor"==g.substr(0,5)?(c=a+":"+this._chSwitchVirtualReceiver4,f.SWITCH_VIRTUAL_RECEIVER.executeCommand(b,this.deviceIF,c,g,e)):e&&e(Error("no such command"))}};f.prototype.parseDptState=function(b,c,e){var f=b.indexOf(":");if(-1==f)return null;var a=b.substr(0,f);b=b.substr(f+1);f=this.getSerial();if(a!=f)return null;a=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(b)){case this._chMaintenance:switch(c){case "UNREACH":return a.MAINTENANCE.parseDptState(c,
e);default:var g={};g["0_"+c.toLowerCase()]=e;return g}case this._chKeyTransceiver1:case this._chKeyTransceiver2:if(e=a.KEY_TRANRECEIVER.parseDptState(c,e))g||(g={}),e.pressShort&&(g["btn"+b+"pressShort"]=!0),e.pressLong&&(g["btn"+b+"pressLong"]=!0);return g;case this._chSwitchTransmitter3:switch(c){case "STATE":if(e=a.SWITCH_TRANSMITTER.parseDptState(c,e))g={},g.state=e.switchTState;return g;default:return null}case this._chDimmerTransmitter7:if(e=a.DIMMER_TRANSMITTER.parseDptState(c,e))g={},"LEVEL"==
c?g.led2Level=e.dimmerTLevel:"COLOR"==c&&(g.led2Color=e.dimmerTColor);return g;case this._chDimmerTransmitter11:if(e=a.DIMMER_TRANSMITTER.parseDptState(c,e))g={},"LEVEL"==c?g.led1Level=e.dimmerTLevel:"COLOR"==c&&(g.led1Color=e.dimmerTColor);return g;default:return null}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(b,c){var e=this.getSerial(),f=this;b.reportValueUsage(this.deviceIF,e+":"+this._chKeyTransceiver1,"PRESS_SHORT",function(a,g){a&&console.error("button:1 claim PRESS_SHORT event error:"+
a.stack);b.reportValueUsage(f.deviceIF,e+":"+f._chKeyTransceiver1,"PRESS_LONG",function(a,g){a&&console.error("button:1 claim PRESS_LONG event error:"+a.stack);b.reportValueUsage(f.deviceIF,e+":"+f._chKeyTransceiver2,"PRESS_SHORT",function(a,g){a&&console.error("button:2 claim PRESS_SHORT event error:"+a.stack);b.reportValueUsage(f.deviceIF,e+":"+f._chKeyTransceiver2,"PRESS_LONG",function(b,e){b&&console.error("button:2 claim PRESS_LONG event error:"+b.stack);c&&c()})})})})};return f}(),Ta=function(){var f=
function(b,c,e){a.call(this,b,c,e);this._chMaintenance=0;this._chDoorReceiver=1;this._chSimpleSwitchReceiver=2;this.legacyType="ip_tormatic"};util.inherits(f,a);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this._chDoorReceiver,dpt:"DOOR_STATE"},{channel:this.deviceAdr+":"+this._chSimpleSwitchReceiver,dpt:"STATE"}]};f.prototype._getDptFromRef=function(b){var c={channel:this.getSerial()+":",dataPoint:null};
switch(b){case "timeout":c.channel+=this._chMaintenance;c.dataPoint="UNREACH";break;case "doorState":c.channel+=this._chDoorReceiver;c.dataPoint="DOOR_STATE";break;case "lightState":c.channel+=this._chSimpleSwitchReceiver;c.dataPoint="STATE";break;default:return null}return c};f.prototype.executeCommand=function(b,c,e){var f=x.hub.m.hm._Channel["HmIP-RF"],a=this.getSerial();switch(c){case "open":case "close":case "partialOpen":case "stop":a=a+":"+this._chDoorReceiver;f.DOOR_RECEIVER.executeCommand(b,
this.deviceIF,a,c,e);break;case "lightOn":case "lightOff":case "lightToggle":c=c.substr(5).toLowerCase();a=a+":"+this._chSimpleSwitchReceiver;f.SIMPLE_SWITCH_RECEIVER.executeCommand(b,this.deviceIF,a,c,e);break;default:e&&e(Error("no such command"))}};f.prototype.parseDptState=function(b,c,e){var f=b.indexOf(":");if(-1==f)return null;var a=b.substr(0,f);b=b.substr(f+1);f=this.getSerial();if(a!=f)return null;a=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(b)){case this._chMaintenance:switch(c){case "UNREACH":return a.MAINTENANCE.parseDptState(c,
e);default:var g={};g["0_"+c.toLowerCase()]=e;return g}case this._chDoorReceiver:return(c=a.DOOR_RECEIVER.parseDptState(c,e))&&(g=c),g;case this._chSimpleSwitchReceiver:if(c=a.SIMPLE_SWITCH_RECEIVER.parseDptState(c,e))g={},g.lightState=c.state;return g;default:return null}};return f}(),Ua=function(){var f=function(b,c,e){a.call(this,b,c,e);this._chMaintenance=0;this._chBrightness=1;this.legacyType="ip_lux"};util.inherits(f,a);f.prototype._getReadableDpts=function(){var b=[],c=this,e=x.hub.m.hm._Channel["HmIP-RF"],
f=e.MAINTENANCE_BAT_EL.getReadableDpts();f&&f.forEach(function(e){"SABOTAGE"!=e&&"ERROR_CODE"!=e&&"SENSOR_ERROR"!=e&&b.push({channel:c.deviceAdr+":0",dpt:e})});(f=e.BRIGHTNESS_TRANSMITTER.getReadableDpts())&&f.forEach(function(e){b.push({channel:c.deviceAdr+":1",dpt:e})});return b};f.prototype._getDptFromRef=function(b){var c=this.deviceAdr,e={channel:c+":"+this.channel,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "timeout":case "lowbat":case "volatage":e.channel=c+":0";e.dataPoint=
f.MAINTENANCE_BAT_EL.getDptFromState(b);break;case "illu":case "avgIllu":case "maxIllu":case "minIllu":e.channel=c+":1";e.dataPoint=f.BRIGHTNESS_TRANSMITTER.getDptFromState(b);break;default:return null}return e};f.prototype.parseDptState=function(b,c,e){var f=b.indexOf(":");if(-1==f)return null;var a=b.substr(0,f);b=b.substr(f+1);var g=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(g=this.deviceAdr.substr(0,f));if(a!=g)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(0==b){if("UNREACH"==c||"LOW_BAT"==
c||"OPERATING_VOLTAGE"==c)return f.MAINTENANCE_BAT_EL.parseDptState(c,e);f={};f["0_"+c.toLowerCase()]=e;return f}return 1==b?f.BRIGHTNESS_TRANSMITTER.parseDptState(c,e):null};return f}(),Va=function(){var f=function(b,c,e){a.call(this,b,c,e);this._chMaintenance=0;this._chPowerMainsTransmitter=1;this.legacyType="ip_pmfs"};util.inherits(f,a);f.prototype._getReadableDpts=function(){var b=this.getSerial(),c=[],e=this,f=x.hub.m.hm._Channel["HmIP-RF"],a=f.MAINTENANCE.getReadableDpts();a&&a.forEach(function(f){"UNREACH"==
f&&c.push({channel:b+":"+e._chMaintenance,dpt:f})});(a=f.POWER_MAINS_TRANSMITTER.getReadableDpts())&&a.forEach(function(f){c.push({channel:b+":"+e._chPowerMainsTransmitter,dpt:f})});return c};f.prototype._getDptFromRef=function(b){var c=this.getSerial(),e={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "timeout":e.channel=c+":"+this._chMaintenance;e.dataPoint=f.MAINTENANCE.getDptFromState(b);break;case "powerMainsFailure":e.channel=c+":"+this._chPowerMainsTransmitter;
e.dataPoint=f.POWER_MAINS_TRANSMITTER.getDptFromState(b);break;default:return null}return e};f.prototype.parseDptState=function(b,c,e){var f=b.indexOf(":");if(-1==f)return null;var a=b.substr(0,f);b=b.substr(f+1);var g=this.deviceAdr;f=this.deviceAdr.indexOf(":");-1!=f&&(g=this.deviceAdr.substr(0,f));if(a!=g)return null;f=x.hub.m.hm._Channel["HmIP-RF"];if(b==this._chMaintenance){if("UNREACH"==c)return f.MAINTENANCE.parseDptState(c,e);f={};f["0_"+c.toLowerCase()]=e;return f}return b==this._chPowerMainsTransmitter?
f.POWER_MAINS_TRANSMITTER.parseDptState(c,e):null};return f}(),Pa=function(){var f=function(b,c,e){a.call(this,b,c,e);this._chKeyTransceivers=[1];this._chMaintenance=0;this._chMaintenanceDpts=["UNREACH","LOW_BAT"];this.legacyType=1==this._chKeyTransceivers.length?"ip_button":"ip_button"+this._chKeyTransceivers};util.inherits(f,a);f.prototype._getReadableDpts=function(){var b=[],c=this,e=this.getSerial(),f=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getReadableDpts();f&&f.forEach(function(f){-1!=
c._chMaintenanceDpts.indexOf(f)&&b.push({channel:e+":"+c._chMaintenance,dpt:f})});return b};f.prototype._getDptFromRef=function(b){return(b=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getDptFromState(b))?{channel:this.getSerial()+":"+this._chMaintenance,dataPoint:b}:null};f.prototype.parseDptState=function(b,c,e){var f=b.indexOf(":");if(-1==f)return null;var a=x.hub.m.hm._Channel["HmIP-RF"],g=b.substr(0,f);b=b.substr(f+1);f=this.getSerial();if(g!=f)return null;if(parseInt(b)==this._chMaintenance){if(-1!=
this._chMaintenanceDpts.indexOf(c))return a.T_MAINTENANCE.parseDptState(c,e);var h={};h["0_"+c.toLowerCase()]=e;return h}if(-1!=this._chKeyTransceivers.indexOf(parseInt(b))){if(tmp=a.KEY_TRANRECEIVER.parseDptState(c,e))h={},1==this._chKeyTransceivers.length?h=tmp:(tmp.pressShort&&(h["btn"+b+"pressShort"]=!0),tmp.pressLong&&(h["btn"+b+"pressLong"]=!0));return h}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(b,c){var e=0,f=this,a=function(){e++;e<f._chKeyTransceivers.length?
f._claimButtonEvent(f._chKeyTransceivers[e],b,a):c&&c()};this._claimButtonEvent(this._chKeyTransceivers[e],b,a)};f.prototype._claimButtonEvent=function(b,c,e){var f=this;c.reportValueUsage(this.deviceIF,this.deviceAdr+":"+b,"PRESS_SHORT",function(a,g){a&&console.error("button:"+b+" claim PRESS_SHORT event error:"+a.stack);c.reportValueUsage(f.deviceIF,f.deviceAdr+":"+b,"PRESS_LONG",function(c,f){c&&console.error("button:"+b+" claim PRESS_LONG event error:"+c.stack);e&&e()})})};f.parse=function(b){var c=
null,e=b.address,a=b.address.indexOf(":");-1!=a&&(c=b.address.substr(a+1),e=b.address.substr(0,a));a=null;switch(b.type){case "HmIP-MOD-OC8":a=new f(b.type,b.interface,e),a._chMaintenance=0,a._chMaintenanceDpts=["UNREACH","OPERATING_VOLTAGE"],a._chKeyTransceivers=[parseInt(c)]}return a};f.resolve=function(b,c){return"HmIP-MOD-OC8"==b?this._resolveIPMultiButton(b,c,1,8,["UNREACH","OPERATING_VOLTAGE"]):"HmIP-RCV-50"==b.substr(0,11)?this._resolveIPMultiButton(b,c,1,50,null):null};f._resolveIPMultiButton=
function(b,c,e,a,g){var h,k=[];for(h=0;h<a;h++){var l=new f(b,c.interface,c.address+":"+(h+e));l._chMaintenance=0;g&&(l._chMaintenanceDpts=g);l._chKeyTransceivers=[h+e];k.push(l)}return k};return f}(),P=function(){var f=function(b,c,e){a.call(this,b,c,e);this.channel=1;this._chMaintenance=0;this._chSwitchVirtualReceiver1=2;this._chSwitchVirtualReceiver2=3;this._chSwitchVirtualReceiver3=4;this._chSwitchWeekProfile=5;this.legacyType="ip_switch"};util.inherits(f,a);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+
":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(b){var c={channel:this.getSerial()+":",dataPoint:null};switch(b){case "timeout":c.channel+=this._chMaintenance;c.dataPoint="UNREACH";break;case "state":c.channel+=this.channel;c.dataPoint="STATE";break;default:return null}return c};f.prototype.executeCommand=function(b,c,e){var f=this.getSerial(),a=this;switch(c){case "on":var g="STATE";var h=f+":"+this._chSwitchVirtualReceiver1;
b.writeValue(this.deviceIF,h,g,!0,e);break;case "off":g="STATE";h=f+":"+this._chSwitchVirtualReceiver1;b.writeValue(this.deviceIF,h,g,!1,e);break;case "toggle":g="STATE";h=f+":"+this.channel;b.getState({interface:this.deviceIF,channel:h,datapoint:g},function(c,k){c?e&&e(c):k?(c=!0,k.value&&(c=!1),g="STATE",h=f+":"+a._chSwitchVirtualReceiver1,b.writeValue(a.deviceIF,h,g,c,e)):e&&e(Error("get switch current value return invalid"))});break;default:"onFor"==c.substr(0,5)?(c=parseFloat(c.substr(5)),isNaN(c)?
e&&e(Error("onFor command invalid")):(g="ON_TIME",h=f+":"+a._chSwitchVirtualReceiver1,b.writeValue(this.deviceIF,h,g,{type:"double",value:c},function(c){c?e&&e(c):(g="STATE",h=f+":"+a._chSwitchVirtualReceiver1,b.writeValue(a.deviceIF,h,g,!0,e))}))):e&&e(Error("no such command"))}};f.prototype.parseDptState=function(b,c,e){var f=b.indexOf(":");if(-1==f)return null;var a=b.substr(0,f);b=b.substr(f+1);f=this.getSerial();if(a!=f)return null;switch(parseInt(b)){case this._chMaintenance:switch(c){case "UNREACH":return{timeout:e};
default:return a={},a["0_"+c.toLowerCase()]=e,a}case this.channel:switch(c){case "STATE":return{state:1==e?"on":"off"};default:return null}default:return null}};f.parse=function(b){var c=null,e=b.address.indexOf(":");-1!=e&&(c=b.address.substr(e+1));e=null;switch(b.type){case "HmIP-MOD-OC8":e=this._parseTSwitch(b,c,41)}return e};f._parseTSwitch=function(b,c,e){b=new f(b.type,b.interface,b.address);b._chMaintenance=0;b.channel=parseInt(c);b._chSwitchVirtualReceiver1=b.channel+1;b._chSwitchVirtualReceiver2=
b.channel+2;b._chSwitchVirtualReceiver3=b.channel+3;b._chSwitchWeekProfile=e;return b};f.resolve=function(b,c){var e=[];if("HmIP-MOD-OC8"==b)for(i=0;8>i;i++)d=new f(b,c.interface,c.address+":"+(4*i+9)),d._chMaintenance=0,d.channel=4*i+9,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=41,e.push(d);return e};return f}(),Qa=function(){var f=function(b,c,e){a.call(this,b,c,e);this.channel=1;this._chMaintenance=
0;this._chDimmerVirtualReceiver1=2;this._chDimmerVirtualReceiver2=3;this._chDimmerVirtualReceiver3=4;this._chDimmerWeekProfile=13;this.legacyType="ip_dimmer"};util.inherits(f,a);f.prototype._getReadableDpts=function(){var b=[],c=this,e=x.hub.m.hm._Channel["HmIP-RF"],f=e.MAINTENANCE.getReadableDpts();f&&f.forEach(function(e){"UNREACH"==e&&b.push({channel:c.deviceAdr+":"+c._chMaintenance,dpt:e})});(f=e.DIMMER_TRANSMITTER.getReadableDpts())&&f.forEach(function(e){b.push({channel:c.deviceAdr+":"+c.channel,
dpt:e})});(f=e.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(e){b.push({channel:c.deviceAdr+":"+c._chDimmerVirtualReceiver1,dpt:e});b.push({channel:c.deviceAdr+":"+c._chDimmerVirtualReceiver2,dpt:e});b.push({channel:c.deviceAdr+":"+c._chDimmerVirtualReceiver3,dpt:e})});return b};f.prototype._getDptFromRef=function(b){var c=this.getSerail(),e={channel:null,dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "timeout":e.channel=c+":"+this._chMaintenance;e.dataPoint=f.MAINTENANCE.getDptFromState(b);
break;case "dimmerLevel":e.channel=c+":"+this.channel;e.dataPoint=f.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;default:return null}return e};f.prototype.executeCommand=function(b,c,e){var f=x.hub.m.hm._Channel["HmIP-RF"],a=c;if(-1!=c.indexOf("dimUp")){var g=c.indexOf("dimUp");a=c.substr(0,g+5);var h=c.substr(g+5)}else-1!=c.indexOf("dimDown")?(g=c.indexOf("dimDown"),a=c.substr(0,g+7),h=c.substr(g+7)):-1!=c.indexOf("dimTo")?(g=c.indexOf("dimTo"),a=c.substr(0,g+5),h=c.substr(g+5)):-1!=
c.indexOf("toggleTo")&&(g=c.indexOf("toggleTo"),a=c.substr(0,g+8),h=c.substr(g+8));var k=this.getSerial(),l=this;switch(a){case "dimOff":f.DIMMER_VIRTUAL_RECEIVER.executeCommand(b,this.deviceIF,k+":"+this._chDimmerVirtualReceiver1,"dimOff",e);break;case "dimUp":h=h?parseInt(h)/100:.1;b.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,a){c?e&&e(c):"undefined"==typeof a||null==a?e&&e(Error("get dimmer current value return invalid")):(h=a.value+h,1<h&&(h=1),
h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(b,l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,e))});break;case "dimDown":h=h?parseInt(h)/100:.1;b.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,a){c?e&&e(c):"undefined"==typeof a||null==a?e&&e(Error("get dimmer current value return invalid")):(h=a.value-h,0>h&&(h=0),h=Math.round(100*h),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(b,l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,
e))});break;case "dimTo":if(!h){e&&e(Error("dimTo has no value"));break}f.DIMMER_VIRTUAL_RECEIVER.executeCommand(b,this.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,channel);break;case "toggleTo":if(!h){e&&e(Error("toggle has no value"));break}b.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,a){c?e&&e(c):"undefined"==typeof a||null==a?e&&e(Error("get dimmer current value return invalid")):(a.value&&(h=0),f.DIMMER_VIRTUAL_RECEIVER.executeCommand(b,
l.deviceIF,k+":"+l._chDimmerVirtualReceiver1,"dimTo"+h,e))});break;default:e&&e(Error("no such command"))}};f.prototype.parseDptState=function(b,c,e){var f=b.indexOf(":");if(-1==f)return null;var a=b.substr(0,f);b=b.substr(f+1);f=this.getSerial();if(a!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];a=null;switch(parseInt(b)){case this._chMaintenance:switch(c){case "UNREACH":return f.MAINTENANCE.parseDptState(c,e);default:return a={},a["0_"+c.toLowerCase()]=e,a}case this.channel:if(c=f.DIMMER_TRANSMITTER.parseDptState(c,
e))a={},a.dimmerLevel=c.dimmerTLevel;return a}return null};return f}(),Ra=function(){var f=function(b,c,e){a.call(this,b,c,e);this.channel=1;this._chMaintenance=0;this._chBlindVirtualReceiver1=2;this._chBlindVirtualReceiver2=3;this._chBlindVirtualReceiver3=4;this._chBlindWeekProfile=5;this.legacyType="ip_jalousie"};util.inherits(f,a);f.prototype._getReadableDpts=function(){var b=[],c=this,e=x.hub.m.hm._Channel["HmIP-RF"],f=e.MAINTENANCE.getReadableDpts();f&&f.forEach(function(e){"UNREACH"==e&&b.push({channel:c.deviceAdr+
":"+c._chMaintenance,dpt:e})});(f=e.BLIND_TRANSMITTER.getReadableDpts())&&f.forEach(function(e){b.push({channel:c.deviceAdr+":"+c.channel,dpt:e})});(f=e.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&f.forEach(function(e){b.push({channel:c.deviceAdr+":"+c._chBlindVirtualReceiver1,dpt:e});b.push({channel:c.deviceAdr+":"+c._chBlindVirtualReceiver2,dpt:e});b.push({channel:c.deviceAdr+":"+c._chBlindVirtualReceiver3,dpt:e})});return b};f.prototype._getDptFromRef=function(b){var c=this.getSerial(),e={channel:null,
dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "timeout":e.channel=c+":"+this._chMaintenance;e.dataPoint=f.MAINTENANCE.getDptFromState(b);break;case "blindLevel":e.channel=c+":"+this.channel;e.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case "lamellaLevel":e.channel=c+":"+this.channel;e.dataPoint=f.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;default:return null}return e};f.prototype.executeCommand=function(b,c,e){var f=x.hub.m.hm._Channel["HmIP-RF"],
a=c;if(-1!=c.indexOf("stepUp")){var g=c.indexOf("stepUp");a=c.substr(0,g+6);var h=c.substr(g+6)}else-1!=c.indexOf("stepDown")?(g=c.indexOf("stepDown"),a=c.substr(0,g+8),h=c.substr(g+8)):-1!=c.indexOf("moveTo")?(g=c.indexOf("moveTo"),a=c.substr(0,g+6),h=c.substr(g+6)):-1!=c.indexOf("stop")?(g=c.indexOf("stop"),a=c.substr(0,g+4),h=c.substr(g+4)):-1!=c.indexOf("lamellaStepUp")?(g=c.indexOf("lamellaStepUp"),a=c.substr(0,g+13),h=c.substr(g+13)):-1!=c.indexOf("lamellaStepDown")?(g=c.indexOf("lamellaStepDown"),
a=c.substr(0,g+15),h=c.substr(g+15)):-1!=c.indexOf("lamellaTo")&&(g=c.indexOf("lamellaTo"),a=c.substr(0,g+9),h=c.substr(g+9));var k=this.getSerial(),l=this;switch(a){case "stop":case "moveUp":case "moveDown":f.BLIND_VIRTUAL_RECEIVER.executeCommand(b,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,a,e);break;case "lamellaUp":case "lamellaDown":b.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,g){c?e&&e(c):"undefined"==typeof g||null==g?e&&e(Error("get blind current value return invalid")):
f.BLIND_VIRTUAL_RECEIVER.executeCommand(b,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,"lamellaTo"+(a=100),function(c){c?e&&e(c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(b,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+Math.round(100*g.value),e)})});break;case "stepUp":case "stepDown":h=h?parseInt(h)/100:.05;b.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,g){c?e&&e(c):"undefined"==typeof g||null==g?e&&e(Error("get blind current value return invalid")):
(h="stepUp"==a?g.value+h:g.value-h,1<h&&(h=1),0>h&&(h=0),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(b,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+h,e))});break;case "moveTo":if(!h){e&&e(Error("moveTo has no value"));break}f.BLIND_VIRTUAL_RECEIVER.executeCommand(b,this.deviceIF,k+":"+this._chBlindVirtualReceiver1,"moveTo"+h,e);break;case "lamellaStepUp":case "lamellaStepDown":h=h?parseInt(h)/100:.05;b.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},
function(c,g){if(c)e&&e(c);else if("undefined"==typeof g||null==g)e&&e(Error("get blind current value return invalid"));else{var m=g.value;m=Math.round(100*m);b.getState({interface:l.deviceIF,channel:k+":"+l.channel,datapoint:"LEVEL_2"},function(c,g){c?e&&e(c):"undefined"==typeof g||null==g?e&&e(Error("get lamella current value return invalid")):(h="lamellaStepUp"==a?g.value+h:g.value-h,1<h&&(h=1),0>h&&(h=0),h=Math.round(100*h),f.BLIND_VIRTUAL_RECEIVER.executeCommand(b,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,
"lamellaTo"+h,function(c,a){c?e&&e(c,a):f.BLIND_VIRTUAL_RECEIVER.executeCommand(b,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+m,e)}))})}});break;case "lamellaTo":if(!h){e&&e(Error("lamellaTo has no value"));break}b.getState({interface:this.deviceIF,channel:k+":"+this.channel,datapoint:"LEVEL"},function(c,a){if(c)e&&e(c);else if("undefined"==typeof a||null==a)e&&e(Error("get blind current value return invalid"));else{var g=a.value;g=Math.round(100*g);f.BLIND_VIRTUAL_RECEIVER.executeCommand(b,
l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"lamellaTo"+h,function(c){c?e&&e(c):f.BLIND_VIRTUAL_RECEIVER.executeCommand(b,l.deviceIF,k+":"+l._chBlindVirtualReceiver1,"moveTo"+g,e)})}});break;default:e&&e(Error("no such command"))}};f.prototype.parseDptState=function(b,c,e){var f=b.indexOf(":");if(-1==f)return null;var a=b.substr(0,f);b=b.substr(f+1);f=this.getSerial();if(a!=f)return null;f=x.hub.m.hm._Channel["HmIP-RF"];a=null;switch(parseInt(b)){case this._chMaintenance:switch(c){case "UNREACH":return f.MAINTENANCE.parseDptState(c,
e);default:return a={},a["0_"+c.toLowerCase()]=e,a}case this.channel:if(e=f.BLIND_TRANSMITTER.parseDptState(c,e))a={},"LEVEL"==c?a.blindLevel=e.blindTPos:"LEVEL_2"==c&&(a.lamellaLevel=e.lamellaTPos);return a}return null};f.prototype.getConfig=function(b,c){var e=this.getSerial()+":"+this.channel;b.getParamset(this.deviceIF,e,"MASTER",function(b,f){if(b)c&&c(b);else{var a={},g=null;f&&(g={CHANGE_OVER_DELAY:f.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,
REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:f.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:f.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:f.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:f.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:f.REFERENCE_RUN_COUNTER});a[e]=g;c&&c(b,a)}})};f.prototype.setConfig=function(b,c,e){if(c){var f=
this.getSerial()+":"+this.channel;if(c=c[f]){var a={};a.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:c.CHANGE_OVER_DELAY};a.REFERENCE_RUN_COUNTER=c.REFERENCE_RUN_COUNTER;a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT};a.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE};a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT};
a.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE};a.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_SLATS_UNIT};a.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:c.REFERENCE_RUNNING_TIME_SLATS_VALUE};b.setParamset(this.deviceIF,f,"MASTER",a,function(b){e&&e(b)})}else e&&e(Error("config data not complete"))}else e&&e(Error("config data invalid"))};return f}(),
Q=function(){var f=function(b,e,f){a.call(this,b,e,f);this.channel=1;this._chMaintenance=0;this.legacyType="ip_multi_input"};util.inherits(f,a);f.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}]};f.prototype._getDptFromRef=function(b){var c={channel:this.getSerial()+":",dataPoint:null};switch(b){case "timeout":c.channel+=this._chMaintenance;c.dataPoint="UNREACH";break;case "state":c.channel+=
this.channel;c.dataPoint="STATE";break;default:return null}return c};f.prototype.parseDptState=function(b,e,f){var c=b.indexOf(":");if(-1==c)return null;var a=b.substr(0,c);b=b.substr(c+1);c=this.getSerial();if(a!=c)return null;a=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(b)){case this._chMaintenance:switch(e){case "UNREACH":return{timeout:f};default:return a={},a["0_"+e.toLowerCase()]=f,a}case this.channel:switch(e){case "STATE":return{state:1==f?"on":"off"};case "PRESS_SHORT":case "PRESS_LONG":return a.KEY_TRANRECEIVER.parseDptState(e,
f);default:return null}default:return null}};f.prototype.isButton=function(){return!0};f.prototype.claimEvent=function(b,e){this._claimButtonEvent(this.channel,b,function(){e&&e()})};f.prototype._claimButtonEvent=function(b,e,f){var c=this.getSerial()+":"+b,a=this;e.reportValueUsage(this.deviceIF,c,"PRESS_SHORT",function(g,h){g&&console.error("button:"+b+" claim PRESS_SHORT event error:"+g.stack);e.reportValueUsage(a.deviceIF,c,"PRESS_LONG",function(c,e){c&&console.error("button:"+b+" claim PRESS_LONG event error:"+
c.stack);f&&f()})})};var b=function(b,e,a){f.call(this,b,e,a);this.legacyType="ip_multi_input_bat"};util.inherits(b,f);b.prototype._getReadableDpts=function(){for(var b=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts,e=x.hub.m.hm._Channel["HmIP-RF"].MULTI_MODE_INPUT_TRANSMITTER.getReadableDpts,f=[],a=0;a<b.length;a++)f.push({channel:this.deviceAdr+":"+this._chMaintenance,dpt:b[a]});for(a=0;a<e.length;a++)f.push({channel:this.deviceAdr+":"+this.channel,dpt:e[a]});return f};b.prototype._getDptFromRef=
function(b){var c={channel:this.getSerial()+":",dataPoint:null},f=x.hub.m.hm._Channel["HmIP-RF"];switch(b){case "timeout":case "lowbat":case "voltage":case "errorCode":c.channel+=this._chMaintenance;c.dataPoint=f.MAINTENANCE_BAT_EL.getDptFromState(b);break;case "state":c.channel+=this.channel;c.dataPoint=f.MULTI_MODE_INPUT_TRANSMITTER.getDptFromState(b);break;default:return null}return c};b.prototype.parseDptState=function(b,e,f){var c=b.indexOf(":");if(-1==c)return null;var a=b.substr(0,c);b=b.substr(c+
1);c=this.getSerial();if(a!=c)return null;a=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(b)){case this._chMaintenance:switch(e){case "UNREACH":case "LOW_BAT":case "OPERATING_VOLTAGE":case "ERROR_CODE":return a.MAINTENANCE_BAT_EL.parseDptState(e,f);default:return a={},a["0_"+e.toLowerCase()]=f,a}case this.channel:switch(e){case "STATE":case "PRESS_SHORT":case "PRESS_LONG":return a.MULTI_MODE_INPUT_TRANSMITTER.parseDptState(e,f);default:return null}default:return null}};f.resolve=function(c,e){if("HmIP-FCI"==
c.substr(0,8)){var a=parseInt(c.substr(8));var g=b}else"HmIP-MOD-RC"==c.substr(0,11)?(a=parseInt(c.substr(11)),g=b):"HmIPW-DRI"==c.substr(0,9)&&(a=parseInt(c.substr(9)),g=f);return this._resolveIPMultiInput(c,e,a,g)};f._resolveIPMultiInput=function(b,e,f,a){var c,g=[];for(c=0;c<f;c++){var h=new a(b,e.interface,e.address+":"+(c+1));h._chMaintenance=0;h.channel=c+1;g.push(h)}return g};f.parse=function(c){var e=null,f=c.address,a=c.address.indexOf(":");-1!=a&&(e=c.address.substr(a+1),f=c.address.substr(0,
a));a=Q;if("HmIP-FCI1"==c.type||"HmIP-FCI6"==c.type||"HmIP-MOD-RC8"==c.type)a=b;c=new a(c.type,c.interface,f);c._chMaintenance=0;c.channel=parseInt(e);return c};return f}(),u={};u.CLASS_MAP={maintenance:h,button:m,vbutton:g,switch:k,dimmer:l,blind:q,powerswitch:n,weather:r,heater:w,heater2:v,heater3:na,wallthermo:R,wallthermo2:S,contact:oa,weatherstation:t,rain:T,gong2:D,gong:Ma,window:pa,temp:qa,co2:sa,motion:ta,smoke:ua,siren:U,capacity:va,switch_interface:L,tilt:wa,temp2:ra,water:xa,weather2:p,
energymeter:ya,rgb:M,lux:za,siren2:V,jalousie:W,mod_em_8bit:E,mod_em_8:F,keymatic:X,ou_led16:G,hm_dis_ep_wm55:Na,dualwhite:Y};u.CLASS_MAP_IP={ip_switch:Oa,ip_contact:Aa,ip_heater:Z,ip_powerswitch:aa,ip_energyactor:ba,ip_dimmer:da,ip_motion:ha,ip_motion2:H,ip_button2:O,ip_siren:ia,ip_wallthermo:B,ip_smoke:ja,ip_window:Ca,ip_button4:I,ip_dimmer2:ea,ip_energyactor2:ca,ip_blind:y,ip_jalousie:z,ip_presence:ka,ip_dimmer3:fa,ip_wallthermo2:Ba,ip_floor_heater:Da,ip_floor_pump_heater:Ea,ip_button6:J,ip_weather:Fa,
ip_weather2:Ga,ip_weather3:Ha,ip_weather4:Ia,ip_direction:la,ip_button8:K,ip_generic_input:Ja,ip_analog_output:ma,ip_water:Ka,ip_acce:La,ip_garagedoor:C,ip_bsl:Sa,ip_tormatic:Ta,ip_button:N,ip_lux:Ua,ip_pmfs:Va};u.parseJson=function(f){if(!(f&&f.type&&f.interface&&f.address))return null;switch(f.interface){case "BidCos-RF":f=this._parseRFDeviceJson(f);break;case "HmIP-RF":f=this._parseIPDeviceJson(f);break;default:return null}return f};u._parseRFDeviceJson=function(f){var b=x.hub.m.hm.RFDeviceTypes[f.type];
if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.RFDeviceCatagory[b];if(!b||!b.type)return null;var c=this.CLASS_MAP[b.type];if(!c)return null;b=null;var e=f.address.indexOf(":");-1!=e&&(b=f.address.substr(e+1));"HM-Dis-EP-WM55"==f.type&&3==b&&(c=this.CLASS_MAP.hm_dis_ep_wm55);f=new c(f.type,f.interface,f.address);b&&(f.channel=parseInt(b));return f};u._parseIPDeviceJson=function(f){if("HmIPW"==f.type.substr(0,5))return this._parseIPW(f);if("HmIP-MIOB"==f.type)return u._parse_HMIP_MIOB(f);
if("HmIP-FCI1"==f.type||"HmIP-FCI6"==f.type||"HmIP-MOD-RC8"==f.type)return Q.parse(f);var b=null,c=f.address.indexOf(":");-1!=c&&(b=f.address.substr(c+1));switch(f.type){case "HmIP-WHS2":return this._parseTSwitch(f,b,9);case "HmIP-MOD-OC8":return 8>=parseInt(b)?Pa.parse(f):P.parse(f)}b=u._getIPMetaIndex(f.type);if("undefined"==typeof b||null==b)return null;b=x.hub.m.hm.IPDeviceCatagory[b];if(!b||!b.type)return null;var e=this.CLASS_MAP_IP[b.type];if(!e)return null;b=null;c=f.address.indexOf(":");
-1!=c&&(b=f.address.substr(c+1));f=new e(f.type,f.interface,f.address);b&&(f.channel=parseInt(b));return f};u._parseIPW=function(f){var b=null;var c=f.address.indexOf(":");-1!=c&&(b=f.address.substr(c+1));return"HmIPW-DRS"==f.type.substr(0,9)?(c=parseInt(f.type.substr(9)),f=new P(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(b),f._chSwitchVirtualReceiver1=f.channel+1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=4*c+1,
f):"HmIPW-DRD"==f.type.substr(0,9)?(c=parseInt(f.type.substr(9)),f=new Qa(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(b),f._chDimmerVirtualReceiver1=f.channel+1,f._chDimmerVirtualReceiver2=f.channel+2,f._chDimmerVirtualReceiver3=f.channel+3,f._chDimmerWeekProfile=4*c+1,f):"HmIPW-DRBL"==f.type.substr(0,10)?(c=parseInt(f.type.substr(10)),f=new Ra(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(b),f._chBlindVirtualReceiver1=f.channel+1,f._chBlindVirtualReceiver2=
f.channel+2,f._chBlindVirtualReceiver3=f.channel+3,f._chBlindWeekProfile=4*c+1,f):"HmIPW-DRI"==f.type.substr(0,9)?(parseInt(f.type.substr(9)),f=new Q(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(b),f):"HmIPW-FIO"==f.type.substr(0,9)?(c=parseInt(f.type.substr(9)),b=parseInt(b),b<=c?(f=new Q(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(b)):(f=new P(f.type,f.interface,f.address),f._chMaintenance=0,f.channel=parseInt(b),f._chSwitchVirtualReceiver1=f.channel+
1,f._chSwitchVirtualReceiver2=f.channel+2,f._chSwitchVirtualReceiver3=f.channel+3,f._chSwitchWeekProfile=c+4*c+1),f):null};u._parse_HMIP_MIOB=function(f){var b=f.address,c=null,e=f.address.indexOf(":");-1!=e&&(b=f.address.substr(0,e),c=f.address.substr(e+1));e=null;0==c?e=this.CLASS_MAP.maintenance:3==c||7==c?e=this.CLASS_MAP_IP.ip_switch:9==c||10==c?e=this.CLASS_MAP_IP.ip_generic_input:11==c&&(e=this.CLASS_MAP_IP.ip_analog_output);return e?(f=new e(f.type,f.interface,b),f.channel=c,f):null};u._parseTSwitch=
function(f,b,c){f=new P(f.type,f.interface,f.address);f._chMaintenance=0;f.channel=parseInt(b);f._chSwitchVirtualReceiver1=f.channel+1;f._chSwitchVirtualReceiver2=f.channel+2;f._chSwitchVirtualReceiver3=f.channel+3;f._chSwitchWeekProfile=c;return f};u.resolve=function(f){if(!f||!f.type||!f.interface)return null;switch(f.interface){case "BidCos-RF":f=this._resolveRFFromType(f.type,f);break;case "HmIP-RF":f=this._resolveIPFromType(f.type,f);break;default:return null}return f?Array.isArray(f)?f:[f]:
null};u._resolveRFFromType=function(f,b){if("HM-MOD-EM-8"==f)return this._resolve_HM_MOD_EM_8(f,b);if("HM-OU-LED16"==f)return this._resolve_HM_OU_LED16(f,b);if("HM-Dis-EP-WM55"==f)return this._resolve_HM_Dis_EP_WM55(f,b);var c=x.hub.m.hm.RFDeviceTypes[f];if("undefined"==typeof c||null==c)return null;c=x.hub.m.hm.RFDeviceCatagory[c];if(!c||!c.type)return this._resolveRFFromTypeGeneral(f,b);var e=[];if(b.channels)for(var a in b.channels){var g=b.channels[a];g.type==c.channel&&e.push(g)}var h=this.CLASS_MAP[c.type];
if(!h)return null;if("*"==c.channelNum){var k=[];e.forEach(function(c){var a=new h(f,b.interface,b.address),g=c.address.indexOf(":");1<e.length&&(a.deviceAdr=c.address);a.channel=c.address.substr(g+1);k.push(a)});return k}a=new h(f,b.interface,b.address);"undefined"!=typeof c.channelNum&&null!=c.channelNum&&(a.channel=c.channelNum);return a};u._resolveIPFromType=function(f,b){if("HmIPW"==f.substr(0,5))return this._resolveIPW(f,b);if("HmIP-MOD-OC8"==f){var c=Pa.resolve(f,b),e=P.resolve(f,b);return c.concat(e)}if(0==
f.indexOf("HmIP-FAL"))return u._resolve_HMIP_FAL_X(f,b);if(0==f.indexOf("HmIP-MIOB"))return u._resolve_HMIP_MIOB(f,b);switch(f){case "HmIP-WHS2":return this._resolveIPMultiSwitch(f,b,2);case "HmIP-FCI1":case "HmIP-FCI6":case "HmIP-MOD-RC8":return Q.resolve(f,b)}c=this._getIPMetaIndex(f);if("undefined"==typeof c||null==c)return null;c=x.hub.m.hm.IPDeviceCatagory[c];if(!c||!c.type)return null;var a=[];if(b.channels)for(e in b.channels){var g=b.channels[e];g.type==c.channel&&a.push(g)}var h=this.CLASS_MAP_IP[c.type];
if(!h)return null;if("*"==c.channelNum){var k=[];a.forEach(function(c){var e=new h(f,b.interface,b.address),g=c.address.indexOf(":");1<a.length&&(e.deviceAdr=c.address);e.channel=c.address.substr(g+1);k.push(e)});return k}e=new h(f,b.interface,b.address);"undefined"!=typeof c.channelNum&&null!=c.channelNum&&(e.channel=c.channelNum);return e};u._resolveIPW=function(f,b){var c,e=[];if("HmIPW-DRS"==f.substr(0,9)){var a=parseInt(f.substr(9));e=this._resolveIPMultiSwitch(f,b,a)}else if("HmIPW-DRD"==f.substr(0,
9))for(a=parseInt(f.substr(9)),c=0;c<a;c++){var g=new Qa(f,b.interface,b.address+":"+(4*c+1));g._chMaintenance=0;g.channel=4*c+1;g._chDimmerVirtualReceiver1=g.channel+1;g._chDimmerVirtualReceiver2=g.channel+2;g._chDimmerVirtualReceiver3=g.channel+3;g._chDimmerWeekProfile=4*a+1;e.push(g)}else if("HmIPW-DRBL"==f.substr(0,10))for(a=parseInt(f.substr(10)),c=0;c<a;c++)g=new Ra(f,b.interface,b.address+":"+(4*c+1)),g._chMaintenance=0,g.channel=4*c+1,g._chBlindVirtualReceiver1=g.channel+1,g._chBlindVirtualReceiver2=
g.channel+2,g._chBlindVirtualReceiver3=g.channel+3,g._chBlindWeekProfile=4*a+1,e.push(g);else if("HmIPW-DRI"==f.substr(0,9))for(a=parseInt(f.substr(9)),c=0;c<a;c++)g=new Q(f,b.interface,b.address+":"+(c+1)),g._chMaintenance=0,g.channel=c+1,e.push(g);else if("HmIPW-FIO"==f.substr(0,9))for(a=parseInt(f.substr(9)),c=0;c<a;c++)g=new Q(f,b.interface,b.address+":"+(c+1)),g._chMaintenance=0,g.channel=c+1,e.push(g),g=new P(f,b.interface,b.address+":"+(4*c+a+1)),g._chMaintenance=0,g.channel=4*c+a+1,g._chSwitchVirtualReceiver1=
g.channel+1,g._chSwitchVirtualReceiver2=g.channel+2,g._chSwitchVirtualReceiver3=g.channel+3,g._chSwitchWeekProfile=a+4*a+1,e.push(g);return e};u._resolveIPMultiSwitch=function(f,b,c){var e,a=[];for(e=0;e<c;e++){var g=new P(f,b.interface,b.address+":"+(4*e+1));g._chMaintenance=0;g.channel=4*e+1;g._chSwitchVirtualReceiver1=g.channel+1;g._chSwitchVirtualReceiver2=g.channel+2;g._chSwitchVirtualReceiver3=g.channel+3;g._chSwitchWeekProfile=4*c+1;a.push(g)}return a};u._resolveRFFromTypeGeneral=function(f,
b){var c=[];if(!b||!b.channels)return null;var e=b.channels,a;for(a in e){var g=e[a];if(g&&g.type&&x.hub.m.hm._Channel["BidCos-RF"][g.type]&&(g=x.hub.m.hm._Channel["BidCos-RF"][g.type].device)&&(g=this.CLASS_MAP[g])){g=new g(f,b.interface,a);var h=a.indexOf(":");g.channel=a.substr(h+1);c.push(g)}}return c};u._resolve_HM_MOD_EM_8=function(f,b){var c=[];if(!b||!b.channels)return null;var e=b.channels,a;for(a in e){e=a.indexOf(":");e=a.substr(e+1);var g=new (0==e?this.CLASS_MAP.maintenance:this.CLASS_MAP.mod_em_8)(f,
b.interface,a);g.channel=e;c.push(g)}return c};u._resolve_HM_OU_LED16=function(f,b){var c=[];if(!b||!b.channels)return null;var e=b.channels,a;for(a in e){e=a.indexOf(":");e=a.substr(e+1);var g=new (0==e?this.CLASS_MAP.maintenance:this.CLASS_MAP.ou_led16)(f,b.interface,a);g.channel=e;c.push(g)}return c};u._resolve_HM_Dis_EP_WM55=function(f,b){var c=[];if(!b||!b.channels)return null;var e=b.channels,a;for(a in e){e=a.indexOf(":");e=a.substr(e+1);var g=null;0==e?g=this.CLASS_MAP.maintenance:1==e||2==
e?g=this.CLASS_MAP.button:3==e&&(g=this.CLASS_MAP.hm_dis_ep_wm55);g&&(g=new g(f,b.interface,a),g.channel=e,c.push(g))}return c};u._resolve_HMIP_FAL_X=function(f,b){var c=[];if(!b||!b.channels)return null;var e=b.channels,a;for(a in e){var g=e[a],h=a.indexOf(":");h=a.substr(h+1);if(0==h)var k=this.CLASS_MAP.maintenance;else"CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER"==g.type?k=this.CLASS_MAP_IP.ip_floor_pump_heater:"CLIMATECONTROL_FLOOR_TRANSCEIVER"==g.type&&(k=this.CLASS_MAP_IP.ip_floor_heater);k&&(g=
new k(f,b.interface,a),g.channel=h,c.push(g))}return c};u._resolve_HMIP_MIOB=function(f,b){var c=[];if(!b||!b.channels)return null;var e=b.channels,a;for(a in e){e=a.indexOf(":");e=a.substr(e+1);var g=null;0==e?g=this.CLASS_MAP.maintenance:3==e||7==e?g=this.CLASS_MAP_IP.ip_switch:9==e||10==e?g=this.CLASS_MAP_IP.ip_generic_input:11==e&&(g=this.CLASS_MAP_IP.ip_analog_output);g&&(g=new g(f,b.interface,a),g.channel=e,c.push(g))}return c};u._getIPMetaIndex=function(f){for(var b in x.hub.m.hm.IPDeviceTypes)if(x.hub.m.hm.IPDeviceTypes.hasOwnProperty(b)&&
b.toUpperCase()==f.toUpperCase())return x.hub.m.hm.IPDeviceTypes[b];return null};return u}();
x.hub.m.hm.Manager=function(){var a=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager");this._gateway=a;this._devices={};this._meta={}};a.prototype.init=function(a){x.hub.m.hm._Util.isIP(this._gateway.ip)?(this._logger.log("info","start connect monitor to "+this._gateway.ip),this._startMonitor(a)):a&&a()};a.prototype.onDeviceEvent=function(a){this._logger.log("trace","receive device event:"+JSON.stringify({device:a.device?a.device.type:null,address:a.device?a.device.address:
null,channel:a.channel,datapoint:a.datapoint,value:a.value?a.value.value:null,ip:a.ip}));var h=function(a,g){var h=null;if(!g||0==g.length)return null;g.forEach(function(g){g&&g.key==a&&(h=g)});return h};if(!a||!a.device)return null;var g=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!g)return null;var k=a.device;k.hsstype=k.type;if(k.channels)for(var l in k.channels)if(k.channels.hasOwnProperty(l)){var q=k.channels[l];q.hsstype=q.type}k=g._parseDevice(k);if(!k||0==k.length)return null;var n;
1==k.length?n=k[0]:k.forEach(function(g){if(g.address==a.channel)n=g;else if(0==a.channel.indexOf(g.address)){var h=a.channel.split(":")[1];if(g.channels)for(var k in g.channels)if(g.channels[k].address==h){n=g;break}}});if(!n)return null;k=x.hub.m.hm._Util.getDeviceHashCode(n);var r=g.resolveState(n,a,a.oldValue.value);g=g.resolveState(n,a,a.value.value);if(!g)return null;this._logger.log("trace","event to device state");this._logger.log("trace","device:"+JSON.stringify(n));this._logger.log("trace",
"state:"+JSON.stringify(g));var p=[];Array.isArray(g)?g.forEach(function(a){var g=h(a.key,r);p.push({device:n,gateway:this._gateway,data:{key:a.key,value:a.value,changed:g?a.value!=g.value:!0,oldValue:g?g.value:void 0}})}.bind(this)):p.push({device:n,gateway:this._gateway,data:{key:g.key,value:g.value,changed:g.value!=r.value,oldValue:r.value}});this._generateEvent(k,p)};a.prototype._generateEvent=function(a,m){var g=require("x.hub.eventbus.js");if((a=this._meta[a])&&0<a.length)for(var h=0;h<a.length;h++){var l=
a[h];if(l)for(var q=0;q<m.length;q++){var n=m[q];n&&n.data&&(n.data.key==l.statusKey||"*"==n.data.key)&&g.emit("status",{module:"hm",device:n.device,gateway:n.gateway,data:n.data},l)}}};a.prototype.addStateDevice=function(a,m,g){if(a){a=JSON.parse(JSON.stringify(a));var h=x.hub.m.hm._Util.getDeviceHashCode(a);this._devices[h]||(delete a.gateway,this._devices[h]=a);this._meta[h]||(this._meta[h]=[]);g&&this._meta[h].push(g);m&&m()}else m&&m(Error("device json invalid"))};a.prototype.removeStateDevice=
function(a,m,g){if(!a)m&&m(Error("device json invalid"));else if(g){a=JSON.parse(JSON.stringify(a));a=x.hub.m.hm._Util.getDeviceHashCode(a);var h=this._meta[a];if(h){for(var l=-1,q=0;q<h.length;q++){var n=h[q];if(n&&"taskman"==n.src&&"taskman"==g.src&&n.taskID==g.taskID&&n.statusKey==g.statusKey){l=q;break}}0<=l&&h.splice(l,1);0==h.length&&(delete this._devices[a],delete this._meta[a])}m&&m()}};a.prototype.getAllStates=function(){var a=[],m;for(m in this._devices)if(this._devices.hasOwnProperty(m)){var g=
this._devices[m];g&&g.device&&(g=this.getStates(g.device))&&a.push(g)}return a};a.prototype.getStates=function(a){if(!a)return null;a=JSON.parse(JSON.stringify(a));var h=x.hub.m.hm._Util.getDeviceHashCode(a),g=this._devices[h];g||this.addStateDevice(a);var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!k)return null;var l={};g=this._devices[h];for(var q in g.states)h=k.getBufferedState(g.states[q]),l[q]=this._resolveRawState(a,q,h);return{device:a,gateway:this._gateway,
states:l}};a.prototype.updateStates=function(a,m){if(a){a=JSON.parse(JSON.stringify(a));var g=x.hub.m.hm._Util.getDeviceHashCode(a),h=this._devices[g];h||this.addStateDevice(a);h=this._devices[g];this._updateStates(a,h.states,m)}else m&&m(Error("device json is null"))};a.prototype.getState=function(a,m,g){if(!a||!m)return g&&g(Error("argument invalid")),null;if("SysVar"==a.type||"CUxD"==a["interface"])x.hub.m.hm.HM_MODULE.doStatus("var",this._gateway,a,{value:m},function(a,h){a?g&&g(a):h?(a={value:h.status,
time:(new Date).getTime()},g&&g(null,a)):g&&g(Error("get sys var status return null"))});else{a=JSON.parse(JSON.stringify(a));var h=x.hub.m.hm._Util.getDeviceHashCode(a);this._devices[h]||this.addStateDevice(a);h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return g&&g(Error("no monitor for gateway")),null;var l=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!l)return g&&g(Error("gateway json invalid")),null;var q=l.resolveDatapointInfo(a,m);
if(!q)return g&&g(Error("device json or state ref invalid")),null;h.getState(q,function(h,k){if(h)g&&g(h);else if(k){h=l.resolveState(a,q,k.value);var n;h?Array.isArray(h)?h.forEach(function(a){a&&a.key==m&&(n={value:a.value,time:k.time})}):n={value:h.value,time:k.time}:n={value:h,time:k.time};g&&g(null,n)}else g&&g(null,null)})}};a.prototype.executeCommand=function(a,m,g){var h=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!h)return g&&g(Error("gateway json invalid")),null;h.executeCommandCreator(a,
m,g)};a.prototype.updateState=function(a,m,g){if(!a||!m)return g&&g(Error("argument invalid")),null;a=JSON.parse(JSON.stringify(a));var h=x.hub.m.hm._Util.getDeviceHashCode(a);this._devices[h]||this.addStateDevice(a);h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return g&&g(Error("no monitor for gateway")),null;var l=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!l)return g&&g(Error("gateway json invalid")),null;var q=l.resolveDatapointInfo(a,
m);if(!q)return g&&g(Error("device json or state ref invalid")),null;h.updateState(q,function(h,k){if(h)g&&g(h);else{h=l.resolveState(a,q,k);var n;h?Array.isArray(h)?h.forEach(function(a){a&&a.key==m&&(n={value:a.value})}):n={value:h.value}:n={value:h};g&&g(null,n)}})};a.prototype._startMonitor=function(a){var h=require("x.hub.m.hm.js")._monitorManager,g=this;h.startMonitor(this._gateway,{persistant:!0},function(k){var l=h.getMonitor(g._gateway.ip,g._gateway.uuid);if(l)l.on("new_devices",g._onNewDevices.bind(g));
a&&a(k)})};a.prototype._onNewDevices=function(a){var h=[],g;for(g in a)if(a.hasOwnProperty(g)){var k=x.hub.m.hm._Device.resolve(a[g]);k&&0<k.length&&(k=k.filter(function(a){return a&&a.isButton()}),h=h.concat(k))}var l=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(l&&0<h.length){var q=0,n=function(){q++;q<h.length&&h[q].claimEvent(l,n)};h[q].claimEvent(l,n)}};a.prototype._updateStates=function(a,m,g){var h=this;require("x.hub.m.hm.js")._monitorManager.startMonitor(this._gateway,
{persistant:!0},function(k){k?g&&g(k):h._getStateByScript(a,m,g)})};a.prototype._resolveDetailDpt=function(a){var h=require("xnm.aio.hm.js").devicemanager,g=h.applyUIFilter(a,{catagory:"status",elems:"*"}),k=g?g.status:null;h=(g=h.applyUIFilter(a,{catagory:"command",elems:"*"}))?g.command:null;g={states:{},commands:{}};if(k&&0<=k.length)for(var l=0;l<k.length;l++){var q=k[l],n=this._resolveDatapointRef(a,q.ref.value,!1);n&&(g.states[q.ref.value]=n)}if(h&&0<=h.length)for(l=0;l<h.length;l++)k=h[l],
(n=this._resolveDatapointRef(a,k.ref.value,!0))&&(g.commands[k.ref.value]=n);return g};a.prototype.learnRFDevice=function(a){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnRF(function(g,h){if(g)a&&a(g);else{g=[];var k=new x.hub.m.hm.HM_MODULE.CCU,m;for(m in h){var n=h[m];n.hsstype=n.type;if(n.channels)for(m in n.channels)n.channels[m].hsstype=n.channels[m].type;(n=k._parseDevice(n))&&(g=g.concat(n))}a&&a(null,g)}}):a&&a(Error("monitor not started"))};
a.prototype.learnIPDevice=function(a,m,g){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnIP(a,m,function(a,h){if(a)g&&g(a);else{a=[];var k=new x.hub.m.hm.HM_MODULE.CCU,l;for(l in h){var m=h[l];m.hsstype=m.type;if(m.channels)for(l in m.channels)m.channels[l].hsstype=m.channels[l].type;(m=k._parseDevice(m))&&(a=a.concat(m))}g&&g(null,a)}}):g&&g(Error("monitor not started"))};a.prototype.learnIPDeviceQR=function(a,m){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,
this._gateway.uuid);g?g.learnIPQR(a,function(a,g){if(a)m&&m(a);else{a=[];var h=new x.hub.m.hm.HM_MODULE.CCU,k;for(k in g){var l=g[k];l.hsstype=l.type;if(l.channels)for(k in l.channels)l.channels[k].hsstype=l.channels[k].type;(l=h._parseDevice(l))&&(a=a.concat(l))}m&&m(null,a)}}):m&&m(Error("monitor not started"))};a.prototype.deleteDevice=function(a,m,g){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.deleteDevice(a,m,g):g&&g(Error("monitor not started"))};
a.prototype.getRFInterfaces=function(a){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.getRFInterfaces(a):a&&a(Error("monitor not started"))};return a}();x.hub.m.hm.ChipManager=function(a){x.hub.m.hm.Manager.call(this,a);this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager.ChipManager")};util.inherits(x.hub.m.hm.ChipManager,x.hub.m.hm.Manager);
x.hub.m.hm.ChipManager.prototype.init=function(a){if(x.hub.m.hm._Util.isIP(this._gateway.ip)){this._logger.log("info","start connect monitor to "+this._gateway.ip);var h=this,m=require("x.hub.m.hm.js")._monitorManager;m.startMonitor(this._gateway,{localChip:"chip",persistant:!0},function(g){var k=m.getMonitor(h._gateway.ip,h._gateway.uuid);if(k)k.on("new_devices",h._onNewDevices.bind(h));a&&a(g)},!0,!0)}else a&&a()};
x.hub.m.hm.ChipManager.prototype.reset=function(a){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!h)return a&&a(Error("no chip monitor")),null;h.reset(a)};
x.hub.m.hm.ChipManager.prototype.executeCommand=function(a,h,m){if(a&&a.address&&h)if(a=a.address.split("."),3>a.length)m&&m({error:Error("address invalid")});else{var g={type:a[0],interface:a[1],address:a[2]};a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!a)return m&&m(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.executeCommand(a,h.value,m):m&&m(Error("unknow device"))}else m&&m(Error("argument invalid"))};
x.hub.m.hm.ChipManager.prototype.getState=function(a,h,m){if(!a||!a.address||!h)return m&&m(Error("argument invalid")),null;a=a.address.split(".");if(3>a.length)m&&m(Error("address invalid"));else{var g={type:a[0],interface:a[1],address:a[2]};a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!a)return m&&m(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.getState(a,h.value,m):m&&m(Error("unknow device"))}};
x.hub.m.hm.ChipManager.prototype.getBufferedStateLegacy=function(a,h){if(!a)return null;a=x.hub.m.hm._Device.resolve(a);if(!a||0==a.length)return null;var m;1==a.length?m=a[0]:a.forEach(function(a){a.deviceAdr==h&&(m=a)});if(!m)return null;var g;if(a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid)){a=a.getAllBufferedStates();var k=m.deviceAdr,l=k.indexOf(":");-1!=l&&(k=k.substr(0,l));a[k]&&a[k].states&&(g=m.parseStates(a[k].states))}if(!g)return null;a={type:"HM",
adr:m.toLegacyAdr(),state:{}};for(var q in g)a.state[q]=g[q].value;return a};
x.hub.m.hm.ChipManager.prototype.checkButtonEvent=function(a){if(!a||!a.device||!a.datapoint||0!=a.datapoint.indexOf("PRESS"))return null;var h=x.hub.m.hm._Device.resolve(a.device);if(!h||0==h.length)return null;var m;1==h.length?m=h[0]:h.forEach(function(g){g.deviceAdr==a.channel&&(m=g)});if(!m)return null;h=m.parseDptState(a.channel,a.datapoint,a.value.value);if(!h)return null;var g={type:"HM",adr:m.deviceType+"."+m.deviceIF+"."+m.deviceAdr,state:{},_ver:"v5+"},k=Object.keys(h);g.state[k[0]]=h[k[0]];
require("x.hub.eventbus.js").emit("gatewayevent",g,{address:"HM"},"BTN")};
x.hub.m.hm.ChipManager.prototype.onDeviceEvent=function(a){if(!a||!a.device)return null;var h=x.hub.m.hm._Device.resolve(a.device);if(!h||0==h.length)return null;var m;1==h.length?m=h[0]:h.forEach(function(g){g.deviceAdr==a.channel&&(m=g)});if(!m)return null;h=m.parseDptState(a.channel,a.datapoint,a.oldValue.value);var g=m.parseDptState(a.channel,a.datapoint,a.value.value);if(!g)return null;var k={sys:"aio",type:"HM",address:m.deviceType+"."+m.deviceIF+"."+m.deviceAdr},l=this._gateway,q={key:null,
value:null,changed:a.changed,oldValue:null},n=Object.keys(g);q.key=n[0];q.value=g[n[0]];q.oldValue=h?h[n[0]]:void 0;this._logger.log("debug","EVENT:\t"+k.address+"\t"+q.key+"\t"+q.value);return{device:k,gateway:l,data:q}};
x.hub.m.hm.ChipManager.prototype.learnRFDevice=function(a){var h=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);h?h.learnRF(function(h,g){if(h)a&&a(h);else{var k=[],l;for(l in g){var m=x.hub.m.hm._Device.resolve(g[l]);m&&(k=k.concat(m))}a&&a(h,k)}}):a&&a(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnRFDeviceSN=function(a,h){var m=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);m?m.learnRFSN(a,function(a,k){if(a)h&&h(a);else{var g=[],m;for(m in k){var n=x.hub.m.hm._Device.resolve(k[m]);n&&(g=g.concat(n))}h&&h(a,g)}}):h&&h(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDevice=function(a,h,m){var g=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);g?g.learnIP(a,h,function(a,g){if(a)m&&m(a);else{var h=[],k;for(k in g){var l=x.hub.m.hm._Device.resolve(g[k]);l&&(h=h.concat(l))}m&&m(a,h)}}):m&&m(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.learnIPDeviceQR=function(a,h){var m=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);m?m.learnIPQR(a,function(a,k){if(a)h&&h(a);else{var g=[],m;for(m in k){var n=x.hub.m.hm._Device.resolve(k[m]);n&&(g=g.concat(n))}h&&h(a,g)}}):h&&h(Error("monitor not started"))};
x.hub.m.hm.ChipManager.prototype.getAllBufferedStates=function(){var a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!a)return[];a=a.getAllBufferedStates();var h=[],m;for(m in a){var g=a[m],k=x.hub.m.hm._Device.resolve(g.device);if(k)for(var l=0,q=k.length;l<q;l++){var n=k[l],r=n.parseStates(g.states);h.push({device:n,states:r})}}return h};
x.hub.m.hm.ChipManager.prototype.getConfig=function(a,h){if(a&&a.address)if(a=a.address.split("."),3>a.length)h&&h({error:Error("address invalid")});else{var m={type:a[0],interface:a[1],address:a[2]};a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!a)return h&&h(Error("no chip monitor")),null;(m=x.hub.m.hm._Device.parseJson(m))?m.getConfig(a,h):h&&h(Error("unknow device"))}else h&&h(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype.setConfig=function(a,h,m){if(a&&a.address)if(a=a.address.split("."),3>a.length)m&&m({error:Error("address invalid")});else{var g={type:a[0],interface:a[1],address:a[2]};a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!a)return m&&m(Error("no chip monitor")),null;(g=x.hub.m.hm._Device.parseJson(g))?g.setConfig(a,h,m):m&&m(Error("unknow device"))}else m&&m(Error("device json invalid"))};
x.hub.m.hm.ChipManager.prototype._onNewDevices=function(a){var h=[],m;for(m in a)if(a.hasOwnProperty(m)){var g=x.hub.m.hm._Device.resolve(a[m]);g&&0<g.length&&(g=g.filter(function(a){return a&&a.isButton()}),h=h.concat(g))}var k=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(k&&0<h.length){var l=0,q=function(){l++;l<h.length&&h[l].claimEvent(k,q)};h[l].claimEvent(k,q)}};
x.hub.m.hm.CCU2Discovery=function(){var a=function(a){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.CCU2Discovery");this._autoDiscoverTO=null;var h=this;this._hmHandlerCB=function(a,k){h._logger.log("debug","find ccu:"+a.uuid+"@"+a.ip+" from netif:"+k);h._searchCB&&h._searchCB(a,k);if(a.ip){var g=!1;h._searchTmpHMs.forEach(function(h){h.ip==a.ip&&(g=!0)});g||h._searchTmpHMs.push(a)}};this._searchCB=a;this._searchRunning=!1;this._searchTmpHMs=[];this._searchTmpCBs=[]};a.prototype.discover=
function(a){a&&-1==this._searchTmpCBs.indexOf(a)&&this._searchTmpCBs.push(a);if(!this._searchRunning){this._searchRunning=!0;this._searchTmpHMs=[];this._autoDiscoverTO&&(clearTimeout(this._autoDiscoverTO),this._autoDiscoverTO=null);require("xnm.aio.hm.js").discoverCCUs(this._hmHandlerCB);var h=this;setTimeout(function(){h._searchRunning=!1;h._autoDiscoverTO=setTimeout(function(){h.discover()},3E4);h._searchTmpCBs.forEach(function(a){a&&a(h._searchTmpHMs)});h._searchTmpCBs=[]},3E3)}};return a}();
x.hub.m.hm._Util={isDeviceJsonValid:function(a){return a&&a.type&&a.address&&a.interface},isGatewayJsonValid:function(a){return a&&a.ip},getDeviceHashCode:function(a){if(!a)return-1;var h=0;h=(h<<5)-h+this._getStringHashCode(a.type);h=(h<<5)-h+this._getStringHashCode(a.address);return h=(h<<5)-h+this._getStringHashCode(a.interface)},getGatewayHashCode:function(a){if(!a)return-1;var h=80;a.port&&((h=parseInt(a.port))||(h=80));var m=0;m=(m<<5)-m+this._getStringHashCode(a.ip);m=(m<<5)-m+h;m=(m<<5)-m+
this._getStringHashCode(a.uuid);m=(m<<5)-m+this._getStringHashCode(a.username);return m=(m<<5)-m+this._getStringHashCode(a.password)},getLocalIP:function(a,h){var m=function(a){return a?(a=a.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/))?(+a[1]<<24)+(+a[2]<<16)+(+a[3]<<8)+ +a[4]:-1:-1};if("127.0.0.1"==h||"localhost"==h)return"127.0.0.1";var g=require("os").networkInterfaces(),k;for(k in g)if(g.hasOwnProperty(k))for(var l=g[k],q=0;q<l.length;q++){var n=l[q];if(n&&"IPv4"==n.family&&n.address){if(a==k||!a&&
!h)return n.address;if(!a&&n.netmask&&h){var r=m(n.netmask),p=m(n.address),t=m(h);if((p&r)==(t&r))return n.address}}}return null},getLocalMac:function(a){var h=require("os").networkInterfaces(),m;for(m in h)if(h.hasOwnProperty(m))for(var g=h[m],k=0;k<g.length;k++){var l=g[k];if(l&&"IPv4"==l.family&&l.address&&l.mac&&a==l.address)return l.mac}return"00:00:00:00:00:00"},isIP:function(a){return/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(a)},
mergeObj:function(a,h){var m={},g;for(g in a)a.hasOwnProperty(g)&&(m[g]=a[g]);for(g in h)h.hasOwnProperty(g)&&(m[g]=h[g]);return m},_getStringHashCode:function(a){var h=0,m;if("undefined"==typeof a||null==a)return-1;if(0===a.length)return h;var g=0;for(m=a.length;g<m;g++){var k=a.charCodeAt(g);h=(h<<5)-h+k}return h}};
x.hub.m.hm.UdpEventProducer=function(){var a=function(a){this._handler=a;this._pool={}};a.prototype.EVENT_TO=300;a.prototype.onEvent=function(a){if(a&&a.channel){var h=0,g=a.channel,k=g.indexOf(":");-1!=k&&(g=a.channel.substr(0,k),h=a.channel.substr(k+1));(k=this._pool[g])&&k.timeout&&clearTimeout(k.timeout);var l=this;k=setTimeout(function(){var a=l._pool[g];l._pool[g]=null;for(var h in a){var k=a[h];if(k=l._handler._chipManager.getBufferedStateLegacy(k.device,k.channel)){k._ver="v5+";var m=require("x.hub.eventbus.js");
m.emit("gatewayevent",k,{address:"HM"},"STA");m.emit("udpevent",k,"STA")}}},this.EVENT_TO);this._pool[g]||(this._pool[g]={});this._pool[g].timeout=k;this._pool[g][h]||(this._pool[g][h]=a)}};a.prototype.addSTAEvent=function(a){if(a&&a.adr){var h=(new Date).getTime(),g=a.adr,k=this._pool[g];k&&k.timeout&&clearTimeout(k.timeout);var l=this;k=setTimeout(function(){var a=l._pool[g];if(a&&a.states){var h=require("x.hub.eventbus.js");h.emit("gatewayevent",a.states,{address:"HM"},"STA");h.emit("udpevent",
a.states,"STA")}},this.EVENT_TO);this._pool[g]={states:a,timestamp:h,timeout:k}}};return a}();
x.hub.m.hm.Handler=function(){var a=function(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Handler");var a=this;this._udpEvtProducer=new x.hub.m.hm.UdpEventProducer(this);this._discoveryCB=function(h,g){a._onFindHM(h,g)};this._monitorManager=this._discovery=null;this._managers={};this._chipManager=this._xmlrpcServer=null};util.inherits(a,EventEmitter);a.prototype.CCU=x.hub.m.hm.CCU;a.prototype.XMLRPCClient=x.hub.m.hm.Client;a.prototype.init=function(a){var h=this;if(localStorage){var g=
!0;"false"==localStorage.getItem("x.hub.m.hm.CCU_INIT_STATE")&&(g=!1);x.hub.m.hm.CCU_INIT_STATE=g}require("x.hub.eventbus.js").on("x.hub.m.hm.CCU_INIT_STATE",function(a){var g=!0;"false"==a&&(g=!1);x.hub.m.hm.CCU_INIT_STATE=g});this._discovery=new x.hub.m.hm.CCU2Discovery(this._discoveryCB);this._monitorManager=new x.hub.m.hm.MonitorManager;this._xmlrpcServer=new x.hub.m.hm.Server(global.HM_LOCAL_PORT);this._xmlrpcServer.start(function(g){g?(h._logger.log("warn","start homematic local server error with port:"+
h._xmlrpcServer.getPort()),h._logger.log("warn",g.stack),a&&a({error:g})):h._monitorManager.init(h._xmlrpcServer,function(g){g?a&&a({error:g}):global&&global.HM_CHIP?h._initChipManager(function(g){a&&a({error:g})}):a&&a({})})})};a.prototype.getSystems=function(){return["hm"]};a.prototype.addStateDevice=function(a,m,g){if(a)if(a.gateway&&"mediola"!=a.gateway.uuid)if(a.gateway.ip&&x.hub.m.hm._Util.isIP(a.gateway.ip))if(x.hub.m.hm._Util.isIP(a.gateway.ip)){var h=this._getManager(a.gateway);h?h.addStateDevice(a,
function(a){m&&m({error:a})},g):(h=this._addManager(a.gateway),h.init(function(a){}),h.addStateDevice(a,function(a){m&&m({error:a})},g))}else this._logger.log("warn","ccu has ip:"+a.gateway.ip," , may not receive event from it."),m&&m({error:Error("gateway ip is url")});else m&&m({error:Error("gateway ip format invalid")});else m&&m();else m&&m({error:Error("device json format invalid")})};a.prototype.removeStateDevice=function(a,m,g){if(a)if(a.gateway&&"mediola"!=a.gateway.uuid)if(a.gateway.ip&&
x.hub.m.hm._Util.isIP(a.gateway.ip))if(x.hub.m.hm._Util.isIP(a.gateway.ip)){var h=this._getManager(a.gateway);h?h.removeStateDevice(a,function(a){m&&m({error:a})},g):m&&m({})}else this._logger.log("warn","ccu has ip:"+a.gateway.ip," , may not receive event from it."),m&&m({error:Error("gateway ip is url")});else m&&m({error:Error("gateway ip format invalid")});else m&&m();else m&&m({error:Error("device json format invalid")})};a.prototype.getAllStates=function(){return this._chipManager?this._chipManager.getAllBufferedStates():
[]};a.prototype.getStates=function(a){if(!(a&&x.hub.m.hm._Util.isDeviceJsonValid(a)&&a.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(a.gateway)))return null;var h=this._getManager(a.gateway);if(h)return h.getStates(a);h=this._addManager(a.gateway);h.init();return null};a.prototype.getState=function(a,m,g){if(!a)return g&&g({error:Error("device is null")}),null;if(!a.gateway||"mediola"==a.gateway.uuid){if(!this._chipManager){g&&g({error:Error("chip manager not inited")});return}return this._chipManager.getState(a,
{value:m},function(a,h){g&&g({error:a,data:h})})}if(!x.hub.m.hm._Util.isDeviceJsonValid(a)||!a.gateway||!x.hub.m.hm._Util.isGatewayJsonValid(a.gateway))return g&&g({error:Error("device json invalid")}),null;x.hub.m.hm.HM_MODULE.doStatus("xhub",a.gateway,a,{value:m},function(a,h){a?g&&g({error:a}):h?g&&g({data:{value:h.status}}):g&&g({error:Error("do status failed")})})};a.prototype.executeCommand=function(a,m,g){a?m?a.gateway&&"mediola"!=a.gateway.uuid?a.gateway?x.hub.m.hm.HM_MODULE.doCommand(a.gateway,
a,m,function(a){a?g&&g({error:a}):g&&g({})}):g&&g({error:Error("gateway is null")}):this._chipManager?this._chipManager.executeCommand(a,m,function(a){g&&g({error:a})}):g&&g({error:Error("chip manager not inited")}):g&&g({error:Error("command invalid")}):g&&g({error:Error("device is null")})};a.prototype.updateStates=function(a,m){if(a&&x.hub.m.hm._Util.isDeviceJsonValid(a)&&a.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(a.gateway)){var g=this._getManager(a.gateway);g?g.updateStates(a,function(a,
g){m&&m({error:a,data:g})}):(g=this._addManager(a.gateway),g.init(function(h){h?m&&m({error:h}):g.updateStates(a,function(a,g){m&&m({error:a,data:g})})}))}else m&&m({error:Error("device json format invalid")})};a.prototype.checkDeviceMatch=function(a,m){if(!(m&&m.device&&a&&a.device))return!1;if(m.gateway&&"mediola"!=m.gateway.uuid)return m=x.hub.m.hm._Util.getDeviceHashCode(m.device),a=x.hub.m.hm._Util.getDeviceHashCode(a.device),m==a;var g=a.device.address;a.device.interface&&a.device.type&&(g=
a.device.type+"."+a.device.interface+"."+a.device.address);return g!=m.device.address?!1:!0};a.prototype._initChipManager=function(a){var h="127.0.0.1";global&&global.HM_CHIP&&(h=global.HM_CHIP);this._chipManager=new x.hub.m.hm.ChipManager({ip:h,username:global.HM_CHIP_USERNAME,password:global.HM_CHIP_PASSWORD,uuid:"mediola"});this._chipManager.init(a)};a.prototype._initCCU3Manager=function(a){this._addManager({ip:"127.0.0.1",type:3}).init(function(h){a&&a(h)})};a.prototype._discover=function(a){this._discovery.discover(a)};
a.prototype._onFindHM=function(a,m){this._logger.log("debug","find ccu:"+a.uuid+"@"+a.ip+" from netif:"+m);this._monitorManager.onFindHomeMatic(a.ip,m,a.uuid)};a.prototype._getManager=function(a){a=x.hub.m.hm._Util.getGatewayHashCode(a);return this._managers[a]};a.prototype._addManager=function(a){var h=x.hub.m.hm._Util.getGatewayHashCode(a);a=new x.hub.m.hm.Manager(a);return this._managers[h]=a};a.prototype.onDeviceEvent=function(a,m){this._logger.log("trace","receive device event:"+JSON.stringify(a));
require("x.hub.eventbus.js");if(m)this._chipManager&&(this._chipManager.checkButtonEvent(a),this._udpEvtProducer.onEvent(a));else for(var g in this._managers)if(m=this._managers[g])try{m.onDeviceEvent(a)}catch(k){console.error(k.stack)}};a.prototype.resetChip=function(a){this._chipManager?this._chipManager.reset(function(){a&&a({})}):a&&a(Error("chip manager not inited"))};a.prototype.initManager=function(a,m){if(a){var g=this._getManager(a);g||(g=this._addManager(a));g.init(function(a){m&&m({error:a})})}else m&&
m({error:Error("gateway invalid")})};a.prototype.learnRFDevice=function(a,m){if(a){var g=this._getManager(a);g?g.learnRFDevice(function(a,g){m&&m({error:a,data:g})}):(g=this._addManager(a),g.init(function(a){a?m&&m({error:a}):setTimeout(function(){g.learnRFDevice(function(a,g){m&&m({error:a,data:g})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDevice(function(a,g){if(a)m&&m({error:a});else{var h=[];g.forEach(function(a){if(a){var g=a.toLegacyAdr();a=a.toLegacyType();h.push({address:g,
type:a})}});m&&m({data:h})}}):m&&m(Error("chip manager not inited"))};a.prototype.learnRFDeviceSN=function(a,m,g){if(a){var h=this._getManager(a);h?h.learnRFDevice(function(a,h){g&&g({error:a,data:h})}):(h=this._addManager(a),h.init(function(a){a?g&&g({error:a}):setTimeout(function(){h.learnRFDevice(function(a,h){g&&g({error:a,data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnRFDeviceSN(m,function(a,h){if(a)g&&g({error:a});else{var k=[];h.forEach(function(a){if(a){var g=a.toLegacyAdr();
a=a.toLegacyType();k.push({address:g,type:a})}});g&&g({data:k})}}):g&&g(Error("chip manager not inited"))};a.prototype.learnIPDevice=function(a,m,g,k){if(a){var h=this._getManager(a);h?h.learnIPDevice(m,g,function(a,g){k&&k({error:a,data:g})}):(h=this._addManager(a),h.init(function(a){a?k&&k({error:a}):setTimeout(function(){h.learnIPDevice(m,g,function(a,g){k&&k({error:a,data:g})})},3E3)}))}else m?g?this._chipManager?this._chipManager.learnIPDevice(m,g,function(a,g){if(a)k&&k({error:a});else{var h=
[];g.forEach(function(a){if(a){var g=a.toLegacyAdr();a=a.toLegacyType();h.push({address:g,type:a})}});k&&k({data:h})}}):k&&k(Error("chip manager not inited")):k&&k({error:Error("key is null")}):k&&k({error:Error("sgtin is null")})};a.prototype.learnIPDeviceQR=function(a,m,g){if(m)if(a){var h=this._getManager(a);h?h.learnIPDeviceQR(m,function(a,h){g&&g({error:a,data:h})}):(h=this._addManager(a),h.init(function(a){a?g&&g({error:a}):setTimeout(function(){h.learnIPDeviceQR(m,function(a,h){g&&g({error:a,
data:h})})},3E3)}))}else this._chipManager?this._chipManager.learnIPDeviceQR(m,function(a,h){if(a)g&&g({error:a});else{var k=[];h.forEach(function(a){if(a){var g=a.toLegacyAdr();a=a.toLegacyType();k.push({address:g,type:a})}});g&&g({data:k})}}):g&&g(Error("chip manager not inited"));else g&&g({error:Error("qrKey is null")})};a.prototype.deleteDevice=function(a,m,g){if(m){var h=m.split(".");3>h.length?g&&g({error:Error("address invalid")}):(m=h[1],h=h[2],a?g&&g({error:Error("not supported yet")}):
this._chipManager?this._chipManager.deleteDevice(m,h,function(a){g&&g({error:a})}):g&&g(Error("chip manager not inited")))}else g&&g({error:Error("address invalid")})};a.prototype.getRFInterfaces=function(a,m){if(a){var g=this._getManager(a);g?g.getRFInterfaces(function(a,g){m&&m({error:a,data:g})}):(g=this._addManager(a),g.init(function(a){a?m&&m({error:a}):setTimeout(function(){g.getRFInterfaces(function(a,g){m&&m({error:a,data:g})})},3E3)}))}else this._chipManager?this._chipManager.getRFInterfaces(function(a,
g){m&&m({error:a,data:g})}):m&&m(Error("chip manager not inited"))};a.prototype.executeCommandLegacy=function(a,m,g,k){a?k&&k({error:Error("not supported yet")}):this._chipManager?m?this.executeCommand({address:m},{value:g},function(a){k&&k({error:a?a.error:null})}):k&&k({error:Error("address invalid")}):k&&k({error:Error("chip manager not inited")})};a.prototype.getAllStatesLegacy=function(a){var h=[];try{this.getAllStates().forEach(function(a){if(a&&a.device&&a.states){var g={type:"HM",adr:a.device.toLegacyAdr(),
state:{}},l;for(l in a.states)g.state[l]=a.states[l].value;h.push(g)}})}catch(g){console.error(g.stack)}a&&a({data:h})};a.prototype.getConfig=function(a,m){a?a.gateway&&"mediola"!=a.gateway.uuid?m&&m({error:Error("not supported yet")}):this._chipManager?this._chipManager.getConfig(a,function(a,h){m&&m({error:a,data:h})}):m&&m({error:Error("chip manager not inited")}):m&&m({error:Error("device is null")})};a.prototype.setConfig=function(a,m,g){a?a.gateway&&"mediola"!=a.gateway.uuid?g&&g({error:Error("not supported yet")}):
this._chipManager?this._chipManager.setConfig(a,m,function(a){g&&g({error:a})}):g&&g({error:Error("chip manager not inited")}):g&&g({error:Error("device is null")})};a.prototype.getMonitorStates=function(a){this._monitorManager.getMonitorStates(function(h,g){a&&a({error:h,data:g})})};a.prototype.getAllDevices=function(a){var h=[];try{this.getAllStates().forEach(function(a){a&&a.device&&a.states&&(a={type:"HM",address:a.device.toLegacyAdr(),data:a.device.toLegacyType(),snr:a.device.getSerial(),_ver:"v5+"},
h.push(a))})}catch(g){console.error(g.stack)}a&&a({data:h})};a.prototype.isWindowOpen=function(){try{for(var a=this.getAllStates(),m=0;m<a.length;m++){var g=a[m];if(g&&g.device&&g.states){var k=g.device.toLegacyType();if("window"==k){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("contact"==k){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("ip_contact"==k){if(g.states.state&&"closed"!=g.states.state.value)return!0}else if("ip_window"==k&&g.states.state&&"closed"!=
g.states.state.value)return!0}}}catch(l){return!1}};return a}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.hm.Handler);
