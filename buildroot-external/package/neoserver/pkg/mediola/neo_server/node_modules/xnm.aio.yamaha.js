var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.yamaha=xnm.aio.yamaha||{};
xnm.aio.yamaha.AVR=function(){var d=function(b,c,a,e,f){this._logger=require("x.logger.js").getLogger("xnm.aio.yamaha.AVR");this.ip=b;this.port=c;this.port||(this.port="80");this.uuid=a;this.name=e;this.model=f;this.timeout=3E3;this.CommandHandler=null};d.prototype.audioModes="2ch Stereo;5ch Stereo;Surround Decoder;Standard;Spectacle;Sci-Fi;Adventure;Drama;Mono Movie;Sports;Action Game;Roleplaying Game;Hall in Munich;Hall in Vienna;Chamber;Cellar Club;The Roxy Theatre;The Bottom Line;Music Video".split(";");d.prototype.videoModes=
"HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link".split(";");d.prototype.executeCommandCreator=function(b,c,a){if(c&&c.value)if("openNative"==c.value)window&&window.XC&&window.XC.callHost&&window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()?window.XC.callHost("SYSTEM","startApp",{scheme:"jp.co.yamaha.avkk.avcontroller://"}):"Android"==window.XCHost.getType()&&window.XC.callHost("SYSTEM",
"startApp",{scheme:"com.yamaha.av.avcontroller"})),a&&a();else{b="";c.path&&c.path[0]&&"global"!=c.path[0]&&(b=c.path[0]+":");var e=b+c.value;if("sleep"==c.value){if(!c.ext){a&&a(Error("command sleep ext format invalid"));return}e+=c.ext.replace(/min/g,"")}else if("setInput"==c.value){if(!c.ext){a&&a(Error("command setInput ext format invalid"));return}e=b+c.ext}else if("audioMode"==c.value){if(!c.ext){a&&a(Error("command audioMode ext format invalid"));return}e=b+c.ext}else if("setTo"==c.value){if(null==
c.ext||"undefined"==typeof c.ext){a&&a(Error("command setTo ext format invalid"));return}e+=c.ext}else if("dlgLevel"==c.value){if(null==c.ext||"undefined"==typeof c.ext){a&&a(Error("command dlgLevel ext format invalid"));return}e+=c.ext}else if("setVideoPreset"==c.value){if(null==c.ext||"undefined"==typeof c.ext){a&&a(Error("command setVideoPreset ext format invalid"));return}e+=c.ext}else if("customCMD"==c.value){if(!c.ext){a&&a(Error("command customCMD ext format invalid"));return}e=b+c.ext}if(c.path&&
c.path[0]&&"tuner"==c.path[0]&&(e=c.value,"tunerPreset"==c.value)){if(null==c.ext||"undefined"==typeof c.ext){a&&a(Error("command tunerPreset ext format invalid"));return}e="tuner"+c.ext}this.executeCommand(e,function(b){if(b)a&&a(b);else{if(c.path&&c.path[0]&&"mainzone"==c.path[0]){if("on"==c.value||"off"==c.value||"toggle"==c.value){setTimeout(function(){a&&a()},1E3);return}if("setTo"==c.value||"volumeUp"==c.value||"volumeDown"==c.value){setTimeout(function(){a&&a()},10);return}}a&&a()}})}else a&&
a(Error("command json format invalid"))};d.prototype.getStatesCreator=function(b,c,a){b=[];for(var e=0;e<c.length;e++)if(c[e]&&c[e].status&&c[e].status.path&&c[e].status.path[0]){var f=0;switch(c[e].status.path[0]){case "mainzone":f=1;break;case "zone2":f=2;break;case "zone3":f=3;break;case "zone4":f=4}f&&-1==b.indexOf(f)&&b.push(f)}this.getStates(b,function(b,e){for(var f=[],d=0;d<c.length;d++)if(c[d]&&c[d].id){var n="?";if(c[d].status&&c[d].status.value){var l="";c[d].status.path&&c[d].status.path[0]&&
"global"!=c[d].status.path[0]&&(l=c[d].status.path[0]);var p=c[d].status.value;e&&l&&e[l]&&e[l][p]&&(n=e[l][p])}f.push({id:c[d].id,status:n})}a&&a(null,f)})};d.prototype._doRequest=function(b,c,a){b='<?xml version="1.0" encoding="utf-8"?><YAMAHA_AV cmd="'+b+'">'+(c+"</YAMAHA_AV>");var e=this;c="http://"+this.ip+":"+this.port+"/YamahaRemoteControl/ctrl";this._logger.log("trace","send data:"+b);var f=a;$.ajax({url:c,type:"POST",timeout:this.timeout,data:b,dataType:"text",cache:!0,headers:{"Content-Length":b.length},
success:function(a){e._logger.log("trace","http request success:"+a);f&&(f(null,a),f=null)},error:function(a,b){var c="http request error:"+(a?a.status:"0")+"-"+b;e._logger.log("trace",c);f&&(f(Error(c)),f=null)}})};d.prototype._getStateValue=function(b,c,a){var e=null;b=b.find(c);0<b.length&&(e=$(b[0]).text());e&&a&&(e=e.toLowerCase());return e};d.prototype._parseStates=function(b,c){var a={};a.power=this._getStateValue(b,"Power_Control Power",!0);"standby"==a.power&&(a.power="off");a.sleep=this._getStateValue(b,
"Power_Control Sleep",!0);a.mute=this._getStateValue(b,"Volume Mute",!0);var e=this._getStateValue(b,"Volume Lvl Val");a.volume=e?(parseFloat(e)/10).toFixed(1):null;a.input=this._getStateValue(b,"Input Input_Sel");"zone2"!=c&&"zone3"!=c&&"zone4"!=c&&(a.mode=this._getStateValue(b,"Surround Program_Sel Current Sound_Program"),a.enhancer=this._getStateValue(b,"Surround Program_Sel Current Enhancer",!0),a.straight=this._getStateValue(b,"Surround Program_Sel Current Straight",!0),a.direct=this._getStateValue(b,
"Sound_Video Pure_Direct Mode",!0),a.bass=this._getStateValue(b,"Sound_Video Extra_Bass",!0),"auto"==a.bass&&(a.bass="on"),a.ypao_volume=this._getStateValue(b,"Sound_Video YPAO_Volume",!0),"auto"==a.ypao_volume&&(a.ypao_volume="on"),a.dlgLevel=this._getStateValue(b,"Sound_Video Dialogue_Adjust Dialogue_Lvl"),a.videoPreset=this._getStateValue(b,"Sound_Video HDMI Video Preset_Sel Current",!0),a.videoPreset&&(a.videoPreset=a.videoPreset.replace("preset ","")));return a};d.prototype.getStates=function(b,
c){b&&0!=b.length||(b=[1]);var a={},e=0,f=this,d=function(h,g){var k=b[e];!h&&g&&(1==k?a.mainzone=g.mainzone:2==k?a.zone2=g.zone2:3==k?a.zone3=g.zone3:4==k&&(a.zone4=g.zone4));e++;e<b.length?f._getZoneStates(b[e],d):c&&c(null,a)};this._getZoneStates(b[e],d)};d.prototype._getZoneStates=function(b,c){var a=this,e,f;1==b?(e="Main_Zone",f="mainzone"):2==b?(e="Zone_2",f="zone2"):3==b?(e="Zone_3",f="zone3"):4==b&&(e="Zone_4",f="zone4");this._doRequest("GET","<"+e+"><Basic_Status>GetParam</Basic_Status></"+
e+">",function(b,e){if(b)c&&c(b);else try{var d=$($.parseXML(e));if(d){var k=d.find("Basic_Status");if(!k||0>=k.length)c&&c(Error(f+" status reponse has no basic status tag"));else{var n=$(k[0]),d={};d[f]=a._parseStates(n,f);c&&c(null,d)}}else c&&c(Error(f+" status reponse invalid"))}catch(l){c&&c(l)}})};d.prototype.executeCommand=function(b,c){var a=null,e=!0,f=null,a=b.indexOf(":");0<a&&(f=b.substr(0,a),b=b.substr(a+1));"on"==b?a="<Power_Control><Power>On</Power></Power_Control>":"off"==b||"standby"==
b?a="<Power_Control><Power>Standby</Power></Power_Control>":"toggle"==b?a="<Power_Control><Power>On/Standby</Power></Power_Control>":"mute"==b?a="<Volume><Mute>On</Mute></Volume>":"unmute"==b?a="<Volume><Mute>Off</Mute></Volume>":"toggleMute"==b?a="<Volume><Mute>On/Off</Mute></Volume>":"volumeDown"==b?a="<Volume><Lvl><Val>Down</Val><Exp></Exp><Unit></Unit></Lvl></Volume>":"volumeUp"==b?a="<Volume><Lvl><Val>Up</Val><Exp></Exp><Unit></Unit></Lvl></Volume>":"enhancerOn"==b?a="<Surround><Program_Sel><Current><Enhancer>On</Enhancer></Current></Program_Sel></Surround>":
"enhancerOff"==b?a="<Surround><Program_Sel><Current><Enhancer>Off</Enhancer></Current></Program_Sel></Surround>":"directOn"==b?a="<Sound_Video><Pure_Direct><Mode>On</Mode></Pure_Direct></Sound_Video>":"directOff"==b?a="<Sound_Video><Pure_Direct><Mode>Off</Mode></Pure_Direct></Sound_Video>":"extraBassOn"==b?a="<Sound_Video><Extra_Bass>Auto</Extra_Bass></Sound_Video>":"extraBassOff"==b?a="<Sound_Video><Extra_Bass>Off</Extra_Bass></Sound_Video>":"straightOn"==b?a="<Surround><Program_Sel><Current><Straight>On</Straight></Current></Program_Sel></Surround>":
"straightOff"==b?a="<Surround><Program_Sel><Current><Straight>Off</Straight></Current></Program_Sel></Surround>":"Scene1"==b?a="<Scene><Scene_Sel>Scene 1</Scene_Sel></Scene>":"Scene2"==b?a="<Scene><Scene_Sel>Scene 2</Scene_Sel></Scene>":"Scene3"==b?a="<Scene><Scene_Sel>Scene 3</Scene_Sel></Scene>":"Scene4"==b?a="<Scene><Scene_Sel>Scene 4</Scene_Sel></Scene>":"play"==b?a="<Play_Control><Playback>Play</Playback></Play_Control>":"pause"==b?a="<Play_Control><Playback>Pause</Playback></Play_Control>":
"stop"==b?a="<Play_Control><Playback>Stop</Playback></Play_Control>":"previous"==b?a="<Play_Control><Playback>Skip Rev</Playback></Play_Control>":"next"==b?a="<Play_Control><Playback>Skip Fwd</Playback></Play_Control>":"up"==b?a="<Cursor_Control><Cursor>Up</Cursor></Cursor_Control>":"down"==b?a="<Cursor_Control><Cursor>Down</Cursor></Cursor_Control>":"left"==b?a="<Cursor_Control><Cursor>Left</Cursor></Cursor_Control>":"right"==b?a="<Cursor_Control><Cursor>Right</Cursor></Cursor_Control>":"enter"==
b?a="<Cursor_Control><Cursor>Sel</Cursor></Cursor_Control>":"return"==b?a="<Cursor_Control><Cursor>Return</Cursor></Cursor_Control>":0==b.indexOf("sleep")?(b=b.replace(/sleep/g,"").toLowerCase(),a="off"==b?"<Power_Control><Sleep>Off</Sleep></Power_Control>":"<Power_Control><Sleep>"+b+" min</Sleep></Power_Control>"):0==b.indexOf("dlgLevel")?(b=b.replace(/dlgLevel/g,"").toLowerCase(),a="<Sound_Video><Dialogue_Adjust><Dialogue_Lvl>"+b+"</Dialogue_Lvl></Dialogue_Adjust></Sound_Video>"):0==b.indexOf("setVideoPreset")?
(b=b.replace(/setVideoPreset/g,"").toLowerCase(),f="system",a="<Sound_Video><HDMI><Video><Presetl_Sel><Current>"+b+"</Current></Presetl_Sel></Video></HDMI></Sound_Video>"):0==b.indexOf("tuner")?(e=!1,b=b.replace(/tuner/g,""),a="Up"==b?"<Tuner><Play_Control><Preset><Preset_Sel>Up</Preset_Sel></Preset></Play_Control></Tuner>":"Down"==b?"<Tuner><Play_Control><Preset><Preset_Sel>Down</Preset_Sel></Preset></Play_Control></Tuner>":"AM"==b?"<Tuner><Play_Control><Tuning><Band>AM</Band></Tuning></Play_Control></Tuner>":
"FM"==b?"<Tuner><Play_Control><Tuning><Band>FM</Band></Tuning></Play_Control></Tuner>":"<Tuner><Play_Control><Preset><Preset_Sel>"+b+"</Preset_Sel></Preset></Play_Control></Tuner>"):-1!=this.videoModes.indexOf(b)?a="<Input><Input_Sel>"+b+"</Input_Sel></Input>":-1!=this.audioModes.indexOf(b)?a="Straight"==b?"<Surround><Program_Sel><Current><Straight>On</Straight></Current></Program_Sel></Surround>":"<Surround><Program_Sel><Current><Sound_Program>"+b+"</Sound_Program></Current></Program_Sel></Surround>":
0==b.indexOf("setTo")||/^-?\d*\.{0,1}\d+$/.test(b)?(0==b.indexOf("setTo")&&(b=b.replace(/setTo/g,"")),b=b.replace(/%/g,""),a=Math.round(10*parseFloat(b)),-805>a?a=-805:165<a&&(a=165),a="<Volume><Lvl><Val>"+a+"</Val><Exp>1</Exp><Unit>dB</Unit></Lvl></Volume>"):(e=!1,a=b);e&&(a="system"==f?"<System>"+a+"</System>":"zone2"==f?"<Zone_2>"+a+"</Zone_2>":"zone3"==f?"<Zone_3>"+a+"</Zone_3>":"zone2"==f?"<Zone_4>"+a+"</Zone_4>":"<Main_Zone>"+a+"</Main_Zone>");this._doRequest("PUT",a,c)};d.prototype.getStateValues=
function(b,c){return c};d.prototype.toJSON=function(){var b={sys:xnm.aio.yamaha.DM.SYS,type:"avr",ip:this.ip,port:this.port,uuid:this.uuid,model:this.model};this.name&&(b.name=this.name);return b};d.prototype.equalsTo=function(b){return b&&b instanceof d?this.ip==b.ip&&this.port==b.port:!1};d.DEVICE_1_ZONE="RX-V477 RX-V475 RX-V500D RX-V473 HTR-4067 HTR-5066 HTR-4066 HTR-5065 HTR-4065".split(" ");d.DEVICE_2_ZONE="RX-S600D RX-S600 RX-A1040 RX-A840 RX-A740 RX-A1030 RX-A830 RX-A730 RX-A1020 RX-A820 RX-A720 RX-A1010 RX-A810 RX-A710 RX-A1000 RX-V1077 RX-V777 RX-V677 RX-V577 RX-V1075 RX-V775 RX-V675 RX-V575 RX-V1073 RX-V773 RX-V673 RX-V573 RX-V1071 RX-V871 RX-V771 RX-V671 RX-V1067 RX-V867 HTR-6067 HTR-5067 HTR-6066 TSR-6750 HTR-7065 HTR-6065 HTR-6064 HTR-9063 HTR-8063".split(" ");
d.DEVICE_3_ZONE="RX-A2020 RX-A2010 RX-A2000 RX-V2073 RX-V2071 RX-V2067 RX-V2065 RX-V3900 DSP-AX3900 HTR-6295".split(" ");d.DEVICE_4_ZONE="CX-A5000 RX-A3040 RX-A2040 RX-A3030 RX-A2030 RX-A3020 RX-A3010 RX-A3000 RX-V3077 RX-V2077 RX-V3075 RX-V2075 RX-V3073 RX-V3071 RX-V3067 RX-Z7 DSP-Z7".split(" ");d.parseJSON=function(b){return b.ip?new d(b.ip,b.port,b.uuid,b.name,b.model):null};d.getZoneCount=function(b){return b&&b.model?-1!=d.DEVICE_4_ZONE.indexOf(b.model)?4:-1!=d.DEVICE_3_ZONE.indexOf(b.model)?
3:-1!=d.DEVICE_2_ZONE.indexOf(b.model)?2:1:1};return d}();
xnm.aio.yamaha.DM=function(){var d=function(b,a){this.code=b;this.message=a;this.stack=Error().stack};d.prototype=Error();d.prototype.name="YamahaDMError";d.prototype.code=0;d.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var b={avr:{command:[{type:"root",name:"global",value:"global",children:[{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}},{type:"enum",name:"open yamaha AV Controller",ref:{value:"openNative"}}]},{type:"root",name:"tuner",
value:"tuner",children:[{type:"enum",name:"preset up",ref:{value:"tunerUp"}},{type:"enum",name:"preset down",ref:{value:"tunerDown"}},{type:"enum",name:"AM",ref:{value:"tunerAM"}},{type:"enum",name:"FM",ref:{value:"tunerFM"}},{type:"int",name:"set preset",ref:{value:"tunerPreset",ext:"%d",extMeta:"1-40",scale:"1"}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",
ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"enhancer on",ref:{value:"enhancerOn"}},{type:"enum",name:"enhancer off",ref:{value:"enhancerOff"}},{type:"enum",name:"direct on",ref:{value:"directOn"}},{type:"enum",name:"direct off",ref:{value:"directOff"}},{type:"enum",name:"extra bass on",ref:{value:"extraBassOn"}},{type:"enum",name:"extra bass off",ref:{value:"extraBassOff"}},
{type:"enum",name:"straight on",ref:{value:"straightOn"}},{type:"enum",name:"straight off",ref:{value:"straightOff"}},{type:"enum",name:"scene 1",ref:{value:"Scene1"}},{type:"enum",name:"scene 2",ref:{value:"Scene2"}},{type:"enum",name:"scene 3",ref:{value:"Scene3"}},{type:"enum",name:"scene 4",ref:{value:"Scene4"}},{type:"enum",name:"sleep",ref:{value:"sleep",ext:"%e",extMeta:["30min","60min","90min","120min","off"]}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link".split(";")}},
{type:"enum",name:"set dsp mode",ref:{value:"audioMode",ext:"%e",extMeta:"2ch Stereo;5ch Stereo;Surround Decoder;Standard;Spectacle;Sci-Fi;Adventure;Drama;Mono Movie;Sports;Action Game;Roleplaying Game;Hall in Munich;Hall in Vienna;Chamber;Cellar Club;The Roxy Theatre;The Bottom Line;Music Video".split(";")}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",unit:"db",ext:"%f",extMeta:"-80.5-16.5",
scale:"0.5"}},{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"up",ref:{value:"up"}},{type:"enum",name:"down",ref:{value:"down"}},{type:"enum",name:"left",ref:{value:"left"}},{type:"enum",name:"right",ref:{value:"right"}},{type:"enum",name:"enter",ref:{value:"enter"}},{type:"enum",name:"return",
ref:{value:"return"}}]}],status:[{type:"root",name:"main zone",value:"mainzone",children:[{type:"float",name:"volume",ref:{value:"volume",unit:"db",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"enum",name:"sleep",ref:{value:"sleep",options:["30min","60min","90min","120min","off"]}},{type:"enum",name:"input",ref:{value:"input",options:"HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link".split(";")}},
{type:"enum",name:"dsp mode",ref:{value:"mode",options:"2ch Stereo;5ch Stereo;Surround Decoder;Standard;Spectacle;Sci-Fi;Adventure;Drama;Mono Movie;Sports;Action Game;Roleplaying Game;Hall in Munich;Hall in Vienna;Chamber;Cellar Club;The Roxy Theatre;The Bottom Line;Music Video;Straight".split(";")}},{type:"enum",name:"enhancer",ref:{value:"enhancer",options:["on","off"]}},{type:"enum",name:"straight",ref:{value:"straight",options:["on","off"]}},{type:"enum",name:"extra bass",ref:{value:"bass",options:["on",
"off"]}},{type:"enum",name:"direct",ref:{value:"direct",options:["on","off"]}}]}]},avr_zone_template:{command:[{type:"root",name:"@zone N",value:"zoneN",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"sleep",ref:{value:"sleep",
ext:"%e",extMeta:["30min","60min","90min","120min","off"]}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link".split(";")}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",unit:"db",ext:"%f",extMeta:"-80.5-16.5",
scale:"0.5"}},{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"up",ref:{value:"up"}},{type:"enum",name:"down",ref:{value:"down"}},{type:"enum",name:"left",ref:{value:"left"}},{type:"enum",name:"right",ref:{value:"right"}},{type:"enum",name:"enter",ref:{value:"enter"}},{type:"enum",name:"return",
ref:{value:"return"}}]}],status:[{type:"root",name:"zone N",value:"zoneN",children:[{type:"float",name:"volume",ref:{value:"volume",unit:"db",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"enum",name:"sleep",ref:{value:"sleep",options:["30min","60min","90min","120min","off"]}},{type:"enum",name:"input",ref:{value:"input",options:"HDMI1;HDMI2;HDMI3;HDMI4;HDMI5;HDMI6;AUDIO1;AUDIO2;AV1;AV2;AV3;AV4;AV5;AV6;TUNER;USB;NET RADIO;Bluetooth;AUX;V-AUX;NET;SERVER;AirPlay;JUKE;Spotify;MusicCast Link".split(";")}}]}]},
"avr_RX-A3040":{command:[{type:"root",name:"main zone",value:"mainzone",children:[{type:"int",name:"dialogue level",ref:{value:"dlgLevel",ext:"%d",extMeta:"0-3"}},{type:"enum",name:"set HDMI video preset",ref:{value:"setVideoPreset",ext:"%e",extMeta:"123456".split("")}}]}],status:[{type:"root",name:"main zone",value:"mainzone",children:[{type:"int",name:"dialogue level",ref:{value:"dlgLevel",ext:"%d",extMeta:"0-3"}},{type:"enum",name:"HDMI video preset",ref:{value:"videoPreset",options:"123456".split("")}}]}]}};
return{SYS:"yamaha",getIPDeviceType:function(){return[{sys:this.SYS,name:"Yamaha AV Receiver",type:"avr"}]},createDevice:function(b,a,e){a=d.ERROR_CODE;b?b.ip?e(null,b):e(new d(a.INVALID,"ip is invalid")):e(new d(a.INVALID,"info is invalid"))},updateDevice:function(b,a,e){a=d.ERROR_CODE;b?b.ip?e(null,b):e(new d(a.INVALID,"ip is invalid")):e(new d(a.INVALID,"info is invalid"))},deleteDevice:function(b,a,e){e()},applyUIFilter:function(b,a,e){var f=function(a,b,c){var e=[];a.forEach(function(a){if("root"==
a.type){a=JSON.parse(JSON.stringify(a));var d=f(a.children,b,c);d&&0<d.length&&(a.children=d,e.push(a))}else{d=c.elems;if("*"==d)d=!0;else{for(var h=!1,g=0;g<d.length;g++)if(d[g]==a.type){h=!0;break}d=h}d&&(a=JSON.parse(JSON.stringify(a)),e.push(a))}});return e},d=function(a,b){var c=[],d=xnm.aio.yamaha.DM.getCommandStatusMap(a,e);if(d){var h=[];switch(b.catagory){case "command":d.command&&(h=f(d.command,a,b));break;case "status":d.status&&(h=f(d.status,a,b))}c=c.concat(h)}return c};if(!b.sys)return null;
var h=JSON.parse(JSON.stringify(b)),g=null;switch(a.catagory){case "command":g=d(b,a);h.command=g;break;case "status":g=d(b,a);h.status=g;break;default:return null}return g&&0!=g.length?h:null},getCommandStatusMap:function(c){if(!c||!c.type)return null;var a=b[c.type];if(!a)return null;var a=JSON.parse(JSON.stringify(a)),e=xnm.aio.yamaha.AVR.getZoneCount(c);if(1<e)for(var d=2;d<=e;d++){var m=JSON.parse(JSON.stringify(b.avr_zone_template));m.command[0].name="zone "+d;m.command[0].value="zone"+d;m.status[0].name=
"zone "+d;m.status[0].value="zone"+d;a.command=a.command.concat(m.command);a.status=a.status.concat(m.status)}c.model&&b[c.type+"_"+c.model]&&((c=b[c.type+"_"+c.model])&&(c=JSON.parse(JSON.stringify(c))),c&&c.command&&c.command.forEach(function(b){if(b&&"root"==b.type){var c;a:{if((c=b.value)&&a&&a.command)for(var e=0;e<a.command.length;e++)if(a.command[e]&&"root"==a.command[e].type&&a.command[e].value==c){c=a.command[e];break a}c=null}c?(c.children||(c.children=[]),c.children=c.children.concat(b.children)):
a.command.push(b)}else a.command.push(b)}),c&&c.status&&c.status.forEach(function(b){if(b&&"root"==b.type){var c;a:{if((c=b.value)&&a&&a.status)for(var e=0;e<a.status.length;e++)if(a.status[e]&&"root"==a.status[e].type&&a.status[e].value==c){c=a.status[e];break a}c=null}c?(c.children||(c.children=[]),c.children=c.children.concat(b.children)):a.status.push(b)}else a.status.push(b)}));return a}}}();
xnm.aio.yamaha.Handler=function(){var d=function(){this.detectedAVRs={}};d.prototype.devicemanager=xnm.aio.yamaha.DM;d.prototype.AVR=xnm.aio.yamaha.AVR;d.prototype.registModule=function(b){b.register(this.devicemanager.SYS,"yamaha")};d.prototype.resolveDevice=function(b){if(!b)return null;switch(b.type){case "avr":return xnm.aio.yamaha.AVR.parseJSON(b);default:return null}};d.prototype.getDeviceCommands=function(b,c){var a=this.devicemanager.applyUIFilter(b,{catagory:"command",elems:"*"}),a=a?a.command:
[];c&&c(null,a)};d.prototype.getDeviceStatus=function(b,c){var a=this.devicemanager.applyUIFilter(b,{catagory:"status",elems:"*"}),a=a?a.status:[];c&&c(null,a)};d.prototype.doCommand=function(b,c,a){var e=this.resolveDevice(b);e?e.executeCommandCreator(b,c,function(b){a&&a(b)}):a&&a(Error("device json format invalid"))};d.prototype.doStatus=function(b,c,a,e){var d=this.resolveDevice(c);d?d.getStatesCreator(null,[{id:b,device:c,status:a}],function(b,a){b?e&&e(b):e&&e(null,a[0])}):e&&e(Error("device json format invalid"))};
d.prototype.discoverDevices=function(b){var c=function(b){if(!b)return b;var a,c=null;for(a=0;a<xnm.aio.yamaha.AVR.DEVICE_1_ZONE.length;a++)if(c=xnm.aio.yamaha.AVR.DEVICE_1_ZONE[a],-1!=b.indexOf(c))return c;for(a=0;a<xnm.aio.yamaha.AVR.DEVICE_2_ZONE.length;a++)if(c=xnm.aio.yamaha.AVR.DEVICE_2_ZONE[a],-1!=b.indexOf(c))return c;for(a=0;a<xnm.aio.yamaha.AVR.DEVICE_3_ZONE.length;a++)if(c=xnm.aio.yamaha.AVR.DEVICE_3_ZONE[a],-1!=b.indexOf(c))return c;for(a=0;a<xnm.aio.yamaha.AVR.DEVICE_4_ZONE.length;a++)if(c=
xnm.aio.yamaha.AVR.DEVICE_4_ZONE[a],-1!=b.indexOf(c))return c;return b},a=require("x.upnp.js");if(a){var e=this;a.discoverDevicesWithTimeout(3E3,function(a){if(a.manufacturer&&0==a.manufacturer.indexOf("Yamaha")&&"AV Receiver"==a.modelDescription){var d=c(a.modelName),d=new xnm.aio.yamaha.AVR(a.ip,80,a.uuid,a.name,d);e.detectedAVRs["uuid:"+a.uuid]||(e.detectedAVRs["uuid:"+a.uuid]=d);b(d)}})}};d.prototype.discoverWithTimeout=function(b,c){var a={};this.discoverDevices(function(b){b&&b.uuid&&!a[b.uuid]&&
(a[b.uuid]=b)});setTimeout(function(){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(a[d]);c&&c(null,b)},b)};d.prototype.getStateValues=function(b,c){return(new xnm.aio.yamaha.AVR).getStateValues(b.type,c)};d.prototype.getDeviceCommandList=function(b,c,a){return[]};return d}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.yamaha.Handler);
