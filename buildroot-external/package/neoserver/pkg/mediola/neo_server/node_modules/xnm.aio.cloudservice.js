var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(g,b,c){if(null==g)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return g+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,b,c){if(g==Array.prototype||g==Object.prototype)return g;g[b]=c.value;return g};
$jscomp.getGlobal=function(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<g.length;++b){var c=g[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(g,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return g[b];c=g[c];return void 0!==c?c:g[b]};$jscomp.polyfill=function(g,b,c,f){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(g,b,c,f):$jscomp.polyfillUnisolated(g,b,c,f))};
$jscomp.polyfillUnisolated=function(g,b,c,f){c=$jscomp.global;g=g.split(".");for(f=0;f<g.length-1;f++){var a=g[f];if(!(a in c))return;c=c[a]}g=g[g.length-1];f=c[g];b=b(f);b!=f&&null!=b&&$jscomp.defineProperty(c,g,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(g,b,c,f){var a=g.split(".");g=1===a.length;f=a[0];f=!g&&f in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var d=0;d<a.length-1;d++){var k=a[d];if(!(k in f))return;f=f[k]}a=a[a.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?f[a]:null;b=b(c);null!=b&&(g?$jscomp.defineProperty($jscomp.polyfills,a,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[a]&&($jscomp.propertyToPolyfillSymbol[a]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(a):
$jscomp.POLYFILL_PREFIX+a),$jscomp.defineProperty(f,$jscomp.propertyToPolyfillSymbol[a],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("String.prototype.startsWith",function(g){return g?g:function(b,c){var f=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var a=f.length,d=b.length;c=Math.max(0,Math.min(c|0,f.length));for(var k=0;k<d&&c<a;)if(f[c++]!=b[k++])return!1;return k>=d}},"es6","es3");
$jscomp.arrayIteratorImpl=function(g){var b=0;return function(){return b<g.length?{done:!1,value:g[b++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(g){if(g)return g;var b=function(a,d){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:d})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,f=function(a){if(this instanceof f)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(a||"")+"_"+c++,a)};return f},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(g){if(g)return g;g=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var f=$jscomp.global[b[c]];"function"===typeof f&&"function"!=typeof f.prototype[g]&&$jscomp.defineProperty(f.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return g},"es6",
"es3");$jscomp.iteratorPrototype=function(g){g={next:g};g[Symbol.iterator]=function(){return this};return g};$jscomp.iteratorFromArray=function(g,b){g instanceof String&&(g+="");var c=0,f=!1,a={next:function(){if(!f&&c<g.length){var d=c++;return{value:b(d,g[d]),done:!1}}f=!0;return{done:!0,value:void 0}}};a[Symbol.iterator]=function(){return a};return a};$jscomp.polyfill("Array.prototype.keys",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.cloudservice=xnm.aio.cloudservice||{};
xnm.aio.cloudservice.Ivideon=function(){var g=function(b,c,f,a){this._connectionID=b;this._camID=c;this._cloudService=f;this._format=a;this._jpegCam=null};g.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._camID};g.prototype.getLivePreview=function(b){var c=this.getBaseURL()+"/live_preview";this._cloudService.doEAPIRequest("ivideon","GET",c,null,null,function(f,a){b&&b(f,a)})};g.prototype.getLiveStream=function(b,c){var f=this.getBaseURL()+"/live_stream";b||(b={});b.format||
(b.format="hls");"string"!==typeof b.q&&"number"!==typeof b.q&&(b.q=1);this._cloudService.doEAPIRequest("ivideon","GET",f,b,null,function(a,d){c&&c(a,d)})};g.prototype.getArchiveStream=function(b,c){var f=this.getBaseURL()+"/record_stream";b||(b={});b.format||(b.format="hls");"string"!==typeof b.q&&"number"!==typeof b.q&&(b.q=1);this._cloudService.doEAPIRequest("ivideon","GET",f,b,null,function(a,d){if(a)c(a,d);else{var k=null;d&&"object"===typeof d&&(k=d.url);if("string"!==typeof k||0===k.length)a=
Error("Result did not contain an URL or it was an empty string: "+k);c(a,k)}})};g.prototype.getEvents=function(b,c){var f=this.getBaseURL()+"/events";b||(b={});b.limit||(b.limit=20);this._cloudService.doEAPIRequest("ivideon","POST",f,null,b,function(a,d){c&&c(a,d)})};g.prototype.getRecords=function(b,c){var f=this.getBaseURL()+"/records";this._cloudService.doEAPIRequest("ivideon","GET",f,b,null,function(a,d){c&&c(a,d)})};g.prototype.loadImage=function(b,c){var f=this;this._jpegCam?this._jpegCam.loadImage(function(a,
d){a?b&&b(a):a||!d||401!=d.statusCode||c?b&&b():(f._jpegCam=null,f.loadImage(b,!0))}):this.getLivePreview(function(a,d){!a&&d&&d.url&&d.token?(a="https://"+d.host+"/cameras/"+f._camID+"/live_preview",f._jpegCam=require("xnm.aio.cams.js").createJPEGCam(a,{headers:{Authorization:"Bearer "+d.token},imageName:f._camID+".jpg"}),f.loadImage(b,!0)):b&&b()})};g.parseJSON=function(b,c){return b&&b.connection&&b.id?new g(b.connection,b.id,c,b.format):null};return g}();
xnm.aio.cloudservice.Ring=function(){var g=function(b,c,f){this._connectionID=b;this._deviceID=c;this._cloudService=f;this._last_file_path=this._last_timestap=null};g.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._deviceID};g.prototype.getLastSnapshot=function(b){var c=this.getBaseURL()+"/last_snapshot";this._cloudService.doEAPIRequest("ring","GET",c,null,null,function(f,a){b&&b(f,a)})};g.prototype.getEvents=function(b,c){var f=this.getBaseURL()+"/history";b||(b={});
b.limit||(b.limit=20);this._cloudService.doEAPIRequest("ring","GET",f,b,null,function(a,d){c&&c(a,d)})};g.prototype.getRecordStream=function(b,c){var f=this.getBaseURL()+"/record_stream";b||(b={});b.eventID?this._cloudService.doEAPIRequest("ring","GET",f,b,null,function(a,d){if(a)c(a,d);else{var k=null;d&&"object"===typeof d&&(k=d.url);if("string"!==typeof k||0===k.length)a=Error("Result did not contain an URL or it was an empty string: "+k);c(a,k)}}):c(Error("no eventID"))};g.prototype.loadImage=
function(b,c){var f=this;c=new Date;!this._last_timestap||6E4<=c-this._last_timestap?(this._last_file_path=this._last_timestap=null,this.getLastSnapshot(function(a,d){!a&&d&&d.url&&d.timestamp&&d.access_token?(f._last_timestap=d.timestamp,require("xnm.aio.cams.js").createJPEGCam(d.url,{headers:{Authorization:"Bearer "+d.access_token}}).loadImage(function(k,l){k?(f._last_file_path=k,b&&b(k,d.timestamp)):(f._last_timestap=null,b&&b())})):b&&b()})):b&&b(this._last_file_path,this._last_timestap)};return{parseJSON:function(b,
c){return b&&b.type&&b.connection&&b.id?"doorbell"==b.type?new g(b.connection,b.id,c,b.format):null:null}}}();
xnm.aio.cloudservice.Bosch=function(){var g=function(b,c,f,a){this._connectionID=b;this._camID=c;this._cloudService=f;this._format=a;this._jpegCam=null};g.prototype.getBaseURL=function(){return"/devices/"+this._connectionID+"/"+this._camID};g.prototype.getStates=function(b){this._cloudService.doEAPIRequest("bosch","GET","/states/"+this._connectionID+"/"+this._camID,null,null,function(c,f){b&&b(c,f)})};g.prototype.getLivePreview=function(b,c){var f=this.getBaseURL()+"/live_preview";this._cloudService.doEAPIRequest("bosch",
"GET",f,b,null,function(a,d){c&&c(a,d)})};g.prototype.getLiveStream=function(b,c){var f=this.getBaseURL()+"/live_stream";b||(b={});b.endpoint||(b.endpoint="cloud");b.profile||(b.profile="hd");this._cloudService.doEAPIRequest("bosch","GET",f,b,null,function(a,d){c&&c(a,d)})};g.prototype.getEvents=function(b,c){var f=this.getBaseURL()+"/events";b||(b={});if("undefined"==typeof b.page||null==b.page)b.page=0;if("undefined"==typeof b.pageSize||null==b.pageSize)b.pageSize=10;var a={filter:{},paging:{page:b.page,
pageSize:b.pageSize}};b.eventType&&(a.filter.eventType=b.eventType);this._cloudService.doEAPIRequest("bosch","POST",f,null,a,function(d,k,l,m){c&&c(d,k,m?m["x-token"]:null)})};g.prototype.getWifiInfo=function(b){var c=this.getBaseURL()+"/wifi";this._cloudService.doEAPIRequest("bosch","GET",c,null,null,function(f,a){b&&b(f,a)})};g.prototype.loadImage=function(b,c){var f=this;this._jpegCam?this.getStates(function(a,d){!a&&d&&d.states?"on"!=d.states.state?(f._jpegCam=null,b&&b()):f._jpegCam.loadImage(function(k,
l){k?b&&b(k):k||!l||401!=l.statusCode||c?b&&b():(f._jpegCam=null,f.loadImage(b,!0))}):b&&b()}):this.getLivePreview({endpoint:"cloud"},function(a,d){if(!a&&d&&d.mediaUri){a=d.mediaUri;var k={headers:{},imageName:f._camID+".jpg"};d.accessCredentials&&d.accessCredentials.credentials&&(d=d.accessCredentials.credentials.split(":"),k.user=d[0],k.password=d[1]);f._jpegCam=require("xnm.aio.cams.js").createJPEGCam(a,k);f.loadImage(b,!0)}else b&&b()})};g.parseJSON=function(b,c){return b&&b.connection&&b.id?
new g(b.connection,b.id,c,b.format):null};return g}();xnm.aio.cloudservice.DoorBird=function(g,b,c,f){this._connectionID=g;this._camID=b;this._cloudService=c;this._camMAC=f;this._cacheID=g+":"+b+":"+f;g=xnm.aio.cloudservice.DoorBird;g._cacheImage[this._cacheID]=g._cacheImage[this._cacheID]||{last:0,url:null};this._jpegCam=null};xnm.aio.cloudservice.DoorBird._cacheImage={};
xnm.aio.cloudservice.DoorBird.prototype={getBaseURL:function(){return"/devices/"+this._connectionID+"/"+this._camID},getStates:function(g){this._cloudService.doEAPIRequest("doorbird","GET","/states/"+this._connectionID+"/"+this._camID,null,null,function(b,c){g&&g(b,c)})},getAppScheme:function(g){this._cloudService.doEAPIRequest("doorbird","POST","/command",null,{connection:this._connectionID,device:this._camID,command:"view_scheme",value:{}},function(b,c){"string"===typeof c&&(c={url:c});g&&g(b,c)})},
getLivePreview:function(g,b){var c=xnm.aio.cloudservice.DoorBird._cacheImage[this._cacheID];if(c&&c.url&&3E5>Date.now()-c.last)b&&b(null,{url:c.url});else{g||(g=null);var f=this;this._cloudService.doEAPIRequest("doorbird","POST","/command",g,{connection:this._connectionID,device:this._camID,command:"view_image",value:{}},function(a,d){"string"===typeof d&&(d={url:d});!a&&d&&d.url&&(c||(xnm.aio.cloudservice.DoorBird._cacheImage[f._cacheID]={},c=xnm.aio.cloudservice.DoorBird._cacheImage[f._cacheID]),
c.last=Date.now(),c.url=d.url);b&&b(a,d)})}},getLiveStream:function(g,b){g||(g=null);this._cloudService.doEAPIRequest("doorbird","POST","/command",g,{connection:this._connectionID,device:this._camID,command:"view_live",value:{}},function(c,f){"string"===typeof f&&(f={url:f});b&&b(c,f)})},loadImage:function(g,b){var c=this;this._cacheImage&&this._cacheImage.url&&3E5<=Date.now()-this._cacheImage.last&&(this._jpegCam=null);this._jpegCam?c._jpegCam.loadImage(function(f,a){f?g&&g(f):f||!a||401!=a.statusCode||
b?g&&g():(c._jpegCam=null,c.loadImage(g,!0))}):this.getLivePreview(null,function(f,a){!f&&a&&a.url?(f={headers:{},imageName:c._camID+".jpg"},c._jpegCam=require("xnm.aio.cams.js").createJPEGCam(a.url,f),c.loadImage(g,!0)):g&&g()})}};xnm.aio.cloudservice.DoorBird.parseJSON=function(g,b){if(!g||!g.connection||!g.id)return null;var c=null;g.data.metaData?c=g.data.metaData.mac:g.data.mac&&(c=g.data.mac);return new xnm.aio.cloudservice.DoorBird(g.connection,g.id,b,c)};
xnm.aio.cloudservice.CloudService=function(){var g=function(a){this._cloudservice=a};g.prototype.getRules=function(a){this._cloudservice._doJsonRequest("GET","/rules",null,null,a)};g.prototype.addRule=function(a,d){a?this._cloudservice._doJsonRequest("POST","/rules",null,a,d):d&&d(Error("rule is null"))};g.prototype.updateRule=function(a,d,k){a?d?this._cloudservice._doJsonRequest("POST","/rules/"+a,null,d,k):k&&k(Error("rule is null")):k&&k(Error("rule id is null"))};g.prototype.deleteRule=function(a,
d){a?this._cloudservice._doJsonRequest("POST","/rules/"+a,null,{},d):d&&d(Error("rule id is null"))};g.prototype.deleteRules=function(a,d){this._cloudservice._doJsonRequest("DELETE","/rules",a,null,d)};var b=function(a){this._cloudservice=a;this._version="v1"};b.prototype.disconenct=function(a,d,k){a?d?this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+a+"/disconnect",{id:d},null,function(l,m){k&&k(l,m)}):k&&k(Error("invalid connection id")):k&&k(Error("invalid module"))};b.prototype.getModuleConnectionInfo=
function(a,d,k){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+a+"/info/"+d,null,null,function(l,m){k(l,m)})};b.prototype.getModuleInfo=function(a,d){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+a+"/info",null,null,function(k,l){d(k,l)})};b.prototype.getModuleDevices=function(a,d){this._cloudservice._doJsonRequest("GET","/eapi/"+this._version+"/"+a+"/devices",null,null,function(k,l){d(k,l)})};b.prototype.getModuleStates=function(a,d){this._cloudservice._doJsonRequest("GET",
"/eapi/"+this._version+"/"+a+"/states",null,null,function(k,l){d(k,l)})};b.prototype.executeModuleCommand=function(a,d,k){this._cloudservice._doJsonRequest("POST","/eapi/"+this._version+"/"+a+"/command",null,d,function(l,m){k(l,m)})};b.prototype.doRequest=function(a,d,k,l,m,h){this._cloudservice._doJsonRequest(d,"/eapi/"+this._version+"/"+a+k,l,m,function(e,p,r,n){h(e,p,r,n)})};var c=function(a){this._cloudservice=a;this._version="v1"};c.prototype.getUserInfo=function(a){this._cloudservice._doJsonRequest("GET",
"/service/userInfo",null,null,function(d,k){a(d,k)})};c.prototype.getModulesInfo=function(a){var d="/service/moduleInfo";this._cloudservice._moduleFlags&&this._cloudservice._moduleFlags.bosch_enabled&&(d+="?bosch_enabled=true");this._cloudservice._doJsonRequest("GET",d,null,null,function(k,l){a(k,l)})};c.prototype.toCloudDevice=function(a,d){this._cloudservice._doJsonRequest("POST","/service/toCloudDevice",null,a,function(k,l){d(k,l)})};var f=function(a,d,k,l,m,h){this._logger=require("x.logger.js").getLogger("xnm.aio.cloudservice.CloudService");
this._ip=a;this._ip||(this._ip="cloud.mediola.com");this._port=d;this._port||(this._port=443);this._username=k;this._password=l;this._moduleInfo=m;this._moduleFlags=h||{};this._protocol="https";this._eapi=new b(this);this._ruleEngine=new g(this);this._service=new c(this)};f.prototype.getIP=function(){return this._ip};f.prototype.getPort=function(){return this._port};f.prototype.getUsername=function(){return this._password};f.prototype.getUserInfo=function(a){this._service.getUserInfo(a)};f.prototype.getModulesInfo=
function(a){this._service.getModulesInfo(a)};f.prototype.toCloudDevice=function(a,d){this._service.toCloudDevice(a,d)};f.prototype.doEAPIRequest=function(a,d,k,l,m,h){this._eapi.doRequest(a,d,k,l,m,h)};f.prototype.disconenct=function(a,d,k){this._eapi.disconenct(a,d,k)};f.prototype.getModuleConnectionInfo=function(a,d,k){this._eapi.getModuleConnectionInfo(a,d,k)};f.prototype.getModuleInfo=function(a,d){this._eapi.getModuleInfo(a,d)};f.prototype.getModuleDevices=function(a,d){this._eapi.getModuleDevices(a,
d)};f.prototype.getModuleStates=function(a,d){this._eapi.getModuleStates(a,d)};f.prototype.executeModuleCommand=function(a,d,k){this._eapi.executeModuleCommand(a,d,k)};f.prototype.getRules=function(a){this._ruleEngine.getRules(a)};f.prototype.addRule=function(a,d){this._ruleEngine.addRule(a,d)};f.prototype.updateRule=function(a,d,k){this._ruleEngine.updateRule(a,d,k)};f.prototype.deleteRule=function(a,d){this._ruleEngine.deleteRule(a,d)};f.prototype.deleteRules=function(a,d){this._ruleEngine.deleteRules(a,
d)};f.prototype.getAccessToken=function(a,d,k){a={sid:a};d&&(a.force=1);this._doJsonRequest("GET","/getAccessToken",a,null,function(l,m){l?k&&k(l):m?k&&k(null,m.at):k&&k(Error("invalid response"))})};f.prototype.executeCommandCreator=function(a,d,k){if(a&&a.module&&a.connection&&a.id)if(d&&d.value){var l={connection:a.connection,device:a.id,command:d.value};if("undefined"!=typeof d.ext&&null!=d.ext)if(Array.isArray(d.ext)){var m={};d.ext.forEach(function(h){h&&h.value&&(m[h.value]=h.ext)});l.value=
m}else l.value=d.ext;this.executeModuleCommand(a.module,l,function(h){k&&k(h)})}else k&&k(Error("command json invalid"));else k&&k(Error("device json invalid"))};f.prototype.getStatesCreator=function(a,d,k){var l=this;a=function(n,q){l.getModuleStates(n,function(u,v){q(u,v,n)})};var m=[],h=0;for(h=0;h<d.length;h++){var e=d[h];e&&e.device&&e.device.module&&-1==m.indexOf(e.device.module)&&m.push(e.device.module)}if(0==m.length)k&&k(null,[]);else{var p=0,r=[];for(h=0;h<m.length;h++)a(m[h],function(n,
q,u){p++;var v=[];if(!n&&q)for(var x=0;x<d.length;x++){var t=d[x];if(t&&t.id&&t.device&&t.device.module==u){var w=null;if(t.device&&t.device.connection&&t.device.id&&t.status&&t.status.value){var y=q[t.device.connection];y&&y[t.device.id]&&(y=y[t.device.id].states)&&(w=y[t.status.value])}if("undefined"==typeof w||null==w)w="?";r.push({id:t.id,status:w});v.push({id:t.id,status:w})}}"undefined"!=typeof commandhandler&&null!=commandhandler&&"undefined"!=typeof commandhandler.reportStates&&null!=commandhandler.reportStates&&
!n&&v&&0<v.length&&commandhandler.reportStates(null,v);p==m.length&&k&&k(null,r)})}};f.prototype.getDeviceList=function(a,d){this.getModuleDevices(a,function(k,l){if(k)d(k);else{k=[];if(l)for(var m in l){var h=l[m],e;for(e in h){var p=h[e];p&&(p.sys="cloudservice",p.module=a,p.connection=m,p.id=e,k.push(p))}}d(null,k)}})};f.prototype._doJsonRequest=function(a,d,k,l,m){var h=null;l&&(h=JSON.stringify(l));this._doRequest(a,d,k,h,function(e,p,r,n){e?m&&m(e):p?p.XC_ERR?(e=Error("error response:"+p.XC_ERR.msg),
e.code=p.XC_ERR.code,m&&m(e)):p.XC_SUC?m&&m(null,p.XC_SUC,r,n):m&&m(Error("unknown response")):m&&m(Error("invalid response"))})};f.prototype._resolveServerIP=function(a){if("/eapi/"==a.substr(0,6)&&(a=a.split("/")[3])&&this._moduleInfo&&this._moduleInfo[a]&&this._moduleInfo[a].domain){a=this._moduleInfo[a].domain;var d=a.indexOf(":");return-1!=d?a.substr(0,d):a}return this._ip};f.prototype._resolveServerPort=function(a){if("/eapi/"==a.substr(0,6)&&(a=a.split("/")[3])&&this._moduleInfo&&this._moduleInfo[a]&&
this._moduleInfo[a].domain){a=this._moduleInfo[a].domain;var d=a.indexOf(":");return-1!=d?parseInt(a.substr(d+1)):443}return this._port};f.prototype._doRequest=function(a,d,k,l,m){var h=d;h||(h="/");var e={};k&&(e=JSON.parse(JSON.stringify(k)));k="";for(var p in e)e.hasOwnProperty(p)&&(k&&(k+="&"),k+=p+"="+encodeURIComponent(e[p]));k&&(h+="?"+k);a={host:this._resolveServerIP(d),port:this._resolveServerPort(d),path:h,method:a,headers:{Connection:"close","Content-Type":"application/json; charset=UTF-8"}};
if(this._username||this._password)a.auth=(this._username?this._username:"")+":"+(this._password?this._password:""),a.headers.Authorization="Basic "+(new Buffer((this._username?this._username:"")+":"+(this._password?this._password:""))).toString("base64");h=require(this._protocol);"https"==this._protocol&&"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0");e=JSON.parse(JSON.stringify(a));e.headers&&(e.headers.auth&&(e.headers.auth="*********"),e.headers.Authorization&&
(e.headers.Authorization="*********"));e.auth&&(e.auth="********");this._logger.log("trace","do request:"+JSON.stringify(e));var r=this,n=m,q=h.request(a,function(u){u.setEncoding("utf-8");var v="";u.on("data",function(x){v+=x});u.on("end",function(){r._logger.log("trace","receive code:"+u.statusCode+" headers:"+JSON.stringify(u.headers)+" response:"+v);if(200==u.statusCode)try{var x=v?JSON.parse(v):null}catch(w){var t=w}else t=Error("http reponse:"+u.statusCode);n&&(n(t,x,u.statusCode,u.headers),
n=null)})});if(q.on)q.on("error",function(u){r._logger.log("trace","do request error:"+u.message);n&&(n(u),n=null)});if(q.setTimeout){m=3E4;if(d.startsWith("/service/userInfo")||d.startsWith("/service/moduleInfo"))m=12E4;q.setTimeout(m,function(){r._logger.log("trace","do request timeout");q.abort();n&&(n(Error("timeout")),n=null)})}l&&(this._logger.log("trace","do request send body:"+l),q.write(l));q.end()};f.prototype.toJSON=function(){return{sys:"cloudservice",username:this._username,password:this._password,
ip:this._ip,port:this._port}};f.prototype.equalsTo=function(a){return a&&a instanceof f?this._ip==a._ip&&this._port==a._port&&this._username==a._username&&this._password==a._password:!1};f.parseJSON=function(a){return a&&a.username&&a.password?new f(a.ip,a.port,a.username,a.password,a.moduleInfo,{bosch_enabled:a.bosch_enabled}):null};return f}();
xnm.aio.cloudservice.DM=function(){var g=function(b,c){this.code=b;this.message=c;this.stack=Error().stack};g.prototype=Error();g.prototype.name="cloudserviceDMError";g.prototype.code=0;g.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"cloudservice",getGatewayType:function(){return[{sys:this.SYS,name:"Cloud Service"}]},createGateway:function(b,c,f){c=g.ERROR_CODE;b?b.username?b.password?f(null,b):f(new g(c.INVALID,"password is invalid")):f(new g(c.INVALID,
"username is invalid")):f(new g(c.INVALID,"info is invalid"))},updateGateway:function(b,c,f,a){b=g.ERROR_CODE;c?c.username?c.password?a(null,c):a(new g(b.INVALID,"password is invalid")):a(new g(b.INVALID,"username is invalid")):a(new g(b.INVALID,"update is invalid"))},deleteGateway:function(b,c,f){f()},createDevice:function(b,c,f){var a=g.ERROR_CODE;if(b)if(b.connection)if(b.id)if(b.gateway){c=c.data.gateways;var d;for(d=0;d<c.length;d++)if(c[d].index===b.gateway){var k=c[d];break}k?f&&f(null,b):
f(new g(a.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else f(new g(a.INVALID,"gateway is invalid"));else f(new g(a.INVALID,"id is invalid"));else f(new g(a.INVALID,"connection is invalid"));else f(new g(a.INVALID,"info is invalid"))},updateDevice:function(b,c,f){var a=g.ERROR_CODE;if(b)if(b.connection)if(b.id)if(b.gateway){c=c.data.gateways;var d;for(d=0;d<c.length;d++)if(c[d].index===b.gateway){var k=c[d];break}k?f(null,b):f(new g(a.NOT_FOUND,"gateway with index "+b.gateway+" not exists"))}else f(new g(a.INVALID,
"gateway is invalid"));else f(new g(a.INVALID,"id is invalid"));else f(new g(a.INVALID,"connection is invalid"));else f(new g(a.INVALID,"info is invalid"))},deleteDevice:function(b,c,f){f()},applyUIFilter:function(b,c,f){var a=this,d=function(e,p){if("*"==e)return!0;for(var r=!1,n=0;n<e.length;n++)if(e[n]==p){r=!0;break}return r},k=function(e,p,r){var n=[];"command"==r.catagory?e.command&&e.command.forEach(function(q){d(r.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),n.push(q))}):"status"==r.catagory?
e.status&&e.status.forEach(function(q){d(r.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),n.push(q))}):"ipevt"==r.catagory&&e.ipevt&&e.ipevt.forEach(function(q){d(r.elems,q.type)&&(q=JSON.parse(JSON.stringify(q)),n.push(q))});return n},l=function(e,p){var r=[],n=a.getCommandStatusMap(e,f);n&&(e=k(n,e,p),r=r.concat(e));return r};if(!b.sys)return null;var m=JSON.parse(JSON.stringify(b)),h=null;if("command"==c.catagory)h=l(b,c),m.command=h;else if("status"==c.catagory)h=l(b,c),m.status=h;else if("ipevt"==
c.catagory)h=l(b,c),m.ipevt=h;else return null;return h&&0!=h.length?m:null},applyIPEventFilter:function(b){return b?this.applyUIFilter(b,{catagory:"ipevt",elems:"*"}):null},getCommandStatusMap:function(b,c){var f=function(l,m){var h=null;if(m.values)if(Array.isArray(m.values))h={type:"enum",name:l,ref:{value:l,ext:"%e",extMeta:m.values}};else{if(0<Object.keys(m.values).length){h={type:"multi",name:l,ref:{value:l,ext:"%multi",extMeta:[]}};for(var e in m.values)(l=f(e,m.values[e]))&&h.ref.extMeta.push(l)}}else if(m.value){switch(m.value.type){case "FLOAT":h=
{type:"float",name:l,ref:{value:l,ext:"%f"}};break;case "RGB":h={type:"rgb",name:l,ref:{value:l,ext:"%rgb"}};break;case "RGBW":h={type:"rgbw",name:l,ref:{value:l,ext:"%rgbw"}};break;case "STRING":h={type:"string",name:l,ref:{value:l,ext:"%s"}};break;case "TIME":h={type:"time",name:l,ref:{value:l,ext:"%time"}};break;default:h={type:"int",name:l,ref:{value:l,ext:"%d"}}}void 0!=m.value.min&&null!=m.value.min&&void 0!=m.value.max&&null!=m.value.max&&h&&(h.ref.extMeta=m.value.min+"-"+m.value.max);void 0!=
m.value.step&&null!=m.value.step&&h&&(h.ref.scale=m.value.step)}else h={type:"enum",name:l,ref:{value:l}};return h};if(!b)return null;c={command:[],status:[]};var a;if(b.commands)for(a in c.command=[],b.commands){var d=b.commands[a];var k=null;"homematic"==b.module&&"eco"==a?(d=JSON.parse(JSON.stringify(d)),delete d.values.duration,k=f(a,d)):"bosch"==b.module&&"off"==a?(d=JSON.parse(JSON.stringify(d)),d.value&&(d.value.type="INT",d.value.min=0),k=f(a,d)):"doorbird"===b.module?"view_image"!==a&&"view_live"!==
a&&(k=f(a,d),"view_scheme"===a&&(k.name="view_scheme_doorbird")):k=f(a,d);k&&c.command.push(k)}if(b.states)for(a in c.status=[],c.ipevt=[],b.states)if(d=b.states[a],d.values)0!=d.state&&c.status.push({type:"enum",name:a,ref:{value:a,options:d.values}}),0!=d.event&&c.ipevt.push({type:"enum",name:a,ref:{value:a,options:d.values}});else{k=null;switch(d.type){case "BOOL":k={type:"enum",name:a,ref:{value:a,options:["true","false"]}};break;case "FLOAT":k={type:"float",name:a,ref:{value:a}};break;case "RGB":k=
{type:"rgb",name:a,ref:{value:a}};break;case "RGBW":k={type:"rgbw",name:a,ref:{value:a}};break;case "STRING":k={type:"string",name:a,ref:{value:a}};break;case "TIME":k={type:"int",name:a,ref:{value:a}};break;default:k={type:"int",name:a,ref:{value:a}}}void 0!=d.min&&null!=d.min&&void 0!=d.max&&null!=d.max&&k&&(k.ref.extMeta=d.min+"-"+d.max);void 0!=d.step&&null!=d.step&&k&&(k.ref.scale=d.step);k&&(0!=d.state&&c.status.push(k),0!=d.event&&c.ipevt.push(k))}return c},toGeneralDevice:function(b,c,f){if(!b||
!b.module)return null;c=null;switch(b.module){case "hue":case "lightify":c={type:"dimmer",commands:{},states:{},details:{commands:{},states:{}}};var a;if(b.commands)for(a in b.commands)switch(a){case "on":case "off":case "toggle":case "up":case "down":c.commands[a]={};c.details.commands[a]={value:a};break;case "brightness":case "colorTemperature":c.commands[a]={value:{type:"INT"}};c.details.commands[a]={value:a,ext:"%d"};b.commands[a]&&b.commands[a].value&&(f=b.commands[a].value,isNaN(f.min)||isNaN(f.max)||
(c.commands[a].value.min=f.min,c.commands[a].value.max=f.max,c.details.commands[a].extMeta=f.min+"-"+f.max));break;case "color":c.commands[a]={value:{type:"RGB"}},c.details.commands[a]={value:a,ext:"%rgb"},c.commands.white={},c.details.commands.white={value:"color",ext:"FFFFFF"},b.commands[a]&&b.commands[a].value&&(f=b.commands[a].value,"RGBW"==f.type&&(c.commands[a].value.type="RGBW",c.details.commands[a].ext="%rgbw",c.details.commands.white={value:"color",ext:"FFFFFFFF"}))}if(b.states)for(a in b.states)switch(a){case "state":c.states.state=
{values:["on","off"]};c.details.states.state={value:"state"};break;case "brightness":c.states.brightness={value:{type:"INT",min:0,max:100}};c.details.states.brightness={value:"brightness",ext:"%d",extMeta:"0-100"};break;case "colorTemperature":c.states.colorTemperature={value:{type:"INT",min:154,max:500}};c.details.states.colorTemperature={value:"colorTemperature",ext:"%d",extMeta:"154-500"};break;case "color":c.states.color={type:"RGB"},c.details.states.color={value:"color",ext:"%rgb"},b.states[a]&&
b.states[a].value&&(f=b.states[a].value,"RGBW"==f.type&&(c.states.color.type="RGBW",c.details.states.color.ext="%rgbw"))}break;case "somfy":c={type:"blind",commands:{},states:{},details:{commands:{},states:{}}};if(b.commands)for(a in b.commands)switch(a){case "open":case "close":c=null;break;case "stop":case "up":case "down":c.commands[a]={};c.details.commands[a]={value:a};break;case "position":case "rotation":c.commands[a]={value:{type:"INT",min:0,max:100}},c.details.commands[a]={value:a,ext:"%d"}}if(b.states)for(a in b.states)switch(a){case "position":case "rotation":c.states[a]=
{value:{type:"INT",min:0,max:100}},c.details.states[a]={value:a,ext:"%d",extMeta:"0-100"}}break;case "homematic":switch(b.type){case "switch":c=JSON.parse(JSON.stringify(b));c.details={commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"}},states:{state:{value:"state"}}};c.states.power&&(c.details.states.power={value:"power"});c.states.consumption&&(c.details.states.consumption={value:"consumption"});break;case "dimmer":c=JSON.parse(JSON.stringify(b));c.details={commands:{on:{value:"on"},
off:{value:"off"},toggle:{value:"toggle"},up:{value:"up"},down:{value:"down"},brightness:{value:"brightness"}},states:{state:{value:"state"},brightness:{value:"brightness"}}};break;case "blind":c=JSON.parse(JSON.stringify(b));c.details={commands:{up:{value:"up"},down:{value:"down"},stop:{value:"stop"},stepUp:{value:"stepUp"},stepDown:{value:"stepDown"},position:{value:"position"}},states:{position:{value:"position"}}};c.commands.rotation&&(c.details.commands.rotation={value:"rotation"});c.states.rotation&&
(c.details.states.rotation={value:"rotation"});break;case "heater":c=JSON.parse(JSON.stringify(b));c.details={};if(!c.commands)return null;c.commands&&(c.details.commands={up:{value:"up"},down:{value:"down"},temperature:{value:"temperature"},mode:{value:"mode"},auto:{value:"mode",ext:"auto"},manu:{value:"mode",ext:"manu"},boost:{value:"mode",ext:"boost"}});c.states&&(c.details.states={state:{value:"state"},mode:{value:"mode"},temperature:{value:"temperature"},humidity:{value:"humidity"}});break;case "temperature":c=
JSON.parse(JSON.stringify(b));c.states&&(c.details={states:{}},c.states.temperature&&(c.details.states.temperature={value:"temperature"}),c.states.humidity&&(c.details.states.humidity={value:"humidity"}));break;case "motion":c=JSON.parse(JSON.stringify(b));c.states&&(c.details={states:{}},c.states.motion&&(c.details.states.motion={value:"motion"}));break;case "contact":c=JSON.parse(JSON.stringify(b));c.states&&(c.details={states:{}},c.states.contact&&(c.details.states.state={value:"contact"}));break;
case "window":c=JSON.parse(JSON.stringify(b)),c.states&&(c.details={states:{}},c.states.window&&(c.details.states.state={value:"window"}))}break;case "bosch":switch(b.type){case "switch":c={type:"switch",commands:{on:{},off:{},toggle:{}},states:{state:{values:["on","off"]},power:{type:"FLOAT",unit:"W"},consumption:{type:"FLOAT",unit:"W"}},details:{commands:{on:{value:"on"},off:{value:"off"},toggle:{value:"toggle"}},states:{state:{value:"state"},power:{value:"power"},consumption:{value:"energy"}}}};
break;case "shutter":c={type:"blind",commands:{up:{},down:{},stop:{},position:{value:{type:"INT",min:0,max:100}}},states:{position:{type:"INT",min:0,max:100}},details:{commands:{up:{value:"up"},down:{value:"down"},stop:{value:"stop"},position:{value:"position"}},states:{position:{value:"position"}}}};break;case "heater":c={type:"heater",commands:{up:{},down:{},temperature:{value:{type:"FLOAT",min:5,max:30.5,step:.5}}},states:{state:{type:"FLOAT",min:5,max:30.5,step:.5},temperature:{type:"FLOAT"},
mode:{values:["automatic","manual"]}},details:{commands:{up:{value:"up"},down:{value:"down"},temperature:{value:"temperature"}},states:{state:{value:"state"},temperature:{value:"temperature"},mode:{value:"mode"}}}};break;case "contact":c={type:"contact",states:{state:{values:["open","closed"]}},details:{states:{state:{value:"state"}}}}}}return c},supportSmartWidget:function(b,c){if(!b||!b.module)return!1;switch(b.module){case "gardena":case "netatmo":case "openweathermap":case "nuki":case "uhoo":return!0;
case "ring":return"doorbell"===b.type;case "homematic":case "hmipc2c":switch(b.type){case "contact":case "dimmer":case "enviroment":case "environment":case "heater":case "home":case "motion":case "presence":case "room":case "security":case "temperature":case "smoke":case "water":case "weather":return!0}}return!1},applySmartWidgetFilter:function(b,c,f,a,d){if(!c||!c.module)return null;var k=f=null,l=null,m=null;f=function(h,e){switch(h.module){case "bosch":"camera"===h.type&&(h.commands&&h.commands.position?
e.push("bosch_cam"):e.push("bosch_cam_eyes"));break;case "gardena":switch(h.type){case "mower":e.push("gardena_mower");break;case "switch":e.push("gardena_switch");break;case "sensor":e.push("gardena_sensor");break;case "ic24":e.push("gardena_ic24");break;case "valve":e.push("gardena_valve")}break;case "netatmo":switch(h.type){case "NAMain":e.push("netatmo_basestation");break;case "NAModule1":case "NAModule4":e.push("climate");e.push("notification");break;case "NAModule2":e.push("netatmo_wind");e.push("notification");
break;case "NAModule3":e.push("netatmo_rain"),e.push("notification")}break;case "openweathermap":e.push("openweathermap");break;case "nuki":e.push("nuki");break;case "ring":switch(h.type){case "doorbell":e.push("motion")}break;case "uhoo":e.push("uhoo");break;case "homematic":case "hmipc2c":switch((h.states.battery||h.states.timeout||h.states.sabotage)&&e.push("notification"),h.type){case "dimmer":e.push("dimmer");e.push("switch");break;case "heater":e.push("thermostat");break;case "home":e.push("weather_station");
e.push("climate");e.push("home");break;case "enviroment":case "environment":case "temperature":(h.states.temperature||h.states.humidity)&&e.push("climate");h.states.rain&&e.push("rain");break;case "contact":e.push("contact");e.push("window");break;case "motion":case "security":h.states.motion&&e.push("motion");(h.states.moisture||h.states.water)&&e.push("sensor_water");h.states.presence&&e.push("motion");h.states.window&&(e.push("window"),e.push("contact"));h.states.smoke&&e.push("smoke");break;case "presence":h.states.presence&&
e.push("motion");break;case "smoke":(h.states.smoke||h.states.smoke_alarm_state)&&e.push("smoke");break;case "water":h.states.water&&e.push("sensor_water");break;case "weather":e.push("weather_station");e.push("climate");break;case "other":h.states.co2Level&&e.push("sensor_co2")}}return e}(c,f?f:[]);k=function(h,e){switch(h.module){case "bosch":"camera"===h.type&&(h=h.commands,e["%toggle%"]={value:"toggle"},h&&h.position&&(e["%camPosition%"]={value:"position",ext:"%d",extMeta:"-120-120"}));break;
case "gardena":if(!h.commands)break;switch(h.type){case "mower":e["%start%"]={value:"start_override_timer",ext:"%d",extMeta:"60-6000",scale:60};e["%park%"]={value:"park_until_next_task"};break;case "switch":e["%on%"]={value:"on"};e["%onFor%"]={value:"on_for",ext:"%d",extMeta:"60-7200",scale:60};e["%off%"]={value:"off"};break;case "ic24":e["%stopAll%"]={value:"stop_all_valve"};break;case "valve":e["%run%"]={value:"run",ext:"%d",extMeta:"60-3600",scale:60},e["%pause%"]={value:"pause",ext:"%d",extMeta:"60-604800",
scale:60},e["%resume%"]={value:"resume"},e["%stop%"]={value:"stop"}}break;case "nuki":e["%unlock%"]={value:"unlock"};e["%lock%"]={value:"lock"};e["%open%"]={value:"lock_n_go"};break;case "hmipc2c":case "homematic":if(h.commands)switch(h.type){case "switch":h.commands.on&&(e["%on%"]={value:"on"});h.commands.off&&(e["%off%"]={value:"off"});h.commands.toggle&&(e["%toggle%"]={value:"toggle"});break;case "dimmer":h.commands.brightness&&(e["%dimTo%"]={value:"brightness",ext:"%d",extMeta:"0-100"});h.commands.up&&
(e["%dimUp%"]={value:"up"});h.commands.down&&(e["%dimDown%"]={value:"down"});h.commands.on&&(e["%dimOn%"]={value:"on"},e["%on%"]={value:"on"});h.commands.off&&(e["%dimOff%"]={value:"off"},e["%off%"]={value:"off"});h.commands.toggle&&(e["%toggle%"]={value:"toggle"});break;case "heater":h.commands.temperature&&(e["%thermoTempTo%"]={value:"temperature",ext:"%f",scale:(h.commands.temperature.value||{}).scale||"0.5"});h.commands.down&&(e["%thermoTempDown%"]={value:"down"});h.commands.up&&(e["%thermoTempUp%"]=
{value:"up"});break;case "home":h.commands.alarm_mode&&(e["%alarmModeDisarm%"]={value:"alarm_mode",ext:"disarmed"},e["%alarmModeProtectExternal%"]={value:"alarm_mode",ext:"external_protection"},e["%alarmModeProtectFull%"]={value:"alarm_mode",ext:"full_protection"}),h.commands.auto&&(e["%thermoAuto%"]={value:"auto"}),h.commands.eco&&(e["%thermoEco%"]={value:"eco",extMeta:[{type:"time",name:"start",ref:{value:"start",ext:"%time"}},{type:"time",name:"end",ref:{value:"end",ext:"%time"}}]}),h.commands.vacation&&
(e["%thermoVacation%"]={value:"vacation",extMeta:[{type:"float",name:"temperature",ref:{value:"temperature",ext:"%f",extMeta:"5-30",scale:.5}},{type:"time",name:"end",ref:{value:"end",ext:"%time"}}]})}}return e}(c,k?k:{});l=function(h,e){switch(h.module){case "bosch":"camera"===h.type&&(e["%camOnline%"]={value:"online"},h.states&&h.states.position&&(e["%camPosition%"]={value:"position",extMeta:"-120-120"}),e["%camState%"]={value:"state"});break;case "gardena":if(!h.states)break;h.states.online&&(e["%online%"]=
{value:"online",options:["true","false"]});switch(h.type){case "mower":e["%state%"]={value:"state",options:"paused ok_cutting ok_cutting_timer_overridden ok_searching ok_leaving ok_charging parked_timer parked_park_selected parked_autotimer none".split(" ")};break;case "switch":e["%state%"]={value:"state",options:["off","forever_on","time_limited_on","scheduled_on"]};e["%duration%"]={value:"duration"};break;case "sensor":e["%tempAmbient%"]={value:"ambient_temperature"};e["%tempSoil%"]={value:"soil_temperature"};
e["%humSoil%"]={value:"soil_humidity"};e["%light%"]={value:"light"};break;case "valve":e["%state%"]={value:"state",options:["closed","manual_watering","scheduled_watering"]},e["%duration%"]={value:"duration"}}break;case "netatmo":switch(h.type){case "NAMain":e["%tempState%"]={value:"temperature"};e["%humState%"]={value:"humidity"};e["%co2State%"]={value:"co2"};e["%noiseState%"]={value:"noise"};e["%pressureState%"]={value:"pressure"};break;case "NAModule1":case "NAModule4":e["%tempState%"]={value:"temperature"};
e["%humState%"]={value:"humidity"};e["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}};break;case "NAModule2":e["%windspeedState%"]={value:"wind_speed"};e["%windDirection%"]={value:"wind_direction"};e["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}};break;case "NAModule3":e["%rain%"]={value:"rain"},e["%rain_last_hour%"]={value:"rain_last_hour"},e["%rain_last_day%"]={value:"rain_last_day"},e["%lowbat%"]={value:"battery",conv_i:{"0|30":!0,"31|100":!1}}}break;case "openweathermap":e["%tempState%"]=
{value:"temperature"};e["%humState%"]={value:"humidity"};e["%windspeedState%"]={value:"wind_speed"};e["%windDirection%"]={value:"wind_direction"};break;case "nuki":e["%lockStatus%"]={value:"state",conv_s:{locked:"locked",unlocked:"open"}};break;case "ring":switch(h.type){case "doorbell":e["%motionState%"]={value:"state",conv_s:{locked:"locked",unlocked:"open"}}}break;case "uhoo":e["%onlineState%"]={value:"online"};e["%tempState%"]={value:"temperature",extMeta:"-40-85"};e["%tempUnit%"]={value:"temperature_unit"};
e["%humState%"]={value:"humidity",extMeta:"0-100"};e["%dustState%"]={value:"dust",extMeta:"0-200"};e["%vocState%"]={value:"voc",extMeta:"0-1200"};e["%co2State%"]={value:"co2",extMeta:"400-10000"};e["%coState%"]={value:"co",extMeta:"0-1000"};e["%pressureState%"]={value:"pressure",extMeta:"300-1100"};e["%no2State%"]={value:"no2",extMeta:"0-1000"};e["%ozoneState%"]={value:"ozone",extMeta:"0-1000"};e["%measured%"]={value:"measured"};break;case "hmipc2c":case "homematic":switch(h.states.battery&&(e["%lowbat%"]=
{value:"battery",conv_i:{"0|30":"true","31|100":"false"}}),h.states.timeout&&(e["%timeout%"]={value:"timeout"}),h.states.sabotage&&(e["%sabotage%"]={value:"sabotage"}),h.type){case "dimmer":h.states.brightness&&(e["%dimmerState%"]={value:"brightness"});h.states.state&&(e["%switchState%"]={value:"state"});break;case "switch":h.states.state&&(e["%switchState%"]={value:"state"});break;case "heater":h.states.temperature&&(e["%thermoCurrentTemp%"]={value:"temperature"});h.states.setpoint&&(e["%thermoSetTemp%"]=
{value:"setpoint"});h.states.humidity&&(e["%thermoHum%"]={value:"humidity"});break;case "home":h.states.temperature&&(e["%tempState%"]={value:"temperature"});h.states.humidity&&(e["%humState%"]={value:"humidity"});h.states.wind_speed&&(e["%windspeedState%"]={value:"wind_speed"});h.states.wind_direction&&(e["%windDirection%"]={value:"wind_direction"},e["%windDirection%"].conv_i={"0|22":"N","23|67":"NO","68|112":"O","113|157":"SO","158|202":"S","203|247":"SW","248|292":"W","293|337":"NW","338|360":"N"});
h.states.alarm_mode&&(e["%alarmMode%"]={value:"alarm_mode"});h.states.mode&&(e["%thermoMode%"]={value:"mode"});break;case "enviroment":case "environment":case "temperature":h.states.temperature&&(e["%tempState%"]={value:"temperature"});h.states.humidity&&(e["%humState%"]={value:"humidity"});h.states.rain&&(e["%rainState%"]={value:"rain"});break;case "contact":h.states.state&&(e["%contactState%"]={value:"state"},e["%windowState%"]={value:"state"});break;case "motion":case "security":h.states.motion&&
(e["%motionState%"]={value:"motion"});if(h.states.moisture||h.states.water)e["%waterState%"]={value:"water",conv_s:{"true":"water","false":"dry"}};h.states.presence&&(e["%motionState%"]||(e["%motionState%"]={value:"presence"}));h.states.window&&(e["%windowState%"]={value:"window"},e["%contactState%"]={value:"window"});h.states.smoke&&(e["%smokeState%"]={value:"smoke"});break;case "presence":h.states.presence&&(e["%motionState%"]={value:"presence"});h.states.illumination&&(e["%motionBrightness%"]=
{value:"illumination"});break;case "smoke":h.states.smoke&&(e["%smokeState%"]={value:"smoke"});h.states.smoke_alarm_state&&(e["%smokeState%"]={value:"smoke_alarm_state",conv_s:{primary_alarm:"true",secondary_alarm:"true",intrusion_alarm:"true",idle_off:"false"}});break;case "water":h.states.water&&(e["%waterState%"]={value:"water",conv_s:{"true":"water","false":"dry"}});break;case "weather":h.states.temperature&&(e["%tempState%"]={value:"temperature"});h.states.humidity&&(e["%humState%"]={value:"humidity"});
h.states.illumination&&(e["%brightnessState%"]={value:"illumination"});h.states.wind_speed&&(e["%windspeedState%"]={value:"wind_speed"});h.states.wind_direction&&(e["%windDirection%"]={value:"wind_direction"},e["%windDirection%"].conv_i={"0|22":"N","23|67":"NO","68|112":"O","113|157":"SO","158|202":"S","203|247":"SW","248|292":"W","293|337":"NW","338|360":"N"});h.states.rain&&(e["%rainingState%"]={value:"rain"});h.states.rain_total&&(e["%rainingCounterState%"]={value:"rain_total"});h.states.sunshine_total&&
(e["%sunshineState%"]={value:"sunshine_total"});break;case "other":h.states.co2Level&&(e["%co2State%"]={value:"co2Level"})}}return e}(c,l?l:{});m=function(h,e){return e}(c,m?m:{});b=b._injectToSmartWidgetTemplate(a,f,d,k,l,m);if(Array.isArray(b)&&"bosch"===c.module&&"camera"===c.type&&(!c.commands||!c.commands.toggle))for(c=0;c<b.length;c++)if((a=b[c])&&a.meta&&a.elements&&0===String(a.meta.type).indexOf("bosch_cam")&&(a=a.elements.buttons,Array.isArray(a)))for(d=0;d<a.length;d++)(f=a[d])&&f.action&&
f.action.ref&&"toggle"===f.action.ref.value&&delete f.action;return b}}}();
xnm.aio.cloudservice.Handler=function(){var g=function(){};g.prototype.devicemanager=xnm.aio.cloudservice.DM;g.prototype.CloudService=xnm.aio.cloudservice.CloudService;g.prototype.Ivideon=xnm.aio.cloudservice.Ivideon;g.prototype.Ring=xnm.aio.cloudservice.Ring;g.prototype.Bosch=xnm.aio.cloudservice.Bosch;g.prototype.DoorBird=xnm.aio.cloudservice.DoorBird;g.prototype.registModule=function(b){b.register("cloudservice","cloudservice")};g.prototype.resolveGateway=function(b){return b?this.CloudService.parseJSON(b):
null};g.prototype.getDeviceCommands=function(b,c){b=(b=this.devicemanager.applyUIFilter(b,{catagory:"command",elems:"*"}))?b.command:[];c&&c(null,b)};g.prototype.getDeviceStatus=function(b,c){b=(b=this.devicemanager.applyUIFilter(b,{catagory:"status",elems:"*"}))?b.status:[];c&&c(null,b)};g.prototype.doCommand=function(b,c,f,a){(b=this.resolveGateway(b))?b.executeCommandCreator(c,f,function(d){a&&a(d)}):a&&a(Error("gateway json format invalid"))};g.prototype.doStatus=function(b,c,f,a,d){(c=this.resolveGateway(c))?
c.getStatesCreator(null,[{id:b,device:f,status:a}],function(k,l){k?d&&d(k):d&&d(null,l[0])}):d&&d(Error("gateway json format invalid"))};g.prototype.getUserInfo=function(b,c){(b=this.resolveGateway(b))?b.getUserInfo(function(f,a){c&&c(f,a)}):c&&c(Error("gateway json format invalid"))};g.prototype.getModulesInfo=function(b,c){(b=this.resolveGateway(b))?b.getModulesInfo(function(f,a){c&&c(f,a)}):c&&c(Error("gateway json format invalid"))};g.prototype.getDeviceList=function(b,c,f){c?(b=this.resolveGateway(b))?
b.getDeviceList(c,function(a,d){f&&f(a,d)}):f&&f(Error("gateway json format invalid")):f&&f(Error("module name invalid"))};g.prototype.getConnectionState=function(b,c,f,a){c?f?(b=this.resolveGateway(b))?b.getModuleConnectionInfo(c,f,function(d,k){a&&a(d,k)}):a&&a(Error("gateway json format invalid")):a&&a(Error("connection id invalid")):a&&a(Error("module name invalid"))};g.prototype.disconnect=function(b,c,f,a){c?f?(b=this.resolveGateway(b))?b.disconenct(c,f,function(d){a&&a(d)}):a&&a(Error("gateway json format invalid")):
a&&a(Error("connection id invalid")):a&&a(Error("module name invalid"))};return g}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.cloudservice.Handler);
