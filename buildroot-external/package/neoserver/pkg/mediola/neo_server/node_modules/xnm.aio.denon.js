var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(g,a,c){g instanceof String&&(g=String(g));for(var e=g.length,f=0;f<e;f++){var b=g[f];if(a.call(c,b,f,g))return{i:f,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,a,c){g!=Array.prototype&&g!=Object.prototype&&(g[a]=c.value)};
$jscomp.getGlobal=function(g){return"undefined"!=typeof window&&window===g?g:"undefined"!=typeof global&&null!=global?global:g};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(g,a,c,e){if(a){c=$jscomp.global;g=g.split(".");for(e=0;e<g.length-1;e++){var f=g[e];f in c||(c[f]={});c=c[f]}g=g[g.length-1];e=c[g];a=a(e);a!=e&&null!=a&&$jscomp.defineProperty(c,g,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(g){return g?g:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.denon=xnm.aio.denon||{};xnm.aio.marantz=xnm.aio.marantz||{};
xnm.aio.denon.AVR=function(){var g=function(a,c){this.ip=a;this.port=c;this.port||(this.port="23");this.timeout=2E3;this.CommandHandler=this._socket=null};g.prototype._doRequest=function(a,c,e){var f=require("net");if(!this._socket){var b=null,d=[];this._socket=f.connect({port:this.port,host:this.ip});this._socket.setTimeout(this.timeout);var h=this,k=null;this._socket.on("connect",function(){var d=new Buffer(a.shift()+"\r");h._socket.write(d);e&&h._socket.setTimeout(250)});this._socket.on("data",
function(c){b=b?b+c.toString():c.toString();for(c=b.indexOf("\r");0<c;)d.push(b.substr(0,c)),b=b.substr(c+1),c=b.indexOf("\r");0<a.length?(c=new Buffer(a.shift()+"\r"),h._socket.write(c)):h._socket.setTimeout(100)});this._socket.on("error",function(d){c&&(c({error:"socket error",data:null}),c=null);h._socket&&h._socket.destroy();h._socket=null});this._socket.on("timeout",function(){h._socket.destroy();h._socket=null;c&&(k=0<d.length?{error:null,data:d}:{error:"socket timeout",data:null})});this._socket.on("close",
function(){h._socket=null;c&&k&&setTimeout(function(){c(k)},250)})}};g.prototype._executeCommand=function(a,c){this._doRequest([a],function(){c&&c()},!0)};g.prototype.executeCommand=function(a,c){var e=a,f=this;"on"==a?e="PWON":"off"==a||"standby"==a?e="PWSTANDBY":"toggle"==a&&(e=null,this.getStates(function(b){b&&"on"==b.power?f._executeCommand("PWSTANDBY",c):f._executeCommand("PWON",c)}));e&&this._executeCommand(e,c)};g.prototype.getStates=function(a){var c={mainzone:{},zone2:{}};this._doRequest("PW? MU? SI? MV? ZM? Z2MU? Z2?".split(" "),
function(e){if(e.data){for(var f=0;f<e.data.length;f++){var b=e.data[f].trim();"PW"==b.substr(0,2)?c.power=b.substr(2).toLowerCase():"MV"==b.substr(0,2)?(b=b.substr(2),3==b.length?c.mainzone.volume=(parseFloat(b)/10).toFixed(1):2==b.length&&(c.mainzone.volume=parseFloat(b).toFixed(1))):"MU"==b.substr(0,2)?c.mainzone.mute=b.substr(2).toLowerCase():"SI"==b.substr(0,2)?c.mainzone.input=b.substr(2).toLowerCase():"ZM"==b.substr(0,2)?c.mainzone.power=b.substr(2).toLowerCase():"Z2MU"==b.substr(0,4)?c.zone2.mute=
b.substr(4).toLowerCase():"Z2"==b.substr(0,2)&&("Z2ON"==b?c.zone2.power="on":"Z2OFF"==b?c.zone2.power="off":(b=b.substr(2),/^\d+$/.test(b)?3==b.length?c.zone2.volume=(parseFloat(b)/10).toFixed(1):2==b.length&&(c.zone2.volume=parseFloat(b).toFixed(1)):c.zone2.input=b.toLowerCase()))}a&&a(c)}else a&&a()})};g.prototype.getStateValues=function(a,c){return c};return g}();
xnm.aio.denon.Cache={_cache:{},_getCache:function(g){return g?this._cache[g]:null},_ensureCache:function(g){if(!g)return null;this._cache[g]||(this._cache[g]={});return this._cache[g]},getConfig:function(g){return g?(g=this._getCache(g))?g.config:null:null},setConfig:function(g,a){if(!g)return null;this._ensureCache(g).config=a}};
xnm.aio.denon.WebAVR=function(){var g=function(a,c,e,f,b){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.denon.WebAVR");this.ip=a;this.port=c;this.port||(this.port=80);this.uuid=e;this.name=f;this.model=b;this.timeout=3E3;this.CommandHandler=null};g.prototype.audioModes="DIRECT;STEREO;DOLBY DIGITAL;DTS SURROUND;AUTO;MCH STEREO;SUPER STADIUM;ROCK ARENA;JAZZ CLUB;CLASSIC CONCERT;MONO MOVIE;MATRIX;VIDEO GAME;VIRTUAL".split(";");g.prototype.audioModesDesc=
"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";");g.prototype.videoInputs="CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;Online Music;Bluetooth;Internetradio;Media Server;CD;PHONO;HDRADIO".split(";");g.prototype._getConfig=function(){return xnm.aio.denon.Cache.getConfig(this.ip)};g.prototype._setConfig=function(a){xnm.aio.denon.Cache.setConfig(this.ip,
a)};g.prototype.executeCommandCreator=function(a,c,e){if(c&&c.value)if("openNative"==c.value)window&&window.XC&&window.XC.callHost&&window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()?a&&"marantz"==a.sys?window.XC.callHost("SYSTEM","startApp",{scheme:"marantzremoteapp://"}):window.XC.callHost("SYSTEM","startApp",{scheme:"denonremoteapp://"}):"Android"==window.XCHost.getType()&&(a&&"marantz"==a.sys?window.XC.callHost("SYSTEM","startApp",{scheme:"com.dmholdings.marantzremoteapp"}):
window.XC.callHost("SYSTEM","startApp",{scheme:"com.dmholdings.denonremoteapp"}))),e&&e();else{a="";c.path&&c.path[0]&&"global"!=c.path[0]&&(a=c.path[0]+":");var f=a+c.value;if("setInput"==c.value){if(!c.ext){e&&e(Error("command setInput ext format invalid"));return}f=a+c.ext}else if("audioMode"==c.value){if(!c.ext){e&&e(Error("command audioMode ext format invalid"));return}f=a+c.ext}else if("setTo"==c.value||"setToDB"==c.value){if(null==c.ext||"undefined"==typeof c.ext){e&&e(Error("command setTo ext format invalid"));
return}f+=c.ext}else if("customCMD"==c.value){if(!c.ext){e&&e(Error("command customCMD ext format invalid"));return}f="customCMD:"+c.ext}if("tuner"==c.value){if(null==c.ext||"undefined"==typeof c.ext){e&&e(Error("command tunerPreset ext format invalid"));return}f+=c.ext}this.executeCommand(f,function(b){if(b)e&&e(b);else{if(c.path&&c.path[0]&&"mainzone"==c.path[0]){if("on"==c.value||"off"==c.value||"toggle"==c.value){setTimeout(function(){e&&e()},1E3);return}if("setTo"==c.value||"setToDB"==c.value||
"volumeUp"==c.value||"volumeDown"==c.value){setTimeout(function(){e&&e()},10);return}}"setInput"==c.value||"audioMode"==c.value?setTimeout(function(){e&&e()},1E3):e&&e()}})}else e&&e(Error("command json format invalid"))};g.prototype.getStatesCreator=function(a,c,e){this.getStates(function(a,b){a=[];for(var d=0;d<c.length;d++)if(c[d]&&c[d].id){var h="?";if(b&&c[d].status&&c[d].status.value){var k="";c[d].status.path&&c[d].status.path[0]&&"global"!=c[d].status.path[0]&&(k=c[d].status.path[0]);var l=
c[d].status.value;k&&null!=b[k]&&"undefined"!=typeof b[k]?b[k][l]&&(h=b[k][l]):null!=b[l]&&"undefined"!=typeof b[l]&&(h=b[l])}a.push({id:c[d].id,status:h})}e&&e(null,a)})};g.prototype._doRequest=function(a,c,e,f){var b=this;c="http://"+this.ip+":"+this.port+c;this._logger.log("trace","send "+a+" to url:"+c+" data:"+e);var d=f;$.ajax({url:c,type:a,timeout:this.timeout,data:e,dataType:"text",cache:!0,success:function(a){b._logger.log("trace","http request success:"+a);setTimeout(function(){d&&(d(null,
a),d=null)},200)},error:function(a,c){a="http request error:"+(a?a.status:"0")+"-"+c;b._logger.log("trace",a);d&&(d(Error(a)),d=null)}})};g.prototype._getInputList=function(a){this._doRequest("GET","/goform/formMainZone_MainZoneXmlStatus.xml",null,function(c,e){if(c)a&&a(c);else try{var f=$($.parseXML(e));if(f){var b={inputs:[],renamed:[]};f.find("InputFuncList").each(function(){$(this).find("value").each(function(){var d=$(this).text();d&&b.inputs.push(d.trim())})});f.find("RenameSource").each(function(){$(this).find("value value").each(function(){var d=
$(this).text();d&&b.renamed.push(d.trim())})});a&&a(null,b)}else a&&a(Error("MainZoneXmlStatus.xml response invalid"))}catch(d){a&&a(d)}})};g.prototype._getStateValue=function(a,c,e,f){var b=null;a.find(c).each(function(){var d=$(this).find("value");0<d.length&&(b=$(d[0]).text())});b&&f&&(b=b.trim());b&&e&&(b=b.toLowerCase());return b};g.prototype._getOriginalInputName=function(a){var c=a,e=this._getConfig();e&&e.renamed&&e.inputs&&(a=e.renamed.indexOf(a),-1!=a&&e.inputs[a]&&(c=e.inputs[a]));return c};
g.prototype._parseStates=function(a){var c={};try{var e=$($.parseXML(a));if(e){c.mainpower=this._getStateValue(e,"Power",!0,!0);"standby"==c.mainpower&&(c.mainpower="off");c.power=this._getStateValue(e,"ZonePower",!0,!0);c.mute=this._getStateValue(e,"Mute",!0,!0);c.input=this._getStateValue(e,"InputFuncSelect",!1,!0);c.audioMode=this._getStateValue(e,"selectSurround",!1,!0);c.input&&(c.originalInput=this._getOriginalInputName(c.input));"NETWORK"==c.originalInput&&(c.netfunc=this._getStateValue(e,
"NetFuncSelect",!1,!0));switch(c.originalInput){case "CBL/SAT":c.originalInput="CBL/SAT";break;case "DVD":c.originalInput="DVD/Blu-ray";break;case "Blu-ray":c.originalInput="Blu-ray";break;case "GAME":c.originalInput="Game";break;case "Media Player":c.originalInput="Media Player";break;case "iPod/USB":c.originalInput="iPod/USB";break;case "TUNER":c.originalInput="Tuner";break;case "TV AUDIO":c.originalInput="TV Audio";break;case "NETWORK":switch(c.netfunc){case "IRADIO":c.originalInput="Internetradio";
break;case "SERVER":c.originalInput="Media Server";break;default:c.originalInput="Online Music"}}var f=this._getStateValue(e,"MasterVolume",!1,!0);c.volumeDB="--"==f?"-80.0":parseFloat(f).toFixed(1);f="--"==f?0:parseFloat(f)+80;c.volume=""+f.toFixed(1)}}catch(b){}return c};g.prototype.getStates=function(a){var c={mainzone:{},zone2:{},zone3:{}},e=this;this._getConfig()?this._doRequest("GET","/goform/formMainZone_MainZoneXml.xml",null,function(f,b){!f&&b?(c.mainzone=e._parseStates(b),c.power=c.mainzone.mainpower,
delete c.mainzone.mainpower,e._doRequest("GET","/goform/formMainZone_MainZoneXml.xml?ZoneName=ZONE2",null,function(d,b){!d&&b&&(c.zone2=e._parseStates(b),delete c.zone2.mainpower);e._doRequest("GET","/goform/formMainZone_MainZoneXml.xml?ZoneName=ZONE3",null,function(d,h){!d&&b&&(c.zone3=e._parseStates(h),delete c.zone3.mainpower);a&&a(d,c)})})):a&&a(f,c)}):this._getInputList(function(c,b){c?a&&a(c):(e._setConfig(b),e.getStates(a))})};g.prototype.executeCommand=function(a,c){var e=null,f=!0,b=null,
d=a.indexOf(":");0<d&&(b=a.substr(0,d),a=a.substr(d+1));d="POST";var h="/MainZone/index.put.asp",k=this;"on"==a?e="mainzone"==b?"cmd0=PutZone_OnOff%2FON":"zone2"==b?"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE3":"cmd0=PutSystem_OnStandby%2FON":"off"==a||"standby"==a?e="mainzone"==b?"cmd0=PutZone_OnOff%2FOFF":"zone2"==b?"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE2":"zone2"==b?"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE3":"cmd0=PutSystem_OnStandby%2FSTANDBY":"toggle"==
a?(f=!1,this.getStates(function(d,a){b?"mainzone"==b?a&&a.mainzone&&"on"==a.mainzone.power?k._doRequest("POST",h,"cmd0=PutZone_OnOff%2FOFF",c):k._doRequest("POST",h,"cmd0=PutZone_OnOff%2FON",c):"zone2"==b?a&&a.zone2&&"on"==a.zone2.power?k._doRequest("POST",h,"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE2",c):k._doRequest("POST",h,"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE2",c):"zone3"==b&&(a&&a.zone3&&"on"==a.zone3.power?k._doRequest("POST",h,"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE3",c):k._doRequest("POST",
h,"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE3",c)):a&&"on"==a.power?k._doRequest("POST",h,"cmd0=PutSystem_OnStandby%2FSTANDBY",c):k._doRequest("POST",h,"cmd0=PutSystem_OnStandby%2FON",c)})):"mute"==a?"zone2"==b?e="cmd0=PutVolumeMute/on&ZoneName=ZONE2":"zone3"==b?e="cmd0=PutVolumeMute/on&ZoneName=ZONE3":"mainzone"==b?e="cmd0=PutVolumeMute/on":(h="/goform/AppCommand.xml",e='<?xml version="1.0" encoding="utf-8"?>\r\n<tx>\r\n<cmd id="1">SetAllZoneMute</cmd>\r\n<value>ON</value>\r\n</tx>'):"unmute"==a?"zone2"==
b?e="cmd0=PutVolumeMute/off&ZoneName=ZONE2":"zone3"==b?e="cmd0=PutVolumeMute/off&ZoneName=ZONE3":"mainzone"==b?e="cmd0=PutVolumeMute/off":(h="/goform/AppCommand.xml",e='<?xml version="1.0" encoding="utf-8"?>\r\n<tx>\r\n<cmd id="1">SetAllZoneMute</cmd>\r\n<value>OFF</value>\r\n</tx>'):"toggleMute"==a?e="zone2"==b?"cmd0=PutVolumeMute/toggle&ZoneName=ZONE2":"zone3"==b?"cmd0=PutVolumeMute/toggle&ZoneName=ZONE3":"cmd0=PutVolumeMute/toggle":"volumeDown"==a?e="zone2"==b?"cmd0=PutMasterVolumeBtn/<&ZoneName=ZONE2":
"zone3"==b?"cmd0=PutMasterVolumeBtn/<&ZoneName=ZONE3":"cmd0=PutMasterVolumeBtn/<":"volumeUp"==a?e="zone2"==b?"cmd0=PutMasterVolumeBtn/>&ZoneName=ZONE2":"zone3"==b?"cmd0=PutMasterVolumeBtn/>&ZoneName=ZONE3":"cmd0=PutMasterVolumeBtn/>":"CBL/SAT"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/SAT/CBL&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/SAT/CBL&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/SAT/CBL":"DVD/Blu-ray"==a||"DVD"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/DVD&ZoneName=ZONE2":"zone3"==
b?"cmd0=PutZone_InputFunction/DVD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/DVD":"Blu-ray"==a||"BD"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/BD&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/BD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/BD":"Game"==a||"GAME"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/GAME&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/GAME&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/GAME":"AUX"==a||"AUX1"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/AUX1&ZoneName=ZONE2":
"zone3"==b?"cmd0=PutZone_InputFunction/AUX1&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/AUX1":"AUX2"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/AUX2&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/AUX2&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/AUX2":"Media Player"==a||"MPLAY"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/MPLAY&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/MPLAY&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/MPLAY":"iPod/USB"==a||"IPOD"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/USB/IPOD&ZoneName=ZONE2":
"zone3"==b?"cmd0=PutZone_InputFunction/USB/IPOD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/USB/IPOD":"TV Audio"==a||"TV"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/TV&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/TV&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/TV":"Tuner"==a||"TUNER"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/TUNER&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/TUNER&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/TUNER":"Online Music"==a||"NETHOME"==a||"NET"==a?e=
"zone2"==b?"cmd0=PutZone_InputFunction/NETHOME&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/NETHOME&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/NETHOME":"Bluetooth"==a||"BT"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/BT&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/BT&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/BT":"Internetradio"==a||"IRP"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/IRP&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/IRP&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/IRP":
"Media Server"==a||"SERVER"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/SERVER&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/SERVER&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/SERVER":"CD"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/CD&ZoneName=ZONE2":"zone2"==b?"cmd0=PutZone_InputFunction/CD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/CD":"PHONO"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/PHONO&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/PHONO&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/PHONO":
"HDRADIO"==a?e="zone2"==b?"cmd0=PutZone_InputFunction/HDRADIO&ZoneName=ZONE2":"zone3"==b?"cmd0=PutZone_InputFunction/HDRADIO&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/HDRADIO":"Source"==a?(d="GET","zone2"==b?h="/goform/formiPhoneAppDirect.xml?Z2SOURCE":"zone2"==b&&(h="/goform/formiPhoneAppDirect.xml?Z3SOURCE")):"Quick1"==a?e="cmd0=PutUserMode/Quick1":"Quick2"==a?e="cmd0=PutUserMode/Quick2":"Quick3"==a?e="cmd0=PutUserMode/Quick3":"Quick4"==a?e="cmd0=PutUserMode/Quick4":"playPause"==a?e="cmd0=PutNetAudioCommand/CurEnter":
"previous"==a?e="cmd0=PutNetAudioCommand/CurUp":"next"==a?e="cmd0=PutNetAudioCommand/CurDown":0==a.indexOf("tuner")?(a=a.replace(/tuner/g,""),d="GET",h="/goform/formiPhoneAppTuner.xml",a="Up"==a?"PRESETUP":"Down"==a?"PRESETDOWN":"PRESETCALL0"+a,h+="?"+("zone2"==b?"2+"+a:"zone3"==b?"3+"+a:"1+"+a),e=null):-1!=this.audioModes.indexOf(a)?(d="GET",h="/goform/formiPhoneAppDirect.xml?MS"+encodeURI(a),e=null):-1!=this.audioModesDesc.indexOf(a)?(a=this.audioModes[this.audioModesDesc.indexOf(a)],d="GET",h=
"/goform/formiPhoneAppDirect.xml?MS"+encodeURI(a),e=null):"customCMD"==b?(d="GET",h=a):0==a.indexOf("setToDB")?(0==a.indexOf("setToDB")&&(a=a.replace(/setToDB/g,"")),"mainzone"==b?(a=parseFloat(a),-80>a?a=-80:18<a&&(a=18),a=a.toFixed(1),e="cmd0=PutMasterVolumeSet/"+a):"zone2"==b?(a=parseInt(a),-80>a?a=-80:18<a&&(a=18),a=a.toFixed(1),e="cmd0=PutMasterVolumeSet/"+a+"&ZoneName=ZONE2"):"zone3"==b&&(a=parseInt(a),-80>a?a=-80:18<a&&(a=18),a=a.toFixed(1),e="cmd0=PutMasterVolumeSet/"+a+"&ZoneName=ZONE3")):
b&&(0==a.indexOf("setTo")&&(a=a.replace(/setTo/g,"")),"mainzone"==b?(a=parseFloat(a),0>a?a=0:98<a&&(a=98),a=(a-80).toFixed(1),e="cmd0=PutMasterVolumeSet/"+a):"zone2"==b?(a=parseInt(a),0>a?a=0:80<a&&(a=80),e="cmd0=PutMasterVolumeSet/"+(a-80)+"&ZoneName=ZONE2"):"zone3"==b&&(a=parseInt(a),0>a?a=0:80<a&&(a=80),e="cmd0=PutMasterVolumeSet/"+(a-80)+"&ZoneName=ZONE3"));f&&this._doRequest(d,h,e,c)};g.prototype.getStateValues=function(a,c){return c};g.prototype.toJSON=function(){var a={sys:xnm.aio.denon.DM.SYS,
type:"avr",ip:this.ip,port:this.port,uuid:this.uuid,model:this.model};this.name&&(a.name=this.name);return a};g.prototype.equalsTo=function(a){return a&&a instanceof g?this.ip==a.ip&&this.port==a.port:!1};g.parseJSON=function(a){return a.ip?new g(a.ip,a.port,a.uuid,a.name,a.model):null};return g}();
xnm.aio.denon.AVR2=function(){var g=function(){var a=function(){this._stateExpiredTime=300;this._errorStateExpiredTime=10;this._buffer={}};a.prototype.reset=function(){this._buffer={}};a.prototype.getState=function(d){var a=Math.round((new Date).getTime()/1E3);if(this._buffer[d])if(d=this._buffer[d],!d.update||null==d.value&&a-d.update>this._errorStateExpiredTime||a-d.update>this._stateExpiredTime)d.update=a,d.value=null;else return d.value;else this._buffer[d]={update:a,value:null}};a.prototype.putState=
function(d,a){var b={};b.update=Math.round((new Date).getTime()/1E3);b.value=a;this._buffer[d]=b};return a}(),a=function(){var a=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.denon.AVR2._Controller");var d=this;this._session=new c;this._session.on("open",function(){d._state="OPEN";d._logger.log("trace","session opened");d._emitEvent("open")});this._session.on("close",function(){d._state="IDLE";d._reset();d._logger.log("trace","session closed");d._emitEvent("close")});this._session.on("error",
function(a){d._state="CONNECT";d._logger.log("trace","session error:"+a.message);d._reset()});this._session.on("event",function(a){d._logger.log("trace","receive session event:"+a);d._processAVREvent(a)});this._state="IDLE";this._stateBuffer=new g;this._listeners={}};a.prototype.isIdle=function(){return"IDLE"==this._state};a.prototype.on=function(d,a){d&&a&&(this._listeners[d]||(this._listeners[d]=[]),-1==this._listeners[d].indexOf(a)&&this._listeners[d].push(a))};a.prototype.off=function(d,a){d&&
a&&this._listeners[d]&&(a=this._listeners[d].indexOf(a),-1!=a&&this._listeners[d].splice(a,1))};a.prototype.open=function(d){"IDLE"==this._state&&(this._logger.log("trace","open session"),this._state="CONNECT",this._session.open(d))};a.prototype.close=function(){"IDLE"!=this._state&&(this._logger.log("trace","close session"),this._state="CLOSED",this._session.close())};a.prototype.sendCommand=function(d,a,b){this._logger.log("trace","send command:"+d+" param:"+a);var c=this;this._session.sendCommand(d,
a,function(d,a){d?c._logger.log("trace","send command failed:"+d.message):c._logger.log("trace","send command success:"+a);b&&b(d,a)})};a.prototype.getState=function(d,a){this._logger.log("trace","get state:"+d);var b=this._stateBuffer.getState(d);if("undefined"!=typeof b)this._logger.log("trace","get buffered state:"+b),a&&a(null,b);else{var c=this,h=d,e="?";if("CV"==h.substr(0,2))h="CV";else if("MSQUICK"==h)e=" ?";else if("VS"==h.substr(0,2))e=" ?";else if("PS"==h.substr(0,2))"PSFRONT"!=h&&(e=" ?"),
"PSSWL2"==h&&(h="PSSWL");else if("PV"==h.substr(0,2))"PV"!=h&&(e=" ?");else if("TR"==h.substr(0,2))h="TR";else if("DIM"==h.substr(0,3))e=" ?";else if("Z2"==h.substr(0,2))if("Z2QUICK"==h||"Z2PSBAS"==h||"Z2PSTRE"==h)e=" ?";else{if("Z2:POWER"==h||"Z2:VOLUME"==h||"Z2:INPUT"==h)h="Z2"}else if("Z3"==h.substr(0,2))if("Z3QUICK"==h||"Z3PSBAS"==h||"Z3PSTRE"==h)e=" ?";else if("Z3:POWER"==h||"Z3:VOLUME"==h||"Z3:INPUT"==h)h="Z3";this._logger.log("trace","do send state request:"+h);this._session.sendCommand(h,
e,function(l){l?(c._logger.log("trace","get state failed:"+l.message),a&&a(l)):"CV"==h||"MS"==h||"PSSWL"==h||"TR"==h||"Z2"==h||"Z3"==h?setTimeout(function(){c._logger.log("trace","get state "+h+" success");b=c._stateBuffer.getState(d);a&&a(null,b)},250):(c._logger.log("trace","get state "+h+" success"),b=c._stateBuffer.getState(d),a&&a(null,b))})}};a.prototype._reset=function(){this._stateBuffer.reset()};a.prototype._emitEvent=function(d,a){if(d){var b=this._listeners[d];if(b&&0<b.length)for(var c=
0;c<b.length;c++){var h=b[c];try{h(a)}catch(m){this._logger.log("trace","call "+d+" listener failed, error:"+m.message)}}}};a.prototype._processAVREvent=function(d){if(d&&!(2>d.length)){var a=d.split(" ");if("CVEND"!=d&&"DC"!=d.substr(0,2)&&"SY"!=d.substr(0,2)&&"NS"!=d.substr(0,2)&&"UG"!=d.substr(0,2)){if("CV"==d.substr(0,2)){var b=a[0];var c=a[1].trim()}else if("SV"==d.substr(0,2))b=d.substr(0,2),c=d.substr(2).trim();else if("STBY"==d.substr(0,4))b="STBY",c=d.substr(4).trim();else if("ECO"==d.substr(0,
3))b="ECO",c=d.substr(3).trim();else if("SLP"==d.substr(0,3))b="SLP",c=d.substr(3).trim();else if("MS"==d.substr(0,2))"MSQUICK"==d.substr(0,7)?(b="MSQUICK",c=d.substr(7).trim()):(b=d.substr(0,2),c=d.substr(2).trim());else if("VS"==d.substr(0,2))"VSASP"==d.substr(0,5)?(b="VSASP",c=d.substr(5).trim()):"VSMONI"==d.substr(0,6)?(b="VSMONI",c=d.substr(6).trim()):"VSSCH"==d.substr(0,5)?(b="VSSCH",c=d.substr(5).trim()):"VSSC"==d.substr(0,4)?(b="VSSC",c=d.substr(4).trim()):"VSVST"==d.substr(0,5)?(b="VSVST",
c=d.substr(5).trim()):"VSAUDIO"==d.substr(0,7)?(b="VSAUDIO",c=d.substr(7).trim()):"VSVPM"==d.substr(0,5)&&(b="VSVPM",c=d.substr(5).trim());else if("PS"==d.substr(0,2))"PSSP:"==d.substr(0,5)?(b="PSSP:",c=d.substr(5).trim()):"PSTONE CTRL"==d.substr(0,11)?(b="PSTONE CTRL",c=d.substr(11).trim()):"PSCINEMA EQ."==d.substr(0,12)?(b="PSCINEMA EQ.",c=d.substr(12).trim()):"PSMULTEQ:"==d.substr(0,9)?(b="PSMULTEQ:",c=d.substr(9).trim()):(b=a[0],c=a[1].trim());else if("PV"==d.substr(0,2))2==a.length?(b=a[0],c=
a[1].trim()):(b=d.substr(0,2),c=d.substr(2).trim());else if("MN"==d.substr(0,2))b=a[0],c=a[1].trim();else if("TR"==d.substr(0,2))b=a[0],c=a[1].trim();else if("DIM"==d.substr(0,3))b=a[0],c=a[1].trim();else if("TF"==d.substr(0,2))"TFANNAME"==d.substr(0,8)?(b="TFANNAME",c=d.substr(8).trim()):"TFAN"==d.substr(0,4)&&(b="TFAN",c=d.substr(4).trim());else if("TP"==d.substr(0,2))"TPAN"==d.substr(0,4)&&(b="TPAN",c=d.substr(4).trim());else if("TM"==d.substr(0,2))b=d.substr(0,2),c=d.substr(2).trim();else if("Z2"==
d.substr(0,2))if("Z2MU"==d.substr(0,4))b="Z2MU",c=d.substr(4).trim();else if("Z2STBY"==d.substr(0,6))b="Z2STBY",c=d.substr(6).trim();else if("Z2CS"==d.substr(0,4))b="Z2CS",c=d.substr(4).trim();else if("Z2CV"==d.substr(0,4))b=a[0],c=a[1].trim();else if("Z2HPF"==d.substr(0,5))b="Z2HPF",c=d.substr(5).trim();else if("Z2PS"==d.substr(0,4))b=a[0],c=a[1].trim();else if("Z2SLP"==d.substr(0,5))b="Z2SLP",c=d.substr(5).trim();else if("Z2HDA"==d.substr(0,5))b="Z2HDA",c=d.substr(5).trim();else if(c=d.substr(2).trim(),
isNaN(parseInt(c)))switch(c){case "ON":case "OFF":b="Z2:POWER";break;case "QUICK1":case "QUICK2":case "QUICK3":case "QUICK4":case "QUICK5":b="Z2QUICK";break;default:b="Z2:INPUT"}else b="Z2:VOLUME";else if("Z3"==d.substr(0,2))if("Z3MU"==d.substr(0,4))b="Z3MU",c=d.substr(4).trim();else if("Z3STBY"==d.substr(0,6))b="Z3STBY",c=d.substr(6).trim();else if("Z3CS"==d.substr(0,4))b="Z3CS",c=d.substr(4).trim();else if("Z3CV"==d.substr(0,4))b=a[0],c=a[1].trim();else if("Z3HPF"==d.substr(0,5))b="Z3HPF",c=d.substr(5).trim();
else if("Z3PS"==d.substr(0,4))b=a[0],c=a[1].trim();else if("Z3SLP"==d.substr(0,5))b="Z3SLP",c=d.substr(5).trim();else if(c=d.substr(2).trim(),isNaN(parseInt(c)))switch(c){case "ON":case "OFF":b="Z3:POWER";break;case "QUICK1":case "QUICK2":case "QUICK3":case "QUICK4":case "QUICK5":b="Z3QUICK";break;default:b="Z3:INPUT"}else b="Z3:VOLUME";else b=d.substr(0,2),c=d.substr(2).trim();b&&c&&this._stateBuffer.putState(b,c)}}};return a}(),c=function(){var a=function(){};a.prototype.searchAVR=function(a,d){require("x.upnp.js").discoverDevicesWithTimeout(3E3,
function(b){if(0==b.name.indexOf("Denon AVR")&&b.uuid==a){var c=b.modelName;c&&"*"==c.charAt(0)&&(c=c.substr(1));d&&d(null,{ip:b.ip,uuid:b.uuid,name:b.name,model:c})}})};var d=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.denon.AVR2._Session._Monitor");this._monitorCallback=this._socket=null;this._commandTimeoutCount=0;this._heartBeatTo=null;this._heatBeatMissCount=0;var a=this;this._socketErrorCallback=function(d){a._finishRun(d)};this._socketCloseCallback=function(){a._finishRun(Error("socket closed"))}};
d.prototype.run=function(a,d){this._socket=a;this._monitorCallback=d;this._setListener();this.scheduleNextHeartBeat()};d.prototype.reset=function(){this._monitorCallback=null;this._heatBeatMissCount=0;this._heartBeatTo&&(clearTimeout(this._heartBeatTo),this._heartBeatTo=null);if(this._socket){var a=this._socket;this._clearListener();this._socket=null;a.close()}};d.prototype.executeCommandTimeout=function(a){a?(this._commandTimeoutCount++,this._logger.log("warn","execute command timeout#"+this._commandTimeoutCount),
3<this._commandTimeoutCount&&this._finishRun(Error("execute command is always timeout"))):this._commandTimeoutCount=0};d.prototype.scheduleNextHeartBeat=function(a){this._scheduleNextHeartBeat(a?a:15E3)};d.prototype._scheduleNextHeartBeat=function(a){var d=this;this._heartBeatTo&&clearTimeout(this._heartBeatTo);this._heartBeatTo=setTimeout(function(){d._checkHeartBeat()},a)};d.prototype._checkHeartBeat=function(){if(this._socket){this._logger.log("trace","check heart beat");var a=this;this._socket.sendCommand("PW",
"?",function(d){d?(a._heatBeatMissCount++,a._logger.log("warn","check heart beat failed #"+a._heatBeatMissCount+", error:"+d.message),a._scheduleNextHeartBeat(2E3)):(a._heatBeatMissCount=0,a._scheduleNextHeartBeat(15E3));3<a._heatBeatMissCount&&a._finishRun(Error("heart beat failed"))})}};d.prototype._setListener=function(){this._socket&&(this._socket.on("error",this._socketErrorCallback),this._socket.on("close",this._socketCloseCallback))};d.prototype._clearListener=function(){this._socket&&(this._socket.off("error",
this._socketErrorCallback),this._socket.off("close",this._socketCloseCallback))};d.prototype._finishRun=function(a){var d=this._socket;this._socket&&(this._clearListener(),this._socket=null);a&&d&&d.close();this._heartBeatInterval&&(clearInterval(this._heartBeatInterval),this._heartBeatInterval=null);this._heatBeatMissCount=this._commandTimeoutCount=0;this._monitorCallback&&(d=this._monitorCallback,this._monitorCallback=null,d(a))};var c=function(){this._connectCallback=this._socket=this._connectWaitTo=
null;var a=this;this._socketOpenCallback=function(){a._finishConnect()};this._socketErrorCallback=function(d){a._finishConnect(d)};this._socketCloseCallback=function(){a._finishConnect(Error("socket closed"))}};c.prototype.connect=function(a,d){this._connectCallback=d;d=a.wait;delete a.wait;this._socket=new e(a);this._setListener();if(d){var b=this;this._connectWaitTo=setTimeout(function(){b._socket.open()},d)}else this._socket.open();return this._socket};c.prototype.reset=function(){this._connectWaitTo&&
clearTimeout(this._connectWaitTo);this._connectCallback=this._connectWaitTo=null;if(this._socket){var a=this._socket;this._clearListener();this._socket=null;a.close()}};c.prototype._setListener=function(){this._socket&&(this._socket.on("open",this._socketOpenCallback),this._socket.on("error",this._socketErrorCallback),this._socket.on("close",this._socketCloseCallback))};c.prototype._clearListener=function(){this._socket&&(this._socket.off("open",this._socketOpenCallback),this._socket.off("error",
this._socketErrorCallback),this._socket.off("close",this._socketCloseCallback))};c.prototype._finishConnect=function(a){var d=this._socket;this._socket&&(this._clearListener(),this._socket=null);a&&d&&d.close(a);if(this._connectCallback){var b=this._connectCallback;this._connectCallback=null;b(a,d)}};var f=function(){this._logger=require("x.logger.js").getLogger("xnm.aio.denon.AVR2._Session");this._connect=new c;this._monitor=new d;this._discover=new a;var b=this;this._socketEventCallback=function(a){b._logger.log("trace",
"receive event:"+a);b._monitor.scheduleNextHeartBeat();b._emitEvent("event",a)};this._socket=null;this._state="IDLE";this._uuid=this._port=this._ip=null;this._eventListeners={};this._connectFailCount=0};f.prototype.on=function(a,d){a&&d&&(this._eventListeners[a]||(this._eventListeners[a]=[]),-1==this._eventListeners[a].indexOf(d)&&this._eventListeners[a].push(d))};f.prototype.off=function(a,d){a&&d&&this._eventListeners[a]&&(d=this._eventListeners[a].indexOf(d),-1!=d&&this._eventListeners[a].splice(d,
1))};f.prototype.open=function(a){a&&"IDLE"==this._state&&(this._ip=a.ip,this._port=a.port,this._uuid=a.uuid,this._logger.log("debug","start controller for "+this._ip),this._doFSM("init"))};f.prototype.close=function(){"IDLE"!=this._state&&(this._logger.log("debug","stop controller"),this._doFSM("stop"))};f.prototype.sendCommand=function(a,d,b){if("IDLE"==this._state)a=Error("session not initialized"),a.sys="denon",a.code=-4,b&&b(a);else{this._logger.log("trace","send command:"+a+d+" to "+this._ip);
var c=this;this._socket.sendCommand(a,d,function(a,d){a?-3==a.code?(c._monitor.scheduleNextHeartBeat(),c._monitor.executeCommandTimeout(!0)):c._monitor.executeCommandTimeout(!1):(c._monitor.scheduleNextHeartBeat(),c._monitor.executeCommandTimeout(!1));a?c._logger.log("trace","send command failed:"+a.message):c._logger.log("trace","send command success:"+d);b&&b(a,d)})}};f.prototype._emitEvent=function(a,d){if(a){var b=this._eventListeners[a];if(b&&0<b.length)for(var c=0;c<b.length;c++){var h=b[c];
try{h(d)}catch(n){this._logger.log("trace","call "+a+" listener failed, error:"+n.message)}}}};f.prototype._connectAVR=function(a){this._logger.log("trace","connect avr device:"+this._ip+(a?" after "+a+" ms":""));var d=this;this._socket=this._connect.connect({ip:this._ip,port:this._port,uuid:this._uuid,wait:a},function(a,b){a?(d._logger.log("trace","connect to avr device:"+d._ip+" failed, error:"+a.message),d._doFSM("conn_fail")):(d._logger.log("trace","connect to avr device:"+d._ip+" success"),d._socket=
b,d._doFSM("conn_ok"))})};f.prototype._stopConnectAVR=function(){this._logger.log("trace","stop connect avr device:"+this._ip);this._connect.reset();this._reset()};f.prototype._runAVR=function(){this._logger.log("trace","monitor avr device:"+this._ip);var a=this;this._monitor.run(this._socket,function(d){d&&(a._logger.log("trace","monitor avr device:"+a._ip+" failed, error:"+d.message),a._socket=null,a._doFSM("run_error"),a._emitEvent("error",d))});this._setListener();this._emitEvent("open")};f.prototype._stopRunAVR=
function(){this._logger.log("trace","stop monitor avr device:"+this._ip);this._monitor.reset();this._clearListener();this._emitEvent("close");this._reset()};f.prototype._searchAVR=function(){if(this._uuid){var a=this;this._discover.searchAVR(this._uuid,function(d,b){!d&&b&&b.ip!=a._ip&&(a._logger.log("trace","find avr ("+a._uuid+") with new ip:"+b.ip),"CONNECT"==a._state&&(a._ip=b.ip,a._connect.reset(),a._connectAVR()))})}};f.prototype._setListener=function(){if(this._socket)this._socket.on("event",
this._socketEventCallback)};f.prototype._clearListener=function(){this._socket&&this._socket.off("event",this._socketEventCallback)};f.prototype._reset=function(){this._uuid=this._port=this._ip=this._socket=null;this._connectFailCount=0};f.prototype._doFSM=function(a){this._logger.log("trace","FSM current state:"+this._state+" input:"+a);switch(this._state){case "IDLE":switch(a){case "init":this._state="CONNECT",this._logger.log("trace","FSM new state:"+this._state),this._connectAVR()}break;case "CONNECT":switch(a){case "conn_fail":this._connectFailCount++;
this._state="CONNECT";this._logger.log("trace","FSM new state:"+this._state);2<=this._connectFailCount&&this._searchAVR();this._connectAVR(Math.min(3E4,5E3*this._connectFailCount));break;case "conn_ok":this._connectFailCount=0;this._state="RUN";this._logger.log("trace","FSM new state:"+this._state);this._runAVR();break;case "stop":this._state="IDLE",this._logger.log("trace","FSM new state:"+this._state),this._stopConnectAVR()}break;case "RUN":switch(a){case "run_error":this._state="CONNECT";this._logger.log("trace",
"FSM new state:"+this._state);this._connectAVR();break;case "stop":this._state="IDLE",this._logger.log("trace","FSM new state:"+this._state),this._stopRunAVR()}}};return f}(),e=function(){var a=function(a){if(!a)throw Error("options is null");if(!a.ip)throw Error("no ip");this._logger=require("x.logger.js").getLogger("xnm.aio.denon.AVR2._Socket");this._responseTimeout=300;this._ip=a.ip;this._port=a.port;this._port||(this._port=23);this._timeout=2E3;this._listeners={};this._socket=null;this._buf="";
this._state="IDLE";this._commands=[]};a.prototype.on=function(a,b){a&&b&&(this._listeners[a]||(this._listeners[a]=[]),-1==this._listeners[a].indexOf(b)&&this._listeners[a].push(b))};a.prototype.off=function(a,b){a&&b&&this._listeners[a]&&(b=this._listeners[a].indexOf(b),-1!=b&&this._listeners[a].splice(b,1))};a.prototype.open=function(){if(!this._socket&&"IDLE"==this._state){var a=this;this._state="CONNECT";this._buf="";var b=require("net").connect({port:this._port,host:this._ip});b.setTimeout(this._timeout);
b.setEncoding("utf8");this._logger.log("trace","start connect to "+this._ip+":"+this._port);b.on("connect",function(){a._logger.log("trace","success to connect "+a._ip+":"+a._port);a._state="CONNECTED";a._emitEvent("open");a._executeNextCommand()});b.on("data",function(d){a._logger.log("trace","receive data: "+d.toString());a._buf+=d.toString();a._processBuffer()});b.on("error",function(d){a._logger.log("trace","socket error: "+d.message);a._emitEvent("error",d)});b.on("timeout",function(){"CONNECT"==
a._state&&(a._logger.log("trace","connect timeout"),a._emitEvent("error",Error("connect timeout")),a.close(Error("connect timeout")))});b.on("close",function(){a._logger.log("trace","socket closed");a._onClose()});b._doConnect&&"function"==typeof b._doConnect&&b._doConnect();this._socket=b}};a.prototype.close=function(a){this._socket&&(this._state="CLOSED",this._socket.destroy(),this._onClose(a))};a.prototype.sendCommand=function(a,b,c){if("CLOSED"==this._state)a=Error("socket closed"),a.code=-1,
c&&c(a);else if(a&&b){var d=this._commands.length;this._commands.push({command:a,param:b,callback:c,timeout:null,state:"IDLE",responseTimeout:this._responseTimeout});0==d&&this._executeNextCommand()}else a=Error("invalid command"),a.code=-2,c&&c(a)};a.prototype._executeNextCommand=function(){var a=this._commands[0];if(a&&"IDLE"==a.state&&"CONNECTED"==this._state){var b=a.command+a.param+"\r";a.state="SENT";this._setupReponseTimeout(a);this._logger.log("debug","send command:"+b);a=new Buffer(b);this._socket.write(a)}};
a.prototype._setupReponseTimeout=function(a){var b=this;a.timeout=setTimeout(function(){b._commands.splice(0,1);a.state="TIMEOUT";if(a.callback){b._logger.log("debug","response timeout");var d=Error("response timeout");d.code=-3;a.callback(d)}b._executeNextCommand()},a.responseTimeout)};a.prototype._emitEvent=function(a,b){if(a){var d=this._listeners[a];if(d&&0<d.length)for(var c=0;c<d.length;c++){var e=d[c];try{e(b)}catch(m){this._logger.log("trace","call "+a+" listener failed, error:"+m.message)}}}};
a.prototype._processBuffer=function(){for(var a=this._buf.indexOf("\r");-1!=a;){if(0!=a){var b=this._buf.substr(0,a);this._processResponse(b)}this._buf=this._buf.substr(a+1);a=this._buf.indexOf("\r")}};a.prototype._processResponse=function(a){this._logger.log("debug","receive response: "+a);try{this._emitEvent("event",a);var b=this._commands[0];if(b&&"SENT"==b.state&&b.command&&b.command.substr(0,2)==a.substr(0,2)){clearTimeout(b.timeout);try{b.callback&&b.callback(null,a)}catch(k){this._logger.log("debug",
"do command callback error: "+k.message)}this._commands.splice(0,1);this._executeNextCommand()}}catch(k){this._logger.log("debug","process response error: "+k.message)}};a.prototype._onClose=function(a){this._state="CLOSED";this._socket=null;this._emitEvent("close");this._listeners={};a=a?a:Error("socket closed");a.code=-1;for(var b=0;b<this._commands.length;b++){var d=this._commands[b];d.timeout&&clearTimeout(d.timeout);d.callback&&d.callback(a)}this._commands=[];this._buf=""};return a}(),f=function(b){this._ip=
b.ip;this._port=b.port;this._uuid=b.uuid;this._model=b.model;this._name=b.name;this._port||(this._port=23);this._controller=new a};f.prototype.executeCommandCreator=function(a,d,c){if(d&&d.value){var b=a=null;d.path&&d.path[0]&&(a=d.path[0]);switch(a){case "global":b=0;break;case "mainzone":b=1;break;case "zone2":b=2;break;case "zone3":b=3}if("netradio"!=a)switch(d.value){case "on":this.setPower(b,!0,c);break;case "off":this.setPower(b,!1,c);break;case "toggle":this.togglePower(b,c)}}else c&&c(Error("command json invalid"))};
f.prototype.setPower=function(a,d,c){var b=null,e=null;switch(a){case 0:b="PW";e=d?"ON":"STANDBY";break;case 1:b="ZM";e=d?"ON":"OFF";break;case 2:b="Z2";e=d?"ON":"OFF";break;case 3:b="Z3",e=d?"ON":"OFF"}b&&e?this._sendCommand(b,e,function(a){a?c&&c(a):setTimeout(function(){c&&c()},1E3)}):c&&c(Error("invalid command"))};f.prototype.togglePower=function(a,d){var b=this;this.getPower(a,function(c,e){c?d&&d(c):(value="on"==e?!1:!0,b.setPower(a,value,d))})};f.prototype.getPower=function(a,d){var b=null;
switch(a){case 0:b="PW";break;case 1:b="ZM";break;case 2:b="Z2:POWER";break;case 3:b="Z3:POWER"}this._getState(b,function(a,b){a?d&&d(a):b?d&&d(null,"ON"==b?"on":"off"):d&&d(null,null)})};f.prototype.volumeUp=function(a,d){var b=null;switch(a){case 1:b="MV";break;case 2:b="Z2";break;case 3:b="Z3"}b?this._sendCommand(b,"UP",function(a){d&&d(a)}):d&&d(Error("invalid command"))};f.prototype.volumeDown=function(a,d){var b=null;switch(a){case 1:b="MV";break;case 2:b="Z2";break;case 3:b="Z3"}b?this._sendCommand(b,
"DOWN",function(a){d&&d(a)}):d&&d(Error("invalid command"))};f.prototype.setVolume=function(a,d,c){var b=null;switch(a){case 1:b="MV";break;case 2:b="Z2";break;case 3:b="Z3"}b?this._sendCommand(b,d,function(a){c&&c(a)}):c&&c(Error("invalid command"))};f.prototype.getVolume=function(a,d){var b=null;switch(a){case 1:b="ZM";break;case 2:b="Z2:VOLUME";break;case 3:b="Z3:VOLUME"}this._getState(b,function(a,b){a?d&&d(a):b?(a=parseInt(b)/10,d&&d(null,a,a-80)):d&&d(null,null)})};f.prototype.setMute=function(a,
d,c){var b=null;d=d?"ON":"OFF";switch(a){case 1:b="MU";break;case 2:b="Z2MU";break;case 3:b="Z3MU"}b&&d?this._sendCommand(b,d,function(a){c&&c(a)}):c&&c(Error("invalid command"))};f.prototype.toggleMute=function(a,c){var b=this;this.getMute(key,function(d,e){d?c&&c(d):(value="on"==e?!1:!0,b.setMute(a,value,c))})};f.prototype.getMute=function(a,c){var b=null;switch(a){case 1:b="MU";break;case 2:b="Z2MU";break;case 3:b="Z3MU"}this._getState(b,function(a,b){a?c&&c(a):b?c&&c(null,"ON"==b?"on":"off"):
c&&c(null,null)})};f.prototype.setInput=function(a,c,e){var b=null;switch(a){case 1:b="SI";break;case 2:b="Z2";break;case 3:b="Z3"}b&&c?this._sendCommand(b,c,function(a){e&&e(a)}):e&&e(Error("invalid command"))};f.prototype.getInput=function(a,c){var b=null;switch(a){case 1:b="SI";break;case 2:b="Z2:INPUT";break;case 3:b="Z3:INPUT"}this._getState(b,function(a,b){a?c&&c(a):c&&c(null,b)})};f.prototype._sendCommand=function(a,c,e){this._controller.isIdle()&&this._controller.open(this.toJSON());this._controller.sendCommand(a,
c,e)};f.prototype._getState=function(a,c){this._controller.isIdle()&&this._controller.open(this.toJSON());this._controller.getState(a,c)};f.prototype.toJSON=function(){return{sys:"denon",type:"avr2",ip:this._ip,port:this._port,uuid:this._uuid,model:this._model,name:this._name}};f.prototype.equalsTo=function(a){return a&&a instanceof f?this._ip==a._ip&&this._port==a._port:!1};f.parseJSON=function(a){return a&&a.ip?new f(a):null};f._Socket=e;f._Session=c;f._Controller=a;return f}();
xnm.aio.marantz.WebAVR=function(g,a,c,e,f){xnm.aio.denon.WebAVR.call(this,g,a,c,e,f);this._logger=require("x.logger.js").getLogger("xnm.aio.marantz.WebAVR")};xnm.aio.marantz.WebAVR.prototype=new xnm.aio.denon.WebAVR;xnm.aio.marantz.WebAVR.prototype.constructor=xnm.aio.marantz.WebAVR;xnm.aio.marantz.WebAVR.prototype.toJSON=function(){var g={sys:xnm.aio.denon.DM.MARANTZ_SYS,type:"avr",ip:this.ip,port:this.port,uuid:this.uuid,model:this.model};this.name&&(g.name=this.name);return g};
xnm.aio.marantz.WebAVR.prototype.equalsTo=function(g){return g&&g instanceof xnm.aio.marantz.WebAVR?this.ip==g.ip&&this.port==g.port:!1};xnm.aio.marantz.WebAVR.parseJSON=function(g){return g.ip?new xnm.aio.marantz.WebAVR(g.ip,g.port,g.uuid,g.name,g.model):null};
xnm.aio.denon.DM=function(){var g=function(a,e){this.code=a;this.message=e;this.stack=Error().stack};g.prototype=Error();g.prototype.name="DenonDMError";g.prototype.code=0;g.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var a={avr:{command:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",
name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"Quick Select 1",ref:{value:"Quick1"}},{type:"enum",name:"Quick Select 2",ref:{value:"Quick2"}},{type:"enum",name:"Quick Select 3",ref:{value:"Quick3"}},{type:"enum",name:"Quick Select 4",ref:{value:"Quick4"}},{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}},{type:"enum",name:"open denon Remote App",ref:{value:"openNative"}}]},{type:"root",name:"Internetradio",value:"netradio",
children:[{type:"enum",name:"play/pause",ref:{value:"playPause"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},
{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",ext:"%f",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;Online Music;Bluetooth;Internetradio;Media Server;CD;PHONO".split(";")}},
{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",extMeta:"1-50",scale:"1"}},{type:"enum",name:"set sound modus",ref:{value:"audioMode",ext:"%e",extMeta:"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";")}}]},{type:"root",name:"zone 2",value:"zone2",
children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",ext:"%d",extMeta:"0-80",scale:"1"}},
{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"CBL/SAT;Media Player;iPod/USB;Tuner;Online Music;Bluetooth;Internetradio;Media Server;Source".split(";")}},{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",extMeta:"1-50",scale:"1"}}]},{type:"root",
name:"zone 3",value:"zone3",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",
ext:"%d",extMeta:"0-80",scale:"1"}},{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"CBL/SAT;Media Player;iPod/USB;Tuner;Online Music;Bluetooth;Internetradio;Media Server;Source".split(";")}},{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",
extMeta:"1-50",scale:"1"}}]}],status:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on",
"off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}},{type:"enum",name:"sound modus",ref:{value:"audioMode",options:"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";")}}]},
{type:"root",name:"zone 2",value:"zone2",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}}]},
{type:"root",name:"zone 3",value:"zone3",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}}]}]},
avr2:{command:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}},{type:"enum",name:"open denon Remote App",ref:{value:"openNative"}}]},{type:"root",name:"Internetradio",value:"netradio",children:[{type:"enum",name:"play/pause",ref:{value:"playPause"}},{type:"enum",name:"previous",
ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",
ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",ext:"%f",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"PHONO CD DVD BD TV SAT/CBL MPLAY GAME TUNER HDRADIO IRADIO SERVER FAVORITES AUX1 AUX2 AUX3 AUX4 AUX5 AUX6 AUX7 NET BT".split(" ")}},{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",
ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",extMeta:"1-50",scale:"1"}},{type:"enum",name:"set sound modus",ref:{value:"audioMode",ext:"%e",extMeta:"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";")}}]},{type:"root",name:"zone 2",value:"zone2",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},
{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",ext:"%d",extMeta:"0-80",scale:"1"}},{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},
{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"SOURCE PHONO CD DVD BD TV SAT/CBL MPLAY GAME TUNER HDRADIO PANDORA SIRIUSXM IRADIO SERVER FAVORITES AUX1 AUX2 AUX3 AUX4 AUX5 AUX6 AUX7 NET BT".split(" ")}},{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",extMeta:"1-50",scale:"1"}}]},{type:"root",name:"zone 3",value:"zone3",children:[{type:"enum",
name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",ext:"%d",extMeta:"0-80",scale:"1"}},{type:"float",name:"volume to (db)",
ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"SOURCE PHONO CD DVD BD TV SAT/CBL MPLAY GAME TUNER HDRADIO IRADIO SERVER FAVORITES AUX1 AUX2 AUX3 AUX4 AUX5 AUX6 AUX7 NET BT".split(" ")}},{type:"int",name:"quick select",ref:{value:"quick",ext:"%d",extMeta:"1-5"}}]}],status:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}}]},{type:"root",name:"main zone",
value:"mainzone",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}},
{type:"enum",name:"sound modus",ref:{value:"audioMode",options:"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";")}}]},{type:"root",name:"zone 2",value:"zone2",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on",
"off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"SOURCE PHONO CD DVD BD TV SAT/CBL MPLAY GAME TUNER HDRADIO PANDORA SIRIUSXM IRADIO SERVER FAVORITES AUX1 AUX2 AUX3 AUX4 AUX5 AUX6 AUX7 NET BT".split(" ")}}]},{type:"root",name:"zone 3",value:"zone3",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",
ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"enum",name:"input",ref:{value:"input",options:"SOURCE PHONO CD DVD BD TV SAT/CBL MPLAY GAME TUNER HDRADIO IRADIO SERVER FAVORITES AUX1 AUX2 AUX3 AUX4 AUX5 AUX6 AUX7 NET BT".split(" ")}},{type:"int",name:"quick select",ref:{value:"quick",ext:"%d",extMeta:"1-5"}}]}]}};return{SYS:"denon",MARANTZ_SYS:"marantz",
getIPDeviceType:function(){return[{sys:this.SYS,name:"Denon AV Receiver",type:"avr"},{sys:this.MARANTZ_SYS,name:"Marantz AV Receiver",type:"avr"}]},createDevice:function(a,e,f){e=g.ERROR_CODE;a?a.ip?f(null,a):f(new g(e.INVALID,"ip is invalid")):f(new g(e.INVALID,"info is invalid"))},updateDevice:function(a,e,f){e=g.ERROR_CODE;a?a.ip?f(null,a):f(new g(e.INVALID,"ip is invalid")):f(new g(e.INVALID,"info is invalid"))},deleteDevice:function(a,e,f){f()},applyUIFilter:function(a,e,f){var b=this,c=function(a,
b,d){var e=[];a.forEach(function(a){if("root"==a.type){a=JSON.parse(JSON.stringify(a));var f=c(a.children,b,d);f&&0<f.length&&(a.children=f,e.push(a))}else{f=d.elems;if("*"==f)f=!0;else{for(var g=!1,h=0;h<f.length;h++)if(f[h]==a.type){g=!0;break}f=g}f&&(a=JSON.parse(JSON.stringify(a)),e.push(a))}});return e},g=function(a,d){var e=[],g=b.getCommandStatusMap(a,f);if(g){var h=[];switch(d.catagory){case "command":g.command&&(h=c(g.command,a,d));break;case "status":g.status&&(h=c(g.status,a,d))}e=e.concat(h)}return e};
if(!a.sys)return null;var k=JSON.parse(JSON.stringify(a)),l=null;switch(e.catagory){case "command":l=g(a,e);k.command=l;break;case "status":l=g(a,e);k.status=l;break;default:return null}return l&&0!=l.length?k:null},getCommandStatusMap:function(c){if(!c||!c.type)return null;if(c.sys==this.MARANTZ_SYS){if(!a[c.type])return null;c=JSON.parse(JSON.stringify(a[c.type]));if(c.command&&c.command[0]&&c.command[0].children){for(var e=-1,f=c.command[0].children,b=0;b<f.length;b++)if(f[b]&&f[b].ref&&f[b].ref.value&&
"openNative"==f[b].ref.value){e=b;break}-1!=e&&(f[b].name="open marantz Remote App")}return c}return a[c.type]}}}();
xnm.aio.denon.Handler=function(){var g=function(){this.detectedAVRs={};this.detectedMarantzAVRs={}};g.prototype.AVR=xnm.aio.denon.WebAVR;g.prototype.MarantzAVR=xnm.aio.marantz.WebAVR;g.prototype.AVR2=xnm.aio.denon.AVR2;g.prototype.devicemanager=xnm.aio.denon.DM;g.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"denon");a.register(this.devicemanager.MARANTZ_SYS,"denon")};g.prototype.resolveDevice=function(a){if(!a)return null;switch(a.sys){case this.devicemanager.SYS:switch(a.type){case "avr":return this.AVR.parseJSON(a);
default:return null}case this.devicemanager.MARANTZ_SYS:switch(a.type){case "avr":return this.MarantzAVR.parseJSON(a);default:return null}default:return null}};g.prototype.getDeviceCommands=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];c&&c(null,a)};g.prototype.getDeviceStatus=function(a,c){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];c&&c(null,a)};g.prototype.doCommand=function(a,c,e){var f=this.resolveDevice(a);
f?f.executeCommandCreator(a,c,function(a){e&&e(a)}):e&&e(Error("device json format invalid"))};g.prototype.doStatus=function(a,c,e,f){var b=this.resolveDevice(c);b?b.getStatesCreator(null,[{id:a,device:c,status:e}],function(a,b){a?f&&f(a):f&&f(null,b[0])}):f&&f(Error("device json format invalid"))};g.prototype.discoverDevices=function(a){var c=require("x.upnp.js");if(c){var e=this;c.discoverDevicesWithTimeout(3E3,function(c){if(0==c.name.indexOf("Denon AVR")){var b=c.modelName;b&&"*"==b.charAt(0)&&
(b=b.substr(1));b=new xnm.aio.denon.WebAVR(c.ip,null,c.uuid,c.name,b);e.detectedAVRs["uuid:"+c.uuid]||(e.detectedAVRs["uuid:"+c.uuid]=b);a(b)}})}};g.prototype.discoverWithTimeout=function(a,c){var e={};this.discoverDevices(function(a){a&&a.uuid&&!e[a.uuid]&&(e[a.uuid]=a)});setTimeout(function(){var a=[],b;for(b in e)e.hasOwnProperty(b)&&a.push(e[b]);c&&c(null,a)},a)};g.prototype.discoverMarantz=function(a){var c=require("x.upnp.js");if(c){var e=this;c.discoverDevicesWithTimeout(3E3,function(c){if(c.name&&
0==c.name.toLowerCase().indexOf("marantz")){var b=c.modelName;b&&"*"==b.charAt(0)&&(b=b.substr(1));b=new xnm.aio.marantz.WebAVR(c.ip,null,c.uuid,c.name,b);e.detectedMarantzAVRs["uuid:"+c.uuid]||(e.detectedMarantzAVRs["uuid:"+c.uuid]=b);a(b)}})}};g.prototype.discoverMarantzWithTimeout=function(a,c){var e={};this.discoverMarantz(function(a){a&&a.uuid&&!e[a.uuid]&&(e[a.uuid]=a)});setTimeout(function(){var a=[],b;for(b in e)e.hasOwnProperty(b)&&a.push(e[b]);c&&c(null,a)},a)};g.prototype.getStateValues=
function(a,c){return(new xnm.aio.denon.WebAVR).getStateValues(a.type,c)};g.prototype.getDeviceCommandList=function(a,c,e){var f=[];if(c)f.push({id:window.XC_Text.on,cmd:"on"}),f.push({id:window.XC_Text.off,cmd:"off"});else if(e&&"avr"==a.type){f.push({id:"on",cmd:"on"});f.push({id:"off",cmd:"off"});f.push({id:"toggle",cmd:"toggle"});f.push({id:"volumeDown",cmd:"volumeDown"});f.push({id:"volumeUp",cmd:"volumeUp"});f.push({id:"mute",cmd:"mute"});f.push({id:"unmute",cmd:"unmute"});f.push({id:"toggleMute",
cmd:"toggleMute"});e=f.length;for(a=0;a<e;a++)c=JSON.parse(JSON.stringify(f[a])),c.ch="mainzone",f.push(c),c=JSON.parse(JSON.stringify(f[a])),c.ch="zone2",f.push(c);f.push({id:"set volume",cmd:"setTo",step:"0.5",max:"98",ch:"mainzone"});f.push({id:"set volume",cmd:"setTo",step:"1",max:"80",ch:"zone2"});var b=[];b.push({id:"CBLSAT",cmd:"CBLSAT"});b.push({id:"DVDBlu-ray",cmd:"DVDBlu-ray"});b.push({id:"Blu-ray",cmd:"Blu-ray"});b.push({id:"Game",cmd:"Game"});b.push({id:"AUX",cmd:"AUX"});b.push({id:"AUX2",
cmd:"AUX2"});b.push({id:"MediaPlayer",cmd:"MediaPlayer"});b.push({id:"iPodUSB",cmd:"iPodUSB"});b.push({id:"TVAudio",cmd:"TVAudio"});b.push({id:"Tuner",cmd:"Tuner"});b.push({id:"NETHOME",cmd:"NETHOME"});b.push({id:"Bluetooth",cmd:"Bluetooth"});b.push({id:"IRADIO",cmd:"IRADIO"});b.push({id:"SERVER",cmd:"SERVER"});b.push({id:"CD",cmd:"CD"});b.push({id:"PHONO",cmd:"PHONO"});b.push({id:"HDRADIO",cmd:"HDRADIO"});b.push({id:"tunerUp",cmd:"tunerUp"});b.push({id:"tunerDown",cmd:"tunerDown"});b.push({id:"set tuner to",
cmd:"tuner",step:"1",min:"1",max:"50"});e=b.length;for(a=0;a<e;a++)c=JSON.parse(JSON.stringify(b[a])),c.ch="mainzone",f.push(c),c=JSON.parse(JSON.stringify(b[a])),c.ch="zone2",f.push(c);c=(new xnm.aio.denon.WebAVR).audioModes;for(a=0;a<c.length;a++)f.push({id:c[a],cmd:c[a]});f.push({id:"Quick1",cmd:"Quick1"});f.push({id:"Quick2",cmd:"Quick2"});f.push({id:"Quick3",cmd:"Quick3"});f.push({id:"Quick4",cmd:"Quick4"});f.push({id:"playPause",cmd:"playPause"});f.push({id:"previous",cmd:"previous"});f.push({id:"next",
cmd:"next"})}return f};return g}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.denon.Handler);
