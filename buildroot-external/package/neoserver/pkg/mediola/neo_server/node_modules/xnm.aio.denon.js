var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.denon=xnm.aio.denon||{};xnm.aio.marantz=xnm.aio.marantz||{};
xnm.aio.denon.AVR=function(){var e=function(a,c){this.ip=a;this.port=c;this.port||(this.port="23");this.timeout=2E3;this.CommandHandler=this._socket=null};e.prototype._doRequest=function(a,c,b){var f=require("net");if(!this._socket){var d=null,e=[];this._socket=f.connect({port:this.port,host:this.ip});this._socket.setTimeout(this.timeout);var g=this,h=null;this._socket.on("connect",function(){var c=new Buffer(a.shift()+"\r");g._socket.write(c);b&&g._socket.setTimeout(250)});this._socket.on("data",
function(b){d=d?d+b.toString():b.toString();for(b=d.indexOf("\r");0<b;)e.push(d.substr(0,b)),d=d.substr(b+1),b=d.indexOf("\r");0<a.length?(b=new Buffer(a.shift()+"\r"),g._socket.write(b)):g._socket.setTimeout(100)});this._socket.on("error",function(b){c&&(c({error:"socket error",data:null}),c=null);g._socket&&g._socket.destroy();g._socket=null});this._socket.on("timeout",function(){g._socket.destroy();g._socket=null;c&&(h=0<e.length?{error:null,data:e}:{error:"socket timeout",data:null})});this._socket.on("close",
function(){g._socket=null;c&&h&&setTimeout(function(){c(h)},250)})}};e.prototype._executeCommand=function(a,c){this._doRequest([a],function(){c&&c()},!0)};e.prototype.executeCommand=function(a,c){var b=a,f=this;"on"==a?b="PWON":"off"==a||"standby"==a?b="PWSTANDBY":"toggle"==a&&(b=null,this.getStates(function(b){b&&"on"==b.power?f._executeCommand("PWSTANDBY",c):f._executeCommand("PWON",c)}));b&&this._executeCommand(b,c)};e.prototype.getStates=function(a){var c={mainzone:{},zone2:{}};this._doRequest("PW? MU? SI? MV? ZM? Z2MU? Z2?".split(" "),
function(b){if(b.data){for(var f=0;f<b.data.length;f++){var d=b.data[f].trim();"PW"==d.substr(0,2)?c.power=d.substr(2).toLowerCase():"MV"==d.substr(0,2)?(d=d.substr(2),3==d.length?c.mainzone.volume=(parseFloat(d)/10).toFixed(1):2==d.length&&(c.mainzone.volume=parseFloat(d).toFixed(1))):"MU"==d.substr(0,2)?c.mainzone.mute=d.substr(2).toLowerCase():"SI"==d.substr(0,2)?c.mainzone.input=d.substr(2).toLowerCase():"ZM"==d.substr(0,2)?c.mainzone.power=d.substr(2).toLowerCase():"Z2MU"==d.substr(0,4)?c.zone2.mute=
d.substr(4).toLowerCase():"Z2"==d.substr(0,2)&&("Z2ON"==d?c.zone2.power="on":"Z2OFF"==d?c.zone2.power="off":(d=d.substr(2),/^\d+$/.test(d)?3==d.length?c.zone2.volume=(parseFloat(d)/10).toFixed(1):2==d.length&&(c.zone2.volume=parseFloat(d).toFixed(1)):c.zone2.input=d.toLowerCase()))}a&&a(c)}else a&&a()})};e.prototype.getStateValues=function(a,c){return c};return e}();
xnm.aio.denon.Cache={_cache:{},_getCache:function(e){return e?this._cache[e]:null},_ensureCache:function(e){if(!e)return null;this._cache[e]||(this._cache[e]={});return this._cache[e]},getConfig:function(e){return e?(e=this._getCache(e))?e.config:null:null},setConfig:function(e,a){if(!e)return null;this._ensureCache(e).config=a}};
xnm.aio.denon.WebAVR=function(){var e=function(a,c,b,f,d){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.denon.WebAVR");this.ip=a;this.port=c;this.port||(this.port=80);this.uuid=b;this.name=f;this.model=d;this.timeout=3E3;this.CommandHandler=null};e.prototype.audioModes="DIRECT;STEREO;DOLBY DIGITAL;DTS SURROUND;AUTO;MCH STEREO;SUPER STADIUM;ROCK ARENA;JAZZ CLUB;CLASSIC CONCERT;MONO MOVIE;MATRIX;VIDEO GAME;VIRTUAL".split(";");e.prototype.audioModesDesc=
"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";");e.prototype.videoInputs="CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;Online Music;Bluetooth;Internetradio;Media Server;CD;PHONO;HDRADIO".split(";");e.prototype._getConfig=function(){return xnm.aio.denon.Cache.getConfig(this.ip)};e.prototype._setConfig=function(a){xnm.aio.denon.Cache.setConfig(this.ip,
a)};e.prototype.executeCommandCreator=function(a,c,b){if(c&&c.value)if("openNative"==c.value)window&&window.XC&&window.XC.callHost&&window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()?a&&"marantz"==a.sys?window.XC.callHost("SYSTEM","startApp",{scheme:"marantzremoteapp://"}):window.XC.callHost("SYSTEM","startApp",{scheme:"denonremoteapp://"}):"Android"==window.XCHost.getType()&&(a&&"marantz"==a.sys?window.XC.callHost("SYSTEM","startApp",{scheme:"com.dmholdings.marantzremoteapp"}):
window.XC.callHost("SYSTEM","startApp",{scheme:"com.dmholdings.denonremoteapp"}))),b&&b();else{a="";c.path&&c.path[0]&&"global"!=c.path[0]&&(a=c.path[0]+":");var f=a+c.value;if("setInput"==c.value){if(!c.ext){b&&b(Error("command setInput ext format invalid"));return}f=a+c.ext}else if("audioMode"==c.value){if(!c.ext){b&&b(Error("command audioMode ext format invalid"));return}f=a+c.ext}else if("setTo"==c.value||"setToDB"==c.value){if(null==c.ext||"undefined"==typeof c.ext){b&&b(Error("command setTo ext format invalid"));
return}f+=c.ext}else if("customCMD"==c.value){if(!c.ext){b&&b(Error("command customCMD ext format invalid"));return}f="customCMD:"+c.ext}if("tuner"==c.value){if(null==c.ext||"undefined"==typeof c.ext){b&&b(Error("command tunerPreset ext format invalid"));return}f+=c.ext}this.executeCommand(f,function(a){if(a)b&&b(a);else{if(c.path&&c.path[0]&&"mainzone"==c.path[0]){if("on"==c.value||"off"==c.value||"toggle"==c.value){setTimeout(function(){b&&b()},1E3);return}if("setTo"==c.value||"setToDB"==c.value||
"volumeUp"==c.value||"volumeDown"==c.value){setTimeout(function(){b&&b()},10);return}}"setInput"==c.value||"audioMode"==c.value?setTimeout(function(){b&&b()},1E3):b&&b()}})}else b&&b(Error("command json format invalid"))};e.prototype.getStatesCreator=function(a,c,b){this.getStates(function(a,d){for(var e=[],g=0;g<c.length;g++)if(c[g]&&c[g].id){var h="?";if(d&&c[g].status&&c[g].status.value){var k="";c[g].status.path&&c[g].status.path[0]&&"global"!=c[g].status.path[0]&&(k=c[g].status.path[0]);var l=
c[g].status.value;k&&null!=d[k]&&"undefined"!=typeof d[k]?d[k][l]&&(h=d[k][l]):null!=d[l]&&"undefined"!=typeof d[l]&&(h=d[l])}e.push({id:c[g].id,status:h})}b&&b(null,e)})};e.prototype._doRequest=function(a,c,b,f){var d=this;c="http://"+this.ip+":"+this.port+c;this._logger.log("trace","send "+a+" to url:"+c+" data:"+b);var e=f;$.ajax({url:c,type:a,timeout:this.timeout,data:b,dataType:"text",cache:!0,success:function(b){d._logger.log("trace","http request success:"+b);setTimeout(function(){e&&(e(null,
b),e=null)},200)},error:function(b,c){var a="http request error:"+(b?b.status:"0")+"-"+c;d._logger.log("trace",a);e&&(e(Error(a)),e=null)}})};e.prototype._getInputList=function(a){this._doRequest("GET","/goform/formMainZone_MainZoneXmlStatus.xml",null,function(c,b){if(c)a&&a(c);else try{var f=$($.parseXML(b));if(f){var d={inputs:[],renamed:[]};f.find("InputFuncList").each(function(){$(this).find("value").each(function(){var b=$(this).text();b&&d.inputs.push(b.trim())})});f.find("RenameSource").each(function(){$(this).find("value value").each(function(){var b=
$(this).text();b&&d.renamed.push(b.trim())})});a&&a(null,d)}else a&&a(Error("MainZoneXmlStatus.xml response invalid"))}catch(e){a&&a(e)}})};e.prototype._getStateValue=function(a,c,b,f){var d=null;a.find(c).each(function(){var b=$(this).find("value");0<b.length&&(d=$(b[0]).text())});d&&f&&(d=d.trim());d&&b&&(d=d.toLowerCase());return d};e.prototype._getOriginalInputName=function(a){var c=a,b=this._getConfig();b&&b.renamed&&b.inputs&&(a=b.renamed.indexOf(a),-1!=a&&b.inputs[a]&&(c=b.inputs[a]));return c};
e.prototype._parseStates=function(a){var c={};try{var b=$($.parseXML(a));if(b){c.mainpower=this._getStateValue(b,"Power",!0,!0);"standby"==c.mainpower&&(c.mainpower="off");c.power=this._getStateValue(b,"ZonePower",!0,!0);c.mute=this._getStateValue(b,"Mute",!0,!0);c.input=this._getStateValue(b,"InputFuncSelect",!1,!0);c.audioMode=this._getStateValue(b,"selectSurround",!1,!0);c.input&&(c.originalInput=this._getOriginalInputName(c.input));"NETWORK"==c.originalInput&&(c.netfunc=this._getStateValue(b,
"NetFuncSelect",!1,!0));switch(c.originalInput){case "CBL/SAT":c.originalInput="CBL/SAT";break;case "DVD":c.originalInput="DVD/Blu-ray";break;case "Blu-ray":c.originalInput="Blu-ray";break;case "GAME":c.originalInput="Game";break;case "Media Player":c.originalInput="Media Player";break;case "iPod/USB":c.originalInput="iPod/USB";break;case "TUNER":c.originalInput="Tuner";break;case "TV AUDIO":c.originalInput="TV Audio";break;case "NETWORK":switch(c.netfunc){case "IRADIO":c.originalInput="Internetradio";
break;case "SERVER":c.originalInput="Media Server";break;default:c.originalInput="Online Music"}}var f=this._getStateValue(b,"MasterVolume",!1,!0);c.volumeDB="--"==f?"-80.0":parseFloat(f).toFixed(1);f="--"==f?0:parseFloat(f)+80;c.volume=""+f.toFixed(1)}}catch(d){}return c};e.prototype.getStates=function(a){var c={mainzone:{},zone2:{},zone3:{}},b=this;this._getConfig()?this._doRequest("GET","/goform/formMainZone_MainZoneXml.xml",null,function(f,d){!f&&d?(c.mainzone=b._parseStates(d),c.power=c.mainzone.mainpower,
delete c.mainzone.mainpower,b._doRequest("GET","/goform/formMainZone_MainZoneXml.xml?ZoneName=ZONE2",null,function(d,f){!d&&f&&(c.zone2=b._parseStates(f),delete c.zone2.mainpower);b._doRequest("GET","/goform/formMainZone_MainZoneXml.xml?ZoneName=ZONE3",null,function(d,e){!d&&f&&(c.zone3=b._parseStates(e),delete c.zone3.mainpower);a&&a(d,c)})})):a&&a(f,c)}):this._getInputList(function(c,d){c?a&&a(c):(b._setConfig(d),b.getStates(a))})};e.prototype.executeCommand=function(a,c){var b=null,f=!0,d=null,
e=a.indexOf(":");0<e&&(d=a.substr(0,e),a=a.substr(e+1));var e="POST",g="/MainZone/index.put.asp",h=this;"on"==a?b="mainzone"==d?"cmd0=PutZone_OnOff%2FON":"zone2"==d?"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE3":"cmd0=PutSystem_OnStandby%2FON":"off"==a||"standby"==a?b="mainzone"==d?"cmd0=PutZone_OnOff%2FOFF":"zone2"==d?"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE2":"zone2"==d?"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE3":"cmd0=PutSystem_OnStandby%2FSTANDBY":"toggle"==
a?(f=!1,this.getStates(function(b,a){d?"mainzone"==d?a&&a.mainzone&&"on"==a.mainzone.power?h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FOFF",c):h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FON",c):"zone2"==d?a&&a.zone2&&"on"==a.zone2.power?h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE2",c):h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE2",c):"zone3"==d&&(a&&a.zone3&&"on"==a.zone3.power?h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE3",c):h._doRequest("POST",
g,"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE3",c)):a&&"on"==a.power?h._doRequest("POST",g,"cmd0=PutSystem_OnStandby%2FSTANDBY",c):h._doRequest("POST",g,"cmd0=PutSystem_OnStandby%2FON",c)})):"mute"==a?"zone2"==d?b="cmd0=PutVolumeMute/on&ZoneName=ZONE2":"zone3"==d?b="cmd0=PutVolumeMute/on&ZoneName=ZONE3":"mainzone"==d?b="cmd0=PutVolumeMute/on":(g="/goform/AppCommand.xml",b='<?xml version="1.0" encoding="utf-8"?>\r\n<tx>\r\n<cmd id="1">SetAllZoneMute</cmd>\r\n<value>ON</value>\r\n</tx>'):"unmute"==a?"zone2"==
d?b="cmd0=PutVolumeMute/off&ZoneName=ZONE2":"zone3"==d?b="cmd0=PutVolumeMute/off&ZoneName=ZONE3":"mainzone"==d?b="cmd0=PutVolumeMute/off":(g="/goform/AppCommand.xml",b='<?xml version="1.0" encoding="utf-8"?>\r\n<tx>\r\n<cmd id="1">SetAllZoneMute</cmd>\r\n<value>OFF</value>\r\n</tx>'):"toggleMute"==a?b="zone2"==d?"cmd0=PutVolumeMute/toggle&ZoneName=ZONE2":"zone3"==d?"cmd0=PutVolumeMute/toggle&ZoneName=ZONE3":"cmd0=PutVolumeMute/toggle":"volumeDown"==a?b="zone2"==d?"cmd0=PutMasterVolumeBtn/<&ZoneName=ZONE2":
"zone3"==d?"cmd0=PutMasterVolumeBtn/<&ZoneName=ZONE3":"cmd0=PutMasterVolumeBtn/<":"volumeUp"==a?b="zone2"==d?"cmd0=PutMasterVolumeBtn/>&ZoneName=ZONE2":"zone3"==d?"cmd0=PutMasterVolumeBtn/>&ZoneName=ZONE3":"cmd0=PutMasterVolumeBtn/>":"CBL/SAT"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/SAT/CBL&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/SAT/CBL&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/SAT/CBL":"DVD/Blu-ray"==a||"DVD"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/DVD&ZoneName=ZONE2":"zone3"==
d?"cmd0=PutZone_InputFunction/DVD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/DVD":"Blu-ray"==a||"BD"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/BD&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/BD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/BD":"Game"==a||"GAME"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/GAME&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/GAME&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/GAME":"AUX"==a||"AUX1"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/AUX1&ZoneName=ZONE2":
"zone3"==d?"cmd0=PutZone_InputFunction/AUX1&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/AUX1":"AUX2"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/AUX2&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/AUX2&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/AUX2":"Media Player"==a||"MPLAY"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/MPLAY&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/MPLAY&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/MPLAY":"iPod/USB"==a||"IPOD"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/USB/IPOD&ZoneName=ZONE2":
"zone3"==d?"cmd0=PutZone_InputFunction/USB/IPOD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/USB/IPOD":"TV Audio"==a||"TV"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/TV&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/TV&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/TV":"Tuner"==a||"TUNER"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/TUNER&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/TUNER&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/TUNER":"Online Music"==a||"NETHOME"==a||"NET"==a?b=
"zone2"==d?"cmd0=PutZone_InputFunction/NETHOME&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/NETHOME&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/NETHOME":"Bluetooth"==a||"BT"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/BT&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/BT&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/BT":"Internetradio"==a||"IRP"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/IRP&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/IRP&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/IRP":
"Media Server"==a||"SERVER"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/SERVER&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/SERVER&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/SERVER":"CD"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/CD&ZoneName=ZONE2":"zone2"==d?"cmd0=PutZone_InputFunction/CD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/CD":"PHONO"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/PHONO&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/PHONO&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/PHONO":
"HDRADIO"==a?b="zone2"==d?"cmd0=PutZone_InputFunction/HDRADIO&ZoneName=ZONE2":"zone3"==d?"cmd0=PutZone_InputFunction/HDRADIO&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/HDRADIO":"Source"==a?(e="GET","zone2"==d?g="/goform/formiPhoneAppDirect.xml?Z2SOURCE":"zone2"==d&&(g="/goform/formiPhoneAppDirect.xml?Z3SOURCE")):"Quick1"==a?b="cmd0=PutUserMode/Quick1":"Quick2"==a?b="cmd0=PutUserMode/Quick2":"Quick3"==a?b="cmd0=PutUserMode/Quick3":"Quick4"==a?b="cmd0=PutUserMode/Quick4":"playPause"==a?b="cmd0=PutNetAudioCommand/CurEnter":
"previous"==a?b="cmd0=PutNetAudioCommand/CurUp":"next"==a?b="cmd0=PutNetAudioCommand/CurDown":0==a.indexOf("tuner")?(a=a.replace(/tuner/g,""),e="GET",g="/goform/formiPhoneAppTuner.xml",a="Up"==a?"PRESETUP":"Down"==a?"PRESETDOWN":"PRESETCALL0"+a,g+="?"+("zone2"==d?"2+"+a:"zone3"==d?"3+"+a:"1+"+a),b=null):-1!=this.audioModes.indexOf(a)?(e="GET",g="/goform/formiPhoneAppDirect.xml?MS"+encodeURI(a),b=null):-1!=this.audioModesDesc.indexOf(a)?(a=this.audioModes[this.audioModesDesc.indexOf(a)],e="GET",g=
"/goform/formiPhoneAppDirect.xml?MS"+encodeURI(a),b=null):"customCMD"==d?(e="GET",g=a):0==a.indexOf("setToDB")?(0==a.indexOf("setToDB")&&(a=a.replace(/setToDB/g,"")),"mainzone"==d?(b=parseFloat(a),-80>b?b=-80:18<b&&(b=18),b=b.toFixed(1),b="cmd0=PutMasterVolumeSet/"+b):"zone2"==d?(b=parseInt(a),-80>b?b=-80:18<b&&(b=18),b=b.toFixed(1),b="cmd0=PutMasterVolumeSet/"+b+"&ZoneName=ZONE2"):"zone3"==d&&(b=parseInt(a),-80>b?b=-80:18<b&&(b=18),b=b.toFixed(1),b="cmd0=PutMasterVolumeSet/"+b+"&ZoneName=ZONE3")):
d&&(0==a.indexOf("setTo")&&(a=a.replace(/setTo/g,"")),"mainzone"==d?(b=parseFloat(a),0>b?b=0:98<b&&(b=98),b=(b-80).toFixed(1),b="cmd0=PutMasterVolumeSet/"+b):"zone2"==d?(b=parseInt(a),0>b?b=0:80<b&&(b=80),b="cmd0=PutMasterVolumeSet/"+(b-80)+"&ZoneName=ZONE2"):"zone3"==d&&(b=parseInt(a),0>b?b=0:80<b&&(b=80),b-=80,b="cmd0=PutMasterVolumeSet/"+b+"&ZoneName=ZONE3"));f&&this._doRequest(e,g,b,c)};e.prototype.getStateValues=function(a,c){return c};e.prototype.toJSON=function(){var a={sys:xnm.aio.denon.DM.SYS,
type:"avr",ip:this.ip,port:this.port,uuid:this.uuid,model:this.model};this.name&&(a.name=this.name);return a};e.prototype.equalsTo=function(a){return a&&a instanceof e?this.ip==a.ip&&this.port==a.port:!1};e.parseJSON=function(a){return a.ip?new e(a.ip,a.port,a.uuid,a.name,a.model):null};return e}();xnm.aio.marantz.WebAVR=function(e,a,c,b,f){xnm.aio.denon.WebAVR.call(this,e,a,c,b,f);this._logger=require("x.logger.js").getLogger("xnm.aio.marantz.WebAVR")};xnm.aio.marantz.WebAVR.prototype=new xnm.aio.denon.WebAVR;
xnm.aio.marantz.WebAVR.prototype.constructor=xnm.aio.marantz.WebAVR;xnm.aio.marantz.WebAVR.prototype.toJSON=function(){var e={sys:xnm.aio.denon.DM.MARANTZ_SYS,type:"avr",ip:this.ip,port:this.port,uuid:this.uuid,model:this.model};this.name&&(e.name=this.name);return e};xnm.aio.marantz.WebAVR.prototype.equalsTo=function(e){return e&&e instanceof xnm.aio.marantz.WebAVR?this.ip==e.ip&&this.port==e.port:!1};
xnm.aio.marantz.WebAVR.parseJSON=function(e){return e.ip?new xnm.aio.marantz.WebAVR(e.ip,e.port,e.uuid,e.name,e.model):null};
xnm.aio.denon.DM=function(){var e=function(a,b){this.code=a;this.message=b;this.stack=Error().stack};e.prototype=Error();e.prototype.name="DenonDMError";e.prototype.code=0;e.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var a={avr:{command:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",
name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"Quick Select 1",ref:{value:"Quick1"}},{type:"enum",name:"Quick Select 2",ref:{value:"Quick2"}},{type:"enum",name:"Quick Select 3",ref:{value:"Quick3"}},{type:"enum",name:"Quick Select 4",ref:{value:"Quick4"}},{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}},{type:"enum",name:"open denon Remote App",ref:{value:"openNative"}}]},{type:"root",name:"Internetradio",value:"netradio",
children:[{type:"enum",name:"play/pause",ref:{value:"playPause"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},
{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",ext:"%f",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;Online Music;Bluetooth;Internetradio;Media Server;CD;PHONO".split(";")}},
{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",extMeta:"1-50",scale:"1"}},{type:"enum",name:"set sound modus",ref:{value:"audioMode",ext:"%e",extMeta:"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";")}}]},{type:"root",name:"zone 2",value:"zone2",
children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",ext:"%d",extMeta:"0-80",scale:"1"}},
{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"CBL/SAT;Media Player;iPod/USB;Tuner;Online Music;Bluetooth;Internetradio;Media Server;Source".split(";")}},{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",extMeta:"1-50",scale:"1"}}]},{type:"root",
name:"zone 3",value:"zone3",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",
ext:"%d",extMeta:"0-80",scale:"1"}},{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"CBL/SAT;Media Player;iPod/USB;Tuner;Online Music;Bluetooth;Internetradio;Media Server;Source".split(";")}},{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",
extMeta:"1-50",scale:"1"}}]}],status:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on",
"off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}},{type:"enum",name:"sound modus",ref:{value:"audioMode",options:"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";")}}]},
{type:"root",name:"zone 2",value:"zone2",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}}]},
{type:"root",name:"zone 3",value:"zone3",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}}]}]}};
return{SYS:"denon",MARANTZ_SYS:"marantz",getIPDeviceType:function(){return[{sys:this.SYS,name:"Denon AV Receiver",type:"avr"},{sys:this.MARANTZ_SYS,name:"Marantz AV Receiver",type:"avr"}]},createDevice:function(a,b,f){b=e.ERROR_CODE;a?a.ip?f(null,a):f(new e(b.INVALID,"ip is invalid")):f(new e(b.INVALID,"info is invalid"))},updateDevice:function(a,b,f){b=e.ERROR_CODE;a?a.ip?f(null,a):f(new e(b.INVALID,"ip is invalid")):f(new e(b.INVALID,"info is invalid"))},deleteDevice:function(a,b,f){f()},applyUIFilter:function(a,
b,f){var d=this,e=function(b,a,c){var d=[];b.forEach(function(b){if("root"==b.type){b=JSON.parse(JSON.stringify(b));var f=e(b.children,a,c);f&&0<f.length&&(b.children=f,d.push(b))}else{f=c.elems;if("*"==f)f=!0;else{for(var g=!1,h=0;h<f.length;h++)if(f[h]==b.type){g=!0;break}f=g}f&&(b=JSON.parse(JSON.stringify(b)),d.push(b))}});return d},g=function(b,a){var c=[],g=d.getCommandStatusMap(b,f);if(g){var h=[];switch(a.catagory){case "command":g.command&&(h=e(g.command,b,a));break;case "status":g.status&&
(h=e(g.status,b,a))}c=c.concat(h)}return c};if(!a.sys)return null;var h=JSON.parse(JSON.stringify(a)),k=null;switch(b.catagory){case "command":k=g(a,b);h.command=k;break;case "status":k=g(a,b);h.status=k;break;default:return null}return k&&0!=k.length?h:null},getCommandStatusMap:function(c){if(!c||!c.type)return null;if(c.sys==this.MARANTZ_SYS){if(!a[c.type])return null;c=JSON.parse(JSON.stringify(a[c.type]));if(c.command&&c.command[0]&&c.command[0].children){for(var b=-1,f=c.command[0].children,
d=0;d<f.length;d++)if(f[d]&&f[d].ref&&f[d].ref.value&&"openNative"==f[d].ref.value){b=d;break}-1!=b&&(f[d].name="open marantz Remote App")}return c}return a[c.type]}}}();
xnm.aio.denon.Handler=function(){var e=function(){this.detectedAVRs={};this.detectedMarantzAVRs={}};e.prototype.AVR=xnm.aio.denon.WebAVR;e.prototype.MarantzAVR=xnm.aio.marantz.WebAVR;e.prototype.devicemanager=xnm.aio.denon.DM;e.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"denon");a.register(this.devicemanager.MARANTZ_SYS,"denon")};e.prototype.resolveDevice=function(a){if(!a)return null;switch(a.sys){case this.devicemanager.SYS:switch(a.type){case "avr":return this.AVR.parseJSON(a);
default:return null}case this.devicemanager.MARANTZ_SYS:switch(a.type){case "avr":return this.MarantzAVR.parseJSON(a);default:return null}default:return null}};e.prototype.getDeviceCommands=function(a,c){var b=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}),b=b?b.command:[];c&&c(null,b)};e.prototype.getDeviceStatus=function(a,c){var b=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}),b=b?b.status:[];c&&c(null,b)};e.prototype.doCommand=function(a,c,b){var f=this.resolveDevice(a);
f?f.executeCommandCreator(a,c,function(a){b&&b(a)}):b&&b(Error("device json format invalid"))};e.prototype.doStatus=function(a,c,b,f){var d=this.resolveDevice(c);d?d.getStatesCreator(null,[{id:a,device:c,status:b}],function(b,a){b?f&&f(b):f&&f(null,a[0])}):f&&f(Error("device json format invalid"))};e.prototype.discoverDevices=function(a){var c=require("x.upnp.js");if(c){var b=this;c.discoverDevicesWithTimeout(3E3,function(c){if(0==c.name.indexOf("Denon AVR")){var d=c.modelName;d&&"*"==d.charAt(0)&&
(d=d.substr(1));d=new xnm.aio.denon.WebAVR(c.ip,null,c.uuid,c.name,d);b.detectedAVRs["uuid:"+c.uuid]||(b.detectedAVRs["uuid:"+c.uuid]=d);a(d)}})}};e.prototype.discoverWithTimeout=function(a,c){var b={};this.discoverDevices(function(a){a&&a.uuid&&!b[a.uuid]&&(b[a.uuid]=a)});setTimeout(function(){var a=[],d;for(d in b)b.hasOwnProperty(d)&&a.push(b[d]);c&&c(null,a)},a)};e.prototype.discoverMarantz=function(a){var c=require("x.upnp.js");if(c){var b=this;c.discoverDevicesWithTimeout(3E3,function(c){if(c.name&&
0==c.name.toLowerCase().indexOf("marantz")){var d=c.modelName;d&&"*"==d.charAt(0)&&(d=d.substr(1));d=new xnm.aio.marantz.WebAVR(c.ip,null,c.uuid,c.name,d);b.detectedMarantzAVRs["uuid:"+c.uuid]||(b.detectedMarantzAVRs["uuid:"+c.uuid]=d);a(d)}})}};e.prototype.discoverMarantzWithTimeout=function(a,c){var b={};this.discoverMarantz(function(a){a&&a.uuid&&!b[a.uuid]&&(b[a.uuid]=a)});setTimeout(function(){var a=[],d;for(d in b)b.hasOwnProperty(d)&&a.push(b[d]);c&&c(null,a)},a)};e.prototype.getStateValues=
function(a,c){return(new xnm.aio.denon.WebAVR).getStateValues(a.type,c)};e.prototype.getDeviceCommandList=function(a,c,b){var e=[];if(c)e.push({id:window.XC_Text.on,cmd:"on"}),e.push({id:window.XC_Text.off,cmd:"off"});else if(b&&"avr"==a.type){e.push({id:"on",cmd:"on"});e.push({id:"off",cmd:"off"});e.push({id:"toggle",cmd:"toggle"});e.push({id:"volumeDown",cmd:"volumeDown"});e.push({id:"volumeUp",cmd:"volumeUp"});e.push({id:"mute",cmd:"mute"});e.push({id:"unmute",cmd:"unmute"});e.push({id:"toggleMute",
cmd:"toggleMute"});b=e.length;for(a=0;a<b;a++)c=JSON.parse(JSON.stringify(e[a])),c.ch="mainzone",e.push(c),c=JSON.parse(JSON.stringify(e[a])),c.ch="zone2",e.push(c);e.push({id:"set volume",cmd:"setTo",step:"0.5",max:"98",ch:"mainzone"});e.push({id:"set volume",cmd:"setTo",step:"1",max:"80",ch:"zone2"});var d=[];d.push({id:"CBLSAT",cmd:"CBLSAT"});d.push({id:"DVDBlu-ray",cmd:"DVDBlu-ray"});d.push({id:"Blu-ray",cmd:"Blu-ray"});d.push({id:"Game",cmd:"Game"});d.push({id:"AUX",cmd:"AUX"});d.push({id:"AUX2",
cmd:"AUX2"});d.push({id:"MediaPlayer",cmd:"MediaPlayer"});d.push({id:"iPodUSB",cmd:"iPodUSB"});d.push({id:"TVAudio",cmd:"TVAudio"});d.push({id:"Tuner",cmd:"Tuner"});d.push({id:"NETHOME",cmd:"NETHOME"});d.push({id:"Bluetooth",cmd:"Bluetooth"});d.push({id:"IRADIO",cmd:"IRADIO"});d.push({id:"SERVER",cmd:"SERVER"});d.push({id:"CD",cmd:"CD"});d.push({id:"PHONO",cmd:"PHONO"});d.push({id:"HDRADIO",cmd:"HDRADIO"});d.push({id:"tunerUp",cmd:"tunerUp"});d.push({id:"tunerDown",cmd:"tunerDown"});d.push({id:"set tuner to",
cmd:"tuner",step:"1",min:"1",max:"50"});b=d.length;for(a=0;a<b;a++)c=JSON.parse(JSON.stringify(d[a])),c.ch="mainzone",e.push(c),c=JSON.parse(JSON.stringify(d[a])),c.ch="zone2",e.push(c);c=(new xnm.aio.denon.WebAVR).audioModes;for(a=0;a<c.length;a++)e.push({id:c[a],cmd:c[a]});e.push({id:"Quick1",cmd:"Quick1"});e.push({id:"Quick2",cmd:"Quick2"});e.push({id:"Quick3",cmd:"Quick3"});e.push({id:"Quick4",cmd:"Quick4"});e.push({id:"playPause",cmd:"playPause"});e.push({id:"previous",cmd:"previous"});e.push({id:"next",
cmd:"next"})}return e};return e}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.denon.Handler);
