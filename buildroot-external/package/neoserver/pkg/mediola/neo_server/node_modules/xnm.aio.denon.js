var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,a,b){e instanceof String&&(e=String(e));for(var d=e.length,f=0;f<d;f++){var c=e[f];if(a.call(b,c,f,e))return{i:f,v:c}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,a,b){e!=Array.prototype&&e!=Object.prototype&&(e[a]=b.value)};
$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,a,b,d){if(a){b=$jscomp.global;e=e.split(".");for(d=0;d<e.length-1;d++){var f=e[d];f in b||(b[f]={});b=b[f]}e=e[e.length-1];d=b[e];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(b,e,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.denon=xnm.aio.denon||{};xnm.aio.marantz=xnm.aio.marantz||{};
xnm.aio.denon.AVR=function(){var e=function(a,b){this.ip=a;this.port=b;this.port||(this.port="23");this.timeout=2E3;this.CommandHandler=this._socket=null};e.prototype._doRequest=function(a,b,d){var f=require("net");if(!this._socket){var c=null,e=[];this._socket=f.connect({port:this.port,host:this.ip});this._socket.setTimeout(this.timeout);var g=this,h=null;this._socket.on("connect",function(){var b=new Buffer(a.shift()+"\r");g._socket.write(b);d&&g._socket.setTimeout(250)});this._socket.on("data",
function(b){c=c?c+b.toString():b.toString();for(b=c.indexOf("\r");0<b;)e.push(c.substr(0,b)),c=c.substr(b+1),b=c.indexOf("\r");0<a.length?(b=new Buffer(a.shift()+"\r"),g._socket.write(b)):g._socket.setTimeout(100)});this._socket.on("error",function(a){b&&(b({error:"socket error",data:null}),b=null);g._socket&&g._socket.destroy();g._socket=null});this._socket.on("timeout",function(){g._socket.destroy();g._socket=null;b&&(h=0<e.length?{error:null,data:e}:{error:"socket timeout",data:null})});this._socket.on("close",
function(){g._socket=null;b&&h&&setTimeout(function(){b(h)},250)})}};e.prototype._executeCommand=function(a,b){this._doRequest([a],function(){b&&b()},!0)};e.prototype.executeCommand=function(a,b){var d=a,f=this;"on"==a?d="PWON":"off"==a||"standby"==a?d="PWSTANDBY":"toggle"==a&&(d=null,this.getStates(function(a){a&&"on"==a.power?f._executeCommand("PWSTANDBY",b):f._executeCommand("PWON",b)}));d&&this._executeCommand(d,b)};e.prototype.getStates=function(a){var b={mainzone:{},zone2:{}};this._doRequest("PW? MU? SI? MV? ZM? Z2MU? Z2?".split(" "),
function(d){if(d.data){for(var f=0;f<d.data.length;f++){var c=d.data[f].trim();"PW"==c.substr(0,2)?b.power=c.substr(2).toLowerCase():"MV"==c.substr(0,2)?(c=c.substr(2),3==c.length?b.mainzone.volume=(parseFloat(c)/10).toFixed(1):2==c.length&&(b.mainzone.volume=parseFloat(c).toFixed(1))):"MU"==c.substr(0,2)?b.mainzone.mute=c.substr(2).toLowerCase():"SI"==c.substr(0,2)?b.mainzone.input=c.substr(2).toLowerCase():"ZM"==c.substr(0,2)?b.mainzone.power=c.substr(2).toLowerCase():"Z2MU"==c.substr(0,4)?b.zone2.mute=
c.substr(4).toLowerCase():"Z2"==c.substr(0,2)&&("Z2ON"==c?b.zone2.power="on":"Z2OFF"==c?b.zone2.power="off":(c=c.substr(2),/^\d+$/.test(c)?3==c.length?b.zone2.volume=(parseFloat(c)/10).toFixed(1):2==c.length&&(b.zone2.volume=parseFloat(c).toFixed(1)):b.zone2.input=c.toLowerCase()))}a&&a(b)}else a&&a()})};e.prototype.getStateValues=function(a,b){return b};return e}();
xnm.aio.denon.Cache={_cache:{},_getCache:function(e){return e?this._cache[e]:null},_ensureCache:function(e){if(!e)return null;this._cache[e]||(this._cache[e]={});return this._cache[e]},getConfig:function(e){return e?(e=this._getCache(e))?e.config:null:null},setConfig:function(e,a){if(!e)return null;this._ensureCache(e).config=a}};
xnm.aio.denon.WebAVR=function(){var e=function(a,b,d,f,c){this._logger="undefined"==typeof require||null==require?{log:function(){}}:require("x.logger.js").getLogger("xnm.aio.denon.WebAVR");this.ip=a;this.port=b;this.port||(this.port=80);this.uuid=d;this.name=f;this.model=c;this.timeout=3E3;this.CommandHandler=null};e.prototype.audioModes="DIRECT;STEREO;DOLBY DIGITAL;DTS SURROUND;AUTO;MCH STEREO;SUPER STADIUM;ROCK ARENA;JAZZ CLUB;CLASSIC CONCERT;MONO MOVIE;MATRIX;VIDEO GAME;VIRTUAL".split(";");e.prototype.audioModesDesc=
"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";");e.prototype.videoInputs="CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;Online Music;Bluetooth;Internetradio;Media Server;CD;PHONO;HDRADIO".split(";");e.prototype._getConfig=function(){return xnm.aio.denon.Cache.getConfig(this.ip)};e.prototype._setConfig=function(a){xnm.aio.denon.Cache.setConfig(this.ip,
a)};e.prototype.executeCommandCreator=function(a,b,d){if(b&&b.value)if("openNative"==b.value)window&&window.XC&&window.XC.callHost&&window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()?a&&"marantz"==a.sys?window.XC.callHost("SYSTEM","startApp",{scheme:"marantzremoteapp://"}):window.XC.callHost("SYSTEM","startApp",{scheme:"denonremoteapp://"}):"Android"==window.XCHost.getType()&&(a&&"marantz"==a.sys?window.XC.callHost("SYSTEM","startApp",{scheme:"com.dmholdings.marantzremoteapp"}):
window.XC.callHost("SYSTEM","startApp",{scheme:"com.dmholdings.denonremoteapp"}))),d&&d();else{a="";b.path&&b.path[0]&&"global"!=b.path[0]&&(a=b.path[0]+":");var f=a+b.value;if("setInput"==b.value){if(!b.ext){d&&d(Error("command setInput ext format invalid"));return}f=a+b.ext}else if("audioMode"==b.value){if(!b.ext){d&&d(Error("command audioMode ext format invalid"));return}f=a+b.ext}else if("setTo"==b.value||"setToDB"==b.value){if(null==b.ext||"undefined"==typeof b.ext){d&&d(Error("command setTo ext format invalid"));
return}f+=b.ext}else if("customCMD"==b.value){if(!b.ext){d&&d(Error("command customCMD ext format invalid"));return}f="customCMD:"+b.ext}if("tuner"==b.value){if(null==b.ext||"undefined"==typeof b.ext){d&&d(Error("command tunerPreset ext format invalid"));return}f+=b.ext}this.executeCommand(f,function(a){if(a)d&&d(a);else{if(b.path&&b.path[0]&&"mainzone"==b.path[0]){if("on"==b.value||"off"==b.value||"toggle"==b.value){setTimeout(function(){d&&d()},1E3);return}if("setTo"==b.value||"setToDB"==b.value||
"volumeUp"==b.value||"volumeDown"==b.value){setTimeout(function(){d&&d()},10);return}}"setInput"==b.value||"audioMode"==b.value?setTimeout(function(){d&&d()},1E3):d&&d()}})}else d&&d(Error("command json format invalid"))};e.prototype.getStatesCreator=function(a,b,d){this.getStates(function(a,c){a=[];for(var f=0;f<b.length;f++)if(b[f]&&b[f].id){var e="?";if(c&&b[f].status&&b[f].status.value){var h="";b[f].status.path&&b[f].status.path[0]&&"global"!=b[f].status.path[0]&&(h=b[f].status.path[0]);var k=
b[f].status.value;h&&null!=c[h]&&"undefined"!=typeof c[h]?c[h][k]&&(e=c[h][k]):null!=c[k]&&"undefined"!=typeof c[k]&&(e=c[k])}a.push({id:b[f].id,status:e})}d&&d(null,a)})};e.prototype._doRequest=function(a,b,d,f){var c=this;b="http://"+this.ip+":"+this.port+b;this._logger.log("trace","send "+a+" to url:"+b+" data:"+d);var e=f;$.ajax({url:b,type:a,timeout:this.timeout,data:d,dataType:"text",cache:!0,success:function(a){c._logger.log("trace","http request success:"+a);setTimeout(function(){e&&(e(null,
a),e=null)},200)},error:function(a,b){a="http request error:"+(a?a.status:"0")+"-"+b;c._logger.log("trace",a);e&&(e(Error(a)),e=null)}})};e.prototype._getInputList=function(a){this._doRequest("GET","/goform/formMainZone_MainZoneXmlStatus.xml",null,function(b,d){if(b)a&&a(b);else try{var f=$($.parseXML(d));if(f){var c={inputs:[],renamed:[]};f.find("InputFuncList").each(function(){$(this).find("value").each(function(){var a=$(this).text();a&&c.inputs.push(a.trim())})});f.find("RenameSource").each(function(){$(this).find("value value").each(function(){var a=
$(this).text();a&&c.renamed.push(a.trim())})});a&&a(null,c)}else a&&a(Error("MainZoneXmlStatus.xml response invalid"))}catch(l){a&&a(l)}})};e.prototype._getStateValue=function(a,b,d,f){var c=null;a.find(b).each(function(){var a=$(this).find("value");0<a.length&&(c=$(a[0]).text())});c&&f&&(c=c.trim());c&&d&&(c=c.toLowerCase());return c};e.prototype._getOriginalInputName=function(a){var b=a,d=this._getConfig();d&&d.renamed&&d.inputs&&(a=d.renamed.indexOf(a),-1!=a&&d.inputs[a]&&(b=d.inputs[a]));return b};
e.prototype._parseStates=function(a){var b={};try{var d=$($.parseXML(a));if(d){b.mainpower=this._getStateValue(d,"Power",!0,!0);"standby"==b.mainpower&&(b.mainpower="off");b.power=this._getStateValue(d,"ZonePower",!0,!0);b.mute=this._getStateValue(d,"Mute",!0,!0);b.input=this._getStateValue(d,"InputFuncSelect",!1,!0);b.audioMode=this._getStateValue(d,"selectSurround",!1,!0);b.input&&(b.originalInput=this._getOriginalInputName(b.input));"NETWORK"==b.originalInput&&(b.netfunc=this._getStateValue(d,
"NetFuncSelect",!1,!0));switch(b.originalInput){case "CBL/SAT":b.originalInput="CBL/SAT";break;case "DVD":b.originalInput="DVD/Blu-ray";break;case "Blu-ray":b.originalInput="Blu-ray";break;case "GAME":b.originalInput="Game";break;case "Media Player":b.originalInput="Media Player";break;case "iPod/USB":b.originalInput="iPod/USB";break;case "TUNER":b.originalInput="Tuner";break;case "TV AUDIO":b.originalInput="TV Audio";break;case "NETWORK":switch(b.netfunc){case "IRADIO":b.originalInput="Internetradio";
break;case "SERVER":b.originalInput="Media Server";break;default:b.originalInput="Online Music"}}var f=this._getStateValue(d,"MasterVolume",!1,!0);b.volumeDB="--"==f?"-80.0":parseFloat(f).toFixed(1);f="--"==f?0:parseFloat(f)+80;b.volume=""+f.toFixed(1)}}catch(c){}return b};e.prototype.getStates=function(a){var b={mainzone:{},zone2:{},zone3:{}},d=this;this._getConfig()?this._doRequest("GET","/goform/formMainZone_MainZoneXml.xml",null,function(f,c){!f&&c?(b.mainzone=d._parseStates(c),b.power=b.mainzone.mainpower,
delete b.mainzone.mainpower,d._doRequest("GET","/goform/formMainZone_MainZoneXml.xml?ZoneName=ZONE2",null,function(c,f){!c&&f&&(b.zone2=d._parseStates(f),delete b.zone2.mainpower);d._doRequest("GET","/goform/formMainZone_MainZoneXml.xml?ZoneName=ZONE3",null,function(c,e){!c&&f&&(b.zone3=d._parseStates(e),delete b.zone3.mainpower);a&&a(c,b)})})):a&&a(f,b)}):this._getInputList(function(b,c){b?a&&a(b):(d._setConfig(c),d.getStates(a))})};e.prototype.executeCommand=function(a,b){var d=null,f=!0,c=null,
e=a.indexOf(":");0<e&&(c=a.substr(0,e),a=a.substr(e+1));e="POST";var g="/MainZone/index.put.asp",h=this;"on"==a?d="mainzone"==c?"cmd0=PutZone_OnOff%2FON":"zone2"==c?"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE3":"cmd0=PutSystem_OnStandby%2FON":"off"==a||"standby"==a?d="mainzone"==c?"cmd0=PutZone_OnOff%2FOFF":"zone2"==c?"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE2":"zone2"==c?"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE3":"cmd0=PutSystem_OnStandby%2FSTANDBY":"toggle"==
a?(f=!1,this.getStates(function(a,d){c?"mainzone"==c?d&&d.mainzone&&"on"==d.mainzone.power?h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FOFF",b):h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FON",b):"zone2"==c?d&&d.zone2&&"on"==d.zone2.power?h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE2",b):h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE2",b):"zone3"==c&&(d&&d.zone3&&"on"==d.zone3.power?h._doRequest("POST",g,"cmd0=PutZone_OnOff%2FOFF&ZoneName=ZONE3",b):h._doRequest("POST",
g,"cmd0=PutZone_OnOff%2FON&ZoneName=ZONE3",b)):d&&"on"==d.power?h._doRequest("POST",g,"cmd0=PutSystem_OnStandby%2FSTANDBY",b):h._doRequest("POST",g,"cmd0=PutSystem_OnStandby%2FON",b)})):"mute"==a?"zone2"==c?d="cmd0=PutVolumeMute/on&ZoneName=ZONE2":"zone3"==c?d="cmd0=PutVolumeMute/on&ZoneName=ZONE3":"mainzone"==c?d="cmd0=PutVolumeMute/on":(g="/goform/AppCommand.xml",d='<?xml version="1.0" encoding="utf-8"?>\r\n<tx>\r\n<cmd id="1">SetAllZoneMute</cmd>\r\n<value>ON</value>\r\n</tx>'):"unmute"==a?"zone2"==
c?d="cmd0=PutVolumeMute/off&ZoneName=ZONE2":"zone3"==c?d="cmd0=PutVolumeMute/off&ZoneName=ZONE3":"mainzone"==c?d="cmd0=PutVolumeMute/off":(g="/goform/AppCommand.xml",d='<?xml version="1.0" encoding="utf-8"?>\r\n<tx>\r\n<cmd id="1">SetAllZoneMute</cmd>\r\n<value>OFF</value>\r\n</tx>'):"toggleMute"==a?d="zone2"==c?"cmd0=PutVolumeMute/toggle&ZoneName=ZONE2":"zone3"==c?"cmd0=PutVolumeMute/toggle&ZoneName=ZONE3":"cmd0=PutVolumeMute/toggle":"volumeDown"==a?d="zone2"==c?"cmd0=PutMasterVolumeBtn/<&ZoneName=ZONE2":
"zone3"==c?"cmd0=PutMasterVolumeBtn/<&ZoneName=ZONE3":"cmd0=PutMasterVolumeBtn/<":"volumeUp"==a?d="zone2"==c?"cmd0=PutMasterVolumeBtn/>&ZoneName=ZONE2":"zone3"==c?"cmd0=PutMasterVolumeBtn/>&ZoneName=ZONE3":"cmd0=PutMasterVolumeBtn/>":"CBL/SAT"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/SAT/CBL&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/SAT/CBL&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/SAT/CBL":"DVD/Blu-ray"==a||"DVD"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/DVD&ZoneName=ZONE2":"zone3"==
c?"cmd0=PutZone_InputFunction/DVD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/DVD":"Blu-ray"==a||"BD"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/BD&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/BD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/BD":"Game"==a||"GAME"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/GAME&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/GAME&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/GAME":"AUX"==a||"AUX1"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/AUX1&ZoneName=ZONE2":
"zone3"==c?"cmd0=PutZone_InputFunction/AUX1&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/AUX1":"AUX2"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/AUX2&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/AUX2&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/AUX2":"Media Player"==a||"MPLAY"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/MPLAY&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/MPLAY&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/MPLAY":"iPod/USB"==a||"IPOD"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/USB/IPOD&ZoneName=ZONE2":
"zone3"==c?"cmd0=PutZone_InputFunction/USB/IPOD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/USB/IPOD":"TV Audio"==a||"TV"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/TV&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/TV&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/TV":"Tuner"==a||"TUNER"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/TUNER&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/TUNER&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/TUNER":"Online Music"==a||"NETHOME"==a||"NET"==a?d=
"zone2"==c?"cmd0=PutZone_InputFunction/NETHOME&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/NETHOME&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/NETHOME":"Bluetooth"==a||"BT"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/BT&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/BT&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/BT":"Internetradio"==a||"IRP"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/IRP&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/IRP&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/IRP":
"Media Server"==a||"SERVER"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/SERVER&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/SERVER&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/SERVER":"CD"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/CD&ZoneName=ZONE2":"zone2"==c?"cmd0=PutZone_InputFunction/CD&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/CD":"PHONO"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/PHONO&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/PHONO&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/PHONO":
"HDRADIO"==a?d="zone2"==c?"cmd0=PutZone_InputFunction/HDRADIO&ZoneName=ZONE2":"zone3"==c?"cmd0=PutZone_InputFunction/HDRADIO&ZoneName=ZONE3":"cmd0=PutZone_InputFunction/HDRADIO":"Source"==a?(e="GET","zone2"==c?g="/goform/formiPhoneAppDirect.xml?Z2SOURCE":"zone2"==c&&(g="/goform/formiPhoneAppDirect.xml?Z3SOURCE")):"Quick1"==a?d="cmd0=PutUserMode/Quick1":"Quick2"==a?d="cmd0=PutUserMode/Quick2":"Quick3"==a?d="cmd0=PutUserMode/Quick3":"Quick4"==a?d="cmd0=PutUserMode/Quick4":"playPause"==a?d="cmd0=PutNetAudioCommand/CurEnter":
"previous"==a?d="cmd0=PutNetAudioCommand/CurUp":"next"==a?d="cmd0=PutNetAudioCommand/CurDown":0==a.indexOf("tuner")?(a=a.replace(/tuner/g,""),e="GET",g="/goform/formiPhoneAppTuner.xml",a="Up"==a?"PRESETUP":"Down"==a?"PRESETDOWN":"PRESETCALL0"+a,g+="?"+("zone2"==c?"2+"+a:"zone3"==c?"3+"+a:"1+"+a),d=null):-1!=this.audioModes.indexOf(a)?(e="GET",g="/goform/formiPhoneAppDirect.xml?MS"+encodeURI(a),d=null):-1!=this.audioModesDesc.indexOf(a)?(a=this.audioModes[this.audioModesDesc.indexOf(a)],e="GET",g=
"/goform/formiPhoneAppDirect.xml?MS"+encodeURI(a),d=null):"customCMD"==c?(e="GET",g=a):0==a.indexOf("setToDB")?(0==a.indexOf("setToDB")&&(a=a.replace(/setToDB/g,"")),"mainzone"==c?(a=parseFloat(a),-80>a?a=-80:18<a&&(a=18),a=a.toFixed(1),d="cmd0=PutMasterVolumeSet/"+a):"zone2"==c?(a=parseInt(a),-80>a?a=-80:18<a&&(a=18),a=a.toFixed(1),d="cmd0=PutMasterVolumeSet/"+a+"&ZoneName=ZONE2"):"zone3"==c&&(a=parseInt(a),-80>a?a=-80:18<a&&(a=18),a=a.toFixed(1),d="cmd0=PutMasterVolumeSet/"+a+"&ZoneName=ZONE3")):
c&&(0==a.indexOf("setTo")&&(a=a.replace(/setTo/g,"")),"mainzone"==c?(a=parseFloat(a),0>a?a=0:98<a&&(a=98),a=(a-80).toFixed(1),d="cmd0=PutMasterVolumeSet/"+a):"zone2"==c?(a=parseInt(a),0>a?a=0:80<a&&(a=80),d="cmd0=PutMasterVolumeSet/"+(a-80)+"&ZoneName=ZONE2"):"zone3"==c&&(a=parseInt(a),0>a?a=0:80<a&&(a=80),d="cmd0=PutMasterVolumeSet/"+(a-80)+"&ZoneName=ZONE3"));f&&this._doRequest(e,g,d,b)};e.prototype.getStateValues=function(a,b){return b};e.prototype.toJSON=function(){var a={sys:xnm.aio.denon.DM.SYS,
type:"avr",ip:this.ip,port:this.port,uuid:this.uuid,model:this.model};this.name&&(a.name=this.name);return a};e.prototype.equalsTo=function(a){return a&&a instanceof e?this.ip==a.ip&&this.port==a.port:!1};e.parseJSON=function(a){return a.ip?new e(a.ip,a.port,a.uuid,a.name,a.model):null};return e}();xnm.aio.marantz.WebAVR=function(e,a,b,d,f){xnm.aio.denon.WebAVR.call(this,e,a,b,d,f);this._logger=require("x.logger.js").getLogger("xnm.aio.marantz.WebAVR")};xnm.aio.marantz.WebAVR.prototype=new xnm.aio.denon.WebAVR;
xnm.aio.marantz.WebAVR.prototype.constructor=xnm.aio.marantz.WebAVR;xnm.aio.marantz.WebAVR.prototype.toJSON=function(){var e={sys:xnm.aio.denon.DM.MARANTZ_SYS,type:"avr",ip:this.ip,port:this.port,uuid:this.uuid,model:this.model};this.name&&(e.name=this.name);return e};xnm.aio.marantz.WebAVR.prototype.equalsTo=function(e){return e&&e instanceof xnm.aio.marantz.WebAVR?this.ip==e.ip&&this.port==e.port:!1};
xnm.aio.marantz.WebAVR.parseJSON=function(e){return e.ip?new xnm.aio.marantz.WebAVR(e.ip,e.port,e.uuid,e.name,e.model):null};
xnm.aio.denon.DM=function(){var e=function(a,d){this.code=a;this.message=d;this.stack=Error().stack};e.prototype=Error();e.prototype.name="DenonDMError";e.prototype.code=0;e.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var a={avr:{command:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",
name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"Quick Select 1",ref:{value:"Quick1"}},{type:"enum",name:"Quick Select 2",ref:{value:"Quick2"}},{type:"enum",name:"Quick Select 3",ref:{value:"Quick3"}},{type:"enum",name:"Quick Select 4",ref:{value:"Quick4"}},{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}},{type:"enum",name:"open denon Remote App",ref:{value:"openNative"}}]},{type:"root",name:"Internetradio",value:"netradio",
children:[{type:"enum",name:"play/pause",ref:{value:"playPause"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},
{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",ext:"%f",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;Online Music;Bluetooth;Internetradio;Media Server;CD;PHONO".split(";")}},
{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",extMeta:"1-50",scale:"1"}},{type:"enum",name:"set sound modus",ref:{value:"audioMode",ext:"%e",extMeta:"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";")}}]},{type:"root",name:"zone 2",value:"zone2",
children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",ext:"%d",extMeta:"0-80",scale:"1"}},
{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"CBL/SAT;Media Player;iPod/USB;Tuner;Online Music;Bluetooth;Internetradio;Media Server;Source".split(";")}},{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",extMeta:"1-50",scale:"1"}}]},{type:"root",
name:"zone 3",value:"zone3",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"int",name:"volume to",ref:{value:"setTo",
ext:"%d",extMeta:"0-80",scale:"1"}},{type:"float",name:"volume to (db)",ref:{value:"setToDB",ext:"%f",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:"CBL/SAT;Media Player;iPod/USB;Tuner;Online Music;Bluetooth;Internetradio;Media Server;Source".split(";")}},{type:"enum",name:"tuner preset up",ref:{value:"tunerUp"}},{type:"enum",name:"tuner preset down",ref:{value:"tunerDown"}},{type:"int",name:"set tuner to preset",ref:{value:"tuner",ext:"%d",
extMeta:"1-50",scale:"1"}}]}],status:[{type:"root",name:"global",value:"global",children:[{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on",
"off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}},{type:"enum",name:"sound modus",ref:{value:"audioMode",options:"Direct;Stereo;Dolby Surrounds;DTS Surrounds;Auto;Multi Ch Stereo;Super Stadium;Rock Arena;Jazz Club;Classic Concert;Mono Movie;Matrix;Video Game;Virtual".split(";")}}]},
{type:"root",name:"zone 2",value:"zone2",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}}]},
{type:"root",name:"zone 3",value:"zone3",children:[{type:"float",name:"volume",ref:{value:"volume",extMeta:"0.0-98.0",scale:"0.5"}},{type:"float",name:"volume (db)",ref:{value:"volumeDB",extMeta:"-80.0-18.0",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"string",name:"input",ref:{value:"input"}},{type:"enum",name:"original input",ref:{value:"originalInput",options:"CBL/SAT;DVD/Blu-ray;Blu-ray;Game;AUX;AUX2;Media Player;iPod/USB;TV Audio;Tuner;NETHOME;Bluetooth;Internetradio;SERVER;CD;PHONO".split(";")}}]}]}};
return{SYS:"denon",MARANTZ_SYS:"marantz",getIPDeviceType:function(){return[{sys:this.SYS,name:"Denon AV Receiver",type:"avr"},{sys:this.MARANTZ_SYS,name:"Marantz AV Receiver",type:"avr"}]},createDevice:function(a,d,f){d=e.ERROR_CODE;a?a.ip?f(null,a):f(new e(d.INVALID,"ip is invalid")):f(new e(d.INVALID,"info is invalid"))},updateDevice:function(a,d,f){d=e.ERROR_CODE;a?a.ip?f(null,a):f(new e(d.INVALID,"ip is invalid")):f(new e(d.INVALID,"info is invalid"))},deleteDevice:function(a,d,f){f()},applyUIFilter:function(a,
d,f){var b=this,e=function(a,b,c){var d=[];a.forEach(function(a){if("root"==a.type){a=JSON.parse(JSON.stringify(a));var f=e(a.children,b,c);f&&0<f.length&&(a.children=f,d.push(a))}else{f=c.elems;if("*"==f)f=!0;else{for(var g=!1,h=0;h<f.length;h++)if(f[h]==a.type){g=!0;break}f=g}f&&(a=JSON.parse(JSON.stringify(a)),d.push(a))}});return d},g=function(a,c){var d=[],g=b.getCommandStatusMap(a,f);if(g){var h=[];switch(c.catagory){case "command":g.command&&(h=e(g.command,a,c));break;case "status":g.status&&
(h=e(g.status,a,c))}d=d.concat(h)}return d};if(!a.sys)return null;var h=JSON.parse(JSON.stringify(a)),k=null;switch(d.catagory){case "command":k=g(a,d);h.command=k;break;case "status":k=g(a,d);h.status=k;break;default:return null}return k&&0!=k.length?h:null},getCommandStatusMap:function(b){if(!b||!b.type)return null;if(b.sys==this.MARANTZ_SYS){if(!a[b.type])return null;b=JSON.parse(JSON.stringify(a[b.type]));if(b.command&&b.command[0]&&b.command[0].children){for(var d=-1,f=b.command[0].children,
c=0;c<f.length;c++)if(f[c]&&f[c].ref&&f[c].ref.value&&"openNative"==f[c].ref.value){d=c;break}-1!=d&&(f[c].name="open marantz Remote App")}return b}return a[b.type]}}}();
xnm.aio.denon.Handler=function(){var e=function(){this.detectedAVRs={};this.detectedMarantzAVRs={}};e.prototype.AVR=xnm.aio.denon.WebAVR;e.prototype.MarantzAVR=xnm.aio.marantz.WebAVR;e.prototype.devicemanager=xnm.aio.denon.DM;e.prototype.registModule=function(a){a.register(this.devicemanager.SYS,"denon");a.register(this.devicemanager.MARANTZ_SYS,"denon")};e.prototype.resolveDevice=function(a){if(!a)return null;switch(a.sys){case this.devicemanager.SYS:switch(a.type){case "avr":return this.AVR.parseJSON(a);
default:return null}case this.devicemanager.MARANTZ_SYS:switch(a.type){case "avr":return this.MarantzAVR.parseJSON(a);default:return null}default:return null}};e.prototype.getDeviceCommands=function(a,b){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"command",elems:"*"}))?a.command:[];b&&b(null,a)};e.prototype.getDeviceStatus=function(a,b){a=(a=this.devicemanager.applyUIFilter(a,{catagory:"status",elems:"*"}))?a.status:[];b&&b(null,a)};e.prototype.doCommand=function(a,b,d){var f=this.resolveDevice(a);
f?f.executeCommandCreator(a,b,function(a){d&&d(a)}):d&&d(Error("device json format invalid"))};e.prototype.doStatus=function(a,b,d,f){var c=this.resolveDevice(b);c?c.getStatesCreator(null,[{id:a,device:b,status:d}],function(a,b){a?f&&f(a):f&&f(null,b[0])}):f&&f(Error("device json format invalid"))};e.prototype.discoverDevices=function(a){var b=require("x.upnp.js");if(b){var d=this;b.discoverDevicesWithTimeout(3E3,function(b){if(0==b.name.indexOf("Denon AVR")){var c=b.modelName;c&&"*"==c.charAt(0)&&
(c=c.substr(1));c=new xnm.aio.denon.WebAVR(b.ip,null,b.uuid,b.name,c);d.detectedAVRs["uuid:"+b.uuid]||(d.detectedAVRs["uuid:"+b.uuid]=c);a(c)}})}};e.prototype.discoverWithTimeout=function(a,b){var d={};this.discoverDevices(function(a){a&&a.uuid&&!d[a.uuid]&&(d[a.uuid]=a)});setTimeout(function(){var a=[],c;for(c in d)d.hasOwnProperty(c)&&a.push(d[c]);b&&b(null,a)},a)};e.prototype.discoverMarantz=function(a){var b=require("x.upnp.js");if(b){var d=this;b.discoverDevicesWithTimeout(3E3,function(b){if(b.name&&
0==b.name.toLowerCase().indexOf("marantz")){var c=b.modelName;c&&"*"==c.charAt(0)&&(c=c.substr(1));c=new xnm.aio.marantz.WebAVR(b.ip,null,b.uuid,b.name,c);d.detectedMarantzAVRs["uuid:"+b.uuid]||(d.detectedMarantzAVRs["uuid:"+b.uuid]=c);a(c)}})}};e.prototype.discoverMarantzWithTimeout=function(a,b){var d={};this.discoverMarantz(function(a){a&&a.uuid&&!d[a.uuid]&&(d[a.uuid]=a)});setTimeout(function(){var a=[],c;for(c in d)d.hasOwnProperty(c)&&a.push(d[c]);b&&b(null,a)},a)};e.prototype.getStateValues=
function(a,b){return(new xnm.aio.denon.WebAVR).getStateValues(a.type,b)};e.prototype.getDeviceCommandList=function(a,b,d){var e=[];if(b)e.push({id:window.XC_Text.on,cmd:"on"}),e.push({id:window.XC_Text.off,cmd:"off"});else if(d&&"avr"==a.type){e.push({id:"on",cmd:"on"});e.push({id:"off",cmd:"off"});e.push({id:"toggle",cmd:"toggle"});e.push({id:"volumeDown",cmd:"volumeDown"});e.push({id:"volumeUp",cmd:"volumeUp"});e.push({id:"mute",cmd:"mute"});e.push({id:"unmute",cmd:"unmute"});e.push({id:"toggleMute",
cmd:"toggleMute"});d=e.length;for(a=0;a<d;a++)b=JSON.parse(JSON.stringify(e[a])),b.ch="mainzone",e.push(b),b=JSON.parse(JSON.stringify(e[a])),b.ch="zone2",e.push(b);e.push({id:"set volume",cmd:"setTo",step:"0.5",max:"98",ch:"mainzone"});e.push({id:"set volume",cmd:"setTo",step:"1",max:"80",ch:"zone2"});var c=[];c.push({id:"CBLSAT",cmd:"CBLSAT"});c.push({id:"DVDBlu-ray",cmd:"DVDBlu-ray"});c.push({id:"Blu-ray",cmd:"Blu-ray"});c.push({id:"Game",cmd:"Game"});c.push({id:"AUX",cmd:"AUX"});c.push({id:"AUX2",
cmd:"AUX2"});c.push({id:"MediaPlayer",cmd:"MediaPlayer"});c.push({id:"iPodUSB",cmd:"iPodUSB"});c.push({id:"TVAudio",cmd:"TVAudio"});c.push({id:"Tuner",cmd:"Tuner"});c.push({id:"NETHOME",cmd:"NETHOME"});c.push({id:"Bluetooth",cmd:"Bluetooth"});c.push({id:"IRADIO",cmd:"IRADIO"});c.push({id:"SERVER",cmd:"SERVER"});c.push({id:"CD",cmd:"CD"});c.push({id:"PHONO",cmd:"PHONO"});c.push({id:"HDRADIO",cmd:"HDRADIO"});c.push({id:"tunerUp",cmd:"tunerUp"});c.push({id:"tunerDown",cmd:"tunerDown"});c.push({id:"set tuner to",
cmd:"tuner",step:"1",min:"1",max:"50"});d=c.length;for(a=0;a<d;a++)b=JSON.parse(JSON.stringify(c[a])),b.ch="mainzone",e.push(b),b=JSON.parse(JSON.stringify(c[a])),b.ch="zone2",e.push(b);b=(new xnm.aio.denon.WebAVR).audioModes;for(a=0;a<b.length;a++)e.push({id:b[a],cmd:b[a]});e.push({id:"Quick1",cmd:"Quick1"});e.push({id:"Quick2",cmd:"Quick2"});e.push({id:"Quick3",cmd:"Quick3"});e.push({id:"Quick4",cmd:"Quick4"});e.push({id:"playPause",cmd:"playPause"});e.push({id:"previous",cmd:"previous"});e.push({id:"next",
cmd:"next"})}return e};return e}();"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.denon.Handler);
