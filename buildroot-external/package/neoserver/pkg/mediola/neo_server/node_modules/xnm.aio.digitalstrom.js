var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(f,d,e){f!=Array.prototype&&f!=Object.prototype&&(f[d]=e.value)};$jscomp.getGlobal=function(f){return"undefined"!=typeof window&&window===f?f:"undefined"!=typeof global&&null!=global?global:f};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var f=0;return function(d){return $jscomp.SYMBOL_PREFIX+(d||"")+f++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var f=$jscomp.global.Symbol.iterator;f||(f=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[f]&&$jscomp.defineProperty(Array.prototype,f,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(f){var d=0;return $jscomp.iteratorPrototype(function(){return d<f.length?{done:!1,value:f[d++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(f){$jscomp.initSymbolIterator();f={next:f};f[$jscomp.global.Symbol.iterator]=function(){return this};return f};$jscomp.iteratorFromArray=function(f,d){$jscomp.initSymbolIterator();f instanceof String&&(f+="");var e=0,h={next:function(){if(e<f.length){var g=e++;return{value:d(g,f[g]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};
$jscomp.polyfill=function(f,d,e,h){if(d){e=$jscomp.global;f=f.split(".");for(h=0;h<f.length-1;h++){var g=f[h];g in e||(e[g]={});e=e[g]}f=f[f.length-1];h=e[f];d=d(h);d!=h&&null!=d&&$jscomp.defineProperty(e,f,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.values",function(f){return f?f:function(){return $jscomp.iteratorFromArray(this,function(d,e){return e})}},"es8","es3");var xnm=xnm||{};xnm.aio=xnm.aio||{};xnm.aio.digitalstrom=xnm.aio.digitalstrom||{};
xnm.aio.digitalstrom.Server=function(){var f={0:"Broadcast",1:"Light",2:"Shading",3:"Heating",4:"Audio",5:"Video",6:"Security",7:"Access",8:"Joker",9:"Cooling",10:"Room ventilation",11:"Window",12:"Recirculation",48:"Temperature control",64:"Apartment ventilation"},d={0:"Preset 0",1:"Area 1 Off",2:"Area 2 Off",3:"Area 3 Off",4:"Area 4 Off",5:"Preset 1",6:"Area 1 On",7:"Area 2 On",8:"Area 3 On",9:"Area 4 On",10:"Area Stepping Continue",11:"Decrement",12:"Increment",13:"Minimum",14:"Maximum",15:"Stop",
17:"Preset 2",18:"Preset 3",19:"Preset 4",20:"Preset 12",21:"Preset 13",22:"Preset 14",23:"Preset 22",24:"Preset 23",25:"Preset 24",26:"Preset 32",27:"Preset 33",28:"Preset 34",29:"Preset 42",30:"Preset 43",31:"Preset 44",32:"Preset 10",33:"Preset 11",34:"Preset 20",35:"Preset 21",36:"Preset 30",37:"Preset 31",38:"Preset 40",39:"Preset 41",40:"Auto Off",41:"Impulse",42:"Area 1 Decrement",43:"Area 1 Increment",44:"Area 2 Decrement",45:"Area 2 Increment",46:"Area 3 Decrement",47:"Area 3 Increment",
48:"Area 4 Decrement",49:"Area 4 Increment",50:"Device Off",51:"Device On",52:"Area 1 Stop",53:"Area 2 Stop",54:"Area 3 Stop",55:"Area 4 Stop",56:"Sun protection"},e={64:"Auto Standby",65:"Panic",67:"Standby",68:"Deep Off",69:"Sleeping",70:"Wakeup",71:"Present",72:"Absent",73:"Door Bell",74:"Alarm",75:"Zone Active",76:"Fire",77:"Smoke",78:"Water",79:"Gas",80:"Bell 2",81:"Bell 3",82:"Bell 4",83:"Alarm 2",84:"Alarm 3",85:"Alarm 4",86:"Wind",87:"No Wind",88:"Rain",89:"No Rain",90:"Hail",91:"No Hail"},
h=function(a){this._server=a};h.prototype._requestApplicationToken=function(a,b){this._doSystemRequest("requestApplicationToken",{applicationName:a},function(c,a){c?b&&b(c):b&&b(null,a.applicationToken)})};h.prototype._login=function(a,b,c){this._doSystemRequest("login",{user:a,password:b},function(b,a){b?c&&c(b):c&&c(null,a.token)})};h.prototype._enableToken=function(a,b,c){this._doSystemRequest("enableToken",{applicationToken:a,token:b},function(b){c&&c(b)})};h.prototype._loginApplication=function(a,
b){a?this._doSystemRequest("loginApplication",{loginToken:a},function(c,a){c?b&&b(c):b&&b(null,a.token)}):b&&b(Error("loginToken is empty"))};h.prototype._doSystemRequest=function(a,b,c){this._server._doJsonRequest("/system/"+a,b,function(b,a){b?c&&c(b):c&&c(null,a)})};var g=function(a){this._server=a};g.prototype._getName=function(a){this._doApartmentRequest("getName",null,function(b,c){b?a&&a(b):c?a&&a(null,c.name):a&&a(Error("apartment getName result invalid"))})};g.prototype._getSensorValues=
function(a){this._doApartmentRequest("getSensorValues",null,function(b,c){b?a&&a(b):c?a&&a(null,c):a&&a(Error("apartment getSensorValues result invalid"))})};g.prototype._getTemperatureControlStatus=function(a){this._doApartmentRequest("getTemperatureControlStatus",null,function(b,c){b?a&&a(b):c?a&&a(null,c):a&&a(Error("apartment getTemperatureControlStatus result invalid"))})};g.prototype._getStructure=function(a){this._doApartmentRequest("getStructure",null,function(b,c){b?a&&a(b):a&&a(null,c)})};
g.prototype._callScene=function(a,b){a?"undefined"==typeof a.sceneNumber||null==a.sceneNumber?b&&b(Error("sceneNumber invalid")):this._doApartmentRequest("callScene",a,function(c,a){c?b&&b(c):b&&b(null,a)}):b&&b(Error("params invalid"))};g.prototype._doApartmentRequest=function(a,b,c){this._server._doJsonRequest("/apartment/"+a,b,function(b,a){b?c&&c(b):c&&c(null,a)})};var p=function(a){this._server=a};p.prototype._getReachableScenes=function(a,b,c){"undefined"==typeof a||null==a?c&&c(Error("id invalid")):
"undefined"==typeof b||null==b?c&&c(Error("groupID invalid")):this._doZoneRequest("getReachableScenes",{id:a,groupID:b},c)};p.prototype._callScene=function(a,b,c){b?"undefined"==typeof b.sceneNumber||null==b.sceneNumber?c&&c(Error("sceneNumber invalid")):"undefined"==typeof a||null==a?c&&c(Error("id invalid")):(b.id=a,this._doZoneRequest("callScene",b,c)):c&&c(Error("params invalid"))};p.prototype._doZoneRequest=function(a,b,c){this._server._doJsonRequest("/zone/"+a,b,function(b,a){b?c&&c(b):c&&c(null,
a)})};var m=function(a){this._server=a};m.prototype._turnOn=function(a,b){this._doDeviceRequest("turnOn",a,b)};m.prototype._turnOff=function(a,b){this._doDeviceRequest("turnOff",a,b)};m.prototype._increaseValue=function(a,b){this._doDeviceRequest("increaseValue",a,b)};m.prototype._decreaseValue=function(a,b){this._doDeviceRequest("decreaseValue",a,b)};m.prototype._callScene=function(a,b){a?"undefined"==typeof a.sceneNumber||null==a.sceneNumber?b&&b(Error("sceneNumber invalid")):this._doDeviceRequest("callScene",
a,b):b&&b(Error("params invalid"))};m.prototype._doDeviceRequest=function(a,b,c){b?"undefined"!=typeof b.dsid&&null!=b.dsid||b.name?this._server._doJsonRequest("/device/"+a,b,function(b,a){b?c&&c(b):c&&c(null,a)}):c&&c(Error("no dsid or name")):c&&c(Error("params invalid"))};var k=function(a){this._server=a};k.prototype._getMeters=function(a){this._query("/apartment/dSMeters/*(*)",function(b,c){b?a&&a(b):(b=[],c&&c.dSMeters&&(b=c.dSMeters),a&&a(null,b))})};k.prototype._getUsrEvent=function(a){this._query("/usr/events/*(*)",
function(b,c){b?a&&a(b):(b=[],c&&c.events&&(b=c.events),a&&a(null,b))})};k.prototype._getUsrDefinedStates=function(a){this._query("/usr/addon-states/system-addon-user-defined-states/*(*)",function(b,c){b?a&&a(b):(b=[],c&&c["system-addon-user-defined-states"]&&(b=c["system-addon-user-defined-states"]),a&&a(null,b))})};k.prototype._query=function(a,b){this._doPropertyRequest("query",{query:a},function(c,a){c?b&&b(c):b&&b(null,a)})};k.prototype._query2=function(a,b){this._doPropertyRequest("query2",
{query:a},function(c,a){c?b&&b(c):b&&b(null,a)})};k.prototype._doPropertyRequest=function(a,b,c){this._server._doJsonRequest("/property/"+a,b,function(b,a){b?c&&c(b):c&&c(null,a)})};var n=function(a){this._server=a};n.prototype._raise=function(a,b){a?a.name?this._doEventRequest("raise",a,b):b&&b(Error("name invalid")):b&&b(Error("params invalid"))};n.prototype._doEventRequest=function(a,b,c){b?"undefined"!=typeof b.dsid&&null!=b.dsid||b.name?this._server._doJsonRequest("/event/"+a,b,function(b,a){b?
c&&c(b):c&&c(null,a)}):c&&c(Error("no dsid or name")):c&&c(Error("params invalid"))};var l=function(a,b,c){var d=require("x.logger.js");this._logger=d?d.getLogger("xnm.aio.digitalstrom.Server"):{log:function(){}};this.ip=a;this.port=b;b||(this.port=8080);this.applicationToken=c;this.sessionToken=null;this._getSessionTokenCBs=[];this._system=new h(this);this._apartment=new g(this);this._zone=new p(this);this._device=new m(this);this._property=new k(this);this._event=new n(this)};l.HEAT_CONTROL_MODE=
["off","pid_control","zone_follower","fixed_value","manual"];l.HEAT_OP_MODE="off comfort economy not_used night holiday cooling cooling_off".split(" ");l.prototype._doRequest=function(a,b,c){a||(a="/");b||(b={});this.sessionToken&&(b.token=this.sessionToken);if(b){a+="?";for(var d in b)a+=d+"="+encodeURI(b[d])+"&"}"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0");a={host:this.ip,port:this.port,path:a,method:"GET",headers:{"Content-Type":'text/html; charset="UTF-8"',
"Content-Length":0,Connection:"close",rejectUnauthorized:!1,requestCert:!0}};var e=this;this._logger.log("trace","do https request:"+JSON.stringify(a));a=require("https").request(a,function(b){b.setEncoding("utf-8");var a="";b.on("data",function(b){a+=b});b.on("end",function(){e._logger.log("trace","receive https response:"+a+" with code:"+b.statusCode);c&&c(null,a,b.statusCode);c=null})});a.on("error",function(b){e._logger.log("warn","do https request error:"+b.message);c&&c(b);c=null});a.setTimeout(1E4,
function(){e._logger.log("warn","do https request timeout");var b=Error("timeout");b.reason="timeout";c&&c(b);c=null});a.end()};l.prototype._doJsonRequest=function(a,b,c){var d=this,e=a;e||(e="/");this._doRequest("/json"+e,b,function(e,g,f){if(e)c&&c(e);else if(403==f)d.getSessionToken(function(e){e?c&&c(e):d._doJsonRequest(a,b,c)});else try{var h=JSON.parse(g);h.ok?c&&c(null,h.result):c&&c(Error("json response error:"+h.message))}catch(y){c&&c(y)}})};l.prototype._getReachableScenes=function(a,b){var c=
null,d=0,e=this,g=function(f,h){!f&&h&&(c||(c={}),c[a[d].zoneID+"."+a[d].groupID]=h);d++;d>=a.length?b&&b(null,c):e._zone._getReachableScenes(a[d].zoneID,a[d].groupID,g)};this._zone._getReachableScenes(a[d].zoneID,a[d].groupID,g)};l.prototype.getSessionToken=function(a){if(this.applicationToken){var b=this._getSessionTokenCBs.length;a&&-1==this._getSessionTokenCBs.indexOf(a)&&this._getSessionTokenCBs.push(a);if(0==b){var c=this;this._system._loginApplication(this.applicationToken,function(b,d){if(b)a&&
a(b);else{c.sessionToken=d;b=c._getSessionTokenCBs;c._getSessionTokenCBs=[];for(var e=0;e<b.length;e++)b[e](null,d)}})}}else a&&a(Error("applicationToken is empty"))};l.prototype.getDevices=function(a){var b=this,c={apartment:null};this._apartment._getName(function(d,e){if(d)a&&a(d);else{e||(e="Apartment");c.apartment={type:"apartment",name:e,meters:[],devices:[],zones:[],events:[],uds:[]};var g=0,h=function(b){g++;b?(a&&a(b),a=null):4==g&&(a&&a(null,c),a=null)};b._apartment._getTemperatureControlStatus(function(a,
d){b._apartment._getSensorValues(function(a,e){!a&&e&&e.outdoor&&(c.apartment.outdoor=e.outdoor);b._apartment._getStructure(function(a,g){if(a)h(a);else{a=[];if(g&&g.apartment&&g.apartment.zones)for(var l=0;l<g.apartment.zones.length;l++)for(var p=g.apartment.zones[l],m=0;m<p.groups.length;m++){var t=p.groups[m];0!=t.id&&0<t.devices.length&&a.push({zoneID:p.id,groupID:t.id})}b._getReachableScenes(a,function(b,a){if(b)h(b);else{if(g&&g.apartment&&g.apartment.zones)for(b=0;b<g.apartment.zones.length;b++){var l=
g.apartment.zones[b],p={type:"zone",zoneID:l.id,name:l.name,groups:[]},q;a:{if(e&&e.zones)for(q=0;q<e.zones.length;q++){var m=e.zones[q];if(m&&m.id==l.id){q=m.values;break a}}q=null}q&&(p.sensorValues=q);a:{m=l.id;var t=d;if(t&&t.zones)for(var n=0;n<t.zones.length;n++)if((q=t.zones[n])&&q.id==m&&0!=q.IsConfigured){m=[];for(var r in q)"ControlMode"!=r&&"OperationMode"!=r&&"TemperatureValue"!=r&&"NominalValue"!=r&&"ControlValue"!=r||m.push(r);q=m;break a}q=null}q&&(p.heating=q);if(0==l.id)for(l.name||
(p.name="All Devices"),q=0;q<l.devices.length;q++)m=l.devices[q],c.apartment.devices.push({type:"device",name:m.name,dsid:m.id,zoneID:m.zoneID,groups:m.groups});for(q=0;q<l.groups.length;q++){var k=l.groups[q];if(0!=k.id&&k.applicationType&&0<k.devices.length){m=f[k.id];t=l.id;n=k.id;var z=k.applicationType;var v=a?(v=a[l.id+"."+k.id])?v.reachableScenes:null:null;if(a)if((k=a[l.id+"."+k.id])&&k.userSceneNames){for(var w=null,x=0;x<k.userSceneNames.length;x++){var u=k.userSceneNames[x];u&&u.sceneNr&&
u.sceneName&&(w||(w={}),w[u.sceneNr]=u.sceneName)}k=w}else k=null;else k=null;p.groups.push({type:"group",name:m,zoneID:t,groupID:n,applicationType:z,reachableScenes:v,sceneNames:k})}}c.apartment.zones.push(p)}h()}})}})})});b._property._getMeters(function(b,a){if(b)h(b);else{if(a)for(b=0;b<a.length;b++)a[b].dSID&&c.apartment.meters.push({type:"meter",name:a[b].name,dsid:a[b].dSID});h()}});b._property._getUsrEvent(function(b,a){if(b)h(b);else{if(a)for(b=0;b<a.length;b++)a[b].id&&c.apartment.events.push({type:"event",
name:a[b].name,id:a[b].id});h()}});b._property._getUsrDefinedStates(function(b,a){if(b)h(b);else{if(a)for(b=0;b<a.length;b++)a[b].name&&c.apartment.uds.push({type:"uds",name:a[b].displayName,id:a[b].name,setName:a[b].setName,resetName:a[b].resetName});h()}})}})};l.prototype.registApplication=function(a,b,c){var d=this;this._system._requestApplicationToken("mediola",function(e,g){e?c&&c(e):d._system._login(a,b,function(b,a){b?c&&c(b):d._system._enableToken(g,a,function(b){c&&c(b,g)})})})};l.prototype.executeCommand=
function(a,b,c){if(a&&a.type)if(b&&b.value)switch(a.type){case "apartment":switch(b.value){case "callScene":b=parseInt(b.ext);if(isNaN(b)||0>b||128<b){c&&c(Error("scene number invalid"));return}this._apartment._callScene({sceneNumber:b},c);break;default:c&&c(Error("unknown command:"+b.value))}break;case "zone":switch(b.value){case "callScene":b=parseInt(b.ext);if(isNaN(b)||0>b||128<b){c&&c(Error("scene number invalid"));return}this._zone._callScene(a.zoneID,{sceneNumber:b},c);break;default:c&&c(Error("unknown command:"+
b.value))}break;case "group":switch(b.value){case "callScene":b=parseInt(b.ext);if(isNaN(b)||0>b||128<b){c&&c(Error("scene number invalid"));return}this._zone._callScene(a.zoneID,{groupID:a.groupID,sceneNumber:b},c);break;default:c&&c(Error("unknown command:"+b.value))}break;case "device":switch(b.value){case "callScene":b=parseInt(b.ext);if(isNaN(b)||0>b||128<b){c&&c(Error("scene number invalid"));return}this._device._callScene({dsid:a.dsid,sceneNumber:b},c);break;case "turnOn":this._device._turnOn({dsid:a.dsid},
c);break;case "turnOff":this._device._turnOff({dsid:a.dsid},c);break;case "decreaseValue":this._device._decreaseValue({dsid:a.dsid},c);break;case "increaseValue":this._device._increaseValue({dsid:a.dsid},c);break;default:c&&c(Error("unknown command:"+b.value))}break;case "event":switch(b.value){case "run":if(!a.id){c&&c(Error("device id invalid"));return}this._event._raise({name:"highlevelevent",parameter:"id="+a.id},c);break;default:c&&c(Error("unknown command:"+b.value))}break;default:c&&c(Error("unknown device type:"+
a.type))}else c&&c(Error("command format invalid"));else c&&c(Error("device format invalid"))};l.prototype.executeCommandCreator=function(a,b,c){if(b&&b.value)if(a&&a.type){var g={value:"callScene",ext:0},h=null;if("turnOn"==b.value||"turnOff"==b.value||"increaseValue"==b.value||"decreaseValue"==b.value||"run"==b.value)g.value=b.value;else if("callScene"==b.value){h=parseInt(b.ext);if(isNaN(h)){c&&c(Error("callScene value invalid"));return}g.ext=h}else if("doActivity"==b.value){if(!b.ext){c&&c(Error("doActivity value invalid"));
return}var f=!1,l;for(l in d)if(b.ext==d[l]){h=parseInt(l);f=!0;break}if(!f)for(l in e)if(b.ext==e[l]){h=parseInt(l);f=!0;break}if(!f){c&&c(Error("unknown doActivity:"+b.ext));return}g.ext=h}else if("doScene"==b.value.substr(0,7)){h=parseInt(b.value.substr(7));if(isNaN(h)){c&&c(Error("doScene value invalid"));return}g.ext=h}else{c&&c(Error("unknown command:"+b.value));return}b=null;switch(a.type){case "apartment":case "zone":case "group":case "device":case "event":b=a;break;default:c&&c(Error("unknown device type:"+
a.type))}this.executeCommand(b,g,function(b){c&&c(b)})}else c&&c(Error("device json invalid"));else c&&c(Error("command json invalid"))};l.prototype.getStatesCreator=function(a,b,c){var d=function(b){return b.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")};if(b)if(0==b.length)c&&c(null,[]);else if(b){var e=[],g={},h={},f={},m={},p=this;this._property._getUsrDefinedStates(function(a,k){if(!a&&k)for(a=0;a<k.length;a++){var n=k[a];n.name&&
(m[n.name]={stateTxt:1==n.value?d(n.setName):d(n.resetName),stateF:1==n.value?parseFloat(n.setName):parseFloat(n.resetName)})}p._property._getMeters(function(a,d){if(!a&&d){var k,n;for(k=0;k<d.length;k++){var r=d[k];r.dSID&&(g[r.dSID]=r)}}p._apartment._getSensorValues(function(a,d){if(!a&&d&&(d.outdoor&&(f=d.outdoor),d.zones))for(k=0;k<d.zones.length;k++)if(a=d.zones[k],h[a.id]={},a.values)for(n=0;n<a.values.length;n++)for(var t in a.values[n])h[a.id][t]=a.values[n][t];p._apartment._getTemperatureControlStatus(function(a,
d){if(!a&&d&&d.zones)for(k=0;k<d.zones.length;k++)a=d.zones[k],h[a.id]||(h[a.id]={}),"undefined"!=typeof a.ControlMode&&null!=a.ControlMode&&(h[a.id].ControlMode=l.HEAT_CONTROL_MODE[a.ControlMode]),"undefined"!=typeof a.OperationMode&&null!=a.OperationMode&&(h[a.id].OperationMode=l.HEAT_OP_MODE[a.OperationMode]),"undefined"!=typeof a.TemperatureValue&&null!=a.TemperatureValue&&(h[a.id].TemperatureValue=a.TemperatureValue),"undefined"!=typeof a.NominalValue&&null!=a.NominalValue&&(h[a.id].NominalValue=
a.NominalValue),"undefined"!=typeof a.ControlValue&&null!=a.ControlValue&&(h[a.id].ControlValue=a.ControlValue);var p;for(k=0;k<b.length;k++)if(b[k]){d=b[k].id;a=b[k].device;var n=b[k].status;if(d&&n&&n.value&&a&&a.type){if("meter"==a.type&&a.dsid)(r=g[a.dsid])&&(p=r[n.value]);else if("uds"==a.type&&a.id)(r=m[a.id])&&(p=r[n.value]);else if("apartment"==a.type){if(r=f[n.value])p=r.value}else"zone"==a.type&&a.zoneID&&(r=h[a.zoneID])&&(p=r[n.value]);if("undefined"==typeof p||null==p)p="?";e.push({id:d,
status:p})}}c&&c(null,e)})})})})}else c&&c(Error("deviceList is null"));else c&&c(Error("deviceList is null"))};l.prototype.toJSON=function(){return{sys:"digitalstrom",ip:this.ip,port:this.port,token:this.applicationToken}};l.prototype.equalsTo=function(a){return a&&a instanceof l?this.ip==a.ip&&this.port==a.port&&this.applicationToken==a.applicationToken:!1};l.GROUP_NAMES=f;l.GROUP_SCENE=d;l.NON_GROUP_SCENE=e;l.GROUP_DEFAULT_SCENES={1:[0,5,17,18,19,40],2:[0,5,15,17,18,19],3:[0,1,2,4,5],4:[0,5,17,
18,19],5:[0,5,17,18,19],9:[6,7,8,10,11],10:[0,5,17,18,19,33,35,36,37],11:[0,5,17,18,19,33,35,36,37],12:[0,5,17,18,19,33,35,36,37],48:[0,1,2,4,5,6,7,8,10,11],64:[0,5,17,18,19,33,35,36,37]};l.GROUP_SPECIAL_SCENE_NAME={1:{0:"Off",40:"Fade Off"},2:{0:"Up",5:"Down"},3:{0:"Heating Off",1:"Heating Comfort",2:"Heating Economy",3:"Heating Not Used",4:"Heating Night"},4:{0:"Off"},5:{0:"Off"},9:{0:"Heating Off",1:"Heating Comfort",2:"Heating Economy",3:"Heating Not Used",4:"Heating Night",5:"Heating Holiday"},
10:{0:"Off",5:"Level 1",17:"Level 2",18:"Level 3",19:"Level 4",33:"Automatic (air flow intensity)",35:"Auto (louver swing mode)",36:"Boost",37:"Noise Reduction"},48:{0:"Heating Off",1:"Heating Comfort",2:"Heating Economy",3:"Heating Not Used",4:"Heating Night",5:"Heating Holiday",6:"Cooling Off",7:"Cooling Comfort",8:"Cooling Economy",9:"Cooling Not Used",10:"Cooling Night",11:"Cooling Holiday"}};return l}();
xnm.aio.digitalstrom.DM=function(){var f=function(d,e){this.code=d;this.message=e;this.stack=Error().stack};f.prototype=Error();f.prototype.name="DigitalStromDMError";f.prototype.code=0;f.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};return{SYS:"digitalstrom",getGatewayType:function(){return[{sys:this.SYS,name:"digitalSTROM"}]},getGatewayDeviceType:function(){return[]},createGateway:function(d,e,h){e=f.ERROR_CODE;d?d.ip?h(null,d):h(new f(e.INVALID,"ip is invalid")):
h(new f(e.INVALID,"info is invalid"))},updateGateway:function(d,e,h,g){d=f.ERROR_CODE;e?e.ip?e.username?e.password?g(null,e):g(new f(d.INVALID,"password is invalid")):g(new f(d.INVALID,"username is invalid")):g(new f(d.INVALID,"ip is invalid")):g(new f(d.INVALID,"update is invalid"))},deleteGateway:function(d,e,h){h()},createDevice:function(d,e,h){var g=f.ERROR_CODE;if(d)if(d.gateway)if(d.type)if(e.data&&e.data.gateways&&0!==e.data.gateways.length){e=e.data.gateways;var p;for(p=0;p<e.length;p++)if(e[p].index===
d.gateway){var m=e[p];break}m?h(null,d):h(new f(g.NOT_FOUND,"gateway with index "+d.gateway+" not exists"))}else h(new f(g.NOT_FOUND,"gateway with index "+d.gateway+" not exists"));else h(new f(g.INVALID,"type is invalid"));else h(new f(g.INVALID,"gateway is invalid"));else h(new f(g.INVALID,"info is invalid"))},updateDevice:function(d,e,h){var g=f.ERROR_CODE;if(d)if(d.gateway)if(d.type)if(e.data&&e.data.gateways&&0!==e.data.gateways.length){e=e.data.gateways;var p;for(p=0;p<e.length;p++)if(e[p].index===
d.gateway){var m=e[p];break}m?h(null,d):h(new f(g.NOT_FOUND,"gateway with index "+d.gateway+" not exists"))}else h(new f(g.NOT_FOUND,"gateway with index "+d.gateway+" not exists"));else h(new f(g.INVALID,"type is invalid"));else h(new f(g.INVALID,"gateway is invalid"));else h(new f(g.INVALID,"info is invalid"))},deleteDevice:function(d,e,h){h()},applyUIFilter:function(d,e){var h=this,g=function(d,a){if("*"==d)return!0;for(var b=!1,c=0;c<d.length;c++)if(d[c]==a){b=!0;break}return b},f=function(d,a,
b){var c=[];switch(b.catagory){case "command":d.command&&d.command.forEach(function(a){g(b.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),c.push(a))});break;case "status":d.status&&d.status.forEach(function(a){g(b.elems,a.type)&&(a=JSON.parse(JSON.stringify(a)),c.push(a))})}return c},m=function(d,a){var b=[],c=h.getCommandStatusMap(d);c&&(d=f(c,d,a),b=b.concat(d));return b};if(!d||null==d.type||"undefined"==typeof d.type)return null;var k=JSON.parse(JSON.stringify(d)),n=null;switch(e.catagory){case "command":n=
m(d,e);k.command=n;break;case "status":n=m(d,e);k.status=n;break;default:return null}return n&&0!=n.length?k:null},getCommandStatusMap:function(d){var e=function(){var a=xnm.aio.digitalstrom.Server.GROUP_SCENE,c=[],d;for(d in a)a[d]&&c.push(a[d]);return c},h=function(){var a=xnm.aio.digitalstrom.Server.NON_GROUP_SCENE,c=[],d;for(d in a)a[d]&&c.push(a[d]);return c},g={command:[],status:[]};if(!d||!d.type)return null;if("event"==d.type)return g.command=[{type:"enum",name:"run",ref:{value:"run"}}],g;
if("uds"==d.type)return g.status=[{type:"string",name:"state (string)",ref:{value:"stateTxt"}},{type:"float",name:"state (float)",ref:{value:"stateF"}}],g;switch(d.type){case "apartment":g.command=[{type:"enum",name:"Absent",ref:{value:"doScene72"}},{type:"enum",name:"Present",ref:{value:"doScene71"}},{type:"enum",name:"Door Bell",ref:{value:"doScene73"}},{type:"enum",name:"Rain",ref:{value:"doScene88"}},{type:"enum",name:"No Rain",ref:{value:"doScene89"}},{type:"enum",name:"Wind",ref:{value:"doScene86"}},
{type:"enum",name:"No Wind",ref:{value:"doScene87"}},{type:"enum",name:"Hail",ref:{value:"doScene90"}},{type:"enum",name:"No Wind",ref:{value:"doScene91"}},{type:"enum",name:"Panic",ref:{value:"doScene65"}},{type:"enum",name:"Fire",ref:{value:"doScene76"}},{type:"enum",name:"Alarm 1",ref:{value:"doScene74"}},{type:"enum",name:"Alarm 2",ref:{value:"doScene83"}},{type:"enum",name:"Alarm 3",ref:{value:"doScene84"}},{type:"enum",name:"Alarm 4",ref:{value:"doScene85"}}];break;case "zone":g.command=[{type:"enum",
name:"Standby",ref:{value:"doScene67"}},{type:"enum",name:"Deep off",ref:{value:"doScene68"}},{type:"enum",name:"Sleeping",ref:{value:"doScene69"}},{type:"enum",name:"Wake up",ref:{value:"doScene70"}}];break;case "group":var f=xnm.aio.digitalstrom.Server.GROUP_DEFAULT_SCENES[d.applicationType];f||(f=[]);if(d.reachableScenes)for(var m=0;m<d.reachableScenes.length;m++)-1==f.indexOf(d.reachableScenes[m])&&f.push(d.reachableScenes[m]);if(d.sceneNames)for(var k in d.sceneNames)-1==f.indexOf(parseInt(k))&&
f.push(parseInt(k));for(m=0;m<f.length;m++){var n=f[m],l=null;d.sceneNames&&(l=d.sceneNames[n]);if(!l){var a=xnm.aio.digitalstrom.Server.GROUP_SPECIAL_SCENE_NAME[d.applicationType];a&&(l=a[n])}l||(l=xnm.aio.digitalstrom.Server.GROUP_SCENE[n]);l&&g.command.push({type:"enum",name:l,ref:{value:"doScene"+n}})}break;case "device":if(d.groups)for(f=[],m=0;m<d.groups.length;m++){n=[];switch(d.groups[m]){case 1:n=[{type:"enum",name:"on",ref:{value:"turnOn"}},{type:"enum",name:"off",ref:{value:"turnOff"}},
{type:"enum",name:"up",ref:{value:"increaseValue"}},{type:"enum",name:"down",ref:{value:"decreaseValue"}}];break;case 2:n=[{type:"enum",name:"move down",ref:{value:"turnOn"}},{type:"enum",name:"move up",ref:{value:"turnOff"}},{type:"enum",name:"step down",ref:{value:"increaseValue"}},{type:"enum",name:"step up",ref:{value:"decreaseValue"}}];break;case 4:n=[{type:"enum",name:"on",ref:{value:"turnOn"}},{type:"enum",name:"off",ref:{value:"turnOff"}}];break;case 5:n=[{type:"enum",name:"on",ref:{value:"turnOn"}},
{type:"enum",name:"off",ref:{value:"turnOff"}}]}for(l=0;l<n.length;l++)a=n[l],-1==f.indexOf(a.ref.value)&&(g.command.push(a),f.push(a.ref.value))}}switch(d.type){case "apartment":case "zone":e=e();e=e.concat(h());g.command.push({type:"enum",name:"do activity",ref:{value:"doActivity",ext:"%e",extMeta:e}});break;case "group":case "device":e=e(),g.command.push({type:"enum",name:"do activity",ref:{value:"doActivity",ext:"%e",extMeta:e}})}g.command.push({type:"int",name:"call scene",ref:{value:"callScene",
ext:"%d",extMeta:"0-127"}});h=null;switch(d.type){case "apartment":if(d.outdoor)for(k in d.outdoor)switch(k){case "temperature":g.status.push({type:"float",name:"temperature",ref:{value:"temperature"}});break;case "humidity":g.status.push({type:"float",name:"humidity",ref:{value:"humidity"}});break;case "windspeed":g.status.push({type:"float",name:"wind speed",ref:{value:"windspeed"}});break;case "winddirection":g.status.push({type:"float",name:"wind direction",ref:{value:"winddirection"}});break;
case "gustspeed":g.status.push({type:"float",name:"gust speed",ref:{value:"gustspeed"}});break;case "gustdirection":g.status.push({type:"float",name:"gust direction",ref:{value:"gustdirection"}});break;case "precipitation":g.status.push({type:"float",name:"precipitation",ref:{value:"precipitation"}});break;case "airpressure":g.status.push({type:"float",name:"air pressure",ref:{value:"airpressure"}})}break;case "zone":k=!1;if(d.sensorValues)for(m=0;m<d.sensorValues.length;m++)if(h=d.sensorValues[m])"undefined"!=
typeof h.TemperatureValue&&null!=h.TemperatureValue&&(k=!0,g.status.push({type:"float",name:"temperature",ref:{value:"TemperatureValue"}})),"undefined"!=typeof h.HumidityValue&&null!=h.HumidityValue&&g.status.push({type:"float",name:"humidity",ref:{value:"HumidityValue"}}),"undefined"!=typeof h.CO2ConcentrationValue&&null!=h.CO2ConcentrationValue&&g.status.push({type:"float",name:"co2",ref:{value:"CO2ConcentrationValue"}}),"undefined"!=typeof h.BrightnessValue&&null!=h.BrightnessValue&&g.status.push({type:"float",
name:"brightness",ref:{value:"BrightnessValue"}});if(d.heating)for(m=0;m<d.heating.length;m++)switch(h=d.heating[m],h){case "ControlMode":g.status.push({type:"enum",name:"control mode",ref:{value:"ControlMode",options:["off","pid_control","zone_follower","fixed_value","manual"]}});break;case "OperationMode":g.status.push({type:"enum",name:"operation mode",ref:{value:"OperationMode",options:"off comfort economy not_used night holiday cooling cooling_off".split(" ")}});break;case "TemperatureValue":k||
g.status.push({type:"float",name:"temperature",ref:{value:"TemperatureValue"}});break;case "NominalValue":g.status.push({type:"float",name:"target temperature",ref:{value:"NominalValue"}});break;case "ControlValue":g.status.push({type:"float",name:"control value",ref:{value:"ControlValue"}})}break;case "meter":g.status.push({type:"float",name:"power",ref:{value:"powerConsumption",unit:"W"}}),g.status.push({type:"float",name:"energy meter",ref:{value:"energyMeterValue",unit:"Wh"}})}return g}}}();
xnm.aio.digitalstrom.Handler=function(){var f=function(){};f.prototype.Server=xnm.aio.digitalstrom.Server;f.prototype.devicemanager=xnm.aio.digitalstrom.DM;f.prototype.registModule=function(d){d.register(this.devicemanager.SYS,"digitalstrom")};f.prototype.resolveGateway=function(d){return d&&d.ip&&d.token?new this.Server(d.ip,d.port,d.token):null};f.prototype.getDeviceCommands=function(d,e){d=(d=this.devicemanager.applyUIFilter(d,{catagory:"command",elems:"*"}))?d.command:[];e&&e(null,d)};f.prototype.getDeviceStatus=
function(d,e){d=(d=this.devicemanager.applyUIFilter(d,{catagory:"status",elems:"*"}))?d.status:[];e&&e(null,d)};f.prototype.doCommand=function(d,e,h,g){(d=this.resolveGateway(d))?d.executeCommandCreator(e,h,function(d){g&&g(d)}):g&&g(Error("gateway json format invalid"))};f.prototype.doStatus=function(d,e,h,g,f){(e=this.resolveGateway(e))?e.getStatesCreator(null,[{id:d,device:h,status:g}],function(d,e){d?f&&f(d):f&&f(null,e[0])}):f&&f(Error("gateway json format invalid"))};f.prototype.getDeviceList=
function(d,e){(d=this.resolveGateway(d))?d.getDevices(function(d,f){e&&e(d,f)}):e&&e(Error("gateway json format invalid"))};f.prototype.discover=function(d,e){var f=require("x.mdns.js");f.clearRecordBuffer();f.discoverServiceWithTimeout("_http._tcp.local",d,function(d,f){if(d)e&&e(d);else{for(var g=[],h=0;h<f.length;h++){var n=f[h];n.target&&n.ip&&0<n.ip.length&&"dss.local"==n.target.toLowerCase()&&(n=new xnm.aio.digitalstrom.Server(n.ip[0],8080),g.push(n))}e&&e(d,g)}})};f.prototype.registApplication=
function(d,e,f,g){if(!d||!d.ip)return null;(new this.Server(d.ip,d.port)).registApplication(e,f,function(d,e){g&&g(d,e)})};return f}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.digitalstrom.Handler);
