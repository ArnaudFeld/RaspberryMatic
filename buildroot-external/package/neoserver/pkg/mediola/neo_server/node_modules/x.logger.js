var x=x||{};
x.Logger={_level:0,_file:null,_fileMaxSize:200,_levelMap:{},_fileMap:{},_fileSizeMap:{},_logRoot:null,_logTrackerMap:{},_log2consoleMap:{},getLogger:function(a){return new x.Logger._LoggerImpl(a)},setLevel:function(a,c){if(a&&"string"===typeof a){var b=x.Logger._resolveLevel(a);0<=b&&(c?x.Logger._levelMap[c]=b:x.Logger._level=b)}},getAll:function(){var a={};a.defaultLevel=x.Logger._level;for(var c in x.Logger._levelMap)a[c]=this._level2Str(x.Logger._levelMap[c]);return a},setFile:function(a){x.Logger._file=a},
setLogFolder:function(a){x.Logger._logRoot=a},setTagFile:function(a,c){a&&c&&(this._fileMap[a]=c)},setTagFileNode:function(a,c){if(a&&c&&this._logRoot){var b=require("path");this._fileMap[a]=b.resolve(this._logRoot,c)}},setFileSize:function(a,c){a&&c&&(this._fileSizeMap[a]=c)},getFileSize:function(a){return this._fileSizeMap[a]},setLogToConsole:function(a,c){this._log2consoleMap[c]=a},getLogToConsole:function(a){a=this._matchKeyForTag(a,this._log2consoleMap);null==a&&(a=!0);return a},setLogTracker:function(a,
c){a&&c&&(this._logTrackerMap[a]||(this._logTrackerMap[a]=[]),-1==this._logTrackerMap[a].indexOf(c)&&this._logTrackerMap[a].push(c))},removeLogTracker:function(a,c){if(a&&this._logTrackerMap[a]){var b=-1;c&&(b=this._logTrackerMap[a].indexOf(c));-1!=b&&this._logTrackerMap[a].splice(b,1)}},getLogTrackers:function(a){if(!a)return[];a=a.split(".");for(var c=[];0<a.length;){var b=a.join(".");if(this._logTrackerMap[b]){c=c.concat(this._logTrackerMap[b]);break}a.splice(a.length-1,1)}return c},_matchKeyForTag:function(a,
c){if(!a)return null;for(var b=a.split("."),d=null;0<b.length&&(d=b.join("."),d=c[d],"undefined"==typeof d||null==d);)b.splice(b.length-1,1);return d},_level2Str:function(a){switch(a){case 0:return"all";case 1:return"trace";case 1.1:return"trace_l1";case 1.2:return"trace_l2";case 1.3:return"trace_l3";case 2:return"debug";case 3:return"info";case 4:return"warn";case 5:return"error";case 6:return"fatal";default:return"unknown"}},_resolveLevel:function(a){switch(a.toLowerCase()){case "all":return 0;
case "trace":case "trace_l0":return 1;case "trace_l1":return 1.1;case "trace_l2":return 1.2;case "trace_l3":return 1.3;case "debug":return 2;case "info":return 3;case "warn":return 4;case "error":return 5;case "fatal":return 6;default:return-1}},_getLevel:function(a){if(!a)return x.Logger._level;a=a.split(".");for(var c=x.Logger._level;0<a.length;){var b=a.join("."),b=x.Logger._levelMap[b];if("undefined"!=typeof b&&null!=b)return b;a.splice(a.length-1,1)}return c},_getFile:function(a){if(!a)return null;
a=a.split(".");for(var c;0<a.length;){var b=a.join(".");if(b=this._fileMap[b]){c=b;break}a.splice(a.length-1,1)}return c}};x.Logger._LoggerImpl=function(a){this.tag=a;this._queue=[]};
x.Logger._LoggerImpl.prototype.log=function(a,c){var b=x.Logger._resolveLevel(a);0<=b&&b>=x.Logger._getLevel(this.tag)&&(b=new Date,b=b.getDate()+"/"+(b.getMonth()+1)+"/"+b.getFullYear()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+"."+(b.getMilliseconds()/1E3).toFixed(3).slice(2,5)+" "+a+": ["+this.tag+"] "+c,this._write(b))};
x.Logger._LoggerImpl.prototype._write=function(a){var c=x.Logger.getLogTrackers(this.tag);if(c&&0<c.length)for(var b=0;b<c.length;b++){var d=c[b];d&&d(a)}!x.Logger._logWriter&&"undefined"!=typeof XC&&null!=XC&&XC.createObject&&(x.Logger._logWriter=XC.createObject("x.logger.writer"));x.Logger._logWriter&&(x.Logger.getLogToConsole(this.tag)&&x.Logger._logWriter.writeConsole(a),b=x.Logger._getFile(this.tag),c=x.Logger.getFileSize(b),c||(c=x.Logger._fileMaxSize),b&&x.Logger._logRoot?(b=require("path").resolve(x.Logger._logRoot,
b),x.Logger._logWriter.writeFile(a,b,c)):x.Logger._file&&x.Logger._logWriter.writeFile(a,x.Logger._file,c))};"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=x.Logger);
