var x=x||{};x.hub=x.hub||{};x.hub.v6=x.hub.v6||{};
x.hub.v6.API=function(){var c=function(b){this._version="v1";this._handler=b};c.prototype.init=function(b,a){var d=this;b.addRoute("/api/"+this._version+"/command",function(a,b){d._handler.command(a.body,function(a,c){b.json(d._buildResponseJSON(a,c))})});b.addRoute("/api/"+this._version+"/state",function(a,b){d._handler.state(a.query,function(a,c){b.json(d._buildResponseJSON(a,c))})});a&&a()};c.prototype.handleTunnelReuqest=function(b,a){var d=b.pathname.split("/"),c=this;"state"==d[3]?this._handler.state(b.query,
function(b,d){a&&a(c._buildResponseJSON(b,d))}):"command"==d[3]?this._handler.command(b.body,function(b,d){a&&a(c._buildResponseJSON(b,d))}):a&&a(c._buildResponseJSON(Error("invalid request")))};c.prototype._buildResponseJSON=function(b,a){if(b){for((a=b.code+"")||(a="0");6>a.length;)a="0"+a;return{XC_ERR:{code:a,msg:b.message}}}return{XC_SUC:a?a:{}}};return{V1:c}}();
x.hub.v6.CentralUnit=function(){var c=function(b){this._api=new x.hub.v6.API.V1(this);this._server=b};c.prototype.init=function(b){this._api.init(this._server,b)};c.prototype.handleTunnelReuqest=function(b,a){this._api.handleTunnelReuqest(b,a)};c.prototype.command=function(b,a){};c.prototype.state=function(b,a){b&&"true"==b.force?this._updatesStates(b,a):a&&a(null,null)};c.prototype._updatesStates=function(b,a){b&&b.id?this._getStates(b.id,function(d,c){d?a&&a(d):c?(d={},d[b.id]={},b.key?d[b.id][b.key]=
c[b.key]:d[b.id]=c,a&&a(null,d)):a&&a(null,{})}):this._updateStatesAll(b.timeout,a)};c.prototype._updateStatesAll=function(b,a){b&&(b*=1E3);require("x.hub.commandman.js").commandHandler2.updateGeneralDeviceStates(b,a)};c.prototype._updateStates=function(b,a){require("x.hub.deviceman.js").deviceManager2.toGeneralDevice(b,function(c,e){if(c)a&&a(c);else if(e)if(e.states&&e.details&&e.details.states){c=[];for(var d in e.details.states){var f=e.details.states[d];f&&f.value&&c.push({id:d,value:f.value})}0==
c.length?a&&a(null,null):require("x.hub.commandman.js").commandHandler2.getStatesWithIdx(b,null,c,function(b){b&&b.data?a&&a(null,b.data):a&&a(Error("get device states error"))})}else a&&a(null,null);else a&&a(Error("can not find general device"))})};return c}();x.hub.v6.Handler=function(){var c=function(){this._centralUnit=null};c.prototype.CentralUnit=x.hub.v6.CentralUnit;return c}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.v6.Handler);
