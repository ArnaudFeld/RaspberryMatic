pipeline {
    agent any
    stages {
        stage('Build') {
            steps {
                parallel "RaspberryPi3": {
                    node('linux') {
                        ws("workspace/RaspberryMatic/rpi3") {
                            checkout scm
                            sh 'make PRODUCT=raspmatic_rpi3 distclean dist'
                        }
                    }
                }, "Tinkerboard": {
                    node('linux') {
                        ws("workspace/RaspberryMatic/tinkerboard") {
                            checkout scm
                            sh 'make PRODUCT=raspmatic_tinkerboard distclean dist'
                        }
                    }
                }, "RaspberryPi0": {
                    node('linux') {
                        ws("workspace/RaspberryMatic/rpi0") {
                            checkout scm
                            sh 'make PRODUCT=raspmatic_rpi0 distclean dist'
                        }
                    }
                }, failFast: false
            }
        }
    }
}
